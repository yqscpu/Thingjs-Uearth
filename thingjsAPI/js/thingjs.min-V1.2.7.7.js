!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).THREE={})}(this,(function(e){"use strict";void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t});function t(){}Object.assign(t.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),i=0,r=n.length;i<r;i++)n[i].call(this,e)}}}});for(var n=[],i=0;i<256;i++)n[i]=(i<16?"0":"")+i.toString(16);var r=1234567,o={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(n[255&e]+n[e>>8&255]+n[e>>16&255]+n[e>>24&255]+"-"+n[255&t]+n[t>>8&255]+"-"+n[t>>16&15|64]+n[t>>24&255]+"-"+n[63&i|128]+n[i>>8&255]+"-"+n[i>>16&255]+n[i>>24&255]+n[255&r]+n[r>>8&255]+n[r>>16&255]+n[r>>24&255]).toUpperCase()},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(r=e%2147483647),((r=16807*r%2147483647)-1)/2147483646},degToRad:function(e){return e*o.DEG2RAD},radToDeg:function(e){return e*o.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,i,r){var o=Math.cos,a=Math.sin,s=o(n/2),l=a(n/2),u=o((t+i)/2),c=a((t+i)/2),h=o((t-i)/2),p=a((t-i)/2),d=o((i-t)/2),f=a((i-t)/2);switch(r){case"XYX":e.set(s*c,l*h,l*p,s*u);break;case"YZY":e.set(l*p,s*c,l*h,s*u);break;case"ZXZ":e.set(l*h,l*p,s*c,s*u);break;case"XZX":e.set(s*c,l*f,l*d,s*u);break;case"YXY":e.set(l*d,s*c,l*f,s*u);break;case"ZYZ":e.set(l*f,l*d,s*c,s*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}},a=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),Object.defineProperty(this,"isVector2",{value:!0}),this.x=e,this.y=t},s={width:{configurable:!0},height:{configurable:!0}};s.width.get=function(){return this.x},s.width.set=function(e){this.x=e},s.height.get=function(){return this.y},s.height.set=function(e){this.y=e},a.prototype.set=function(e,t){return this.x=e,this.y=t,this},a.prototype.setScalar=function(e){return this.x=e,this.y=e,this},a.prototype.setX=function(e){return this.x=e,this},a.prototype.setY=function(e){return this.y=e,this},a.prototype.setComponent=function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},a.prototype.getComponent=function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},a.prototype.clone=function(){return new this.constructor(this.x,this.y)},a.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this},a.prototype.add=function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},a.prototype.addScalar=function(e){return this.x+=e,this.y+=e,this},a.prototype.addVectors=function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},a.prototype.addScaledVector=function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},a.prototype.sub=function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},a.prototype.subScalar=function(e){return this.x-=e,this.y-=e,this},a.prototype.subVectors=function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},a.prototype.multiply=function(e){return this.x*=e.x,this.y*=e.y,this},a.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this},a.prototype.divide=function(e){return this.x/=e.x,this.y/=e.y,this},a.prototype.divideScalar=function(e){return this.multiplyScalar(1/e)},a.prototype.applyMatrix3=function(e){var t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this},a.prototype.min=function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},a.prototype.max=function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},a.prototype.clamp=function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},a.prototype.clampScalar=function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},a.prototype.clampLength=function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},a.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},a.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},a.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},a.prototype.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},a.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},a.prototype.dot=function(e){return this.x*e.x+this.y*e.y},a.prototype.cross=function(e){return this.x*e.y-this.y*e.x},a.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},a.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},a.prototype.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)},a.prototype.normalize=function(){return this.divideScalar(this.length()||1)},a.prototype.angle=function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e},a.prototype.distanceTo=function(e){return Math.sqrt(this.distanceToSquared(e))},a.prototype.distanceToSquared=function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},a.prototype.manhattanDistanceTo=function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},a.prototype.setLength=function(e){return this.normalize().multiplyScalar(e)},a.prototype.lerp=function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},a.prototype.lerpVectors=function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this},a.prototype.equals=function(e){return e.x===this.x&&e.y===this.y},a.prototype.fromArray=function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},a.prototype.toArray=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},a.prototype.fromBufferAttribute=function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},a.prototype.rotateAround=function(e,t){var n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this},a.prototype.random=function(){return this.x=Math.random(),this.y=Math.random(),this},Object.defineProperties(a.prototype,s);var l,u=function(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")};u.prototype.set=function(e,t,n,i,r,o,a,s,l){var u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=t,u[4]=r,u[5]=s,u[6]=n,u[7]=o,u[8]=l,this},u.prototype.identity=function(){return this.set(1,0,0,0,1,0,0,0,1),this},u.prototype.clone=function(){return(new this.constructor).fromArray(this.elements)},u.prototype.copy=function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},u.prototype.extractBasis=function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this},u.prototype.setFromMatrix4=function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},u.prototype.multiply=function(e){return this.multiplyMatrices(this,e)},u.prototype.premultiply=function(e){return this.multiplyMatrices(e,this)},u.prototype.multiplyMatrices=function(e,t){var n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[3],s=n[6],l=n[1],u=n[4],c=n[7],h=n[2],p=n[5],d=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],b=i[7],_=i[2],x=i[5],E=i[8];return r[0]=o*f+a*v+s*_,r[3]=o*m+a*y+s*x,r[6]=o*g+a*b+s*E,r[1]=l*f+u*v+c*_,r[4]=l*m+u*y+c*x,r[7]=l*g+u*b+c*E,r[2]=h*f+p*v+d*_,r[5]=h*m+p*y+d*x,r[8]=h*g+p*b+d*E,this},u.prototype.multiplyScalar=function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},u.prototype.determinant=function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],u=e[8];return t*o*u-t*a*l-n*r*u+n*a*s+i*r*l-i*o*s},u.prototype.getInverse=function(e,t){void 0!==t&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var n=e.elements,i=this.elements,r=n[0],o=n[1],a=n[2],s=n[3],l=n[4],u=n[5],c=n[6],h=n[7],p=n[8],d=p*l-u*h,f=u*c-p*s,m=h*s-l*c,g=r*d+o*f+a*m;if(0===g)return this.set(0,0,0,0,0,0,0,0,0);var v=1/g;return i[0]=d*v,i[1]=(a*h-p*o)*v,i[2]=(u*o-a*l)*v,i[3]=f*v,i[4]=(p*r-a*c)*v,i[5]=(a*s-u*r)*v,i[6]=m*v,i[7]=(o*c-h*r)*v,i[8]=(l*r-o*s)*v,this},u.prototype.transpose=function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},u.prototype.getNormalMatrix=function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},u.prototype.transposeIntoArray=function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},u.prototype.setUvTransform=function(e,t,n,i,r,o,a){var s=Math.cos(r),l=Math.sin(r);this.set(n*s,n*l,-n*(s*o+l*a)+o+e,-i*l,i*s,-i*(-l*o+s*a)+a+t,0,0,1)},u.prototype.scale=function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this},u.prototype.rotate=function(e){var t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],o=i[3],a=i[6],s=i[1],l=i[4],u=i[7];return i[0]=t*r+n*s,i[3]=t*o+n*l,i[6]=t*a+n*u,i[1]=-n*r+t*s,i[4]=-n*o+t*l,i[7]=-n*a+t*u,this},u.prototype.translate=function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this},u.prototype.equals=function(e){for(var t=this.elements,n=e.elements,i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0},u.prototype.fromArray=function(e,t){void 0===t&&(t=0);for(var n=0;n<9;n++)this.elements[n]=e[n+t];return this},u.prototype.toArray=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e};var c={getDataURL:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;var t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===l&&(l=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),l.width=e.width,l.height=e.height;var n=l.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=l}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},h=0;function p(e,t,n,i,r,s,l,c,d,f){Object.defineProperty(this,"id",{value:h++}),this.uuid=o.generateUUID(),this.name="",this.image=void 0!==e?e:p.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:p.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:1001,this.wrapT=void 0!==i?i:1001,this.magFilter=void 0!==r?r:1006,this.minFilter=void 0!==s?s:1008,this.anisotropy=void 0!==d?d:1,this.format=void 0!==l?l:1023,this.internalFormat=null,this.type=void 0!==c?c:1009,this.offset=new a(0,0),this.repeat=new a(1,1),this.center=new a(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new u,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==f?f:3e3,this.version=0,this.onUpdate=null}p.DEFAULT_IMAGE=void 0,p.DEFAULT_MAPPING=300,p.prototype=Object.assign(Object.create(t.prototype),{constructor:p,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var i=this.image;if(void 0===i.uuid&&(i.uuid=o.generateUUID()),!t&&void 0===e.images[i.uuid]){var r;if(Array.isArray(i)){r=[];for(var a=0,s=i.length;a<s;a++)r.push(c.getDataURL(i[a]))}else r=c.getDataURL(i);e.images[i.uuid]={uuid:i.uuid,url:r}}n.image=i.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(p.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});var d=function(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),Object.defineProperty(this,"isVector4",{value:!0}),this.x=e,this.y=t,this.z=n,this.w=i},f={width:{configurable:!0},height:{configurable:!0}};function m(e,t,n){this.width=e,this.height=t,this.scissor=new d(0,0,e,t),this.scissorTest=!1,this.viewport=new d(0,0,e,t),n=n||{},this.texture=new p(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:1006,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function g(e,t,n){m.call(this,e,t,n),this.samples=4,this.webglDepthRenderbuffer=n?n.webglDepthRenderbuffer:null}f.width.get=function(){return this.z},f.width.set=function(e){this.z=e},f.height.get=function(){return this.w},f.height.set=function(e){this.w=e},d.prototype.set=function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},d.prototype.setScalar=function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},d.prototype.setX=function(e){return this.x=e,this},d.prototype.setY=function(e){return this.y=e,this},d.prototype.setZ=function(e){return this.z=e,this},d.prototype.setW=function(e){return this.w=e,this},d.prototype.setComponent=function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},d.prototype.getComponent=function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},d.prototype.clone=function(){return new this.constructor(this.x,this.y,this.z,this.w)},d.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},d.prototype.add=function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},d.prototype.addScalar=function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},d.prototype.addVectors=function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},d.prototype.addScaledVector=function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},d.prototype.sub=function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},d.prototype.subScalar=function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},d.prototype.subVectors=function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},d.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},d.prototype.applyMatrix4=function(e){var t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this},d.prototype.divideScalar=function(e){return this.multiplyScalar(1/e)},d.prototype.setAxisAngleFromQuaternion=function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},d.prototype.setAxisAngleFromRotationMatrix=function(e){var t,n,i,r,o=e.elements,a=o[0],s=o[4],l=o[8],u=o[1],c=o[5],h=o[9],p=o[2],d=o[6],f=o[10];if(Math.abs(s-u)<.01&&Math.abs(l-p)<.01&&Math.abs(h-d)<.01){if(Math.abs(s+u)<.1&&Math.abs(l+p)<.1&&Math.abs(h+d)<.1&&Math.abs(a+c+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,g=(c+1)/2,v=(f+1)/2,y=(s+u)/4,b=(l+p)/4,_=(h+d)/4;return m>g&&m>v?m<.01?(n=0,i=.707106781,r=.707106781):(i=y/(n=Math.sqrt(m)),r=b/n):g>v?g<.01?(n=.707106781,i=0,r=.707106781):(n=y/(i=Math.sqrt(g)),r=_/i):v<.01?(n=.707106781,i=.707106781,r=0):(n=b/(r=Math.sqrt(v)),i=_/r),this.set(n,i,r,t),this}var x=Math.sqrt((d-h)*(d-h)+(l-p)*(l-p)+(u-s)*(u-s));return Math.abs(x)<.001&&(x=1),this.x=(d-h)/x,this.y=(l-p)/x,this.z=(u-s)/x,this.w=Math.acos((a+c+f-1)/2),this},d.prototype.min=function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},d.prototype.max=function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},d.prototype.clamp=function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},d.prototype.clampScalar=function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},d.prototype.clampLength=function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},d.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},d.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},d.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},d.prototype.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},d.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},d.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},d.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},d.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},d.prototype.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},d.prototype.normalize=function(){return this.divideScalar(this.length()||1)},d.prototype.setLength=function(e){return this.normalize().multiplyScalar(e)},d.prototype.lerp=function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},d.prototype.lerpVectors=function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this},d.prototype.equals=function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},d.prototype.fromArray=function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},d.prototype.toArray=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},d.prototype.fromBufferAttribute=function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this},d.prototype.random=function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this},Object.defineProperties(d.prototype,f),m.prototype=Object.assign(Object.create(t.prototype),{constructor:m,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),g.prototype=Object.assign(Object.create(m.prototype),{constructor:g,isWebGLMultisampleRenderTarget:!0,copy:function(e){return m.prototype.copy.call(this,e),this.samples=e.samples,this.webglDepthRenderbuffer=e.webglDepthRenderbuffer,this}});var v=function(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=e,this._y=t,this._z=n,this._w=i},y={x:{configurable:!0},y:{configurable:!0},z:{configurable:!0},w:{configurable:!0}};v.slerp=function(e,t,n,i){return n.copy(e).slerp(t,i)},v.slerpFlat=function(e,t,n,i,r,o,a){var s=n[i+0],l=n[i+1],u=n[i+2],c=n[i+3],h=r[o+0],p=r[o+1],d=r[o+2],f=r[o+3];if(c!==f||s!==h||l!==p||u!==d){var m=1-a,g=s*h+l*p+u*d+c*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),_=Math.atan2(b,g*v);m=Math.sin(m*_)/b,a=Math.sin(a*_)/b}var x=a*v;if(s=s*m+h*x,l=l*m+p*x,u=u*m+d*x,c=c*m+f*x,m===1-a){var E=1/Math.sqrt(s*s+l*l+u*u+c*c);s*=E,l*=E,u*=E,c*=E}}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=c},v.multiplyQuaternionsFlat=function(e,t,n,i,r,o){var a=n[i],s=n[i+1],l=n[i+2],u=n[i+3],c=r[o],h=r[o+1],p=r[o+2],d=r[o+3];return e[t]=a*d+u*c+s*p-l*h,e[t+1]=s*d+u*h+l*c-a*p,e[t+2]=l*d+u*p+a*h-s*c,e[t+3]=u*d-a*c-s*h-l*p,e},y.x.get=function(){return this._x},y.x.set=function(e){this._x=e,this._onChangeCallback()},y.y.get=function(){return this._y},y.y.set=function(e){this._y=e,this._onChangeCallback()},y.z.get=function(){return this._z},y.z.set=function(e){this._z=e,this._onChangeCallback()},y.w.get=function(){return this._w},y.w.set=function(e){this._w=e,this._onChangeCallback()},v.prototype.set=function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this},v.prototype.clone=function(){return new this.constructor(this._x,this._y,this._z,this._w)},v.prototype.copy=function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},v.prototype.setFromEuler=function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,i=e._y,r=e._z,o=e._order,a=Math.cos,s=Math.sin,l=a(n/2),u=a(i/2),c=a(r/2),h=s(n/2),p=s(i/2),d=s(r/2);switch(o){case"XYZ":this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d;break;case"YXZ":this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d;break;case"ZXY":this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d;break;case"ZYX":this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d;break;case"YZX":this._x=h*u*c+l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c-h*p*d;break;case"XZY":this._x=h*u*c-l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c+h*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this},v.prototype.setFromAxisAngle=function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this},v.prototype.setFromRotationMatrix=function(e){var t=e.elements,n=t[0],i=t[4],r=t[8],o=t[1],a=t[5],s=t[9],l=t[2],u=t[6],c=t[10],h=n+a+c;if(h>0){var p=.5/Math.sqrt(h+1);this._w=.25/p,this._x=(u-s)*p,this._y=(r-l)*p,this._z=(o-i)*p}else if(n>a&&n>c){var d=2*Math.sqrt(1+n-a-c);this._w=(u-s)/d,this._x=.25*d,this._y=(i+o)/d,this._z=(r+l)/d}else if(a>c){var f=2*Math.sqrt(1+a-n-c);this._w=(r-l)/f,this._x=(i+o)/f,this._y=.25*f,this._z=(s+u)/f}else{var m=2*Math.sqrt(1+c-n-a);this._w=(o-i)/m,this._x=(r+l)/m,this._y=(s+u)/m,this._z=.25*m}return this._onChangeCallback(),this},v.prototype.setFromUnitVectors=function(e,t){var n=e.dot(t)+1;return n<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()},v.prototype.angleTo=function(e){return 2*Math.acos(Math.abs(o.clamp(this.dot(e),-1,1)))},v.prototype.rotateTowards=function(e,t){var n=this.angleTo(e);if(0===n)return this;var i=Math.min(1,t/n);return this.slerp(e,i),this},v.prototype.identity=function(){return this.set(0,0,0,1)},v.prototype.inverse=function(){return this.conjugate()},v.prototype.conjugate=function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},v.prototype.dot=function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},v.prototype.lengthSq=function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},v.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},v.prototype.normalize=function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},v.prototype.multiply=function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},v.prototype.premultiply=function(e){return this.multiplyQuaternions(e,this)},v.prototype.multiplyQuaternions=function(e,t){var n=e._x,i=e._y,r=e._z,o=e._w,a=t._x,s=t._y,l=t._z,u=t._w;return this._x=n*u+o*a+i*l-r*s,this._y=i*u+o*s+r*a-n*l,this._z=r*u+o*l+n*s-i*a,this._w=o*u-n*a-i*s-r*l,this._onChangeCallback(),this},v.prototype.slerp=function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,i=this._y,r=this._z,o=this._w,a=o*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;var s=1-a*a;if(s<=Number.EPSILON){var l=1-t;return this._w=l*o+t*this._w,this._x=l*n+t*this._x,this._y=l*i+t*this._y,this._z=l*r+t*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(s),c=Math.atan2(u,a),h=Math.sin((1-t)*c)/u,p=Math.sin(t*c)/u;return this._w=o*h+this._w*p,this._x=n*h+this._x*p,this._y=i*h+this._y*p,this._z=r*h+this._z*p,this._onChangeCallback(),this},v.prototype.equals=function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},v.prototype.fromArray=function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},v.prototype.toArray=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},v.prototype.fromBufferAttribute=function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this},v.prototype._onChange=function(e){return this._onChangeCallback=e,this},v.prototype._onChangeCallback=function(){},Object.defineProperties(v.prototype,y);var b=function(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),Object.defineProperty(this,"isVector3",{value:!0}),this.x=e,this.y=t,this.z=n};b.prototype.set=function(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this},b.prototype.setScalar=function(e){return this.x=e,this.y=e,this.z=e,this},b.prototype.setX=function(e){return this.x=e,this},b.prototype.setY=function(e){return this.y=e,this},b.prototype.setZ=function(e){return this.z=e,this},b.prototype.setComponent=function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},b.prototype.getComponent=function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},b.prototype.clone=function(){return new this.constructor(this.x,this.y,this.z)},b.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},b.prototype.add=function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},b.prototype.addScalar=function(e){return this.x+=e,this.y+=e,this.z+=e,this},b.prototype.addVectors=function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},b.prototype.addScaledVector=function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},b.prototype.sub=function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},b.prototype.subScalar=function(e){return this.x-=e,this.y-=e,this.z-=e,this},b.prototype.subVectors=function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},b.prototype.multiply=function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},b.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this},b.prototype.multiplyVectors=function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},b.prototype.applyEuler=function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(x.setFromEuler(e))},b.prototype.applyAxisAngle=function(e,t){return this.applyQuaternion(x.setFromAxisAngle(e,t))},b.prototype.applyMatrix3=function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this},b.prototype.applyNormalMatrix=function(e){return this.applyMatrix3(e).normalize()},b.prototype.applyMatrix4=function(e){var t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this},b.prototype.applyQuaternion=function(e){var t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*i-a*n,u=s*n+a*t-r*i,c=s*i+r*n-o*t,h=-r*t-o*n-a*i;return this.x=l*s+h*-r+u*-a-c*-o,this.y=u*s+h*-o+c*-r-l*-a,this.z=c*s+h*-a+l*-o-u*-r,this},b.prototype.project=function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},b.prototype.unproject=function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},b.prototype.transformDirection=function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()},b.prototype.divide=function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},b.prototype.divideScalar=function(e){return this.multiplyScalar(1/e)},b.prototype.min=function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},b.prototype.max=function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},b.prototype.clamp=function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},b.prototype.clampScalar=function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},b.prototype.clampLength=function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},b.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},b.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},b.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},b.prototype.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},b.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},b.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},b.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z},b.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},b.prototype.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},b.prototype.normalize=function(){return this.divideScalar(this.length()||1)},b.prototype.setLength=function(e){return this.normalize().multiplyScalar(e)},b.prototype.lerp=function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},b.prototype.lerpVectors=function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this},b.prototype.cross=function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},b.prototype.crossVectors=function(e,t){var n=e.x,i=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-r*a,this.y=r*o-n*s,this.z=n*a-i*o,this},b.prototype.projectOnVector=function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)},b.prototype.projectOnPlane=function(e){return _.copy(this).projectOnVector(e),this.sub(_)},b.prototype.reflect=function(e){return this.sub(_.copy(e).multiplyScalar(2*this.dot(e)))},b.prototype.angleTo=function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(o.clamp(n,-1,1))},b.prototype.distanceTo=function(e){return Math.sqrt(this.distanceToSquared(e))},b.prototype.distanceToSquared=function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i},b.prototype.manhattanDistanceTo=function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},b.prototype.setFromSpherical=function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},b.prototype.setFromSphericalCoords=function(e,t,n){var i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this},b.prototype.setFromCylindrical=function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},b.prototype.setFromCylindricalCoords=function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this},b.prototype.setFromMatrixPosition=function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},b.prototype.setFromMatrixScale=function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this},b.prototype.setFromMatrixColumn=function(e,t){return this.fromArray(e.elements,4*t)},b.prototype.setFromMatrix3Column=function(e,t){return this.fromArray(e.elements,3*t)},b.prototype.equals=function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},b.prototype.fromArray=function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},b.prototype.toArray=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},b.prototype.fromBufferAttribute=function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this},b.prototype.random=function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this};var _=new b,x=new v,E=function(e,t){Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==e?e:new b(1/0,1/0,1/0),this.max=void 0!==t?t:new b(-1/0,-1/0,-1/0)};function w(e,t,n,i,r){for(var o=0,a=e.length-3;o<=a;o+=3){B.fromArray(e,o);var s=r.x*Math.abs(B.x)+r.y*Math.abs(B.y)+r.z*Math.abs(B.z),l=t.dot(B),u=n.dot(B),c=i.dot(B);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>s)return!1}return!0}E.prototype.set=function(e,t){return this.min.copy(e),this.max.copy(t),this},E.prototype.setFromArray=function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,l=e.length;s<l;s+=3){var u=e[s],c=e[s+1],h=e[s+2];u<t&&(t=u),c<n&&(n=c),h<i&&(i=h),u>r&&(r=u),c>o&&(o=c),h>a&&(a=h)}return this.min.set(t,n,i),this.max.set(r,o,a),this},E.prototype.setFromBufferAttribute=function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,l=e.count;s<l;s++){var u=e.getX(s),c=e.getY(s),h=e.getZ(s);u<t&&(t=u),c<n&&(n=c),h<i&&(i=h),u>r&&(r=u),c>o&&(o=c),h>a&&(a=h)}return this.min.set(t,n,i),this.max.set(r,o,a),this},E.prototype.setFromPoints=function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},E.prototype.setFromCenterAndSize=function(e,t){var n=M.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},E.prototype.setFromObject=function(e){return this.makeEmpty(),this.expandByObject(e)},E.prototype.clone=function(){return(new this.constructor).copy(this)},E.prototype.copy=function(e){return this.min.copy(e.min),this.max.copy(e.max),this},E.prototype.makeEmpty=function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},E.prototype.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},E.prototype.getCenter=function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new b),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},E.prototype.getSize=function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new b),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},E.prototype.expandByPoint=function(e){return this.min.min(e),this.max.max(e),this},E.prototype.expandByVector=function(e){return this.min.sub(e),this.max.add(e),this},E.prototype.expandByScalar=function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},E.prototype.expandByObject=function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),S.copy(t.boundingBox),S.applyMatrix4(e.matrixWorld),this.union(S));for(var n=e.children,i=0,r=n.length;i<r;i++)this.expandByObject(n[i]);return this},E.prototype.containsPoint=function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},E.prototype.containsBox=function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},E.prototype.getParameter=function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new b),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},E.prototype.intersectsBox=function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},E.prototype.intersectsSphere=function(e){return this.clampPoint(e.center,M),M.distanceToSquared(e.center)<=e.radius*e.radius},E.prototype.intersectsPlane=function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant},E.prototype.intersectsTriangle=function(e){if(this.isEmpty())return!1;this.getCenter(j),O.subVectors(this.max,j),C.subVectors(e.a,j),A.subVectors(e.b,j),R.subVectors(e.c,j),P.subVectors(A,C),D.subVectors(R,A),k.subVectors(C,R);var t=[0,-P.z,P.y,0,-D.z,D.y,0,-k.z,k.y,P.z,0,-P.x,D.z,0,-D.x,k.z,0,-k.x,-P.y,P.x,0,-D.y,D.x,0,-k.y,k.x,0];return!!w(t,C,A,R,O)&&(!!w(t=[1,0,0,0,1,0,0,0,1],C,A,R,O)&&(F.crossVectors(P,D),w(t=[F.x,F.y,F.z],C,A,R,O)))},E.prototype.clampPoint=function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new b),t.copy(e).clamp(this.min,this.max)},E.prototype.distanceToPoint=function(e){return M.copy(e).clamp(this.min,this.max).sub(e).length()},E.prototype.getBoundingSphere=function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(M).length(),e},E.prototype.intersect=function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},E.prototype.union=function(e){return this.min.min(e.min),this.max.max(e.max),this},E.prototype.applyMatrix4=function(e){return this.isEmpty()||(T[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),T[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),T[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),T[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),T[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),T[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),T[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),T[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(T)),this},E.prototype.translate=function(e){return this.min.add(e),this.max.add(e),this},E.prototype.equals=function(e){return e.min.equals(this.min)&&e.max.equals(this.max)};var T=[new b,new b,new b,new b,new b,new b,new b,new b],M=new b,S=new E,C=new b,A=new b,R=new b,P=new b,D=new b,k=new b,j=new b,O=new b,F=new b,B=new b,L=new E,I=function(e,t){this.center=void 0!==e?e:new b,this.radius=void 0!==t?t:-1};I.prototype.set=function(e,t){return this.center.copy(e),this.radius=t,this},I.prototype.setFromPoints=function(e,t){var n=this.center;void 0!==t?n.copy(t):L.setFromPoints(e).getCenter(n);for(var i=0,r=0,o=e.length;r<o;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this},I.prototype.clone=function(){return(new this.constructor).copy(this)},I.prototype.copy=function(e){return this.center.copy(e.center),this.radius=e.radius,this},I.prototype.isEmpty=function(){return this.radius<0},I.prototype.makeEmpty=function(){return this.center.set(0,0,0),this.radius=-1,this},I.prototype.containsPoint=function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},I.prototype.distanceToPoint=function(e){return e.distanceTo(this.center)-this.radius},I.prototype.intersectsSphere=function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},I.prototype.intersectsBox=function(e){return e.intersectsSphere(this)},I.prototype.intersectsPlane=function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},I.prototype.clampPoint=function(e,t){var n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new b),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},I.prototype.getBoundingBox=function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new E),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)},I.prototype.applyMatrix4=function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},I.prototype.translate=function(e){return this.center.add(e),this},I.prototype.equals=function(e){return e.center.equals(this.center)&&e.radius===this.radius};var N=new b,H=new b,z=new b,U=new b,V=new b,q=new b,G=new b,W=function(e,t){this.origin=void 0!==e?e:new b,this.direction=void 0!==t?t:new b(0,0,-1)};W.prototype.set=function(e,t){return this.origin.copy(e),this.direction.copy(t),this},W.prototype.clone=function(){return(new this.constructor).copy(this)},W.prototype.copy=function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},W.prototype.at=function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new b),t.copy(this.direction).multiplyScalar(e).add(this.origin)},W.prototype.lookAt=function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},W.prototype.recast=function(e){return this.origin.copy(this.at(e,N)),this},W.prototype.closestPointToPoint=function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new b),t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)},W.prototype.distanceToPoint=function(e){return Math.sqrt(this.distanceSqToPoint(e))},W.prototype.distanceSqToPoint=function(e){var t=N.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(N.copy(this.direction).multiplyScalar(t).add(this.origin),N.distanceToSquared(e))},W.prototype.distanceSqToSegment=function(e,t,n,i){H.copy(e).add(t).multiplyScalar(.5),z.copy(t).sub(e).normalize(),U.copy(this.origin).sub(H);var r,o,a,s,l=.5*e.distanceTo(t),u=-this.direction.dot(z),c=U.dot(this.direction),h=-U.dot(z),p=U.lengthSq(),d=Math.abs(1-u*u);if(d>0)if(o=u*c-h,s=l*d,(r=u*h-c)>=0)if(o>=-s)if(o<=s){var f=1/d;a=(r*=f)*(r+u*(o*=f)+2*c)+o*(u*r+o+2*h)+p}else o=l,a=-(r=Math.max(0,-(u*o+c)))*r+o*(o+2*h)+p;else o=-l,a=-(r=Math.max(0,-(u*o+c)))*r+o*(o+2*h)+p;else o<=-s?a=-(r=Math.max(0,-(-u*l+c)))*r+(o=r>0?-l:Math.min(Math.max(-l,-h),l))*(o+2*h)+p:o<=s?(r=0,a=(o=Math.min(Math.max(-l,-h),l))*(o+2*h)+p):a=-(r=Math.max(0,-(u*l+c)))*r+(o=r>0?l:Math.min(Math.max(-l,-h),l))*(o+2*h)+p;else o=u>0?-l:l,a=-(r=Math.max(0,-(u*o+c)))*r+o*(o+2*h)+p;return n&&n.copy(this.direction).multiplyScalar(r).add(this.origin),i&&i.copy(z).multiplyScalar(o).add(H),a},W.prototype.intersectSphere=function(e,t){N.subVectors(e.center,this.origin);var n=N.dot(this.direction),i=N.dot(N)-n*n,r=e.radius*e.radius;if(i>r)return null;var o=Math.sqrt(r-i),a=n-o,s=n+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)},W.prototype.intersectsSphere=function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},W.prototype.distanceToPlane=function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},W.prototype.intersectPlane=function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},W.prototype.intersectsPlane=function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},W.prototype.intersectBox=function(e,t){var n,i,r,o,a,s,l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),u>=0?(r=(e.min.y-h.y)*u,o=(e.max.y-h.y)*u):(r=(e.max.y-h.y)*u,o=(e.min.y-h.y)*u),n>o||r>i?null:((r>n||n!=n)&&(n=r),(o<i||i!=i)&&(i=o),c>=0?(a=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(a=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),n>s||a>i?null:((a>n||n!=n)&&(n=a),(s<i||i!=i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))},W.prototype.intersectsBox=function(e){return null!==this.intersectBox(e,N)},W.prototype.intersectTriangle=function(e,t,n,i,r){V.subVectors(t,e),q.subVectors(n,e),G.crossVectors(V,q);var o,a=this.direction.dot(G);if(a>0){if(i)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}U.subVectors(this.origin,e);var s=o*this.direction.dot(q.crossVectors(U,q));if(s<0)return null;var l=o*this.direction.dot(V.cross(U));if(l<0)return null;if(s+l>a)return null;var u=-o*U.dot(G);return u<0?null:this.at(u/a,r)},W.prototype.applyMatrix4=function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},W.prototype.equals=function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)};var X=function(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")};X.prototype.set=function(e,t,n,i,r,o,a,s,l,u,c,h,p,d,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},X.prototype.identity=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},X.prototype.clone=function(){return(new X).fromArray(this.elements)},X.prototype.copy=function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},X.prototype.copyPosition=function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},X.prototype.extractBasis=function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},X.prototype.makeBasis=function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},X.prototype.extractRotation=function(e){var t=this.elements,n=e.elements,i=1/J.setFromMatrixColumn(e,0).length(),r=1/J.setFromMatrixColumn(e,1).length(),o=1/J.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},X.prototype.makeRotationFromEuler=function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(i),l=Math.sin(i),u=Math.cos(r),c=Math.sin(r);if("XYZ"===e.order){var h=o*u,p=o*c,d=a*u,f=a*c;t[0]=s*u,t[4]=-s*c,t[8]=l,t[1]=p+d*l,t[5]=h-f*l,t[9]=-a*s,t[2]=f-h*l,t[6]=d+p*l,t[10]=o*s}else if("YXZ"===e.order){var m=s*u,g=s*c,v=l*u,y=l*c;t[0]=m+y*a,t[4]=v*a-g,t[8]=o*l,t[1]=o*c,t[5]=o*u,t[9]=-a,t[2]=g*a-v,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order){var b=s*u,_=s*c,x=l*u,E=l*c;t[0]=b-E*a,t[4]=-o*c,t[8]=x+_*a,t[1]=_+x*a,t[5]=o*u,t[9]=E-b*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){var w=o*u,T=o*c,M=a*u,S=a*c;t[0]=s*u,t[4]=M*l-T,t[8]=w*l+S,t[1]=s*c,t[5]=S*l+w,t[9]=T*l-M,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var C=o*s,A=o*l,R=a*s,P=a*l;t[0]=s*u,t[4]=P-C*c,t[8]=R*c+A,t[1]=c,t[5]=o*u,t[9]=-a*u,t[2]=-l*u,t[6]=A*c+R,t[10]=C-P*c}else if("XZY"===e.order){var D=o*s,k=o*l,j=a*s,O=a*l;t[0]=s*u,t[4]=-c,t[8]=l*u,t[1]=D*c+O,t[5]=o*u,t[9]=k*c-j,t[2]=j*c-k,t[6]=a*u,t[10]=O*c+D}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},X.prototype.makeRotationFromQuaternion=function(e){return this.compose(Q,e,Z)},X.prototype.lookAt=function(e,t,n){var i=this.elements;return ee.subVectors(e,t),0===ee.lengthSq()&&(ee.z=1),ee.normalize(),K.crossVectors(n,ee),0===K.lengthSq()&&(1===Math.abs(n.z)?ee.x+=1e-4:ee.z+=1e-4,ee.normalize(),K.crossVectors(n,ee)),K.normalize(),$.crossVectors(ee,K),i[0]=K.x,i[4]=$.x,i[8]=ee.x,i[1]=K.y,i[5]=$.y,i[9]=ee.y,i[2]=K.z,i[6]=$.z,i[10]=ee.z,this},X.prototype.multiply=function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},X.prototype.premultiply=function(e){return this.multiplyMatrices(e,this)},X.prototype.multiplyMatrices=function(e,t){var n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],u=n[1],c=n[5],h=n[9],p=n[13],d=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],_=n[15],x=i[0],E=i[4],w=i[8],T=i[12],M=i[1],S=i[5],C=i[9],A=i[13],R=i[2],P=i[6],D=i[10],k=i[14],j=i[3],O=i[7],F=i[11],B=i[15];return r[0]=o*x+a*M+s*R+l*j,r[4]=o*E+a*S+s*P+l*O,r[8]=o*w+a*C+s*D+l*F,r[12]=o*T+a*A+s*k+l*B,r[1]=u*x+c*M+h*R+p*j,r[5]=u*E+c*S+h*P+p*O,r[9]=u*w+c*C+h*D+p*F,r[13]=u*T+c*A+h*k+p*B,r[2]=d*x+f*M+m*R+g*j,r[6]=d*E+f*S+m*P+g*O,r[10]=d*w+f*C+m*D+g*F,r[14]=d*T+f*A+m*k+g*B,r[3]=v*x+y*M+b*R+_*j,r[7]=v*E+y*S+b*P+_*O,r[11]=v*w+y*C+b*D+_*F,r[15]=v*T+y*A+b*k+_*B,this},X.prototype.multiplyScalar=function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},X.prototype.determinant=function(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],a=e[5],s=e[9],l=e[13],u=e[2],c=e[6],h=e[10],p=e[14];return e[3]*(+r*s*c-i*l*c-r*a*h+n*l*h+i*a*p-n*s*p)+e[7]*(+t*s*p-t*l*h+r*o*h-i*o*p+i*l*u-r*s*u)+e[11]*(+t*l*c-t*a*p-r*o*c+n*o*p+r*a*u-n*l*u)+e[15]*(-i*a*u-t*s*c+t*a*h+i*o*c-n*o*h+n*s*u)},X.prototype.transpose=function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},X.prototype.setPosition=function(e,t,n){var i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this},X.prototype.getInverse=function(e,t){void 0!==t&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");var n=this.elements,i=e.elements,r=i[0],o=i[1],a=i[2],s=i[3],l=i[4],u=i[5],c=i[6],h=i[7],p=i[8],d=i[9],f=i[10],m=i[11],g=i[12],v=i[13],y=i[14],b=i[15],_=d*y*h-v*f*h+v*c*m-u*y*m-d*c*b+u*f*b,x=g*f*h-p*y*h-g*c*m+l*y*m+p*c*b-l*f*b,E=p*v*h-g*d*h+g*u*m-l*v*m-p*u*b+l*d*b,w=g*d*c-p*v*c-g*u*f+l*v*f+p*u*y-l*d*y,T=r*_+o*x+a*E+s*w;if(0===T)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var M=1/T;return n[0]=_*M,n[1]=(v*f*s-d*y*s-v*a*m+o*y*m+d*a*b-o*f*b)*M,n[2]=(u*y*s-v*c*s+v*a*h-o*y*h-u*a*b+o*c*b)*M,n[3]=(d*c*s-u*f*s-d*a*h+o*f*h+u*a*m-o*c*m)*M,n[4]=x*M,n[5]=(p*y*s-g*f*s+g*a*m-r*y*m-p*a*b+r*f*b)*M,n[6]=(g*c*s-l*y*s-g*a*h+r*y*h+l*a*b-r*c*b)*M,n[7]=(l*f*s-p*c*s+p*a*h-r*f*h-l*a*m+r*c*m)*M,n[8]=E*M,n[9]=(g*d*s-p*v*s-g*o*m+r*v*m+p*o*b-r*d*b)*M,n[10]=(l*v*s-g*u*s+g*o*h-r*v*h-l*o*b+r*u*b)*M,n[11]=(p*u*s-l*d*s-p*o*h+r*d*h+l*o*m-r*u*m)*M,n[12]=w*M,n[13]=(p*v*a-g*d*a+g*o*f-r*v*f-p*o*y+r*d*y)*M,n[14]=(g*u*a-l*v*a-g*o*c+r*v*c+l*o*y-r*u*y)*M,n[15]=(l*d*a-p*u*a+p*o*c-r*d*c-l*o*f+r*u*f)*M,this},X.prototype.scale=function(e){var t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this},X.prototype.getMaxScaleOnAxis=function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))},X.prototype.makeTranslation=function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},X.prototype.makeRotationX=function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},X.prototype.makeRotationY=function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},X.prototype.makeRotationZ=function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},X.prototype.makeRotationAxis=function(e,t){var n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,a=e.y,s=e.z,l=r*o,u=r*a;return this.set(l*o+n,l*a-i*s,l*s+i*a,0,l*a+i*s,u*a+n,u*s-i*o,0,l*s-i*a,u*s+i*o,r*s*s+n,0,0,0,0,1),this},X.prototype.makeScale=function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},X.prototype.makeShear=function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},X.prototype.compose=function(e,t,n){var i=this.elements,r=t._x,o=t._y,a=t._z,s=t._w,l=r+r,u=o+o,c=a+a,h=r*l,p=r*u,d=r*c,f=o*u,m=o*c,g=a*c,v=s*l,y=s*u,b=s*c,_=n.x,x=n.y,E=n.z;return i[0]=(1-(f+g))*_,i[1]=(p+b)*_,i[2]=(d-y)*_,i[3]=0,i[4]=(p-b)*x,i[5]=(1-(h+g))*x,i[6]=(m+v)*x,i[7]=0,i[8]=(d+y)*E,i[9]=(m-v)*E,i[10]=(1-(h+f))*E,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this},X.prototype.decompose=function(e,t,n){var i=this.elements,r=J.set(i[0],i[1],i[2]).length(),o=J.set(i[4],i[5],i[6]).length(),a=J.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],Y.copy(this);var s=1/r,l=1/o,u=1/a;return Y.elements[0]*=s,Y.elements[1]*=s,Y.elements[2]*=s,Y.elements[4]*=l,Y.elements[5]*=l,Y.elements[6]*=l,Y.elements[8]*=u,Y.elements[9]*=u,Y.elements[10]*=u,t.setFromRotationMatrix(Y),n.x=r,n.y=o,n.z=a,this},X.prototype.makePerspective=function(e,t,n,i,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*r/(t-e),l=2*r/(n-i),u=(t+e)/(t-e),c=(n+i)/(n-i),h=-(o+r)/(o-r),p=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},X.prototype.makeOrthographic=function(e,t,n,i,r,o){var a=this.elements,s=1/(t-e),l=1/(n-i),u=1/(o-r),c=(t+e)*s,h=(n+i)*l,p=(o+r)*u;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},X.prototype.equals=function(e){for(var t=this.elements,n=e.elements,i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0},X.prototype.fromArray=function(e,t){void 0===t&&(t=0);for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this},X.prototype.toArray=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e};var J=new b,Y=new X,Q=new b(0,0,0),Z=new b(1,1,1),K=new b,$=new b,ee=new b,te=function e(t,n,i,r){void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=e.DefaultOrder),Object.defineProperty(this,"isEuler",{value:!0}),this._x=t,this._y=n,this._z=i,this._order=r},ne={x:{configurable:!0},y:{configurable:!0},z:{configurable:!0},order:{configurable:!0}};ne.x.get=function(){return this._x},ne.x.set=function(e){this._x=e,this._onChangeCallback()},ne.y.get=function(){return this._y},ne.y.set=function(e){this._y=e,this._onChangeCallback()},ne.z.get=function(){return this._z},ne.z.set=function(e){this._z=e,this._onChangeCallback()},ne.order.get=function(){return this._order},ne.order.set=function(e){this._order=e,this._onChangeCallback()},te.prototype.set=function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this._onChangeCallback(),this},te.prototype.clone=function(){return new this.constructor(this._x,this._y,this._z,this._order)},te.prototype.copy=function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},te.prototype.setFromRotationMatrix=function(e,t,n){var i=o.clamp,r=e.elements,a=r[0],s=r[4],l=r[8],u=r[1],c=r[5],h=r[9],p=r[2],d=r[6],f=r[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(i(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,f),this._z=Math.atan2(-s,a)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-i(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(l,f),this._z=Math.atan2(u,c)):(this._y=Math.atan2(-p,a),this._z=0);break;case"ZXY":this._x=Math.asin(i(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-p,f),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(u,a));break;case"ZYX":this._y=Math.asin(-i(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(u,a)):(this._x=0,this._z=Math.atan2(-s,c));break;case"YZX":this._z=Math.asin(i(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-p,a)):(this._x=0,this._y=Math.atan2(l,f));break;case"XZY":this._z=Math.asin(-i(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(l,a)):(this._x=Math.atan2(-h,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==n&&this._onChangeCallback(),this},te.prototype.setFromQuaternion=function(e,t,n){return ie.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ie,t,n)},te.prototype.setFromVector3=function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},te.prototype.reorder=function(e){return re.setFromEuler(this),this.setFromQuaternion(re,e)},te.prototype.equals=function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},te.prototype.fromArray=function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},te.prototype.toArray=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},te.prototype.toVector3=function(e){return e?e.set(this._x,this._y,this._z):new b(this._x,this._y,this._z)},te.prototype._onChange=function(e){return this._onChangeCallback=e,this},te.prototype._onChangeCallback=function(){},Object.defineProperties(te.prototype,ne),te.DefaultOrder="XYZ",te.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var ie=new X,re=new v,oe=function(){this.mask=1};oe.prototype.set=function(e){this.mask=1<<e|0},oe.prototype.enable=function(e){this.mask|=1<<e|0},oe.prototype.enableAll=function(){this.mask=-1},oe.prototype.toggle=function(e){this.mask^=1<<e|0},oe.prototype.disable=function(e){this.mask&=~(1<<e|0)},oe.prototype.disableAll=function(){this.mask=0},oe.prototype.test=function(e){return 0!=(this.mask&e.mask)};var ae=0,se=new b,le=new v,ue=new X,ce=new b,he=new b,pe=new b,de=new v,fe=new b(1,0,0),me=new b(0,1,0),ge=new b(0,0,1),ve={type:"added"},ye={type:"removed"};function be(){Object.defineProperty(this,"id",{value:ae++}),this.uuid=o.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=be.DefaultUp.clone();var e=new b,t=new te,n=new v,i=new b(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new X},normalMatrix:{value:new u}}),this.matrix=new X,this.matrixWorld=new X,this.matrixAutoUpdate=be.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixNeedsUpdate=!0,this.layers=new oe,this.visible=!0,this.renderLayer=null,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}be.DefaultUp=new b(0,1,0),be.DefaultMatrixAutoUpdate=!0,be.prototype=Object.assign(Object.create(t.prototype),{constructor:be,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){(this.matrixAutoUpdate||this.matrixNeedsUpdate)&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return le.setFromAxisAngle(e,t),this.quaternion.multiply(le),this},rotateOnWorldAxis:function(e,t){return le.setFromAxisAngle(e,t),this.quaternion.premultiply(le),this},rotateX:function(e){return this.rotateOnAxis(fe,e)},rotateY:function(e){return this.rotateOnAxis(me,e)},rotateZ:function(e){return this.rotateOnAxis(ge,e)},translateOnAxis:function(e,t){return se.copy(e).applyQuaternion(this.quaternion),this.position.add(se.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(fe,e)},translateY:function(e){return this.translateOnAxis(me,e)},translateZ:function(e){return this.translateOnAxis(ge,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(ue.getInverse(this.matrixWorld))},lookAt:function(e,t,n){e.isVector3?ce.copy(e):ce.set(e,t,n);var i=this.parent;this.updateWorldMatrix(!0,!1),he.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ue.lookAt(he,ce,this.up):ue.lookAt(ce,he,this.up),this.quaternion.setFromRotationMatrix(ue),i&&(ue.extractRotation(i.matrixWorld),le.setFromRotationMatrix(ue),this.quaternion.premultiply(le.inverse()))},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(ve),this.dispatchEvent({type:"addedChild",object:e})):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(ye)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),ue.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),ue.multiply(e.parent.matrixWorld)),e.applyMatrix4(ue),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,i=this.children.length;n<i;n++){var r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new b),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new v),this.updateMatrixWorld(!0),this.matrixWorld.decompose(he,e,pe),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new b),this.updateMatrixWorld(!0),this.matrixWorld.decompose(he,de,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new b),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0,this.matrixNeedsUpdate=!1},updateMatrixWorld:function(e){(this.matrixAutoUpdate||this.matrixNeedsUpdate)&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),(this.matrixAutoUpdate||this.matrixNeedsUpdate)&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var i=this.children,r=0,o=i.length;r<o;r++)i[r].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,l=a.length;s<l;s++){var u=a[s];r(e.shapes,u)}else r(e.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){for(var c=[],h=0,p=this.material.length;h<p;h++)c.push(r(e.materials,this.material[h]));i.material=c}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(var d=0;d<this.children.length;d++)i.children.push(this.children[d].toJSON(e).object)}if(t){var f=b(e.geometries),m=b(e.materials),g=b(e.textures),v=b(e.images),y=b(e.shapes);f.length>0&&(n.geometries=f),m.length>0&&(n.materials=m),g.length>0&&(n.textures=g),v.length>0&&(n.images=v),y.length>0&&(n.shapes=y)}return n.object=i,n;function b(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var i=e.children[n];this.add(i.clone())}return this}});var _e=new b,xe=new b,Ee=new u,we=function(e,t){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==e?e:new b(1,0,0),this.constant=void 0!==t?t:0};we.prototype.set=function(e,t){return this.normal.copy(e),this.constant=t,this},we.prototype.setComponents=function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this},we.prototype.setFromNormalAndCoplanarPoint=function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},we.prototype.setFromCoplanarPoints=function(e,t,n){var i=_e.subVectors(n,t).cross(xe.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this},we.prototype.clone=function(){return(new this.constructor).copy(this)},we.prototype.copy=function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},we.prototype.normalize=function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},we.prototype.negate=function(){return this.constant*=-1,this.normal.negate(),this},we.prototype.distanceToPoint=function(e){return this.normal.dot(e)+this.constant},we.prototype.distanceToSphere=function(e){return this.distanceToPoint(e.center)-e.radius},we.prototype.projectPoint=function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new b),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},we.prototype.intersectLine=function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new b);var n=e.delta(_e),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;var r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?void 0:t.copy(n).multiplyScalar(r).add(e.start)},we.prototype.intersectsLine=function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},we.prototype.intersectsBox=function(e){return e.intersectsPlane(this)},we.prototype.intersectsSphere=function(e){return e.intersectsPlane(this)},we.prototype.coplanarPoint=function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new b),e.copy(this.normal).multiplyScalar(-this.constant)},we.prototype.applyMatrix4=function(e,t){var n=t||Ee.getNormalMatrix(e),i=this.coplanarPoint(_e).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this},we.prototype.translate=function(e){return this.constant-=e.dot(this.normal),this},we.prototype.equals=function(e){return e.normal.equals(this.normal)&&e.constant===this.constant};var Te=new b,Me=new b,Se=new b,Ce=new b,Ae=new b,Re=new b,Pe=new b,De=new b,ke=new b,je=new b,Oe=function(e,t,n){this.a=void 0!==e?e:new b,this.b=void 0!==t?t:new b,this.c=void 0!==n?n:new b};Oe.getNormal=function(e,t,n,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new b),i.subVectors(n,t),Te.subVectors(e,t),i.cross(Te);var r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)},Oe.getBarycoord=function(e,t,n,i,r){Te.subVectors(i,t),Me.subVectors(n,t),Se.subVectors(e,t);var o=Te.dot(Te),a=Te.dot(Me),s=Te.dot(Se),l=Me.dot(Me),u=Me.dot(Se),c=o*l-a*a;if(void 0===r&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new b),0===c)return r.set(-2,-1,-1);var h=1/c,p=(l*s-a*u)*h,d=(o*u-a*s)*h;return r.set(1-p-d,d,p)},Oe.containsPoint=function(e,t,n,i){return this.getBarycoord(e,t,n,i,Ce),Ce.x>=0&&Ce.y>=0&&Ce.x+Ce.y<=1},Oe.getUV=function(e,t,n,i,r,o,a,s){return this.getBarycoord(e,t,n,i,Ce),s.set(0,0),s.addScaledVector(r,Ce.x),s.addScaledVector(o,Ce.y),s.addScaledVector(a,Ce.z),s},Oe.isFrontFacing=function(e,t,n,i){return Te.subVectors(n,t),Me.subVectors(e,t),Te.cross(Me).dot(i)<0},Oe.prototype.set=function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},Oe.prototype.setFromPointsAndIndices=function(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this},Oe.prototype.clone=function(){return(new this.constructor).copy(this)},Oe.prototype.copy=function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},Oe.prototype.getArea=function(){return Te.subVectors(this.c,this.b),Me.subVectors(this.a,this.b),.5*Te.cross(Me).length()},Oe.prototype.getMidpoint=function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new b),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},Oe.prototype.getNormal=function(e){return Oe.getNormal(this.a,this.b,this.c,e)},Oe.prototype.getPlane=function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new we),e.setFromCoplanarPoints(this.a,this.b,this.c)},Oe.prototype.getBarycoord=function(e,t){return Oe.getBarycoord(e,this.a,this.b,this.c,t)},Oe.prototype.getUV=function(e,t,n,i,r){return Oe.getUV(e,this.a,this.b,this.c,t,n,i,r)},Oe.prototype.containsPoint=function(e){return Oe.containsPoint(e,this.a,this.b,this.c)},Oe.prototype.isFrontFacing=function(e){return Oe.isFrontFacing(this.a,this.b,this.c,e)},Oe.prototype.intersectsBox=function(e){return e.intersectsTriangle(this)},Oe.prototype.closestPointToPoint=function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new b);var n,i,r=this.a,o=this.b,a=this.c;Ae.subVectors(o,r),Re.subVectors(a,r),De.subVectors(e,r);var s=Ae.dot(De),l=Re.dot(De);if(s<=0&&l<=0)return t.copy(r);ke.subVectors(e,o);var u=Ae.dot(ke),c=Re.dot(ke);if(u>=0&&c<=u)return t.copy(o);var h=s*c-u*l;if(h<=0&&s>=0&&u<=0)return n=s/(s-u),t.copy(r).addScaledVector(Ae,n);je.subVectors(e,a);var p=Ae.dot(je),d=Re.dot(je);if(d>=0&&p<=d)return t.copy(a);var f=p*l-s*d;if(f<=0&&l>=0&&d<=0)return i=l/(l-d),t.copy(r).addScaledVector(Re,i);var m=u*d-p*c;if(m<=0&&c-u>=0&&p-d>=0)return Pe.subVectors(a,o),i=(c-u)/(c-u+(p-d)),t.copy(o).addScaledVector(Pe,i);var g=1/(m+f+h);return n=f*g,i=h*g,t.copy(r).addScaledVector(Ae,n).addScaledVector(Re,i)},Oe.prototype.equals=function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)};var Fe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Be={h:0,s:0,l:0},Le={h:0,s:0,l:0};function Ie(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Ne(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function He(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var ze=function(e,t,n){return Object.defineProperty(this,"isColor",{value:!0}),void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)};ze.prototype.set=function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},ze.prototype.setScalar=function(e){return this.r=e,this.g=e,this.b=e,this},ze.prototype.setHex=function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},ze.prototype.setRGB=function(e,t,n){return this.r=e,this.g=t,this.b=n,this},ze.prototype.setHSL=function(e,t,n){if(e=o.euclideanModulo(e,1),t=o.clamp(t,0,1),n=o.clamp(n,0,1),0===t)this.r=this.g=this.b=n;else{var i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=Ie(r,i,e+1/3),this.g=Ie(r,i,e),this.b=Ie(r,i,e-1/3)}return this},ze.prototype.setStyle=function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var i,r=n[1],o=n[2];switch(r){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(i[1])/360,s=parseInt(i[2],10)/100,l=parseInt(i[3],10)/100;return t(i[5]),this.setHSL(a,s,l)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(e)){var u=n[1],c=u.length;if(3===c)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this},ze.prototype.setColorName=function(e){var t=Fe[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this},ze.prototype.clone=function(){return new this.constructor(this.r,this.g,this.b)},ze.prototype.copy=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},ze.prototype.copyGammaToLinear=function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},ze.prototype.copyLinearToGamma=function(e,t){void 0===t&&(t=2);var n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},ze.prototype.convertGammaToLinear=function(e){return this.copyGammaToLinear(this,e),this},ze.prototype.convertLinearToGamma=function(e){return this.copyLinearToGamma(this,e),this},ze.prototype.copySRGBToLinear=function(e){return this.r=Ne(e.r),this.g=Ne(e.g),this.b=Ne(e.b),this},ze.prototype.copyLinearToSRGB=function(e){return this.r=He(e.r),this.g=He(e.g),this.b=He(e.b),this},ze.prototype.convertSRGBToLinear=function(){return this.copySRGBToLinear(this),this},ze.prototype.convertLinearToSRGB=function(){return this.copyLinearToSRGB(this),this},ze.prototype.getHex=function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},ze.prototype.getHexString=function(){return("000000"+this.getHex().toString(16)).slice(-6)},ze.prototype.getHSL=function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,n,i=this.r,r=this.g,o=this.b,a=Math.max(i,r,o),s=Math.min(i,r,o),l=(s+a)/2;if(s===a)t=0,n=0;else{var u=a-s;switch(n=l<=.5?u/(a+s):u/(2-a-s),a){case i:t=(r-o)/u+(r<o?6:0);break;case r:t=(o-i)/u+2;break;case o:t=(i-r)/u+4}t/=6}return e.h=t,e.s=n,e.l=l,e},ze.prototype.getStyle=function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},ze.prototype.offsetHSL=function(e,t,n){return this.getHSL(Be),Be.h+=e,Be.s+=t,Be.l+=n,this.setHSL(Be.h,Be.s,Be.l),this},ze.prototype.add=function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},ze.prototype.addColors=function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},ze.prototype.addScalar=function(e){return this.r+=e,this.g+=e,this.b+=e,this},ze.prototype.sub=function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},ze.prototype.multiply=function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},ze.prototype.multiplyScalar=function(e){return this.r*=e,this.g*=e,this.b*=e,this},ze.prototype.lerp=function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},ze.prototype.lerpHSL=function(e,t){this.getHSL(Be),e.getHSL(Le);var n=o.lerp(Be.h,Le.h,t),i=o.lerp(Be.s,Le.s,t),r=o.lerp(Be.l,Le.l,t);return this.setHSL(n,i,r),this},ze.prototype.equals=function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},ze.prototype.fromArray=function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},ze.prototype.toArray=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},ze.prototype.fromBufferAttribute=function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this},ze.prototype.toJSON=function(){return this.getHex()},ze.NAMES=Fe,ze.prototype.r=1,ze.prototype.g=1,ze.prototype.b=1;var Ue=function(e,t,n,i,r,o){this.a=e,this.b=t,this.c=n,this.normal=i&&i.isVector3?i:new b,this.vertexNormals=Array.isArray(i)?i:[],this.color=r&&r.isColor?r:new ze,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==o?o:0};Ue.prototype.clone=function(){return(new this.constructor).copy(this)},Ue.prototype.copy=function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var i=0,r=e.vertexColors.length;i<r;i++)this.vertexColors[i]=e.vertexColors[i].clone();return this};var Ve=0;function qe(){Object.defineProperty(this,"id",{value:Ve++}),this.uuid=o.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.stencilFuncBack=null,this.stencilRefBack=null,this.stencilFuncMaskBack=null,this.stencilFailBack=null,this.stencilZFailBack=null,this.stencilZPassBack=null,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.colorMapping=null,this.baseQuaternion=null,this.uvTransform=null,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function Ge(e){qe.call(this),this.type="MeshBasicMaterial",this.color=new ze(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}qe.prototype=Object.assign(Object.create(t.prototype),{constructor:qe,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,n.stencilFuncBack=this.stencilFuncBack,n.stencilRefBack=this.stencilRefBack,n.stencilFuncMaskBack=this.stencilFuncMaskBack,n.stencilFailBack=this.stencilFailBack,n.stencilZFailBack=this.stencilZFailBack,n.stencilZPassBack=this.stencilZPassBack,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var r=i(e.textures),o=i(e.images);r.length>0&&(n.textures=r),o.length>0&&(n.images=o)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite,this.stencilFuncBack=e.stencilFuncBack,this.stencilRefBack=e.stencilRefBack,this.stencilFuncMaskBack=e.stencilFuncMaskBack,this.stencilFailBack=e.stencilFailBack,this.stencilZFailBack=e.stencilZFailBack,this.stencilZPassBack=e.stencilZPassBack;var t=e.clippingPlanes,n=null;if(null!==t){var i=t.length;n=new Array(i);for(var r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this.colorMapping=e.colorMapping,e.baseQuaternion?this.baseQuaternion=e.baseQuaternion.clone():this.baseQuaternion=null,e.uvTransform?this.uvTransform=e.uvTransform:this.uvTransform=null,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(qe.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Ge.prototype=Object.create(qe.prototype),Ge.prototype.constructor=Ge,Ge.prototype.isMeshBasicMaterial=!0,Ge.prototype.copy=function(e){return qe.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};var We=new b,Xe=new a;function Je(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.resizeDirty=!1,this.version=0}function Ye(e,t,n){Je.call(this,new Int8Array(e),t,n)}function Qe(e,t,n){Je.call(this,new Uint8Array(e),t,n)}function Ze(e,t,n){Je.call(this,new Uint8ClampedArray(e),t,n)}function Ke(e,t,n){Je.call(this,new Int16Array(e),t,n)}function $e(e,t,n){Je.call(this,new Uint16Array(e),t,n)}function et(e,t,n){Je.call(this,new Int32Array(e),t,n)}function tt(e,t,n){Je.call(this,new Uint32Array(e),t,n)}function nt(e,t,n){Je.call(this,new Float32Array(e),t,n)}function it(e,t,n){Je.call(this,new Float64Array(e),t,n)}Object.defineProperty(Je.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Je.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),o=new ze),t[n++]=o.r,t[n++]=o.g,t[n++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),o=new a),t[n++]=o.x,t[n++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),o=new b),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),o=new d),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z,t[n++]=o.w}return this},applyMatrix3:function(e){if(2===this.itemSize)for(var t=0,n=this.count;t<n;t++)Xe.fromBufferAttribute(this,t),Xe.applyMatrix3(e),this.setXY(t,Xe.x,Xe.y);else if(3===this.itemSize)for(var i=0,r=this.count;i<r;i++)We.fromBufferAttribute(this,i),We.applyMatrix3(e),this.setXYZ(i,We.x,We.y,We.z);return this},applyMatrix4:function(e){for(var t=0,n=this.count;t<n;t++)We.x=this.getX(t),We.y=this.getY(t),We.z=this.getZ(t),We.applyMatrix4(e),this.setXYZ(t,We.x,We.y,We.z);return this},applyNormalMatrix:function(e){for(var t=0,n=this.count;t<n;t++)We.x=this.getX(t),We.y=this.getY(t),We.z=this.getZ(t),We.applyNormalMatrix(e),this.setXYZ(t,We.x,We.y,We.z);return this},transformDirection:function(e){for(var t=0,n=this.count;t<n;t++)We.x=this.getX(t),We.y=this.getY(t),We.z=this.getZ(t),We.transformDirection(e),this.setXYZ(t,We.x,We.y,We.z);return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this},setXYZW:function(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Ye.prototype=Object.create(Je.prototype),Ye.prototype.constructor=Ye,Qe.prototype=Object.create(Je.prototype),Qe.prototype.constructor=Qe,Ze.prototype=Object.create(Je.prototype),Ze.prototype.constructor=Ze,Ke.prototype=Object.create(Je.prototype),Ke.prototype.constructor=Ke,$e.prototype=Object.create(Je.prototype),$e.prototype.constructor=$e,et.prototype=Object.create(Je.prototype),et.prototype.constructor=et,tt.prototype=Object.create(Je.prototype),tt.prototype.constructor=tt,nt.prototype=Object.create(Je.prototype),nt.prototype.constructor=nt,it.prototype=Object.create(Je.prototype),it.prototype.constructor=it;var rt=function(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1};function ot(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}rt.prototype.computeGroups=function(e){var t,n,i=[],r=void 0,o=e.faces;for(n=0;n<o.length;n++){var a=o[n];a.materialIndex!==r&&(r=a.materialIndex,void 0!==t&&(t.count=3*n-t.start,i.push(t)),t={start:3*n,materialIndex:r})}void 0!==t&&(t.count=3*n-t.start,i.push(t)),this.groups=i},rt.prototype.fromGeometry=function(e){var t,n=e.faces,i=e.vertices,r=e.faceVertexUvs,o=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,l=e.morphTargets,u=l.length;if(u>0){t=[];for(var c=0;c<u;c++)t[c]={name:l[c].name,data:[]};this.morphTargets.position=t}var h,p=e.morphNormals,d=p.length;if(d>0){h=[];for(var f=0;f<d;f++)h[f]={name:p[f].name,data:[]};this.morphTargets.normal=h}var m=e.skinIndices,g=e.skinWeights,v=m.length===i.length,y=g.length===i.length;i.length>0&&0===n.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var b=0;b<n.length;b++){var _=n[b];this.vertices.push(i[_.a],i[_.b],i[_.c]);var x=_.vertexNormals;if(3===x.length)this.normals.push(x[0],x[1],x[2]);else{var E=_.normal;this.normals.push(E,E,E)}var w=_.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var T=_.color;this.colors.push(T,T,T)}if(!0===o){var M=r[0][b];void 0!==M?this.uvs.push(M[0],M[1],M[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",b),this.uvs.push(new a,new a,new a))}if(!0===s){var S=r[1][b];void 0!==S?this.uvs2.push(S[0],S[1],S[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",b),this.uvs2.push(new a,new a,new a))}for(var C=0;C<u;C++){var A=l[C].vertices;t[C].data.push(A[_.a],A[_.b],A[_.c])}for(var R=0;R<d;R++){var P=p[R].vertexNormals[b];h[R].data.push(P.a,P.b,P.c)}v&&this.skinIndices.push(m[_.a],m[_.b],m[_.c]),y&&this.skinWeights.push(g[_.a],g[_.b],g[_.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this};var at=1,st=new X,lt=new be,ut=new b,ct=new E,ht=new E,pt=new b;function dt(){Object.defineProperty(this,"id",{value:at+=2}),this.uuid=o.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}dt.prototype=Object.assign(Object.create(t.prototype),{constructor:dt,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(ot(e)>65535?tt:$e)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var i=(new u).getNormalMatrix(e);n.applyNormalMatrix(i),n.needsUpdate=!0}var r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return st.makeRotationX(e),this.applyMatrix4(st),this},rotateY:function(e){return st.makeRotationY(e),this.applyMatrix4(st),this},rotateZ:function(e){return st.makeRotationZ(e),this.applyMatrix4(st),this},translate:function(e,t,n){return st.makeTranslation(e,t,n),this.applyMatrix4(st),this},scale:function(e,t,n){return st.makeScale(e,t,n),this.applyMatrix4(st),this},lookAt:function(e){return lt.lookAt(e),lt.updateMatrix(),this.applyMatrix4(lt.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ut).negate(),this.translate(ut.x,ut.y,ut.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var n=new nt(3*t.vertices.length,3),i=new nt(3*t.colors.length,3);if(this.setAttribute("position",n.copyVector3sArray(t.vertices)),this.setAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var r=new nt(t.lineDistances.length,1);this.setAttribute("lineDistance",r.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new nt(t,3)),this},updateFromObject:function(e){var t=e.geometry;if(e.isMesh){var n=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(n=void 0,t.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(t);n.verticesNeedUpdate=t.verticesNeedUpdate,n.normalsNeedUpdate=t.normalsNeedUpdate,n.colorsNeedUpdate=t.colorsNeedUpdate,n.uvsNeedUpdate=t.uvsNeedUpdate,n.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=n}if(!0===t.verticesNeedUpdate){var i=this.attributes.position;void 0!==i&&(i.copyVector3sArray(t.vertices),i.needsUpdate=!0),t.verticesNeedUpdate=!1}if(!0===t.normalsNeedUpdate){var r=this.attributes.normal;void 0!==r&&(r.copyVector3sArray(t.normals),r.needsUpdate=!0),t.normalsNeedUpdate=!1}if(!0===t.colorsNeedUpdate){var o=this.attributes.color;void 0!==o&&(o.copyColorsArray(t.colors),o.needsUpdate=!0),t.colorsNeedUpdate=!1}if(t.uvsNeedUpdate){var a=this.attributes.uv;void 0!==a&&(a.copyVector2sArray(t.uvs),a.needsUpdate=!0),t.uvsNeedUpdate=!1}if(t.lineDistancesNeedUpdate){var s=this.attributes.lineDistance;void 0!==s&&(s.copyArray(t.lineDistances),s.needsUpdate=!0),t.lineDistancesNeedUpdate=!1}return t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new rt).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new Je(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var n=new Float32Array(3*e.normals.length);this.setAttribute("normal",new Je(n,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var i=new Float32Array(3*e.colors.length);this.setAttribute("color",new Je(i,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var r=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new Je(r,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new Je(o,2).copyVector2sArray(e.uvs2))}for(var a in this.groups=e.groups,e.morphTargets){for(var s=[],l=e.morphTargets[a],u=0,c=l.length;u<c;u++){var h=l[u],p=new nt(3*h.data.length,3);p.name=h.name,s.push(p.copyVector3sArray(h.data))}this.morphAttributes[a]=s}if(e.skinIndices.length>0){var d=new nt(4*e.skinIndices.length,4);this.setAttribute("skinIndex",d.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var f=new nt(4*e.skinWeights.length,4);this.setAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new E);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new b(-1/0,-1/0,-1/0),new b(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,i=t.length;n<i;n++){var r=t[n];ct.setFromBufferAttribute(r),this.morphTargetsRelative?(pt.addVectors(this.boundingBox.min,ct.min),this.boundingBox.expandByPoint(pt),pt.addVectors(this.boundingBox.max,ct.max),this.boundingBox.expandByPoint(pt)):(this.boundingBox.expandByPoint(ct.min),this.boundingBox.expandByPoint(ct.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new I);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new b,1/0);if(e){var n=this.boundingSphere.center;if(ct.setFromBufferAttribute(e),t)for(var i=0,r=t.length;i<r;i++){var o=t[i];ht.setFromBufferAttribute(o),this.morphTargetsRelative?(pt.addVectors(ct.min,ht.min),ct.expandByPoint(pt),pt.addVectors(ct.max,ht.max),ct.expandByPoint(pt)):(ct.expandByPoint(ht.min),ct.expandByPoint(ht.max))}ct.getCenter(n);for(var a=0,s=0,l=e.count;s<l;s++)pt.fromBufferAttribute(e,s),a=Math.max(a,n.distanceToSquared(pt));if(t)for(var u=0,c=t.length;u<c;u++)for(var h=t[u],p=this.morphTargetsRelative,d=0,f=h.count;d<f;d++)pt.fromBufferAttribute(h,d),p&&(ut.fromBufferAttribute(e,d),pt.add(ut)),a=Math.max(a,n.distanceToSquared(pt));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.getAttribute("position");if(void 0!==t){var n=this.getAttribute("normal");if(void 0===n)n=new Je(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(var i=0,r=n.count;i<r;i++)n.setXYZ(i,0,0,0);var o=new b,a=new b,s=new b,l=new b,u=new b,c=new b,h=new b,p=new b;if(e)for(var d=0,f=e.count;d<f;d+=3){var m=e.getX(d+0),g=e.getX(d+1),v=e.getX(d+2);o.fromBufferAttribute(t,m),a.fromBufferAttribute(t,g),s.fromBufferAttribute(t,v),h.subVectors(s,a),p.subVectors(o,a),h.cross(p),l.fromBufferAttribute(n,m),u.fromBufferAttribute(n,g),c.fromBufferAttribute(n,v),l.add(h),u.add(h),c.add(h),n.setXYZ(m,l.x,l.y,l.z),n.setXYZ(g,u.x,u.y,u.z),n.setXYZ(v,c.x,c.y,c.z)}else for(var y=0,_=t.count;y<_;y+=3)o.fromBufferAttribute(t,y+0),a.fromBufferAttribute(t,y+1),s.fromBufferAttribute(t,y+2),h.subVectors(s,a),p.subVectors(o,a),h.cross(p),n.setXYZ(y+0,h.x,h.y,h.z),n.setXYZ(y+1,h.x,h.y,h.z),n.setXYZ(y+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var i in n)if(void 0!==e.attributes[i])for(var r=n[i].array,o=e.attributes[i],a=o.array,s=o.itemSize*t,l=Math.min(a.length,r.length-s),u=0,c=s;u<l;u++,c++)r[c]=a[u];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)pt.fromBufferAttribute(e,t),pt.normalize(),e.setXYZ(t,pt.x,pt.y,pt.z)},toNonIndexed:function(){function e(e,t){for(var n=e.array,i=e.itemSize,r=e.normalized,o=new n.constructor(t.length*i),a=0,s=0,l=0,u=t.length;l<u;l++){a=t[l]*i;for(var c=0;c<i;c++)o[s++]=n[a++]}return new Je(o,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new dt,n=this.index.array,i=this.attributes;for(var r in i){var o=e(i[r],n);t.setAttribute(r,o)}var a=this.morphAttributes;for(var s in a){for(var l=[],u=a[s],c=0,h=u.length;c<h;c++){var p=e(u[c],n);l.push(p)}t.morphAttributes[s]=l}t.morphTargetsRelative=this.morphTargetsRelative;for(var d=this.groups,f=0,m=d.length;f<m;f++){var g=d[f];t.addGroup(g.start,g.count,g.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var i=this.index;null!==i&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});var r=this.attributes;for(var o in r){var a=r[o],s=a.toJSON(e.data);""!==a.name&&(s.name=a.name),e.data.attributes[o]=s}var l={},u=!1;for(var c in this.morphAttributes){for(var h=this.morphAttributes[c],p=[],d=0,f=h.length;d<f;d++){var m=h[d],g=m.toJSON(e.data);""!==m.name&&(g.name=m.name),p.push(g)}p.length>0&&(l[c]=p,u=!0)}u&&(e.data.morphAttributes=l,e.data.morphTargetsRelative=this.morphTargetsRelative);var v=this.groups;v.length>0&&(e.data.groups=JSON.parse(JSON.stringify(v)));var y=this.boundingSphere;return null!==y&&(e.data.boundingSphere={center:y.center.toArray(),radius:y.radius}),e},clone:function(){return(new dt).copy(this)},copy:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone(t));var i=e.attributes;for(var r in i){var o=i[r];this.setAttribute(r,o.clone(t))}var a=e.morphAttributes;for(var s in a){for(var l=[],u=a[s],c=0,h=u.length;c<h;c++)l.push(u[c].clone(t));this.morphAttributes[s]=l}this.morphTargetsRelative=e.morphTargetsRelative;for(var p=e.groups,d=0,f=p.length;d<f;d++){var m=p[d];this.addGroup(m.start,m.count,m.materialIndex)}var g=e.boundingBox;null!==g&&(this.boundingBox=g.clone());var v=e.boundingSphere;return null!==v&&(this.boundingSphere=v.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var ft=new X,mt=new W,gt=new I,vt=new b,yt=new b,bt=new b,_t=new b,xt=new b,Et=new b,wt=new b,Tt=new b,Mt=new b,St=new a,Ct=new a,At=new a,Rt=new b,Pt=new b;function Dt(e,t){be.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new dt,this.material=void 0!==t?t:new Ge,this.updateMorphTargets()}function kt(e,t,n,i,r,o,a,s){if(null===(1===t.side?i.intersectTriangle(a,o,r,!0,s):i.intersectTriangle(r,o,a,2!==t.side,s)))return null;Pt.copy(s),Pt.applyMatrix4(e.matrixWorld);var l=n.ray.origin.distanceTo(Pt);return l<n.near||l>n.far?null:{distance:l,point:Pt.clone(),object:e}}function jt(e,t,n,i,r,o,s,l,u,c,h,p){vt.fromBufferAttribute(r,c),yt.fromBufferAttribute(r,h),bt.fromBufferAttribute(r,p);var d=e.morphTargetInfluences;if(t.morphTargets&&o&&d){wt.set(0,0,0),Tt.set(0,0,0),Mt.set(0,0,0);for(var f=0,m=o.length;f<m;f++){var g=d[f],v=o[f];0!==g&&(_t.fromBufferAttribute(v,c),xt.fromBufferAttribute(v,h),Et.fromBufferAttribute(v,p),s?(wt.addScaledVector(_t,g),Tt.addScaledVector(xt,g),Mt.addScaledVector(Et,g)):(wt.addScaledVector(_t.sub(vt),g),Tt.addScaledVector(xt.sub(yt),g),Mt.addScaledVector(Et.sub(bt),g)))}vt.add(wt),yt.add(Tt),bt.add(Mt)}e.isSkinnedMesh&&(e.boneTransform(c,vt),e.boneTransform(h,yt),e.boneTransform(p,bt));var y=kt(e,t,n,i,vt,yt,bt,Rt);if(y){l&&(St.fromBufferAttribute(l,c),Ct.fromBufferAttribute(l,h),At.fromBufferAttribute(l,p),y.uv=Oe.getUV(Rt,vt,yt,bt,St,Ct,At,new a)),u&&(St.fromBufferAttribute(u,c),Ct.fromBufferAttribute(u,h),At.fromBufferAttribute(u,p),y.uv2=Oe.getUV(Rt,vt,yt,bt,St,Ct,At,new a));var b=new Ue(c,h,p);Oe.getNormal(vt,yt,bt,b.normal),y.face=b}return y}Dt.prototype=Object.assign(Object.create(be.prototype),{constructor:Dt,isMesh:!0,copy:function(e){return be.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var i=t[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,o=i.length;r<o;r++){var a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var n,i=this.geometry,r=this.material,o=this.matrixWorld;if(void 0!==r&&(null===i.boundingSphere&&i.computeBoundingSphere(),gt.copy(i.boundingSphere),gt.applyMatrix4(o),!1!==e.ray.intersectsSphere(gt)&&(ft.getInverse(o),mt.copy(e.ray).applyMatrix4(ft),null===i.boundingBox||!1!==mt.intersectsBox(i.boundingBox))))if(i.isBufferGeometry){var s=i.index,l=i.attributes.position,u=i.morphAttributes.position,c=i.morphTargetsRelative,h=i.attributes.uv,p=i.attributes.uv2,d=i.groups,f=i.drawRange;if(null!==s)if(Array.isArray(r))for(var m=0,g=d.length;m<g;m++)for(var v=d[m],y=r[v.materialIndex],b=Math.max(v.start,f.start),_=Math.min(v.start+v.count,f.start+f.count),x=b,E=_=Math.min(_,s.count);x<E;x+=3){var w=s.getX(x),T=s.getX(x+1),M=s.getX(x+2);(n=jt(this,y,e,mt,l,u,c,h,p,w,T,M))&&(n.faceIndex=Math.floor(x/3),n.face.materialIndex=v.materialIndex,t.push(n))}else for(var S=Math.max(0,f.start),C=Math.min(s.count,f.start+f.count);S<C;S+=3){var A=s.getX(S),R=s.getX(S+1),P=s.getX(S+2);(n=jt(this,r,e,mt,l,u,c,h,p,A,R,P))&&(n.faceIndex=Math.floor(S/3),t.push(n))}else if(void 0!==l)if(Array.isArray(r))for(var D=0,k=d.length;D<k;D++)for(var j=d[D],O=r[j.materialIndex],F=Math.max(j.start,f.start),B=Math.min(j.start+j.count,f.start+f.count),L=F,I=B=Math.min(B,l.count);L<I;L+=3){(n=jt(this,O,e,mt,l,u,c,h,p,L,L+1,L+2))&&(n.faceIndex=Math.floor(L/3),n.face.materialIndex=j.materialIndex,t.push(n))}else for(var N=Math.max(0,f.start),H=Math.min(l.count,f.start+f.count);N<H;N+=3){(n=jt(this,r,e,mt,l,u,c,h,p,N,N+1,N+2))&&(n.faceIndex=Math.floor(N/3),t.push(n))}}else if(i.isGeometry){var z,U=Array.isArray(r),V=i.vertices,q=i.faces,G=i.faceVertexUvs[0];G.length>0&&(z=G);for(var W=0,X=q.length;W<X;W++){var J=q[W],Y=U?r[J.materialIndex]:r;if(void 0!==Y){var Q=V[J.a],Z=V[J.b],K=V[J.c];if(n=kt(this,Y,e,mt,Q,Z,K,Rt)){if(z&&z[W]){var $=z[W];St.copy($[0]),Ct.copy($[1]),At.copy($[2]),n.uv=Oe.getUV(Rt,Q,Z,K,St,Ct,At,new a)}n.face=J,n.faceIndex=W,t.push(n)}}}}}});var Ot=0,Ft=new X,Bt=new be,Lt=new b;function It(){Object.defineProperty(this,"id",{value:Ot+=2}),this.uuid=o.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}It.prototype=Object.assign(Object.create(t.prototype),{constructor:It,isGeometry:!0,applyMatrix4:function(e){for(var t=(new u).getNormalMatrix(e),n=0,i=this.vertices.length;n<i;n++){this.vertices[n].applyMatrix4(e)}for(var r=0,o=this.faces.length;r<o;r++){var a=this.faces[r];a.normal.applyMatrix3(t).normalize();for(var s=0,l=a.vertexNormals.length;s<l;s++)a.vertexNormals[s].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return Ft.makeRotationX(e),this.applyMatrix4(Ft),this},rotateY:function(e){return Ft.makeRotationY(e),this.applyMatrix4(Ft),this},rotateZ:function(e){return Ft.makeRotationZ(e),this.applyMatrix4(Ft),this},translate:function(e,t,n){return Ft.makeTranslation(e,t,n),this.applyMatrix4(Ft),this},scale:function(e,t,n){return Ft.makeScale(e,t,n),this.applyMatrix4(Ft),this},lookAt:function(e){return Bt.lookAt(e),Bt.updateMatrix(),this.applyMatrix4(Bt.matrix),this},fromBufferGeometry:function(e){var t=this,n=null!==e.index?e.index:void 0,i=e.attributes;if(void 0===i.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var r=i.position,o=i.normal,s=i.color,l=i.uv,u=i.uv2;void 0!==u&&(this.faceVertexUvs[1]=[]);for(var c=0;c<r.count;c++)t.vertices.push((new b).fromBufferAttribute(r,c)),void 0!==s&&t.colors.push((new ze).fromBufferAttribute(s,c));function h(e,n,i,r){var c=void 0===s?[]:[t.colors[e].clone(),t.colors[n].clone(),t.colors[i].clone()],h=void 0===o?[]:[(new b).fromBufferAttribute(o,e),(new b).fromBufferAttribute(o,n),(new b).fromBufferAttribute(o,i)],p=new Ue(e,n,i,h,c,r);t.faces.push(p),void 0!==l&&t.faceVertexUvs[0].push([(new a).fromBufferAttribute(l,e),(new a).fromBufferAttribute(l,n),(new a).fromBufferAttribute(l,i)]),void 0!==u&&t.faceVertexUvs[1].push([(new a).fromBufferAttribute(u,e),(new a).fromBufferAttribute(u,n),(new a).fromBufferAttribute(u,i)])}var p=e.groups;if(p.length>0)for(var d=0;d<p.length;d++)for(var f=p[d],m=f.start,g=m,v=m+f.count;g<v;g+=3)void 0!==n?h(n.getX(g),n.getX(g+1),n.getX(g+2),f.materialIndex):h(g,g+1,g+2,f.materialIndex);else if(void 0!==n)for(var y=0;y<n.count;y+=3)h(n.getX(y),n.getX(y+1),n.getX(y+2));else for(var _=0;_<r.count;_+=3)h(_,_+1,_+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Lt).negate(),this.translate(Lt.x,Lt.y,Lt.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,i=new X;return i.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix4(i),this},computeFaceNormals:function(){for(var e=new b,t=new b,n=0,i=this.faces.length;n<i;n++){var r=this.faces[n],o=this.vertices[r.a],a=this.vertices[r.b],s=this.vertices[r.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),r.normal.copy(e)}},computeVertexNormals:function(e){void 0===e&&(e=!0);for(var t=new Array(this.vertices.length),n=0,i=this.vertices.length;n<i;n++)t[n]=new b;if(e)for(var r=new b,o=new b,a=0,s=this.faces.length;a<s;a++){var l=this.faces[a],u=this.vertices[l.a],c=this.vertices[l.b],h=this.vertices[l.c];r.subVectors(h,c),o.subVectors(u,c),r.cross(o),t[l.a].add(r),t[l.b].add(r),t[l.c].add(r)}else{this.computeFaceNormals();for(var p=0,d=this.faces.length;p<d;p++){var f=this.faces[p];t[f.a].add(f.normal),t[f.b].add(f.normal),t[f.c].add(f.normal)}}for(var m=0,g=this.vertices.length;m<g;m++)t[m].normalize();for(var v=0,y=this.faces.length;v<y;v++){var _=this.faces[v],x=_.vertexNormals;3===x.length?(x[0].copy(t[_.a]),x[1].copy(t[_.b]),x[2].copy(t[_.c])):(x[0]=t[_.a].clone(),x[1]=t[_.b].clone(),x[2]=t[_.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(var e=0,t=this.faces.length;e<t;e++){var n=this.faces[e],i=n.vertexNormals;3===i.length?(i[0].copy(n.normal),i[1].copy(n.normal),i[2].copy(n.normal)):(i[0]=n.normal.clone(),i[1]=n.normal.clone(),i[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(var e=0,t=this.faces.length;e<t;e++){var n=this.faces[e];n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]);for(var i=0,r=n.vertexNormals.length;i<r;i++)n.__originalVertexNormals[i]?n.__originalVertexNormals[i].copy(n.vertexNormals[i]):n.__originalVertexNormals[i]=n.vertexNormals[i].clone()}var o=new It;o.faces=this.faces;for(var a=0,s=this.morphTargets.length;a<s;a++){if(!this.morphNormals[a]){this.morphNormals[a]={},this.morphNormals[a].faceNormals=[],this.morphNormals[a].vertexNormals=[];for(var l=this.morphNormals[a].faceNormals,u=this.morphNormals[a].vertexNormals,c=0,h=this.faces.length;c<h;c++){var p=new b,d={a:new b,b:new b,c:new b};l.push(p),u.push(d)}}var f=this.morphNormals[a];o.vertices=this.morphTargets[a].vertices,o.computeFaceNormals(),o.computeVertexNormals();for(var m=0,g=this.faces.length;m<g;m++){var v=this.faces[m],y=f.faceNormals[m],_=f.vertexNormals[m];y.copy(v.normal),_.a.copy(v.vertexNormals[0]),_.b.copy(v.vertexNormals[1]),_.c.copy(v.vertexNormals[2])}}for(var x=0,E=this.faces.length;x<E;x++){var w=this.faces[x];w.normal=w.__originalFaceNormal,w.vertexNormals=w.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new E),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new I),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e&&e.isGeometry){var i,r=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,l=e.faces,c=this.colors,h=e.colors;void 0===n&&(n=0),void 0!==t&&(i=(new u).getNormalMatrix(t));for(var p=0,d=a.length;p<d;p++){var f=a[p].clone();void 0!==t&&f.applyMatrix4(t),o.push(f)}for(var m=0,g=h.length;m<g;m++)c.push(h[m].clone());for(var v=0,y=l.length;v<y;v++){var b=l[v],_=void 0,x=void 0,E=b.vertexNormals,w=b.vertexColors,T=new Ue(b.a+r,b.b+r,b.c+r);T.normal.copy(b.normal),void 0!==i&&T.normal.applyMatrix3(i).normalize();for(var M=0,S=E.length;M<S;M++)_=E[M].clone(),void 0!==i&&_.applyMatrix3(i).normalize(),T.vertexNormals.push(_);T.color.copy(b.color);for(var C=0,A=w.length;C<A;C++)x=w[C],T.vertexColors.push(x.clone());T.materialIndex=b.materialIndex+n,s.push(T)}for(var R=0,P=e.faceVertexUvs.length;R<P;R++){var D=e.faceVertexUvs[R];void 0===this.faceVertexUvs[R]&&(this.faceVertexUvs[R]=[]);for(var k=0,j=D.length;k<j;k++){for(var O=D[k],F=[],B=0,L=O.length;B<L;B++)F.push(O[B].clone());this.faceVertexUvs[R].push(F)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){for(var e={},t=[],n=[],i=Math.pow(10,4),r=0,o=this.vertices.length;r<o;r++){var a=this.vertices[r],s=Math.round(a.x*i)+"_"+Math.round(a.y*i)+"_"+Math.round(a.z*i);void 0===e[s]?(e[s]=r,t.push(this.vertices[r]),n[r]=t.length-1):n[r]=n[e[s]]}for(var l=[],u=0,c=this.faces.length;u<c;u++){var h=this.faces[u];h.a=n[h.a],h.b=n[h.b],h.c=n[h.c];for(var p=[h.a,h.b,h.c],d=0;d<3;d++)if(p[d]===p[(d+1)%3]){l.push(u);break}}for(var f=l.length-1;f>=0;f--){var m=l[f];this.faces.splice(m,1);for(var g=0,v=this.faceVertexUvs.length;g<v;g++)this.faceVertexUvs[g].splice(m,1)}var y=this.vertices.length-t.length;return this.vertices=t,y},setFromPoints:function(e){this.vertices=[];for(var t=0,n=e.length;t<n;t++){var i=e[t];this.vertices.push(new b(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,n=0;n<t;n++)e[n]._id=n;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));var i,r,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];o&&o.length===t&&(i=[]),a&&a.length===t&&(r=[]);for(var s=0;s<t;s++){var l=e[s]._id;i&&i.push(o[l]),r&&r.push(a[l])}i&&(this.faceVertexUvs[0]=i),r&&(this.faceVertexUvs[1]=r)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}for(var i=[],r=0;r<this.vertices.length;r++){var o=this.vertices[r];i.push(o.x,o.y,o.z)}for(var a=[],s=[],l={},u=[],c={},h=[],p={},d=0;d<this.faces.length;d++){var f=this.faces[d],m=void 0!==this.faceVertexUvs[0][d],g=f.normal.length()>0,v=f.vertexNormals.length>0,y=1!==f.color.r||1!==f.color.g||1!==f.color.b,b=f.vertexColors.length>0,_=0;if(_=T(_,0,0),_=T(_,1,!0),_=T(_,2,!1),_=T(_,3,m),_=T(_,4,g),_=T(_,5,v),_=T(_,6,y),_=T(_,7,b),a.push(_),a.push(f.a,f.b,f.c),a.push(f.materialIndex),m){var x=this.faceVertexUvs[0][d];a.push(C(x[0]),C(x[1]),C(x[2]))}if(g&&a.push(M(f.normal)),v){var E=f.vertexNormals;a.push(M(E[0]),M(E[1]),M(E[2]))}if(y&&a.push(S(f.color)),b){var w=f.vertexColors;a.push(S(w[0]),S(w[1]),S(w[2]))}}function T(e,t,n){return n?e|1<<t:e&~(1<<t)}function M(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]||(l[t]=s.length/3,s.push(e.x,e.y,e.z)),l[t]}function S(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==c[t]||(c[t]=u.length,u.push(e.getHex())),c[t]}function C(e){var t=e.x.toString()+e.y.toString();return void 0!==p[t]||(p[t]=h.length/2,h.push(e.x,e.y)),p[t]}return e.data={},e.data.vertices=i,e.data.normals=s,u.length>0&&(e.data.colors=u),h.length>0&&(e.data.uvs=[h]),e.data.faces=a,e},clone:function(){return(new It).copy(this)},copy:function(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;for(var t=e.vertices,n=0,i=t.length;n<i;n++)this.vertices.push(t[n].clone());for(var r=e.colors,o=0,a=r.length;o<a;o++)this.colors.push(r[o].clone());for(var s=e.faces,l=0,u=s.length;l<u;l++)this.faces.push(s[l].clone());for(var c=0,h=e.faceVertexUvs.length;c<h;c++){var p=e.faceVertexUvs[c];void 0===this.faceVertexUvs[c]&&(this.faceVertexUvs[c]=[]);for(var d=0,f=p.length;d<f;d++){for(var m=p[d],g=[],v=0,y=m.length;v<y;v++){var b=m[v];g.push(b.clone())}this.faceVertexUvs[c].push(g)}}for(var _=e.morphTargets,x=0,E=_.length;x<E;x++){var w={};if(w.name=_[x].name,void 0!==_[x].vertices){w.vertices=[];for(var T=0,M=_[x].vertices.length;T<M;T++)w.vertices.push(_[x].vertices[T].clone())}if(void 0!==_[x].normals){w.normals=[];for(var S=0,C=_[x].normals.length;S<C;S++)w.normals.push(_[x].normals[S].clone())}this.morphTargets.push(w)}for(var A=e.morphNormals,R=0,P=A.length;R<P;R++){var D={};if(void 0!==A[R].vertexNormals){D.vertexNormals=[];for(var k=0,j=A[R].vertexNormals.length;k<j;k++){var O=A[R].vertexNormals[k],F={};F.a=O.a.clone(),F.b=O.b.clone(),F.c=O.c.clone(),D.vertexNormals.push(F)}}if(void 0!==A[R].faceNormals){D.faceNormals=[];for(var B=0,L=A[R].faceNormals.length;B<L;B++)D.faceNormals.push(A[R].faceNormals[B].clone())}this.morphNormals.push(D)}for(var I=e.skinWeights,N=0,H=I.length;N<H;N++)this.skinWeights.push(I[N].clone());for(var z=e.skinIndices,U=0,V=z.length;U<V;U++)this.skinIndices.push(z[U].clone());for(var q=e.lineDistances,G=0,W=q.length;G<W;G++)this.lineDistances.push(q[G]);var X=e.boundingBox;null!==X&&(this.boundingBox=X.clone());var J=e.boundingSphere;return null!==J&&(this.boundingSphere=J.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Nt=function(e){function t(t,n,i,r,o,a){e.call(this),this.type="BoxGeometry",this.parameters={width:t,height:n,depth:i,widthSegments:r,heightSegments:o,depthSegments:a},this.fromBufferGeometry(new Ht(t,n,i,r,o,a)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Ht=function(e){function t(t,n,i,r,o,a){void 0===t&&(t=1),void 0===n&&(n=1),void 0===i&&(i=1),void 0===r&&(r=1),void 0===o&&(o=1),void 0===a&&(a=1),e.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:n,depth:i,widthSegments:r,heightSegments:o,depthSegments:a};var s=this;r=Math.floor(r),o=Math.floor(o),a=Math.floor(a);var l=[],u=[],c=[],h=[],p=0,d=0;function f(e,t,n,i,r,o,a,f,m,g,v){for(var y=o/m,_=a/g,x=o/2,E=a/2,w=f/2,T=m+1,M=g+1,S=0,C=0,A=new b,R=0;R<M;R++)for(var P=R*_-E,D=0;D<T;D++){var k=D*y-x;A[e]=k*i,A[t]=P*r,A[n]=w,u.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[n]=f>0?1:-1,c.push(A.x,A.y,A.z),h.push(D/m),h.push(1-R/g),S+=1}for(var j=0;j<g;j++)for(var O=0;O<m;O++){var F=p+O+T*j,B=p+O+T*(j+1),L=p+(O+1)+T*(j+1),I=p+(O+1)+T*j;l.push(F,B,I),l.push(B,L,I),C+=6}s.addGroup(d,C,v),d+=C,p+=S}f("z","y","x",-1,-1,i,n,t,a,o,0),f("z","y","x",1,-1,i,n,-t,a,o,1),f("x","z","y",1,1,t,i,n,r,a,2),f("x","z","y",1,-1,t,i,-n,r,a,3),f("x","y","z",1,-1,t,n,i,r,o,4),f("x","y","z",-1,-1,t,n,-i,r,o,5),this.setIndex(l),this.setAttribute("position",new nt(u,3)),this.setAttribute("normal",new nt(c,3)),this.setAttribute("uv",new nt(h,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt);function zt(e){var t={};for(var n in e)for(var i in t[n]={},e[n]){var r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}return t}function Ut(e){for(var t={},n=0;n<e.length;n++){var i=zt(e[n]);for(var r in i)t[r]=i[r]}return t}var Vt={clone:zt,merge:Ut};function qt(e){qe.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="\nvoid main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",this.fragmentShader="\nvoid main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}\n",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function Gt(){be.call(this),this.type="Camera",this.matrixWorldInverse=new X,this.projectionMatrix=new X,this.projectionMatrixInverse=new X}function Wt(e,t,n,i){Gt.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==i?i:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}qt.prototype=Object.create(qe.prototype),qt.prototype.constructor=qt,qt.prototype.isShaderMaterial=!0,qt.prototype.copy=function(e){return qe.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=zt(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this},qt.prototype.toJSON=function(e){var t=qe.prototype.toJSON.call(this,e);for(var n in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var r={};for(var o in this.extensions)!0===this.extensions[o]&&(r[o]=!0);return Object.keys(r).length>0&&(t.extensions=r),t},Gt.prototype=Object.assign(Object.create(be.prototype),{constructor:Gt,isCamera:!0,copy:function(e,t){return be.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new b),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){be.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(e,t){be.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),Wt.prototype=Object.assign(Object.create(Gt.prototype),{constructor:Wt,isPerspectiveCamera:!0,copy:function(e,t){return Gt.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*o.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*o.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*o.RAD2DEG*Math.atan(Math.tan(.5*o.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,i,r,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*o.DEG2RAD*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i,a=this.view;if(null!==this.view&&this.view.enabled){var s=a.fullWidth,l=a.fullHeight;r+=a.offsetX*i/s,t-=a.offsetY*n/l,i*=a.width/s,n*=a.height/l}var u=this.filmOffset;0!==u&&(r+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=be.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});function Xt(e,t,n){if(be.call(this),this.type="CubeCamera",!0===n.isWebGLCubeRenderTarget){this.renderTarget=n;var i=new Wt(90,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new b(1,0,0)),this.add(i);var r=new Wt(90,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new b(-1,0,0)),this.add(r);var o=new Wt(90,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new b(0,1,0)),this.add(o);var a=new Wt(90,1,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new b(0,-1,0)),this.add(a);var s=new Wt(90,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new b(0,0,1)),this.add(s);var l=new Wt(90,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new b(0,0,-1)),this.add(l),this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var u=e.xr.enabled,c=e.getRenderTarget();e.xr.enabled=!1;var h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,s),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(c),e.xr.enabled=u},this.clear=function(e,t,i,r){for(var o=e.getRenderTarget(),a=0;a<6;a++)e.setRenderTarget(n,a),e.clear(t,i,r);e.setRenderTarget(o)}}else console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.")}function Jt(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),m.call(this,e,e,t),this.texture.isWebGLCubeRenderTargetTexture=!0}function Yt(e,t,n,i,r,o,a,s,l,u,c,h){p.call(this,null,o,a,s,l,u,i,r,c,h),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==l?l:1003,this.minFilter=void 0!==u?u:1003,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}Xt.prototype=Object.create(be.prototype),Xt.prototype.constructor=Xt,Jt.prototype=Object.create(m.prototype),Jt.prototype.constructor=Jt,Jt.prototype.isWebGLCubeRenderTarget=!0,Jt.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=1023,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n={tEquirect:{value:null}},i="\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t",r="\n\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t",o=new Ht(5,5,5),a=new qt({name:"CubemapFromEquirect",uniforms:zt(n),vertexShader:i,fragmentShader:r,side:1,blending:0});a.uniforms.tEquirect.value=t;var s=new Dt(o,a),l=t.minFilter;return 1008===t.minFilter&&(t.minFilter=1006),new Xt(1,10,this).update(e,s),t.minFilter=l,s.geometry.dispose(),s.material.dispose(),this},Yt.prototype=Object.create(p.prototype),Yt.prototype.constructor=Yt,Yt.prototype.isDataTexture=!0;var Qt=new I,Zt=new b,Kt=function(e,t,n,i,r,o){this.planes=[void 0!==e?e:new we,void 0!==t?t:new we,void 0!==n?n:new we,void 0!==i?i:new we,void 0!==r?r:new we,void 0!==o?o:new we]};function $t(){var e=null,t=!1,n=null,i=null;function r(t,o){n(t,o),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function en(e,t){var n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){var o=i.get(t);(!o||o.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{t.isInterleavedBufferAttribute&&(t=t.data);var a=i.get(t);void 0===a?i.set(t,function(t,n){var i=t.array,r=t.usage,o=e.createBuffer();e.bindBuffer(n,o),e.bufferData(n,i,r),t.onUploadCallback();var a=5126;return i instanceof Float32Array?a=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?a=5123:i instanceof Int16Array?a=5122:i instanceof Uint32Array?a=5125:i instanceof Int32Array?a=5124:i instanceof Int8Array?a=5120:i instanceof Uint8Array&&(a=5121),{buffer:o,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,r)):a.version<t.version&&(!function(t,i,r){var o=i.array,a=i.updateRange;e.bindBuffer(r,t),i.resizeDirty?(e.bufferData(r,o,i.usage),i.resizeDirty=!1):-1===a.count?e.bufferSubData(r,0,o):(n?e.bufferSubData(r,a.offset*o.BYTES_PER_ELEMENT,o,a.offset,a.count):e.bufferSubData(r,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1)}(a.buffer,t,r),a.version=t.version)}}}}Kt.prototype.set=function(e,t,n,i,r,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(o),this},Kt.prototype.clone=function(){return(new this.constructor).copy(this)},Kt.prototype.copy=function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this},Kt.prototype.setFromProjectionMatrix=function(e){var t=this.planes,n=e.elements,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=n[5],u=n[6],c=n[7],h=n[8],p=n[9],d=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return t[0].setComponents(a-i,c-s,f-h,y-m).normalize(),t[1].setComponents(a+i,c+s,f+h,y+m).normalize(),t[2].setComponents(a+r,c+l,f+p,y+g).normalize(),t[3].setComponents(a-r,c-l,f-p,y-g).normalize(),t[4].setComponents(a-o,c-u,f-d,y-v).normalize(),t[5].setComponents(a+o,c+u,f+d,y+v).normalize(),this},Kt.prototype.intersectsObject=function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Qt.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Qt)},Kt.prototype.intersectsSprite=function(e){return Qt.center.set(0,0,0),Qt.radius=.7071067811865476,Qt.applyMatrix4(e.matrixWorld),this.intersectsSphere(Qt)},Kt.prototype.intersectsSphere=function(e){for(var t=this.planes,n=e.center,i=-e.radius,r=0;r<6;r++){if(t[r].distanceToPoint(n)<i)return!1}return!0},Kt.prototype.intersectsBox=function(e){for(var t=this.planes,n=0;n<6;n++){var i=t[n];if(Zt.x=i.normal.x>0?e.max.x:e.min.x,Zt.y=i.normal.y>0?e.max.y:e.min.y,Zt.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Zt)<0)return!1}return!0},Kt.prototype.containsPoint=function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0};var tn=function(e){function t(t,n,i,r){e.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:n,widthSegments:i,heightSegments:r},this.fromBufferGeometry(new nn(t,n,i,r)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),nn=function(e){function t(t,n,i,r){e.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:n,widthSegments:i,heightSegments:r};for(var o=(t=t||1)/2,a=(n=n||1)/2,s=Math.floor(i)||1,l=Math.floor(r)||1,u=s+1,c=l+1,h=t/s,p=n/l,d=[],f=[],m=[],g=[],v=0;v<c;v++)for(var y=v*p-a,b=0;b<u;b++){var _=b*h-o;f.push(_,-y,0),m.push(0,0,1),g.push(b/s),g.push(1-v/l)}for(var x=0;x<l;x++)for(var E=0;E<s;E++){var w=E+u*x,T=E+u*(x+1),M=E+1+u*(x+1),S=E+1+u*x;d.push(w,T,S),d.push(T,M,S)}this.setIndex(d),this.setAttribute("position",new nt(f,3)),this.setAttribute("normal",new nt(m,3)),this.setAttribute("uv",new nt(g,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt),rn={alphamap_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",alphamap_pars_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",alphatest_fragment:"\n#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) {\n\n\t\tdiscard;\n\n\t} else {\n\n\t\t// @THREE-Modification\n\t\t// Prevent alpha test edge gradient\n\t\tdiffuseColor.a = opacity;\n\n\t}\n\n#endif\n",aomap_fragment:"\n#ifdef USE_AOMAP\n\n\t// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\n\t#endif\n\n#endif\n",aomap_pars_fragment:"\n#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif\n",begin_vertex:"\n// @THREE-Modification Cartesian3 to webgl\n#ifdef USE_CARTESIAN3\n    vec3 transformed = czm_converPosition(position);\n#else\n    vec3 transformed = vec3( position );\n#endif\n\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n\n#ifdef USE_TANGENT\n\n\tvec3 objectTangent = vec3( tangent.xyz );\n\n#endif\n",bsdfs:'\n\n// Analytical approximation of the DFG LUT, one half of the\n// split-sum approximation used in indirect specular lighting.\n// via \'environmentBRDF\' from "Physically Based Shading on Mobile"\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\n\tvec4 r = roughness * c0 + c1;\n\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n}\n\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\n\t// page 32, equation 26: E[window1]\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\n\t// this is intended to be used on spot and point lights who are represented as luminous intensity\n\t// but who must be converted to luminous irradiance for surface lighting calculation\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\n\tif( cutoffDistance > 0.0 ) {\n\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\n\t}\n\n\treturn distanceFalloff;\n\n#else\n\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n\t}\n\n\treturn 1.0;\n\n#endif\n\n}\n\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\n\treturn RECIPROCAL_PI * diffuseColor;\n\n} // validated\n\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\n\t// Original approximation by Christophe Schlick \'94\n\t// float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH \'13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n\n} // validated\n\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\n\t// See F_Schlick\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\n\treturn Fr * fresnel + F0;\n\n}\n\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (34)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disney’s reparameterization\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\t// geometry term (normalized) = G(l)⋅G(v) / 4(n⋅l)(n⋅v)\n\t// also see #12151\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\n\treturn 1.0 / ( gl * gv );\n\n} // validated\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\tfloat a2 = pow2( alpha );\n\n\t// dotNL and dotNV are explicitly swapped. This is not a mistake.\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\n\treturn 0.5 / max( gv + gl, EPSILON );\n\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disney’s reparameterization\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1\n\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n\n}\n\n// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat alpha = pow2( roughness ); // UE4\'s roughness\n\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\tfloat D = D_GGX( alpha, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// Rect Area Light\n\n// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines\n// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt\n// code: https://github.com/selfshadow/ltc_code/\n\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\tfloat dotNV = saturate( dot( N, V ) );\n\n\t// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\treturn uv;\n\n}\n\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\n\t// Real-Time Area Lighting: a Journey from Research to Production (p.102)\n\t// An approximation of the form factor of a horizon-clipped rectangle.\n\n\tfloat l = length( f );\n\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n\n}\n\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\n\tfloat x = dot( v1, v2 );\n\n\tfloat y = abs( x );\n\n\t// rational polynomial approximation to theta / sin( theta ) / 2PI\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\n\treturn cross( v1, v2 ) * theta_sintheta;\n\n}\n\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\n\t// bail if point is on back side of plane of light\n\t// assumes ccw winding order of light vertices\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\n\t// construct orthonormal basis around N\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system\n\n\t// compute transform\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\n\t// transform rect\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\n\t// project rect onto sphere\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\n\t// calculate vector form factor\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\n\t// adjust for horizon clipping\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\n/*\n\t// alternate method of adjusting for horizon clipping (see referece)\n\t// refactoring required\n\tfloat len = length( vectorFormFactor );\n\tfloat z = vectorFormFactor.z / len;\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\t// tabulated horizon-clipped sphere, apparently...\n\tvec2 uv = vec2( z * 0.5 + 0.5, len );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\tfloat scale = texture2D( ltc_2, uv ).w;\n\n\tfloat result = len * scale;\n*/\n\n\treturn vec3( result );\n\n}\n\n// End Rect Area Light\n\n// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\n\treturn specularColor * brdf.x + brdf.y;\n\n} // validated\n\n// Fdez-Agüera\'s "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"\n// Approximates multiscattering in order to preserve energy.\n// http://www.jcgt.org/published/0008/01/03/\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619; // 1/21\n\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n\n}\n\nfloat G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\n\n\t// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n\treturn 0.25;\n\n}\n\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\n\t//float dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\t//float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// source: http://simonstechblog.blogspot.ca/2011/12/microfacet-brdf.html\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\n\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n\n#if defined( USE_SHEEN )\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L94\nfloat D_Charlie(float roughness, float NoH) {\n\t// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF"\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125); // 2^(-14/2), so sin2h^2 > 0 in fp16\n\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L136\nfloat V_Neubelt(float NoV, float NoL) {\n\t// Neubelt and Pettineo 2013, "Crafting a Next-gen Material Pipeline for The Order: 1886"\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\n\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n\n}\n\n#endif\n',bumpmap_pars_fragment:"\n#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n\t// http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",clipping_planes_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvec4 plane;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\n\t\tbool clipped = true;\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t\tif ( clipped ) discard;\n\n\t#endif\n\n#endif\n",clipping_planes_pars_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n\n#endif\n",clipping_planes_pars_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n#endif\n",clipping_planes_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvClipPosition = - mvPosition.xyz;\n\n#endif\n",color_fragment:"\n#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif\n\n// @THREE-Modification\n// add alpha attribute support\n\n#ifdef USE_ALPHAINDEX\n\n\tdiffuseColor.a *= vAlpha;\n\n#endif\n",color_pars_fragment:"\n#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n\n// @THREE-Modification\n// add alpha attribute support\n\n#ifdef USE_ALPHAINDEX\n\n\tvarying float vAlpha;\n\n#endif\n",color_pars_vertex:"\n#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\n\tvarying vec3 vColor;\n\n#endif\n\n// @THREE-Modification\n// add alpha attribute support\n\n#ifdef USE_ALPHAINDEX\n\n\tattribute float alphaIndex;\n\tvarying float vAlpha;\n\n#endif\n",color_vertex:"\n#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\n\tvColor = vec3( 1.0 );\n\n#endif\n\n#ifdef USE_COLOR\n\n\tvColor.xyz *= color.xyz;\n\n#endif\n\n#ifdef USE_INSTANCING_COLOR\n\n\tvColor.xyz *= instanceColor.xyz;\n\n#endif\n\n// @THREE-Modification\n// add alpha attribute support\n\n#ifdef USE_ALPHAINDEX\n\n\tvAlpha = alphaIndex;\n\n#endif\n\n// @THREE-Modification\n// INSTANCED\n\n#ifdef INSTANCED\n\n\t#ifdef USE_COLOR\n\n\t\tvColor.xyz = instanceColor.xyz;\n\n\t#endif\n\t\n#endif\n\n",common:"\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n// <tonemapping_pars_fragment> may have defined saturate() already\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\n\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\n\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t// dir can be either a direction vector or a normal vector\n\t// upper-left 3x3 of matrix is assumed to be orthogonal\n\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\n\treturn - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nmat3 transposeMat3( const in mat3 m ) {\n\n\tmat3 tmp;\n\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\n\treturn tmp;\n\n}\n\n// https://en.wikipedia.org/wiki/Relative_luminance\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\n\treturn dot( weights, color.rgb );\n\n}\n\n// @THREE-Modification Cartesian3 to webgl\nvec3 czm_converPosition( vec3 origin ) {\n   vec3 res = vec3( 0.0 );\n       res.x = -origin.x;\n       res.y = origin.z;\n       res.z = origin.y;\n       return res;\n}\n\n// @THREE-Modification vector applyQuaternion\nvec3 applyQuaternion ( vec3 v, vec4 q ) {\n        float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n\t\tfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\n\t\tfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\n\t\tfloat iw = - q.x * v.x - q.y * v.y - q.z * v.z;\n\t\treturn vec3( ix * q.w + iw * ( -q.x ) + iy * ( -q.z ) - iz * ( -q.y ),\n\t\t            iy * q.w + iw * ( -q.y ) + iz * ( -q.x ) - ix * ( -q.z ),\n\t\t            iz * q.w + iw * ( -q.z ) + ix * ( -q.y ) - iy * ( -q.x ) );\n}\n\nbool isPerspectiveMatrix( mat4 m ) {\n\n\treturn m[ 2 ][ 3 ] == - 1.0;\n\n}\n\nvec2 equirectUv( in vec3 dir ) {\n\n\t// dir is assumed to be unit length\n\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\treturn vec2( u, v );\n\n}\n",cube_uv_reflection_fragment:"\n#ifdef ENVMAP_TYPE_CUBE_UV\n\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\n\t// These shader functions convert between the UV coordinates of a single face of\n\t// a cubemap, the 0-5 integer index of a cube face, and the direction vector for\n\t// sampling a textureCube (not generally normalized ).\n\n\tfloat getFace( vec3 direction ) {\n\n\t\tvec3 absDirection = abs( direction );\n\n\t\tfloat face = - 1.0;\n\n\t\tif ( absDirection.x > absDirection.z ) {\n\n\t\t\tif ( absDirection.x > absDirection.y )\n\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\n\t\t\telse\n\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\n\t\t} else {\n\n\t\t\tif ( absDirection.z > absDirection.y )\n\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\n\t\t\telse\n\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\n\t\t}\n\n\t\treturn face;\n\n\t}\n\n\t// RH coordinate system; PMREM face-indexing convention\n\tvec2 getUV( vec3 direction, float face ) {\n\n\t\tvec2 uv;\n\n\t\tif ( face == 0.0 ) {\n\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x ); // pos x\n\n\t\t} else if ( face == 1.0 ) {\n\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y ); // pos y\n\n\t\t} else if ( face == 2.0 ) {\n\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z ); // pos z\n\n\t\t} else if ( face == 3.0 ) {\n\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x ); // neg x\n\n\t\t} else if ( face == 4.0 ) {\n\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y ); // neg y\n\n\t\t} else {\n\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z ); // neg z\n\n\t\t}\n\n\t\treturn 0.5 * ( uv + 1.0 );\n\n\t}\n\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\n\t\tfloat face = getFace( direction );\n\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\n\t\tfloat faceSize = exp2( mipInt );\n\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\n\t\tvec2 f = fract( uv );\n\n\t\tuv += 0.5 - f;\n\n\t\tif ( face > 2.0 ) {\n\n\t\t\tuv.y += faceSize;\n\n\t\t\tface -= 3.0;\n\n\t\t}\n\n\t\tuv.x += face * faceSize;\n\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\n\t\t}\n\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\n\t\tuv *= texelSize;\n\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.x += texelSize;\n\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.y += texelSize;\n\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.x -= texelSize;\n\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tvec3 tm = mix( tl, tr, f.x );\n\n\t\tvec3 bm = mix( bl, br, f.x );\n\n\t\treturn mix( tm, bm, f.y );\n\n\t}\n\n\t// These defines must match with PMREMGenerator\n\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\n\tfloat roughnessToMip( float roughness ) {\n\n\t\tfloat mip = 0.0;\n\n\t\tif ( roughness >= r1 ) {\n\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\n\t\t} else if ( roughness >= r4 ) {\n\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\n\t\t} else if ( roughness >= r5 ) {\n\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\n\t\t} else if ( roughness >= r6 ) {\n\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\n\t\t} else {\n\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness ); // 1.16 = 1.79^0.25\n\t\t}\n\n\t\treturn mip;\n\n\t}\n\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\n\t\tfloat mipF = fract( mip );\n\n\t\tfloat mipInt = floor( mip );\n\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\n\t\tif ( mipF == 0.0 ) {\n\n\t\t\treturn vec4( color0, 1.0 );\n\n\t\t} else {\n\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\n\t\t}\n\n\t}\n\n#endif\n",defaultnormal_vertex:"\nvec3 transformedNormal = objectNormal;\n\n#ifdef USE_INSTANCING\n\n\t// this is in lieu of a per-instance normal-matrix\n\t// shear transforms in the instance matrix are not supported\n\n\tmat3 m = mat3( instanceMatrix );\n\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\n\ttransformedNormal = m * transformedNormal;\n\n#endif\n\ntransformedNormal = normalMatrix * transformedNormal;\n\n#ifdef FLIP_SIDED\n\n\ttransformedNormal = - transformedNormal;\n\n#endif\n\n#ifdef USE_TANGENT\n\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#ifdef FLIP_SIDED\n\n\t\ttransformedTangent = - transformedTangent;\n\n\t#endif\n\n#endif\n",displacementmap_pars_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n\n#endif\n",displacementmap_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n\n#endif\n",emissivemap_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n\n#endif\n",emissivemap_pars_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tuniform sampler2D emissiveMap;\n\n#endif\n",encodings_fragment:"\ngl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\n// For a discussion of what this is, please read this: http://lousodrome.net/blog/light/2013/05/26/gamma-correct-and-hdr-rendering-in-a-32-bits-buffer/\n\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\n\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\n\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\n\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\n\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\n\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\n\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n\t// return vec4( value.brg, ( 3.0 + 128.0 ) / 256.0 );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\n\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\n\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\t// NOTE: The implementation with min causes the shader to not compile on\n\t// a common Alcatel A502DL in Chrome 78/Android 8.1. Some research suggests \n\t// that the chipset is Mediatek MT6739 w/ IMG PowerVR GE8100 GPU.\n\t// D = min( floor( D ) / 255.0, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\n\n// LogLuv reference: http://graphicrants.blogspot.ca/2009/04/rgbm-color-encoding.html\n\n// M matrix, for encoding\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\n\n// Inverse M matrix, for decoding\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}\n",envmap_fragment:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvec3 cameraToFrag;\n\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\n\t\t}\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\n\t#else\n\n\t\tvec4 envColor = vec4( 0.0 );\n\n\t#endif\n\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\n\t\tenvColor = envMapTexelToLinear( envColor );\n\n\t#endif\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",envmap_common_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif\n",envmap_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n\n#endif\n",envmap_pars_vertex:"\n#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\n\t#endif\n\n#endif\n",envmap_physical_pars_fragment:"\n#if defined( USE_ENVMAP )\n\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\n\tvec3 getLightProbeIndirectIrradiance( /*const in SpecularLightProbe specularLightProbe,*/ const in GeometricContext geometry, const in int maxMIPLevel ) {\n\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t\n\t\t// @THREE-Modification\n\t\t#ifdef  BASE_QUATERNION\n\n\t\t\tvec3 newNormal = applyQuaternion(worldNormal, baseQuaternion);\n\n\t\t#endif\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\t// @THREE-Modification\n\t\t\t#ifdef  BASE_QUATERNION\n\t\t\t\n\t\t\t\tvec3 queryVec = vec3( flipEnvMap * newNormal.x, newNormal.yz );\n\t\t\t\t\n\t\t\t#else\n\t\t\t\n\t\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t\t\n            #endif\n\n\t\t\t// TODO: replace with properly filtered cubemaps and access the irradiance LOD level, be it the last LOD level\n\t\t\t// of a specular cubemap, or just the default level of a specially created irradiance cubemap.\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#else\n\n\t\t\t\t// force the bias high to get the last LOD level as it is the most blurred.\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\n\t\t\t// @THREE-Modification\n\t\t\t#ifdef  BASE_QUATERNION\n\t\t\t\n\t\t\t\tvec3 queryVec = newNormal.xyz;\n\t\t\t\t\n\t\t\t#else\n\t\t\t\n\t\t\t\tvec3 queryVec = worldNormal.xyz;\n\t\t\t\t\n            #endif\n    \n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\n\t\t#else\n\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\n\t\t#endif\n\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\n\t}\n\n\t// Trowbridge-Reitz distribution to Mip level, following the logic of http://casual-effects.blogspot.ca/2011/08/plausible-environment-lighting-in-two.html\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\n\t\t// clamp to allowable LOD ranges.\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\n\t}\n\n\tvec3 getLightProbeIndirectRadiance( /*const in SpecularLightProbe specularLightProbe,*/ const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\n\t\t\t// Mixing the reflection with the normal is more accurate and keeps rough objects from gathering light from behind their tangent plane.\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\n\t\t#endif\n\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\n\t\t// @THREE-Modification\n\t\t#ifdef  BASE_QUATERNION\n\n\t\t\treflectVec = applyQuaternion(reflectVec, baseQuaternion);\n\t\t\t\t\n\t\t#endif \n\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\n\t\t#endif\n\n\t\treturn envMapColor.rgb * envMapIntensity;\n\n\t}\n\n#endif\n",envmap_vertex:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvWorldPosition = worldPosition.xyz;\n\n\t#else\n\n\t\tvec3 cameraToVertex;\n\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t\t}\n\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\n\n\tfogDepth = - mvPosition.z;\n\n#endif\n",fog_pars_vertex:"\n#ifdef USE_FOG\n\n\tvarying float fogDepth;\n\n#endif\n",fog_fragment:"\n#ifdef USE_FOG\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\n\t#endif\n\t// @THREE-Modification\n    fogFactor = fogFactor >= fogAlpha ? fogAlpha : fogFactor;\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\n#endif\n",fog_pars_fragment:"\n#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t// @THREE-Modification\n\tuniform float fogAlpha;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\n\t#endif\n\n#endif\n",gradientmap_pars_fragment:"\n\n#ifdef USE_GRADIENTMAP\n\n\tuniform sampler2D gradientMap;\n\n#endif\n\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\n\t// dotNL will be from -1.0 to 1.0\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\n\t#ifdef USE_GRADIENTMAP\n\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\n\t#else\n\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\n\t#endif\n\n}\n",lightmap_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity; // factor of PI should not be present; included here to prevent breakage\n\n#endif\n",lightmap_pars_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n\n#endif\n",lights_lambert_vertex:"\nvec3 diffuse = vec3( 1.0 );\n\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\n\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\n\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\n\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n\n#ifdef DOUBLE_SIDED\n\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n\n#endif\n\n#if NUM_POINT_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if NUM_SPOT_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n/*\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\t// TODO (abelnation): implement\n\n\t}\n\n#endif\n*/\n\n#if NUM_DIR_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if NUM_HEMI_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n",lights_pars_begin:"\nuniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\n\n// get the irradiance (radiance convolved with cosine lobe) at the point 'normal' on the unit sphere\n// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\n\t// normal is assumed to have unit length\n\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\n\t// band 0\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\n\t// band 1\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\n\t// band 2\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\n\treturn result;\n\n}\n\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\n\treturn irradiance;\n\n}\n\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\n\tvec3 irradiance = ambientLightColor;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI;\n\n\t#endif\n\n\treturn irradiance;\n\n}\n\n#if NUM_DIR_LIGHTS > 0\n\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\n\t}\n\n#endif\n\n\n#if NUM_POINT_LIGHTS > 0\n\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\n\t}\n\n#endif\n\n\n#if NUM_SPOT_LIGHTS > 0\n\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\n\t\tif ( angleCos > spotLight.coneCos ) {\n\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\n\t\t} else {\n\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\n\t\t}\n\t}\n\n#endif\n\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\n\t// Pre-computed values of LinearTransformedCosine approximation of BRDF\n\t// BRDF approximation Texture is 64x64\n\tuniform sampler2D ltc_1; // RGBA Float\n\tuniform sampler2D ltc_2; // RGBA Float\n\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n\n#endif\n\n\n#if NUM_HEMI_LIGHTS > 0\n\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tirradiance *= PI;\n\n\t\t#endif\n\n\t\treturn irradiance;\n\n\t}\n\n#endif\n",lights_toon_fragment:"\nToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\n",lights_toon_pars_fragment:"\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n\nstruct ToonMaterial {\n\n\tvec3 diffuseColor;\n\n};\n\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\n#define Material_LightProbeLOD( material )\t(0)\n",lights_phong_fragment:"\nBlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n\nstruct BlinnPhongMaterial {\n\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n\n};\n\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n\n}\n\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"\nPhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\n\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\n\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.\nmaterial.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n\n#ifdef REFLECTIVITY\n\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\n#else\n\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n\n#endif\n\n#ifdef CLEARCOAT\n\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\n\t#ifdef USE_CLEARCOATMAP\n\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\n\t#endif\n\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\n\t#endif\n\n\tmaterial.clearcoat = saturate( material.clearcoat ); // Burley clearcoat model\n\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n\n#endif\n\n#ifdef USE_SHEEN\n\n\tmaterial.sheenColor = sheen;\n\n#endif\n",lights_physical_pars_fragment:"\nstruct PhysicalMaterial {\n\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n\n};\n\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n// Clear coat directional hemishperical reflectance (this approximation should be improved)\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n\n}\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight; // counterclockwise; light shines in local neg z direction\n\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\n\t\t// LTC Fresnel Approximation by Stephen Hill\n\t\t// http://blog.selfshadow.com/publications/s2016-advances/s2016_ltc_fresnel.pdf\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\n\t}\n\n#endif\n\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\t#ifdef CLEARCOAT\n\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tccIrradiance *= PI; // punctual light\n\n\t\t#endif\n\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n\t#else\n\n\t\tfloat clearcoatDHR = 0.0;\n\n\t#endif\n\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\n\t#ifdef CLEARCOAT\n\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n\t#else\n\n\t\tfloat clearcoatDHR = 0.0;\n\n\t#endif\n\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\n\t// Both indirect specular and indirect diffuse light accumulate here\n\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n\n// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n\n}\n",lights_fragment_begin:"\n/**\n * This is a template that can be used to light a material, it uses pluggable\n * RenderEquations (RE)for specific lighting scenarios.\n *\n * Instructions for use:\n * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined\n * - If you have defined an RE_IndirectSpecular, you need to also provide a Material_LightProbeLOD. <---- ???\n * - Create a material parameter that is to be passed as the third parameter to your lighting functions.\n *\n * TODO:\n * - Add area light support.\n * - Add sphere light support.\n * - Add diffuse light probe (irradiance cubemap) support.\n */\n\nGeometricContext geometry;\n\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n#ifdef CLEARCOAT\n\n\tgeometry.clearcoatNormal = clearcoatNormal;\n\n#endif\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 iblIrradiance = vec3( 0.0 );\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n\n#endif\n",lights_fragment_maps:"\n#if defined( RE_IndirectDiffuse )\n\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tlightMapIrradiance *= PI; // factor of PI should not be present; included here to prevent breakage\n\n\t\t#endif\n\n\t\tirradiance += lightMapIrradiance;\n\n\t#endif\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( /*lightProbe,*/ geometry, maxMipLevel );\n\n\t#endif\n\n#endif\n\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\n\tradiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\n\t#ifdef CLEARCOAT\n\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\n\t#endif\n\n#endif\n",lights_fragment_end:"\n#if defined( RE_IndirectDiffuse )\n\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n\n#endif\n",logdepthbuf_fragment:"\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\t// Doing a strict comparison with == 1.0 can cause noise artifacts\n\t// on some platforms. See issue #17623.\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n\n#endif\n",logdepthbuf_pars_fragment:"\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n\n#endif\n",logdepthbuf_pars_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\n\t#else\n\n\t\tuniform float logDepthBufFC;\n\n\t#endif\n\n#endif\n",logdepthbuf_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\n\t#else\n\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\n\t\t\tgl_Position.z *= gl_Position.w;\n\n\t\t}\n\n\t#endif\n\n#endif\n",map_fragment:"\n#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n\n#endif\n",map_pars_fragment:"\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n",map_particle_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\n#endif\n\n#ifdef USE_MAP\n\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n\n#endif\n",map_particle_pars_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tuniform mat3 uvTransform;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",metalnessmap_fragment:"\nfloat metalnessFactor = metalness;\n\n#ifdef USE_METALNESSMAP\n\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\n\t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tmetalnessFactor *= texelMetalness.b;\n\n#endif\n",metalnessmap_pars_fragment:"\n#ifdef USE_METALNESSMAP\n\n\tuniform sampler2D metalnessMap;\n\n#endif\n",morphnormal_vertex:"\n#ifdef USE_MORPHNORMALS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\n#endif\n",morphtarget_pars_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\tuniform float morphTargetBaseInfluence;\n\n\t#ifndef USE_MORPHNORMALS\n\n\t\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\t\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif\n",morphtarget_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in position = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n#endif\n",normal_fragment_begin:"\n#ifdef FLAT_SHADED\n\n\t// Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\n\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#else\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t#endif\n\n\t#ifdef USE_TANGENT\n\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t#endif\n\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n\n// non perturbed normal for clearcoat among others\n\nvec3 geometryNormal = normal;\n\n",normal_fragment_maps:"\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n\t#ifdef FLIP_SIDED\n\n\t\tnormal = - normal;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t#endif\n\n\tnormal = normalize( normalMatrix * normal );\n\n#elif defined( TANGENTSPACE_NORMALMAP )\n\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\n\t#ifdef USE_TANGENT\n\n\t\tnormal = normalize( vTBN * mapN );\n\n\t#else\n\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\n\t#endif\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n",normalmap_pars_fragment:"\n#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n#endif\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n\tuniform mat3 normalMatrix;\n\n#endif\n\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tmat3 tsn = mat3( S, T, N );\n\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n",clearcoat_normal_fragment_begin:"\n#ifdef CLEARCOAT\n\n\tvec3 clearcoatNormal = geometryNormal;\n\n#endif\n",clearcoat_normal_fragment_maps:"\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\n\t#ifdef USE_TANGENT\n\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\n\t#else\n\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\n\t#endif\n\n#endif\n",clearcoat_pars_fragment:"\n\n#ifdef USE_CLEARCOATMAP\n\n\tuniform sampler2D clearcoatMap;\n\n#endif\n\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tuniform sampler2D clearcoatRoughnessMap;\n\n#endif\n\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n\n#endif\n",packing:"\nvec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\n\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\n\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8; // tidy overflow\n\treturn r * PackUpscale;\n}\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\n\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\n\n// NOTE: viewZ/eyeZ is < 0 when in front of the camera per OpenGL conventions\n\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\n\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"\n#ifdef PREMULTIPLIED_ALPHA\n\n\t// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.\n\tgl_FragColor.rgb *= gl_FragColor.a;\n\n#endif\n",project_vertex:"\nvec4 mvPosition = vec4( transformed, 1.0 );\n\n#ifdef USE_INSTANCING\n\n\tmvPosition = instanceMatrix * mvPosition;\n\n#endif\n\nmvPosition = modelViewMatrix * mvPosition;\n\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"\n#ifdef DITHERING\n\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n\n#endif\n",dithering_pars_fragment:"\n#ifdef DITHERING\n\n\t// based on https://www.shadertoy.com/view/MslGR8\n\tvec3 dithering( vec3 color ) {\n\t\t//Calculate grid position\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\n\t\t//Shift the individual colors differently, thus making it even harder to see the dithering pattern\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\n\t\t//modify shift acording to grid position.\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\n\t\t//shift the color by dither_shift\n\t\treturn color + dither_shift_RGB;\n\t}\n\n#endif\n",roughnessmap_fragment:"\nfloat roughnessFactor = roughness;\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\n\t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\troughnessFactor *= texelRoughness.g;\n\n#endif\n",roughnessmap_pars_fragment:"\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform sampler2D roughnessMap;\n\n#endif\n",shadowmap_pars_fragment:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): create uniforms for area light shadows\n\n\t#endif\n\t*/\n\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n\t}\n\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n\t}\n\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n\t\tfloat occlusion = 1.0;\n\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\n\t\tfloat hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n\t\tif (hard_shadow != 1.0 ) {\n\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n\t\t}\n\t\treturn occlusion;\n\n\t}\n\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n\t\tfloat shadow = 1.0;\n\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\n\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#else // no percentage-closer filtering:\n\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#endif\n\n\t\t}\n\n\t\treturn shadow;\n\n\t}\n\n\t// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n\t// vector suitable for 2D texture mapping. This code uses the following layout for the\n\t// 2D texture:\n\t//\n\t// xzXZ\n\t//  y Y\n\t//\n\t// Y - Positive y direction\n\t// y - Negative y direction\n\t// X - Positive x direction\n\t// x - Negative x direction\n\t// Z - Positive z direction\n\t// z - Negative z direction\n\t//\n\t// Source and test bed:\n\t// https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n\t\t// Number of texels to avoid at the edge of each square\n\n\t\tvec3 absV = abs( v );\n\n\t\t// Intersect unit cube\n\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\n\t\t// Apply scale to avoid seams\n\n\t\t// two texels less per square (one texel will do for NEAREST)\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n\t\t// Unwrap\n\n\t\t// space: -1 ... 1 range for each square\n\t\t//\n\t\t// #X##\t\tdim    := ( 4 , 2 )\n\t\t//  # #\t\tcenter := ( 1 , 1 )\n\n\t\tvec2 planar = v.xy;\n\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\n\t\tif ( absV.z >= almostOne ) {\n\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\n\t\t} else if ( absV.x >= almostOne ) {\n\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\n\t\t} else if ( absV.y >= almostOne ) {\n\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\n\t\t}\n\n\t\t// Transform to UV space\n\n\t\t// scale := 0.5 / dim\n\t\t// translate := ( center + 0.5 ) / dim\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n\t}\n\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n\t\t// for point lights, the uniform @vShadowCoord is re-purposed to hold\n\t\t// the vector from the light to the world-space position of the fragment.\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\n\t\t// dp = normalized distance from light to fragment position\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n\t\tdp += shadowBias;\n\n\t\t// bd3D = base direction 3D\n\t\tvec3 bd3D = normalize( lightToPosition );\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#else // no percentage-closer filtering\n\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\n\t\t#endif\n\n\t}\n\n#endif\n",shadowmap_pars_vertex:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): uniforms for area light shadows\n\n\t#endif\n\t*/\n\n#endif\n",shadowmap_vertex:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\t// Offsetting the position used for querying occlusion along the world normal can be used to reduce shadow acne.\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\n\t#endif\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update vAreaShadowCoord with area light info\n\n\t#endif\n\t*/\n\n#endif\n",shadowmask_pars_fragment:"\nfloat getShadowMask() {\n\n\tfloat shadow = 1.0;\n\n\t#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\tDirectionalLightShadow directionalLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\tSpotLightShadow spotLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\tPointLightShadow pointLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update shadow for Area light\n\n\t#endif\n\t*/\n\n\t#endif\n\n\treturn shadow;\n\n}\n",skinbase_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif\n",skinning_pars_vertex:"\n#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t// @THREE-Modification\n\tuniform mat4 localBindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",skinning_vertex:"\n#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\n\t// @THREE-Modification\n\t// transformed = ( bindMatrixInverse * skinned ).xyz;\n\ttransformed = ( localBindMatrixInverse * skinned ).xyz;\n\n#endif\n",skinnormal_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n\t#ifdef USE_TANGENT\n\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#endif\n\n#endif\n",specularmap_fragment:"\nfloat specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif\n",specularmap_pars_fragment:"\n#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif\n",tonemapping_fragment:"\n#if defined( TONE_MAPPING )\n\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n\n#endif\n",tonemapping_pars_fragment:"\n#ifndef saturate\n// <common> may have defined saturate() already\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n\nuniform float toneMappingExposure;\n\n// exposure only\nvec3 LinearToneMapping( vec3 color ) {\n\n\treturn toneMappingExposure * color;\n\n}\n\n// source: https://www.cs.utah.edu/~reinhard/cdrom/\nvec3 ReinhardToneMapping( vec3 color ) {\n\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n\n}\n\n// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\n\t// optimized filmic operator by Jim Hejl and Richard Burgess-Dawson\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n\n}\n\n// source: https://github.com/selfshadow/ltc_code/blob/master/webgl/shaders/ltc/ltc_blit.fs\nvec3 RRTAndODTFit( vec3 v ) {\n\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n\n}\n\n// this implementation of ACES is modified to accommodate a brighter viewing environment.\n// the scale factor of 1/0.6 is subjective. see discussion in #19621.\n\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\n\t// sRGB => XYZ => D65_2_D60 => AP1 => RRT_SAT\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ), // transposed from source\n\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\n\t// ODT_SAT => XYZ => D60_2_D65 => sRGB\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ), // transposed from source\n\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\n\tcolor *= toneMappingExposure / 0.6;\n\n\tcolor = ACESInputMat * color;\n\n\t// Apply RRT and ODT\n\tcolor = RRTAndODTFit( color );\n\n\tcolor = ACESOutputMat * color;\n\n\t// Clamp to [0, 1]\n\treturn saturate( color );\n\n}\n\nvec3 CustomToneMapping( vec3 color ) { return color; }\n",transmissionmap_fragment:"\n#ifdef USE_TRANSMISSIONMAP\n\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n\n#endif\n",transmissionmap_pars_fragment:"\n#ifdef USE_TRANSMISSIONMAP\n\n\tuniform sampler2D transmissionMap;\n\n#endif\n",uv_pars_fragment:"\n#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\n\tvarying vec2 vUv;\n\n#endif\n",uv_pars_vertex:"\n#ifdef USE_UV\n\n\t#ifdef UVS_VERTEX_ONLY\n\n\t\tvec2 vUv;\n\n\t#else\n\n\t\tvarying vec2 vUv;\n\n\t#endif\n\n\tuniform mat3 uvTransform;\n\n#endif\n",uv_vertex:"\n#ifdef USE_UV\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n#endif\n",uv2_pars_fragment:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvarying vec2 vUv2;\n\n#endif\n",uv2_pars_vertex:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\n\tuniform mat3 uv2Transform;\n\n#endif\n",uv2_vertex:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n\n#endif\n",worldpos_vertex:"\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\n\t#ifdef USE_INSTANCING\n\n\t\tworldPosition = instanceMatrix * worldPosition;\n\n\t#endif\n\n\tworldPosition = modelMatrix * worldPosition;\n\n#endif\n",colormapping_fragment:"\n  #ifdef COLOR_MAPPING\n    float gray = clamp( dot( diffuseColor.rgb, vec3(0.333, 0.333, 0.333) ), 0.0, 1.0 );\n    diffuseColor.rgb = texture2D( colorMapping, vec2( gray, 0.5 ) ).rgb;\n  #endif\n",colormapping_pars_fragment:"\n  #ifdef COLOR_MAPPING\n    uniform sampler2D colorMapping;\n  #endif\n",baseQuaternion_pars_fragment:"\n  #ifdef BASE_QUATERNION\n    uniform vec4 baseQuaternion;\n  #endif\n",background_frag:"\nuniform sampler2D t2D;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tvec4 texColor = texture2D( t2D, vUv );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",background_vert:"\nvarying vec2 vUv;\nuniform mat3 uvTransform;\n\nvoid main() {\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n\n}\n",cube_frag:"\n#include <envmap_common_pars_fragment>\nuniform float opacity;\n\n// @THREE-Modification\nuniform mat4 colorMatrix;\n\nvarying vec3 vWorldDirection;\n\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\n\t// @THREE-Modification\n\tgl_FragColor = colorMatrix * envColor;\n\tgl_FragColor.a *= opacity;\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",cube_vert:"\n// @THREE-Modification\nuniform vec4 cubeQuat;\n\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvec3 cubeDir = transformDirection( position, modelMatrix );\n\tvWorldDirection = applyQuaternion( cubeDir, cubeQuat ); // @THREE-Modification\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n}\n",depth_frag:"\n// @THREE-Modification\n// Alpha test use opacity\n#if DEPTH_PACKING == 3200 || defined(ALPHATEST)\n\n\tuniform float opacity;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tdiffuseColor.a = opacity;\n\n\t#endif\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\t#include <logdepthbuf_fragment>\n\n\t// Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\n\t#elif DEPTH_PACKING == 3201\n\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\n\t#endif\n\n}\n",depth_vert:"\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n// This is used for computing an equivalent of gl_FragCoord.z that is as high precision as possible.\n// Some platforms compute gl_FragCoord at a lower precision which makes the manually computed value better for\n// depth-based postprocessing effects. Reproduced on iPad with A10 processor / iPadOS 13.3.1.\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\n\t// @THREE-Modification\n\t// position instanced\n\t#ifdef INSTANCED\n\t\tmat4 instanceMat = compose(instancePosition, instanceQuaternion, instanceScale);\n\t\ttransformed.xyz = (instanceMat * vec4(transformed, 1.0)).xyz;\n\t#endif\n\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvHighPrecisionZW = gl_Position.zw;\n\n}\n",distanceRGBA_frag:"\n// @THREE-Modification\n// Alpha test use opacity\n#ifdef ALPHATEST\n\n\tuniform float opacity;\n\n#endif\n\n#define DISTANCE\n\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main () {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist ); // clamp to [ 0, 1 ]\n\n\tgl_FragColor = packDepthToRGBA( dist );\n\n}\n",distanceRGBA_vert:"\n#define DISTANCE\n\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvWorldPosition = worldPosition.xyz;\n\n}\n",equirect_frag:"\nuniform sampler2D tEquirect;\n\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvec3 direction = normalize( vWorldDirection );\n\n\tvec2 sampleUV = equirectUv( direction );\n\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",equirect_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n}\n",linedashed_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\nuniform float dashSize;\nuniform float totalSize;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\n\t\tdiscard;\n\n\t}\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\n\toutgoingLight = diffuseColor.rgb; // simple shader\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",linedashed_vert:"\nuniform float scale;\nattribute float lineDistance;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\tvLineDistance = scale * lineDistance;\n\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n",meshbasic_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n// @THREE-Modification\n#include <colormapping_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\n\t// @THREE-Modification\n\t#include <colormapping_fragment>\n\t\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\n\t#endif\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshbasic_vert:"\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\n\t// @THREE-Modification\n\t// normal instanced\n\t#ifdef INSTANCED\n\t\tmat4 instanceMat = compose( instancePosition, instanceQuaternion, instanceScale );\n\t#endif\n\n\t#ifdef USE_ENVMAP\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\n\t// @THREE-Modification\n\t// normal instanced\n\t#ifdef INSTANCED\n\n\t\tmat3 im = mat3( instanceMat );\n\t\tobjectNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\t\tobjectNormal = im * objectNormal;\n\n\t#endif\n\n\t#include <defaultnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\n\t// @THREE-Modification\n\t// position instanced\n\t#ifdef INSTANCED\n\t\ttransformed.xyz = ( instanceMat * vec4( transformed, 1.0 ) ).xyz;\n\t#endif\n\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshlambert_frag:"\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n// @THREE-Modification\n#include <colormapping_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\n\t// @THREE-Modification\n\t#include <colormapping_fragment>\n\t\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\n\t#endif\n\n\t#include <lightmap_fragment>\n\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\n\t#else\n\n\t\treflectedLight.directDiffuse = vLightFront;\n\n\t#endif\n\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\n\t// modulation\n\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"\n#define LAMBERT\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\n\t// @THREE-Modification\n\t// normal instanced\n\t#ifdef INSTANCED\n\n\t\tmat4 instanceMat = compose( instancePosition, instanceQuaternion, instanceScale );\n\t\tmat3 im = mat3( instanceMat );\n\t\tobjectNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\t\tobjectNormal = im * objectNormal;\n\n\t#endif\n\n\t#include <defaultnormal_vertex>\n\n\t#include <begin_vertex>\n\n\t// @THREE-Modification\n\t// position instanced\n\t#ifdef INSTANCED\n\t\ttransformed.xyz = ( instanceMat * vec4( transformed, 1.0 ) ).xyz;\n\t#endif\n\t\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshmatcap_frag:"\n#define MATCAP\n\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\n\t#ifdef USE_MATCAP\n\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\n\t#else\n\n\t\tvec4 matcapColor = vec4( 1.0 );\n\n\t#endif\n\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshmatcap_vert:"\n#define MATCAP\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\t\tvNormal = normalize( transformedNormal );\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n}\n",meshtoon_frag:"\n#define TOON\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshtoon_vert:"\n#define TOON\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphong_frag:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n// @THREE-Modification\n#include <colormapping_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\n\t// @THREE-Modification\n\t#include <colormapping_fragment>\n\t\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphong_vert:"\n#define PHONG\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphysical_frag:"\n#define STANDARD\n\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n\n// @THREE-Modification\n#include <baseQuaternion_pars_fragment>\n\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n// @THREE-Modification\n#include <colormapping_pars_fragment>\n\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\n\t// @THREE-Modification\n\t#include <colormapping_fragment>\n\t\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t// this is a stub for the transmission model\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphysical_vert:"\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\n\t// @THREE-Modification\n\t// normal instanced\n\t#ifdef INSTANCED\n\n\t\tmat4 instanceMat = compose( instancePosition, instanceQuaternion, instanceScale );\n\t\tmat3 im = mat3( instanceMat );\n\t\tobjectNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\t\tobjectNormal = im * objectNormal;\n\n\t#endif\n\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\n\t// @THREE-Modification\n\t// position instanced\n\t#ifdef INSTANCED\n\t\ttransformed.xyz = ( instanceMat * vec4( transformed, 1.0 ) ).xyz;\n\t#endif\n\t\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",normal_frag:"\n#define NORMAL\n\nuniform float opacity;\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\n}\n",normal_vert:"\n#define NORMAL\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvViewPosition = - mvPosition.xyz;\n\n#endif\n\n}\n",points_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",points_vert:"\nuniform float size;\nuniform float scale;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\n\tgl_PointSize = size;\n\n\t#ifdef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\n\t#endif\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n\n}\n",shadow_frag:"\nuniform vec3 color;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n\nvoid main() {\n\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",shadow_vert:"\n#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n\nvoid main() {\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",sprite_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",sprite_vert:"\nuniform float rotation;\nuniform vec2 center;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n\t#ifndef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\n\t#endif\n\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\n\tmvPosition.xy += rotatedPosition;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n"},on={common:{diffuse:{value:new ze(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new u},uvTransform1:{value:new u},uvTransform2:{value:new u},uv2Transform:{value:new u},alphaMap:{value:null},alphaMap1:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new a(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ze(16777215)},fogAlpha:{value:1}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ze(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new u}},sprite:{diffuse:{value:new ze(15658734)},opacity:{value:1},center:{value:new a(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new u}}},an={basic:{uniforms:Ut([on.common,on.specularmap,on.envmap,on.aomap,on.lightmap,on.fog]),vertexShader:rn.meshbasic_vert,fragmentShader:rn.meshbasic_frag},lambert:{uniforms:Ut([on.common,on.specularmap,on.envmap,on.aomap,on.lightmap,on.emissivemap,on.fog,on.lights,{emissive:{value:new ze(0)}}]),vertexShader:rn.meshlambert_vert,fragmentShader:rn.meshlambert_frag},phong:{uniforms:Ut([on.common,on.specularmap,on.envmap,on.aomap,on.lightmap,on.emissivemap,on.bumpmap,on.normalmap,on.displacementmap,on.fog,on.lights,{emissive:{value:new ze(0)},specular:{value:new ze(1118481)},shininess:{value:30}}]),vertexShader:rn.meshphong_vert,fragmentShader:rn.meshphong_frag},standard:{uniforms:Ut([on.common,on.envmap,on.aomap,on.lightmap,on.emissivemap,on.bumpmap,on.normalmap,on.displacementmap,on.roughnessmap,on.metalnessmap,on.fog,on.lights,{emissive:{value:new ze(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:rn.meshphysical_vert,fragmentShader:rn.meshphysical_frag},toon:{uniforms:Ut([on.common,on.aomap,on.lightmap,on.emissivemap,on.bumpmap,on.normalmap,on.displacementmap,on.gradientmap,on.fog,on.lights,{emissive:{value:new ze(0)}}]),vertexShader:rn.meshtoon_vert,fragmentShader:rn.meshtoon_frag},matcap:{uniforms:Ut([on.common,on.bumpmap,on.normalmap,on.displacementmap,on.fog,{matcap:{value:null}}]),vertexShader:rn.meshmatcap_vert,fragmentShader:rn.meshmatcap_frag},points:{uniforms:Ut([on.points,on.fog]),vertexShader:rn.points_vert,fragmentShader:rn.points_frag},dashed:{uniforms:Ut([on.common,on.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:rn.linedashed_vert,fragmentShader:rn.linedashed_frag},depth:{uniforms:Ut([on.common,on.displacementmap]),vertexShader:rn.depth_vert,fragmentShader:rn.depth_frag},normal:{uniforms:Ut([on.common,on.bumpmap,on.normalmap,on.displacementmap,{opacity:{value:1}}]),vertexShader:rn.normal_vert,fragmentShader:rn.normal_frag},sprite:{uniforms:Ut([on.sprite,on.fog]),vertexShader:rn.sprite_vert,fragmentShader:rn.sprite_frag},background:{uniforms:{uvTransform:{value:new u},t2D:{value:null}},vertexShader:rn.background_vert,fragmentShader:rn.background_frag},cube:{uniforms:Ut([on.envmap,{opacity:{value:1},colorMatrix:{value:new X},cubeQuat:{value:new d}}]),vertexShader:rn.cube_vert,fragmentShader:rn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:rn.equirect_vert,fragmentShader:rn.equirect_frag},distanceRGBA:{uniforms:Ut([on.common,on.displacementmap,{referencePosition:{value:new b},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:rn.distanceRGBA_vert,fragmentShader:rn.distanceRGBA_frag},shadow:{uniforms:Ut([on.lights,on.fog,{color:{value:new ze(0)},opacity:{value:1}}]),vertexShader:rn.shadow_vert,fragmentShader:rn.shadow_frag}};function sn(e,t,n,i,r){var o,a,s=new ze(0),l=0,u=null,c=0,h=null;function p(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,r)}return{getClearColor:function(){return s},setClearColor:function(e,t){s.set(e),p(s,l=void 0!==t?t:1)},getClearAlpha:function(){return l},setClearAlpha:function(e){p(s,l=e)},render:function(n,r,d,f){var m=!0===r.isScene?r.background:null;m&&m.isTexture&&(m=t.get(m));var g=e.xr,v=g.getSession&&g.getSession();v&&"additive"===v.environmentBlendMode&&(m=null),null===m?p(s,l):m&&m.isColor&&(p(m,1),f=!0),(e.autoClear||f)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.isWebGLCubeRenderTarget||m.isWebGLCubeRenderTargetTexture||306===m.mapping)?(void 0===a&&((a=new Dt(new Ht(1,1,1),new qt({name:"BackgroundCubeMaterial",uniforms:zt(an.cube.uniforms),vertexShader:an.cube.vertexShader,fragmentShader:an.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(a)),m.isWebGLCubeRenderTarget&&(m=m.texture),a.material.uniforms.envMap.value=m,a.material.uniforms.flipEnvMap.value=m.isCubeTexture?-1:1,m.colorMatrix?a.material.uniforms.colorMatrix.value.copy(m.colorMatrix):a.material.uniforms.colorMatrix.value.identity(),m.baseQuaternion?a.material.uniforms.cubeQuat.value.copy(m.baseQuaternion):a.material.uniforms.cubeQuat.value.set(0,0,0,1),n.custom1.length?a.renderLayer=1:a.renderLayer=null,u===m&&c===m.version&&h===e.toneMapping||(a.material.needsUpdate=!0,u=m,c=m.version,h=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null)):m&&m.isTexture&&(void 0===o&&((o=new Dt(new nn(2,2),new qt({name:"BackgroundMaterial",uniforms:zt(an.background.uniforms),vertexShader:an.background.vertexShader,fragmentShader:an.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(o)),o.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),o.material.uniforms.uvTransform.value.copy(m.matrix),n.custom1.length?o.renderLayer=1:o.renderLayer=null,u===m&&c===m.version&&h===e.toneMapping||(o.material.needsUpdate=!0,u=m,c=m.version,h=e.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null))}}}function ln(e,t,n,i){var r=e.getParameter(34921),o=i.isWebGL2?null:t.get("OES_vertex_array_object"),a=i.isWebGL2||null!==o,s={},l=p(null),u=l;function c(t){return i.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function h(t){return i.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function p(e){for(var t=[],n=[],i=[],o=0;o<r;o++)t[o]=0,n[o]=0,i[o]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function d(){for(var e=u.newAttributes,t=0,n=e.length;t<n;t++)e[t]=0}function f(e){m(e,0)}function m(n,r){var o=u.newAttributes,a=u.enabledAttributes,s=u.attributeDivisors;(o[n]=1,0===a[n]&&(e.enableVertexAttribArray(n),a[n]=1),s[n]!==r)&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),s[n]=r)}function g(){for(var t=u.newAttributes,n=u.enabledAttributes,i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function v(t,n,r,o,a,s){!0!==i.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,n,r,o,a,s):e.vertexAttribIPointer(t,n,r,a,s)}function y(){b(),u!==l&&c((u=l).object)}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,h,y,b){var _=!1;if(a){var x=function(t,n,r){var a=!0===r.wireframe,l=s[t.id];void 0===l&&(l={},s[t.id]=l);var u=l[n.id];void 0===u&&(u={},l[n.id]=u);var c=u[a];void 0===c&&(c=p(function(){if(i.isWebGL2)return e.createVertexArray();return o.createVertexArrayOES()}()),u[a]=c);return c}(y,h,l);u!==x&&c((u=x).object),(_=function(e,t){var n=u.attributes,i=e.attributes;if(Object.keys(n).length!==Object.keys(i).length)return!0;for(var r in i){var o=n[r],a=i[r];if(void 0===o)return!0;if(o.attribute!==a)return!0;if(o.data!==a.data)return!0}if(u.index!==t)return!0;return!1}(y,b))&&function(e,t){var n={},i=e.attributes;for(var r in i){var o=i[r],a={};a.attribute=o,o.data&&(a.data=o.data),n[r]=a}u.attributes=n,u.index=e.index,u.index=t}(y,b)}else{var E=!0===l.wireframe;u.geometry===y.id&&u.program===h.id&&u.wireframe===E||(u.geometry=y.id,u.program=h.id,u.wireframe=E,_=!0)}!0===r.isInstancedMesh&&(_=!0),null!==b&&n.update(b,34963),_&&(!function(r,o,a,s){if(!1===i.isWebGL2&&(r.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;d();var l=s.attributes,u=a.getAttributes(),c=o.defaultAttributeValues;for(var h in u){var p=u[h];if(p>=0){var y=l[h];if(void 0!==y){var b=y.normalized,_=y.itemSize,x=n.get(y);if(void 0===x)continue;var E=x.buffer,w=x.type,T=x.bytesPerElement;if(y.isInterleavedBufferAttribute){var M=y.data,S=M.stride,C=y.offset;M&&M.isInstancedInterleavedBuffer?(m(p,M.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=M.meshPerAttribute*M.count)):f(p),e.bindBuffer(34962,E),v(p,_,w,b,S*T,C*T)}else y.isInstancedBufferAttribute?(m(p,y.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=y.meshPerAttribute*y.count)):f(p),e.bindBuffer(34962,E),v(p,_,w,b,0,0)}else if("instanceMatrix"===h){var A=n.get(r.instanceMatrix);if(void 0===A)continue;var R=A.buffer,P=A.type;m(p+0,1),m(p+1,1),m(p+2,1),m(p+3,1),e.bindBuffer(34962,R),e.vertexAttribPointer(p+0,4,P,!1,64,0),e.vertexAttribPointer(p+1,4,P,!1,64,16),e.vertexAttribPointer(p+2,4,P,!1,64,32),e.vertexAttribPointer(p+3,4,P,!1,64,48)}else if("instanceColor"===h){var D=n.get(r.instanceColor);if(void 0===D)continue;var k=D.buffer,j=D.type;m(p,1),e.bindBuffer(34962,k),e.vertexAttribPointer(p,3,j,!1,12,0)}else if(void 0!==c){var O=c[h];if(void 0!==O)switch(O.length){case 2:e.vertexAttrib2fv(p,O);break;case 3:e.vertexAttrib3fv(p,O);break;case 4:e.vertexAttrib4fv(p,O);break;default:e.vertexAttrib1fv(p,O)}}}}g()}(r,l,h,y),null!==b&&e.bindBuffer(34963,n.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){for(var e in y(),s){var t=s[e];for(var n in t){var i=t[n];for(var r in i)h(i[r].object),delete i[r];delete t[n]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0!==s[e.id]){var t=s[e.id];for(var n in t){var i=t[n];for(var r in i)h(i[r].object),delete i[r];delete t[n]}delete s[e.id]}},releaseStatesOfProgram:function(e){for(var t in s){var n=s[t];if(void 0!==n[e.id]){var i=n[e.id];for(var r in i)h(i[r].object),delete i[r];delete n[e.id]}}},initAttributes:d,enableAttribute:f,disableUnusedAttributes:g}}function un(e,t,n,i){var r,o=i.isWebGL2;this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r,1)},this.renderInstances=function(i,a,s){if(0!==s){var l,u;if(o)l=e,u="drawArraysInstanced";else if(u="drawArraysInstancedANGLE",null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[u](r,i,a,s),n.update(a,r,s)}}}function cn(e,t,n){var i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,a=void 0!==n.precision?n.precision:"highp",s=r(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var l=!0===n.logarithmicDepthBuffer,u=e.getParameter(34930),c=e.getParameter(35660),h=e.getParameter(3379),p=e.getParameter(34076),d=e.getParameter(34921),f=e.getParameter(36347),m=e.getParameter(36348),g=e.getParameter(36349),v=c>0,y=o||!!t.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==i)return i;var n=t.get("EXT_texture_filter_anisotropic");return i=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:p,maxAttributes:d,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?e.getParameter(36183):0}}function hn(e){var t=this,n=null,i=0,r=!1,o=!1,a=new we,s=new u,l={value:null,needsUpdate:!1};function c(){l.value!==n&&(l.value=n,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function h(e,n,i,r){var o=null!==e?e.length:0,u=null;if(0!==o){if(u=l.value,!0!==r||null===u){var c=i+4*o,h=n.matrixWorldInverse;s.getNormalMatrix(h),(null===u||u.length<c)&&(u=new Float32Array(c));for(var p=0,d=i;p!==o;++p,d+=4)a.copy(e[p]).applyMatrix4(h,s),a.normal.toArray(u,d),u[d+3]=a.constant}l.value=u,l.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,u}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,o){var a=0!==e.length||t||0!==i||r;return r=t,n=h(e,o,0),i=e.length,a},this.beginShadows=function(){o=!0,h(null)},this.endShadows=function(){o=!1,c()},this.setState=function(t,a,s){var u=t.clippingPlanes,p=t.clipIntersection,d=t.clipShadows,f=e.get(t);if(!r||null===u||0===u.length||o&&!d)o?h(null):c();else{var m=o?0:i,g=4*m,v=f.clippingState||null;l.value=v,v=h(u,a,g,s);for(var y=0;y!==g;++y)v[y]=n[y];f.clippingState=v,this.numIntersection=p?this.numPlanes:0,this.numPlanes+=m}}}function pn(e){var t=new WeakMap;function n(e,t){return 303===t?e.mapping=301:304===t&&(e.mapping=302),e}return{get:function(i){if(i&&i.isTexture){var r=i.mapping;if(303===r||304===r){if(t.has(i))return n(t.get(i).texture,i.mapping);var o=i.image;if(o&&o.height>0){var a=e.getRenderList(),s=e.getRenderTarget(),l=e.getRenderState(),u=new Jt(o.height/2);return u.fromEquirectangularTexture(e,i),t.set(i,u),e.setRenderTarget(s),e.setRenderList(a),e.setRenderState(l),n(u.texture,i.mapping)}return null}}return i},dispose:function(){t=new WeakMap}}}function dn(e){var t={};return{has:function(n){if(void 0!==t[n])return null!==t[n];var i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,null!==i},get:function(e){return this.has(e)||console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t[e]}}}function fn(e,t,n,i){var r=new WeakMap,o=new WeakMap;function a(e){var s=e.target,l=r.get(s);for(var u in null!==l.index&&t.remove(l.index),l.attributes)t.remove(l.attributes[u]);s.removeEventListener("dispose",a),r.delete(s);var c=o.get(l);c&&(t.remove(c),o.delete(l)),i.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){var n=[],i=e.index,r=e.attributes.position,a=0;if(null!==i){var s=i.array;a=i.version;for(var l=0,u=s.length;l<u;l+=3){var c=s[l+0],h=s[l+1],p=s[l+2];n.push(c,h,h,p,p,c)}}else{var d=r.array;a=r.version;for(var f=0,m=d.length/3-1;f<m;f+=3){var g=f+0,v=f+1,y=f+2;n.push(g,v,v,y,y,g)}}var b=new(ot(n)>65535?tt:$e)(n,1);b.version=a;var _=o.get(e);_&&t.remove(_),o.set(e,b)}return{get:function(e,t){var i=r.get(t);return i||(t.addEventListener("dispose",a),t.isBufferGeometry?i=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new dt).setFromObject(e)),i=t._bufferGeometry),r.set(t,i),n.memory.geometries++,i)},update:function(e){var n=e.attributes;for(var i in n)t.update(n[i],34962);var r=e.morphAttributes;for(var o in r)for(var a=r[o],s=0,l=a.length;s<l;s++)t.update(a[s],34962)},getWireframeAttribute:function(e){var t=o.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return o.get(e)}}}function mn(e,t,n,i){var r,o,a,s=i.isWebGL2;this.setMode=function(e){r=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,i){e.drawElements(r,i,o,t*a),n.update(i,r,1)},this.renderInstances=function(i,l,u){if(0!==u){var c,h;if(s)c=e,h="drawElementsInstanced";else if(h="drawElementsInstancedANGLE",null===(c=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[h](r,l,o,i*a,u),n.update(l,r,u)}}}function gn(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,i){switch(t.calls++,n){case 4:t.triangles+=i*(e/3);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function vn(e,t){return e[0]-t[0]}function yn(e,t){return Math.abs(t[1])-Math.abs(e[1])}function bn(e){for(var t={},n=new Float32Array(8),i=[],r=0;r<8;r++)i[r]=[r,0];return{update:function(r,o,a,s){var l=r.morphTargetInfluences,u=void 0===l?0:l.length,c=t[o.id];if(void 0===c){c=[];for(var h=0;h<u;h++)c[h]=[h,0];t[o.id]=c}for(var p=0;p<u;p++){var d=c[p];d[0]=p,d[1]=l[p]}c.sort(yn);for(var f=0;f<8;f++)f<u&&c[f][1]?(i[f][0]=c[f][0],i[f][1]=c[f][1]):(i[f][0]=Number.MAX_SAFE_INTEGER,i[f][1]=0);i.sort(vn);for(var m=a.morphTargets&&o.morphAttributes.position,g=a.morphNormals&&o.morphAttributes.normal,v=0,y=0;y<8;y++){var b=i[y],_=b[0],x=b[1];_!==Number.MAX_SAFE_INTEGER&&x?(m&&o.getAttribute("morphTarget"+y)!==m[_]&&o.setAttribute("morphTarget"+y,m[_]),g&&o.getAttribute("morphNormal"+y)!==g[_]&&o.setAttribute("morphNormal"+y,g[_]),n[y]=x,v+=x):(m&&void 0!==o.getAttribute("morphTarget"+y)&&o.deleteAttribute("morphTarget"+y),g&&void 0!==o.getAttribute("morphNormal"+y)&&o.deleteAttribute("morphNormal"+y),n[y]=0)}var E=o.morphTargetsRelative?1:1-v;s.getUniforms().setValue(e,"morphTargetBaseInfluence",E),s.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function _n(e,t,n,i){var r=new WeakMap;return{update:function(e){var o=i.render.frame,a=e.geometry,s=t.get(e,a);return r.get(s)!==o&&(a.isGeometry&&s.updateFromObject(e),t.update(s),r.set(s,o)),e.isInstancedMesh&&(n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),s},dispose:function(){r=new WeakMap}}}function xn(e,t,n,i,r,o,a,s,l,u){e=void 0!==e?e:[],t=void 0!==t?t:301,a=void 0!==a?a:1022,p.call(this,e,t,n,i,r,o,a,s,l,u),this.flipY=!1}function En(e,t,n,i){p.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:i||1},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function wn(e,t,n,i){p.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:i||1},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}an.physical={uniforms:Ut([an.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new a(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new ze(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:rn.meshphysical_vert,fragmentShader:rn.meshphysical_frag},xn.prototype=Object.create(p.prototype),xn.prototype.constructor=xn,xn.prototype.isCubeTexture=!0,Object.defineProperty(xn.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),En.prototype=Object.create(p.prototype),En.prototype.constructor=En,En.prototype.isDataTexture2DArray=!0,wn.prototype=Object.create(p.prototype),wn.prototype.constructor=wn,wn.prototype.isDataTexture3D=!0;var Tn=new p,Mn=new En,Sn=new wn,Cn=new xn,An=[],Rn=[],Pn=new Float32Array(16),Dn=new Float32Array(9),kn=new Float32Array(4);function jn(e,t,n){var i=e[0];if(i<=0||i>0)return e;var r=t*n,o=An[r];if(void 0===o&&(o=new Float32Array(r),An[r]=o),0!==t){i.toArray(o,0);for(var a=1,s=0;a!==t;++a)s+=n,e[a].toArray(o,s)}return o}function On(e,t){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function Fn(e,t){for(var n=0,i=t.length;n<i;n++)e[n]=t[n]}function Bn(e,t){var n=Rn[t];void 0===n&&(n=new Int32Array(t),Rn[t]=n);for(var i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function Ln(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function In(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(On(n,t))return;e.uniform2fv(this.addr,t),Fn(n,t)}}function Nn(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(On(n,t))return;e.uniform3fv(this.addr,t),Fn(n,t)}}function Hn(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(On(n,t))return;e.uniform4fv(this.addr,t),Fn(n,t)}}function zn(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(On(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Fn(n,t)}else{if(On(n,i))return;kn.set(i),e.uniformMatrix2fv(this.addr,!1,kn),Fn(n,i)}}function Un(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(On(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Fn(n,t)}else{if(On(n,i))return;Dn.set(i),e.uniformMatrix3fv(this.addr,!1,Dn),Fn(n,i)}}function Vn(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(On(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Fn(n,t)}else{if(On(n,i))return;Pn.set(i),e.uniformMatrix4fv(this.addr,!1,Pn),Fn(n,i)}}function qn(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(t||Tn,r)}function Gn(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||Mn,r)}function Wn(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||Sn,r)}function Xn(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(t||Cn,r)}function Jn(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Yn(e,t){var n=this.cache;On(n,t)||(e.uniform2iv(this.addr,t),Fn(n,t))}function Qn(e,t){var n=this.cache;On(n,t)||(e.uniform3iv(this.addr,t),Fn(n,t))}function Zn(e,t){var n=this.cache;On(n,t)||(e.uniform4iv(this.addr,t),Fn(n,t))}function Kn(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function $n(e,t){e.uniform1fv(this.addr,t)}function ei(e,t){e.uniform1iv(this.addr,t)}function ti(e,t){e.uniform2iv(this.addr,t)}function ni(e,t){e.uniform3iv(this.addr,t)}function ii(e,t){e.uniform4iv(this.addr,t)}function ri(e,t){var n=jn(t,this.size,2);e.uniform2fv(this.addr,n)}function oi(e,t){var n=jn(t,this.size,3);e.uniform3fv(this.addr,n)}function ai(e,t){var n=jn(t,this.size,4);e.uniform4fv(this.addr,n)}function si(e,t){var n=jn(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function li(e,t){var n=jn(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function ui(e,t){var n=jn(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function ci(e,t,n){var i=t.length,r=Bn(n,i);e.uniform1iv(this.addr,r);for(var o=0;o!==i;++o)n.safeSetTexture2D(t[o]||Tn,r[o])}function hi(e,t,n){var i=t.length,r=Bn(n,i);e.uniform1iv(this.addr,r);for(var o=0;o!==i;++o)n.safeSetTextureCube(t[o]||Cn,r[o])}function pi(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Ln;case 35664:return In;case 35665:return Nn;case 35666:return Hn;case 35674:return zn;case 35675:return Un;case 35676:return Vn;case 5124:case 35670:return Jn;case 35667:case 35671:return Yn;case 35668:case 35672:return Qn;case 35669:case 35673:return Zn;case 5125:return Kn;case 35678:case 36198:case 36298:case 36306:case 35682:return qn;case 35679:case 36299:case 36307:return Wn;case 35680:case 36300:case 36308:case 36293:return Xn;case 36289:case 36303:case 36311:case 36292:return Gn}}(t.type)}function di(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return $n;case 35664:return ri;case 35665:return oi;case 35666:return ai;case 35674:return si;case 35675:return li;case 35676:return ui;case 5124:case 35670:return ei;case 35667:case 35671:return ti;case 35668:case 35672:return ni;case 35669:case 35673:return ii;case 35678:case 36198:case 36298:case 36306:case 35682:return ci;case 35680:case 36300:case 36308:case 36293:return hi}}(t.type)}function fi(e){this.id=e,this.seq=[],this.map={}}di.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Fn(t,e)},fi.prototype.setValue=function(e,t,n){for(var i=this.seq,r=0,o=i.length;r!==o;++r){var a=i[r];a.setValue(e,t[a.id],n)}};var mi=/([\w\d_]+)(\])?(\[|\.)?/g;function gi(e,t){e.seq.push(t),e.map[t.id]=t}function vi(e,t,n){var i=e.name,r=i.length;for(mi.lastIndex=0;;){var o=mi.exec(i),a=mi.lastIndex,s=o[1],l="]"===o[2],u=o[3];if(l&&(s|=0),void 0===u||"["===u&&a+2===r){gi(n,void 0===u?new pi(s,e,t):new di(s,e,t));break}var c=n.map[s];void 0===c&&gi(n,c=new fi(s)),n=c}}function yi(e,t){this.seq=[],this.map={};for(var n=e.getProgramParameter(t,35718),i=0;i<n;++i){var r=e.getActiveUniform(t,i);vi(r,e.getUniformLocation(t,r.name),this)}}function bi(e,t,n){var i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}yi.prototype.setValue=function(e,t,n,i){var r=this.map[t];void 0!==r&&r.setValue(e,n,i)},yi.prototype.setOptional=function(e,t,n){var i=t[n];void 0!==i&&this.setValue(e,n,i)},yi.upload=function(e,t,n,i){for(var r=0,o=t.length;r!==o;++r){var a=t[r],s=n[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,i)}},yi.seqWithValue=function(e,t){for(var n=[],i=0,r=e.length;i!==r;++i){var o=e[i];o.id in t&&n.push(o)}return n};var _i=0;function xi(e){switch(e){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function Ei(e,t,n){var i=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();return i&&""===r?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+r+function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(e.getShaderSource(t))}function wi(e,t){var n=xi(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Ti(e,t){var n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Mi(e){return""!==e}function Si(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Ci(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Ai=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ri(e){return e.replace(Ai,Pi)}function Pi(e,t){var n=rn[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return Ri(n)}var Di=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,ki=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function ji(e){return e.replace(ki,Fi).replace(Di,Oi)}function Oi(e,t,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Fi(e,t,n,i)}function Fi(e,t,n,i){for(var r="",o=parseInt(t);o<parseInt(n);o++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function Bi(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Li(e,t,n,i){var r,o,a,s,l,u=e.getContext(),c=n.defines,h=n.vertexShader,p=n.fragmentShader,d=function(e){var t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),f=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case 306:case 307:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),m=function(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case 302:case 307:t="ENVMAP_MODE_REFRACTION"}return t}(n),g=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),v=e.gammaFactor>0?e.gammaFactor:1,y=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Mi).join("\n")}(n),b=function(e){var t=[];for(var n in e){var i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(c),_=u.createProgram(),x=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((r=[b].filter(Mi).join("\n")).length>0&&(r+="\n"),(o=[y,b].filter(Mi).join("\n")).length>0&&(o+="\n")):(r=[Bi(n),"#define SHADER_NAME "+n.shaderName,b,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+v,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+m:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+d:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef INSTANCED","\tattribute vec3 instancePosition;","\tattribute vec4 instanceQuaternion;","\tattribute vec3 instanceScale;","\tattribute vec3 instanceColor;","\tmat4 compose(vec3 position, vec4 quaternion, vec3 scale) {","\t\tfloat x = quaternion.x, y = quaternion.y, z = quaternion.z, w = quaternion.w;","\t\tfloat x2 = x + x,  y2 = y + y,  z2 = z + z;","\t\tfloat xx = x * x2, xy = x * y2, xz = x * z2;","\t\tfloat yy = y * y2, yz = y * z2, zz = z * z2;","\t\tfloat wx = w * x2, wy = w * y2, wz = w * z2;","\t\tfloat sx = scale.x, sy = scale.y, sz = scale.z;","\t\treturn mat4(( 1. - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.,","\t\t\t( xy - wz ) * sy, ( 1. - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.,","\t\t\t( xz + wy ) * sz, ( yz - wx ) * sz, ( 1. - ( xx + yy ) ) * sz, 0.,","\t\t\tposition.x, position.y, position.z, 1.","\t);","}","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Mi).join("\n"),o=[y,Bi(n),"#define SHADER_NAME "+n.shaderName,b,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+v,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+f:"",n.envMap?"#define "+m:"",n.envMap?"#define "+g:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+d:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?rn.tonemapping_pars_fragment:"",0!==n.toneMapping?Ti("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",rn.encodings_pars_fragment,n.map?wi("mapTexelToLinear",n.mapEncoding):"",n.matcap?wi("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?wi("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?wi("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?wi("lightMapTexelToLinear",n.lightMapEncoding):"",(a="linearToOutputTexel",s=n.outputEncoding,l=xi(s),"vec4 "+a+"( vec4 value ) { return LinearTo"+l[0]+l[1]+"; }"),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",n.useColorMapping?"#define COLOR_MAPPING":"",n.useBaseQuaternion?"#define BASE_QUATERNION":"","\n"].filter(Mi).join("\n")),h=Ci(h=Si(h=Ri(h),n),n),p=Ci(p=Si(p=Ri(p),n),n),h=ji(h),p=ji(p),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(x="#version 300 es\n",r=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+r,o=["#define varying in","300 es"===n.glslVersion?"":"out highp vec4 pc_fragColor;","300 es"===n.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+o);var E,w,T=x+o+p,M=bi(u,35633,x+r+h),S=bi(u,35632,T);if(u.attachShader(_,M),u.attachShader(_,S),void 0!==n.index0AttributeName?u.bindAttribLocation(_,0,n.index0AttributeName):!0===n.morphTargets&&u.bindAttribLocation(_,0,"position"),u.linkProgram(_),e.debug.checkShaderErrors){var C=u.getProgramInfoLog(_).trim(),A=u.getShaderInfoLog(M).trim(),R=u.getShaderInfoLog(S).trim(),P=!0,D=!0;if(!1===u.getProgramParameter(_,35714)){P=!1;var k=Ei(u,M,"vertex"),j=Ei(u,S,"fragment");console.error("THREE.WebGLProgram: shader error: ",u.getError(),"35715",u.getProgramParameter(_,35715),"gl.getProgramInfoLog",C,k,j)}else""!==C?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",C):""!==A&&""!==R||(D=!1);D&&(this.diagnostics={runnable:P,programLog:C,vertexShader:{log:A,prefix:r},fragmentShader:{log:R,prefix:o}})}return u.deleteShader(M),u.deleteShader(S),this.getUniforms=function(){return void 0===E&&(E=new yi(u,_)),E},this.getAttributes=function(){return void 0===w&&(w=function(e,t){for(var n={},i=e.getProgramParameter(t,35721),r=0;r<i;r++){var o=e.getActiveAttrib(t,r).name;n[o]=e.getAttribLocation(t,o)}return n}(u,_)),w},this.destroy=function(){i.releaseStatesOfProgram(this),u.deleteProgram(_),this.program=void 0},this.name=n.shaderName,this.id=_i++,this.cacheKey=t,this.usedTimes=1,this.program=_,this.vertexShader=M,this.fragmentShader=S,this}function Ii(e,t,n,i,r,o){var a=[],s=i.isWebGL2,l=i.floatVertexTextures,u=i.maxVertexUniforms,c=i.vertexTextures,h=i.precision,p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},d=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap","useColorMapping","useBaseQuaternion"];function f(e,t){var n;return e?e.isTexture?n=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),n=e.texture.encoding):n=3e3,3e3===n&&t&&(n=3007),n}return{getParameters:function(r,a,d,m,g){var v,y,b=m.fog,_=r.isMeshStandardMaterial?m.environment:null,x=t.get(r.envMap||_),E=p[r.type],w=g.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(l)return 1024;var n=u,i=Math.floor((n-20)/4),r=Math.min(i,t.length);return r<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+r+"."),0):r}(g):0;if(null!==r.precision&&(h=i.getMaxPrecision(r.precision))!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",h,"instead."),E){var T=an[E];v=T.vertexShader,y=T.fragmentShader}else v=r.vertexShader,y=r.fragmentShader;var M=e.getRenderTarget();return{isWebGL2:s,shaderID:E,shaderName:r.type,vertexShader:v,fragmentShader:y,defines:r.defines,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:h,instancing:!0===g.isInstancedMesh,instancingColor:!0===g.isInstancedMesh&&null!==g.instanceColor,supportsVertexTextures:c,outputEncoding:null!==M?f(M.texture,3007===e.outputEncoding):e.outputEncoding,map:!!r.map,mapEncoding:f(r.map,e.gammaInput),matcap:!!r.matcap,matcapEncoding:f(r.matcap,e.gammaInput),envMap:!!x,envMapMode:x&&x.mapping,envMapEncoding:f(x,e.gammaInput),envMapCubeUV:!!x&&(306===x.mapping||307===x.mapping),lightMap:!!r.lightMap,lightMapEncoding:f(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:f(r.emissiveMap,e.gammaInput),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:1===r.normalMapType,tangentSpaceNormalMap:0===r.normalMapType,clearcoatMap:!!r.clearcoatMap,clearcoatRoughnessMap:!!r.clearcoatRoughnessMap,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,transmissionMap:!!r.transmissionMap,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexUvs:!!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatMap||r.clearcoatRoughnessMap||r.clearcoatNormalMap||r.displacementMap||r.transmissionMap),uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.transmissionMap||!r.displacementMap),fog:!!b,useFog:r.fog,fogExp2:b&&b.isFogExp2,flatShading:r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:i.logarithmicDepthBuffer,skinning:r.skinning&&w>0,maxBones:w,useVertexTexture:l,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:r.dithering,shadowMapEnabled:e.shadowMap.enabled&&d.length>0,shadowMapType:e.shadowMap.type,toneMapping:r.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:2===r.side,flipSided:1===r.side,useColorMapping:!!r.colorMapping,useBaseQuaternion:!!r.baseQuaternion,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:s||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:s||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:s||n.has("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var i in t.defines)n.push(i),n.push(t.defines[i]);if(!1===t.isRawShaderMaterial){for(var r=0;r<d.length;r++)n.push(t[d[r]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){var t,n=p[e.type];if(n){var i=an[n];t=Vt.clone(i.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,n){for(var i,o=0,s=a.length;o<s;o++){var l=a[o];if(l.cacheKey===n){++(i=l).usedTimes;break}}return void 0===i&&(i=new Li(e,n,t,r),a.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){var t=a.indexOf(e);a[t]=a[a.length-1],a.pop(),e.destroy()}},programs:a}}function Ni(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function Hi(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function zi(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.material.id!==t.material.id?e.material.id-t.material.id:e.id-t.id}function Ui(e){var t=[],n=0,i=[],r=[],o=[],a={id:-1};function s(i,r,o,s,l,u){var c=t[n],h=e.get(o);return void 0===c?(c={id:i.id,object:i,geometry:r,material:o,program:h.program||a,groupOrder:s,renderOrder:i.renderOrder,z:l,group:u},t[n]=c):(c.id=i.id,c.object=i,c.geometry=r,c.material=o,c.program=h.program||a,c.groupOrder=s,c.renderOrder=i.renderOrder,c.z=l,c.group=u),n++,c}return{custom1:i,opaque:r,transparent:o,init:function(){n=0,i.length=0,r.length=0,o.length=0},push:function(e,t,n,a,l,u){var c=s(e,t,n,a,l,u);1===e.renderLayer?i.push(c):(!0===n.transparent?o:r).push(c)},unshift:function(e,t,n,a,l,u){var c=s(e,t,n,a,l,u);1===e.renderLayer?i.unshift(c):(!0===n.transparent?o:r).unshift(c)},finish:function(){for(var e=n,i=t.length;e<i;e++){var r=t[e];if(null===r.id)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.program=null,r.group=null}},sort:function(e,t){i.length>1&&i.sort(e||Hi),r.length>1&&r.sort(e||Hi),o.length>1&&o.sort(t||zi)}}}function Vi(e){var t=new WeakMap;return{get:function(n,i){var r,o=t.get(n);return void 0===o?(r=new Ui(e),t.set(n,new WeakMap),t.get(n).set(i,r)):void 0===(r=o.get(i))&&(r=new Ui(e),o.set(i,r)),r},dispose:function(){t=new WeakMap}}}function qi(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new b,color:new ze};break;case"SpotLight":n={position:new b,direction:new b,color:new ze,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new b,color:new ze,distance:0,decay:0};break;case"HemisphereLight":n={direction:new b,skyColor:new ze,groundColor:new ze};break;case"RectAreaLight":n={color:new ze,position:new b,halfWidth:new b,halfHeight:new b}}return e[t.id]=n,n}}}var Gi=0;function Wi(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Xi(){for(var e,t=new qi,n=(e={},{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new a};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new a,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},r=0;r<9;r++)i.probe.push(new b);var o=new b,s=new X,l=new X;return{setup:function(e,r,a){for(var u=0,c=0,h=0,p=0;p<9;p++)i.probe[p].set(0,0,0);var d=0,f=0,m=0,g=0,v=0,y=0,b=0,_=0,x=a.matrixWorldInverse;e.sort(Wi);for(var E=0,w=e.length;E<w;E++){var T=e[E],M=T.color,S=T.intensity,C=T.distance,A=T.shadow&&T.shadow.map?T.shadow.map.texture:null;if(T.isAmbientLight)u+=M.r*S,c+=M.g*S,h+=M.b*S;else if(T.isLightProbe)for(var R=0;R<9;R++)i.probe[R].addScaledVector(T.sh.coefficients[R],S);else if(T.isDirectionalLight){var P=t.get(T);if(P.color.copy(T.color).multiplyScalar(T.intensity),P.direction.setFromMatrixPosition(T.matrixWorld),o.setFromMatrixPosition(T.target.matrixWorld),P.direction.sub(o),P.direction.transformDirection(x),T.castShadow){var D=T.shadow,k=n.get(T);k.shadowBias=D.bias,k.shadowNormalBias=D.normalBias,k.shadowRadius=D.radius,k.shadowMapSize=D.mapSize,i.directionalShadow[d]=k,i.directionalShadowMap[d]=A,i.directionalShadowMatrix[d]=T.shadow.matrix,y++}i.directional[d]=P,d++}else if(T.isSpotLight){var j=t.get(T);if(j.position.setFromMatrixPosition(T.matrixWorld),j.position.applyMatrix4(x),j.color.copy(M).multiplyScalar(S),j.distance=C,j.direction.setFromMatrixPosition(T.matrixWorld),o.setFromMatrixPosition(T.target.matrixWorld),j.direction.sub(o),j.direction.transformDirection(x),j.coneCos=Math.cos(T.angle),j.penumbraCos=Math.cos(T.angle*(1-T.penumbra)),j.decay=T.decay,T.castShadow){var O=T.shadow,F=n.get(T);F.shadowBias=O.bias,F.shadowNormalBias=O.normalBias,F.shadowRadius=O.radius,F.shadowMapSize=O.mapSize,i.spotShadow[m]=F,i.spotShadowMap[m]=A,i.spotShadowMatrix[m]=T.shadow.matrix,_++}i.spot[m]=j,m++}else if(T.isRectAreaLight){var B=t.get(T);B.color.copy(M).multiplyScalar(S),B.position.setFromMatrixPosition(T.matrixWorld),B.position.applyMatrix4(x),l.identity(),s.copy(T.matrixWorld),s.premultiply(x),l.extractRotation(s),B.halfWidth.set(.5*T.width,0,0),B.halfHeight.set(0,.5*T.height,0),B.halfWidth.applyMatrix4(l),B.halfHeight.applyMatrix4(l),i.rectArea[g]=B,g++}else if(T.isPointLight){var L=t.get(T);if(L.position.setFromMatrixPosition(T.matrixWorld),L.position.applyMatrix4(x),L.color.copy(T.color).multiplyScalar(T.intensity),L.distance=T.distance,L.decay=T.decay,T.castShadow){var I=T.shadow,N=n.get(T);N.shadowBias=I.bias,N.shadowNormalBias=I.normalBias,N.shadowRadius=I.radius,N.shadowMapSize=I.mapSize,N.shadowCameraNear=I.camera.near,N.shadowCameraFar=I.camera.far,i.pointShadow[f]=N,i.pointShadowMap[f]=A,i.pointShadowMatrix[f]=T.shadow.matrix,b++}i.point[f]=L,f++}else if(T.isHemisphereLight){var H=t.get(T);H.direction.setFromMatrixPosition(T.matrixWorld),H.direction.transformDirection(x),H.direction.normalize(),H.skyColor.copy(T.color).multiplyScalar(S),H.groundColor.copy(T.groundColor).multiplyScalar(S),i.hemi[v]=H,v++}}g>0&&(i.rectAreaLTC1=on.LTC_1,i.rectAreaLTC2=on.LTC_2),i.ambient[0]=u,i.ambient[1]=c,i.ambient[2]=h;var z=i.hash;z.directionalLength===d&&z.pointLength===f&&z.spotLength===m&&z.rectAreaLength===g&&z.hemiLength===v&&z.numDirectionalShadows===y&&z.numPointShadows===b&&z.numSpotShadows===_||(i.directional.length=d,i.spot.length=m,i.rectArea.length=g,i.point.length=f,i.hemi.length=v,i.directionalShadow.length=y,i.directionalShadowMap.length=y,i.pointShadow.length=b,i.pointShadowMap.length=b,i.spotShadow.length=_,i.spotShadowMap.length=_,i.directionalShadowMatrix.length=y,i.pointShadowMatrix.length=b,i.spotShadowMatrix.length=_,z.directionalLength=d,z.pointLength=f,z.spotLength=m,z.rectAreaLength=g,z.hemiLength=v,z.numDirectionalShadows=y,z.numPointShadows=b,z.numSpotShadows=_,i.version=Gi++)},state:i}}function Ji(){var e=new Xi,t=[],n=[];return{init:function(){t.length=0,n.length=0},state:{lightsArray:t,shadowsArray:n,lights:e},setupLights:function(i){e.setup(t,n,i)},pushLight:function(e){t.push(e)},pushShadow:function(e){n.push(e)}}}function Yi(){var e=new WeakMap;return{get:function(t,n){var i;return!1===e.has(t)?(i=new Ji,e.set(t,new WeakMap),e.get(t).set(n,i)):!1===e.get(t).has(n)?(i=new Ji,e.get(t).set(n,i)):i=e.get(t).get(n),i},dispose:function(){e=new WeakMap}}}function Qi(e){qe.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function Zi(e){qe.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new b,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}Qi.prototype=Object.create(qe.prototype),Qi.prototype.constructor=Qi,Qi.prototype.isMeshDepthMaterial=!0,Qi.prototype.copy=function(e){return qe.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},Zi.prototype=Object.create(qe.prototype),Zi.prototype.constructor=Zi,Zi.prototype.isMeshDistanceMaterial=!0,Zi.prototype.copy=function(e){return qe.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};function Ki(e,t,n){var i=new Kt,r=new a,o=new a,s=new d,l=[],u=[],c={},h={0:1,1:0,2:2},p=new qt({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new a},radius:{value:4}},vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:"\nuniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n\n#include <packing>\n\nvoid main() {\n\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\n\t// This seems totally useless but it's a crazy work around for a Adreno compiler bug\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\n\t\t#ifdef HORIZONAL_PASS\n\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\n\t\t#else\n\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\n\t\t#endif\n\n\t}\n\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n\n}\n"}),f=p.clone();f.defines.HORIZONAL_PASS=1;var g=new dt;g.setAttribute("position",new Je(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var v=new Dt(g,p),y=this;function b(n,i){var r=t.update(v);p.uniforms.shadow_pass.value=n.map.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,r,p,v,null),f.uniforms.shadow_pass.value=n.mapPass.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,r,f,v,null)}function _(e,t,n){var i=e<<0|t<<1|n<<2,r=l[i];return void 0===r&&(r=new Qi({depthPacking:3201,morphTargets:e,skinning:t}),l[i]=r),r}function x(e,t,n){var i=e<<0|t<<1|n<<2,r=u[i];return void 0===r&&(r=new Zi({morphTargets:e,skinning:t}),u[i]=r),r}function E(t,n,i,r,o,a,s){var l=null,u=_,p=t.customDepthMaterial;if(!0===r.isPointLight&&(u=x,p=t.customDistanceMaterial),void 0===p){var d=!1;!0===i.morphTargets&&(d=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);var f=!1;!0===t.isSkinnedMesh&&(!0===i.skinning?f=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),l=u(d,f,!0===t.isInstancedMesh)}else l=p;if(e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){var m=l.uuid,g=i.uuid,v=c[m];void 0===v&&(v={},c[m]=v);var y=v[g];void 0===y&&(y=l.clone(),v[g]=y),l=y}return l.visible=i.visible,l.wireframe=i.wireframe,l.side=3===s?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:h[i.side],l.clipShadows=i.clipShadows,l.clippingPlanes=i.clippingPlanes,l.clipIntersection=i.clipIntersection,l.wireframeLinewidth=i.wireframeLinewidth,l.linewidth=i.linewidth,!0===r.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(r.matrixWorld),l.nearDistance=o,l.farDistance=a),l}function w(n,r,o,a,s){if(!1!==n.visible){if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);var l=t.update(n),u=n.material;if(Array.isArray(u))for(var c=l.groups,h=0,p=c.length;h<p;h++){var d=c[h],f=u[d.materialIndex];if(f&&f.visible){var m=E(n,l,f,a,o.near,o.far,s);e.renderBufferDirect(o,null,l,m,n,d)}}else if(u.visible){var g=E(n,l,u,a,o.near,o.far,s);e.renderBufferDirect(o,null,l,g,n,null)}}for(var v=n.children,y=0,b=v.length;y<b;y++)w(v[y],r,o,a,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,a,l){if(!1!==y.enabled&&(!1!==y.autoUpdate||!1!==y.needsUpdate)&&0!==t.length){var u=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),p=e.state;p.setBlending(0),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(var d=0,f=t.length;d<f;d++){var g=t[d],v=g.shadow;if(!1!==v.autoUpdate||!1!==v.needsUpdate)if(void 0!==v){r.copy(v.mapSize);var _=v.getFrameExtents();if(r.multiply(_),o.copy(v.mapSize),(r.x>n||r.y>n)&&(r.x>n&&(o.x=Math.floor(n/_.x),r.x=o.x*_.x,v.mapSize.x=o.x),r.y>n&&(o.y=Math.floor(n/_.y),r.y=o.y*_.y,v.mapSize.y=o.y)),null===v.map&&!v.isPointLightShadow&&3===this.type){var x={minFilter:1006,magFilter:1006,format:1023};v.map=new m(r.x,r.y,x),v.map.texture.name=g.name+".shadowMap",v.mapPass=new m(r.x,r.y,x),v.camera.updateProjectionMatrix()}if(null===v.map){var E={minFilter:1003,magFilter:1003,format:1023};v.map=new m(r.x,r.y,E),v.map.texture.name=g.name+".shadowMap",v.camera.updateProjectionMatrix()}e.setRenderTarget(v.map),e.clear();for(var T=v.getViewportCount(),M=0;M<T;M++){var S=v.getViewport(M);s.set(o.x*S.x,o.y*S.y,o.x*S.z,o.y*S.w),p.viewport(s),v.updateMatrices(g,M),i=v.getFrustum(),w(a,l,v.camera,g,this.type)}v.isPointLightShadow||3!==this.type||b(v,l),v.needsUpdate=!1}else console.warn("THREE.WebGLShadowMap:",g,"has no shadow.")}y.needsUpdate=!1,e.setRenderTarget(u,c,h)}}}function $i(e,t,n){var i=n.isWebGL2;var r=new function(){var t=!1,n=new d,i=null,r=new d(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,o,a,s){!0===s&&(t*=a,i*=a,o*=a),n.set(t,i,o,a),!1===r.equals(n)&&(e.clearColor(t,i,o,a),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},o=new function(){var t=!1,n=null,i=null,r=null;return{setTest:function(e){e?O(2929):F(2929)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},a=new function(){var t=!1,n=null,i=null,r=null,o=null,a=null,s=null,l=null,u=null,c=null,h=null,p=null,d=null,f=null,m=null;return{setTest:function(e){t||(e?O(2960):F(2960))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,a,s,l,u){i===t&&r===n&&o===a&&c===s&&h===l&&p===u||(null===s||null===l||null===u?e.stencilFunc(t,n,a):(e.stencilFuncSeparate(1028,t,n,a),e.stencilFuncSeparate(1029,s,l,u)),i=t,r=n,o=a,c=s,h=l,p=u)},setOp:function(t,n,i,r,o,u){a===t&&s===n&&l===i&&d===r&&f===o&&m===u||(null===r||null===o||null===u?e.stencilOp(t,n,i):(e.stencilOpSeparate(1028,t,n,i),e.stencilOpSeparate(1029,r,o,u)),a=t,s=n,l=i,d=r,f=o,m=u)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,n=null,i=null,r=null,o=null,a=null,s=null,l=null,u=null}}},s={},l=null,u=null,c=null,h=null,p=null,f=null,m=null,g=null,v=null,y=!1,b=null,_=null,x=null,E=null,w=null,T=e.getParameter(35661),M=!1,S=0,C=e.getParameter(7938);-1!==C.indexOf("WebGL")?(S=parseFloat(/^WebGL\ ([0-9])/.exec(C)[1]),M=S>=1):-1!==C.indexOf("OpenGL ES")&&(S=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(C)[1]),M=S>=2);var A=null,R={},P=new d,D=new d;function k(t,n,i){var r=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var a=0;a<i;a++)e.texImage2D(n+a,0,6408,1,1,0,6408,5121,r);return o}var j={};function O(t){!0!==s[t]&&(e.enable(t),s[t]=!0)}function F(t){!1!==s[t]&&(e.disable(t),s[t]=!1)}j[3553]=k(3553,3553,1),j[34067]=k(34067,34069,6),r.setClear(0,0,0,1),o.setClear(1),a.setClear(0),O(2929),o.setFunc(3),H(!1),z(1),O(2884),N(0);var B={100:32774,101:32778,102:32779};if(i)B[103]=32775,B[104]=32776;else{var L=t.get("EXT_blend_minmax");null!==L&&(B[103]=L.MIN_EXT,B[104]=L.MAX_EXT)}var I={};function N(t,n,i,r,o,a,s,l){if(0!==t){if(u||(O(3042),u=!0),5===t)o=o||n,a=a||i,s=s||r,n===h&&o===m||(e.blendEquationSeparate(B[n],B[o]),h=n,m=o),i===p&&r===f&&a===g&&s===v||(e.blendFuncSeparate(I[i],I[r],I[a],I[s]),p=i,f=r,g=a,v=s),c=t,y=null;else if(t!==c||l!==y){if(100===h&&100===m||(e.blendEquation(32774),h=100,m=100),l)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}p=null,f=null,g=null,v=null,c=t,y=l}}else u&&(F(3042),u=!1)}function H(t){b!==t&&(t?e.frontFace(2304):e.frontFace(2305),b=t)}function z(t){0!==t?(O(2884),t!==_&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):F(2884),_=t}function U(t,n,i){t?(O(32823),E===n&&w===i||(e.polygonOffset(n,i),E=n,w=i)):F(32823)}function V(t){void 0===t&&(t=33984+T-1),A!==t&&(e.activeTexture(t),A=t)}return I[200]=0,I[201]=1,I[202]=768,I[204]=770,I[210]=776,I[208]=774,I[206]=772,I[203]=769,I[205]=771,I[209]=775,I[207]=773,{buffers:{color:r,depth:o,stencil:a},enable:O,disable:F,useProgram:function(t){return l!==t&&(e.useProgram(t),l=t,!0)},setBlending:N,setMaterial:function(e,t){2===e.side?F(2884):O(2884);var n=1===e.side;t&&(n=!n),H(n),1===e.blending&&!1===e.transparent?N(0):N(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),r.setMask(e.colorWrite);var i=e.stencilWrite;a.setTest(i),i&&(a.setMask(e.stencilWriteMask),a.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask,e.stencilFuncBack,e.stencilRefBack,e.stencilFuncMaskBack),a.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass,e.stencilFailBack,e.stencilZFailBack,e.stencilZPassBack)),U(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:H,setCullFace:z,setLineWidth:function(t){t!==x&&(M&&e.lineWidth(t),x=t)},setPolygonOffset:U,setScissorTest:function(e){e?O(3089):F(3089)},activeTexture:V,bindTexture:function(t,n){null===A&&V();var i=R[A];void 0===i&&(i={type:void 0,texture:void 0},R[A]=i),i.type===t&&i.texture===n||(e.bindTexture(t,n||j[t]),i.type=t,i.texture=n)},unbindTexture:function(){var t=R[A];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===P.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),P.copy(t))},viewport:function(t){!1===D.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),D.copy(t))},reset:function(){s={},A=null,R={},l=null,c=null,b=null,_=null,r.reset(),o.reset(),a.reset()}}}function er(e,t,n,i,r,a,s){var l,u=r.isWebGL2,c=r.maxTextures,h=r.maxCubemapSize,p=r.maxTextureSize,d=r.maxSamples,f=new WeakMap,m=!1;try{m="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function g(e,t){return m?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(e,t,n,i){var r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var a=t?o.floorPowerOfTwo:Math.floor,s=a(r*e.width),u=a(r*e.height);void 0===l&&(l=g(s,u));var c=n?g(s,u):l;return c.width=s,c.height=u,c.getContext("2d").drawImage(e,0,0,s,u),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+s+"x"+u+")."),c}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function y(e){return o.isPowerOfTwo(e.width)&&o.isPowerOfTwo(e.height)}function b(e,t){return e.generateMipmaps&&t&&1003!==e.minFilter&&1006!==e.minFilter}function _(t,n,r,o){e.generateMipmap(t),i.get(n).__maxMipLevel=Math.log(Math.max(r,o))*Math.LOG2E}function x(n,i,r){if(!1===u)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var o=i;return 6403===i&&(5126===r&&(o=33326),5131===r&&(o=33325),5121===r&&(o=33321)),6407===i&&(5126===r&&(o=34837),5131===r&&(o=34843),5121===r&&(o=32849)),6408===i&&(5126===r&&(o=34836),5131===r&&(o=34842),5121===r&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||t.get("EXT_color_buffer_float"),o}function E(e){return 1003===e||1004===e||1005===e?9728:9729}function w(t){var n=t.target;n.removeEventListener("dispose",w),function(t){var n=i.get(t);if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture),i.remove(t)}(n),n.isVideoTexture&&f.delete(n),s.memory.textures--}function T(t){var n=t.target;n.removeEventListener("dispose",T),function(t){var n=i.get(t),r=i.get(t.texture);if(!t)return;void 0!==r.__webglTexture&&e.deleteTexture(r.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(var o=0;o<6;o++)e.deleteFramebuffer(n.__webglFramebuffer[o]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[o]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&e.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&!n.__shareDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer);i.remove(t.texture),i.remove(t)}(n),s.memory.textures--}var M=0;function S(e,t){var r=i.get(e);if(e.isVideoTexture&&function(e){var t=s.render.frame;f.get(e)!==t&&(f.set(e,t),e.update())}(e),e.version>0&&r.__version!==e.version){var o=e.image;if(void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==o.complete)return void j(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,r.__webglTexture)}function C(t,r){if(6===t.image.length){var o=i.get(t);if(t.version>0&&o.__version!==t.version){k(o,t),n.activeTexture(33984+r),n.bindTexture(34067,o.__webglTexture),e.pixelStorei(37440,t.flipY);for(var s=t&&(t.isCompressedTexture||t.image[0].isCompressedTexture),l=t.image[0]&&t.image[0].isDataTexture,c=[],p=0;p<6;p++)c[p]=s||l?l?t.image[p].image:t.image[p]:v(t.image[p],!1,!0,h);var d,f=c[0],m=y(f)||u,g=a.convert(t.format),E=a.convert(t.type),w=x(t.internalFormat,g,E);if(D(34067,t,m),s){for(var T=0;T<6;T++){d=c[T].mipmaps;for(var M=0;M<d.length;M++){var S=d[M];1023!==t.format&&1022!==t.format?null!==g?n.compressedTexImage2D(34069+T,M,w,S.width,S.height,0,S.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+T,M,w,S.width,S.height,0,g,E,S.data)}}o.__maxMipLevel=d.length-1}else{d=t.mipmaps;for(var C=0;C<6;C++)if(l){n.texImage2D(34069+C,0,w,c[C].width,c[C].height,0,g,E,c[C].data);for(var A=0;A<d.length;A++){var R=d[A].image[C].image;n.texImage2D(34069+C,A+1,w,R.width,R.height,0,g,E,R.data)}}else{n.texImage2D(34069+C,0,w,g,E,c[C]);for(var P=0;P<d.length;P++){var j=d[P];n.texImage2D(34069+C,P+1,w,g,E,j.image[C])}}o.__maxMipLevel=d.length}b(t,m)&&_(34067,t,f.width,f.height),o.__version=t.version,t.onUpdate&&t.onUpdate(t)}else n.activeTexture(33984+r),n.bindTexture(34067,o.__webglTexture)}}function A(e,t){n.activeTexture(33984+t),n.bindTexture(34067,i.get(e).__webglTexture)}var R={1e3:10497,1001:33071,1002:33648},P={};function D(n,o,a){a?(e.texParameteri(n,10242,R[o.wrapS]),e.texParameteri(n,10243,R[o.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,R[o.wrapR]),e.texParameteri(n,10240,P[o.magFilter]),e.texParameteri(n,10241,P[o.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),1001===o.wrapS&&1001===o.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,E(o.magFilter)),e.texParameteri(n,10241,E(o.minFilter)),1003!==o.minFilter&&1006!==o.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var s=t.get("EXT_texture_filter_anisotropic");if(s){if(1015===o.type&&null===t.get("OES_texture_float_linear"))return;if(1016===o.type&&null===(u||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||i.get(o).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,r.getMaxAnisotropy())),i.get(o).__currentAnisotropy=o.anisotropy)}}function k(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",w),t.__webglTexture=e.createTexture(),s.memory.textures++)}function j(t,i,r){var o=3553;i.isDataTexture2DArray&&(o=35866),i.isDataTexture3D&&(o=32879),k(t,i),n.activeTexture(33984+r),n.bindTexture(o,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment);var s,l=function(e){return!u&&(1001!==e.wrapS||1001!==e.wrapT||1003!==e.minFilter&&1006!==e.minFilter)}(i)&&!1===y(i.image),c=v(i.image,l,!1,p),h=y(c)||u,d=a.convert(i.format),f=a.convert(i.type),m=x(i.internalFormat,d,f);D(o,i,h);var g=i.mipmaps;if(i.isDepthTexture)m=6402,u?m=1015===i.type?36012:1014===i.type?33190:1020===i.type?35056:33189:1015===i.type&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),1026===i.format&&6402===m&&1012!==i.type&&1014!==i.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=1012,f=a.convert(i.type)),1027===i.format&&6402===m&&(m=34041,1020!==i.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=1020,f=a.convert(i.type))),n.texImage2D(3553,0,m,c.width,c.height,0,d,f,null);else if(i.isDataTexture)if(g.length>0&&h){for(var E=0,w=g.length;E<w;E++)s=g[E],n.texImage2D(3553,E,m,s.width,s.height,0,d,f,s.data);i.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else n.texImage2D(3553,0,m,c.width,c.height,0,d,f,c.data),t.__maxMipLevel=0;else if(i.isCompressedTexture){for(var T=0,M=g.length;T<M;T++)s=g[T],1023!==i.format&&1022!==i.format?null!==d?n.compressedTexImage2D(3553,T,m,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,T,m,s.width,s.height,0,d,f,s.data);t.__maxMipLevel=g.length-1}else if(i.isDataTexture2DArray)n.texImage3D(35866,0,m,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(32879,0,m,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(g.length>0&&h){for(var S=0,C=g.length;S<C;S++)s=g[S],n.texImage2D(3553,S,m,d,f,s);i.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else n.texImage2D(3553,0,m,d,f,c),t.__maxMipLevel=0;b(i,h)&&_(o,i,c.width,c.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}function O(t,r,o,s){var l=a.convert(r.texture.format),u=a.convert(r.texture.type),c=x(r.texture.internalFormat,l,u);n.texImage2D(s,0,c,r.width,r.height,0,l,u,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,o,s,i.get(r.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function F(t,n,i){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){var r=33189;if(i){var o=n.depthTexture;o&&o.isDepthTexture&&(1015===o.type?r=36012:1014===o.type&&(r=33190));var s=L(n);e.renderbufferStorageMultisample(36161,s,r,n.width,n.height)}else e.renderbufferStorage(36161,r,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(i){var l=L(n);e.renderbufferStorageMultisample(36161,l,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{var u=a.convert(n.texture.format),c=a.convert(n.texture.type),h=x(n.texture.internalFormat,u,c);if(i){var p=L(n);e.renderbufferStorageMultisample(36161,p,h,n.width,n.height)}else e.renderbufferStorage(36161,h,n.width,n.height)}e.bindRenderbuffer(36161,null)}function B(t){var n=i.get(t),r=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),S(n.depthTexture,0);var r=i.get(n.depthTexture).__webglTexture;if(1026===n.depthTexture.format)e.framebufferTexture2D(36160,36096,3553,r,0);else{if(1027!==n.depthTexture.format)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,r,0)}}(n.__webglFramebuffer,t)}else if(r){n.__webglDepthbuffer=[];for(var o=0;o<6;o++)e.bindFramebuffer(36160,n.__webglFramebuffer[o]),n.__webglDepthbuffer[o]=e.createRenderbuffer(),F(n.__webglDepthbuffer[o],t,!1)}else e.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),F(n.__webglDepthbuffer,t,!1);e.bindFramebuffer(36160,null)}function L(e){return u&&e.isWebGLMultisampleRenderTarget?Math.min(d,e.samples):0}P[1003]=9728,P[1004]=9984,P[1005]=9986,P[1006]=9729,P[1007]=9985,P[1008]=9987;var I=!1,N=!1;this.allocateTextureUnit=function(){var e=M;return e>=c&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+c),M+=1,e},this.resetTextureUnits=function(){M=0},this.setTexture2D=S,this.setTexture2DArray=function(e,t){var r=i.get(e);e.version>0&&r.__version!==e.version?j(r,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){var r=i.get(e);e.version>0&&r.__version!==e.version?j(r,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=C,this.setTextureCubeDynamic=A,this.setupRenderTarget=function(t){var r=i.get(t),o=i.get(t.texture);t.addEventListener("dispose",T),o.__webglTexture=e.createTexture(),s.memory.textures++;var l=!0===t.isWebGLCubeRenderTarget,c=!0===t.isWebGLMultisampleRenderTarget,h=y(t)||u;if(!u||1022!==t.texture.format||1015!==t.texture.type&&1016!==t.texture.type||(t.texture.format=1023,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),l){r.__webglFramebuffer=[];for(var p=0;p<6;p++)r.__webglFramebuffer[p]=e.createFramebuffer()}else if(r.__webglFramebuffer=e.createFramebuffer(),c)if(u){r.__webglMultisampledFramebuffer=e.createFramebuffer(),r.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,r.__webglColorRenderbuffer);var d=a.convert(t.texture.format),f=a.convert(t.texture.type),m=x(t.texture.internalFormat,d,f),g=L(t);e.renderbufferStorageMultisample(36161,g,m,t.width,t.height),e.bindFramebuffer(36160,r.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,r.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(t.webglDepthRenderbuffer?(r.__webglDepthRenderbuffer=t.webglDepthRenderbuffer,r.__shareDepthRenderbuffer=!0):r.__webglDepthRenderbuffer=e.createRenderbuffer(),F(r.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(l){n.bindTexture(34067,o.__webglTexture),D(34067,t.texture,h);for(var v=0;v<6;v++)O(r.__webglFramebuffer[v],t,36064,34069+v);b(t.texture,h)&&_(34067,t.texture,t.width,t.height),n.bindTexture(34067,null)}else n.bindTexture(3553,o.__webglTexture),D(3553,t.texture,h),O(r.__webglFramebuffer,t,36064,3553),b(t.texture,h)&&_(3553,t.texture,t.width,t.height),n.bindTexture(3553,null);t.depthBuffer&&B(t)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(b(t,y(e)||u)){var r=e.isWebGLCubeRenderTarget?34067:3553,o=i.get(t).__webglTexture;n.bindTexture(r,o),_(r,t,e.width,e.height),n.bindTexture(r,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(u){var n=i.get(t);e.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,n.__webglFramebuffer);var r=t.width,o=t.height,a=16384;t.depthBuffer&&(a|=256),t.stencilBuffer&&(a|=1024),e.blitFramebuffer(0,0,r,o,0,0,r,o,a,9728),e.bindFramebuffer(36160,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===I&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),I=!0),e=e.texture),S(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===N&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),N=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?C(e,t):A(e,t)}}function tr(e,t,n){var i=n.isWebGL2;return{convert:function(e){var n;if(1009===e)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(1012===e)return 5123;if(1013===e)return 5124;if(1014===e)return 5125;if(1015===e)return 5126;if(1016===e)return i?5131:null!==(n=t.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(1021===e)return 6406;if(1022===e)return 6407;if(1023===e)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(1026===e)return 6402;if(1027===e)return 34041;if(1028===e)return 6403;if(1029===e)return 36244;if(1030===e)return 33319;if(1031===e)return 33320;if(1032===e)return 36248;if(1033===e)return 36249;if(33776===e||33777===e||33778===e||33779===e){if(null===(n=t.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===e)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===e||35841===e||35842===e||35843===e){if(null===(n=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===e)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e)return null!==(n=t.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===e||37496===e)&&null!==(n=t.get("WEBGL_compressed_texture_etc"))){if(37492===e)return n.COMPRESSED_RGB8_ETC2;if(37496===e)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e||37840===e||37841===e||37842===e||37843===e||37844===e||37845===e||37846===e||37847===e||37848===e||37849===e||37850===e||37851===e||37852===e||37853===e?null!==(n=t.get("WEBGL_compressed_texture_astc"))?e:null:36492===e?null!==(n=t.get("EXT_texture_compression_bptc"))?e:null:1020===e?i?34042:null!==(n=t.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function nr(e){Wt.call(this),this.cameras=e||[]}function ir(){be.call(this),this.type="Group"}function rr(){this._targetRay=null,this._grip=null,this._hand=null}function or(e,t){var n=this,i=null,r=1,o=null,a="local-floor",s=null,l=[],u=new Map,c=new Wt;c.layers.enable(1),c.viewport=new d;var h=new Wt;h.layers.enable(2),h.viewport=new d;var p=[c,h],f=new nr;f.layers.enable(1),f.layers.enable(2);var m=null,g=null;function v(e){var t=u.get(e.inputSource);t&&t.dispatchEvent({type:e.type})}function y(){u.forEach((function(e,t){e.disconnect(t)})),u.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),S.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function _(e){o=e,S.setContext(i),S.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}function x(e){for(var t=i.inputSources,n=0;n<l.length;n++)u.set(t[n],l[n]);for(var r=0;r<e.removed.length;r++){var o=e.removed[r],a=u.get(o);a&&(a.dispatchEvent({type:"disconnected",data:o}),u.delete(o))}for(var s=0;s<e.added.length;s++){var c=e.added[s],h=u.get(c);h&&h.dispatchEvent({type:"connected",data:c})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){var t=l[e];return void 0===t&&(t=new rr,l[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){var t=l[e];return void 0===t&&(t=new rr,l[e]=t),t.getGripSpace()},this.getHand=function(e){var t=l[e];return void 0===t&&(t=new rr,l[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return i},this.setSession=function(e){if(null!==(i=e)){i.addEventListener("select",v),i.addEventListener("selectstart",v),i.addEventListener("selectend",v),i.addEventListener("squeeze",v),i.addEventListener("squeezestart",v),i.addEventListener("squeezeend",v),i.addEventListener("end",y);var n=t.getContextAttributes();!0!==n.xrCompatible&&t.makeXRCompatible();var o={antialias:n.antialias,alpha:n.alpha,depth:n.depth,stencil:n.stencil,framebufferScaleFactor:r},s=new XRWebGLLayer(i,t,o);i.updateRenderState({baseLayer:s}),i.requestReferenceSpace(a).then(_),i.addEventListener("inputsourceschange",x)}};var E=new b,w=new b;function T(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}this.getCamera=function(e){f.near=h.near=c.near=e.near,f.far=h.far=c.far=e.far,m===f.near&&g===f.far||(i.updateRenderState({depthNear:f.near,depthFar:f.far}),m=f.near,g=f.far);var t=e,n=f.cameras;T(f,t);for(var r=0;r<n.length;r++)T(n[r],t);e.matrixWorld.copy(f.matrixWorld);for(var o=e.children,a=0,s=o.length;a<s;a++)o[a].updateMatrixWorld(!0);return 2===n.length?function(e,t,n){E.setFromMatrixPosition(t.matrixWorld),w.setFromMatrixPosition(n.matrixWorld);var i=E.distanceTo(w),r=t.projectionMatrix.elements,o=n.projectionMatrix.elements,a=r[14]/(r[10]-1),s=r[14]/(r[10]+1),l=(r[9]+1)/r[5],u=(r[9]-1)/r[5],c=(r[8]-1)/r[0],h=(o[8]+1)/o[0],p=a*c,d=a*h,f=i/(-c+h),m=f*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var g=a+f,v=s+f,y=p-m,b=d+(i-m),_=l*s/v*g,x=u*s/v*g;e.projectionMatrix.makePerspective(y,b,_,x,g,v)}(f,c,h):f.projectionMatrix.copy(c.projectionMatrix),f};var M=null;var S=new $t;S.setAnimationLoop((function(t,n){if(null!==(s=n.getViewerPose(o))){var r=s.views,a=i.renderState.baseLayer;e.setFramebuffer(a.framebuffer);var u=!1;r.length!==f.cameras.length&&(f.cameras.length=0,u=!0);for(var c=0;c<r.length;c++){var h=r[c],d=a.getViewport(h),m=p[c];m.matrix.fromArray(h.transform.matrix),m.projectionMatrix.fromArray(h.projectionMatrix),m.viewport.set(d.x,d.y,d.width,d.height),0===c&&f.matrix.copy(m.matrix),!0===u&&f.cameras.push(m)}}for(var g=i.inputSources,v=0;v<l.length;v++){var y=l[v],b=g[v];y.update(b,n,o)}M&&M(t,n)})),this.setAnimationLoop=function(e){M=e},this.dispose=function(){}}function ar(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap);var i,r,o=e.get(n).envMap;if(o){t.envMap.value=o,t.flipEnvMap.value=o.isCubeTexture?-1:1,t.reflectivity.value=n.reflectivity,t.refractionRatio.value=n.refractionRatio;var a=e.get(o).__maxMipLevel;void 0!==a&&(t.maxMipLevel.value=a)}n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap?i=n.emissiveMap:n.clearcoatMap?i=n.clearcoatMap:n.clearcoatNormalMap?i=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(i=n.clearcoatRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix)),n.uvTransform&&n.uvTransform.isMatrix3&&t.uvTransform.value.copy(n.uvTransform),n.alphaMap&&(!0===n.alphaMap.matrixAutoUpdate&&n.alphaMap.updateMatrix(),t.uvTransform1.value.copy(n.alphaMap.matrix)),n.alphaMap1&&(!0===n.alphaMap1.matrixAutoUpdate&&n.alphaMap1.updateMatrix(),t.uvTransform1.value.copy(n.alphaMap1.matrix)),n.emissiveMap&&(!0===n.emissiveMap.matrixAutoUpdate&&n.emissiveMap.updateMatrix(),t.uvTransform2.value.copy(n.emissiveMap.matrix)),n.aoMap?r=n.aoMap:n.lightMap&&(r=n.lightMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uv2Transform.value.copy(r.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,1===n.side&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),1===n.side&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias),e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),e.fogAlpha&&(e.fogAlpha.value=t.alpha?t.alpha:1),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,i,r,o){i.isMeshBasicMaterial?t(e,i):i.isMeshLambertMaterial?(t(e,i),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,i)):i.isMeshToonMaterial?(t(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshPhongMaterial?(t(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshStandardMaterial?(t(e,i),i.isMeshPhysicalMaterial?function(e,t){n(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap);t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate());e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap)}(e,i):n(e,i)):i.isMeshMatcapMaterial?(t(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDepthMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDistanceMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,i)):i.isMeshNormalMaterial?(t(e,i),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,n,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*i,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var r;t.map?r=t.map:t.alphaMap&&(r=t.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix));t.uvTransform&&t.uvTransform.isMatrix3&&e.uvTransform.value.copy(t.uvTransform)}(e,i,r,o):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix));t.uvTransform&&t.uvTransform.isMatrix3&&e.uvTransform.value.copy(t.uvTransform)}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function sr(){var e=new Map;this.$mode=0;var t=this;this.setMode=function(e){t.$mode=e},this.getMode=function(){return t.$mode},this.addStrategy=function(t,n){e.set(t,n)},this.getStrategy=function(){return e.get(t.$mode)},this.hasStrategy=function(t){return e.has(t)}}function lr(e){var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==e.context?e.context:null,i=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,s=void 0===e.stencil||e.stencil,l=void 0!==e.antialias&&e.antialias,u=void 0===e.premultipliedAlpha||e.premultipliedAlpha,c=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,h=void 0!==e.powerPreference?e.powerPreference:"default",p=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,f=null,m=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.initRenderList=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var g=this,v=!1,y=null,_=0,x=0,E=null,w=null,T=-1,M=null,S=null,C=new d,A=new d,R=null,P=t.width,D=t.height,k=1,j=null,O=null,F=new d(0,0,P,D),B=new d(0,0,P,D),L=!1,I=new Kt,N=!1,H=!1,z=new X,U=new b,V={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function q(){return null===E?k:1}var G,W,J,Y,Q,Z,K,$,ee,te,ne,ie,re,oe,ae,se,le,ue,ce,he,pe,de=n;function fe(e,n){for(var i=0;i<e.length;i++){var r=e[i],o=t.getContext(r,n);if(null!==o)return o}return null}try{var me={alpha:i,depth:r,stencil:s,antialias:l,premultipliedAlpha:u,preserveDrawingBuffer:c,powerPreference:h,failIfMajorPerformanceCaveat:p};if(t.addEventListener("webglcontextlost",xe,!1),t.addEventListener("webglcontextrestored",Ee,!1),null===de){var ge=["webgl2","webgl","experimental-webgl"];if(!0===g.isWebGL1Renderer&&ge.shift(),null===(de=fe(ge,me)))throw fe(ge)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===de.getShaderPrecisionFormat&&(de.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ve(){G=new dn(de),!1===(W=new cn(de,G,e)).isWebGL2&&(G.get("WEBGL_depth_texture"),G.get("OES_texture_float"),G.get("OES_texture_half_float"),G.get("OES_texture_half_float_linear"),G.get("OES_standard_derivatives"),G.get("OES_element_index_uint"),G.get("OES_vertex_array_object"),G.get("ANGLE_instanced_arrays")),G.get("OES_texture_float_linear"),he=new tr(de,G,W),(J=new $i(de,G,W)).scissor(A.copy(B).multiplyScalar(k).floor()),J.viewport(C.copy(F).multiplyScalar(k).floor()),Y=new gn(de),Q=new Ni,Z=new er(de,G,J,Q,W,he,Y),K=new pn(g),$=new en(de,W),pe=new ln(de,G,$,W),ee=new fn(de,$,Y,pe),te=new _n(de,ee,$,Y),le=new bn(de),ae=new hn(Q),ne=new Ii(g,K,G,W,pe,ae),ie=new ar(Q),re=new Vi(Q),oe=new Yi,se=new sn(g,K,J,te,u),ue=new un(de,G,Y,W),ce=new mn(de,G,Y,W),Y.programs=ne.programs,g.capabilities=W,g.extensions=G,g.properties=Q,g.renderLists=re,g.state=J,g.info=Y,g.state.enableAttribute=function(e){pe.enableAttribute(e)}}ve();var ye=new or(g,de);this.xr=ye;var be=new Ki(g,te,W.maxTextureSize);this.shadowMap=be;var _e=new sr;function xe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function Ee(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1,ve()}function we(e){var t=e.target;t.removeEventListener("dispose",we),function(e){Te(e),Q.remove(e)}(t)}function Te(e){var t=Q.get(e).program;void 0!==t&&ne.releaseProgram(t)}this.materialManager=_e,this.onCustom1Finish=function(){},this.renderCustom1=!0,this.getContext=function(){return de},this.getContextAttributes=function(){return de.getContextAttributes()},this.forceContextLoss=function(){var e=G.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=G.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return k},this.setPixelRatio=function(e){void 0!==e&&(k=e,this.setSize(P,D,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new a),e.set(P,D)},this.setSize=function(e,n,i){ye.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(P=e,D=n,t.width=Math.floor(e*k),t.height=Math.floor(n*k),!1!==i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new a),e.set(P*k,D*k).floor()},this.setDrawingBufferSize=function(e,n,i){P=e,D=n,k=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new d),e.copy(C)},this.getViewport=function(e){return e.copy(F)},this.setViewport=function(e,t,n,i){e.isVector4?F.set(e.x,e.y,e.z,e.w):F.set(e,t,n,i),J.viewport(C.copy(F).multiplyScalar(k).floor())},this.getScissor=function(e){return e.copy(B)},this.setScissor=function(e,t,n,i){e.isVector4?B.set(e.x,e.y,e.z,e.w):B.set(e,t,n,i),J.scissor(A.copy(B).multiplyScalar(k).floor())},this.getScissorTest=function(){return L},this.setScissorTest=function(e){J.setScissorTest(L=e)},this.setOpaqueSort=function(e){j=e},this.setTransparentSort=function(e){O=e},this.getClearColor=function(){return se.getClearColor()},this.setClearColor=function(){se.setClearColor.apply(se,arguments)},this.getClearAlpha=function(){return se.getClearAlpha()},this.setClearAlpha=function(){se.setClearAlpha.apply(se,arguments)},this.clear=function(e,t,n){var i=0;(void 0===e||e)&&(i|=16384),(void 0===t||t)&&(i|=256),(void 0===n||n)&&(i|=1024),de.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",xe,!1),t.removeEventListener("webglcontextrestored",Ee,!1),re.dispose(),oe.dispose(),Q.dispose(),K.dispose(),te.dispose(),pe.dispose(),ye.dispose(),Se.stop()},this.renderBufferImmediate=function(e,t){pe.initAttributes();var n=Q.get(e);e.hasPositions&&!n.position&&(n.position=de.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=de.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=de.createBuffer()),e.hasColors&&!n.color&&(n.color=de.createBuffer());var i=t.getAttributes();e.hasPositions&&(de.bindBuffer(34962,n.position),de.bufferData(34962,e.positionArray,35048),pe.enableAttribute(i.position),de.vertexAttribPointer(i.position,3,5126,!1,0,0)),e.hasNormals&&(de.bindBuffer(34962,n.normal),de.bufferData(34962,e.normalArray,35048),pe.enableAttribute(i.normal),de.vertexAttribPointer(i.normal,3,5126,!1,0,0)),e.hasUvs&&(de.bindBuffer(34962,n.uv),de.bufferData(34962,e.uvArray,35048),pe.enableAttribute(i.uv),de.vertexAttribPointer(i.uv,2,5126,!1,0,0)),e.hasColors&&(de.bindBuffer(34962,n.color),de.bufferData(34962,e.colorArray,35048),pe.enableAttribute(i.color),de.vertexAttribPointer(i.color,3,5126,!1,0,0)),pe.disableUnusedAttributes(),de.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,i,r,o){null===t&&(t=V);var a=r.isMesh&&r.matrixWorld.determinant()<0,s=De(e,t,i,r);J.setMaterial(i,a);var l=n.index,u=n.attributes.position;if(null===l){if(void 0===u||0===u.count)return}else if(0===l.count)return;var c,h=1;!0===i.wireframe&&(l=ee.getWireframeAttribute(n),h=2),(i.morphTargets||i.morphNormals)&&le.update(r,n,i,s),pe.setup(r,i,s,n,l);var p=ue;null!==l&&(c=$.get(l),(p=ce).setIndex(c));var d=null!==l?l.count:u.count,f=n.drawRange.start*h,m=n.drawRange.count*h,g=null!==o?o.start*h:0,v=null!==o?o.count*h:1/0,y=Math.max(f,g),b=Math.min(d,f+m,g+v)-1,_=Math.max(0,b-y+1);if(0!==_){if(r.isMesh)!0===i.wireframe?(J.setLineWidth(i.wireframeLinewidth*q()),p.setMode(1)):p.setMode(4);else if(r.isLine){var x=i.linewidth;void 0===x&&(x=1),J.setLineWidth(x*q()),r.isLineSegments?p.setMode(1):r.isLineLoop?p.setMode(2):p.setMode(3)}else r.isPoints?p.setMode(0):r.isSprite&&p.setMode(4);if(r.isInstancedMesh)p.renderInstances(y,_,r.count);else if(n.isInstancedBufferGeometry){var E=Math.min(n.instanceCount,n._maxInstanceCount);p.renderInstances(y,_,E)}else p.render(y,_)}},this.compile=function(e,t){(m=oe.get(e,t)).init(),e.traverse((function(e){e.isLight&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))})),m.setupLights(t);var n=new WeakMap;e.traverse((function(t){var i=t.material;if(i)if(Array.isArray(i))for(var r=0;r<i.length;r++){var o=i[r];!1===n.has(o)&&(Pe(o,e,t),n.set(o))}else!1===n.has(i)&&(Pe(i,e,t),n.set(i))}))};var Me=null;var Se=new $t;function Ce(e,t,n,i){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)m.pushLight(e),e.castShadow&&m.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||I.intersectsSprite(e)){i&&U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(z);var r=te.update(e),o=e.material;o.visible&&f.push(e,r,o,n,U.z,null)}}else if(e.isImmediateRenderObject)i&&U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(z),f.push(e,null,e.material,n,U.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==Y.render.frame&&(e.skeleton.update(e),e.skeleton.frame=Y.render.frame),!e.frustumCulled||I.intersectsObject(e))){i&&U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(z);var a=te.update(e),s=e.material;if(Array.isArray(s))for(var l=a.groups,u=0,c=l.length;u<c;u++){var h=l[u],p=s[h.materialIndex];p&&p.visible&&f.push(e,a,p,n,U.z,h)}else s.visible&&f.push(e,a,s,n,U.z,null)}for(var d=e.children,g=0,v=d.length;g<v;g++)Ce(d[g],t,n,i)}}function Ae(e,t,n){for(var i=!0===t.isScene?t.overrideMaterial:null,r=0,o=e.length;r<o;r++){var a=e[r],s=a.object,l=a.geometry,u=null===i?a.material:i,c=a.group;if(n.isArrayCamera){S=n;for(var h=n.cameras,p=0,d=h.length;p<d;p++){var f=h[p];s.layers.test(f.layers)&&(J.viewport(C.copy(f.viewport)),m.setupLights(f),Re(s,t,f,l,u,c))}}else S=null,Re(s,t,n,l,u,c)}}function Re(e,t,n,i,r,o){var a;a=e.onBeforeRender(g,t,n,i,r,o);var s=e.onBeforeUpdateModelViewMatrix;if(!s||null!==s.call(e,g,t,n,i,a,o)){if(0!==_e.$mode){var l=_e.getStrategy();l&&(a=l.call(e,this,t,n,i,r,o))}if(null!==a){if(a&&(r=a),m=oe.get(t,S||n),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var u=De(n,t,r,e);J.setMaterial(r),pe.reset(),function(e,t){e.render((function(e){g.renderBufferImmediate(e,t)}))}(e,u)}else g.renderBufferDirect(n,t,i,r,e,o);var c=e.onAfterUpdateModelViewMatrix;c&&null===c.call(e,g,t,n,i,a,o)||(e.onAfterRender(g,t,n,i,r,o),m=oe.get(t,S||n))}}}function Pe(e,t,n){!0!==t.isScene&&(t=V);var i=Q.get(e),r=m.state.lights,o=m.state.shadowsArray,a=r.state.version,s=ne.getParameters(e,r.state,o,t,n),l=ne.getProgramCacheKey(s),u=i.program,c=!0;if(void 0===u)e.addEventListener("dispose",we);else if(u.cacheKey!==l)Te(e);else if(i.lightsStateVersion!==a)c=!1;else{if(void 0!==s.shaderID){var h=e.isMeshStandardMaterial?t.environment:null;return void(i.envMap=K.get(e.envMap||h))}c=!1}c&&(s.uniforms=ne.getUniforms(e),e.onBeforeCompile(s,g),u=ne.acquireProgram(s,l),i.program=u,i.uniforms=s.uniforms,i.outputEncoding=s.outputEncoding);var p=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(i.numClippingPlanes=ae.numPlanes,i.numIntersection=ae.numIntersection,p.clippingPlanes=ae.uniform),i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=K.get(e.envMap||i.environment),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=a,i.needsLights&&(p.ambientLightColor.value=r.state.ambient,p.lightProbe.value=r.state.probe,p.directionalLights.value=r.state.directional,p.directionalLightShadows.value=r.state.directionalShadow,p.spotLights.value=r.state.spot,p.spotLightShadows.value=r.state.spotShadow,p.rectAreaLights.value=r.state.rectArea,p.ltc_1.value=r.state.rectAreaLTC1,p.ltc_2.value=r.state.rectAreaLTC2,p.pointLights.value=r.state.point,p.pointLightShadows.value=r.state.pointShadow,p.hemisphereLights.value=r.state.hemi,p.directionalShadowMap.value=r.state.directionalShadowMap,p.directionalShadowMatrix.value=r.state.directionalShadowMatrix,p.spotShadowMap.value=r.state.spotShadowMap,p.spotShadowMatrix.value=r.state.spotShadowMatrix,p.pointShadowMap.value=r.state.pointShadowMap,p.pointShadowMatrix.value=r.state.pointShadowMatrix);var d=i.program.getUniforms(),f=yi.seqWithValue(d.seq,p);i.uniformsList=f,i.logarithmicDepthBuffer=W.logarithmicDepthBuffer}function De(e,t,n,i){!0!==t.isScene&&(t=V),Z.resetTextureUnits();var r=t.fog,a=n.isMeshStandardMaterial?t.environment:null,s=g.outputEncoding,l=K.get(n.envMap||a),u=Q.get(n),c=m.state.lights;if(!0===N&&(!0===H||e!==M)){var h=e===M&&n.id===T;ae.setState(n,e,h)}n.version===u.__version?n.fog&&u.fog!==r||u.environment!==a||u.needsLights&&u.lightsStateVersion!==c.state.version?Pe(n,t,i):void 0===u.numClippingPlanes||u.numClippingPlanes===ae.numPlanes&&u.numIntersection===ae.numIntersection?u.logarithmicDepthBuffer!==W.logarithmicDepthBuffer?n.needsUpdate=!0:(u.outputEncoding!==s||u.envMap!==l)&&Pe(n,t,i):Pe(n,t,i):(Pe(n,t,i),u.__version=n.version);var p,d,f=!1,v=!1,y=!1,b=u.program,_=b.getUniforms(),x=u.uniforms;if(J.useProgram(b.program)&&(f=!0,v=!0,y=!0),n.id!==T&&(T=n.id,v=!0),f||M!==e){if(_.setValue(de,"projectionMatrix",e.projectionMatrix),W.logarithmicDepthBuffer&&_.setValue(de,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),M!==e&&(M=e,v=!0,y=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){var E=_.map.cameraPosition;void 0!==E&&E.setValue(de,U.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&_.setValue(de,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&_.setValue(de,"viewMatrix",e.matrixWorldInverse)}if(n.skinning){_.setOptional(de,i,"bindMatrix"),_.setOptional(de,i,"bindMatrixInverse");var w=i.skeleton;if(w){var S=w.bones,C=i.bindMatrixInverse.clone();if(C.elements[12]=0,C.elements[13]=0,C.elements[14]=0,_.setValue(de,"localBindMatrixInverse",C),W.floatVertexTextures){if(void 0===w.boneTexture){var A=Math.sqrt(4*S.length);A=o.ceilPowerOfTwo(A),A=Math.max(A,4);var R=new Float32Array(A*A*4);R.set(w.boneMatrices);var P=new Yt(R,A,A,1023,1015);w.boneMatrices=R,w.boneTexture=P,w.boneTextureSize=A}_.setValue(de,"boneTexture",w.boneTexture,Z),_.setValue(de,"boneTextureSize",w.boneTextureSize)}else _.setOptional(de,w,"boneMatrices")}}return(v||u.receiveShadow!==i.receiveShadow)&&(u.receiveShadow=i.receiveShadow,_.setValue(de,"receiveShadow",i.receiveShadow)),v&&(_.setValue(de,"toneMappingExposure",g.toneMappingExposure),u.needsLights&&(d=y,(p=x).ambientLightColor.needsUpdate=d,p.lightProbe.needsUpdate=d,p.directionalLights.needsUpdate=d,p.directionalLightShadows.needsUpdate=d,p.pointLights.needsUpdate=d,p.pointLightShadows.needsUpdate=d,p.spotLights.needsUpdate=d,p.spotLightShadows.needsUpdate=d,p.rectAreaLights.needsUpdate=d,p.hemisphereLights.needsUpdate=d),r&&n.fog&&ie.refreshFogUniforms(x,r),ie.refreshMaterialUniforms(x,n,k,D),yi.upload(de,u.uniformsList,x,Z),n.colorMapping&&_.setValue(de,"colorMapping",n.colorMapping,Z),n.baseQuaternion&&_.setValue(de,"baseQuaternion",n.baseQuaternion),n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)),_.setValue(de,"baseId",n.baseId),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(yi.upload(de,u.uniformsList,x,Z),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&(_.setValue(de,"center",i.center),_.setValue(de,"rotation",i.spriteRotation||n.rotation)),_.setValue(de,"modelViewMatrix",i.modelViewMatrix),_.setValue(de,"normalMatrix",i.normalMatrix),_.setValue(de,"modelMatrix",i.matrixWorld),b}Se.setAnimationLoop((function(e){ye.isPresenting||Me&&Me(e)})),"undefined"!=typeof window&&Se.setContext(window),this.setAnimationLoop=function(e){Me=e,ye.setAnimationLoop(e),null===e?Se.stop():Se.start()},this.render=function(e,t){var n,i;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),i=arguments[3]),void 0===t||!0===t.isCamera){if(!0!==v){if(pe.resetDefaultState(),T=-1,M=null,this.initRenderList){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===ye.enabled&&!0===ye.isPresenting&&(t=ye.getCamera(t)),!0===e.isScene&&e.onBeforeRender(g,e,t,n||E),(m=oe.get(e,t)).init(),z.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),I.setFromProjectionMatrix(z),H=this.localClippingEnabled,N=ae.init(this.clippingPlanes,H,t),(f=re.get(e,t)).init(),Ce(e,t,0,g.sortObjects),f.finish(),!0===g.sortObjects&&f.sort(j,O),!0===N&&ae.beginShadows();var r=m.state.shadowsArray;be.render(r,e,t),m.setupLights(t),!0===N&&ae.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),se.render(f,e,t,i)}else f=re.get(e,t),this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n);var o=f.custom1,a=f.opaque,s=f.transparent;o.length&&this.renderCustom1&&(Ae(o,e,t),this.onCustom1Finish()),a.length>0&&Ae(a,e,t),s.length>0&&Ae(s,e,t),!0===e.isScene&&e.onAfterRender(g,e,t),null!==E&&(Z.updateRenderTargetMipmap(E),Z.updateMultisampleRenderTarget(E)),J.buffers.depth.setTest(!0),J.buffers.depth.setMask(!0),J.buffers.color.setMask(!0),J.setPolygonOffset(!1),f=null,m=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){y!==e&&null===E&&de.bindFramebuffer(36160,e),y=e},this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return x},this.getRenderList=function(){return f},this.setRenderList=function(e){f=e},this.getRenderState=function(){return m},this.setRenderState=function(e){m=e},this.getRenderTarget=function(){return E},this.setRenderTarget=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0),E=e,_=t,x=n,e&&void 0===Q.get(e).__webglFramebuffer&&Z.setupRenderTarget(e);var i=y,r=!1;if(e){var o=Q.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=o[t],r=!0):i=e.isWebGLMultisampleRenderTarget?Q.get(e).__webglMultisampledFramebuffer:o,C.copy(e.viewport),A.copy(e.scissor),R=e.scissorTest}else C.copy(F).multiplyScalar(k).floor(),A.copy(B).multiplyScalar(k).floor(),R=L;if(w!==i&&(de.bindFramebuffer(36160,i),w=i),J.viewport(C),J.scissor(A),J.setScissorTest(R),r){var a=Q.get(e.texture);de.framebufferTexture2D(36160,36064,34069+t,a.__webglTexture,n)}},this.readRenderTargetPixels=function(e,t,n,i,r,o,a){if(e&&e.isWebGLRenderTarget){var s=Q.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(s=s[a]),s){var l=!1;s!==w&&(de.bindFramebuffer(36160,s),l=!0);try{var u=e.texture,c=u.format,h=u.type;if(1023!==c&&he.convert(c)!==de.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(1009===h||he.convert(h)===de.getParameter(35738)||1015===h&&(W.isWebGL2||G.get("OES_texture_float")||G.get("WEBGL_color_buffer_float"))||1016===h&&(W.isWebGL2?G.get("EXT_color_buffer_float"):G.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===de.checkFramebufferStatus(36160)?t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&de.readPixels(t,n,i,r,he.convert(c),he.convert(h),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{l&&de.bindFramebuffer(36160,w)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,n){void 0===n&&(n=0);var i=Math.pow(2,-n),r=Math.floor(t.image.width*i),o=Math.floor(t.image.height*i),a=he.convert(t.format);Z.setTexture2D(t,0),de.copyTexImage2D(3553,n,a,e.x,e.y,r,o,0),J.unbindTexture()},this.copyTextureToTexture=function(e,t,n,i){void 0===i&&(i=0);var r=t.image.width,o=t.image.height,a=he.convert(n.format),s=he.convert(n.type);Z.setTexture2D(n,0),de.pixelStorei(37440,n.flipY),de.pixelStorei(37441,n.premultiplyAlpha),de.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?de.texSubImage2D(3553,i,e.x,e.y,r,o,a,s,t.image.data):t.isCompressedTexture?de.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):de.texSubImage2D(3553,i,e.x,e.y,a,s,t.image),0===i&&n.generateMipmaps&&de.generateMipmap(3553),J.unbindTexture()},this.initTexture=function(e){Z.setTexture2D(e,0),J.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function ur(e){lr.call(this,e)}nr.prototype=Object.assign(Object.create(Wt.prototype),{constructor:nr,isArrayCamera:!0}),ir.prototype=Object.assign(Object.create(be.prototype),{constructor:ir,isGroup:!0}),Object.assign(rr.prototype,{constructor:rr,getHandSpace:function(){if(null===this._hand&&(this._hand=new ir,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints=[],this._hand.inputState={pinching:!1},window.XRHand))for(var e=0;e<=window.XRHand.LITTLE_PHALANX_TIP;e++){var t=new ir;t.matrixAutoUpdate=!1,t.visible=!1,this._hand.joints.push(t),this._hand.add(t)}return this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new ir,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new ir,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this},disconnect:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(e,t,n){var i=null,r=null,o=null,a=this._targetRay,s=this._grip,l=this._hand;if(e)if(l&&e.hand){o=!0;for(var u=0;u<=window.XRHand.LITTLE_PHALANX_TIP;u++)if(e.hand[u]){var c=t.getJointPose(e.hand[u],n),h=l.joints[u];null!==c&&(h.matrix.fromArray(c.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),h.jointRadius=c.radius),h.visible=null!==c;var p=l.joints[window.XRHand.INDEX_PHALANX_TIP],d=l.joints[window.XRHand.THUMB_PHALANX_TIP],f=p.position.distanceTo(d.position);l.inputState.pinching&&f>.025?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&f<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}}else null!==a&&null!==(i=t.getPose(e.targetRaySpace,n))&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)),null!==s&&e.gripSpace&&null!==(r=t.getPose(e.gripSpace,n))&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale));return null!==a&&(a.visible=null!==i),null!==s&&(s.visible=null!==r),null!==l&&(l.visible=null!==o),this}}),Object.assign(or.prototype,t.prototype),ur.prototype=Object.assign(Object.create(lr.prototype),{constructor:ur,isWebGL1Renderer:!0});var cr=function(e,t){Object.defineProperty(this,"isFogExp2",{value:!0}),this.name="",this.color=new ze(e),this.density=void 0!==t?t:25e-5};cr.prototype.clone=function(){return new cr(this.color,this.density)},cr.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};var hr=function(e,t,n){Object.defineProperty(this,"isFog",{value:!0}),this.name="",this.color=new ze(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3};hr.prototype.clone=function(){return new hr(this.color,this.near,this.far)},hr.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}};var pr=function(e){function t(){e.call(this),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.copy=function(t,n){return e.prototype.copy.call(this,t,n),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},t.prototype.toJSON=function(t){var n=e.prototype.toJSON.call(this,t);return null!==this.background&&(n.object.background=this.background.toJSON(t)),null!==this.environment&&(n.object.environment=this.environment.toJSON(t)),null!==this.fog&&(n.object.fog=this.fog.toJSON()),n},t}(be);function dr(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=o.generateUUID()}Object.defineProperty(dr.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(dr.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=o.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var t=new dr(new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),this.stride);return t.setUsage(this.usage),t},onUpload:function(e){return this.onUploadCallback=e,this},toJSON:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=o.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});var fr,mr=new b;function gr(e,t,n,i){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===i}function vr(e){qe.call(this),this.type="SpriteMaterial",this.color=new ze(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}Object.defineProperties(gr.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(e){this.data.needsUpdate=e}}}),Object.assign(gr.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(var t=0,n=this.data.count;t<n;t++)mr.x=this.getX(t),mr.y=this.getY(t),mr.z=this.getZ(t),mr.applyMatrix4(e),this.setXYZ(t,mr.x,mr.y,mr.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this},setXYZW:function(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this},clone:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],n=0;n<this.count;n++)for(var i=n*this.data.stride+this.offset,r=0;r<this.itemSize;r++)t.push(this.data.array[i+r]);return new Je(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new gr(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],n=0;n<this.count;n++)for(var i=n*this.data.stride+this.offset,r=0;r<this.itemSize;r++)t.push(this.data.array[i+r]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),vr.prototype=Object.create(qe.prototype),vr.prototype.constructor=vr,vr.prototype.isSpriteMaterial=!0,vr.prototype.copy=function(e){return qe.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var yr=new b,br=new b,_r=new b,xr=new a,Er=new a,wr=new X,Tr=new b,Mr=new b,Sr=new b,Cr=new a,Ar=new a,Rr=new a;function Pr(e){if(be.call(this),this.type="Sprite",void 0===fr){fr=new dt;var t=new dr(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);fr.setIndex([0,1,2,0,2,3]),fr.setAttribute("position",new gr(t,3,0,!1)),fr.setAttribute("uv",new gr(t,2,3,!1))}this.geometry=fr,this.material=void 0!==e?e:new vr,this.center=new a(.5,.5),this.spriteRotation=0}function Dr(e,t,n,i,r,o){xr.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?(Er.x=o*xr.x-r*xr.y,Er.y=r*xr.x+o*xr.y):Er.copy(xr),e.copy(t),e.x+=Er.x,e.y+=Er.y,e.applyMatrix4(wr)}Pr.prototype=Object.assign(Object.create(be.prototype),{constructor:Pr,isSprite:!0,raycast:function(e,t){if(null!==e.camera){br.setFromMatrixScale(this.matrixWorld),wr.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),_r.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&br.multiplyScalar(-_r.z);var n,i,r=this.spriteRotation||this.material.rotation;0!==r&&(i=Math.cos(r),n=Math.sin(r));var o=this.center;Dr(Tr.set(-.5,-.5,0),_r,o,br,n,i),Dr(Mr.set(.5,-.5,0),_r,o,br,n,i),Dr(Sr.set(.5,.5,0),_r,o,br,n,i),Cr.set(0,0),Ar.set(1,0),Rr.set(1,1);var s=e.ray.intersectTriangle(Tr,Mr,Sr,!1,yr);if(null!==s||(Dr(Mr.set(-.5,.5,0),_r,o,br,n,i),Ar.set(0,1),null!==(s=e.ray.intersectTriangle(Tr,Sr,Mr,!1,yr)))){var l=e.ray.origin.distanceTo(yr);l<e.near||l>e.far||t.push({distance:l,point:yr.clone(),uv:Oe.getUV(yr,Tr,Mr,Sr,Cr,Ar,Rr,new a),face:null,object:this})}}},copy:function(e){return be.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),void 0!==e.spriteRotation&&(this.spriteRotation=e.spriteRotation),this.material=e.material,this}});var kr,jr,Or,Fr,Br,Lr=new b,Ir=new b;function Nr(){be.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function Hr(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Dt.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new X,this.bindMatrixInverse=new X}Nr.prototype=Object.assign(Object.create(be.prototype),{constructor:Nr,isLOD:!0,copy:function(e){be.prototype.copy.call(this,e,!1);for(var t=e.levels,n=0,i=t.length;n<i;n++){var r=t[n];this.addLevel(r.object.clone(),r.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);var n,i=this.levels;for(n=0;n<i.length&&!(t<i[n].distance);n++);return i.splice(n,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){var t=this.levels;if(t.length>0){var n,i;for(n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object}return null},raycast:function(e,t){if(this.levels.length>0){Lr.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(Lr);this.getObjectForDistance(n).raycast(e,t)}},update:function(e){var t=this.levels;if(t.length>1){Lr.setFromMatrixPosition(e.matrixWorld),Ir.setFromMatrixPosition(this.matrixWorld);var n,i,r=Lr.distanceTo(Ir)/e.zoom;for(t[0].object.visible=!0,n=1,i=t.length;n<i&&r>=t[n].distance;n++)t[n-1].object.visible=!1,t[n].object.visible=!0;for(this._currentLevel=n-1;n<i;n++)t[n].object.visible=!1}},toJSON:function(e){var t=be.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var n=this.levels,i=0,r=n.length;i<r;i++){var o=n[i];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),Hr.prototype=Object.assign(Object.create(Dt.prototype),{constructor:Hr,isSkinnedMesh:!0,copy:function(e){return Dt.prototype.copy.call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new d,t=this.geometry.attributes.skinWeight,n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);var r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Dt.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:(kr=new b,jr=new d,Or=new d,Fr=new b,Br=new X,function(e,t){var n=this.skeleton,i=this.geometry;jr.fromBufferAttribute(i.attributes.skinIndex,e),Or.fromBufferAttribute(i.attributes.skinWeight,e),kr.fromBufferAttribute(i.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(var r=0;r<4;r++){var o=Or.getComponent(r);if(0!==o){var a=jr.getComponent(r);Br.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),t.addScaledVector(Fr.copy(kr).applyMatrix4(Br),o)}}return t.applyMatrix4(this.bindMatrixInverse)})});var zr=new X,Ur=new X,Vr=new b;function qr(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new X)}}function Gr(){be.call(this),this.type="Bone"}Object.assign(qr.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new X;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},pose:function(){for(var e=0,t=this.bones.length;e<t;e++){var n=this.bones[e];n&&n.matrixWorld.getInverse(this.boneInverses[e])}for(var i=0,r=this.bones.length;i<r;i++){var o=this.bones[i];o&&(o.parent&&o.parent.isBone?(o.matrix.getInverse(o.parent.matrixWorld),o.matrix.multiply(o.matrixWorld)):o.matrix.copy(o.matrixWorld),o.matrix.decompose(o.position,o.quaternion,o.scale))}},update:function(e){var t=this.bones,n=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;e.getWorldPosition(Vr);for(var o=0,a=t.length;o<a;o++){var s=t[o]?t[o].matrixWorld:Ur;zr.multiplyMatrices(s,n[o]);var l=zr.elements;l[12]-=Vr.x,l[13]-=Vr.y,l[14]-=Vr.z,zr.toArray(i,16*o)}void 0!==r&&(r.needsUpdate=!0)},clone:function(){return new qr(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,n=this.bones.length;t<n;t++){var i=this.bones[t];if(i.name===e)return i}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}}),Gr.prototype=Object.assign(Object.create(be.prototype),{constructor:Gr,isBone:!0});var Wr=new X,Xr=new X,Jr=[],Yr=new Dt;function Qr(e,t,n){Dt.call(this,e,t),this.instanceMatrix=new Je(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}function Zr(e){qe.call(this),this.type="LineBasicMaterial",this.color=new ze(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}Qr.prototype=Object.assign(Object.create(Dt.prototype),{constructor:Qr,isInstancedMesh:!0,copy:function(e){return Dt.prototype.copy.call(this,e),this.instanceMatrix.copy(e.instanceMatrix),this.count=e.count,this},setColorAt:function(e,t){null===this.instanceColor&&(this.instanceColor=new Je(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)},getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){var n=this.matrixWorld,i=this.count;if(Yr.geometry=this.geometry,Yr.material=this.material,void 0!==Yr.material)for(var r=0;r<i;r++){this.getMatrixAt(r,Wr),Xr.multiplyMatrices(n,Wr),Yr.matrixWorld=Xr,Yr.raycast(e,Jr);for(var o=0,a=Jr.length;o<a;o++){var s=Jr[o];s.instanceId=r,s.object=this,t.push(s)}Jr.length=0}},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){}}),Zr.prototype=Object.create(qe.prototype),Zr.prototype.constructor=Zr,Zr.prototype.isLineBasicMaterial=!0,Zr.prototype.copy=function(e){return qe.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this};var Kr=new b,$r=new b,eo=new X,to=new W,no=new I;function io(e,t,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),be.call(this),this.type="Line",this.geometry=void 0!==e?e:new dt,this.material=void 0!==t?t:new Zr,this.updateMorphTargets()}io.prototype=Object.assign(Object.create(be.prototype),{constructor:io,isLine:!0,copy:function(e){return be.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[0],i=1,r=t.count;i<r;i++)Kr.fromBufferAttribute(t,i-1),$r.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=Kr.distanceTo($r);e.setAttribute("lineDistance",new nt(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices,a=e.lineDistances;a[0]=0;for(var s=1,l=o.length;s<l;s++)a[s]=a[s-1],a[s]+=o[s-1].distanceTo(o[s])}return this},raycast:function(e,t){var n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),no.copy(n.boundingSphere),no.applyMatrix4(i),no.radius+=r,!1!==e.ray.intersectsSphere(no)){eo.getInverse(i),to.copy(e.ray).applyMatrix4(eo);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,s=new b,l=new b,u=new b,c=new b,h=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){var p=n.index,d=n.attributes.position.array;if(null!==p)for(var f=p.array,m=0,g=f.length-1;m<g;m+=h){var v=f[m],y=f[m+1];if(s.fromArray(d,3*v),l.fromArray(d,3*y),!(to.distanceSqToSegment(s,l,c,u)>a)){c.applyMatrix4(this.matrixWorld);var _=e.ray.origin.distanceTo(c);_<e.near||_>e.far||t.push({distance:_,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else for(var x=0,E=d.length/3-1;x<E;x+=h){if(s.fromArray(d,3*x),l.fromArray(d,3*x+3),!(to.distanceSqToSegment(s,l,c,u)>a)){c.applyMatrix4(this.matrixWorld);var w=e.ray.origin.distanceTo(c);w<e.near||w>e.far||t.push({distance:w,point:u.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}else if(n.isGeometry)for(var T=n.vertices,M=T.length,S=0;S<M-1;S+=h){if(!(to.distanceSqToSegment(T[S],T[S+1],c,u)>a)){c.applyMatrix4(this.matrixWorld);var C=e.ray.origin.distanceTo(c);C<e.near||C>e.far||t.push({distance:C,point:u.clone().applyMatrix4(this.matrixWorld),index:S,face:null,faceIndex:null,object:this})}}}},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var i=t[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,o=i.length;r<o;r++){var a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});var ro=new b,oo=new b;function ao(e,t){io.call(this,e,t),this.type="LineSegments"}function so(e,t){io.call(this,e,t),this.type="LineLoop"}function lo(e){qe.call(this),this.type="PointsMaterial",this.color=new ze(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}ao.prototype=Object.assign(Object.create(io.prototype),{constructor:ao,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[],i=0,r=t.count;i<r;i+=2)ro.fromBufferAttribute(t,i),oo.fromBufferAttribute(t,i+1),n[i]=0===i?0:n[i-1],n[i+1]=n[i]+ro.distanceTo(oo);e.setAttribute("lineDistance",new nt(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry)for(var o=e.vertices,a=e.lineDistances,s=0,l=o.length;s<l;s+=2)ro.copy(o[s]),oo.copy(o[s+1]),a[s]=0===s?0:a[s-1],a[s+1]=a[s]+ro.distanceTo(oo);return this}}),so.prototype=Object.assign(Object.create(io.prototype),{constructor:so,isLineLoop:!0}),lo.prototype=Object.create(qe.prototype),lo.prototype.constructor=lo,lo.prototype.isPointsMaterial=!0,lo.prototype.copy=function(e){return qe.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var uo=new X,co=new W,ho=new I,po=new b;function fo(e,t){be.call(this),this.type="Points",this.geometry=void 0!==e?e:new dt,this.material=void 0!==t?t:new lo,this.updateMorphTargets()}function mo(e,t,n,i,r,o,a){var s=co.distanceSqToPoint(e);if(s<n){var l=new b;co.closestPointToPoint(e,l),l.applyMatrix4(i);var u=r.ray.origin.distanceTo(l);if(u<r.near||u>r.far)return;o.push({distance:u,distanceToRay:Math.sqrt(s),point:l,index:t,face:null,object:a})}}function go(e,t,n,i,r,o,a,s,l){p.call(this,e,t,n,i,r,o,a,s,l),this.format=void 0!==a?a:1022,this.minFilter=void 0!==o?o:1006,this.magFilter=void 0!==r?r:1006,this.generateMipmaps=!1;var u=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){u.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}function vo(e,t,n,i,r,o,a,s,l,u,c,h){p.call(this,null,o,a,s,l,u,i,r,c,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function yo(e,t,n,i,r,o,a,s,l){p.call(this,e,t,n,i,r,o,a,s,l),this.needsUpdate=!0}function bo(e,t,n,i,r,o,a,s,l,u){if(1026!==(u=void 0!==u?u:1026)&&1027!==u)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&1026===u&&(n=1012),void 0===n&&1027===u&&(n=1020),p.call(this,null,i,r,o,a,s,u,n,l),this.image={width:e,height:t},this.magFilter=void 0!==a?a:1003,this.minFilter=void 0!==s?s:1003,this.flipY=!1,this.generateMipmaps=!1}fo.prototype=Object.assign(Object.create(be.prototype),{constructor:fo,isPoints:!0,copy:function(e){return be.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},raycast:function(e,t){var n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),ho.copy(n.boundingSphere),ho.applyMatrix4(i),ho.radius+=r,!1!==e.ray.intersectsSphere(ho)){uo.getInverse(i),co.copy(e.ray).applyMatrix4(uo);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(n.isBufferGeometry){var s=n.index,l=n.attributes.position.array;if(null!==s)for(var u=s.array,c=0,h=u.length;c<h;c++){var p=u[c];po.fromArray(l,3*p),mo(po,p,a,i,e,t,this)}else for(var d=0,f=l.length/3;d<f;d++)po.fromArray(l,3*d),mo(po,d,a,i,e,t,this)}else for(var m=n.vertices,g=0,v=m.length;g<v;g++)mo(m[g],g,a,i,e,t,this)}},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var i=t[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,o=i.length;r<o;r++){var a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),go.prototype=Object.assign(Object.create(p.prototype),{constructor:go,isVideoTexture:!0,update:function(){var e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),vo.prototype=Object.create(p.prototype),vo.prototype.constructor=vo,vo.prototype.isCompressedTexture=!0,yo.prototype=Object.create(p.prototype),yo.prototype.constructor=yo,yo.prototype.isCanvasTexture=!0,bo.prototype=Object.create(p.prototype),bo.prototype.constructor=bo,bo.prototype.isDepthTexture=!0;var _o=function(e){function t(t){e.call(this),this.type="WireframeGeometry";var n=[],i=[0,0],r={},o=["a","b","c"];if(t&&t.isGeometry){for(var a=t.faces,s=0,l=a.length;s<l;s++)for(var u=a[s],c=0;c<3;c++){var h=u[o[c]],p=u[o[(c+1)%3]];i[0]=Math.min(h,p),i[1]=Math.max(h,p);var d=i[0]+","+i[1];void 0===r[d]&&(r[d]={index1:i[0],index2:i[1]})}for(var f in r){var m=r[f],g=t.vertices[m.index1];n.push(g.x,g.y,g.z),g=t.vertices[m.index2],n.push(g.x,g.y,g.z)}}else if(t&&t.isBufferGeometry){var v=new b;if(null!==t.index){var y=t.attributes.position,_=t.index,x=t.groups;0===x.length&&(x=[{start:0,count:_.count,materialIndex:0}]);for(var E=0,w=x.length;E<w;++E)for(var T=x[E],M=T.start,S=M,C=M+T.count;S<C;S+=3)for(var A=0;A<3;A++){var R=_.getX(S+A),P=_.getX(S+(A+1)%3);i[0]=Math.min(R,P),i[1]=Math.max(R,P);var D=i[0]+","+i[1];void 0===r[D]&&(r[D]={index1:i[0],index2:i[1]})}for(var k in r){var j=r[k];v.fromBufferAttribute(y,j.index1),n.push(v.x,v.y,v.z),v.fromBufferAttribute(y,j.index2),n.push(v.x,v.y,v.z)}}else for(var O=t.attributes.position,F=0,B=O.count/3;F<B;F++)for(var L=0;L<3;L++){var I=3*F+L;v.fromBufferAttribute(O,I),n.push(v.x,v.y,v.z);var N=3*F+(L+1)%3;v.fromBufferAttribute(O,N),n.push(v.x,v.y,v.z)}}this.setAttribute("position",new nt(n,3))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt);function xo(e,t,n){It.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n},this.fromBufferGeometry(new Eo(e,t,n)),this.mergeVertices()}function Eo(e,t,n){dt.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};var i=[],r=[],o=[],a=[],s=1e-5,l=new b,u=new b,c=new b,h=new b,p=new b;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");for(var d=t+1,f=0;f<=n;f++)for(var m=f/n,g=0;g<=t;g++){var v=g/t;e(v,m,u),r.push(u.x,u.y,u.z),v-s>=0?(e(v-s,m,c),h.subVectors(u,c)):(e(v+s,m,c),h.subVectors(c,u)),m-s>=0?(e(v,m-s,c),p.subVectors(u,c)):(e(v,m+s,c),p.subVectors(c,u)),l.crossVectors(h,p).normalize(),o.push(l.x,l.y,l.z),a.push(v,m)}for(var y=0;y<n;y++)for(var _=0;_<t;_++){var x=y*d+_,E=y*d+_+1,w=(y+1)*d+_+1,T=(y+1)*d+_;i.push(x,E,T),i.push(E,w,T)}this.setIndex(i),this.setAttribute("position",new nt(r,3)),this.setAttribute("normal",new nt(o,3)),this.setAttribute("uv",new nt(a,2))}xo.prototype=Object.create(It.prototype),xo.prototype.constructor=xo,Eo.prototype=Object.create(dt.prototype),Eo.prototype.constructor=Eo;var wo=function(e){function t(t,n,i,r){e.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:n,radius:i,detail:r},this.fromBufferGeometry(new To(t,n,i,r)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),To=function(e){function t(t,n,i,r){e.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:n,radius:i,detail:r},i=i||1;var o=[],s=[];function l(e,t,n,i){for(var r=Math.pow(2,i),o=[],a=0;a<=r;a++){o[a]=[];for(var s=e.clone().lerp(n,a/r),l=t.clone().lerp(n,a/r),c=r-a,h=0;h<=c;h++)o[a][h]=0===h&&a===r?s:s.clone().lerp(l,h/c)}for(var p=0;p<r;p++)for(var d=0;d<2*(r-p)-1;d++){var f=Math.floor(d/2);d%2==0?(u(o[p][f+1]),u(o[p+1][f]),u(o[p][f])):(u(o[p][f+1]),u(o[p+1][f+1]),u(o[p+1][f]))}}function u(e){o.push(e.x,e.y,e.z)}function c(e,n){var i=3*e;n.x=t[i+0],n.y=t[i+1],n.z=t[i+2]}function h(e,t,n,i){i<0&&1===e.x&&(s[t]=e.x-1),0===n.x&&0===n.z&&(s[t]=i/2/Math.PI+.5)}function p(e){return Math.atan2(e.z,-e.x)}function d(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}!function(e){for(var t=new b,i=new b,r=new b,o=0;o<n.length;o+=3)c(n[o+0],t),c(n[o+1],i),c(n[o+2],r),l(t,i,r,e)}(r=r||0),function(e){for(var t=new b,n=0;n<o.length;n+=3)t.x=o[n+0],t.y=o[n+1],t.z=o[n+2],t.normalize().multiplyScalar(e),o[n+0]=t.x,o[n+1]=t.y,o[n+2]=t.z}(i),function(){for(var e=new b,t=0;t<o.length;t+=3){e.x=o[t+0],e.y=o[t+1],e.z=o[t+2];var n=p(e)/2/Math.PI+.5,i=d(e)/Math.PI+.5;s.push(n,1-i)}(function(){for(var e=new b,t=new b,n=new b,i=new b,r=new a,l=new a,u=new a,c=0,d=0;c<o.length;c+=9,d+=6){e.set(o[c+0],o[c+1],o[c+2]),t.set(o[c+3],o[c+4],o[c+5]),n.set(o[c+6],o[c+7],o[c+8]),r.set(s[d+0],s[d+1]),l.set(s[d+2],s[d+3]),u.set(s[d+4],s[d+5]),i.copy(e).add(t).add(n).divideScalar(3);var f=p(i);h(r,d+0,e,f),h(l,d+2,t,f),h(u,d+4,n,f)}})(),function(){for(var e=0;e<s.length;e+=6){var t=s[e+0],n=s[e+2],i=s[e+4],r=Math.max(t,n,i),o=Math.min(t,n,i);r>.9&&o<.1&&(t<.2&&(s[e+0]+=1),n<.2&&(s[e+2]+=1),i<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new nt(o,3)),this.setAttribute("normal",new nt(o.slice(),3)),this.setAttribute("uv",new nt(s,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt),Mo=function(e){function t(t,n){e.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:n},this.fromBufferGeometry(new So(t,n)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),So=function(e){function t(t,n){e.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,n),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:n}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(To),Co=function(e){function t(t,n){e.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:n},this.fromBufferGeometry(new Ao(t,n)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Ao=function(e){function t(t,n){e.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,n),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:n}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(To),Ro=function(e){function t(t,n){e.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:n},this.fromBufferGeometry(new Po(t,n)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Po=function(e){function t(t,n){var i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1];e.call(this,r,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,n),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:n}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(To),Do=function(e){function t(t,n){e.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:n},this.fromBufferGeometry(new ko(t,n)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),ko=function(e){function t(t,n){var i=(1+Math.sqrt(5))/2,r=1/i,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r];e.call(this,o,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,n),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:n}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(To),jo=function(e){function t(t,n,i,r,o,a){e.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:n,radius:i,radialSegments:r,closed:o},void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed.");var s=new Oo(t,n,i,r,o);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals,this.fromBufferGeometry(s),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Oo=function(e){function t(t,n,i,r,o){e.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:n,radius:i,radialSegments:r,closed:o},n=n||64,i=i||1,r=r||8,o=o||!1;var s=t.computeFrenetFrames(n,o);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;var l=new b,u=new b,c=new a,h=new b,p=[],d=[],f=[],m=[];function g(e){h=t.getPointAt(e/n,h);for(var o=s.normals[e],a=s.binormals[e],c=0;c<=r;c++){var f=c/r*Math.PI*2,m=Math.sin(f),g=-Math.cos(f);u.x=g*o.x+m*a.x,u.y=g*o.y+m*a.y,u.z=g*o.z+m*a.z,u.normalize(),d.push(u.x,u.y,u.z),l.x=h.x+i*u.x,l.y=h.y+i*u.y,l.z=h.z+i*u.z,p.push(l.x,l.y,l.z)}}!function(){for(var e=0;e<n;e++)g(e);g(!1===o?n:0),function(){for(var e=0;e<=n;e++)for(var t=0;t<=r;t++)c.x=e/n,c.y=t/r,f.push(c.x,c.y)}(),function(){for(var e=1;e<=n;e++)for(var t=1;t<=r;t++){var i=(r+1)*(e-1)+(t-1),o=(r+1)*e+(t-1),a=(r+1)*e+t,s=(r+1)*(e-1)+t;m.push(i,o,s),m.push(o,a,s)}}()}(),this.setIndex(m),this.setAttribute("position",new nt(p,3)),this.setAttribute("normal",new nt(d,3)),this.setAttribute("uv",new nt(f,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t},t}(dt),Fo=function(e){function t(t,n,i,r,o,a,s){e.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:n,tubularSegments:i,radialSegments:r,p:o,q:a},void 0!==s&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Bo(t,n,i,r,o,a)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Bo=function(e){function t(t,n,i,r,o,a){e.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:n,tubularSegments:i,radialSegments:r,p:o,q:a},t=t||1,n=n||.4,i=Math.floor(i)||64,r=Math.floor(r)||8,o=o||2,a=a||3;for(var s=[],l=[],u=[],c=[],h=new b,p=new b,d=new b,f=new b,m=new b,g=new b,v=new b,y=0;y<=i;++y){var _=y/i*o*Math.PI*2;D(_,o,a,t,d),D(_+.01,o,a,t,f),g.subVectors(f,d),v.addVectors(f,d),m.crossVectors(g,v),v.crossVectors(m,g),m.normalize(),v.normalize();for(var x=0;x<=r;++x){var E=x/r*Math.PI*2,w=-n*Math.cos(E),T=n*Math.sin(E);h.x=d.x+(w*v.x+T*m.x),h.y=d.y+(w*v.y+T*m.y),h.z=d.z+(w*v.z+T*m.z),l.push(h.x,h.y,h.z),p.subVectors(h,d).normalize(),u.push(p.x,p.y,p.z),c.push(y/i),c.push(x/r)}}for(var M=1;M<=i;M++)for(var S=1;S<=r;S++){var C=(r+1)*(M-1)+(S-1),A=(r+1)*M+(S-1),R=(r+1)*M+S,P=(r+1)*(M-1)+S;s.push(C,A,P),s.push(A,R,P)}function D(e,t,n,i,r){var o=Math.cos(e),a=Math.sin(e),s=n/t*e,l=Math.cos(s);r.x=i*(2+l)*.5*o,r.y=i*(2+l)*a*.5,r.z=i*Math.sin(s)*.5}this.setIndex(s),this.setAttribute("position",new nt(l,3)),this.setAttribute("normal",new nt(u,3)),this.setAttribute("uv",new nt(c,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt),Lo=function(e){function t(t,n,i,r,o){e.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:n,radialSegments:i,tubularSegments:r,arc:o},this.fromBufferGeometry(new Io(t,n,i,r,o)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Io=function(e){function t(t,n,i,r,o){e.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:n,radialSegments:i,tubularSegments:r,arc:o},t=t||1,n=n||.4,i=Math.floor(i)||8,r=Math.floor(r)||6,o=o||2*Math.PI;for(var a=[],s=[],l=[],u=[],c=new b,h=new b,p=new b,d=0;d<=i;d++)for(var f=0;f<=r;f++){var m=f/r*o,g=d/i*Math.PI*2;h.x=(t+n*Math.cos(g))*Math.cos(m),h.y=(t+n*Math.cos(g))*Math.sin(m),h.z=n*Math.sin(g),s.push(h.x,h.y,h.z),c.x=t*Math.cos(m),c.y=t*Math.sin(m),p.subVectors(h,c).normalize(),l.push(p.x,p.y,p.z),u.push(f/r),u.push(d/i)}for(var v=1;v<=i;v++)for(var y=1;y<=r;y++){var _=(r+1)*v+y-1,x=(r+1)*(v-1)+y-1,E=(r+1)*(v-1)+y,w=(r+1)*v+y;a.push(_,x,w),a.push(x,E,w)}this.setIndex(a),this.setAttribute("position",new nt(s,3)),this.setAttribute("normal",new nt(l,3)),this.setAttribute("uv",new nt(u,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt),No=function(e,t,n){n=n||2;var i,r,o,a,s,l,u,c=t&&t.length,h=c?t[0]*n:e.length,p=Ho(e,0,h,n,!0),d=[];if(!p||p.next===p.prev)return d;if(c&&(p=function(e,t,n,i){var r,o,a,s=[];for(r=0,o=t.length;r<o;r++)(a=Ho(e,t[r]*i,r<o-1?t[r+1]*i:e.length,i,!1))===a.next&&(a.steiner=!0),s.push(Zo(a));for(s.sort(Xo),r=0;r<s.length;r++)Jo(s[r],n),n=zo(n,n.next);return n}(e,t,p,n)),e.length>80*n){i=o=e[0],r=a=e[1];for(var f=n;f<h;f+=n)(s=e[f])<i&&(i=s),(l=e[f+1])<r&&(r=l),s>o&&(o=s),l>a&&(a=l);u=0!==(u=Math.max(o-i,a-r))?1/u:0}return Uo(p,d,n,i,r,u),d};function Ho(e,t,n,i,r){var o,a;if(r===function(e,t,n,i){for(var r=0,o=t,a=n-i;o<n;o+=i)r+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return r}(e,t,n,i)>0)for(o=t;o<n;o+=i)a=sa(o,e[o],e[o+1],a);else for(o=n-i;o>=t;o-=i)a=sa(o,e[o],e[o+1],a);return a&&ta(a,a.next)&&(la(a),a=a.next),a}function zo(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!ta(i,i.next)&&0!==ea(i.prev,i,i.next))i=i.next;else{if(la(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function Uo(e,t,n,i,r,o,a){if(e){!a&&o&&function(e,t,n,i){var r=e;do{null===r.z&&(r.z=Qo(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,o,a,s,l,u=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,i=n,s=0,t=0;t<u&&(s++,i=i.nextZ);t++);for(l=u;s>0||l>0&&i;)0!==s&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,u*=2}while(a>1)}(r)}(e,i,r,o);for(var s,l,u=e;e.prev!==e.next;)if(s=e.prev,l=e.next,o?qo(e,i,r,o):Vo(e))t.push(s.i/n),t.push(e.i/n),t.push(l.i/n),la(e),e=l.next,u=l.next;else if((e=l)===u){a?1===a?Uo(e=Go(zo(e),t,n),t,n,i,r,o,2):2===a&&Wo(e,t,n,i,r,o):Uo(zo(e),t,n,i,r,o,1);break}}}function Vo(e){var t=e.prev,n=e,i=e.next;if(ea(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(Ko(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&ea(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function qo(e,t,n,i){var r=e.prev,o=e,a=e.next;if(ea(r,o,a)>=0)return!1;for(var s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,l=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,u=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,c=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,h=Qo(s,l,t,n,i),p=Qo(u,c,t,n,i),d=e.prevZ,f=e.nextZ;d&&d.z>=h&&f&&f.z<=p;){if(d!==e.prev&&d!==e.next&&Ko(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&ea(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==e.prev&&f!==e.next&&Ko(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&ea(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&Ko(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&ea(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==e.prev&&f!==e.next&&Ko(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&ea(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Go(e,t,n){var i=e;do{var r=i.prev,o=i.next.next;!ta(r,o)&&na(r,i,i.next,o)&&oa(r,o)&&oa(o,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(o.i/n),la(i),la(i.next),i=e=o),i=i.next}while(i!==e);return zo(i)}function Wo(e,t,n,i,r,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&$o(a,s)){var l=aa(a,s);return a=zo(a,a.next),l=zo(l,l.next),Uo(a,t,n,i,r,o),void Uo(l,t,n,i,r,o)}s=s.next}a=a.next}while(a!==e)}function Xo(e,t){return e.x-t.x}function Jo(e,t){if(t=function(e,t){var n,i=t,r=e.x,o=e.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>a){if(a=s,s===r){if(o===i.y)return i;if(o===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===a)return n;var l,u=n,c=n.x,h=n.y,p=1/0;i=n;do{r>=i.x&&i.x>=c&&r!==i.x&&Ko(o<h?r:a,o,c,h,o<h?a:r,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(r-i.x),oa(i,e)&&(l<p||l===p&&(i.x>n.x||i.x===n.x&&Yo(n,i)))&&(n=i,p=l)),i=i.next}while(i!==u);return n}(e,t)){var n=aa(t,e);zo(t,t.next),zo(n,n.next)}}function Yo(e,t){return ea(e.prev,e,t.prev)<0&&ea(t.next,e,e.next)<0}function Qo(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Zo(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Ko(e,t,n,i,r,o,a,s){return(r-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(i-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(r-a)*(i-s)>=0}function $o(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&na(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(oa(e,t)&&oa(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(ea(e.prev,e,t.prev)||ea(e,t.prev,t))||ta(e,t)&&ea(e.prev,e,e.next)>0&&ea(t.prev,t,t.next)>0)}function ea(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function ta(e,t){return e.x===t.x&&e.y===t.y}function na(e,t,n,i){var r=ra(ea(e,t,n)),o=ra(ea(e,t,i)),a=ra(ea(n,i,e)),s=ra(ea(n,i,t));return r!==o&&a!==s||(!(0!==r||!ia(e,n,t))||(!(0!==o||!ia(e,i,t))||(!(0!==a||!ia(n,e,i))||!(0!==s||!ia(n,t,i)))))}function ia(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function ra(e){return e>0?1:e<0?-1:0}function oa(e,t){return ea(e.prev,e,e.next)<0?ea(e,t,e.next)>=0&&ea(e,e.prev,t)>=0:ea(e,t,e.prev)<0||ea(e,e.next,t)<0}function aa(e,t){var n=new ua(e.i,e.x,e.y),i=new ua(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function sa(e,t,n,i){var r=new ua(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function la(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function ua(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var ca={area:function(e){for(var t=e.length,n=0,i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n},isClockWise:function(e){return ca.area(e)<0},triangulateShape:function(e,t){var n=[],i=[],r=[];ha(e),pa(n,e);var o=e.length;t.forEach(ha);for(var a=0;a<t.length;a++)i.push(o),o+=t[a].length,pa(n,t[a]);for(var s=No(n,i),l=0;l<s.length;l+=3)r.push(s.slice(l,l+3));return r}};function ha(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function pa(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}var da=function(e){function t(t,n){e.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:n},this.fromBufferGeometry(new fa(t,n)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return ga(this.parameters.shapes,this.parameters.options,t)},t}(It),fa=function(e){function t(t,n){e.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:n},t=Array.isArray(t)?t:[t];for(var i=this,r=[],o=[],s=0,l=t.length;s<l;s++){u(t[s])}function u(e){var t=[],s=void 0!==n.curveSegments?n.curveSegments:12,l=void 0!==n.steps?n.steps:1,u=void 0!==n.depth?n.depth:100,c=void 0===n.bevelEnabled||n.bevelEnabled,h=void 0!==n.bevelThickness?n.bevelThickness:6,p=void 0!==n.bevelSize?n.bevelSize:h-2,d=void 0!==n.bevelOffset?n.bevelOffset:0,f=void 0!==n.bevelSegments?n.bevelSegments:3,m=n.extrudePath,g=void 0!==n.UVGenerator?n.UVGenerator:ma;void 0!==n.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),u=n.amount);var v,y,_,x,E,w=!1;m&&(v=m.getSpacedPoints(l),w=!0,c=!1,y=m.computeFrenetFrames(l,!1),_=new b,x=new b,E=new b),c||(f=0,h=0,p=0,d=0);var T=e.extractPoints(s),M=T.shape,S=T.holes;if(!ca.isClockWise(M)){M=M.reverse();for(var C=0,A=S.length;C<A;C++){var R=S[C];ca.isClockWise(R)&&(S[C]=R.reverse())}}for(var P=ca.triangulateShape(M,S),D=M,k=0,j=S.length;k<j;k++){var O=S[k];M=M.concat(O)}function F(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var B=M.length,L=P.length;function I(e,t,n){var i,r,o,s=e.x-t.x,l=e.y-t.y,u=n.x-e.x,c=n.y-e.y,h=s*s+l*l,p=s*c-l*u;if(Math.abs(p)>Number.EPSILON){var d=Math.sqrt(h),f=Math.sqrt(u*u+c*c),m=t.x-l/d,g=t.y+s/d,v=((n.x-c/f-m)*c-(n.y+u/f-g)*u)/(s*c-l*u),y=(i=m+s*v-e.x)*i+(r=g+l*v-e.y)*r;if(y<=2)return new a(i,r);o=Math.sqrt(y/2)}else{var b=!1;s>Number.EPSILON?u>Number.EPSILON&&(b=!0):s<-Number.EPSILON?u<-Number.EPSILON&&(b=!0):Math.sign(l)===Math.sign(c)&&(b=!0),b?(i=-l,r=s,o=Math.sqrt(h)):(i=s,r=l,o=Math.sqrt(h/2))}return new a(i/o,r/o)}for(var N=[],H=0,z=D.length,U=z-1,V=H+1;H<z;H++,U++,V++)U===z&&(U=0),V===z&&(V=0),N[H]=I(D[H],D[U],D[V]);for(var q,G=[],W=N.concat(),X=0,J=S.length;X<J;X++){var Y=S[X];q=[];for(var Q=0,Z=Y.length,K=Z-1,$=Q+1;Q<Z;Q++,K++,$++)K===Z&&(K=0),$===Z&&($=0),q[Q]=I(Y[Q],Y[K],Y[$]);G.push(q),W=W.concat(q)}for(var ee=0;ee<f;ee++){for(var te=ee/f,ne=h*Math.cos(te*Math.PI/2),ie=p*Math.sin(te*Math.PI/2)+d,re=0,oe=D.length;re<oe;re++){var ae=F(D[re],N[re],ie);je(ae.x,ae.y,-ne)}for(var se=0,le=S.length;se<le;se++){var ue=S[se];q=G[se];for(var ce=0,he=ue.length;ce<he;ce++){var pe=F(ue[ce],q[ce],ie);je(pe.x,pe.y,-ne)}}}for(var de=p+d,fe=0;fe<B;fe++){var me=c?F(M[fe],W[fe],de):M[fe];w?(x.copy(y.normals[0]).multiplyScalar(me.x),_.copy(y.binormals[0]).multiplyScalar(me.y),E.copy(v[0]).add(x).add(_),je(E.x,E.y,E.z)):je(me.x,me.y,0)}for(var ge=1;ge<=l;ge++)for(var ve=0;ve<B;ve++){var ye=c?F(M[ve],W[ve],de):M[ve];w?(x.copy(y.normals[ge]).multiplyScalar(ye.x),_.copy(y.binormals[ge]).multiplyScalar(ye.y),E.copy(v[ge]).add(x).add(_),je(E.x,E.y,E.z)):je(ye.x,ye.y,u/l*ge)}for(var be=f-1;be>=0;be--){for(var _e=be/f,xe=h*Math.cos(_e*Math.PI/2),Ee=p*Math.sin(_e*Math.PI/2)+d,we=0,Te=D.length;we<Te;we++){var Me=F(D[we],N[we],Ee);je(Me.x,Me.y,u+xe)}for(var Se=0,Ce=S.length;Se<Ce;Se++){var Ae=S[Se];q=G[Se];for(var Re=0,Pe=Ae.length;Re<Pe;Re++){var De=F(Ae[Re],q[Re],Ee);w?je(De.x,De.y+v[l-1].y,v[l-1].x+xe):je(De.x,De.y,u+xe)}}}function ke(e,t){for(var n=e.length;--n>=0;){var i=n,r=n-1;r<0&&(r=e.length-1);for(var o=0,a=l+2*f;o<a;o++){var s=B*o,u=B*(o+1);Fe(t+i+s,t+r+s,t+r+u,t+i+u)}}}function je(e,n,i){t.push(e),t.push(n),t.push(i)}function Oe(e,t,n){Be(e),Be(t),Be(n);var o=r.length/3,a=g.generateTopUV(i,r,o-3,o-2,o-1);Le(a[0]),Le(a[1]),Le(a[2])}function Fe(e,t,n,o){Be(e),Be(t),Be(o),Be(t),Be(n),Be(o);var a=r.length/3,s=g.generateSideWallUV(i,r,a-6,a-3,a-2,a-1);Le(s[0]),Le(s[1]),Le(s[3]),Le(s[1]),Le(s[2]),Le(s[3])}function Be(e){r.push(t[3*e+0]),r.push(t[3*e+1]),r.push(t[3*e+2])}function Le(e){o.push(e.x),o.push(e.y)}!function(){var e=r.length/3;if(c){for(var t=0,n=B*t,o=0;o<L;o++){var a=P[o];Oe(a[2]+n,a[1]+n,a[0]+n)}n=B*(t=l+2*f);for(var s=0;s<L;s++){var u=P[s];Oe(u[0]+n,u[1]+n,u[2]+n)}}else{for(var h=0;h<L;h++){var p=P[h];Oe(p[2],p[1],p[0])}for(var d=0;d<L;d++){var m=P[d];Oe(m[0]+B*l,m[1]+B*l,m[2]+B*l)}}i.addGroup(e,r.length/3-e,0)}(),function(){var e=r.length/3,t=0;ke(D,t),t+=D.length;for(var n=0,o=S.length;n<o;n++){var a=S[n];ke(a,t),t+=a.length}i.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new nt(r,3)),this.setAttribute("uv",new nt(o,2)),this.computeVertexNormals()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return ga(this.parameters.shapes,this.parameters.options,t)},t}(dt),ma={generateTopUV:function(e,t,n,i,r){var o=t[3*n],s=t[3*n+1],l=t[3*i],u=t[3*i+1],c=t[3*r],h=t[3*r+1];return[new a(o,s),new a(l,u),new a(c,h)]},generateSideWallUV:function(e,t,n,i,r,o){var s=t[3*n],l=t[3*n+1],u=t[3*n+2],c=t[3*i],h=t[3*i+1],p=t[3*i+2],d=t[3*r],f=t[3*r+1],m=t[3*r+2],g=t[3*o],v=t[3*o+1],y=t[3*o+2];return Math.abs(l-h)<.01?[new a(s,1-u),new a(c,1-p),new a(d,1-m),new a(g,1-y)]:[new a(l,1-u),new a(h,1-p),new a(f,1-m),new a(v,1-y)]}};function ga(e,t,n){if(n.shapes=[],Array.isArray(e))for(var i=0,r=e.length;i<r;i++){var o=e[i];n.shapes.push(o.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}var va=function(e){function t(t,n){e.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:n},this.fromBufferGeometry(new ya(t,n)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),ya=function(e){function t(t,n){var i=(n=n||{}).font;if(!i||!i.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new It;var r=i.generateShapes(t,n.size);n.depth=void 0!==n.height?n.height:50,void 0===n.bevelThickness&&(n.bevelThickness=10),void 0===n.bevelSize&&(n.bevelSize=8),void 0===n.bevelEnabled&&(n.bevelEnabled=!1),e.call(this,r,n),this.type="TextBufferGeometry"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(fa),ba=function(e){function t(t,n,i,r,o,a,s){e.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:n,heightSegments:i,phiStart:r,phiLength:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new _a(t,n,i,r,o,a,s)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),_a=function(e){function t(t,n,i,r,o,a,s){e.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:n,heightSegments:i,phiStart:r,phiLength:o,thetaStart:a,thetaLength:s},t=t||1,n=Math.max(3,Math.floor(n)||8),i=Math.max(2,Math.floor(i)||6),r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,a=void 0!==a?a:0,s=void 0!==s?s:Math.PI;for(var l=Math.min(a+s,Math.PI),u=0,c=[],h=new b,p=new b,d=[],f=[],m=[],g=[],v=0;v<=i;v++){var y=[],_=v/i,x=0;0==v&&0==a?x=.5/n:v==i&&l==Math.PI&&(x=-.5/n);for(var E=0;E<=n;E++){var w=E/n;h.x=-t*Math.cos(r+w*o)*Math.sin(a+_*s),h.y=t*Math.cos(a+_*s),h.z=t*Math.sin(r+w*o)*Math.sin(a+_*s),f.push(h.x,h.y,h.z),p.copy(h).normalize(),m.push(p.x,p.y,p.z),g.push(w+x,1-_),y.push(u++)}c.push(y)}for(var T=0;T<i;T++)for(var M=0;M<n;M++){var S=c[T][M+1],C=c[T][M],A=c[T+1][M],R=c[T+1][M+1];(0!==T||a>0)&&d.push(S,C,R),(T!==i-1||l<Math.PI)&&d.push(C,A,R)}this.setIndex(d),this.setAttribute("position",new nt(f,3)),this.setAttribute("normal",new nt(m,3)),this.setAttribute("uv",new nt(g,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt),xa=function(e){function t(t,n,i,r,o,a){e.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:n,thetaSegments:i,phiSegments:r,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new Ea(t,n,i,r,o,a)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Ea=function(e){function t(t,n,i,r,o,s){e.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:n,thetaSegments:i,phiSegments:r,thetaStart:o,thetaLength:s},t=t||.5,n=n||1,o=void 0!==o?o:0,s=void 0!==s?s:2*Math.PI,i=void 0!==i?Math.max(3,i):8;for(var l=[],u=[],c=[],h=[],p=t,d=(n-t)/(r=void 0!==r?Math.max(1,r):1),f=new b,m=new a,g=0;g<=r;g++){for(var v=0;v<=i;v++){var y=o+v/i*s;f.x=p*Math.cos(y),f.y=p*Math.sin(y),u.push(f.x,f.y,f.z),c.push(0,0,1),m.x=(f.x/n+1)/2,m.y=(f.y/n+1)/2,h.push(m.x,m.y)}p+=d}for(var _=0;_<r;_++)for(var x=_*(i+1),E=0;E<i;E++){var w=E+x,T=w,M=w+i+1,S=w+i+2,C=w+1;l.push(T,M,C),l.push(M,S,C)}this.setIndex(l),this.setAttribute("position",new nt(u,3)),this.setAttribute("normal",new nt(c,3)),this.setAttribute("uv",new nt(h,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt),wa=function(e){function t(t,n,i,r){e.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:n,phiStart:i,phiLength:r},this.fromBufferGeometry(new Ta(t,n,i,r)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Ta=function(e){function t(t,n,i,r){e.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:n,phiStart:i,phiLength:r},n=Math.floor(n)||12,i=i||0,r=r||2*Math.PI,r=o.clamp(r,0,2*Math.PI);for(var s=[],l=[],u=[],c=1/n,h=new b,p=new a,d=0;d<=n;d++)for(var f=i+d*c*r,m=Math.sin(f),g=Math.cos(f),v=0;v<=t.length-1;v++)h.x=t[v].x*m,h.y=t[v].y,h.z=t[v].x*g,l.push(h.x,h.y,h.z),p.x=d/n,p.y=v/(t.length-1),u.push(p.x,p.y);for(var y=0;y<n;y++)for(var _=0;_<t.length-1;_++){var x=_+y*t.length,E=x,w=x+t.length,T=x+t.length+1,M=x+1;s.push(E,w,M),s.push(w,T,M)}if(this.setIndex(s),this.setAttribute("position",new nt(l,3)),this.setAttribute("uv",new nt(u,2)),this.computeVertexNormals(),r===2*Math.PI)for(var S=this.attributes.normal.array,C=new b,A=new b,R=new b,P=n*t.length*3,D=0,k=0;D<t.length;D++,k+=3)C.x=S[k+0],C.y=S[k+1],C.z=S[k+2],A.x=S[P+k+0],A.y=S[P+k+1],A.z=S[P+k+2],R.addVectors(C,A).normalize(),S[k+0]=S[P+k+0]=R.x,S[k+1]=S[P+k+1]=R.y,S[k+2]=S[P+k+2]=R.z}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt),Ma=function(e){function t(t,n){e.call(this),this.type="ShapeGeometry","object"==typeof n&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),n=n.curveSegments),this.parameters={shapes:t,curveSegments:n},this.fromBufferGeometry(new Sa(t,n)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return Ca(this.parameters.shapes,t)},t}(It),Sa=function(e){function t(t,n){e.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:n},n=n||12;var i=[],r=[],o=[],a=[],s=0,l=0;if(!1===Array.isArray(t))c(t);else for(var u=0;u<t.length;u++)c(t[u]),this.addGroup(s,l,u),s+=l,l=0;function c(e){var t=r.length/3,s=e.extractPoints(n),u=s.shape,c=s.holes;!1===ca.isClockWise(u)&&(u=u.reverse());for(var h=0,p=c.length;h<p;h++){var d=c[h];!0===ca.isClockWise(d)&&(c[h]=d.reverse())}for(var f=ca.triangulateShape(u,c),m=0,g=c.length;m<g;m++){var v=c[m];u=u.concat(v)}for(var y=0,b=u.length;y<b;y++){var _=u[y];r.push(_.x,_.y,0),o.push(0,0,1),a.push(_.x,_.y)}for(var x=0,E=f.length;x<E;x++){var w=f[x],T=w[0]+t,M=w[1]+t,S=w[2]+t;i.push(T,M,S),l+=3}}this.setIndex(i),this.setAttribute("position",new nt(r,3)),this.setAttribute("normal",new nt(o,3)),this.setAttribute("uv",new nt(a,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return Ca(this.parameters.shapes,t)},t}(dt);function Ca(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,i=e.length;n<i;n++){var r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}var Aa=function(e){function t(t,n){e.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:n},n=void 0!==n?n:1;var i,r,a,s,l=[],u=Math.cos(o.DEG2RAD*n),c=[0,0],h={},p=["a","b","c"];t.isBufferGeometry?(s=new It).fromBufferGeometry(t):s=t.clone(),s.mergeVertices(),s.computeFaceNormals();for(var d=s.vertices,f=s.faces,m=0,g=f.length;m<g;m++)for(var v=f[m],y=0;y<3;y++)i=v[p[y]],r=v[p[(y+1)%3]],c[0]=Math.min(i,r),c[1]=Math.max(i,r),void 0===h[a=c[0]+","+c[1]]?h[a]={index1:c[0],index2:c[1],face1:m,face2:void 0}:h[a].face2=m;for(a in h){var b=h[a];if(void 0===b.face2||f[b.face1].normal.dot(f[b.face2].normal)<=u){var _=d[b.index1];l.push(_.x,_.y,_.z),_=d[b.index2],l.push(_.x,_.y,_.z)}}this.setAttribute("position",new nt(l,3))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt),Ra=function(e){function t(t,n,i,r,o,a,s,l){e.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:n,height:i,radialSegments:r,heightSegments:o,openEnded:a,thetaStart:s,thetaLength:l},this.fromBufferGeometry(new Pa(t,n,i,r,o,a,s,l)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Pa=function(e){function t(t,n,i,r,o,s,l,u){e.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:n,height:i,radialSegments:r,heightSegments:o,openEnded:s,thetaStart:l,thetaLength:u};var c=this;t=void 0!==t?t:1,n=void 0!==n?n:1,i=i||1,r=Math.floor(r)||8,o=Math.floor(o)||1,s=void 0!==s&&s,l=void 0!==l?l:0,u=void 0!==u?u:2*Math.PI;var h=[],p=[],d=[],f=[],m=0,g=[],v=i/2,y=0;function _(e){for(var i=m,o=new a,s=new b,g=0,_=!0===e?t:n,x=!0===e?1:-1,E=1;E<=r;E++)p.push(0,v*x,0),d.push(0,x,0),f.push(.5,.5),m++;for(var w=m,T=0;T<=r;T++){var M=T/r*u+l,S=Math.cos(M),C=Math.sin(M);s.x=_*C,s.y=v*x,s.z=_*S,p.push(s.x,s.y,s.z),d.push(0,x,0),o.x=.5*S+.5,o.y=.5*C*x+.5,f.push(o.x,o.y),m++}for(var A=0;A<r;A++){var R=i+A,P=w+A;!0===e?h.push(P,P+1,R):h.push(P+1,P,R),g+=3}c.addGroup(y,g,!0===e?1:2),y+=g}!function(){for(var e=new b,a=new b,s=0,_=(n-t)/i,x=0;x<=o;x++){for(var E=[],w=x/o,T=w*(n-t)+t,M=0;M<=r;M++){var S=M/r,C=S*u+l,A=Math.sin(C),R=Math.cos(C);a.x=T*A,a.y=-w*i+v,a.z=T*R,p.push(a.x,a.y,a.z),e.set(A,_,R).normalize(),d.push(e.x,e.y,e.z),f.push(S,1-w),E.push(m++)}g.push(E)}for(var P=0;P<r;P++)for(var D=0;D<o;D++){var k=g[D][P],j=g[D+1][P],O=g[D+1][P+1],F=g[D][P+1];h.push(k,j,F),h.push(j,O,F),s+=6}c.addGroup(y,s,0),y+=s}(),!1===s&&(t>0&&_(!0),n>0&&_(!1)),this.setIndex(h),this.setAttribute("position",new nt(p,3)),this.setAttribute("normal",new nt(d,3)),this.setAttribute("uv",new nt(f,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt),Da=function(e){function t(t,n,i,r,o,a,s){e.call(this,0,t,n,i,r,o,a,s),this.type="ConeGeometry",this.parameters={radius:t,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:s}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Ra),ka=function(e){function t(t,n,i,r,o,a,s){e.call(this,0,t,n,i,r,o,a,s),this.type="ConeBufferGeometry",this.parameters={radius:t,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:s}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Pa),ja=function(e){function t(t,n,i,r){e.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:n,thetaStart:i,thetaLength:r},this.fromBufferGeometry(new Oa(t,n,i,r)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),Oa=function(e){function t(t,n,i,r){e.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:n,thetaStart:i,thetaLength:r},t=t||1,n=void 0!==n?Math.max(3,n):8,i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI;var o=[],s=[],l=[],u=[],c=new b,h=new a;s.push(0,0,0),l.push(0,0,1),u.push(.5,.5);for(var p=0,d=3;p<=n;p++,d+=3){var f=i+p/n*r;c.x=t*Math.cos(f),c.y=t*Math.sin(f),s.push(c.x,c.y,c.z),l.push(0,0,1),h.x=(s[d]/t+1)/2,h.y=(s[d+1]/t+1)/2,u.push(h.x,h.y)}for(var m=1;m<=n;m++)o.push(m,m+1,0);this.setIndex(o),this.setAttribute("position",new nt(s,3)),this.setAttribute("normal",new nt(l,3)),this.setAttribute("uv",new nt(u,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(dt),Fa=Object.freeze({__proto__:null,WireframeGeometry:_o,ParametricGeometry:xo,ParametricBufferGeometry:Eo,TetrahedronGeometry:Mo,TetrahedronBufferGeometry:So,OctahedronGeometry:Co,OctahedronBufferGeometry:Ao,IcosahedronGeometry:Ro,IcosahedronBufferGeometry:Po,DodecahedronGeometry:Do,DodecahedronBufferGeometry:ko,PolyhedronGeometry:wo,PolyhedronBufferGeometry:To,TubeGeometry:jo,TubeBufferGeometry:Oo,TorusKnotGeometry:Fo,TorusKnotBufferGeometry:Bo,TorusGeometry:Lo,TorusBufferGeometry:Io,TextGeometry:va,TextBufferGeometry:ya,SphereGeometry:ba,SphereBufferGeometry:_a,RingGeometry:xa,RingBufferGeometry:Ea,PlaneGeometry:tn,PlaneBufferGeometry:nn,LatheGeometry:wa,LatheBufferGeometry:Ta,ShapeGeometry:Ma,ShapeBufferGeometry:Sa,ExtrudeGeometry:da,ExtrudeBufferGeometry:fa,EdgesGeometry:Aa,ConeGeometry:Da,ConeBufferGeometry:ka,CylinderGeometry:Ra,CylinderBufferGeometry:Pa,CircleGeometry:ja,CircleBufferGeometry:Oa,BoxGeometry:Nt,BoxBufferGeometry:Ht});function Ba(e){qe.call(this),this.type="ShadowMaterial",this.color=new ze(0),this.transparent=!0,this.setValues(e)}function La(e){qt.call(this,e),this.type="RawShaderMaterial"}function Ia(e){qe.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ze(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ze(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new a(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(e)}function Na(e){Ia.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new a(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(e)}function Ha(e){qe.call(this),this.type="MeshPhongMaterial",this.color=new ze(16777215),this.specular=new ze(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ze(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new a(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function za(e){qe.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ze(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ze(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new a(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ua(e){qe.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new a(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Va(e){qe.call(this),this.type="MeshLambertMaterial",this.color=new ze(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ze(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function qa(e){qe.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ze(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new a(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ga(e){Zr.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}Ba.prototype=Object.create(qe.prototype),Ba.prototype.constructor=Ba,Ba.prototype.isShadowMaterial=!0,Ba.prototype.copy=function(e){return qe.prototype.copy.call(this,e),this.color.copy(e.color),this},La.prototype=Object.create(qt.prototype),La.prototype.constructor=La,La.prototype.isRawShaderMaterial=!0,Ia.prototype=Object.create(qe.prototype),Ia.prototype.constructor=Ia,Ia.prototype.isMeshStandardMaterial=!0,Ia.prototype.copy=function(e){return qe.prototype.copy.call(this,e),this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.vertexTangents=e.vertexTangents,this},Na.prototype=Object.create(Ia.prototype),Na.prototype.constructor=Na,Na.prototype.isMeshPhysicalMaterial=!0,Na.prototype.copy=function(e){return Ia.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new ze).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this},Ha.prototype=Object.create(qe.prototype),Ha.prototype.constructor=Ha,Ha.prototype.isMeshPhongMaterial=!0,Ha.prototype.copy=function(e){return qe.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},za.prototype=Object.create(qe.prototype),za.prototype.constructor=za,za.prototype.isMeshToonMaterial=!0,za.prototype.copy=function(e){return qe.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Ua.prototype=Object.create(qe.prototype),Ua.prototype.constructor=Ua,Ua.prototype.isMeshNormalMaterial=!0,Ua.prototype.copy=function(e){return qe.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Va.prototype=Object.create(qe.prototype),Va.prototype.constructor=Va,Va.prototype.isMeshLambertMaterial=!0,Va.prototype.copy=function(e){return qe.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},qa.prototype=Object.create(qe.prototype),qa.prototype.constructor=qa,qa.prototype.isMeshMatcapMaterial=!0,qa.prototype.copy=function(e){return qe.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Ga.prototype=Object.create(Zr.prototype),Ga.prototype.constructor=Ga,Ga.prototype.isLineDashedMaterial=!0,Ga.prototype.copy=function(e){return Zr.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Wa=Object.freeze({__proto__:null,ShadowMaterial:Ba,SpriteMaterial:vr,RawShaderMaterial:La,ShaderMaterial:qt,PointsMaterial:lo,MeshPhysicalMaterial:Na,MeshStandardMaterial:Ia,MeshPhongMaterial:Ha,MeshToonMaterial:za,MeshNormalMaterial:Ua,MeshLambertMaterial:Va,MeshDepthMaterial:Qi,MeshDistanceMaterial:Zi,MeshBasicMaterial:Ge,MeshMatcapMaterial:qa,LineDashedMaterial:Ga,LineBasicMaterial:Zr,Material:qe}),Xa={arraySlice:function(e,t,n){return Xa.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),i=0;i!==t;++i)n[i]=i;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){for(var i=e.length,r=new e.constructor(i),o=0,a=0;a!==i;++o)for(var s=n[o]*t,l=0;l!==t;++l)r[a++]=e[s+l];return r},flattenJSON:function(e,t,n,i){for(var r=1,o=e[0];void 0!==o&&void 0===o[i];)o=e[r++];if(void 0!==o){var a=o[i];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[i])&&(t.push(o.time),n.push.apply(n,a)),o=e[r++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[i])&&(t.push(o.time),a.toArray(n,n.length)),o=e[r++]}while(void 0!==o);else do{void 0!==(a=o[i])&&(t.push(o.time),n.push(a)),o=e[r++]}while(void 0!==o)}},subclip:function(e,t,n,i,r){r=r||30;var o=e.clone();o.name=t;for(var a=[],s=0;s<o.tracks.length;++s){for(var l=o.tracks[s],u=l.getValueSize(),c=[],h=[],p=0;p<l.times.length;++p){var d=l.times[p]*r;if(!(d<n||d>=i)){c.push(l.times[p]);for(var f=0;f<u;++f)h.push(l.values[p*u+f])}}0!==c.length&&(l.times=Xa.convertArray(c,l.times.constructor),l.values=Xa.convertArray(h,l.values.constructor),a.push(l))}o.tracks=a;for(var m=1/0,g=0;g<o.tracks.length;++g)m>o.tracks[g].times[0]&&(m=o.tracks[g].times[0]);for(var v=0;v<o.tracks.length;++v)o.tracks[v].shift(-1*m);return o.resetDuration(),o},makeClipAdditive:function(e,t,n,i){void 0===t&&(t=0),void 0===n&&(n=e),(void 0===i||i<=0)&&(i=30);for(var r=e.tracks.length,o=t/i,a=function(t){var i=n.tracks[t],r=i.ValueTypeName;if("bool"!==r&&"string"!==r){var a=e.tracks.find((function(e){return e.name===i.name&&e.ValueTypeName===r}));if(void 0!==a){var s=0,l=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=l/3);var u=0,c=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=c/3);var h=i.times.length-1,p=void 0;if(o<=i.times[0]){var d=s,f=l-s;p=Xa.arraySlice(i.values,d,f)}else if(o>=i.times[h]){var m=h*l+s,g=m+l-s;p=Xa.arraySlice(i.values,m,g)}else{var y=i.createInterpolant(),b=s,_=l-s;y.evaluate(o),p=Xa.arraySlice(y.resultBuffer,b,_)}if("quaternion"===r)(new v).fromArray(p).normalize().conjugate().toArray(p);for(var x=a.times.length,E=0;E<x;++E){var w=E*c+u;if("quaternion"===r)v.multiplyQuaternionsFlat(a.values,w,p,0,a.values,w);else for(var T=c-2*u,M=0;M<T;++M)a.values[w+M]-=p[M]}}}},s=0;s<r;++s)a(s);return e.blendMode=2501,e}};function Ja(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function Ya(e,t,n,i){Ja.call(this,e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Qa(e,t,n,i){Ja.call(this,e,t,n,i)}function Za(e,t,n,i){Ja.call(this,e,t,n,i)}function Ka(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Xa.convertArray(t,this.TimeBufferType),this.values=Xa.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}function $a(e,t,n){Ka.call(this,e,t,n)}function es(e,t,n,i){Ka.call(this,e,t,n,i)}function ts(e,t,n,i){Ka.call(this,e,t,n,i)}function ns(e,t,n,i){Ja.call(this,e,t,n,i)}function is(e,t,n,i){Ka.call(this,e,t,n,i)}function rs(e,t,n,i){Ka.call(this,e,t,n,i)}function os(e,t,n,i){Ka.call(this,e,t,n,i)}function as(e,t,n,i){this.name=e,this.tracks=n,this.duration=void 0!==t?t:-1,this.blendMode=void 0!==i?i:2500,this.uuid=o.generateUUID(),this.duration<0&&this.resetDuration()}function ss(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ts;case"vector":case"vector2":case"vector3":case"vector4":return os;case"color":return es;case"quaternion":return is;case"bool":case"boolean":return $a;case"string":return rs}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],i=[];Xa.flattenJSON(e.keys,n,i,"value"),e.times=n,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(Ja.prototype,{evaluate:function(e){var t=this.parameterPositions,n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{var o;n:{i:if(!(e<i)){for(var a=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,r)}if(n===a)break;if(r=i,e<(i=t[++n]))break t}o=t.length;break n}if(e>=r)break e;var s=t[1];e<s&&(n=2,r=s);for(var l=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===l)break;if(i=r,e>=(r=t[--n-1]))break t}o=n,n=0}for(;n<o;){var u=n+o>>>1;e<t[u]?o=u:n=u+1}if(i=t[n],void 0===(r=t[n-1]))return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,r,e)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i,o=0;o!==i;++o)t[o]=n[r+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Ja.prototype,{beforeStart_:Ja.prototype.copySampleValue_,afterEnd_:Ja.prototype.copySampleValue_}),Ya.prototype=Object.assign(Object.create(Ja.prototype),{constructor:Ya,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(e,t,n){var i=this.parameterPositions,r=e-2,o=e+1,a=i[r],s=i[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:r=e,a=2*t-n;break;case 2402:a=t+i[r=i.length-2]-i[r+1];break;default:r=e,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=e,s=2*n-t;break;case 2402:o=1,s=n+i[1]-i[0];break;default:o=e-1,s=t}var l=.5*(n-t),u=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-n),this._offsetPrev=r*u,this._offsetNext=o*u},interpolate_:function(e,t,n,i){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,p=this._weightNext,d=(n-t)/(i-t),f=d*d,m=f*d,g=-h*m+2*h*f-h*d,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*d+1,y=(-1-p)*m+(1.5+p)*f+.5*d,b=p*m-p*f,_=0;_!==a;++_)r[_]=g*o[u+_]+v*o[l+_]+y*o[s+_]+b*o[c+_];return r}}),Qa.prototype=Object.assign(Object.create(Ja.prototype),{constructor:Qa,interpolate_:function(e,t,n,i){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,u=(n-t)/(i-t),c=1-u,h=0;h!==a;++h)r[h]=o[l+h]*c+o[s+h]*u;return r}}),Za.prototype=Object.assign(Object.create(Ja.prototype),{constructor:Za,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(Ka,{toJSON:function(e){var t,n=e.constructor;if(void 0!==n.toJSON)t=n.toJSON(e);else{t={name:e.name,times:Xa.convertArray(e.times,Array),values:Xa.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}),Object.assign(Ka.prototype,{constructor:Ka,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new Za(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Qa(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Ya(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]*=e;return this},trim:function(e,t){for(var n=this.times,i=n.length,r=0,o=i-1;r!==i&&n[r]<e;)++r;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==r||o!==i){r>=o&&(r=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=Xa.arraySlice(n,r,o),this.values=Xa.arraySlice(this.values,r*a,o*a)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var o=null,a=0;a!==r;a++){var s=n[a];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,s),e=!1;break}if(null!==o&&o>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,s,o),e=!1;break}o=s}if(void 0!==i&&Xa.isTypedArray(i))for(var l=0,u=i.length;l!==u;++l){var c=i[l];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,l,c),e=!1;break}}return e},optimize:function(){for(var e=Xa.arraySlice(this.times),t=Xa.arraySlice(this.values),n=this.getValueSize(),i=2302===this.getInterpolation(),r=e.length-1,o=1,a=1;a<r;++a){var s=!1,l=e[a];if(l!==e[a+1]&&(1!==a||l!==l[0]))if(i)s=!0;else for(var u=a*n,c=u-n,h=u+n,p=0;p!==n;++p){var d=t[u+p];if(d!==t[c+p]||d!==t[h+p]){s=!0;break}}if(s){if(a!==o){e[o]=e[a];for(var f=a*n,m=o*n,g=0;g!==n;++g)t[m+g]=t[f+g]}++o}}if(r>0){e[o]=e[r];for(var v=r*n,y=o*n,b=0;b!==n;++b)t[y+b]=t[v+b];++o}return o!==e.length?(this.times=Xa.arraySlice(e,0,o),this.values=Xa.arraySlice(t,0,o*n)):(this.times=e,this.values=t),this},clone:function(){var e=Xa.arraySlice(this.times,0),t=Xa.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}),$a.prototype=Object.assign(Object.create(Ka.prototype),{constructor:$a,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),es.prototype=Object.assign(Object.create(Ka.prototype),{constructor:es,ValueTypeName:"color"}),ts.prototype=Object.assign(Object.create(Ka.prototype),{constructor:ts,ValueTypeName:"number"}),ns.prototype=Object.assign(Object.create(Ja.prototype),{constructor:ns,interpolate_:function(e,t,n,i){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(n-t)/(i-t),l=e*a,u=l+a;l!==u;l+=4)v.slerpFlat(r,0,o,l-a,o,l,s);return r}}),is.prototype=Object.assign(Object.create(Ka.prototype),{constructor:is,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new ns(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),rs.prototype=Object.assign(Object.create(Ka.prototype),{constructor:rs,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),os.prototype=Object.assign(Object.create(Ka.prototype),{constructor:os,ValueTypeName:"vector"}),Object.assign(as,{parse:function(e){for(var t=[],n=e.tracks,i=1/(e.fps||1),r=0,o=n.length;r!==o;++r)t.push(ss(n[r]).scale(i));return new as(e.name,e.duration,t,e.blendMode)},toJSON:function(e){for(var t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},r=0,o=n.length;r!==o;++r)t.push(Ka.toJSON(n[r]));return i},CreateFromMorphTargetSequence:function(e,t,n,i){for(var r=t.length,o=[],a=0;a<r;a++){var s=[],l=[];s.push((a+r-1)%r,a,(a+1)%r),l.push(0,1,0);var u=Xa.getKeyframeOrder(s);s=Xa.sortedArray(s,1,u),l=Xa.sortedArray(l,1,u),i||0!==s[0]||(s.push(r),l.push(l[0])),o.push(new ts(".morphTargetInfluences["+t[a].name+"]",s,l).scale(1/n))}return new as(e,-1,o)},findByName:function(e,t){var n=e;if(!Array.isArray(e)){var i=e;n=i.geometry&&i.geometry.animations||i.animations}for(var r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){for(var i={},r=/^([\w-]*?)([\d]+)$/,o=0,a=e.length;o<a;o++){var s=e[o],l=s.name.match(r);if(l&&l.length>1){var u=l[1],c=i[u];c||(i[u]=c=[]),c.push(s)}}var h=[];for(var p in i)h.push(as.CreateFromMorphTargetSequence(p,i[p],t,n));return h},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,i,r){if(0!==n.length){var o=[],a=[];Xa.flattenJSON(n,o,a,i),0!==o.length&&r.push(new e(t,o,a))}},i=[],r=e.name||"default",o=e.fps||30,a=e.blendMode,s=e.length||-1,l=e.hierarchy||[],u=0;u<l.length;u++){var c=l[u].keys;if(c&&0!==c.length)if(c[0].morphTargets){var h={},p=void 0;for(p=0;p<c.length;p++)if(c[p].morphTargets)for(var d=0;d<c[p].morphTargets.length;d++)h[c[p].morphTargets[d]]=-1;for(var f in h){for(var m=[],g=[],v=0;v!==c[p].morphTargets.length;++v){var y=c[p];m.push(y.time),g.push(y.morphTarget===f?1:0)}i.push(new ts(".morphTargetInfluence["+f+"]",m,g))}s=h.length*(o||1)}else{var b=".bones["+t[u].name+"]";n(os,b+".position",c,"pos",i),n(is,b+".quaternion",c,"rot",i),n(os,b+".scale",c,"scl",i)}}return 0===i.length?null:new as(r,s,i,a)}}),Object.assign(as.prototype,{resetDuration:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new as(this.name,this.duration,e,this.blendMode)}});var ls={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function us(e,t,n){var i=this,r=!1,o=0,a=0,s=void 0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===r&&void 0!==i.onStart&&i.onStart(e,o,a),r=!0},this.itemEnd=function(e){o++,void 0!==i.onProgress&&i.onProgress(e,o,a),o===a&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){var t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=l.length;t<n;t+=2){var i=l[t],r=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return r}return null}}var cs=new us;function hs(e){this.manager=void 0!==e?e:cs,this.crossOrigin="anonymous",this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(hs.prototype,{load:function(){},loadAsync:function(e,t){var n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});var ps={};function ds(e){hs.call(this,e)}function fs(e){hs.call(this,e)}function ms(e){hs.call(this,e)}function gs(e){hs.call(this,e)}function vs(e){hs.call(this,e)}function ys(e){hs.call(this,e)}function bs(e){hs.call(this,e)}function _s(){this.type="Curve",this.arcLengthDivisions=200}function xs(e,t,n,i,r,o,a,s){_s.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=i||1,this.aStartAngle=r||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function Es(e,t,n,i,r,o){xs.call(this,e,t,n,n,i,r,o),this.type="ArcCurve"}function ws(){var e=0,t=0,n=0,i=0;function r(r,o,a,s){e=r,t=a,n=-3*r+3*o-2*a-s,i=2*r-2*o+a+s}return{initCatmullRom:function(e,t,n,i,o){r(t,n,o*(n-e),o*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,o,a,s){var l=(t-e)/o-(n-e)/(o+a)+(n-t)/a,u=(n-t)/a-(i-t)/(a+s)+(i-n)/s;r(t,n,l*=a,u*=a)},calc:function(r){var o=r*r;return e+t*r+n*o+i*(o*r)}}}ds.prototype=Object.assign(Object.create(hs.prototype),{constructor:ds,load:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,o=ls.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;if(void 0===ps[e]){var a,s=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var l=s[1],u=!!s[2],c=s[3];c=decodeURIComponent(c),u&&(c=atob(c));try{var h,p=(this.responseType||"").toLowerCase();switch(p){case"arraybuffer":case"blob":for(var d=new Uint8Array(c.length),f=0;f<c.length;f++)d[f]=c.charCodeAt(f);h="blob"===p?new Blob([d.buffer],{type:l}):d.buffer;break;case"document":var m=new DOMParser;h=m.parseFromString(c,l);break;case"json":h=JSON.parse(c);break;default:h=c}setTimeout((function(){t&&t(h),r.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}),0)}}else{for(var g in ps[e]=[],ps[e].push({onLoad:t,onProgress:n,onError:i}),(a=new XMLHttpRequest).open("GET",e,!0),a.addEventListener("load",(function(t){var n=this.response,i=ps[e];if(delete ps[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),ls.add(e,n);for(var o=0,a=i.length;o<a;o++){var s=i[o];s.onLoad&&s.onLoad(n)}r.manager.itemEnd(e)}else if(201===this.status&&"string"==typeof n)console.error("[have no right] name: "+decodeURIComponent(JSON.parse(n).message)+"\nurl: "+e),r.manager.itemEnd(e);else{for(var l=0,u=i.length;l<u;l++){var c=i[l];c.onError&&c.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}}),!1),a.addEventListener("progress",(function(t){for(var n=ps[e],i=0,r=n.length;i<r;i++){var o=n[i];o.onProgress&&o.onProgress(t)}}),!1),a.addEventListener("error",(function(t){var n=ps[e];delete ps[e];for(var i=0,o=n.length;i<o;i++){var a=n[i];a.onError&&a.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),a.addEventListener("abort",(function(t){var n=ps[e];delete ps[e];for(var i=0,o=n.length;i<o;i++){var a=n[i];a.onError&&a.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)a.setRequestHeader(g,this.requestHeader[g]);a.send(null)}return r.manager.itemStart(e),a}ps[e].push({onLoad:t,onProgress:n,onError:i})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this}}),fs.prototype=Object.assign(Object.create(hs.prototype),{constructor:fs,load:function(e,t,n,i){var r=this,o=new ds(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)},parse:function(e){for(var t=[],n=0;n<e.length;n++){var i=as.parse(e[n]);t.push(i)}return t}}),ms.prototype=Object.assign(Object.create(hs.prototype),{constructor:ms,load:function(e,t,n,i){var r=this,o=[],a=new vo;a.image=o;var s=new ds(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader);var l=0;function u(u){s.load(e[u],(function(e){var n=r.parse(e,!0);o[u]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(l+=1)&&(1===n.mipmapCount&&(a.minFilter=1006),a.format=n.format,a.needsUpdate=!0,t&&t(a))}),n,i)}if(Array.isArray(e))for(var c=0,h=e.length;c<h;++c)u(c);else s.load(e,(function(e){var n=r.parse(e,!0);if(n.isCubemap)for(var i=n.mipmaps.length/n.mipmapCount,s=0;s<i;s++){o[s]={mipmaps:[]};for(var l=0;l<n.mipmapCount;l++)o[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+l]),o[s].format=n.format,o[s].width=n.width,o[s].height=n.height}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=1006),a.format=n.format,a.needsUpdate=!0,t&&t(a)}),n,i);return a}}),gs.prototype=Object.assign(Object.create(hs.prototype),{constructor:gs,load:function(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,o=ls.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),ls.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}return a.addEventListener("load",s,!1),a.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}),vs.prototype=Object.assign(Object.create(hs.prototype),{constructor:vs,load:function(e,t,n,i){var r=new xn,o=new gs(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(n){o.load(e[n],(function(e){r.images[n]=e,6===++a&&(r.needsUpdate=!0,t&&t(r))}),void 0,i)}for(var l=0;l<e.length;++l)s(l);return r}}),ys.prototype=Object.assign(Object.create(hs.prototype),{constructor:ys,load:function(e,t,n,i){var r=this,o=new Yt,a=new ds(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.load(e,(function(e){var n=r.parse(e);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:1001,o.wrapT=void 0!==n.wrapT?n.wrapT:1001,o.magFilter=void 0!==n.magFilter?n.magFilter:1006,o.minFilter=void 0!==n.minFilter?n.minFilter:1006,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=1008),1===n.mipmapCount&&(o.minFilter=1006),o.needsUpdate=!0,t&&t(o,n))}),n,i),o}}),bs.prototype=Object.assign(Object.create(hs.prototype),{constructor:bs,load:function(e,t,n,i){var r=new p,o=new gs(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(n){r.image=n;var i=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);r.format=i?1022:1023,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}),Object.assign(_s.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n=[],i=this.getPoint(0),r=0;n.push(0);for(var o=1;o<=e;o++)r+=(t=this.getPoint(o/e)).distanceTo(i),n.push(r),i=t;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var n,i=this.getLengths(),r=0,o=i.length;n=t||e*i[o-1];for(var a,s=0,l=o-1;s<=l;)if((a=i[r=Math.floor(s+(l-s)/2)]-n)<0)s=r+1;else{if(!(a>0)){l=r;break}l=r-1}if(i[r=l]===n)return r/(o-1);var u=i[r];return(r+(n-u)/(i[r+1]-u))/(o-1)},getTangent:function(e,t){var n=e-1e-4,i=e+1e-4;n<0&&(n=0),i>1&&(i=1);var r=this.getPoint(n),o=this.getPoint(i),s=t||(r.isVector2?new a:new b);return s.copy(o).sub(r).normalize(),s},getTangentAt:function(e,t){var n=this.getUtoTmapping(e);return this.getTangent(n,t)},computeFrenetFrames:function(e,t){for(var n=new b,i=[],r=[],a=[],s=new b,l=new X,u=0;u<=e;u++){var c=u/e;i[u]=this.getTangentAt(c,new b),i[u].normalize()}r[0]=new b,a[0]=new b;var h=Number.MAX_VALUE,p=Math.abs(i[0].x),d=Math.abs(i[0].y),f=Math.abs(i[0].z);p<=h&&(h=p,n.set(1,0,0)),d<=h&&(h=d,n.set(0,1,0)),f<=h&&n.set(0,0,1),s.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],s),a[0].crossVectors(i[0],r[0]);for(var m=1;m<=e;m++){if(r[m]=r[m-1].clone(),a[m]=a[m-1].clone(),s.crossVectors(i[m-1],i[m]),s.length()>Number.EPSILON){s.normalize();var g=Math.acos(o.clamp(i[m-1].dot(i[m]),-1,1));r[m].applyMatrix4(l.makeRotationAxis(s,g))}a[m].crossVectors(i[m],r[m])}if(!0===t){var v=Math.acos(o.clamp(r[0].dot(r[e]),-1,1));v/=e,i[0].dot(s.crossVectors(r[0],r[e]))>0&&(v=-v);for(var y=1;y<=e;y++)r[y].applyMatrix4(l.makeRotationAxis(i[y],v*y)),a[y].crossVectors(i[y],r[y])}return{tangents:i,normals:r,binormals:a}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),xs.prototype=Object.create(_s.prototype),xs.prototype.constructor=xs,xs.prototype.isEllipseCurve=!0,xs.prototype.getPoint=function(e,t){for(var n=t||new a,i=2*Math.PI,r=this.aEndAngle-this.aStartAngle,o=Math.abs(r)<Number.EPSILON;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=o?0:i),!0!==this.aClockwise||o||(r===i?r=-i:r-=i);var s=this.aStartAngle+e*r,l=this.aX+this.xRadius*Math.cos(s),u=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){var c=Math.cos(this.aRotation),h=Math.sin(this.aRotation),p=l-this.aX,d=u-this.aY;l=p*c-d*h+this.aX,u=p*h+d*c+this.aY}return n.set(l,u)},xs.prototype.copy=function(e){return _s.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},xs.prototype.toJSON=function(){var e=_s.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},xs.prototype.fromJSON=function(e){return _s.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Es.prototype=Object.create(xs.prototype),Es.prototype.constructor=Es,Es.prototype.isArcCurve=!0;var Ts=new b,Ms=new ws,Ss=new ws,Cs=new ws;function As(e,t,n,i){_s.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=n||"centripetal",this.tension=void 0!==i?i:.5}function Rs(e,t,n,i,r){var o=.5*(i-t),a=.5*(r-n),s=e*e;return(2*n-2*i+o+a)*(e*s)+(-3*n+3*i-2*o-a)*s+o*e+n}function Ps(e,t,n,i){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function Ds(e,t,n,i,r){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}function ks(e,t,n,i){_s.call(this),this.type="CubicBezierCurve",this.v0=e||new a,this.v1=t||new a,this.v2=n||new a,this.v3=i||new a}function js(e,t,n,i){_s.call(this),this.type="CubicBezierCurve3",this.v0=e||new b,this.v1=t||new b,this.v2=n||new b,this.v3=i||new b}function Os(e,t){_s.call(this),this.type="LineCurve",this.v1=e||new a,this.v2=t||new a}function Fs(e,t){_s.call(this),this.type="LineCurve3",this.v1=e||new b,this.v2=t||new b}function Bs(e,t,n){_s.call(this),this.type="QuadraticBezierCurve",this.v0=e||new a,this.v1=t||new a,this.v2=n||new a}function Ls(e,t,n){_s.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new b,this.v1=t||new b,this.v2=n||new b}function Is(e){_s.call(this),this.type="SplineCurve",this.points=e||[]}As.prototype=Object.create(_s.prototype),As.prototype.constructor=As,As.prototype.isCatmullRomCurve3=!0,As.prototype.getPoint=function(e,t){var n,i,r=t||new b,o=this.points,a=o.length,s=(a-(this.closed?0:1))*e,l=Math.floor(s),u=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/a)+1)*a:0===u&&l===a-1&&(l=a-2,u=1),this.closed||l>0?n=o[(l-1)%a]:(Ts.subVectors(o[0],o[1]).add(o[0]),n=Ts);var c=o[l%a],h=o[(l+1)%a];if(this.closed||l+2<a?i=o[(l+2)%a]:(Ts.subVectors(o[a-1],o[a-2]).add(o[a-1]),i=Ts),"centripetal"===this.curveType||"chordal"===this.curveType){var p="chordal"===this.curveType?.5:.25,d=Math.pow(n.distanceToSquared(c),p),f=Math.pow(c.distanceToSquared(h),p),m=Math.pow(h.distanceToSquared(i),p);f<1e-4&&(f=1),d<1e-4&&(d=f),m<1e-4&&(m=f),Ms.initNonuniformCatmullRom(n.x,c.x,h.x,i.x,d,f,m),Ss.initNonuniformCatmullRom(n.y,c.y,h.y,i.y,d,f,m),Cs.initNonuniformCatmullRom(n.z,c.z,h.z,i.z,d,f,m)}else"catmullrom"===this.curveType&&(Ms.initCatmullRom(n.x,c.x,h.x,i.x,this.tension),Ss.initCatmullRom(n.y,c.y,h.y,i.y,this.tension),Cs.initCatmullRom(n.z,c.z,h.z,i.z,this.tension));return r.set(Ms.calc(u),Ss.calc(u),Cs.calc(u)),r},As.prototype.copy=function(e){_s.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},As.prototype.toJSON=function(){var e=_s.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},As.prototype.fromJSON=function(e){_s.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push((new b).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},ks.prototype=Object.create(_s.prototype),ks.prototype.constructor=ks,ks.prototype.isCubicBezierCurve=!0,ks.prototype.getPoint=function(e,t){var n=t||new a,i=this.v0,r=this.v1,o=this.v2,s=this.v3;return n.set(Ds(e,i.x,r.x,o.x,s.x),Ds(e,i.y,r.y,o.y,s.y)),n},ks.prototype.copy=function(e){return _s.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},ks.prototype.toJSON=function(){var e=_s.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},ks.prototype.fromJSON=function(e){return _s.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},js.prototype=Object.create(_s.prototype),js.prototype.constructor=js,js.prototype.isCubicBezierCurve3=!0,js.prototype.getPoint=function(e,t){var n=t||new b,i=this.v0,r=this.v1,o=this.v2,a=this.v3;return n.set(Ds(e,i.x,r.x,o.x,a.x),Ds(e,i.y,r.y,o.y,a.y),Ds(e,i.z,r.z,o.z,a.z)),n},js.prototype.copy=function(e){return _s.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},js.prototype.toJSON=function(){var e=_s.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},js.prototype.fromJSON=function(e){return _s.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Os.prototype=Object.create(_s.prototype),Os.prototype.constructor=Os,Os.prototype.isLineCurve=!0,Os.prototype.getPoint=function(e,t){var n=t||new a;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Os.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Os.prototype.getTangent=function(e,t){var n=t||new a;return n.copy(this.v2).sub(this.v1).normalize(),n},Os.prototype.copy=function(e){return _s.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Os.prototype.toJSON=function(){var e=_s.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Os.prototype.fromJSON=function(e){return _s.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Fs.prototype=Object.create(_s.prototype),Fs.prototype.constructor=Fs,Fs.prototype.isLineCurve3=!0,Fs.prototype.getPoint=function(e,t){var n=t||new b;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Fs.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Fs.prototype.copy=function(e){return _s.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Fs.prototype.toJSON=function(){var e=_s.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Fs.prototype.fromJSON=function(e){return _s.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Bs.prototype=Object.create(_s.prototype),Bs.prototype.constructor=Bs,Bs.prototype.isQuadraticBezierCurve=!0,Bs.prototype.getPoint=function(e,t){var n=t||new a,i=this.v0,r=this.v1,o=this.v2;return n.set(Ps(e,i.x,r.x,o.x),Ps(e,i.y,r.y,o.y)),n},Bs.prototype.copy=function(e){return _s.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Bs.prototype.toJSON=function(){var e=_s.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Bs.prototype.fromJSON=function(e){return _s.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Ls.prototype=Object.create(_s.prototype),Ls.prototype.constructor=Ls,Ls.prototype.isQuadraticBezierCurve3=!0,Ls.prototype.getPoint=function(e,t){var n=t||new b,i=this.v0,r=this.v1,o=this.v2;return n.set(Ps(e,i.x,r.x,o.x),Ps(e,i.y,r.y,o.y),Ps(e,i.z,r.z,o.z)),n},Ls.prototype.copy=function(e){return _s.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ls.prototype.toJSON=function(){var e=_s.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Ls.prototype.fromJSON=function(e){return _s.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Is.prototype=Object.create(_s.prototype),Is.prototype.constructor=Is,Is.prototype.isSplineCurve=!0,Is.prototype.getPoint=function(e,t){var n=t||new a,i=this.points,r=(i.length-1)*e,o=Math.floor(r),s=r-o,l=i[0===o?o:o-1],u=i[o],c=i[o>i.length-2?i.length-1:o+1],h=i[o>i.length-3?i.length-1:o+2];return n.set(Rs(s,l.x,u.x,c.x,h.x),Rs(s,l.y,u.y,c.y,h.y)),n},Is.prototype.copy=function(e){_s.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push(i.clone())}return this},Is.prototype.toJSON=function(){var e=_s.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var i=this.points[t];e.points.push(i.toArray())}return e},Is.prototype.fromJSON=function(e){_s.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push((new a).fromArray(i))}return this};var Ns=Object.freeze({__proto__:null,ArcCurve:Es,CatmullRomCurve3:As,CubicBezierCurve:ks,CubicBezierCurve3:js,EllipseCurve:xs,LineCurve:Os,LineCurve3:Fs,QuadraticBezierCurve:Bs,QuadraticBezierCurve3:Ls,SplineCurve:Is});function Hs(){_s.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function zs(e){Hs.call(this),this.type="Path",this.currentPoint=new a,e&&this.setFromPoints(e)}function Us(e){zs.call(this,e),this.uuid=o.generateUUID(),this.type="Shape",this.holes=[]}function Vs(e,t){be.call(this),this.type="Light",this.color=new ze(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function qs(e,t,n){Vs.call(this,e,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(be.DefaultUp),this.updateMatrix(),this.groundColor=new ze(t)}function Gs(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new a(512,512),this.map=null,this.mapPass=null,this.matrix=new X,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Kt,this._frameExtents=new a(1,1),this._viewportCount=1,this._viewports=[new d(0,0,1,1)]}function Ws(){Gs.call(this,new Wt(50,1,.5,500))}function Xs(e,t,n,i,r,o){Vs.call(this,e,t),this.type="SpotLight",this.position.copy(be.DefaultUp),this.updateMatrix(),this.target=new be,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==i?i:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==o?o:1,this.shadow=new Ws}function Js(){Gs.call(this,new Wt(90,1,.5,500)),this._frameExtents=new a(4,2),this._viewportCount=6,this._viewports=[new d(2,1,1,1),new d(0,1,1,1),new d(3,1,1,1),new d(1,1,1,1),new d(3,0,1,1),new d(1,0,1,1)],this._cubeDirections=[new b(1,0,0),new b(-1,0,0),new b(0,0,1),new b(0,0,-1),new b(0,1,0),new b(0,-1,0)],this._cubeUps=[new b(0,1,0),new b(0,1,0),new b(0,1,0),new b(0,1,0),new b(0,0,1),new b(0,0,-1)]}function Ys(e,t,n,i){Vs.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==i?i:1,this.shadow=new Js}function Qs(e,t,n,i,r,o){Gt.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==n?n:1,this.bottom=void 0!==i?i:-1,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function Zs(){Gs.call(this,new Qs(-5,5,5,-5,.5,500))}function Ks(e,t){Vs.call(this,e,t),this.type="DirectionalLight",this.position.copy(be.DefaultUp),this.updateMatrix(),this.target=new be,this.shadow=new Zs}function $s(e,t){Vs.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function el(e,t,n,i){Vs.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==i?i:10}Hs.prototype=Object.assign(Object.create(_s.prototype),{constructor:Hs,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Os(t,e))},getPoint:function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),i=0;i<n.length;){if(n[i]>=t){var r=n[i]-t,o=this.curves[i],a=o.getLength(),s=0===a?0:1-r/a;return o.getPointAt(s)}i++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,n=[],i=0,r=this.curves;i<r.length;i++)for(var o=r[i],a=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a),l=0;l<s.length;l++){var u=s[l];t&&t.equals(u)||(n.push(u),t=u)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(e){_s.prototype.copy.call(this,e),this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=_s.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,n=this.curves.length;t<n;t++){var i=this.curves[t];e.curves.push(i.toJSON())}return e},fromJSON:function(e){_s.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var i=e.curves[t];this.curves.push((new Ns[i.type]).fromJSON(i))}return this}}),zs.prototype=Object.assign(Object.create(Hs.prototype),{constructor:zs,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var n=new Os(this.currentPoint.clone(),new a(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,n,i){var r=new Bs(this.currentPoint.clone(),new a(e,t),new a(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this},bezierCurveTo:function(e,t,n,i,r,o){var s=new ks(this.currentPoint.clone(),new a(e,t),new a(n,i),new a(r,o));return this.curves.push(s),this.currentPoint.set(r,o),this},splineThru:function(e){var t=new Is([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,n,i,r,o){var a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+a,t+s,n,i,r,o),this},absarc:function(e,t,n,i,r,o){return this.absellipse(e,t,n,n,i,r,o),this},ellipse:function(e,t,n,i,r,o,a,s){var l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,n,i,r,o,a,s),this},absellipse:function(e,t,n,i,r,o,a,s){var l=new xs(e,t,n,i,r,o,a,s);if(this.curves.length>0){var u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);var c=l.getPoint(1);return this.currentPoint.copy(c),this},copy:function(e){return Hs.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=Hs.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return Hs.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Us.prototype=Object.assign(Object.create(zs.prototype),{constructor:Us,getPointsHoles:function(e){for(var t=[],n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){zs.prototype.copy.call(this,e),this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var i=e.holes[t];this.holes.push(i.clone())}return this},toJSON:function(){var e=zs.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,n=this.holes.length;t<n;t++){var i=this.holes[t];e.holes.push(i.toJSON())}return e},fromJSON:function(e){zs.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var i=e.holes[t];this.holes.push((new zs).fromJSON(i))}return this}}),Vs.prototype=Object.assign(Object.create(be.prototype),{constructor:Vs,isLight:!0,copy:function(e){return be.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=be.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),qs.prototype=Object.assign(Object.create(Vs.prototype),{constructor:qs,isHemisphereLight:!0,copy:function(e){return Vs.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(Gs.prototype,{_projScreenMatrix:new X,_lightPositionWorld:new b,_lookTarget:new b,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,n=this.matrix,i=this._projScreenMatrix,r=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(e.matrixWorld),t.position.copy(o),r.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(r),t.updateMatrixWorld(),i.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(i),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Ws.prototype=Object.assign(Object.create(Gs.prototype),{constructor:Ws,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,n=2*o.RAD2DEG*e.angle,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),Gs.prototype.updateMatrices.call(this,e)}}),Xs.prototype=Object.assign(Object.create(Vs.prototype),{constructor:Xs,isSpotLight:!0,copy:function(e){return Vs.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Js.prototype=Object.assign(Object.create(Gs.prototype),{constructor:Js,isPointLightShadow:!0,updateMatrices:function(e,t){void 0===t&&(t=0);var n=this.camera,i=this.matrix,r=this._lightPositionWorld,o=this._lookTarget,a=this._projScreenMatrix;r.setFromMatrixPosition(e.matrixWorld),n.position.copy(r),o.copy(n.position),o.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(o),n.updateMatrixWorld(),i.makeTranslation(-r.x,-r.y,-r.z),a.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(a)}}),Ys.prototype=Object.assign(Object.create(Vs.prototype),{constructor:Ys,isPointLight:!0,copy:function(e){return Vs.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),Qs.prototype=Object.assign(Object.create(Gt.prototype),{constructor:Qs,isOrthographicCamera:!0,copy:function(e,t){return Gt.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,i,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-e,o=n+e,a=i+t,s=i-t;if(null!==this.view&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o=(r+=l*this.view.offsetX)+l*this.view.width,s=(a-=u*this.view.offsetY)-u*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=be.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),Zs.prototype=Object.assign(Object.create(Gs.prototype),{constructor:Zs,isDirectionalLightShadow:!0,updateMatrices:function(e){Gs.prototype.updateMatrices.call(this,e)}}),Ks.prototype=Object.assign(Object.create(Vs.prototype),{constructor:Ks,isDirectionalLight:!0,copy:function(e){return Vs.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),$s.prototype=Object.assign(Object.create(Vs.prototype),{constructor:$s,isAmbientLight:!0}),el.prototype=Object.assign(Object.create(Vs.prototype),{constructor:el,isRectAreaLight:!0,copy:function(e){return Vs.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=Vs.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});var tl=function(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new b)};function nl(e,t){Vs.call(this,void 0,t),this.type="LightProbe",this.sh=void 0!==e?e:new tl}function il(e){hs.call(this,e),this.textures={}}tl.prototype.set=function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},tl.prototype.zero=function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},tl.prototype.getAt=function(e,t){var n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*i),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],n*i*1.092548),t.addScaledVector(o[5],i*r*1.092548),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],n*r*1.092548),t.addScaledVector(o[8],.546274*(n*n-i*i)),t},tl.prototype.getIrradianceAt=function(e,t){var n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*i),t.addScaledVector(o[2],1.023328*r),t.addScaledVector(o[3],1.023328*n),t.addScaledVector(o[4],.858086*n*i),t.addScaledVector(o[5],.858086*i*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],.858086*n*r),t.addScaledVector(o[8],.429043*(n*n-i*i)),t},tl.prototype.add=function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},tl.prototype.addScaledSH=function(e,t){for(var n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this},tl.prototype.scale=function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},tl.prototype.lerp=function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this},tl.prototype.equals=function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},tl.prototype.copy=function(e){return this.set(e.coefficients)},tl.prototype.clone=function(){return(new this.constructor).copy(this)},tl.prototype.fromArray=function(e,t){void 0===t&&(t=0);for(var n=this.coefficients,i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this},tl.prototype.toArray=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);for(var n=this.coefficients,i=0;i<9;i++)n[i].toArray(e,t+3*i);return e},tl.getBasisAt=function(e,t){var n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)},nl.prototype=Object.assign(Object.create(Vs.prototype),{constructor:nl,isLightProbe:!0,copy:function(e){return Vs.prototype.copy.call(this,e),this.sh.copy(e.sh),this},fromJSON:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this},toJSON:function(e){var t=Vs.prototype.toJSON.call(this,e);return t.object.sh=this.sh.toArray(),t}}),il.prototype=Object.assign(Object.create(hs.prototype),{constructor:il,load:function(e,t,n,i){var r=this,o=new ds(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)},parse:function(e){var t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var i=new Wa[e.type];if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=(new ze).setHex(e.sheen)),void 0!==e.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&i.specular.setHex(e.specular),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),1!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(i.skinning=e.skinning),void 0!==e.morphTargets&&(i.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(i.morphNormals=e.morphNormals),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.vertexTangents&&(i.vertexTangents=e.vertexTangents),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.uniforms)for(var r in e.uniforms){var o=e.uniforms[r];switch(i.uniforms[r]={},o.type){case"t":i.uniforms[r].value=n(o.value);break;case"c":i.uniforms[r].value=(new ze).setHex(o.value);break;case"v2":i.uniforms[r].value=(new a).fromArray(o.value);break;case"v3":i.uniforms[r].value=(new b).fromArray(o.value);break;case"v4":i.uniforms[r].value=(new d).fromArray(o.value);break;case"m3":i.uniforms[r].value=(new u).fromArray(o.value);break;case"m4":i.uniforms[r].value=(new X).fromArray(o.value);break;default:i.uniforms[r].value=o.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var s in e.extensions)i.extensions[s]=e.extensions[s];if(void 0!==e.shading&&(i.flatShading=1===e.shading),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=n(e.map)),void 0!==e.matcap&&(i.matcap=n(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){var l=e.normalScale;!1===Array.isArray(l)&&(l=[l,l]),i.normalScale=(new a).fromArray(l)}return void 0!==e.displacementMap&&(i.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=n(e.specularMap)),void 0!==e.envMap&&(i.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new a).fromArray(e.clearcoatNormalScale)),void 0!==e.transmission&&(i.transmission=e.transmission),void 0!==e.transmissionMap&&(i.transmissionMap=n(e.transmissionMap)),i},setTextures:function(e){return this.textures=e,this}});var rl={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function ol(){dt.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function al(e,t,n,i){"number"==typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Je.call(this,e,t,n),this.meshPerAttribute=i||1}function sl(e){hs.call(this,e)}ol.prototype=Object.assign(Object.create(dt.prototype),{constructor:ol,isInstancedBufferGeometry:!0,copy:function(e){return dt.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=dt.prototype.toJSON.call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}),al.prototype=Object.assign(Object.create(Je.prototype),{constructor:al,isInstancedBufferAttribute:!0,copy:function(e){return Je.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=Je.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),sl.prototype=Object.assign(Object.create(hs.prototype),{constructor:sl,load:function(e,t,n,i){var r=this,o=new ds(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)},parse:function(e){var t={},n={};function i(e,i){if(void 0!==t[i])return t[i];var r=e.interleavedBuffers[i],o=function(e,t){if(void 0!==n[t])return n[t];var i=e.arrayBuffers[t],r=new Uint32Array(i).buffer;return n[t]=r,r}(e,r.buffer),a=new dr(new ll[r.type](o),r.stride);return a.uuid=r.uuid,t[i]=a,a}var r=e.isInstancedBufferGeometry?new ol:new dt,o=e.data.index;if(void 0!==o){var a=new ll[o.type](o.array);r.setIndex(new Je(a,1))}var s=e.data.attributes;for(var l in s){var u=s[l],c=void 0;if(u.isInterleavedBufferAttribute){c=new gr(i(e.data,u.data),u.itemSize,u.offset,u.normalized)}else{var h=new ll[u.type](u.array);c=new(u.isInstancedBufferAttribute?al:Je)(h,u.itemSize,u.normalized)}void 0!==u.name&&(c.name=u.name),r.setAttribute(l,c)}var p=e.data.morphAttributes;if(p)for(var d in p){for(var f=p[d],m=[],g=0,v=f.length;g<v;g++){var y=f[g],_=void 0;if(y.isInterleavedBufferAttribute)_=new gr(i(e.data,y.data),y.itemSize,y.offset,y.normalized);else _=new Je(new ll[y.type](y.array),y.itemSize,y.normalized);void 0!==y.name&&(_.name=y.name),m.push(_)}r.morphAttributes[d]=m}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);var x=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==x)for(var E=0,w=x.length;E!==w;++E){var T=x[E];r.addGroup(T.start,T.count,T.materialIndex)}var M=e.data.boundingSphere;if(void 0!==M){var S=new b;void 0!==M.center&&S.fromArray(M.center),r.boundingSphere=new I(S,M.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}});var ll={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function ul(e){hs.call(this,e)}ul.prototype=Object.assign(Object.create(hs.prototype),{constructor:ul,load:function(e,t,n,i){var r=this,o=""===this.path?rl.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;var a=new ds(r.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.load(e,(function(n){var o=null;try{o=JSON.parse(n)}catch(t){return void 0!==i&&i(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?r.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e)}),n,i)},parse:function(e,t){var n=this.parseShape(e.shapes),i=this.parseGeometries(e.geometries,n),r=this.parseImages(e.images,(function(){void 0!==t&&t(s)})),o=this.parseTextures(e.textures,r),a=this.parseMaterials(e.materials,o),s=this.parseObject(e.object,i,a);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var n=0,i=e.length;n<i;n++){var r=(new Us).fromJSON(e[n]);t[r.uuid]=r}return t},parseGeometries:function(e,t){var n,i={};if(void 0!==e)for(var r=new sl,o=0,a=e.length;o<a;o++){var s=void 0,l=e[o];switch(l.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new Fa[l.type](l.width,l.height,l.widthSegments,l.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new Fa[l.type](l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new Fa[l.type](l.radius,l.segments,l.thetaStart,l.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new Fa[l.type](l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new Fa[l.type](l.radius,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new Fa[l.type](l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":s=new Fa[l.type](l.radius,l.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new Fa[l.type](l.innerRadius,l.outerRadius,l.thetaSegments,l.phiSegments,l.thetaStart,l.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new Fa[l.type](l.radius,l.tube,l.radialSegments,l.tubularSegments,l.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new Fa[l.type](l.radius,l.tube,l.tubularSegments,l.radialSegments,l.p,l.q);break;case"TubeGeometry":case"TubeBufferGeometry":s=new Fa[l.type]((new Ns[l.path.type]).fromJSON(l.path),l.tubularSegments,l.radius,l.radialSegments,l.closed);break;case"LatheGeometry":case"LatheBufferGeometry":s=new Fa[l.type](l.points,l.segments,l.phiStart,l.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":s=new Fa[l.type](l.vertices,l.indices,l.radius,l.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":n=[];for(var u=0,c=l.shapes.length;u<c;u++){var h=t[l.shapes[u]];n.push(h)}s=new Fa[l.type](n,l.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":n=[];for(var p=0,d=l.shapes.length;p<d;p++){var f=t[l.shapes[p]];n.push(f)}var m=l.options.extrudePath;void 0!==m&&(l.options.extrudePath=(new Ns[m.type]).fromJSON(m)),s=new Fa[l.type](n,l.options);break;case"BufferGeometry":case"InstancedBufferGeometry":s=r.parse(l);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+l.type+'"');continue}s.uuid=l.uuid,void 0!==l.name&&(s.name=l.name),!0===s.isBufferGeometry&&void 0!==l.userData&&(s.userData=l.userData),i[l.uuid]=s}return i},parseMaterials:function(e,t){var n={},i={};if(void 0!==e){var r=new il;r.setTextures(t);for(var o=0,a=e.length;o<a;o++){var s=e[o];if("MultiMaterial"===s.type){for(var l=[],u=0;u<s.materials.length;u++){var c=s.materials[u];void 0===n[c.uuid]&&(n[c.uuid]=r.parse(c)),l.push(n[c.uuid])}i[s.uuid]=l}else void 0===n[s.uuid]&&(n[s.uuid]=r.parse(s)),i[s.uuid]=n[s.uuid]}}return i},parseAnimations:function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],r=as.parse(i);void 0!==i.uuid&&(r.uuid=i.uuid),t.push(r)}return t},parseImages:function(e,t){var n,i=this,r={};function o(e){return i.manager.itemStart(e),n.load(e,(function(){i.manager.itemEnd(e)}),void 0,(function(){i.manager.itemError(e),i.manager.itemEnd(e)}))}if(void 0!==e&&e.length>0){var a=new us(t);(n=new gs(a)).setCrossOrigin(this.crossOrigin);for(var s=0,l=e.length;s<l;s++){var u=e[s],c=u.url;if(Array.isArray(c)){r[u.uuid]=[];for(var h=0,p=c.length;h<p;h++){var d=c[h],f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:i.resourcePath+d;r[u.uuid].push(o(f))}}else{var m=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u.url)?u.url:i.resourcePath+u.url;r[u.uuid]=o(m)}}}return r},parseTextures:function(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var i={};if(void 0!==e)for(var r=0,o=e.length;r<o;r++){var a=e[r];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===t[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);var s=void 0;(s=Array.isArray(t[a.image])?new xn(t[a.image]):new p(t[a.image])).needsUpdate=!0,s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.mapping&&(s.mapping=n(a.mapping,hl)),void 0!==a.offset&&s.offset.fromArray(a.offset),void 0!==a.repeat&&s.repeat.fromArray(a.repeat),void 0!==a.center&&s.center.fromArray(a.center),void 0!==a.rotation&&(s.rotation=a.rotation),void 0!==a.wrap&&(s.wrapS=n(a.wrap[0],pl),s.wrapT=n(a.wrap[1],pl)),void 0!==a.format&&(s.format=a.format),void 0!==a.type&&(s.type=a.type),void 0!==a.encoding&&(s.encoding=a.encoding),void 0!==a.minFilter&&(s.minFilter=n(a.minFilter,dl)),void 0!==a.magFilter&&(s.magFilter=n(a.magFilter,dl)),void 0!==a.anisotropy&&(s.anisotropy=a.anisotropy),void 0!==a.flipY&&(s.flipY=a.flipY),void 0!==a.premultiplyAlpha&&(s.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(s.unpackAlignment=a.unpackAlignment),i[a.uuid]=s}return i},parseObject:function(e,t,n){var i,r,o;function a(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function s(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],i=0,r=e.length;i<r;i++){var o=e[i];void 0===n[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),t.push(n[o])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}switch(e.type){case"Scene":i=new pr,void 0!==e.background&&Number.isInteger(e.background)&&(i.background=new ze(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?i.fog=new hr(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new cr(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":i=new Wt(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(i.focus=e.focus),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.filmGauge&&(i.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(i.filmOffset=e.filmOffset),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new Qs(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new $s(e.color,e.intensity);break;case"DirectionalLight":i=new Ks(e.color,e.intensity);break;case"PointLight":i=new Ys(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new el(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new Xs(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":i=new qs(e.color,e.groundColor,e.intensity);break;case"LightProbe":i=(new nl).fromJSON(e);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":i=new Dt(r=a(e.geometry),o=s(e.material));break;case"InstancedMesh":r=a(e.geometry),o=s(e.material);var l=e.count,u=e.instanceMatrix;(i=new Qr(r,o,l)).instanceMatrix=new Je(new Float32Array(u.array),16);break;case"LOD":i=new Nr;break;case"Line":i=new io(a(e.geometry),s(e.material),e.mode);break;case"LineLoop":i=new so(a(e.geometry),s(e.material));break;case"LineSegments":i=new ao(a(e.geometry),s(e.material));break;case"PointCloud":case"Points":i=new fo(a(e.geometry),s(e.material));break;case"Sprite":i=new Pr(s(e.material));break;case"Group":i=new ir;break;default:i=new be}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(i.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.quaternion&&i.quaternion.fromArray(e.quaternion),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.castShadow&&(i.castShadow=e.castShadow),void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(i.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(i.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(i.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&i.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(i.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.frustumCulled&&(i.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(i.renderOrder=e.renderOrder),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.layers&&(i.layers.mask=e.layers),void 0!==e.children)for(var c=e.children,h=0;h<c.length;h++)i.add(this.parseObject(c[h],t,n));if("LOD"===e.type){void 0!==e.autoUpdate&&(i.autoUpdate=e.autoUpdate);for(var p=e.levels,d=0;d<p.length;d++){var f=p[d],m=i.getObjectByProperty("uuid",f.object);void 0!==m&&i.addLevel(m,f.distance)}}return i}});var cl,hl={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},pl={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},dl={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};function fl(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),hs.call(this,e),this.options={premultiplyAlpha:"none"}}function ml(){this.type="ShapePath",this.color=new ze,this.subPaths=[],this.currentPath=null}function gl(e){this.type="Font",this.data=e}function vl(e,t,n,i,r){var o=r.glyphs[e]||r.glyphs["?"];if(o){var a,s,l,u,c,h,p,d,f=new ml;if(o.o)for(var m=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),g=0,v=m.length;g<v;){switch(m[g++]){case"m":a=m[g++]*t+n,s=m[g++]*t+i,f.moveTo(a,s);break;case"l":a=m[g++]*t+n,s=m[g++]*t+i,f.lineTo(a,s);break;case"q":l=m[g++]*t+n,u=m[g++]*t+i,c=m[g++]*t+n,h=m[g++]*t+i,f.quadraticCurveTo(c,h,l,u);break;case"b":l=m[g++]*t+n,u=m[g++]*t+i,c=m[g++]*t+n,h=m[g++]*t+i,p=m[g++]*t+n,d=m[g++]*t+i,f.bezierCurveTo(c,h,p,d,l,u)}}return{offsetX:o.ha*t,path:f}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+r.familyName+".")}function yl(e){hs.call(this,e)}fl.prototype=Object.assign(Object.create(hs.prototype),{constructor:fl,isImageBitmapLoader:!0,setOptions:function(e){return this.options=e,this},load:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,o=ls.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;fetch(e).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,r.options)})).then((function(n){ls.add(e,n),t&&t(n),r.manager.itemEnd(e)})).catch((function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}}),Object.assign(ml.prototype,{moveTo:function(e,t){return this.currentPath=new zs,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this},bezierCurveTo:function(e,t,n,i,r,o){return this.currentPath.bezierCurveTo(e,t,n,i,r,o),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function n(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n],o=new Us;o.curves=r.curves,t.push(o)}return t}function i(e,t){for(var n=t.length,i=!1,r=n-1,o=0;o<n;r=o++){var a=t[r],s=t[o],l=s.x-a.x,u=s.y-a.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(a=t[o],l=-l,s=t[r],u=-u),e.y<a.y||e.y>s.y)continue;if(e.y===a.y){if(e.x===a.x)return!0}else{var c=u*(e.x-a.x)-l*(e.y-a.y);if(0===c)return!0;if(c<0)continue;i=!i}}else{if(e.y!==a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return i}var r,o,a,s=ca.isClockWise,l=this.subPaths;if(0===l.length)return[];if(!0===t)return n(l);var u=[];if(1===l.length)return o=l[0],(a=new Us).curves=o.curves,u.push(a),u;var c=!s(l[0].getPoints());c=e?!c:c;var h,p,d=[],f=[],m=[],g=0;f[g]=void 0,m[g]=[];for(var v=0,y=l.length;v<y;v++)r=s(h=(o=l[v]).getPoints()),(r=e?!r:r)?(!c&&f[g]&&g++,f[g]={s:new Us,p:h},f[g].s.curves=o.curves,c&&g++,m[g]=[]):m[g].push({h:o,p:h[0]});if(!f[0])return n(l);if(f.length>1){for(var b=!1,_=[],x=0,E=f.length;x<E;x++)d[x]=[];for(var w=0,T=f.length;w<T;w++)for(var M=m[w],S=0;S<M.length;S++){for(var C=M[S],A=!0,R=0;R<f.length;R++)i(C.p,f[R].p)&&(w!==R&&_.push({froms:w,tos:R,hole:S}),A?(A=!1,d[R].push(C)):b=!0);A&&d[w].push(C)}_.length>0&&(b||(m=d))}for(var P=0,D=f.length;P<D;P++){a=f[P].s,u.push(a);for(var k=0,j=(p=m[P]).length;k<j;k++)a.holes.push(p[k].h)}return u}}),Object.assign(gl.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var n=[],i=function(e,t,n){for(var i=Array.from?Array.from(e):String(e).split(""),r=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,a=[],s=0,l=0,u=0;u<i.length;u++){var c=i[u];if("\n"===c)s=0,l-=o;else{var h=vl(c,r,s,l,n);s+=h.offsetX,a.push(h.path)}}return a}(e,t,this.data),r=0,o=i.length;r<o;r++)Array.prototype.push.apply(n,i[r].toShapes());return n}}),yl.prototype=Object.assign(Object.create(hs.prototype),{constructor:yl,load:function(e,t,n,i){var r=this,o=new ds(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.load(e,(function(e){var n;try{n=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}var i=r.parse(n);t&&t(i)}),n,i)},parse:function(e){return new gl(e)}});var bl={getContext:function(){return void 0===cl&&(cl=new(window.AudioContext||window.webkitAudioContext)),cl},setContext:function(e){cl=e}};function _l(e){hs.call(this,e)}function xl(e,t,n){nl.call(this,void 0,n);var i=(new ze).set(e),r=(new ze).set(t),o=new b(i.r,i.g,i.b),a=new b(r.r,r.g,r.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(l)}function El(e,t){nl.call(this,void 0,t);var n=(new ze).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}_l.prototype=Object.assign(Object.create(hs.prototype),{constructor:_l,load:function(e,t,n,i){var r=this,o=new ds(r.manager);o.setResponseType("arraybuffer"),o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.load(e,(function(n){try{var o=n.slice(0);bl.getContext().decodeAudioData(o,(function(e){t(e)}))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}}),xl.prototype=Object.assign(Object.create(nl.prototype),{constructor:xl,isHemisphereLightProbe:!0,copy:function(e){return nl.prototype.copy.call(this,e),this},toJSON:function(e){return nl.prototype.toJSON.call(this,e)}}),El.prototype=Object.assign(Object.create(nl.prototype),{constructor:El,isAmbientLightProbe:!0,copy:function(e){return nl.prototype.copy.call(this,e),this},toJSON:function(e){return nl.prototype.toJSON.call(this,e)}});var wl=new X,Tl=new X;function Ml(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Wt,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Wt,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(Ml.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var n,i,r=e.projectionMatrix.clone(),a=t.eyeSep/2,s=a*t.near/t.focus,l=t.near*Math.tan(o.DEG2RAD*t.fov*.5)/t.zoom;Tl.elements[12]=-a,wl.elements[12]=a,n=-l*t.aspect+s,i=l*t.aspect+s,r.elements[0]=2*t.near/(i-n),r.elements[8]=(i+n)/(i-n),this.cameraL.projectionMatrix.copy(r),n=-l*t.aspect-s,i=l*t.aspect-s,r.elements[0]=2*t.near/(i-n),r.elements[8]=(i+n)/(i-n),this.cameraR.projectionMatrix.copy(r)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Tl),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(wl)}});var Sl=function(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1};Sl.prototype.start=function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},Sl.prototype.stop=function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},Sl.prototype.getElapsedTime=function(){return this.getDelta(),this.elapsedTime},Sl.prototype.getDelta=function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e};var Cl=new b,Al=new v,Rl=new b,Pl=new b,Dl=function(e){function t(){e.call(this),this.type="AudioListener",this.context=bl.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Sl}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getInput=function(){return this.gain},t.prototype.removeFilter=function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},t.prototype.getFilter=function(){return this.filter},t.prototype.setFilter=function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},t.prototype.getMasterVolume=function(){return this.gain.gain.value},t.prototype.setMasterVolume=function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},t.prototype.updateMatrixWorld=function(t){e.prototype.updateMatrixWorld.call(this,t);var n=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Cl,Al,Rl),Pl.set(0,0,-1).applyQuaternion(Al),n.positionX){var r=this.context.currentTime+this.timeDelta;n.positionX.linearRampToValueAtTime(Cl.x,r),n.positionY.linearRampToValueAtTime(Cl.y,r),n.positionZ.linearRampToValueAtTime(Cl.z,r),n.forwardX.linearRampToValueAtTime(Pl.x,r),n.forwardY.linearRampToValueAtTime(Pl.y,r),n.forwardZ.linearRampToValueAtTime(Pl.z,r),n.upX.linearRampToValueAtTime(i.x,r),n.upY.linearRampToValueAtTime(i.y,r),n.upZ.linearRampToValueAtTime(i.z,r)}else n.setPosition(Cl.x,Cl.y,Cl.z),n.setOrientation(Pl.x,Pl.y,Pl.z,i.x,i.y,i.z)},t}(be),kl=function(e){function t(t){e.call(this),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getOutput=function(){return this.gain},t.prototype.setNodeSource=function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},t.prototype.setMediaElementSource=function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},t.prototype.setMediaStreamSource=function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},t.prototype.setBuffer=function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},t.prototype.play=function(e){if(void 0===e&&(e=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},t.prototype.pause=function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},t.prototype.stop=function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},t.prototype.connect=function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this},t.prototype.disconnect=function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this},t.prototype.getFilters=function(){return this.filters},t.prototype.setFilters=function(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},t.prototype.setDetune=function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},t.prototype.getDetune=function(){return this.detune},t.prototype.getFilter=function(){return this.getFilters()[0]},t.prototype.setFilter=function(e){return this.setFilters(e?[e]:[])},t.prototype.setPlaybackRate=function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},t.prototype.getPlaybackRate=function(){return this.playbackRate},t.prototype.onEnded=function(){this.isPlaying=!1},t.prototype.getLoop=function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},t.prototype.setLoop=function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},t.prototype.setLoopStart=function(e){return this.loopStart=e,this},t.prototype.setLoopEnd=function(e){return this.loopEnd=e,this},t.prototype.getVolume=function(){return this.gain.gain.value},t.prototype.setVolume=function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},t}(be),jl=new b,Ol=new v,Fl=new b,Bl=new b,Ll=function(e){function t(t){e.call(this,t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getOutput=function(){return this.panner},t.prototype.getRefDistance=function(){return this.panner.refDistance},t.prototype.setRefDistance=function(e){return this.panner.refDistance=e,this},t.prototype.getRolloffFactor=function(){return this.panner.rolloffFactor},t.prototype.setRolloffFactor=function(e){return this.panner.rolloffFactor=e,this},t.prototype.getDistanceModel=function(){return this.panner.distanceModel},t.prototype.setDistanceModel=function(e){return this.panner.distanceModel=e,this},t.prototype.getMaxDistance=function(){return this.panner.maxDistance},t.prototype.setMaxDistance=function(e){return this.panner.maxDistance=e,this},t.prototype.setDirectionalCone=function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this},t.prototype.updateMatrixWorld=function(t){if(e.prototype.updateMatrixWorld.call(this,t),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(jl,Ol,Fl),Bl.set(0,0,1).applyQuaternion(Ol);var n=this.panner;if(n.positionX){var i=this.context.currentTime+this.listener.timeDelta;n.positionX.linearRampToValueAtTime(jl.x,i),n.positionY.linearRampToValueAtTime(jl.y,i),n.positionZ.linearRampToValueAtTime(jl.z,i),n.orientationX.linearRampToValueAtTime(Bl.x,i),n.orientationY.linearRampToValueAtTime(Bl.y,i),n.orientationZ.linearRampToValueAtTime(Bl.z,i)}else n.setPosition(jl.x,jl.y,jl.z),n.setOrientation(Bl.x,Bl.y,Bl.z)}},t}(kl),Il=function(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)};function Nl(e,t,n){var i,r,o;switch(this.binding=e,this.valueSize=n,t){case"quaternion":i=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Il.prototype.getFrequencyData=function(){return this.analyser.getByteFrequencyData(this.data),this.data},Il.prototype.getAverageFrequency=function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length},Object.assign(Nl.prototype,{accumulate:function(e,t){var n=this.buffer,i=this.valueSize,r=e*i+i,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==i;++a)n[r+a]=n[a];o=t}else{var s=t/(o+=t);this._mixBufferRegion(n,r,0,s,i)}this.cumulativeWeight=o},accumulateAdditive:function(e){var t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e},apply:function(e){var t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){var s=t*this._origIndex;this._mixBufferRegion(n,i,s,1-r,t)}o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(var l=t,u=t+t;l!==u;++l)if(n[l]!==n[l+t]){a.setValue(n,i);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(var r=n,o=i;r!==o;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_setAdditiveIdentityNumeric:function(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize,n=e;n<t;n++)this.buffer[n]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]},_select:function(e,t,n,i,r){if(i>=.5)for(var o=0;o!==r;++o)e[t+o]=e[n+o]},_slerp:function(e,t,n,i){v.slerpFlat(e,t,e,t,e,n,i)},_slerpAdditive:function(e,t,n,i,r){var o=this._workIndex*r;v.multiplyQuaternionsFlat(e,o,e,t,e,n),v.slerpFlat(e,t,e,t,e,o,i)},_lerp:function(e,t,n,i,r){for(var o=1-i,a=0;a!==r;++a){var s=t+a;e[s]=e[s]*o+e[n+a]*i}},_lerpAdditive:function(e,t,n,i,r){for(var o=0;o!==r;++o){var a=t+o;e[a]=e[a]+e[n+o]*i}}});var Hl=new RegExp("[\\[\\]\\.:\\/]","g"),zl="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Ul=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),Vl=/(WCOD+)?/.source.replace("WCOD",zl),ql=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Gl=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Wl=new RegExp("^"+Ul+Vl+ql+Gl+"$"),Xl=["material","materials","bones"];function Jl(e,t,n){var i=n||Yl.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}function Yl(e,t,n){this.path=t,this.parsedPath=n||Yl.parseTrackName(t),this.node=Yl.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function Ql(){this.uuid=o.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}Object.assign(Jl.prototype,{getValue:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)},setValue:function(e,t){for(var n=this._bindings,i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(Yl,{Composite:Jl,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new Yl.Composite(e,t,n):new Yl(e,t,n)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(Hl,"")},parseTrackName:function(e){var t=Wl.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var r=n.nodeName.substring(i+1);-1!==Xl.indexOf(r)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n},findNode:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var i=function(e){for(var n=0;n<e.length;n++){var r=e[n];if(r.name===t||r.uuid===t)return r;var o=i(r.children);if(o)return o}return null},r=i(e.children);if(r)return r}return null}}),Object.assign(Yl.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)e[t++]=n[i]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++]},function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,n=t.objectName,i=t.propertyName,r=t.propertyIndex;if(e||(e=Yl.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(n){var o=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var a=0;a<e.length;a++)if(e[a].name===o){o=a;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==o){if(void 0===e[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var s=e[i];if(void 0!==s){var l=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var u=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}u=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(u=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][l]}else{var c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+i+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Yl.prototype,{_getValue_unbound:Yl.prototype.getValue,_setValue_unbound:Yl.prototype.setValue}),Object.assign(Ql.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,o=r.length,a=void 0,s=e.length,l=this.nCachedObjects_,u=0,c=arguments.length;u!==c;++u){var h=arguments[u],p=h.uuid,d=t[p];if(void 0===d){d=s++,t[p]=d,e.push(h);for(var f=0,m=o;f!==m;++f)r[f].push(new Yl(h,n[f],i[f]))}else if(d<l){a=e[d];var g=--l,v=e[g];t[v.uuid]=d,e[d]=v,t[p]=g,e[g]=h;for(var y=0,b=o;y!==b;++y){var _=r[y],x=_[g],E=_[d];_[d]=x,void 0===E&&(E=new Yl(h,n[y],i[y])),_[g]=E}}else e[d]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l},remove:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length,r=this.nCachedObjects_,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],l=s.uuid,u=t[l];if(void 0!==u&&u>=r){var c=r++,h=e[c];t[h.uuid]=u,e[u]=h,t[l]=c,e[c]=s;for(var p=0,d=i;p!==d;++p){var f=n[p],m=f[c],g=f[u];f[u]=m,f[c]=g}}}this.nCachedObjects_=r},uncache:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length,r=this.nCachedObjects_,o=e.length,a=0,s=arguments.length;a!==s;++a){var l=arguments[a],u=l.uuid,c=t[u];if(void 0!==c)if(delete t[u],c<r){var h=--r,p=e[h],d=--o,f=e[d];t[p.uuid]=c,e[c]=p,t[f.uuid]=h,e[h]=f,e.pop();for(var m=0,g=i;m!==g;++m){var v=n[m],y=v[h],b=v[d];v[c]=y,v[h]=b,v.pop()}}else{var _=--o,x=e[_];t[x.uuid]=c,e[c]=x,e.pop();for(var E=0,w=i;E!==w;++E){var T=n[E];T[c]=T[_],T.pop()}}}this.nCachedObjects_=r},subscribe_:function(e,t){var n=this._bindingsIndicesByPath,i=n[e],r=this._bindings;if(void 0!==i)return r[i];var o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,u=this.nCachedObjects_,c=new Array(l);i=r.length,n[e]=i,o.push(e),a.push(t),r.push(c);for(var h=u,p=s.length;h!==p;++h){var d=s[h];c[h]=new Yl(d,e,t)}return c},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var i=this._paths,r=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];t[e[a]]=n,o[n]=s,o.pop(),r[n]=r[a],r.pop(),i[n]=i[a],i.pop()}}});var Zl=function(e,t,n,i){this._mixer=e,this._clip=t,this._localRoot=n||null,this.blendMode=i||t.blendMode;for(var r=t.tracks,o=r.length,a=new Array(o),s={endingStart:2400,endingEnd:2400},l=0;l!==o;++l){var u=r[l].createInterpolant(null);a[l]=u,u.settings=s}this._interpolantSettings=s,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0};function Kl(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}Zl.prototype.play=function(){return this._mixer._activateAction(this),this},Zl.prototype.stop=function(){return this._mixer._deactivateAction(this),this.reset()},Zl.prototype.reset=function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},Zl.prototype.isRunning=function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},Zl.prototype.isScheduled=function(){return this._mixer._isActiveAction(this)},Zl.prototype.startAt=function(e){return this._startTime=e,this},Zl.prototype.setLoop=function(e,t){return this.loop=e,this.repetitions=t,this},Zl.prototype.setEffectiveWeight=function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},Zl.prototype.getEffectiveWeight=function(){return this._effectiveWeight},Zl.prototype.fadeIn=function(e){return this._scheduleFading(e,0,1)},Zl.prototype.fadeOut=function(e){return this._scheduleFading(e,1,0)},Zl.prototype.crossFadeFrom=function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var i=this._clip.duration,r=e._clip.duration,o=r/i,a=i/r;e.warp(1,o,t),this.warp(a,1,t)}return this},Zl.prototype.crossFadeTo=function(e,t,n){return e.crossFadeFrom(this,t,n)},Zl.prototype.stopFading=function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},Zl.prototype.setEffectiveTimeScale=function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},Zl.prototype.getEffectiveTimeScale=function(){return this._effectiveTimeScale},Zl.prototype.setDuration=function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},Zl.prototype.syncWith=function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},Zl.prototype.halt=function(e){return this.warp(this._effectiveTimeScale,0,e)},Zl.prototype.warp=function(e,t,n){var i=this._mixer,r=i.time,o=this.timeScale,a=this._timeScaleInterpolant;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,l=a.sampleValues;return s[0]=r,s[1]=r+n,l[0]=e/o,l[1]=t/o,this},Zl.prototype.stopWarping=function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},Zl.prototype.getMixer=function(){return this._mixer},Zl.prototype.getClip=function(){return this._clip},Zl.prototype.getRoot=function(){return this._localRoot||this._mixer._root},Zl.prototype._update=function(e,t,n,i){if(this.enabled){var r=this._startTime;if(null!==r){var o=(e-r)*n;if(o<0||0===n)return;this._startTime=null,t=n*o}t*=this._updateTimeScale(e);var a=this._updateTime(t),s=this._updateWeight(e);if(s>0){var l=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case 2501:for(var c=0,h=l.length;c!==h;++c)l[c].evaluate(a),u[c].accumulateAdditive(s);break;case 2500:default:for(var p=0,d=l.length;p!==d;++p)l[p].evaluate(a),u[p].accumulate(i,s)}}}else this._updateWeight(e)},Zl.prototype._updateWeight=function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t},Zl.prototype._updateTimeScale=function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t},Zl.prototype._updateTime=function(e){var t=this._clip.duration,n=this.loop,i=this.time+e,r=this._loopCount,o=2202===n;if(0===e)return-1===r?i:o&&1==(1&r)?t-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),i>=t||i<0){var a=Math.floor(i/t);i-=t*a,r+=Math.abs(a);var s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=i;if(o&&1==(1&r))return t-i}return i},Zl.prototype._setEndings=function(e,t,n){var i=this._interpolantSettings;n?(i.endingStart=2401,i.endingEnd=2401):(i.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,i.endingEnd=t?this.zeroSlopeAtEnd?2401:2400:2402)},Zl.prototype._scheduleFading=function(e,t,n){var i=this._mixer,r=i.time,o=this._weightInterpolant;null===o&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=r,s[0]=t,a[1]=r+e,s[1]=n,this},Kl.prototype=Object.assign(Object.create(t.prototype),{constructor:Kl,_bindAction:function(e,t){var n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,o=e._propertyBindings,a=e._interpolants,s=n.uuid,l=this._bindingsByRootAndName,u=l[s];void 0===u&&(u={},l[s]=u);for(var c=0;c!==r;++c){var h=i[c],p=h.name,d=u[p];if(void 0!==d)o[c]=d;else{if(void 0!==(d=o[c])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,s,p));continue}var f=t&&t._propertyBindings[c].binding.parsedPath;++(d=new Nl(Yl.create(n,p,f),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(d,s,p),o[c]=d}a[c].resultBuffer=d.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}for(var r=e._propertyBindings,o=0,a=r.length;o!==a;++o){var s=r[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){var i=this._actions,r=this._actionsByClip,o=r[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{var a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=i.length,i.push(e),o.actionByRoot[n]=e},_removeInactiveAction:function(e){var t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;var r=e._clip.uuid,o=this._actionsByClip,a=o[r],s=a.knownActions,l=s[s.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,s[u]=l,s.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[r],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0==--r.referenceCount&&this._removeInactiveBinding(r)}},_lendAction:function(e){var t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_takeBackAction:function(e){var t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_addInactiveBinding:function(e,t,n){var i=this._bindingsByRootAndName,r=this._bindings,o=i[t];void 0===o&&(o={},i[t]=o),o[n]=e,e._cacheIndex=r.length,r.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,o=this._bindingsByRootAndName,a=o[i],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete a[r],0===Object.keys(a).length&&delete o[i]},_lendBinding:function(e){var t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_takeBackBinding:function(e){var t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new Qa(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=n),n},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t,n){var i=t||this._root,r=i.uuid,o="string"==typeof e?as.findByName(i,e):e,a=null!==o?o.uuid:e,s=this._actionsByClip[a],l=null;if(void 0===n&&(n=null!==o?o.blendMode:2500),void 0!==s){var u=s.actionByRoot[r];if(void 0!==u&&u.blendMode===n)return u;l=s.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;var c=new Zl(this,o,t,n);return this._bindAction(c,l),this._addInactiveAction(c,a,r),c},existingAction:function(e,t){var n=t||this._root,i=n.uuid,r="string"==typeof e?as.findByName(n,e):e,o=r?r.uuid:e,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[i]||null},stopAllAction:function(){for(var e=this._actions,t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this},update:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1,a=0;a!==n;++a){t[a]._update(i,e,r,o)}for(var s=this._bindings,l=this._nActiveBindings,u=0;u!==l;++u)s[u].apply(o);return this},setTime:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){for(var o=r.knownActions,a=0,s=o.length;a!==s;++a){var l=o[a];this._deactivateAction(l);var u=l._cacheIndex,c=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,c._cacheIndex=u,t[u]=c,t.pop(),this._removeInactiveBindingsForAction(l)}delete i[n]}},uncacheRoot:function(e){var t=e.uuid,n=this._actionsByClip;for(var i in n){var r=n[i].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}});var $l=function(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e};function eu(e,t,n){dr.call(this,e,t),this.meshPerAttribute=n||1}function tu(e,t,n,i,r){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}function nu(e,t,n,i){this.ray=new W(e,t),this.near=n||0,this.far=i||1/0,this.camera=null,this.layers=new oe,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function iu(e,t){return e.distance-t.distance}function ru(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===i)for(var r=e.children,o=0,a=r.length;o<a;o++)ru(r[o],t,n,!0)}$l.prototype.clone=function(){return new $l(void 0===this.value.clone?this.value:this.value.clone())},eu.prototype=Object.assign(Object.create(dr.prototype),{constructor:eu,isInstancedInterleavedBuffer:!0,copy:function(e){return dr.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},clone:function(e){var t=dr.prototype.clone.call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(e){var t=dr.prototype.toJSON.call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}),Object.defineProperty(tu.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(tu.prototype,{isGLBufferAttribute:!0,setBuffer:function(e){return this.buffer=e,this},setType:function(e,t){return this.type=e,this.elementSize=t,this},setItemSize:function(e){return this.itemSize=e,this},setCount:function(e){return this.count=e,this}}),Object.assign(nu.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,n){var i=n||[];return ru(e,this,i,t),i.sort(iu),i},intersectObjects:function(e,t,n){var i=n||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var r=0,o=e.length;r<o;r++)ru(e[r],this,i,t);return i.sort(iu),i}});var ou=function(e,t,n){return void 0===e&&(e=1),void 0===t&&(t=0),void 0===n&&(n=0),this.radius=e,this.phi=t,this.theta=n,this};ou.prototype.set=function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},ou.prototype.clone=function(){return(new this.constructor).copy(this)},ou.prototype.copy=function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},ou.prototype.makeSafe=function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},ou.prototype.setFromVector3=function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},ou.prototype.setFromCartesianCoords=function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(o.clamp(t/this.radius,-1,1))),this};var au=function(e,t,n){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==n?n:0,this};au.prototype.set=function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this},au.prototype.clone=function(){return(new this.constructor).copy(this)},au.prototype.copy=function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},au.prototype.setFromVector3=function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},au.prototype.setFromCartesianCoords=function(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this};var su=new a,lu=function(e,t){Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==e?e:new a(1/0,1/0),this.max=void 0!==t?t:new a(-1/0,-1/0)};lu.prototype.set=function(e,t){return this.min.copy(e),this.max.copy(t),this},lu.prototype.setFromPoints=function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},lu.prototype.setFromCenterAndSize=function(e,t){var n=su.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},lu.prototype.clone=function(){return(new this.constructor).copy(this)},lu.prototype.copy=function(e){return this.min.copy(e.min),this.max.copy(e.max),this},lu.prototype.makeEmpty=function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},lu.prototype.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y},lu.prototype.getCenter=function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new a),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},lu.prototype.getSize=function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new a),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},lu.prototype.expandByPoint=function(e){return this.min.min(e),this.max.max(e),this},lu.prototype.expandByVector=function(e){return this.min.sub(e),this.max.add(e),this},lu.prototype.expandByScalar=function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},lu.prototype.containsPoint=function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},lu.prototype.containsBox=function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},lu.prototype.getParameter=function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new a),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},lu.prototype.intersectsBox=function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},lu.prototype.clampPoint=function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new a),t.copy(e).clamp(this.min,this.max)},lu.prototype.distanceToPoint=function(e){return su.copy(e).clamp(this.min,this.max).sub(e).length()},lu.prototype.intersect=function(e){return this.min.max(e.min),this.max.min(e.max),this},lu.prototype.union=function(e){return this.min.min(e.min),this.max.max(e.max),this},lu.prototype.translate=function(e){return this.min.add(e),this.max.add(e),this},lu.prototype.equals=function(e){return e.min.equals(this.min)&&e.max.equals(this.max)};var uu=new b,cu=new b,hu=function(e,t){this.start=void 0!==e?e:new b,this.end=void 0!==t?t:new b};function pu(e){be.call(this),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}hu.prototype.set=function(e,t){return this.start.copy(e),this.end.copy(t),this},hu.prototype.clone=function(){return(new this.constructor).copy(this)},hu.prototype.copy=function(e){return this.start.copy(e.start),this.end.copy(e.end),this},hu.prototype.getCenter=function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new b),e.addVectors(this.start,this.end).multiplyScalar(.5)},hu.prototype.delta=function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new b),e.subVectors(this.end,this.start)},hu.prototype.distanceSq=function(){return this.start.distanceToSquared(this.end)},hu.prototype.distance=function(){return this.start.distanceTo(this.end)},hu.prototype.at=function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new b),this.delta(t).multiplyScalar(e).add(this.start)},hu.prototype.closestPointToPointParameter=function(e,t){uu.subVectors(e,this.start),cu.subVectors(this.end,this.start);var n=cu.dot(cu),i=cu.dot(uu)/n;return t&&(i=o.clamp(i,0,1)),i},hu.prototype.closestPointToPoint=function(e,t,n){var i=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new b),this.delta(n).multiplyScalar(i).add(this.start)},hu.prototype.applyMatrix4=function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},hu.prototype.equals=function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},pu.prototype=Object.create(be.prototype),pu.prototype.constructor=pu,pu.prototype.isImmediateRenderObject=!0;var du=new b,fu=function(e){function t(t,n){e.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;for(var i=new dt,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],o=0,a=1;o<32;o++,a++){var s=o/32*Math.PI*2,l=a/32*Math.PI*2;r.push(Math.cos(s),Math.sin(s),1,Math.cos(l),Math.sin(l),1)}i.setAttribute("position",new nt(r,3));var u=new Zr({fog:!1,toneMapped:!1});this.cone=new ao(i,u),this.add(this.cone),this.update()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},t.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),du.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(du),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)},t}(be),mu=new b,gu=new X,vu=new X,yu=function(e){function t(t){for(var n=function e(t){var n=[];t&&t.isBone&&n.push(t);for(var i=0;i<t.children.length;i++)n.push.apply(n,e(t.children[i]));return n}(t),i=new dt,r=[],o=[],a=new ze(0,0,1),s=new ze(0,1,0),l=0;l<n.length;l++){var u=n[l];u.parent&&u.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),o.push(a.r,a.g,a.b),o.push(s.r,s.g,s.b))}i.setAttribute("position",new nt(r,3)),i.setAttribute("color",new nt(o,3));var c=new Zr({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});e.call(this,i,c),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=n,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.updateMatrixWorld=function(t){var n=this.bones,i=this.geometry,r=i.getAttribute("position");vu.getInverse(this.root.matrixWorld);for(var o=0,a=0;o<n.length;o++){var s=n[o];s.parent&&s.parent.isBone&&(gu.multiplyMatrices(vu,s.matrixWorld),mu.setFromMatrixPosition(gu),r.setXYZ(a,mu.x,mu.y,mu.z),gu.multiplyMatrices(vu,s.parent.matrixWorld),mu.setFromMatrixPosition(gu),r.setXYZ(a+1,mu.x,mu.y,mu.z),a+=2)}i.getAttribute("position").needsUpdate=!0,e.prototype.updateMatrixWorld.call(this,t)},t}(ao);var bu=function(e){function t(t,n,i){var r=new _a(n,4,2),o=new Ge({wireframe:!0,fog:!1,toneMapped:!1});e.call(this,r,o),this.light=t,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},t.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},t}(Dt),_u=new b,xu=new ze,Eu=new ze,wu=function(e){function t(t,n,i){e.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;var r=new Ao(n);r.rotateY(.5*Math.PI),this.material=new Ge({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);var o=r.getAttribute("position"),a=new Float32Array(3*o.count);r.setAttribute("color",new Je(a,3)),this.add(new Dt(r,this.material)),this.update()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},t.prototype.update=function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");xu.copy(this.light.color),Eu.copy(this.light.groundColor);for(var n=0,i=t.count;n<i;n++){var r=n<i/2?xu:Eu;t.setXYZ(n,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(_u.setFromMatrixPosition(this.light.matrixWorld).negate())},t}(be),Tu=function(e){function t(t,n,i,r){t=t||10,n=n||10,i=new ze(void 0!==i?i:4473924),r=new ze(void 0!==r?r:8947848);for(var o=n/2,a=t/n,s=t/2,l=[],u=[],c=0,h=0,p=-s;c<=n;c++,p+=a){l.push(-s,0,p,s,0,p),l.push(p,0,-s,p,0,s);var d=c===o?i:r;d.toArray(u,h),h+=3,d.toArray(u,h),h+=3,d.toArray(u,h),h+=3,d.toArray(u,h),h+=3}var f=new dt;f.setAttribute("position",new nt(l,3)),f.setAttribute("color",new nt(u,3));var m=new Zr({vertexColors:!0,toneMapped:!1});e.call(this,f,m),this.type="GridHelper"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(ao),Mu=function(e){function t(t,n,i,r,o,a){t=t||10,n=n||16,i=i||8,r=r||64,o=new ze(void 0!==o?o:4473924),a=new ze(void 0!==a?a:8947848);for(var s=[],l=[],u=0;u<=n;u++){var c=u/n*(2*Math.PI),h=Math.sin(c)*t,p=Math.cos(c)*t;s.push(0,0,0),s.push(h,0,p);var d=1&u?o:a;l.push(d.r,d.g,d.b),l.push(d.r,d.g,d.b)}for(var f=0;f<=i;f++)for(var m=1&f?o:a,g=t-t/i*f,v=0;v<r;v++){var y=v/r*(2*Math.PI),b=Math.sin(y)*g,_=Math.cos(y)*g;s.push(b,0,_),l.push(m.r,m.g,m.b),y=(v+1)/r*(2*Math.PI),b=Math.sin(y)*g,_=Math.cos(y)*g,s.push(b,0,_),l.push(m.r,m.g,m.b)}var x=new dt;x.setAttribute("position",new nt(s,3)),x.setAttribute("color",new nt(l,3));var E=new Zr({vertexColors:!0,toneMapped:!1});e.call(this,x,E),this.type="PolarGridHelper"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(ao),Su=new b,Cu=new b,Au=new b,Ru=function(e){function t(t,n,i){e.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===n&&(n=1);var r=new dt;r.setAttribute("position",new nt([-n,n,0,n,n,0,n,-n,0,-n,-n,0,-n,n,0],3));var o=new Zr({fog:!1,toneMapped:!1});this.lightPlane=new io(r,o),this.add(this.lightPlane),(r=new dt).setAttribute("position",new nt([0,0,0,0,0,1],3)),this.targetLine=new io(r,o),this.add(this.targetLine),this.update()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},t.prototype.update=function(){Su.setFromMatrixPosition(this.light.matrixWorld),Cu.setFromMatrixPosition(this.light.target.matrixWorld),Au.subVectors(Cu,Su),this.lightPlane.lookAt(Cu),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Cu),this.targetLine.scale.z=Au.length()},t}(be),Pu=new b,Du=new Gt,ku=function(e){function t(t){var n=new dt,i=new Zr({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],o=[],a={},s=new ze(16755200),l=new ze(16711680),u=new ze(43775),c=new ze(16777215),h=new ze(3355443);function p(e,t,n){d(e,n),d(t,n)}function d(e,t){r.push(0,0,0),o.push(t.r,t.g,t.b),void 0===a[e]&&(a[e]=[]),a[e].push(r.length/3-1)}p("n1","n2",s),p("n2","n4",s),p("n4","n3",s),p("n3","n1",s),p("f1","f2",s),p("f2","f4",s),p("f4","f3",s),p("f3","f1",s),p("n1","f1",s),p("n2","f2",s),p("n3","f3",s),p("n4","f4",s),p("p","n1",l),p("p","n2",l),p("p","n3",l),p("p","n4",l),p("u1","u2",u),p("u2","u3",u),p("u3","u1",u),p("c","t",c),p("p","c",h),p("cn1","cn2",h),p("cn3","cn4",h),p("cf1","cf2",h),p("cf3","cf4",h),n.setAttribute("position",new nt(r,3)),n.setAttribute("color",new nt(o,3)),e.call(this,n,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.update=function(){var e=this.geometry,t=this.pointMap;Du.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ju("c",t,e,Du,0,0,-1),ju("t",t,e,Du,0,0,1),ju("n1",t,e,Du,-1,-1,-1),ju("n2",t,e,Du,1,-1,-1),ju("n3",t,e,Du,-1,1,-1),ju("n4",t,e,Du,1,1,-1),ju("f1",t,e,Du,-1,-1,1),ju("f2",t,e,Du,1,-1,1),ju("f3",t,e,Du,-1,1,1),ju("f4",t,e,Du,1,1,1),ju("u1",t,e,Du,.7,1.1,-1),ju("u2",t,e,Du,-.7,1.1,-1),ju("u3",t,e,Du,0,2,-1),ju("cf1",t,e,Du,-1,0,1),ju("cf2",t,e,Du,1,0,1),ju("cf3",t,e,Du,0,-1,1),ju("cf4",t,e,Du,0,1,1),ju("cn1",t,e,Du,-1,0,-1),ju("cn2",t,e,Du,1,0,-1),ju("cn3",t,e,Du,0,-1,-1),ju("cn4",t,e,Du,0,1,-1),e.getAttribute("position").needsUpdate=!0},t}(ao);function ju(e,t,n,i,r,o,a){Pu.set(r,o,a).unproject(i);var s=t[e];if(void 0!==s)for(var l=n.getAttribute("position"),u=0,c=s.length;u<c;u++)l.setXYZ(s[u],Pu.x,Pu.y,Pu.z)}var Ou,Fu,Bu=new E,Lu=function(e){function t(t,n){void 0===n&&(n=16776960);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),o=new dt;o.setIndex(new Je(i,1)),o.setAttribute("position",new Je(r,3)),e.call(this,o,new Zr({color:n,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.update=function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Bu.setFromObject(this.object),!Bu.isEmpty()){var t=Bu.min,n=Bu.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}},t.prototype.setFromObject=function(e){return this.object=e,this.update(),this},t.prototype.copy=function(t){return e.prototype.copy.call(this,t),this.object=t.object,this},t}(ao),Iu=function(e){function t(t,n){void 0===n&&(n=16776960);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new dt;r.setIndex(new Je(i,1)),r.setAttribute("position",new nt([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),e.call(this,r,new Zr({color:n,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.updateMatrixWorld=function(t){var n=this.box;n.isEmpty()||(n.getCenter(this.position),n.getSize(this.scale),this.scale.multiplyScalar(.5),e.prototype.updateMatrixWorld.call(this,t))},t}(ao),Nu=function(e){function t(t,n,i){var r=void 0!==i?i:16776960,o=new dt;o.setAttribute("position",new nt([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),o.computeBoundingSphere(),e.call(this,o,new Zr({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=void 0===n?1:n;var a=new dt;a.setAttribute("position",new nt([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new Dt(a,new Ge({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.updateMatrixWorld=function(t){var n=-this.plane.constant;Math.abs(n)<1e-8&&(n=1e-8),this.scale.set(.5*this.size,.5*this.size,n),this.children[0].material.side=n<0?1:0,this.lookAt(this.plane.normal),e.prototype.updateMatrixWorld.call(this,t)},t}(io),Hu=new b,zu=function(e){function t(t,n,i,r,o,a){e.call(this),this.type="ArrowHelper",void 0===t&&(t=new b(0,0,1)),void 0===n&&(n=new b(0,0,0)),void 0===i&&(i=1),void 0===r&&(r=16776960),void 0===o&&(o=.2*i),void 0===a&&(a=.2*o),void 0===Ou&&((Ou=new dt).setAttribute("position",new nt([0,0,0,0,1,0],3)),(Fu=new Pa(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(n),this.line=new io(Ou,new Zr({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Dt(Fu,new Ge({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,o,a)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setDirection=function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Hu.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Hu,t)}},t.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},t.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},t.prototype.copy=function(t){return e.prototype.copy.call(this,t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this},t}(be),Uu=function(e){function t(t){void 0===t&&(t=1);var n=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new dt;i.setAttribute("position",new nt(n,3)),i.setAttribute("color",new nt([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var r=new Zr({vertexColors:!0,toneMapped:!1});e.call(this,i,r),this.type="AxesHelper"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(ao),Vu=Math.pow(2,8),qu=[.125,.215,.35,.446,.526,.582],Gu=5+qu.length,Wu={3e3:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},Xu=new Qs,Ju=function(){for(var e=[],t=[],n=[],i=8,r=0;r<Gu;r++){var o=Math.pow(2,i);t.push(o);var a=1/o;r>4?a=qu[r-8+4-1]:0==r&&(a=0),n.push(a);for(var s=1/(o-1),l=-s/2,u=1+s/2,c=[l,l,u,l,u,u,l,l,u,u,l,u],h=new Float32Array(108),p=new Float32Array(72),d=new Float32Array(36),f=0;f<6;f++){var m=f%3*2/3-1,g=f>2?0:-1,v=[m,g,0,m+2/3,g,0,m+2/3,g+1,0,m,g,0,m+2/3,g+1,0,m,g+1,0];h.set(v,18*f),p.set(c,12*f);var y=[f,f,f,f,f,f];d.set(y,6*f)}var b=new dt;b.setAttribute("position",new Je(h,3)),b.setAttribute("uv",new Je(p,2)),b.setAttribute("faceIndex",new Je(d,1)),e.push(b),i>4&&i--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}(),Yu=Ju._lodPlanes,Qu=Ju._sizeLods,Zu=Ju._sigmas,Ku=null,$u=(1+Math.sqrt(5))/2,ec=1/$u,tc=[new b(1,1,1),new b(-1,1,1),new b(1,1,-1),new b(-1,1,-1),new b(0,$u,ec),new b(0,$u,-ec),new b(ec,0,$u),new b(-ec,0,$u),new b($u,ec,0),new b(-$u,ec,0)],nc=function(e){var t,n,i;this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=(t=20,n=new Float32Array(t),i=new b(0,1,0),new La({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i},inputEncoding:{value:Wu[3e3]},outputEncoding:{value:Wu[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)};function ic(e){return void 0!==e&&1009===e.type&&(3e3===e.encoding||3001===e.encoding||3007===e.encoding)}function rc(e){var t=new m(3*Vu,3*Vu,e);return t.texture.mapping=306,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function oc(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function ac(){return new La({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new a(1,1)},inputEncoding:{value:Wu[3e3]},outputEncoding:{value:Wu[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function sc(){return new La({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Wu[3e3]},outputEncoding:{value:Wu[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}nc.prototype.fromScene=function(e,t,n,i){void 0===t&&(t=0),void 0===n&&(n=.1),void 0===i&&(i=100),Ku=this._renderer.getRenderTarget();var r=this._allocateTargets();return this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r},nc.prototype.fromEquirectangular=function(e){return this._fromTexture(e)},nc.prototype.fromCubemap=function(e){return this._fromTexture(e)},nc.prototype.compileCubemapShader=function(){null===this._cubemapShader&&(this._cubemapShader=sc(),this._compileMaterial(this._cubemapShader))},nc.prototype.compileEquirectangularShader=function(){null===this._equirectShader&&(this._equirectShader=ac(),this._compileMaterial(this._equirectShader))},nc.prototype.dispose=function(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(var e=0;e<Yu.length;e++)Yu[e].dispose()},nc.prototype._cleanup=function(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Ku),e.scissorTest=!1,oc(e,0,0,e.width,e.height)},nc.prototype._fromTexture=function(e){Ku=this._renderer.getRenderTarget();var t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t},nc.prototype._allocateTargets=function(e){var t={magFilter:1003,minFilter:1003,generateMipmaps:!1,type:1009,format:1023,encoding:ic(e)?e.encoding:3002,depthBuffer:!1},n=rc(t);return n.depthBuffer=!e,this._pingPongRenderTarget=rc(t),n},nc.prototype._compileMaterial=function(e){var t=new Dt(Yu[0],e);this._renderer.compile(t,Xu)},nc.prototype._sceneToCubeUV=function(e,t,n,i){var r=new Wt(90,1,t,n),o=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],s=this._renderer,l=s.outputEncoding,u=s.toneMapping,c=s.getClearColor(),h=s.getClearAlpha();s.toneMapping=0,s.outputEncoding=3e3;var p=e.background;if(p&&p.isColor){p.convertSRGBToLinear();var d=Math.max(p.r,p.g,p.b),f=Math.min(Math.max(Math.ceil(Math.log2(d)),-128),127);p=p.multiplyScalar(Math.pow(2,-f));var m=(f+128)/255;s.setClearColor(p,m),e.background=null}for(var g=0;g<6;g++){var v=g%3;0==v?(r.up.set(0,o[g],0),r.lookAt(a[g],0,0)):1==v?(r.up.set(0,0,o[g]),r.lookAt(0,a[g],0)):(r.up.set(0,o[g],0),r.lookAt(0,0,a[g])),oc(i,v*Vu,g>2?Vu:0,Vu,Vu),s.setRenderTarget(i),s.render(e,r)}s.toneMapping=u,s.outputEncoding=l,s.setClearColor(c,h)},nc.prototype._textureToCubeUV=function(e,t){var n=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=sc()):null==this._equirectShader&&(this._equirectShader=ac());var i=e.isCubeTexture?this._cubemapShader:this._equirectShader,r=new Dt(Yu[0],i),o=i.uniforms;o.envMap.value=e,e.isCubeTexture||o.texelSize.value.set(1/e.image.width,1/e.image.height),o.inputEncoding.value=Wu[e.encoding],o.outputEncoding.value=Wu[t.texture.encoding],oc(t,0,0,3*Vu,2*Vu),n.setRenderTarget(t),n.render(r,Xu)},nc.prototype._applyPMREM=function(e){var t=this._renderer,n=t.autoClear;t.autoClear=!1;for(var i=1;i<Gu;i++){var r=Math.sqrt(Zu[i]*Zu[i]-Zu[i-1]*Zu[i-1]),o=tc[(i-1)%tc.length];this._blur(e,i-1,i,r,o)}t.autoClear=n},nc.prototype._blur=function(e,t,n,i,r){var o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,i,"latitudinal",r),this._halfBlur(o,e,n,n,i,"longitudinal",r)},nc.prototype._halfBlur=function(e,t,n,i,r,o,a){var s=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");var u=new Dt(Yu[i],l),c=l.uniforms,h=Qu[n]-1,p=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,d=r/p,f=isFinite(r)?1+Math.floor(3*d):20;f>20&&console.warn("sigmaRadians, "+r+", is too large and will clip, as it requested "+f+" samples when the maximum is set to 20");for(var m=[],g=0,v=0;v<20;++v){var y=v/d,b=Math.exp(-y*y/2);m.push(b),0==v?g+=b:v<f&&(g+=2*b)}for(var _=0;_<m.length;_++)m[_]=m[_]/g;c.envMap.value=e.texture,c.samples.value=f,c.weights.value=m,c.latitudinal.value="latitudinal"===o,a&&(c.poleAxis.value=a),c.dTheta.value=p,c.mipInt.value=8-n,c.inputEncoding.value=Wu[e.texture.encoding],c.outputEncoding.value=Wu[e.texture.encoding];var x=Qu[i];oc(t,3*Math.max(0,Vu-2*x),(0===i?0:2*Vu)+2*x*(i>4?i-8+4:0),3*x,2*x),s.setRenderTarget(t),s.render(u,Xu)};function lc(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),As.call(this,e),this.type="catmullrom",this.closed=!0}function uc(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),As.call(this,e),this.type="catmullrom"}function cc(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),As.call(this,e),this.type="catmullrom"}_s.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(_s.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(Hs.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new It,n=0,i=e.length;n<i;n++){var r=e[n];t.vertices.push(new b(r.x,r.y,r.z||0))}return t}}),Object.assign(zs.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),lc.prototype=Object.create(As.prototype),uc.prototype=Object.create(As.prototype),cc.prototype=Object.create(As.prototype),Object.assign(cc.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Tu.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},yu.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(hs.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),rl.extractUrlBase(e)}}),hs.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(ul.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(lu.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(E.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(I.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Kt.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},hu.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(o,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),o.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),o.ceilPowerOfTwo(e)}}),Object.assign(u.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(X.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new b).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,i,r,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,n,r,o)}}),we.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},v.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(W.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Oe.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Oe,{barycoordFromPoint:function(e,t,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Oe.getBarycoord(e,t,n,i,r)},normal:function(e,t,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Oe.getNormal(e,t,n,i)}}),Object.assign(Us.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new da(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ma(this,e)}}),Object.assign(a.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(b.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(d.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(It.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.assign(be.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(be.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(Dt.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(Dt.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Nr.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(qr.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Hr.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(_s.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),Wt.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Vs.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Je.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),Object.assign(Je.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:35044),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(dt.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new Je(arguments[1],arguments[2])))},addDrawCall:function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(dt.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(ol.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(e){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=e}}}),Object.defineProperties(nu.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=e}}}),Object.defineProperties(dr.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),35048===this.usage},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(dr.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:35044),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(fa.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.assign(pr.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties($l.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(qe.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new ze}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(Ha.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Na.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(e){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=e}}}),Object.defineProperties(qt.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(lr.prototype,{clearTarget:function(e,t,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,i)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(lr.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?3001:3e3}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Ki.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(m.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(kl.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new _l).load(e,(function(e){t.setBuffer(e)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),Il.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Xt.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var hc={merge:function(e,t,n){var i;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,t=t.geometry),e.merge(t,i,n)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};c.crossOrigin=void 0,c.loadTexture=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var r=new bs;r.setCrossOrigin(this.crossOrigin);var o=r.load(e,n,void 0,i);return t&&(o.mapping=t),o},c.loadTextureCube=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var r=new vs;r.setCrossOrigin(this.crossOrigin);var o=r.load(e,n,void 0,i);return t&&(o.mapping=t),o},c.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},c.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var pc={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"120"}})),e.ACESFilmicToneMapping=4,e.AddEquation=100,e.AddOperation=2,e.AdditiveAnimationBlendMode=2501,e.AdditiveBlending=2,e.AlphaFormat=1021,e.AlwaysDepth=1,e.AlwaysStencilFunc=519,e.AmbientLight=$s,e.AmbientLightProbe=El,e.AnimationClip=as,e.AnimationLoader=fs,e.AnimationMixer=Kl,e.AnimationObjectGroup=Ql,e.AnimationUtils=Xa,e.ArcCurve=Es,e.ArrayCamera=nr,e.ArrowHelper=zu,e.Audio=kl,e.AudioAnalyser=Il,e.AudioContext=bl,e.AudioListener=Dl,e.AudioLoader=_l,e.AxesHelper=Uu,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Uu(e)},e.BackSide=1,e.BasicDepthPacking=3200,e.BasicShadowMap=0,e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new ys(e)},e.Bone=Gr,e.BooleanKeyframeTrack=$a,e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Lu(e,t)},e.Box2=lu,e.Box3=E,e.Box3Helper=Iu,e.BoxBufferGeometry=Ht,e.BoxGeometry=Nt,e.BoxHelper=Lu,e.BufferAttribute=Je,e.BufferGeometry=dt,e.BufferGeometryLoader=sl,e.ByteType=1010,e.Cache=ls,e.Camera=Gt,e.CameraHelper=ku,e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.CanvasTexture=yo,e.CatmullRomCurve3=As,e.CineonToneMapping=3,e.CircleBufferGeometry=Oa,e.CircleGeometry=ja,e.ClampToEdgeWrapping=1001,e.Clock=Sl,e.ClosedSplineCurve3=lc,e.Color=ze,e.ColorKeyframeTrack=es,e.CompressedTexture=vo,e.CompressedTextureLoader=ms,e.ConeBufferGeometry=ka,e.ConeGeometry=Da,e.CubeCamera=Xt,e.CubeGeometry=Nt,e.CubeReflectionMapping=301,e.CubeRefractionMapping=302,e.CubeTexture=xn,e.CubeTextureLoader=vs,e.CubeUVReflectionMapping=306,e.CubeUVRefractionMapping=307,e.CubicBezierCurve=ks,e.CubicBezierCurve3=js,e.CubicInterpolant=Ya,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.CullFaceNone=0,e.Curve=_s,e.CurvePath=Hs,e.CustomBlending=5,e.CustomToneMapping=5,e.CylinderBufferGeometry=Pa,e.CylinderGeometry=Ra,e.Cylindrical=au,e.DataTexture=Yt,e.DataTexture2DArray=En,e.DataTexture3D=wn,e.DataTextureLoader=ys,e.DecrementStencilOp=7683,e.DecrementWrapStencilOp=34056,e.DefaultLoadingManager=cs,e.DepthFormat=1026,e.DepthStencilFormat=1027,e.DepthTexture=bo,e.DirectionalLight=Ks,e.DirectionalLightHelper=Ru,e.DiscreteInterpolant=Za,e.DodecahedronBufferGeometry=ko,e.DodecahedronGeometry=Do,e.DoubleSide=2,e.DstAlphaFactor=206,e.DstColorFactor=208,e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Je(e,t).setUsage(35048)},e.DynamicCopyUsage=35050,e.DynamicDrawUsage=35048,e.DynamicReadUsage=35049,e.EdgesGeometry=Aa,e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new ao(new Aa(e.geometry),new Zr({color:void 0!==t?t:16777215}))},e.EllipseCurve=xs,e.EqualDepth=4,e.EqualStencilFunc=514,e.EquirectangularReflectionMapping=303,e.EquirectangularRefractionMapping=304,e.Euler=te,e.EventDispatcher=t,e.ExtrudeBufferGeometry=fa,e.ExtrudeGeometry=da,e.Face3=Ue,e.Face4=function(e,t,n,i,r,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Ue(e,t,n,r,o,a)},e.FaceColors=1,e.FileLoader=ds,e.FlatShading=1,e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new nt(e,t)},e.Float32BufferAttribute=nt,e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new it(e,t)},e.Float64BufferAttribute=it,e.FloatType=1015,e.Fog=hr,e.FogExp2=cr,e.Font=gl,e.FontLoader=yl,e.FrontSide=0,e.Frustum=Kt,e.GLBufferAttribute=tu,e.GLSL1="100",e.GLSL3="300 es",e.GammaEncoding=3007,e.Geometry=It,e.GeometryUtils=hc,e.GreaterDepth=6,e.GreaterEqualDepth=5,e.GreaterEqualStencilFunc=518,e.GreaterStencilFunc=516,e.GridHelper=Tu,e.Group=ir,e.HalfFloatType=1016,e.HemisphereLight=qs,e.HemisphereLightHelper=wu,e.HemisphereLightProbe=xl,e.IcosahedronBufferGeometry=Po,e.IcosahedronGeometry=Ro,e.ImageBitmapLoader=fl,e.ImageLoader=gs,e.ImageUtils=c,e.ImmediateRenderObject=pu,e.IncrementStencilOp=7682,e.IncrementWrapStencilOp=34055,e.InstancedBufferAttribute=al,e.InstancedBufferGeometry=ol,e.InstancedInterleavedBuffer=eu,e.InstancedMesh=Qr,e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Ke(e,t)},e.Int16BufferAttribute=Ke,e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new et(e,t)},e.Int32BufferAttribute=et,e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Ye(e,t)},e.Int8BufferAttribute=Ye,e.IntType=1013,e.InterleavedBuffer=dr,e.InterleavedBufferAttribute=gr,e.Interpolant=Ja,e.InterpolateDiscrete=2300,e.InterpolateLinear=2301,e.InterpolateSmooth=2302,e.InvertStencilOp=5386,e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.KeepStencilOp=7680,e.KeyframeTrack=Ka,e.LOD=Nr,e.LatheBufferGeometry=Ta,e.LatheGeometry=wa,e.Layers=oe,e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},e.LessDepth=2,e.LessEqualDepth=3,e.LessEqualStencilFunc=515,e.LessStencilFunc=513,e.Light=Vs,e.LightProbe=nl,e.LightShadow=Gs,e.Line=io,e.Line3=hu,e.LineBasicMaterial=Zr,e.LineCurve=Os,e.LineCurve3=Fs,e.LineDashedMaterial=Ga,e.LineLoop=so,e.LinePieces=1,e.LineSegments=ao,e.LineStrip=0,e.LinearEncoding=3e3,e.LinearFilter=1006,e.LinearInterpolant=Qa,e.LinearMipMapLinearFilter=1008,e.LinearMipMapNearestFilter=1007,e.LinearMipmapLinearFilter=1008,e.LinearMipmapNearestFilter=1007,e.LinearToneMapping=1,e.Loader=hs,e.LoaderUtils=rl,e.LoadingManager=us,e.LogLuvEncoding=3003,e.LoopOnce=2200,e.LoopPingPong=2202,e.LoopRepeat=2201,e.LuminanceAlphaFormat=1025,e.LuminanceFormat=1024,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},e.Material=qe,e.MaterialLoader=il,e.Math=o,e.MathUtils=o,e.Matrix3=u,e.Matrix4=X,e.MaxEquation=104,e.Mesh=Dt,e.MeshBasicMaterial=Ge,e.MeshDepthMaterial=Qi,e.MeshDistanceMaterial=Zi,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MeshLambertMaterial=Va,e.MeshMatcapMaterial=qa,e.MeshNormalMaterial=Ua,e.MeshPhongMaterial=Ha,e.MeshPhysicalMaterial=Na,e.MeshStandardMaterial=Ia,e.MeshToonMaterial=za,e.MinEquation=103,e.MirroredRepeatWrapping=1002,e.MixOperation=1,e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.MultiplyBlending=4,e.MultiplyOperation=0,e.NearestFilter=1003,e.NearestMipMapLinearFilter=1005,e.NearestMipMapNearestFilter=1004,e.NearestMipmapLinearFilter=1005,e.NearestMipmapNearestFilter=1004,e.NeverDepth=0,e.NeverStencilFunc=512,e.NoBlending=0,e.NoColors=0,e.NoToneMapping=0,e.NormalAnimationBlendMode=2500,e.NormalBlending=1,e.NotEqualDepth=7,e.NotEqualStencilFunc=517,e.NumberKeyframeTrack=ts,e.Object3D=be,e.ObjectLoader=ul,e.ObjectSpaceNormalMap=1,e.OctahedronBufferGeometry=Ao,e.OctahedronGeometry=Co,e.OneFactor=201,e.OneMinusDstAlphaFactor=207,e.OneMinusDstColorFactor=209,e.OneMinusSrcAlphaFactor=205,e.OneMinusSrcColorFactor=203,e.OrthographicCamera=Qs,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.PMREMGenerator=nc,e.ParametricBufferGeometry=Eo,e.ParametricGeometry=xo,e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Pr(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new lo(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new fo(e,t)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new lo(e)},e.Path=zs,e.PerspectiveCamera=Wt,e.Plane=we,e.PlaneBufferGeometry=nn,e.PlaneGeometry=tn,e.PlaneHelper=Nu,e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new fo(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new lo(e)},e.PointLight=Ys,e.PointLightHelper=bu,e.Points=fo,e.PointsMaterial=lo,e.PolarGridHelper=Mu,e.PolyhedronBufferGeometry=To,e.PolyhedronGeometry=wo,e.PositionalAudio=Ll,e.PropertyBinding=Yl,e.PropertyMixer=Nl,e.QuadraticBezierCurve=Bs,e.QuadraticBezierCurve3=Ls,e.Quaternion=v,e.QuaternionKeyframeTrack=is,e.QuaternionLinearInterpolant=ns,e.REVISION="120",e.RGBADepthPacking=3201,e.RGBAFormat=1023,e.RGBAIntegerFormat=1033,e.RGBA_ASTC_10x10_Format=37819,e.RGBA_ASTC_10x5_Format=37816,e.RGBA_ASTC_10x6_Format=37817,e.RGBA_ASTC_10x8_Format=37818,e.RGBA_ASTC_12x10_Format=37820,e.RGBA_ASTC_12x12_Format=37821,e.RGBA_ASTC_4x4_Format=37808,e.RGBA_ASTC_5x4_Format=37809,e.RGBA_ASTC_5x5_Format=37810,e.RGBA_ASTC_6x5_Format=37811,e.RGBA_ASTC_6x6_Format=37812,e.RGBA_ASTC_8x5_Format=37813,e.RGBA_ASTC_8x6_Format=37814,e.RGBA_ASTC_8x8_Format=37815,e.RGBA_BPTC_Format=36492,e.RGBA_ETC2_EAC_Format=37496,e.RGBA_PVRTC_2BPPV1_Format=35843,e.RGBA_PVRTC_4BPPV1_Format=35842,e.RGBA_S3TC_DXT1_Format=33777,e.RGBA_S3TC_DXT3_Format=33778,e.RGBA_S3TC_DXT5_Format=33779,e.RGBDEncoding=3006,e.RGBEEncoding=3002,e.RGBEFormat=1023,e.RGBFormat=1022,e.RGBIntegerFormat=1032,e.RGBM16Encoding=3005,e.RGBM7Encoding=3004,e.RGB_ETC1_Format=36196,e.RGB_ETC2_Format=37492,e.RGB_PVRTC_2BPPV1_Format=35841,e.RGB_PVRTC_4BPPV1_Format=35840,e.RGB_S3TC_DXT1_Format=33776,e.RGFormat=1030,e.RGIntegerFormat=1031,e.RawShaderMaterial=La,e.Ray=W,e.Raycaster=nu,e.RectAreaLight=el,e.RedFormat=1028,e.RedIntegerFormat=1029,e.ReinhardToneMapping=2,e.RepeatWrapping=1e3,e.ReplaceStencilOp=7681,e.ReverseSubtractEquation=102,e.RingBufferGeometry=Ea,e.RingGeometry=xa,e.SRGB8_ALPHA8_ASTC_10x10_Format=37851,e.SRGB8_ALPHA8_ASTC_10x5_Format=37848,e.SRGB8_ALPHA8_ASTC_10x6_Format=37849,e.SRGB8_ALPHA8_ASTC_10x8_Format=37850,e.SRGB8_ALPHA8_ASTC_12x10_Format=37852,e.SRGB8_ALPHA8_ASTC_12x12_Format=37853,e.SRGB8_ALPHA8_ASTC_4x4_Format=37840,e.SRGB8_ALPHA8_ASTC_5x4_Format=37841,e.SRGB8_ALPHA8_ASTC_5x5_Format=37842,e.SRGB8_ALPHA8_ASTC_6x5_Format=37843,e.SRGB8_ALPHA8_ASTC_6x6_Format=37844,e.SRGB8_ALPHA8_ASTC_8x5_Format=37845,e.SRGB8_ALPHA8_ASTC_8x6_Format=37846,e.SRGB8_ALPHA8_ASTC_8x8_Format=37847,e.Scene=pr,e.SceneUtils=pc,e.ShaderChunk=rn,e.ShaderLib=an,e.ShaderMaterial=qt,e.ShadowMaterial=Ba,e.Shape=Us,e.ShapeBufferGeometry=Sa,e.ShapeGeometry=Ma,e.ShapePath=ml,e.ShapeUtils=ca,e.ShortType=1011,e.Skeleton=qr,e.SkeletonHelper=yu,e.SkinnedMesh=Hr,e.SmoothShading=2,e.Sphere=I,e.SphereBufferGeometry=_a,e.SphereGeometry=ba,e.Spherical=ou,e.SphericalHarmonics3=tl,e.Spline=cc,e.SplineCurve=Is,e.SplineCurve3=uc,e.SpotLight=Xs,e.SpotLightHelper=fu,e.Sprite=Pr,e.SpriteMaterial=vr,e.SrcAlphaFactor=204,e.SrcAlphaSaturateFactor=210,e.SrcColorFactor=202,e.StaticCopyUsage=35046,e.StaticDrawUsage=35044,e.StaticReadUsage=35045,e.StereoCamera=Ml,e.StreamCopyUsage=35042,e.StreamDrawUsage=35040,e.StreamReadUsage=35041,e.StringKeyframeTrack=rs,e.SubtractEquation=101,e.SubtractiveBlending=3,e.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},e.TangentSpaceNormalMap=0,e.TetrahedronBufferGeometry=So,e.TetrahedronGeometry=Mo,e.TextBufferGeometry=ya,e.TextGeometry=va,e.Texture=p,e.TextureLoader=bs,e.TorusBufferGeometry=Io,e.TorusGeometry=Lo,e.TorusKnotBufferGeometry=Bo,e.TorusKnotGeometry=Fo,e.Triangle=Oe,e.TriangleFanDrawMode=2,e.TriangleStripDrawMode=1,e.TrianglesDrawMode=0,e.TubeBufferGeometry=Oo,e.TubeGeometry=jo,e.UVMapping=300,e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new $e(e,t)},e.Uint16BufferAttribute=$e,e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new tt(e,t)},e.Uint32BufferAttribute=tt,e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Qe(e,t)},e.Uint8BufferAttribute=Qe,e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Ze(e,t)},e.Uint8ClampedBufferAttribute=Ze,e.Uniform=$l,e.UniformsLib=on,e.UniformsUtils=Vt,e.UnsignedByteType=1009,e.UnsignedInt248Type=1020,e.UnsignedIntType=1014,e.UnsignedShort4444Type=1017,e.UnsignedShort5551Type=1018,e.UnsignedShort565Type=1019,e.UnsignedShortType=1012,e.VSMShadowMap=3,e.Vector2=a,e.Vector3=b,e.Vector4=d,e.VectorKeyframeTrack=os,e.Vertex=function(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new b(e,t,n)},e.VertexColors=2,e.VideoTexture=go,e.WebGL1Renderer=ur,e.WebGLCubeRenderTarget=Jt,e.WebGLMultisampleRenderTarget=g,e.WebGLRenderTarget=m,e.WebGLRenderTargetCube=function(e,t,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Jt(e,n)},e.WebGLRenderer=lr,e.WebGLUtils=tr,e.WireframeGeometry=_o,e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new ao(new _o(e.geometry),new Zr({color:void 0!==t?t:16777215}))},e.WrapAroundEnding=2402,e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new ds(e)},e.ZeroCurvatureEnding=2400,e.ZeroFactor=200,e.ZeroSlopeEnding=2401,e.ZeroStencilOp=0,e.sRGBEncoding=3001,Object.defineProperty(e,"__esModule",{value:!0})})),THREE.CombinedCamera=function(e,t,n,i,r,o,a){THREE.Camera.call(this),this.fov=n,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,o,a),this.cameraP=new THREE.PerspectiveCamera(n,e/t,i,r),this.zoom=1,this.view=null,this.matrixTween=null,this.toPerspective()},THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype),THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.updateProjectionMatrix(),this.projectionMatrix.copy(this.cameraP.projectionMatrix),this.projectionMatrixInverse.copy(this.cameraP.projectionMatrixInverse),this.inPerspectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){this.fov;var e=this.cameraP.aspect,t=(this.cameraP.near,this.cameraP.far,this.orthoSize.z),n=this.orthoSize.depth,i=n*t*e/2,r=n*t/2;r/=this.zoom,i/=this.zoom,this.cameraO.left=-i,this.cameraO.right=i,this.cameraO.top=r,this.cameraO.bottom=-r,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix.copy(this.cameraO.projectionMatrix),this.projectionMatrixInverse.copy(this.cameraO.projectionMatrixInverse),this.inPerspectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?(this.cameraP.fov=this.fov,this.toPerspective()):this.toOrthographic()},THREE.CombinedCamera.prototype.setViewOffset=function(e,t,n,i,r,o){this.cameraP.setViewOffset(e,t,n,i,r,o),this.cameraO.setViewOffset(e,t,n,i,r,o),this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.clearViewOffset=function(){this.cameraP.clearViewOffset(),this.cameraO.clearViewOffset(),this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(e,t,n,i){void 0===t&&(t=24);var r=0;if(n){var o=parseInt("42EF",16);r=parseInt(i||"nahoanehc")&o}else r=2*THREE.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(r),r},THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.clone=function(){var e=new THREE.CombinedCamera;return e.copy(this),e.fov=this.fov,e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.cameraO=this.cameraO.clone(),e.cameraP=this.cameraP.clone(),e.zoom=this.zoom,e.view=this.view,e.matrixTween=this.matrixTween,e},THREE.CSS3DObject=function(e){THREE.Object3D.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",(function(){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)}))},THREE.CSS3DObject.prototype=Object.create(THREE.Object3D.prototype),THREE.CSS3DObject.prototype.constructor=THREE.CSS3DObject,THREE.CSS3DSprite=function(e){THREE.CSS3DObject.call(this,e)},THREE.CSS3DSprite.prototype=Object.create(THREE.CSS3DObject.prototype),THREE.CSS3DSprite.prototype.constructor=THREE.CSS3DSprite,THREE.CSS3DRenderer=function(e){var t,n,i,r,o=(e=e||{}).autoFixCamera,a=new THREE.Matrix4,s=new THREE.Matrix4,l=new THREE.Matrix4,u={camera:{fov:0,style:""},objects:{}},c=document.createElement("div");c.style.overflow="hidden",this.domElement=c;var h=document.createElement("div");h.style.WebkitTransformStyle="preserve-3d",h.style.MozTransformStyle="preserve-3d",h.style.transformStyle="preserve-3d",c.appendChild(h);var p=/Trident/i.test(navigator.userAgent);function d(e){return Math.abs(e)<1e-10?0:e}function f(e){var t=e.elements;return"matrix3d("+d(t[0])+","+d(-t[1])+","+d(t[2])+","+d(t[3])+","+d(t[4])+","+d(-t[5])+","+d(t[6])+","+d(t[7])+","+d(t[8])+","+d(-t[9])+","+d(t[10])+","+d(t[11])+","+d(t[12])+","+d(-t[13])+","+d(t[14])+","+d(t[15])+")"}function m(e,t){var n=e.elements,o="matrix3d("+d(n[0])+","+d(n[1])+","+d(n[2])+","+d(n[3])+","+d(-n[4])+","+d(-n[5])+","+d(-n[6])+","+d(-n[7])+","+d(n[8])+","+d(n[9])+","+d(n[10])+","+d(n[11])+","+d(n[12])+","+d(n[13])+","+d(n[14])+","+d(n[15])+")";return p?"translate(-50%,-50%)translate("+i+"px,"+r+"px)"+t+o:"translate(-50%,-50%)"+o}function g(e,t){s.copy(e),s.premultiply(t.matrixWorldInverse);var n=(e=s).elements,o="matrix3d("+d(n[0])+","+d(n[1])+","+d(n[2])+","+d(n[3])+","+d(-n[4])+","+d(-n[5])+","+d(-n[6])+","+d(-n[7])+","+d(n[8])+","+d(n[9])+","+d(n[10])+","+d(n[11])+","+d(n[12])+","+d(n[13])+","+d(n[14])+","+d(n[15])+")";return p?"translate(-50%,-50%)translate("+i+"px,"+r+"px)"+cameraCSSMatrix+o:"translate(-50%,-50%)"+o}this.setClearColor=function(){},this.getSize=function(){return{width:t,height:n}},this.setSize=function(e,o){i=(t=e)/2,r=(n=o)/2,c.style.width=e+"px",c.style.height=o+"px",h.style.width=e+"px",h.style.height=o+"px"};var v,y,b=(v=new THREE.Vector3,y=new THREE.Vector3,function(e,t){return v.setFromMatrixPosition(e.matrixWorld),y.setFromMatrixPosition(t.matrixWorld),v.distanceToSquared(y)});this.render=function(e,t){var s;s=t.isOrthoLerping||t.isOrthographicCamera?.5/Math.tan(THREE.Math.degToRad(.5*t.getEffectiveFOV()))*n:t.projectionMatrix.elements[5]*r,u.camera.fov!==s&&(c.style.WebkitPerspective=s+"px",c.style.MozPerspective=s+"px",c.style.perspective=s+"px",u.camera.fov=s),e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld();var d="translateZ("+s+"px)";!t.isPerspectiveLerping&&t.isOrthographicCamera&&(d+="scale("+t.zoom+")");var v=(d+=f(o?l:t.matrixWorldInverse))+"translate("+i+"px,"+r+"px)";u.camera.style===v||p||(h.style.WebkitTransform=v,h.style.MozTransform=v,h.style.transform=v,u.camera.style=v),function e(t,n,i){if(t instanceof THREE.CSS3DObject){var r;t instanceof THREE.CSS3DSprite?(a.copy(n.matrixWorldInverse),a.transpose(),a.copyPosition(t.matrixWorld),a.scale(t.scale),a.elements[3]=0,a.elements[7]=0,a.elements[11]=0,a.elements[15]=1,r=o?g(a,n):m(a,i)):r=o?g(t.matrixWorld,n):m(t.matrixWorld,i);var s=t.element,l=u.objects[t.id]&&u.objects[t.id].style;void 0!==l&&l===r||(s.style.WebkitTransform=r,s.style.MozTransform=r,s.style.transform=r,u.objects[t.id]={style:r},p&&(u.objects[t.id].distanceToCameraSquared=b(n,t))),s.parentNode!==h&&h.appendChild(s)}for(var c=0,d=t.children.length;c<d;c++)e(t.children[c],n,i)}(e,t,d),p&&function(e){var t=Object.keys(u.objects).sort((function(e,t){return u.objects[e].distanceToCameraSquared-u.objects[t].distanceToCameraSquared})),n=t.length;e.traverse((function(e){var i=t.indexOf(e.id+"");-1!==i&&(e.element.style.zIndex=n-i)}))}(e)}},THREE.DeviceOrientationControls=function(e){var t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var n,i,r,o,a=function(e){t.deviceOrientation=e},s=function(){t.screenOrientation=window.orientation||0},l=(n=new THREE.Vector3(0,0,1),i=new THREE.Euler,r=new THREE.Quaternion,o=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,t,a,s,l){i.set(a,t,-s,"YXZ"),e.setFromEuler(i),e.multiply(o),e.multiply(r.setFromAxisAngle(n,-l))});this.connect=function(){s(),window.addEventListener("orientationchange",s,!1),window.addEventListener("deviceorientation",a,!1),t.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",s,!1),window.removeEventListener("deviceorientation",a,!1),t.enabled=!1},this.update=function(){if(!1!==t.enabled){var e=t.deviceOrientation;if(e){var n=e.alpha?THREE.Math.degToRad(e.alpha)+t.alphaOffset:0,i=e.beta?THREE.Math.degToRad(e.beta):0,r=e.gamma?THREE.Math.degToRad(e.gamma):0,o=t.screenOrientation?THREE.Math.degToRad(t.screenOrientation):0;l(t.object.quaternion,n,i,r,o)}}},this.dispose=function(){t.disconnect()},this.connect()},THREE.EarthOrbitControls=function(e,t){var n;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.isEarth=!0,this.target=new THREE.Vector3,this.target.set=function(e,t,n){if(i.targetLimitData){let r=THING.Math.world2Lonlat([e,t,n]);if(r&&r.length>1){const o=i.targetLimitData.min,a=i.targetLimitData.max;r[0]<o[0]?r[0]=o[0]:r[0]>a[0]&&(r[0]=a[0]),r[1]<o[1]?r[1]=o[1]:r[1]>a[1]&&(r[1]=a[1]);const s=THING.Math.lonlat2World(r);e=s[0],t=s[1],n=s[2]}}return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this},this._leftInteractive=!0,this._keepTarget=!1,this.minDistance=500,this.maxDistance=11079114.2,this.minZoom=0,this.maxZoom=1/0,this.maxPitchAngle=87,this._minPolarAngle=0,this._maxPolarAngle=THING.Math.degToRad(this.maxPitchAngle),this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.88,this.dampingZoomFactor=.5,this.enableZoom=!0,this.zoomSpeed=1,this.zoomFactor=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.mousePanSpeed=1,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.standardRadius=10216133.731679259,this.targetMaxOffset=6e7,this.panStander=this.maxDistance-6378e3,this.isDispatchEvent=!0,this.enableZoomOnTarget=!0,this.options={},this._isCameraStatic=!0,this.setOptions=function(e){this.options=e,this.mouseButtons={ORBIT:this._parseToThreeMouseKey(e.moveKey),ZOOM:this._parseToThreeMouseKey(e.zoomKey),PAN:this._parseToThreeMouseKey(e.rotationKey)},this.enableZoomOnTarget=e.enableZoomOnTarget},this._parseToThreeMouseKey=function(e){var t;switch(e){case"left":t=THREE.MOUSE.LEFT;break;case"right":t=THREE.MOUSE.RIGHT;break;case"middle":t=THREE.MOUSE.MIDDLE}return t},this._parseToThingMouseKey=function(e){var t;switch(e){case THREE.MOUSE.LEFT:t="left";break;case THREE.MOUSE.RIGHT:t="right";break;case THREE.MOUSE.MIDDLE:t="middle"}return t},this.getOptions=function(e){return this.options.rotationKey=this._parseToThingMouseKey(this.mouseButtons.PAN),this.options.zoomKey=this._parseToThingMouseKey(this.mouseButtons.ZOOM),this.options.moveKey=this._parseToThingMouseKey(this.mouseButtons.ORBIT),this.options.enableZoomOnTarget=this.enableZoomOnTarget,this.options},this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.getRotationSpherePhi=function(){return h.phi},this.getSphericalRadius=function(){return c.radius},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(o),i.update(),u=l.NONE},this.goHome=function(){C=!0,i.object.up.set(0,1,0),i.object.position.set(4890109.86328125,9295980.46875,13943610.3515625),c.radius,h.phi=-.01,h.theta=Math.PI/2,h.radius=c.radius-6378e3,i._isCameraStatic=!1,i.update(),i._isCameraStatic=!0},this.setState=function(e){if(i.enabled){var t=i._getIntersectPoint();i.target.copy(t);var n=i.target,r=i.object.position,o=(new THREE.Vector3).subVectors(n,r),a=(new THREE.Vector3).crossVectors(r,o),s=(new THREE.Vector3).crossVectors(o,a);s=s.normalize(),i.object.up.copy(s),i.object.lookAt(n.x,n.y,n.z)}},this.correctUp=function(e){var t=e.time||3e3,n=e.callback,r=i.target,o=i.object.position,a=new THREE.Vector3;a.copy(i.object.up),a.normalize();var s=new THREE.Vector3;s.copy(o),s.normalize();var l=null;requestAnimationFrame((function e(o){l||(l=o);var u=o-l,c=a.lerp(s,u/t);i.object.up=c,i.object.lookAt(r),u/t<1?requestAnimationFrame(e):(n&&n(),console.log("end-correct"))}))},this._getIntersectPoint=function(e){if(void 0===e&&(e=!0),this._isCameraStatic||0===this._getState()||2===this._getState()||this._keepTarget)return this.target;var t=new THREE.Vector3,n=[];if(this.object.getWorldDirection(t),t.normalize(),k._camera=this.object,k.set(this.object.position,t),D.set(this.object.position,t),e){var i=t3djs.buffer.nodeBuffer.get("tiles-root");if(i&&i.ensureVisible()&&(n=k.intersectObjects(i.children,!0)),n.length>0)return n[0].point}var r=new THREE.Vector3;return D.intersectSphere(j,r),r.equals(new THREE.Vector3(0,0,0))?this.target:r},this._getIntersectPointByMouse=function(e,t){var n=[];if(i.isEarth){var r=new THREE.Vector3;this.object.getWorldDirection(r),r.normalize(),D.set(this.object.position,r),k.setFromCamera(new THREE.Vector2(e,t),this.object);var o=t3djs.buffer.nodeBuffer.get("tiles-root");o&&o.ensureVisible()&&(n=k.intersectObjects(o.children,!0));var a=new THREE.Vector3;return D.intersectSphere(j,a),n.length>0?n[0].point:this._getIntersectPoint()}{let e=window.innerWidth*(H.x+1)/2,t=(1-H.y)*window.innerHeight/2,n=this.app.camera.screenToWorld(e,t);return new THREE.Vector3(n[0],n[1],n[2])}},this._getIntersectQuaternion=function(e,t){(new THREE.Vector3).copy(e);var n=new THREE.Vector3;n.copy(e),n.normalize();var i=new THREE.Quaternion;i.setFromUnitVectors(new THREE.Vector3(0,1,0),n);var r=new THREE.Quaternion;return r.setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2+t),i.multiply(r),i.normalize(),i},this._correctCube=function(){var e=this._getIntersectPoint();B.position.copy(e),d.setFromVector3(e),d.radius=6378e3;var t=this._getIntersectQuaternion(e,d.theta);B.rotation.set(0,0,0),B.applyQuaternion(t),B.updateMatrixWorld(!0)},this._correctSphericalRotation=function(e){var t=new THREE.Vector3;if(t.copy(e),B.worldToLocal(t),h.setFromVector3(t),0!=i.target.length()){var n=i.object.position.distanceTo(this._getIntersectPoint());h.radius=n}h.phi=-h.phi,h.theta=Math.PI+h.theta,!1},this._getAngle=function(){if(0!=i.target.length()){var e=new THREE.Vector3;e.copy(i.target),e.normalize();var t=new THREE.Vector3(0,6378e3,0);t.sub(this.object.position),t.normalize();var n=new THREE.Vector3;this.object.getWorldDirection(n),n.projectOnPlane(e),t.projectOnPlane(e);var r=t.angleTo(n);return n.cross(t),n.sub(e),n.length()<=1&&(r*=-1),r}},this.setTargetLimit=function(e){if(e){const t=e.min,n=e.max;t&&n&&t.length>1&&n.length>1&&(this.targetLimitData={min:[t[0],t[1]],max:[n[0],n[1]]})}else this.targetLimitData=void 0},this.autoFixTarget=function(e){if(!L&&i.app&&(i.app.scene.add(B),B.visible=!1,L=!0,!0),C){if(i.dispatchEvent(o),i.enableDamping||(C=!1),N.multiply(I),i.targetLimitData){const e=i.target.clone().applyQuaternion(N),t=i.targetLimitData.min,n=i.targetLimitData.max;let r=THING.Math.world2Lonlat(e.toArray());if(r[0]<t[0]||r[0]>n[0]||r[1]<t[1]||r[1]>n[1])return}if(e.applyQuaternion(N),i.object.updateMatrixWorld(!0),0!=i.target.length()){(n=new THREE.Vector3).copy(e),n.normalize(),i.object.up.copy(n),i.target.applyQuaternion(N)}else{var t=this._getIntersectPoint();t.y+=100,i.target.copy(t)}i.object.lookAt(i.target)}else if(A){i.dispatchEvent(o),A=!1;var n,r=this._getIntersectPoint();(n=new THREE.Vector3).copy(B.position),n.normalize();var a=new THREE.Vector3;a.setFromSpherical(h),a.applyMatrix4(B.matrixWorld),i.object.up.copy(n),i.object.position.copy(a),i.target.copy(r),i.object.lookAt(i.target)}else if(R||P){i.dispatchEvent(o);var s=i.object.position.distanceTo(this._getIntersectPoint());if(s>i.maxDistance&&P||s<i.minDistance&&R)h.radius=s,f=1;else{var l;l=R&&this.enableZoomOnTarget?this._getIntersectPointByMouse(H.x,H.y):this._getIntersectPointByMouse(0,0);var u=new THREE.Vector3;u.copy(i.object.position),u.sub(l),u.normalize();var p=c.radius*f-c.radius;h.radius+=p;var d=new THREE.Vector3;d.setFromSpherical(h),u.multiplyScalar(p),i.object.position.add(u),this._correctCube(),d.applyMatrix4(B.matrixWorld),i.object.position.copy(d),i.object.up.copy(i.object.position),i.target.copy(B.position),i.object.lookAt(i.target)}i.enableDamping||(R=!1,P=!1)}},this.addEventListener("start",(function(){i._isCameraStatic=!1})),this.addEventListener("end",(function(){i._isCameraStatic=!0})),this.update=(n=new THREE.Vector3,function(){var e=i.object.position;n.copy(e),c.setFromVector3(n),d.setFromVector3(i.target),d.radius=6378e3,i.enabled&&this.autoFixTarget(e),i.object.lookAt(i.target),this._correctCube(),this._correctSphericalRotation(e);var t=i.object.position.distanceTo(this._getIntersectPoint());return i.rotateSpeed=t/3e7,i.zoomSpeed=h.radius/4e6*this.zoomFactor,i.mousePanSpeed=1,!0===i.enableDamping?C?(p.x*=1-i.dampingFactor,p.y*=1-i.dampingFactor,U(p.x),V(p.y),(A||R||P||p.x>-1e-10&&p.x<1e-10||p.y>-1e-10&&p.y<1e-10)&&(C=!1,p.set(0,0))):R?(f+=(1-f)*i.dampingZoomFactor)>.99999999&&(f=1,R=!1):P&&(f-=(f-1)*i.dampingZoomFactor)<1.0000001&&(f=1,P=!1):(p.set(0,0),f=1,C=!1,A=!1),m.set(0,0,0),!1}),this.dispose=function(){i.domElement.removeEventListener("contextmenu",ae,!1),i.domElement.removeEventListener("mousedown",Z,!1),i.domElement.removeEventListener("wheel",te,!1),i.domElement.removeEventListener("touchstart",ie,!1),i.domElement.removeEventListener("touchend",oe,!1),i.domElement.removeEventListener("touchmove",re,!1),document.removeEventListener("mousemove",K,!1),document.removeEventListener("mouseup",$,!1),window.removeEventListener("keydown",ne,!1)};var i=this,r={type:"wheel"},o={type:"change"},a={type:"start"},s={type:"end"},l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},u=l.NONE;i._getState=function(){return u};var c=new THREE.Spherical,h=new THREE.Spherical;h.theta=Math.PI/2,h.phi=-.01,h.radius=this.panStander;var p=new THREE.Vector2,d=(new THREE.Spherical,new THREE.Spherical);d.radius=6378e3;new THREE.Spherical,new THREE.Cylindrical,new THREE.Cylindrical;var f=1,m=new THREE.Vector3,g=new THREE.Vector2,v=new THREE.Vector2,y=new THREE.Vector2,b=new THREE.Vector2,_=new THREE.Vector2,x=new THREE.Vector2,E=new THREE.Vector2,w=new THREE.Vector2,T=new THREE.Vector2,M=new THREE.Vector2,S=new THREE.Vector2,C=(new THREE.Vector3,new THREE.Vector3,!1),A=!1,R=!1,P=!1,D=new THREE.Ray,k=new THREE.Raycaster,j=new THREE.Sphere(new THREE.Vector3(0,0,0),6378e3),O=new THREE.BoxGeometry(1e3,1e3,1e3),F=new THREE.MeshBasicMaterial({color:65280}),B=new THREE.Mesh(O,F),L=!1,I=new THREE.Quaternion,N=new THREE.Quaternion,H={};function z(){return Math.pow(.95,i.zoomSpeed)}function U(e){var t=new THREE.Vector3(0,6378e4,0);t.unproject(i.object),t.normalize(),p.x=e,e*=1-Math.sin(h.phi),N.setFromAxisAngle(t,-e)}function V(e){var t=new THREE.Vector3(6378e3,0,0);t.unproject(i.object),t.normalize(),p.y=e,I.setFromAxisAngle(t,-e)}var q=function(e){h.phi>-.001||(h.theta-=e,h.theta>2*Math.PI&&(h.theta=h.theta-2*Math.PI),h.theta<0&&(h.theta=2*Math.PI+h.theta))},G=function(e){A=!0,h.phi+=e,h.phi>=-.01&&(h.phi=-.01),h.phi<-i.maxPolarAngle&&(h.phi=-i.maxPolarAngle),h.phi>-i.minPolarAngle&&(h.phi=-i.minPolarAngle)},W=function(e,t){var n=i.domElement===document?i.domElement.body:i.domElement;i.object.isPerspectiveCamera?(q(2*Math.PI*e/n.clientWidth*i.mousePanSpeed),G(2*Math.PI*t/n.clientHeight*i.mousePanSpeed)):i.object.isOrthographicCamera?(q(e*(i.object.right-i.object.left)/i.object.zoom/n.clientWidth,i.object.matrix),G(t*(i.object.top-i.object.bottom)/i.object.zoom/n.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)};function X(e){P=!0,i.object.isPerspectiveCamera?f/=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*e)),i.object.updateProjectionMatrix(),!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function J(e){R=!0,i.object.isPerspectiveCamera?f*=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/e)),i.object.updateProjectionMatrix(),!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function Y(e){b.set(e.touches[0].pageX,e.touches[0].pageY)}function Q(e){_.set(e.touches[0].pageX,e.touches[0].pageY),x.subVectors(_,b),W(x.x,x.y),b.copy(_),i.update()}function Z(e){if(!1!==i.enabled){switch(e.preventDefault(),e.button){case i.mouseButtons.ORBIT:if(!1===i.enableRotate)return;!function(e){g.set(e.clientX,e.clientY)}(e),u=l.ROTATE;break;case i.mouseButtons.ZOOM:if(!1===i.enableZoom)return;!function(e){E.set(e.clientX,e.clientY)}(e),u=l.DOLLY;break;case i.mouseButtons.PAN:if(!1===i.enablePan)return;!function(e){b.set(e.clientX,e.clientY)}(e),u=l.PAN}u!==l.NONE&&(document.addEventListener("mousemove",K,!1),document.addEventListener("mouseup",$,!1),i.dispatchEvent(a))}}function K(e){if(!1!==i.enabled)switch(e.preventDefault(),u){case l.ROTATE:if(!1===i.enableRotate)return;!function(e){C=!0,v.set(e.clientX,e.clientY),y.subVectors(v,g);var t=i.domElement===document?i.domElement.body:i.domElement;U(2*Math.PI*y.x/t.clientWidth*i.rotateSpeed),V(2*Math.PI*y.y/t.clientHeight*i.rotateSpeed),g.copy(v),i.update()}(e);break;case l.DOLLY:if(!1===i.enableZoom)return;!function(e){w.set(e.clientX,e.clientY),T.subVectors(w,E),T.y>0?X(z()):T.y<0&&J(z()),E.copy(w),i.update()}(e);break;case l.PAN:if(!1===i.enablePan)return;!function(e){_.set(e.clientX,e.clientY),x.subVectors(_,b),W(x.x,x.y),b.copy(_),i.update()}(e)}}function $(e){if(!1===i.enabled)return document.removeEventListener("mousemove",K,!1),void document.removeEventListener("mouseup",$,!1);document.removeEventListener("mousemove",K,!1),document.removeEventListener("mouseup",$,!1),i.dispatchEvent(s),u=l.NONE}i.rotate=function(e,t){switch(t=(t=t||1e3)/180*Math.PI,e){case"up":this.pan(0,t);break;case"down":this.pan(0,-t);break;case"left":this.pan(t,0);break;case"right":this.pan(-t,0)}},i.move=function(e,t){e=e/180*Math.PI,e*=this.rotateSpeed,t=t/180*Math.PI,t*=this.rotateSpeed,N.set(0,0,0,1),I.set(0,0,0,1),C=!0,U(e),V(t)},i.zoom=function(e,t){switch(t=t||.95,t=Math.pow(t,i.zoomSpeed),e){case"in":J(t);break;case"out":X(t)}},i.earthRotate=function(e,t){switch(t=(t=t||10)/180*Math.PI,t*=this.rotateSpeed,N.set(0,0,0,1),I.set(0,0,0,1),C=!0,e){case"right":U(-t);break;case"left":U(t);break;case"up":V(t);break;case"down":V(-t)}};let ee=function(){let e,t=!1;return function(){t=!0,e&&t&&clearTimeout(e),e=setTimeout((function(){i.dispatchEvent(s),t=!1}),300)}}();function te(e){!1===i.enabled||!1===i.enableZoom||u!==l.NONE&&u!==l.ROTATE||(e.preventDefault(),e.stopPropagation(),i.dispatchEvent(a),function(e){H.x=e.clientX/window.innerWidth*2-1,H.y=-e.clientY/window.innerHeight*2+1,e.deltaY<0?(J(z()),i.dispatchEvent(r)):e.deltaY>0&&(X(z()),i.dispatchEvent(r)),i.update()}(e),ee())}function ne(e){!1!==i.enabled&&!1!==i.enableKeys&&!1!==i.enablePan&&function(e){switch(e.keyCode){case i.keys.UP:W(0,i.keyPanSpeed),i.update();break;case i.keys.BOTTOM:W(0,-i.keyPanSpeed),i.update();break;case i.keys.LEFT:W(i.keyPanSpeed,0),i.update();break;case i.keys.RIGHT:W(-i.keyPanSpeed,0),i.update()}}(e)}function ie(e){if(!1!==i.enabled){switch(e.touches.length){case 1:if(!1===i.enableRotate)return;!function(e){g.set(e.touches[0].pageX,e.touches[0].pageY)}(e),u=l.TOUCH_ROTATE;break;case 3:if(!1===i.enableZoom)return;Y(e),u=l.TOUCH_PAN;break;case 2:if(M.set(e.touches[0].pageX,e.touches[0].pageY),S.set(e.touches[1].pageX,e.touches[1].pageY),!1===i.enablePan)return;Y(e),function(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);E.set(0,i)}(e),u=l.TOUCH_PAN;break;default:u=l.NONE}u!==l.NONE&&i.dispatchEvent(a)}}function re(e){if(!1!==i.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===i.enableRotate)return;if(u!==l.TOUCH_ROTATE)return;!function(e){C=!0,v.set(e.touches[0].pageX,e.touches[0].pageY),y.subVectors(v,g);var t=i.domElement===document?i.domElement.body:i.domElement;U(2*Math.PI*y.x/t.clientWidth*i.rotateSpeed),V(2*Math.PI*y.y/t.clientHeight*i.rotateSpeed),g.copy(v),i.update()}(e);break;case 3:if(!1===i.enableZoom)return;if(u!==l.TOUCH_PAN)return;Q(e);break;case 2:var t=new THREE.Vector2(e.touches[0].pageX,e.touches[0].pageY),n=new THREE.Vector2(e.touches[1].pageX,e.touches[1].pageY),r=t.sub(M).normalize(),o=n.sub(S).normalize();if(r.dot(o)>0){if(u=l.TOUCH_PAN,!1===i.enablePan)return;Q(e)}else{if(u=l.TOUCH_DOLLY,!1===i.enableZoom)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);w.set(0,r),T.subVectors(w,E),T.y>0?J(z()):T.y<0&&X(z()),E.copy(w),i.update()}(e)}break;default:u=l.NONE}}function oe(e){!1!==i.enabled&&(i.dispatchEvent(s),u=l.NONE)}function ae(e){!1!==i.enabled&&e.preventDefault()}i.domElement.addEventListener("contextmenu",ae,!1),i.domElement.addEventListener("mousedown",Z,!1),i.domElement.addEventListener("wheel",te,!1),i.domElement.addEventListener("touchstart",ie,!1),i.domElement.addEventListener("touchend",oe,!1),i.domElement.addEventListener("touchmove",re,!1),window.addEventListener("keydown",ne,!1),i.setLeftInteractive=function(e){i.mouseButtons=e?{ORBIT:0,ZOOM:1,PAN:2}:{ORBIT:2,ZOOM:1,PAN:0},i._leftInteractive=e},this.update(),i.pan=W,i.panDelta=x},THREE.EarthOrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.EarthOrbitControls.prototype.constructor=THREE.EarthOrbitControls,Object.defineProperties(THREE.EarthOrbitControls.prototype,{leftInteractive:{get:function(){return this._leftInteractive},set:function(e){this.setLeftInteractive(e)}},center:{get:function(){return console.warn("THREE.EarthOrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.EarthOrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.EarthOrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.EarthOrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.EarthOrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.EarthOrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.EarthOrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.EarthOrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.EarthOrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.EarthOrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.EarthOrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.EarthOrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.EarthOrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}},minPolarAngle:{get:function(){return this._minPolarAngle},set:function(e){this._minPolarAngle=e}},maxPolarAngle:{get:function(){return this._maxPolarAngle},set:function(e){this._maxPolarAngle=e<this.maxPitchAngle*Math.PI/180?e:this.maxPitchAngle*Math.PI/180}}}),THREE.EarthOrbitControls.prototype.setLookAt=function(e){this.object.lookAt(new THREE.Vector3(e[0],e[1],e[2]))},THREE.FreeControls=function(e){this.object=e,this.object.rotation.setRotationOrder("YXZ"),this.movementSpeed=.25,this.rotateSpeed=.25,this.enableMovementDamping=!0,this.movementDampingFactor=.25,this.enableRotateDamping=!0,this.rotateDampingFactor=.25,this.enableFly=!0,this.enableKeyRotate=!1,this.getMoveDirection=function(e){e=e||new THREE.Vector3;var i=t.set(1,0,0).applyQuaternion(this.object.quaternion);return this.enableFly?(t.set(1,0,0).applyQuaternion(this.object.quaternion).multiplyScalar(c.x),e.add(t),t.set(0,1,0).applyQuaternion(this.object.quaternion).multiplyScalar(c.y),e.add(t),t.set(0,0,1).applyQuaternion(this.object.quaternion).multiplyScalar(c.z),e.add(t)):(n.copy(i).multiplyScalar(c.x),e.add(n),n.copy(i).cross(this.object.up).normalize().multiplyScalar(c.z),e.add(n)),e},this.update=function(e){var d=(e=e||.0166)*this.movementSpeed/.0166*(1===h.run?2:1);c.add(l),u.add(s);var f=t.set(1,0,0).applyQuaternion(this.object.quaternion).normalize();return this.enableFly?(t.set(1,0,0).applyQuaternion(this.object.quaternion).multiplyScalar(c.x*d),this.object.position.add(t),t.set(0,1,0).applyQuaternion(this.object.quaternion).multiplyScalar(c.y*d),this.object.position.add(t),t.set(0,0,1).applyQuaternion(this.object.quaternion).multiplyScalar(c.z*d),this.object.position.add(t)):(n.copy(f).multiplyScalar(c.x*d),this.object.position.add(n),n.copy(f).cross(this.object.up).normalize().multiplyScalar(c.z*d),this.object.position.add(n)),this.object.up.equals(p)?(this.object.rotation.x+=e*u.x/.0166,this.object.rotation.y+=e*u.y/.0166,this.object.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,this.object.rotation.x))):(i.setFromAxisAngle(this.object.up,e*u.y/.0166),this.object.quaternion.premultiply(i),f=t.set(1,0,0).applyQuaternion(this.object.quaternion).normalize(),i.setFromAxisAngle(f,e*u.x/.0166),this.object.quaternion.premultiply(i)),this.enableMovementDamping?c.multiplyScalar(1-this.movementDampingFactor):c.set(0,0,0),this.enableRotateDamping?u.multiplyScalar(1-this.rotateDampingFactor):u.set(0,0),this.enableKeyRotate||s.set(0,0),(r.distanceToSquared(this.object.position)>a||8*(1-o.dot(this.object.quaternion))>a)&&(r.copy(this.object.position),o.copy(this.object.quaternion),!0)};var t=new THREE.Vector3,n=new THREE.Vector3,i=new THREE.Quaternion,r=new THREE.Vector3,o=new THREE.Quaternion,a=1e-6,s=new THREE.Vector2,l=new THREE.Vector3,u=new THREE.Vector2,c=new THREE.Vector3,h={up:0,down:0,left:0,right:0,forward:0,back:0,run:0},p=(new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0)),d=this;this.updateMovementVector=function(){d.enableKeyRotate?s.y=-2*Math.PI*.005*(-h.left+h.right)*d.rotateSpeed:l.x=-h.left+h.right,l.y=-h.down+h.up,l.z=-h.forward+h.back},this.rotateDelta=s,this.moveDelta=l,this.moveState=h},THREE.FreeMouseControls=function(e,t){THREE.FreeControls.call(this,e),this.domElement=void 0!==t?t:document,t&&this.domElement.setAttribute("tabindex",-1);var n=new THREE.Vector2,i=new THREE.Vector2,r=this.rotateDelta,o=(this.moveDelta,0),a=this.moveState,s=this;function l(){var e=s.domElement===document?s.domElement.body:s.domElement,t=r.x,n=r.y;r.x=2*Math.PI*n/e.clientHeight,r.y=2*Math.PI*t/e.clientWidth}var u=this.updateMovementVector;function c(e){n.set(e.clientX,e.clientY),o=1}function h(e){0!=o&&(s.enableKeyRotate||(i.set(e.clientX,e.clientY),r.subVectors(i,n).multiplyScalar(-s.rotateSpeed),l(),n.copy(i)))}function p(e){o=0,r.set(0,0)}function d(e){switch(e.keyCode){case 87:a.forward=1;break;case 83:a.back=1;break;case 65:a.left=1;break;case 68:a.right=1;break;case 82:a.up=1;break;case 70:a.down=1;break;case 69:a.up=1;break;case 81:a.down=1;break;case 16:a.run=1}u()}function f(e){switch(e.keyCode){case 87:a.forward=0;break;case 83:a.back=0;break;case 65:a.left=0;break;case 68:a.right=0;break;case 82:a.up=0;break;case 70:a.down=0;break;case 69:a.up=0;break;case 81:a.down=0;break;case 16:a.run=0}u()}this.domElement.addEventListener("mousemove",h,!1),this.domElement.addEventListener("mousedown",c,!1),this.domElement.addEventListener("mouseup",p,!1),window.addEventListener("keydown",d,!1),window.addEventListener("keyup",f,!1),u(),l(),this.dispose=function(){this.object.rotation.setRotationOrder("XYZ"),this.domElement.removeEventListener("mousemove",h,!1),this.domElement.removeEventListener("mousedown",c,!1),this.domElement.removeEventListener("mouseup",p,!1),window.removeEventListener("keydown",d,!1),window.removeEventListener("keyup",f,!1)}},THREE.OBJLoader=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,n=/^usemtl /;function i(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var i={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"==typeof n.clone){var i=n.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){var n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){var i=this.vertices,r=this.object.geometry.vertices;r.push(i[e+0],i[e+1],i[e+2]),r.push(i[t+0],i[t+1],i[t+2]),r.push(i[n+0],i[n+1],i[n+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){var i=this.normals,r=this.object.geometry.normals;r.push(i[e+0],i[e+1],i[e+2]),r.push(i[t+0],i[t+1],i[t+2]),r.push(i[n+0],i[n+1],i[n+2])},addColor:function(e,t,n){var i=this.colors,r=this.object.geometry.colors;r.push(i[e+0],i[e+1],i[e+2]),r.push(i[t+0],i[t+1],i[t+2]),r.push(i[n+0],i[n+1],i[n+2])},addUV:function(e,t,n){var i=this.uvs,r=this.object.geometry.uvs;r.push(i[e+0],i[e+1]),r.push(i[t+0],i[t+1]),r.push(i[n+0],i[n+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,i,r,o,a,s,l){var u=this.vertices.length,c=this.parseVertexIndex(e,u),h=this.parseVertexIndex(t,u),p=this.parseVertexIndex(n,u);if(this.addVertex(c,h,p),void 0!==i&&""!==i){var d=this.uvs.length;c=this.parseUVIndex(i,d),h=this.parseUVIndex(r,d),p=this.parseUVIndex(o,d),this.addUV(c,h,p)}if(void 0!==a&&""!==a){var f=this.normals.length;c=this.parseNormalIndex(a,f),h=a===s?c:this.parseNormalIndex(s,f),p=a===l?c:this.parseNormalIndex(l,f),this.addNormal(c,h,p)}this.colors.length>0&&this.addColor(c,h,p)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,n=0,i=e.length;n<i;n++)this.addVertexPoint(this.parseVertexIndex(e[n],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var n=this.vertices.length,i=this.uvs.length,r=0,o=e.length;r<o;r++)this.addVertexLine(this.parseVertexIndex(e[r],n));var a=0;for(o=t.length;a<o;a++)this.addUVLine(this.parseUVIndex(t[a],i))}};return e.startObject("",!1),e}function r(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null}return r.prototype={constructor:r,load:function(e,t,n,i){var r=this,o=new THREE.FileLoader(r.manager);o.setPath(this.path),o.load(e,(function(e){t(r.parse(e))}),n,i)},setPath:function(e){return this.path=e,this},setMaterials:function(e){return this.materials=e,this},parse:function(r){console.time("OBJLoader");var o=new i;-1!==r.indexOf("\r\n")&&(r=r.replace(/\r\n/g,"\n")),-1!==r.indexOf("\\\n")&&(r=r.replace(/\\\n/g,""));for(var a=r.split("\n"),s="",l="",u=[],c="function"==typeof"".trimLeft,h=0,p=a.length;h<p;h++)if(s=a[h],0!==(s=c?s.trimLeft():s.trim()).length&&"#"!==(l=s.charAt(0)))if("v"===l){var d=s.split(/\s+/);switch(d[0]){case"v":o.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])),8===d.length&&o.colors.push(parseFloat(d[4]),parseFloat(d[5]),parseFloat(d[6]));break;case"vn":o.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":o.uvs.push(parseFloat(d[1]),parseFloat(d[2]))}}else if("f"===l){for(var f=s.substr(1).trim().split(/\s+/),m=[],g=0,v=f.length;g<v;g++){var y=f[g];if(y.length>0){var b=y.split("/");m.push(b)}}var _=m[0];for(g=1,v=m.length-1;g<v;g++){var x=m[g],E=m[g+1];o.addFace(_[0],x[0],E[0],_[1],x[1],E[1],_[2],x[2],E[2])}}else if("l"===l){var w=s.substring(1).trim().split(" "),T=[],M=[];if(-1===s.indexOf("/"))T=w;else for(var S=0,C=w.length;S<C;S++){var A=w[S].split("/");""!==A[0]&&T.push(A[0]),""!==A[1]&&M.push(A[1])}o.addLineGeometry(T,M)}else if("p"===l){var R=s.substr(1).trim().split(" ");o.addPointGeometry(R)}else if(null!==(u=e.exec(s))){var P=(" "+u[0].substr(1).trim()).substr(1);o.startObject(P)}else if(n.test(s))o.object.startMaterial(s.substring(7).trim(),o.materialLibraries);else if(t.test(s))o.materialLibraries.push(s.substring(7).trim());else{if("s"!==l){if("\0"===s)continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+s+'"')}if((u=s.split(" ")).length>1){var D=u[1].trim().toLowerCase();o.object.smooth="0"!==D&&"off"!==D}else o.object.smooth=!0;(G=o.object.currentMaterial())&&(G.smooth=o.object.smooth)}o.finalize();var k=new THREE.Group;k.materialLibraries=[].concat(o.materialLibraries);for(h=0,p=o.objects.length;h<p;h++){var j=o.objects[h],O=j.geometry,F=j.materials,B="Line"===O.type,L="Points"===O.type,I=!1;if(0!==O.vertices.length){var N=new THREE.BufferGeometry;N.addAttribute("position",new THREE.Float32BufferAttribute(O.vertices,3)),O.normals.length>0?N.addAttribute("normal",new THREE.Float32BufferAttribute(O.normals,3)):N.computeVertexNormals(),O.colors.length>0&&(I=!0,N.addAttribute("color",new THREE.Float32BufferAttribute(O.colors,3))),O.uvs.length>0&&N.addAttribute("uv",new THREE.Float32BufferAttribute(O.uvs,2));for(var H,z=[],U=0,V=F.length;U<V;U++){var q=F[U],G=void 0;if(null!==this.materials)if(G=this.materials.create(q.name),!B||!G||G instanceof THREE.LineBasicMaterial){if(L&&G&&!(G instanceof THREE.PointsMaterial)){var W=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});X.copy(G),G=W}}else{var X=new THREE.LineBasicMaterial;X.copy(G),X.lights=!1,G=X}G||((G=B?new THREE.LineBasicMaterial:L?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial).name=q.name),G.flatShading=!q.smooth,G.vertexColors=I?THREE.VertexColors:THREE.NoColors,z.push(G)}if(z.length>1){for(U=0,V=F.length;U<V;U++){q=F[U];N.addGroup(q.groupStart,q.groupCount,U)}H=B?new THREE.LineSegments(N,z):L?new THREE.Points(N,z):new THREE.Mesh(N,z)}else H=B?new THREE.LineSegments(N,z[0]):L?new THREE.Points(N,z[0]):new THREE.Mesh(N,z[0]);H.name=j.name,k.add(H)}}return console.timeEnd("OBJLoader"),k}},r}(),THREE.OrbitControls=function(e,t){var n,i,r,o,a;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.target.set=function(e,t,n){if(s.targetLimitData){const i=function(e,t,n){if(s.targetLimitData){const r=s.targetLimitData,o=r.points,a=new THREE.Vector2(s.target.x,s.target.z),l=new THREE.Vector2(e,n);for(let t=0;t<o.length;t++){const r=i(a,l,o[t],o[t+1==o.length?0:t+1]);if(r){e=r.x,n=r.y;break}}t>r.maxUp?t=r.maxUp:t<r.minUp&&(t=r.minUp)}return{x:e,y:t,z:n};function i(e,t,n,i){let r=(e.x-n.x)*(t.y-n.y)-(e.y-n.y)*(t.x-n.x),o=(e.x-i.x)*(t.y-i.y)-(e.y-i.y)*(t.x-i.x);if(r*o>0)return null;let a=(n.x-e.x)*(i.y-e.y)-(n.y-e.y)*(i.x-e.x);if(a*(a+r-o)>0)return null;if(o-r==0)return null;let s=a/(o-r),l=s*(t.x-e.x),u=s*(t.y-e.y);return{x:e.x+l,y:e.y+u}}}(e,t,n);e=i.x,t=i.y,n=i.z}return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this},this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoLeftRotate=!1,this.autoUpRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:THREE.MOUSE.LEFT,MIDDLE:THREE.MOUSE.MIDDLE,RIGHT:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._getIntersectPoint=function(){return new THREE.Vector3},this.move=function(e,t){H(e,t)},this.getPolarAngle=function(){return y.phi},this.getAzimuthalAngle=function(){return y.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(c),s.update(),g=m.NONE},this.update=(n=new THREE.Vector3,i=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),r=i.clone().inverse(),o=new THREE.Vector3,a=new THREE.Quaternion,function(){var e=s.object.position;return n.copy(e).sub(s.target),n.applyQuaternion(i),y.setFromVector3(n),s.autoRotate&&g===m.NONE&&(s.autoLeftRotate?F(j()):s.autoUpRotate&&B(j())),y.theta+=b.theta,y.phi+=b.phi,y.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,y.theta)),y.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,y.phi)),y.makeSafe(),y.radius*=_,y.radius=Math.max(s.minDistance,Math.min(s.maxDistance,y.radius)),s.target.add(x),n.setFromSpherical(y),n.applyQuaternion(r),e.copy(s.target).add(n),s.object.lookAt(s.target),!0===s.enableDamping?(b.theta*=1-s.dampingFactor,b.phi*=1-s.dampingFactor,x.multiplyScalar(1-s.dampingFactor)):(b.set(0,0,0),x.set(0,0,0)),_=1,!!(E||o.distanceToSquared(s.object.position)>v||8*(1-a.dot(s.object.quaternion))>v)&&(s.dispatchEvent(c),o.copy(s.object.position),a.copy(s.object.quaternion),E=!1,!0)}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",$,!1),s.domElement.removeEventListener("mousedown",q,!1),s.domElement.removeEventListener("wheel",X,!1),s.domElement.removeEventListener("touchstart",Q,!1),s.domElement.removeEventListener("touchend",K,!1),s.domElement.removeEventListener("touchmove",Z,!1),s.domElement.removeEventListener("mousemove",Y,!1),document.removeEventListener("mousemove",G,!1),document.removeEventListener("mouseup",W,!1),window.removeEventListener("keydown",J,!1)},this.setTargetLimit=function(e){if(e){if(3==e.length){const t=new THREE.Vector3(e[0],e[1],e[2]);this.targetLimitData={};let n=this.target;const i=this.targetLimitData.maxRight=n.x+t.x/2,r=this.targetLimitData.minRight=n.x-t.x/2,o=this.targetLimitData.maxFoward=n.z+t.z/2,a=this.targetLimitData.minFoward=n.z-t.z/2;this.targetLimitData.minUp=n.y-t.y/2,this.targetLimitData.maxUp=n.y+t.y/2,this.targetLimitData.points=[new THREE.Vector2(r,o),new THREE.Vector2(i,o),new THREE.Vector2(i,a),new THREE.Vector2(r,a)]}}else this.targetLimitData=void 0};var s=this,l={type:"mousemoveevent"},u={type:"wheel",delta:0},c={type:"change"},h={type:"start"},p={type:"end"},d={type:"mousedownpanevent"},f={type:"mouseuppanevent"},m={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},g=m.NONE,v=1e-6,y=new THREE.Spherical,b=new THREE.Spherical,_=1,x=new THREE.Vector3,E=!1,w=new THREE.Vector2,T=new THREE.Vector2,M=new THREE.Vector2,S=new THREE.Vector2,C=new THREE.Vector2,A=new THREE.Vector2,R=new THREE.Vector2,P=new THREE.Vector2,D=new THREE.Vector2,k=null;function j(){return 2*Math.PI/60/60*s.autoRotateSpeed}function O(){return Math.pow(.95,s.zoomSpeed)}function F(e){b.theta-=e}function B(e){b.phi-=e}var L,I=(L=new THREE.Vector3,function(e,t){L.setFromMatrixColumn(t,0),L.multiplyScalar(-e),x.add(L)}),N=function(){var e=new THREE.Vector3;return function(t,n){!0===s.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(s.object.up,e)),e.multiplyScalar(t),x.add(e)}}(),H=function(){var e=new THREE.Vector3;return function(t,n){var i=s.domElement===document?s.domElement.body:s.domElement;if(s.object.isPerspectiveCamera){var r=s.object.position;e.copy(r).sub(s.target);var o=e.length();if(o*=Math.tan(s.object.fov/2*Math.PI/180),I(2*t*o/i.clientHeight,s.object.matrix),N(2*n*o/i.clientHeight,s.object.matrix),s.targetLimitData){const e=function(e){var t=s.target.clone().add(e);let n=t.x,i=t.y,r=t.z;if(s.targetLimitData){const e=s.targetLimitData;n>e.maxRight?n=e.maxRight:n<e.minRight&&(n=e.minRight),r>e.maxFoward?r=e.maxFoward:r<e.minFoward&&(r=e.minFoward),i>e.maxUp?i=e.maxUp:i<e.minUp&&(i=e.minUp)}return{x:n,y:i,z:r}}(x);e&&x.set(e.x-s.target.x,e.y-s.target.y,e.z-s.target.z)}}else s.object.isOrthographicCamera?(I(t*(s.object.right-s.object.left)/s.object.zoom/i.clientWidth,s.object.matrix),N(n*(s.object.top-s.object.bottom)/s.object.zoom/i.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function z(e){s.object.isPerspectiveCamera?_/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),E=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function U(e){s.object.isPerspectiveCamera?_*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),E=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function V(e){S.set(e.clientX,e.clientY),s.dispatchEvent(d)}function q(e){if(!1!==s.enabled){switch(e.preventDefault(),e.button){case s.mouseButtons.LEFT:if(e.ctrlKey||e.metaKey){if(!1===s.enablePan)return;V(e),g=m.PAN}else{if(!1===s.enableRotate)return;!function(e){w.set(e.clientX,e.clientY)}(e),g=m.ROTATE}break;case s.mouseButtons.MIDDLE:if(!1===s.enableZoom)return;!function(e){R.set(e.clientX,e.clientY)}(e),g=m.DOLLY;break;case s.mouseButtons.RIGHT:if(!1===s.enablePan)return;V(e),g=m.PAN}g!==m.NONE&&(document.addEventListener("mousemove",G,!1),document.addEventListener("mouseup",W,!1),s.dispatchEvent(h))}}function G(e){if(!1!==s.enabled)switch(e.preventDefault(),g){case m.ROTATE:if(!1===s.enableRotate)return;!function(e){T.set(e.clientX,e.clientY),M.subVectors(T,w).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;F(2*Math.PI*M.x/t.clientHeight),B(2*Math.PI*M.y/t.clientHeight),w.copy(T),s.update()}(e);break;case m.DOLLY:if(!1===s.enableZoom)return;!function(e){P.set(e.clientX,e.clientY),D.subVectors(P,R),D.y>0?z(O()):D.y<0&&U(O()),R.copy(P),s.update()}(e);break;case m.PAN:if(!1===s.enablePan)return;!function(e){C.set(e.clientX,e.clientY),A.subVectors(C,S).multiplyScalar(s.panSpeed),H(A.x,A.y),S.copy(C),s.update()}(e)}}function W(e){!1!==s.enabled&&(g==m.PAN&&s.dispatchEvent(f),document.removeEventListener("mousemove",G,!1),document.removeEventListener("mouseup",W,!1),s.dispatchEvent(p),g=m.NONE)}function X(e){!1===s.enabled||!1===s.enableZoom||g!==m.NONE&&g!==m.ROTATE||(e.preventDefault(),e.stopPropagation(),function(e){e.deltaY<0?U(O()):e.deltaY>0&&z(O()),u.x=e.x,u.y=e.y,u.clientX=e.clientX,u.clientY=e.clientY,u.layerX=e.layerX,u.layerX=e.layerX,u.offsetX=e.offsetX,u.offsetY=e.offsetY,u.delta=e.deltaY,s.dispatchEvent(u),s.update()}(e))}function J(e){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(e){switch(e.keyCode){case s.keys.UP:H(0,s.keyPanSpeed),s.update();break;case s.keys.BOTTOM:H(0,-s.keyPanSpeed),s.update();break;case s.keys.LEFT:H(s.keyPanSpeed,0),s.update();break;case s.keys.RIGHT:H(-s.keyPanSpeed,0),s.update()}}(e)}function Y(e){var t=!1;if(k){var n=k.distanceTo({x:e.x,y:e.y});0!==e.buttons&&n>=2&&(t=!0)}else k=new THREE.Vector2;k.set(e.x,e.y),t&&s.dispatchEvent(l)}function Q(e){if(!1!==s.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(!1===s.enableRotate)return;!function(e){w.set(e.touches[0].pageX,e.touches[0].pageY)}(e),g=m.TOUCH_ROTATE;break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);R.set(0,i)}if(s.enablePan){var r=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);S.set(r,o)}}(e),g=m.TOUCH_DOLLY_PAN;break;default:g=m.NONE}g!==m.NONE&&s.dispatchEvent(h)}}function Z(e){if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===s.enableRotate)return;if(g!==m.TOUCH_ROTATE)return;!function(e){T.set(e.touches[0].pageX,e.touches[0].pageY),M.subVectors(T,w).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;F(2*Math.PI*M.x/t.clientHeight),B(2*Math.PI*M.y/t.clientHeight),w.copy(T),s.update()}(e);break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;if(g!==m.TOUCH_DOLLY_PAN)return;!function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);P.set(0,i),D.set(0,Math.pow(P.y/R.y,s.zoomSpeed)),z(D.y),R.copy(P)}if(s.enablePan){var r=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);C.set(r,o),A.subVectors(C,S).multiplyScalar(s.panSpeed),H(A.x,A.y),S.copy(C)}s.update()}(e);break;default:g=m.NONE}}function K(e){!1!==s.enabled&&(s.dispatchEvent(p),g=m.NONE)}function $(e){!1!==s.enabled&&e.preventDefault()}s.domElement.addEventListener("contextmenu",$,!1),s.domElement.addEventListener("mousedown",q,!1),s.domElement.addEventListener("wheel",X,!1),s.domElement.addEventListener("touchstart",Q,!1),s.domElement.addEventListener("touchend",K,!1),s.domElement.addEventListener("touchmove",Z,!1),s.domElement.addEventListener("mousemove",Y,!1),window.addEventListener("keydown",J,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}}),THREE.Reflector=function(e,t){THREE.Mesh.call(this,e),this.type="Reflector";var n=this,i=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(8355711),r=t.textureWidth||512,o=t.textureHeight||512,a=t.clipBias||0,s=t.shader||THREE.Reflector.ReflectorShader,l=void 0!==t.recursion?t.recursion:0,u=new THREE.Plane,c=new THREE.Vector3,h=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Matrix4,f=new THREE.Vector3(0,0,-1),m=new THREE.Vector4,g=new THREE.Vector4,v=new THREE.Vector3,y=new THREE.Vector3,b=new THREE.Vector4,_=new THREE.Matrix4,x=new THREE.PerspectiveCamera,E={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},w=new THREE.WebGLRenderTarget(r,o,E);THREE.Math.isPowerOfTwo(r)&&THREE.Math.isPowerOfTwo(o)||(w.texture.generateMipmaps=!1);var T=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(s.uniforms),fragmentShader:s.fragmentShader,vertexShader:s.vertexShader});T.uniforms.tDiffuse.value=w.texture,T.uniforms.color.value=i,T.uniforms.textureMatrix.value=_,this.material=T,this.renderOrder=-1/0,this.addBeforeRenderFunction("THREE.Reflector",(function(e,t,i){if("recursion"in i.userData){if(i.userData.recursion===l)return;i.userData.recursion++}if(h.setFromMatrixPosition(n.matrixWorld),p.setFromMatrixPosition(i.matrixWorld),d.extractRotation(n.matrixWorld),c.set(0,0,1),c.applyMatrix4(d),v.subVectors(h,p),!(v.dot(c)>0)){v.reflect(c).negate(),v.add(h),d.extractRotation(i.matrixWorld),f.set(0,0,-1),f.applyMatrix4(d),f.add(p),y.subVectors(h,f),y.reflect(c).negate(),y.add(h),x.position.copy(v),x.up.set(0,1,0),x.up.applyMatrix4(d),x.up.reflect(c),x.lookAt(y),x.far=i.far,x.updateMatrixWorld(),x.projectionMatrix.copy(i.getProjectionMatrixAlways?i.getProjectionMatrixAlways():i.projectionMatrix),x.userData.recursion=0,_.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),_.multiply(x.projectionMatrix),_.multiply(x.matrixWorldInverse),_.multiply(n.matrixWorld),u.setFromNormalAndCoplanarPoint(c,h),u.applyMatrix4(x.matrixWorldInverse),m.set(u.normal.x,u.normal.y,u.normal.z,u.constant);var r=x.projectionMatrix;b.x=(Math.sign(m.x)+r.elements[8])/r.elements[0],b.y=(Math.sign(m.y)+r.elements[9])/r.elements[5],b.z=-1,b.w=(1+r.elements[10])/r.elements[14],m.multiplyScalar(2/m.dot(b)),r.elements[2]=m.x,r.elements[6]=m.y,r.elements[10]=m.z+1-a,r.elements[14]=m.w,n.visible=!1;var o=e.getRenderTarget(),s=e.xr.enabled,E=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(w),e.clear(),e.render(t,x),e.xr.enabled=s,e.shadowMap.autoUpdate=E,e.setRenderTarget(o);var T=i.bounds;if(void 0!==T){var M=e.getSize(),S=e.getPixelRatio();g.x=T.x*M.width*S,g.y=T.y*M.height*S,g.z=T.z*M.width*S,g.w=T.w*M.height*S,e.state.viewport(g)}n.visible=!0}})),this.getRenderTarget=function(){return w}},THREE.Reflector.prototype=Object.create(THREE.Mesh.prototype),THREE.Reflector.prototype.constructor=THREE.Reflector,THREE.Reflector.ReflectorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")},THREE.ReflectorRTT=function(e,t){THREE.Reflector.call(this,e,t),this.geometry.setDrawRange(0,0)},THREE.ReflectorRTT.prototype=Object.create(THREE.Reflector.prototype),THREE.Refractor=function(e,t){THREE.Mesh.call(this,e),this.type="Refractor";var n=this,i=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(8355711),r=t.textureWidth||512,o=t.textureHeight||512,a=t.clipBias||0,s=t.shader||THREE.Refractor.RefractorShader,l=new THREE.PerspectiveCamera;l.matrixAutoUpdate=!1,l.userData.refractor=!0;var u=new THREE.Plane,c=new THREE.Matrix4,h={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},p=new THREE.WebGLRenderTarget(r,o,h);THREE.Math.isPowerOfTwo(r)&&THREE.Math.isPowerOfTwo(o)||(p.texture.generateMipmaps=!1),this.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,transparent:!0}),this.material.uniforms.color.value=i,this.material.uniforms.tDiffuse.value=p.texture,this.material.uniforms.textureMatrix.value=c;var d,f,m,g,v,y,b,_,x=(d=new THREE.Vector3,f=new THREE.Vector3,m=new THREE.Matrix4,g=new THREE.Vector3,v=new THREE.Vector3,function(e){return d.setFromMatrixPosition(n.matrixWorld),f.setFromMatrixPosition(e.matrixWorld),g.subVectors(d,f),m.extractRotation(n.matrixWorld),v.set(0,0,1),v.applyMatrix4(m),g.dot(v)<0}),E=function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Quaternion,r=new THREE.Vector3;return function(){n.matrixWorld.decompose(t,i,r),e.set(0,0,1).applyQuaternion(i).normalize(),e.negate(),u.setFromNormalAndCoplanarPoint(e,t)}}(),w=(y=new THREE.Plane,b=new THREE.Vector4,_=new THREE.Vector4,function(e){l.matrixWorld.copy(e.matrixWorld),l.matrixWorldInverse.getInverse(l.matrixWorld),l.projectionMatrix.copy(e.getProjectionMatrixAlways?e.getProjectionMatrixAlways():e.projectionMatrix),l.far=e.far,y.copy(u),y.applyMatrix4(l.matrixWorldInverse),b.set(y.normal.x,y.normal.y,y.normal.z,y.constant);var t=l.projectionMatrix;_.x=(Math.sign(b.x)+t.elements[8])/t.elements[0],_.y=(Math.sign(b.y)+t.elements[9])/t.elements[5],_.z=-1,_.w=(1+t.elements[10])/t.elements[14],b.multiplyScalar(2/b.dot(_)),t.elements[2]=b.x,t.elements[6]=b.y,t.elements[10]=b.z+1-a,t.elements[14]=b.w});var T,M=(T=new THREE.Vector4,function(e,t,i){n.visible=!1;var r=e.getRenderTarget(),o=e.xr.enabled,a=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(p),e.clear(),e.render(t,l),e.xr.enabled=o,e.shadowMap.autoUpdate=a,e.setRenderTarget(r);var s=i.bounds;if(void 0!==s){var u=e.getSize(),c=e.getPixelRatio();T.x=s.x*u.width*c,T.y=s.y*u.height*c,T.z=s.z*u.width*c,T.w=s.w*u.height*c,e.state.viewport(T)}n.visible=!0});this.onBeforeRender=function(e,t,i){!0!==i.userData.refractor&&!0!=!x(i)&&(E(),function(e){c.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),c.multiply(e.projectionMatrix),c.multiply(e.matrixWorldInverse),c.multiply(n.matrixWorld)}(i),w(i),M(e,t,i))},this.getRenderTarget=function(){return p}},THREE.Refractor.prototype=Object.create(THREE.Mesh.prototype),THREE.Refractor.prototype.constructor=THREE.Refractor,THREE.Refractor.RefractorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")},THREE.SceneUtils={createMultiMaterialObject:function(e,t){for(var n=new THREE.Group,i=0,r=t.length;i<r;i++)n.add(new THREE.Mesh(e,t[i]));return n},detach:function(e,t,n){e.applyMatrix4(t.matrixWorld),t.remove(e),n.add(e)},attach:function(e,t,n){e.applyMatrix4((new THREE.Matrix4).getInverse(n.matrixWorld)),t.remove(e),n.add(e)}},THREE.SimplifyModifier=function(){},function(){var e=new THREE.Vector3,t=new THREE.Vector3;function n(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}function i(e,t){var n=t.position.distanceTo(e.position),i=0,r=[],o=(e.faces,e.faces.length);for(c=0;c<o;c++)(h=e.faces[c]).hasVertex(t)&&r.push(h);for(c=0;c<o;c++){var a=1;h=e.faces[c];for(var s=0;s<r.length;s++){p=r[s];var l=h.normal.dot(p.normal);a=Math.min(a,(1.001-l)/2)}i=Math.max(i,a)}r.length<2&&(i=1),e.isBorder()&&r.length>1&&(i=1);for(var u=0,c=0;c<o;c++){var h=e.faces[c];for(s=0;s<r.length;s++){var p=r[s];if(h.uvAt(e).equals(p.uvAt(e)))break}s==r.length&&u++}return u&&(i=1),n*i+0}function r(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(var t=0;t<e.neighbors.length;t++){var n=i(e,e.neighbors[t]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[t],e.collapseCost=n,e.minCost=n,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=n,n<e.minCost&&(e.collapseNeighbor=e.neighbors[t],e.minCost=n)}e.collapseCost=e.totalCost/e.costCount}function o(e,t){for(console.assert(0===e.faces.length);e.neighbors.length;){n(e.neighbors.pop().neighbors,e)}n(t,e)}function a(e,t){n(t,e),e.v1&&n(e.v1.faces,e),e.v2&&n(e.v2.faces,e),e.v3&&n(e.v3.faces,e);for(var i,r,o=[this.v1,this.v2,this.v3],a=0;a<3;a++)r=o[(a+1)%3],(i=o[a])&&r&&(i.removeIfNonNeighbor(r),r.removeIfNonNeighbor(i))}function s(e,t,n,i){if(i){var s=[];for(c=0;c<n.neighbors.length;c++)s.push(n.neighbors[c]);for(var l=[],u=n.faces.length,c=0;c<u;c++){(h=n.faces[c]).hasVertex(i)&&l.push(h)}for(c=0;c<u;c++){var h;if(!(h=n.faces[c]).hasVertex(i))for(var p=0;p<l.length;p++){var d=l[p];if(h.uvAt(n).equals(d.uvAt(n))){h.setUV(n,d.uvAt(i));break}l.length}}for(c=n.faces.length-1;c>=0;c--)n.faces[c].hasVertex(i)&&a(n.faces[c],t);for(c=n.faces.length-1;c>=0;c--)n.faces[c].replaceVertex(n,i);for(o(n,e),c=0;c<s.length;c++)r(s[c])}else o(n,e)}function l(e){for(var t=e[0],n=0;n<e.length;n++)e[n].collapseCost<t.collapseCost&&(t=e[n]);return t}function u(e,t,n,i,r,o,a,s,l){this.a=i,this.b=r,this.c=o,this.v1=e,this.v2=t,this.v3=n,this.uv1=a,this.uv2=s,this.uv3=l,this.normal=new THREE.Vector3,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(n),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(n),n.faces.push(this),n.addUniqueNeighbor(e),n.addUniqueNeighbor(t)}function c(e,t){this.position=e,this.id=t,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}u.prototype.computeNormal=function(){var n=this.v1.position,i=this.v2.position,r=this.v3.position;e.subVectors(r,i),t.subVectors(n,i),e.cross(t).normalize(),this.normal.copy(e)},u.prototype.hasVertex=function(e){return e===this.v1||e===this.v2||e===this.v3},u.prototype.replaceVertex=function(e,t){e===this.v1?this.v1=t:e===this.v2?this.v2=t:e===this.v3&&(this.v3=t),n(e.faces,this),t.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},u.prototype.uvAt=function(e){var t=[this.v1,this.v2,this.v3].reduce((function(t,n,i){return!t.length&&e.position.equals(n)&&t.push(i),t}),[])[0];return[this.uv1,this.uv2,this.uv3][t]},u.prototype.setUV=function(e,t){var n=[this.v1,this.v2,this.v3].reduce((function(t,n,i){return!t.length&&e.position.equals(n)&&t.push(i),t}),[])[0];[this.uv1,this.uv2,this.uv3][n]=t},c.prototype.addUniqueNeighbor=function(e){var t,n;t=this.neighbors,n=e,-1===t.indexOf(n)&&t.push(n)},c.prototype.removeIfNonNeighbor=function(e){var t=this.neighbors,n=this.faces,i=t.indexOf(e);if(-1!==i){for(var r=0;r<n.length;r++)if(n[r].hasVertex(e))return;t.splice(i,1)}},c.prototype.isBorder=function(){for(var e=this.neighbors.length,t=0;t<e;t++){for(var n=0,i=this.faces.length,r=0;r<i;r++)this.faces[r].hasVertex(this.neighbors[t])&&n++;if(1===n)return!0}return!1},THREE.SimplifyModifier.prototype.modify=function(e,t){e instanceof THREE.BufferGeometry&&!e.vertices&&!e.faces&&(console.log("converting BufferGeometry to Geometry"),e=(new THREE.Geometry).fromBufferGeometry(e)),e.mergeVertices();var n,i,o=e.vertices,a=e.faces,h=e.faceVertexUvs[0],p=(new THREE.Geometry,new Array(o.length)),d=new Array(a.length);new Array(h.length);for(n=0,i=o.length;n<i;n++)p[n]=new c(o[n],n);for(n=0,i=a.length;n<i;n++)b=a[n],h[n],d[n]=new u(p[b.a],p[b.b],p[b.c],b.a,b.b,b.c,h[n][0],h[n][1],h[n][2]);for(n=0,i=p.length;n<i;n++)r(p[n]);new Array(p.length),new Array(p.length);for(var f,m=t;m--;){if(!(f=l(p))){console.log("no next vertex");break}s(p,d,f,f.collapseNeighbor)}var g=new THREE.Geometry;for(n=0;n<p.length;n++){var v=p[n];g.vertices.push(v.position)}for(n=0;n<d.length;n++){var y=d[n],b=new THREE.Face3(p.indexOf(y.v1),p.indexOf(y.v2),p.indexOf(y.v3),y.normal);g.faces.push(b),g.faceVertexUvs[0].push([y.uv1,y.uv2,y.uv3])}return g}}(),THREE.SubdivisionModifier=function(e){this.subdivisions=void 0===e?1:e},THREE.SubdivisionModifier.prototype.modify=function(e){for(var t=this.subdivisions;t-- >0;)this.smooth(e);e.computeFaceNormals(),e.computeVertexNormals()},function(){var e=["a","b","c"];function t(e,t,n){return n[Math.min(e,t)+"_"+Math.max(e,t)]}function n(e,t,n,i,r,o){var a,s=Math.min(e,t),l=Math.max(e,t),u=s+"_"+l;u in i?a=i[u]:(a={a:n[s],b:n[l],newEdge:null,faces:[]},i[u]=a);a.faces.push(r),o[e].edges.push(a),o[t].edges.push(a)}function i(e,t,n,i,r){e.push(new THREE.Face3(t,n,i,void 0,void 0,r))}function r(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function o(e,t,n,i){e.push([t.clone(),n.clone(),i.clone()])}THREE.SubdivisionModifier.prototype.smooth=function(a){var s,l,u,c,h,p,d,f,m,g,v,y,b,_,x=new THREE.Vector3,E=[];s=a.vertices,l=a.faces;var w,T,M,S,C,A,R,P,D,k,j,O,F,B,L=void 0!==(u=a.faceVertexUvs[0])&&u.length>0;for(d in function(e,t,i,r){var o,a,s;for(o=0,a=e.length;o<a;o++)i[o]={edges:[]};for(o=0,a=t.length;o<a;o++)n((s=t[o]).a,s.b,e,r,s,i),n(s.b,s.c,e,r,s,i),n(s.c,s.a,e,r,s,i)}(s,l,v=new Array(s.length),y={}),b=[],y){for(T=y[d],M=new THREE.Vector3,C=3/8,A=1/8,2!=(R=T.faces.length)&&(C=.5,A=0),M.addVectors(T.a,T.b).multiplyScalar(C),x.set(0,0,0),m=0;m<R;m++){for(S=T.faces[m],g=0;g<3&&((w=s[S[e[g]]])===T.a||w===T.b);g++);x.add(w)}x.multiplyScalar(A),M.add(x),T.newEdge=b.length,b.push(M)}for(_=[],d=0,f=s.length;d<f;d++){for(F=s[d],3==(p=(O=v[d].edges).length)?P=3/16:p>3&&(P=3/(8*p)),D=1-p*P,k=P,p<=2&&2==p&&(D=3/4,k=1/8),B=F.clone().multiplyScalar(D),x.set(0,0,0),m=0;m<p;m++)w=(j=O[m]).a!==F?j.a:j.b,x.add(w);x.multiplyScalar(k),B.add(x),_.push(B)}c=_.concat(b);var I,N,H,z,U,V,q,G=_.length;h=[];var W=new THREE.Vector2,X=new THREE.Vector2,J=new THREE.Vector2;for(d=0,f=l.length;d<f;d++)i(h,I=t((S=l[d]).a,S.b,y).newEdge+G,N=t(S.b,S.c,y).newEdge+G,H=t(S.c,S.a,y).newEdge+G,S.materialIndex),i(h,S.a,I,H,S.materialIndex),i(h,S.b,N,I,S.materialIndex),i(h,S.c,H,N,S.materialIndex),L&&(U=(z=u[d])[0],V=z[1],q=z[2],W.set(r(U.x,V.x),r(U.y,V.y)),X.set(r(V.x,q.x),r(V.y,q.y)),J.set(r(U.x,q.x),r(U.y,q.y)),o(E,W,X,J),o(E,U,W,J),o(E,V,X,W),o(E,q,J,X));a.vertices=c,a.faces=h,L&&(a.faceVertexUvs[0]=E)}}();var THREEx=THREEx||{};THREEx.HtmlMixer=THREEx.HtmlMixer||{},THREEx.HtmlMixer.Context=function(e,t,n){var i=[];this.update=function(){i.forEach((function(e){e()}))};this.cssFactor=1e3;var r=new THREE.CSS3DRenderer({autoFixCamera:!0});this.rendererCss=r,this.rendererWebgl=e;var o=new THREE.PerspectiveCamera(n.fov,n.aspect,1e3*n.near,1e3*n.far);this.cssCamera=o,this.backupCSSCamera=o;var a=this;i.push((function(){s.children.length&&(a.cssCamera.quaternion.copy(n.quaternion),a.cssCamera.position.copy(n.position).multiplyScalar(1e3))}));var s=new THREE.Scene;this.cssScene=s,this.autoUpdateObjects=!0,i.push(function(){!0===this.autoUpdateObjects&&s.traverse((function(e){if(!e.isScene){var t=e.userData.mixerPlane;void 0!==t&&t.update()}}))}.bind(this)),i.push((function(e,t){s.children.length&&(a.cssCamera.isOrthographicCamera&&(a.cssCamera.zoom=THING.App.current.renderCamera.zoom),r.render(s,a.cssCamera))}))},THREEx.HtmlMixer.Plane=function(e,t,n){(n=n||{}).elementW=void 0!==n.elementW?n.elementW:768,n.planeW=void 0!==n.planeW?n.planeW:1,n.planeH=void 0!==n.planeH?n.planeH:3/4,n.object3d=void 0!==n.object3d?n.object3d:null,this.domElement=t;var i=[];this.update=function(){i.forEach((function(e){e()}))};var r=n.planeW,o=n.planeH;if(null===n.object3d)var a=new THREE.MeshBasicMaterial({opacity:0,color:new THREE.Color("black"),blending:THREE.NoBlending,side:THREE.DoubleSide}),s=new THREE.PlaneGeometry(1,1),l=new THREE.Mesh(s,a);else l=n.object3d;this.object3d=l;var u=o/r,c=n.elementW,h=c*u;function p(){t.style.width=c+"px",t.style.height=h+"px"}this.setDomElement=function(e){var n=t;n.parentNode&&n.parentNode.removeChild(n),this.domElement=t=e,d.element=t,p()},p();var d=new THREE.CSS3DObject(t);this.cssObject=d,d.scale.set(r,o,1),d.userData.mixerPlane=this,l.addEventListener("added",(function(t){e.cssScene.add(d)})),l.addEventListener("removed",(function(t){e.cssScene.remove(d)})),i.push((function(){l.updateMatrixWorld();var t=l.matrixWorld,n=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Quaternion;t.decompose(n,r,i),d.quaternion.copy(r),d.position.copy(n).multiplyScalar(e.cssFactor);var o=e.cssFactor/1e3,a=l.geometry.parameters,s=e.cssFactor/(c/(a.width*i.x)),u=e.cssFactor/(h/(a.height*i.y));d.scale.set(s*o,u*o,1)}))},THREE.TransformControls=function(e,t){THREE.Object3D.call(this),t=void 0!==t?t:document,this.visible=!1;var n=new THREE.TransformControlsGizmo;this._gizmo=n,this.add(n);var i=new THREE.TransformControlsPlane;this._plane=i,this.add(i);var r=this;B("camera",e),B("object",void 0),B("enabled",!0),B("axis",null),B("mode","translate"),B("translationSnap",null),B("rotationSnap",null),B("space","world"),B("size",1),B("dragging",!1),B("showX",!0),B("showY",!0),B("showZ",!0);var o={type:"change"},a={type:"mouseDown"},s={type:"mouseUp",mode:r.mode},l={type:"objectChange"},u=new THREE.Raycaster,c=new THREE.Vector3,h=new THREE.Vector3,p=new THREE.Quaternion,d={X:new THREE.Vector3(1,0,0),Y:new THREE.Vector3(0,1,0),Z:new THREE.Vector3(0,0,1)},f=new THREE.Quaternion,m=new THREE.Vector3,g=new THREE.Vector3,v=new THREE.Vector3,y=new THREE.Vector3,b=0,_=new THREE.Vector3,x=new THREE.Quaternion,E=new THREE.Vector3,w=new THREE.Vector3,T=new THREE.Quaternion,M=new THREE.Vector3,S=new THREE.Vector3,C=new THREE.Quaternion,A=new THREE.Vector3,R=new THREE.Vector3,P=new THREE.Quaternion,D=new THREE.Vector3,k=new THREE.Vector3,j=new THREE.Vector3,O=new THREE.Quaternion,F=new THREE.Vector3;function B(e,t){var a=t;Object.defineProperty(r,e,{get:function(){return void 0!==a?a:t},set:function(t){a!==t&&(a=t,i[e]=t,n[e]=t,r.dispatchEvent({type:e+"-changed",value:t}),r.dispatchEvent(o))}}),r[e]=t,i[e]=t,n[e]=t}function L(e){var n=e.changedTouches?e.changedTouches[0]:e,i=t.getBoundingClientRect();return{x:(n.clientX-i.left)/i.width*2-1,y:-(n.clientY-i.top)/i.height*2+1,button:e.button}}function I(e){}function N(e){r.enabled&&r.pointerHover(L(e))}function H(e){r.enabled&&(document.addEventListener("mousemove",z,!1),r.pointerHover(L(e)),r.pointerDown(L(e)))}function z(e){r.enabled&&r.pointerMove(L(e))}function U(e){r.enabled&&(document.removeEventListener("mousemove",z,!1),r.pointerUp(L(e)))}B("parentQuaternion",T),B("worldPosition",R),B("worldPositionStart",S),B("worldQuaternion",P),B("worldQuaternionStart",C),B("cameraPosition",_),B("cameraQuaternion",x),B("pointStart",g),B("pointEnd",v),B("rotationAxis",y),B("rotationAngle",b),B("eye",k),t.addEventListener("mousedown",H,!1),t.addEventListener("touchstart",H,!1),t.addEventListener("mousemove",N,!1),t.addEventListener("touchmove",N,!1),t.addEventListener("touchmove",z,!1),document.addEventListener("mouseup",U,!1),t.addEventListener("touchend",U,!1),t.addEventListener("touchcancel",U,!1),t.addEventListener("touchleave",U,!1),t.addEventListener("contextmenu",I,!1),this.dispose=function(){t.removeEventListener("mousedown",H),t.removeEventListener("touchstart",H),t.removeEventListener("mousemove",N),document.removeEventListener("mousemove",z),t.removeEventListener("touchmove",N),t.removeEventListener("touchmove",z),document.removeEventListener("mouseup",U),t.removeEventListener("touchend",U),t.removeEventListener("touchcancel",U),t.removeEventListener("touchleave",U),t.removeEventListener("contextmenu",I)},this.attach=function(e){this.object=e,this.visible=!0},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),this.object.parent.matrixWorld.decompose(w,T,M),this.object.matrixWorld.decompose(R,P,D)),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(_,x,E),this.camera.isPerspectiveCamera?k.copy(_).sub(R).normalize():this.camera.isOrthographicCamera&&k.copy(_).normalize(),THREE.Object3D.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){u.setFromCamera(e,this.camera);var t=u.intersectObjects(n.picker[this.mode].children,!0)[0]||!1;this.axis=t?t.object.name:null}},this.pointerDown=function(e){if(!(void 0===this.object||!0===this.dragging||void 0!==e.button&&0!==e.button||0!==e.button&&void 0!==e.button||null===this.axis)){u.setFromCamera(e,this.camera);var t=u.intersectObjects([i],!0)[0]||!1;if(t){var n=this.space;if("scale"===this.mode?n="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(n="world"),"local"===n&&"rotate"===this.mode){var r=this.rotationSnap;"X"===this.axis&&r&&(this.object.rotation.x=Math.round(this.object.rotation.x/r)*r),"Y"===this.axis&&r&&(this.object.rotation.y=Math.round(this.object.rotation.y/r)*r),"Z"===this.axis&&r&&(this.object.rotation.z=Math.round(this.object.rotation.z/r)*r)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),j.copy(this.object.position),O.copy(this.object.quaternion),F.copy(this.object.scale),this.object.matrixWorld.decompose(S,C,A),g.copy(t.point).sub(S),"local"===n&&g.applyQuaternion(C.clone().inverse())}this.dragging=!0,a.mode=this.mode,this.dispatchEvent(a)}},this.pointerMove=function(e){var t=this.axis,n=this.mode,r=this.object,a=this.space;if("scale"===n?a="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(a="world"),void 0!==r&&null!==t&&!1!==this.dragging&&(void 0===e.button||0===e.button)){u.setFromCamera(e,this.camera);var s=u.intersectObjects([i],!0)[0]||!1;if(!1!==s){if(v.copy(s.point).sub(S),"local"===a&&v.applyQuaternion(C.clone().inverse()),"translate"===n)-1===t.search("X")&&(v.x=g.x),-1===t.search("Y")&&(v.y=g.y),-1===t.search("Z")&&(v.z=g.z),"local"===a?r.position.copy(v).sub(g).applyQuaternion(O):r.position.copy(v).sub(g),r.position.add(j),this.translationSnap&&("local"===a&&(r.position.applyQuaternion(p.copy(O).inverse()),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.position.applyQuaternion(O)),"world"===a&&(r.parent&&r.position.add(c.setFromMatrixPosition(r.parent.matrixWorld)),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.parent&&r.position.sub(c.setFromMatrixPosition(r.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){var _=v.length()/g.length();v.dot(g)<0&&(_*=-1),c.set(_,_,_)}else c.copy(v).divide(g),-1===t.search("X")&&(c.x=1),-1===t.search("Y")&&(c.y=1),-1===t.search("Z")&&(c.z=1);r.scale.copy(F).multiply(c)}else if("rotate"===n){var x=20/R.distanceTo(c.setFromMatrixPosition(this.camera.matrixWorld)),E="local"===this.space?P:f,w=d[t];"E"===t?(c.copy(v).cross(g),y.copy(k),b=v.angleTo(g)*(c.dot(k)<0?1:-1)):"XYZE"===t?(c.copy(v).sub(g).cross(k).normalize(),y.copy(c),b=v.sub(g).dot(c.cross(k))*x):"X"!==t&&"Y"!==t&&"Z"!==t||(m.copy(w).applyQuaternion(E),y.copy(w),c=w.clone(),h=v.clone().sub(g),"local"===a&&(c.applyQuaternion(E),h.applyQuaternion(C)),b=h.dot(c.cross(k).normalize())*x),this.rotationSnap&&(b=Math.round(b/this.rotationSnap)*this.rotationSnap),this.rotationAngle=b,"local"===a?(r.quaternion.copy(O),r.quaternion.multiply(p.setFromAxisAngle(y,b))):(r.quaternion.copy(p.setFromAxisAngle(y,b)),r.quaternion.multiply(O))}this.dispatchEvent(o),this.dispatchEvent(l)}}},this.pointerUp=function(e){void 0!==e.button&&0!==e.button||(this.dragging&&null!==this.axis&&(s.mode=this.mode,this.dispatchEvent(s)),this.dragging=!1,void 0===e.button&&(this.axis=null))},this.getMode=function(){return r.mode},this.setMode=function(e){r.mode=e},this.setTranslationSnap=function(e){r.translationSnap=e},this.setRotationSnap=function(e){r.rotationSnap=e},this.setSize=function(e){r.size=e},this.setSpace=function(e){r.space=e},this.update=function(){console.warn("THREE.TransformControls: update function has been depricated.")}},THREE.TransformControls.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControls,isTransformControls:!0}),THREE.TransformControlsGizmo=function(){"use strict";THREE.Object3D.call(this),this.type="TransformControlsGizmo";var e=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:THREE.DoubleSide,fog:!1}),t=new THREE.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),n=e.clone();n.opacity=.15;var i=e.clone();i.opacity=.33;var r=e.clone();r.color.set(16711680);var o=e.clone();o.color.set(65280);var a=e.clone();a.color.set(255);var s=e.clone();s.opacity=.25;var l=s.clone();l.color.set(16776960);var u=s.clone();u.color.set(65535);var c=s.clone();c.color.set(16711935),e.clone().color.set(16776960);var h=t.clone();h.color.set(16711680);var p=t.clone();p.color.set(65280);var d=t.clone();d.color.set(255);var f=t.clone();f.color.set(65535);var m=t.clone();m.color.set(16711935);var g=t.clone();g.color.set(16776960);var v=t.clone();v.color.set(7895160);var y=g.clone();y.opacity=.25;var b=new THREE.CylinderBufferGeometry(0,.05,.2,12,1,!1),_=new THREE.BoxBufferGeometry(.125,.125,.125),x=new THREE.BufferGeometry;x.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,0,0],3));var E,w=function(e,t){for(var n=new THREE.BufferGeometry,i=[],r=0;r<=64*t;++r)i.push(0,Math.cos(r/32*Math.PI)*e,Math.sin(r/32*Math.PI)*e);return n.addAttribute("position",new THREE.Float32BufferAttribute(i,3)),n},T={X:[[new THREE.Mesh(b,r),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new THREE.Mesh(b,r),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new THREE.Line(x,h)]],Y:[[new THREE.Mesh(b,o),[0,1,0],null,null,"fwd"],[new THREE.Mesh(b,o),[0,1,0],[Math.PI,0,0],null,"bwd"],[new THREE.Line(x,p),null,[0,0,Math.PI/2]]],Z:[[new THREE.Mesh(b,a),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new THREE.Mesh(b,a),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new THREE.Line(x,d),null,[0,-Math.PI/2,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.1,0),s),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),l),[.15,.15,0]],[new THREE.Line(x,g),[.18,.3,0],null,[.125,1,1]],[new THREE.Line(x,g),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),u),[0,.15,.15],[0,Math.PI/2,0]],[new THREE.Line(x,f),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(x,f),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),c),[.15,0,.15],[-Math.PI/2,0,0]],[new THREE.Line(x,m),[.18,0,.3],null,[.125,1,1]],[new THREE.Line(x,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},M={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),n),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),n),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),n),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.2,0),n)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),n),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),n),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),n),[.2,0,.2],[-Math.PI/2,0,0]]]},S={START:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),i),null,null,null,"helper"]],END:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),i),null,null,null,"helper"]],DELTA:[[new THREE.Line((E=new THREE.BufferGeometry,E.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,1,1],3)),E),i),null,null,null,"helper"]],X:[[new THREE.Line(x,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(x,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(x,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},C={X:[[new THREE.Line(w(1,.5),h)],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),r),[0,0,.99],null,[1,3,1]]],Y:[[new THREE.Line(w(1,.5),p),null,[0,0,-Math.PI/2]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),o),[0,0,.99],null,[3,1,1]]],Z:[[new THREE.Line(w(1,.5),d),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),a),[.99,0,0],null,[1,3,1]]],E:[[new THREE.Line(w(1.25,1),y),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new THREE.Line(w(1,1),v),null,[0,Math.PI/2,0]]]},A={AXIS:[[new THREE.Line(x,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},R={X:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1.25,.1,2,24),n)]],XYZE:[[new THREE.Mesh(new THREE.SphereBufferGeometry(.7,10,8),n)]]},P={X:[[new THREE.Mesh(_,r),[.8,0,0],[0,0,-Math.PI/2]],[new THREE.Line(x,h),null,null,[.8,1,1]]],Y:[[new THREE.Mesh(_,o),[0,.8,0]],[new THREE.Line(x,p),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new THREE.Mesh(_,a),[0,0,.8],[Math.PI/2,0,0]],[new THREE.Line(x,d),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new THREE.Mesh(_,l),[.85,.85,0],null,[2,2,.2]],[new THREE.Line(x,g),[.855,.98,0],null,[.125,1,1]],[new THREE.Line(x,g),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(_,u),[0,.85,.85],null,[.2,2,2]],[new THREE.Line(x,f),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(x,f),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(_,c),[.85,0,.85],null,[2,.2,2]],[new THREE.Line(x,m),[.855,0,.98],null,[.125,1,1]],[new THREE.Line(x,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[0,0,1.1]]]},D={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),n),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),n),[0,.5,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),n),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new THREE.Mesh(_,n),[.85,.85,0],null,[3,3,.2]]],YZ:[[new THREE.Mesh(_,n),[0,.85,.85],null,[.2,3,3]]],XZ:[[new THREE.Mesh(_,n),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),n),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),n),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),n),[0,0,1.1]]]},k={X:[[new THREE.Line(x,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(x,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(x,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},j=function(e){var t=new THREE.Object3D;for(var n in e)for(var i=e[n].length;i--;){var r=e[n][i][0].clone(),o=e[n][i][1],a=e[n][i][2],s=e[n][i][3],l=e[n][i][4];r.name=n,r.tag=l,o&&r.position.set(o[0],o[1],o[2]),a&&r.rotation.set(a[0],a[1],a[2]),s&&r.scale.set(s[0],s[1],s[2]),r.updateMatrix();var u=r.geometry.clone();u.applyMatrix4(r.matrix),r.geometry=u,r.position.set(0,0,0),r.rotation.set(0,0,0),r.scale.set(1,1,1),t.add(r)}return t},O=new THREE.Vector3(0,0,0),F=new THREE.Euler,B=new THREE.Vector3(0,1,0),L=new THREE.Vector3(0,0,0),I=new THREE.Matrix4,N=new THREE.Quaternion,H=new THREE.Quaternion,z=new THREE.Quaternion,U=new THREE.Vector3(1,0,0),V=new THREE.Vector3(0,1,0),q=new THREE.Vector3(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=j(T)),this.add(this.gizmo.rotate=j(C)),this.add(this.gizmo.scale=j(P)),this.add(this.picker.translate=j(M)),this.add(this.picker.rotate=j(R)),this.add(this.picker.scale=j(D)),this.add(this.helper.translate=j(S)),this.add(this.helper.rotate=j(A)),this.add(this.helper.scale=j(k)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var e=this.space;"scale"===this.mode&&(e="local");var t="local"===e?this.worldQuaternion:z;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var n=[];n=(n=(n=n.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var i=0;i<n.length;i++){var r=n[i];r.visible=!0,r.rotation.set(0,0,0),r.position.copy(this.worldPosition);var o=this.worldPosition.distanceTo(this.cameraPosition);if(this.camera.isOrthographicCamera&&(o/=this.camera.zoom),r.scale.set(1,1,1).multiplyScalar(o*this.size/7),"helper"!==r.tag){if(r.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){"X"!==r.name&&"XYZX"!==r.name||Math.abs(B.copy(U).applyQuaternion(t).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"Y"!==r.name&&"XYZY"!==r.name||Math.abs(B.copy(V).applyQuaternion(t).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"Z"!==r.name&&"XYZZ"!==r.name||Math.abs(B.copy(q).applyQuaternion(t).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"XY"===r.name&&Math.abs(B.copy(q).applyQuaternion(t).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"YZ"===r.name&&Math.abs(B.copy(U).applyQuaternion(t).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),"XZ"===r.name&&Math.abs(B.copy(V).applyQuaternion(t).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),-1!==r.name.search("X")&&(B.copy(U).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===r.tag?r.visible=!1:r.scale.x*=-1:"bwd"===r.tag&&(r.visible=!1)),-1!==r.name.search("Y")&&(B.copy(V).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===r.tag?r.visible=!1:r.scale.y*=-1:"bwd"===r.tag&&(r.visible=!1)),-1!==r.name.search("Z")&&(B.copy(q).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===r.tag?r.visible=!1:r.scale.z*=-1:"bwd"===r.tag&&(r.visible=!1))}else"rotate"===this.mode&&(H.copy(t),B.copy(this.eye).applyQuaternion(N.copy(t).inverse()),-1!==r.name.search("E")&&r.quaternion.setFromRotationMatrix(I.lookAt(this.eye,L,V)),"X"===r.name&&(N.setFromAxisAngle(U,Math.atan2(-B.y,B.z)),N.multiplyQuaternions(H,N),r.quaternion.copy(N)),"Y"===r.name&&(N.setFromAxisAngle(V,Math.atan2(B.x,B.z)),N.multiplyQuaternions(H,N),r.quaternion.copy(N)),"Z"===r.name&&(N.setFromAxisAngle(q,Math.atan2(B.y,B.x)),N.multiplyQuaternions(H,N),r.quaternion.copy(N)));r.visible=r.visible&&(-1===r.name.indexOf("X")||this.showX),r.visible=r.visible&&(-1===r.name.indexOf("Y")||this.showY),r.visible=r.visible&&(-1===r.name.indexOf("Z")||this.showZ),r.visible=r.visible&&(-1===r.name.indexOf("E")||this.showX&&this.showY&&this.showZ),r.material._opacity=r.material._opacity||r.material.opacity,r.material._color=r.material._color||r.material.color.clone(),r.material.color.copy(r.material._color),r.material.opacity=r.material._opacity,this.enabled?this.axis&&(r.name===this.axis||this.axis.split("").some((function(e){return r.name===e}))?(r.material.opacity=1,r.material.color.lerp(new THREE.Color(1,1,1),.5)):(r.material.opacity*=.25,r.material.color.lerp(new THREE.Color(1,1,1),.5))):(r.material.opacity*=.5,r.material.color.lerp(new THREE.Color(1,1,1),.5))}else r.visible=!1,"AXIS"===r.name?(r.position.copy(this.worldPositionStart),r.visible=!!this.axis,"X"===this.axis&&(N.setFromEuler(F.set(0,0,0)),r.quaternion.copy(t).multiply(N),Math.abs(B.copy(U).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),"Y"===this.axis&&(N.setFromEuler(F.set(0,0,Math.PI/2)),r.quaternion.copy(t).multiply(N),Math.abs(B.copy(V).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),"Z"===this.axis&&(N.setFromEuler(F.set(0,Math.PI/2,0)),r.quaternion.copy(t).multiply(N),Math.abs(B.copy(q).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),"XYZE"===this.axis&&(N.setFromEuler(F.set(0,Math.PI/2,0)),B.copy(this.rotationAxis),r.quaternion.setFromRotationMatrix(I.lookAt(L,B,V)),r.quaternion.multiply(N),r.visible=this.dragging),"E"===this.axis&&(r.visible=!1)):"START"===r.name?(r.position.copy(this.worldPositionStart),r.visible=this.dragging):"END"===r.name?(r.position.copy(this.worldPosition),r.visible=this.dragging):"DELTA"===r.name?(r.position.copy(this.worldPositionStart),r.quaternion.copy(this.worldQuaternionStart),O.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),O.applyQuaternion(this.worldQuaternionStart.clone().inverse()),r.scale.copy(O),r.visible=this.dragging):(r.quaternion.copy(t),this.dragging?r.position.copy(this.worldPositionStart):r.position.copy(this.worldPosition),this.axis&&(r.visible=-1!==this.axis.search(r.name)))}THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsGizmo.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControlsGizmo,isTransformControlsGizmo:!0}),THREE.TransformControlsPlane=function(){"use strict";THREE.Mesh.call(this,new THREE.PlaneBufferGeometry(1e5,1e5,2,2),new THREE.MeshBasicMaterial({visible:!1,wireframe:!0,side:THREE.DoubleSide,transparent:!0,opacity:.1})),this.type="TransformControlsPlane";var e=new THREE.Vector3(1,0,0),t=new THREE.Vector3(0,1,0),n=new THREE.Vector3(0,0,1),i=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Matrix4,s=new THREE.Quaternion;this.updateMatrixWorld=function(){var l=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(l="local"),e.set(1,0,0).applyQuaternion("local"===l?this.worldQuaternion:s),t.set(0,1,0).applyQuaternion("local"===l?this.worldQuaternion:s),n.set(0,0,1).applyQuaternion("local"===l?this.worldQuaternion:s),o.copy(t),this.mode){case"translate":case"scale":switch(this.axis){case"X":o.copy(this.eye).cross(e),r.copy(e).cross(o);break;case"Y":o.copy(this.eye).cross(t),r.copy(t).cross(o);break;case"Z":o.copy(this.eye).cross(n),r.copy(n).cross(o);break;case"XY":r.copy(n);break;case"YZ":r.copy(e);break;case"XZ":o.copy(n),r.copy(t);break;case"XYZ":case"E":r.set(0,0,0)}break;case"rotate":default:r.set(0,0,0)}0===r.length()?this.quaternion.copy(this.cameraQuaternion):(a.lookAt(i.set(0,0,0),r,o),this.quaternion.setFromRotationMatrix(a)),THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsPlane.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.TransformControlsPlane,isTransformControlsPlane:!0}),THREE.Water=function(e,t){THREE.Mesh.call(this,e),this.type="Water";var n=this,i=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(16777215),r=t.textureWidth||512,o=t.textureHeight||512,a=t.clipBias||0,s=t.flowDirection||new THREE.Vector2(1,0),l=t.flowSpeed||.03,u=t.reflectivity||.02,c=t.scale||1,h=t.shader||THREE.Water.WaterShader,p=new THREE.TextureLoader,d=t.flowMap||void 0,f=t.normalMap0||p.load("textures/water/Water_1_M_Normal.jpg"),m=t.normalMap1||p.load("textures/water/Water_2_M_Normal.jpg"),g=new THREE.Matrix4,v=new THREE.Clock;if(void 0!==THREE.Reflector)if(void 0!==THREE.Refractor){var y=new THREE.Reflector(e,{textureWidth:r,textureHeight:o,clipBias:a}),b=new THREE.Refractor(e,{textureWidth:r,textureHeight:o,clipBias:a});y.matrixAutoUpdate=!1,b.matrixAutoUpdate=!1,this.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,h.uniforms]),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,transparent:!0,fog:!0}),void 0!==d?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:d}):this.material.uniforms.flowDirection={type:"v2",value:s},f.wrapS=f.wrapT=THREE.RepeatWrapping,m.wrapS=m.wrapT=THREE.RepeatWrapping,this.material.uniforms.tReflectionMap.value=y.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=b.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=f,this.material.uniforms.tNormalMap1.value=m,this.material.uniforms.color.value=i,this.material.uniforms.reflectivity.value=u,this.material.uniforms.textureMatrix.value=g,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=.075,this.material.uniforms.config.value.z=.075,this.material.uniforms.config.value.w=c,this.addBeforeRenderFunction("THREE.Water",(function(e,t,i){var r,o;!function(e){g.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),g.multiply(e.getProjectionMatrixAlways?e.getProjectionMatrixAlways():e.projectionMatrix),g.multiply(e.matrixWorldInverse),g.multiply(n.matrixWorld)}(i),r=v.getDelta(),(o=n.material.uniforms.config).value.x+=l*r,o.value.y=o.value.x+.075,o.value.x>=.15?(o.value.x=0,o.value.y=.075):o.value.y>=.15&&(o.value.y=o.value.y-.15),n.visible=!1,y.matrixWorld.copy(n.matrixWorld),b.matrixWorld.copy(n.matrixWorld),y.onBeforeRender(e,t,i),b.onBeforeRender(e,t,i),n.visible=!0}))}else console.error("THREE.Water: Required component THREE.Refractor not found.");else console.error("THREE.Water: Required component THREE.Reflector not found.")},THREE.Water.prototype=Object.create(THREE.Mesh.prototype),THREE.Water.prototype.constructor=THREE.Water,THREE.Water.WaterShader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new THREE.Vector4}},vertexShader:["#include <common>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","uniform mat4 textureMatrix;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tvUv = uv;","\tvCoord = textureMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvToEye = cameraPosition - worldPosition.xyz;","\tvec4 mvPosition =  viewMatrix * worldPosition;","\tgl_Position = projectionMatrix * mvPosition;","\t#include <logdepthbuf_vertex>","\t#include <fog_vertex>","}"].join("\n"),fragmentShader:["#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","uniform sampler2D tReflectionMap;","uniform sampler2D tRefractionMap;","uniform sampler2D tNormalMap0;","uniform sampler2D tNormalMap1;","#ifdef USE_FLOWMAP","\tuniform sampler2D tFlowMap;","#else","\tuniform vec2 flowDirection;","#endif","uniform vec3 color;","uniform float reflectivity;","uniform vec4 config;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\t#include <logdepthbuf_fragment>","\tfloat flowMapOffset0 = config.x;","\tfloat flowMapOffset1 = config.y;","\tfloat halfCycle = config.z;","\tfloat scale = config.w;","\tvec3 toEye = normalize( vToEye );","\tvec2 flow;","\t#ifdef USE_FLOWMAP","\t\tflow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;","\t#else","\t\tflow = flowDirection;","\t#endif","\tflow.x *= - 1.0;","\tvec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );","\tvec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );","\tfloat flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;","\tvec4 normalColor = mix( normalColor0, normalColor1, flowLerp );","\tvec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );","\tfloat theta = max( dot( toEye, normal ), 0.0 );","\tfloat reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 coord = vCoord.xyz / vCoord.w;","\tvec2 uv = coord.xy + coord.z * normal.xz * 0.05;","\tvec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );","\tvec4 refractColor = texture2D( tRefractionMap, uv );","\tgl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );","\t#include <tonemapping_fragment>","\t#include <encodings_fragment>","\t#include <fog_fragment>","}"].join("\n")},function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EarCut=e()}}((function(){return function e(t,n,i){function r(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};t[a][0].call(c.exports,(function(e){return r(t[a][1][e]||e)}),c,c.exports,e,t,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){"use strict";function i(e,t,n){n=n||2;var i,s,l,u,c,d,m,g=t&&t.length,v=g?t[0]*n:e.length,y=r(e,0,v,n,!0),b=[];if(!y||y.next===y.prev)return b;if(g&&(y=function(e,t,n,i){var a,s,l,u=[];for(a=0,s=t.length;a<s;a++)(l=r(e,t[a]*i,a<s-1?t[a+1]*i:e.length,i,!1))===l.next&&(l.steiner=!0),u.push(f(l));for(u.sort(h),a=0;a<u.length;a++)p(u[a],n),n=o(n,n.next);return n}(e,t,y,n)),e.length>80*n){i=l=e[0],s=u=e[1];for(var _=n;_<v;_+=n)(c=e[_])<i&&(i=c),(d=e[_+1])<s&&(s=d),c>l&&(l=c),d>u&&(u=d);m=0!==(m=Math.max(l-i,u-s))?1/m:0}return a(y,b,n,i,s,m),b}function r(e,t,n,i,r){var o,a;if(r===M(e,t,n,i)>0)for(o=t;o<n;o+=i)a=E(o,e[o],e[o+1],a);else for(o=n-i;o>=t;o-=i)a=E(o,e[o],e[o+1],a);return a&&y(a,a.next)&&(w(a),a=a.next),a}function o(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!y(i,i.next)&&0!==v(i.prev,i,i.next))i=i.next;else{if(w(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function a(e,t,n,i,r,h,p){if(e){!p&&h&&function(e,t,n,i){var r=e;do{null===r.z&&(r.z=d(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,o,a,s,l,u=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,i=n,s=0,t=0;t<u&&(s++,i=i.nextZ);t++);for(l=u;s>0||l>0&&i;)0!==s&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,u*=2}while(a>1)}(r)}(e,i,r,h);for(var f,m,g=e;e.prev!==e.next;)if(f=e.prev,m=e.next,h?l(e,i,r,h):s(e))t.push(f.i/n),t.push(e.i/n),t.push(m.i/n),w(e),e=m.next,g=m.next;else if((e=m)===g){p?1===p?a(e=u(e,t,n),t,n,i,r,h,2):2===p&&c(e,t,n,i,r,h):a(o(e),t,n,i,r,h,1);break}}}function s(e){var t=e.prev,n=e,i=e.next;if(v(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(m(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&v(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function l(e,t,n,i){var r=e.prev,o=e,a=e.next;if(v(r,o,a)>=0)return!1;for(var s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,l=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,u=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,c=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,h=d(s,l,t,n,i),p=d(u,c,t,n,i),f=e.prevZ,g=e.nextZ;f&&f.z>=h&&g&&g.z<=p;){if(f!==e.prev&&f!==e.next&&m(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,g!==e.prev&&g!==e.next&&m(r.x,r.y,o.x,o.y,a.x,a.y,g.x,g.y)&&v(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&m(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;g&&g.z<=p;){if(g!==e.prev&&g!==e.next&&m(r.x,r.y,o.x,o.y,a.x,a.y,g.x,g.y)&&v(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function u(e,t,n){var i=e;do{var r=i.prev,o=i.next.next;!y(r,o)&&b(r,i,i.next,o)&&_(r,o)&&_(o,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(o.i/n),w(i),w(i.next),i=e=o),i=i.next}while(i!==e);return i}function c(e,t,n,i,r,s){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&g(l,u)){var c=x(l,u);return l=o(l,l.next),c=o(c,c.next),a(l,t,n,i,r,s),void a(c,t,n,i,r,s)}u=u.next}l=l.next}while(l!==e)}function h(e,t){return e.x-t.x}function p(e,t){if(t=function(e,t){var n,i=t,r=e.x,o=e.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>a){if(a=s,s===r){if(o===i.y)return i;if(o===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===a)return n.prev;var l,u=n,c=n.x,h=n.y,p=1/0;i=n.next;for(;i!==u;)r>=i.x&&i.x>=c&&r!==i.x&&m(o<h?r:a,o,c,h,o<h?a:r,o,i.x,i.y)&&((l=Math.abs(o-i.y)/(r-i.x))<p||l===p&&i.x>n.x)&&_(i,e)&&(n=i,p=l),i=i.next;return n}(e,t)){var n=x(t,e);o(n,n.next)}}function d(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function m(e,t,n,i,r,o,a,s){return(r-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(i-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(r-a)*(i-s)>=0}function g(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&b(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&_(e,t)&&_(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)}function v(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function y(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,n,i){return!!(y(e,n)&&y(t,i)||y(e,i)&&y(n,t))||v(e,t,n)>0!=v(e,t,i)>0&&v(n,i,e)>0!=v(n,i,t)>0}function _(e,t){return v(e.prev,e,e.next)<0?v(e,t,e.next)>=0&&v(e,e.prev,t)>=0:v(e,t,e.prev)<0||v(e,e.next,t)<0}function x(e,t){var n=new T(e.i,e.x,e.y),i=new T(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function E(e,t,n,i){var r=new T(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function w(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function T(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M(e,t,n,i){for(var r=0,o=t,a=n-i;o<n;o+=i)r+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return r}t.exports=i,t.exports.default=i,i.deviation=function(e,t,n,i){var r=t&&t.length,o=r?t[0]*n:e.length,a=Math.abs(M(e,0,o,n));if(r)for(var s=0,l=t.length;s<l;s++){var u=t[s]*n,c=s<l-1?t[s+1]*n:e.length;a-=Math.abs(M(e,u,c,n))}var h=0;for(s=0;s<i.length;s+=3){var p=i[s]*n,d=i[s+1]*n,f=i[s+2]*n;h+=Math.abs((e[p]-e[f])*(e[d+1]-e[p+1])-(e[p]-e[d])*(e[f+1]-e[p+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},i.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[r][o][a]);r>0&&(i+=e[r-1].length,n.holes.push(i))}return n}},{}]},{},[1])(1)}));var Graph=function(e){var t=function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push(t);return n},n=function(e,t){return parseFloat(e)-parseFloat(t)},i=function(e,i,r,o){o=o||1/0;var a,s={},l={0:[i]},u={},c=function(e,t){var n=""+e;l[n]||(l[n]=[]),l[n].push(t)};for(s[i]=0;l&&(a=t(l)).length;){a.sort(n);var h=a[0],p=l[h],d=p.shift(),f=parseFloat(h),m=e[d]||{};for(var g in p.length||delete l[h],m)if(Object.prototype.hasOwnProperty.call(m,g)){var v=m[g]+f,y=s[g];(undefined===y||y>v)&&(s[g]=v,c(v,g),u[g]=d)}}return undefined===s[r]?null:u},r=function(e,t){for(var n=[],i=t;undefined!==i;)n.push(i),i=e[i];return n.reverse(),n},o=function(e,t){for(var n,o,a,s=t.shift(),l=[];t.length;){if(n=t.shift(),!(o=i(e,s,n)))return null;if(a=r(o,n),!t.length)return l.concat(a);l.push.apply(l,a.slice(0,-1)),s=n}},a=function(e,t){try{return Array.prototype.slice.call(e,t)}catch(o){for(var n=[],i=t||0,r=e.length;i<r;++i)n.push(e[i]);return n}},s=function(e){this.map=e};return s.prototype.findShortestPath=function(e,t){return"[object Array]"===Object.prototype.toString.call(e)?o(this.map,e):o(this.map,2===arguments.length?[e,t]:a(arguments))},s.findShortestPath=function(e,t,n){return"[object Array]"===Object.prototype.toString.call(t)?o(e,t):o(e,3===arguments.length?[t,n]:a(arguments,1))},s}();function SimpleIDW(e){if(!(this instanceof SimpleIDW))return new SimpleIDW(e);this._canvas=e="string"==typeof e?document.getElementById(e):e,void 0===this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=128,this._canvas.height=128),this._ctx=this._canvas.getContext("2d"),this._width=this._canvas.width,this._height=this._canvas.height,this._min=0,this._max=1,this._radius=5,this._data=[],this._transformedData=[]}!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/main.js")}({"./node_modules/_worker-loader@2.0.0@worker-loader/dist/workers/InlineWorker.js":
/*!**************************************************************************************!*\
  !*** ./node_modules/_worker-loader@2.0.0@worker-loader/dist/workers/InlineWorker.js ***!
  \**************************************************************************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval("\n\n// http://stackoverflow.com/questions/10343913/how-to-create-a-web-worker-from-a-string\n\nvar URL = window.URL || window.webkitURL;\n\nmodule.exports = function (content, url) {\n  try {\n    try {\n      var blob;\n\n      try {\n        // BlobBuilder = Deprecated, but widely implemented\n        var BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder;\n\n        blob = new BlobBuilder();\n\n        blob.append(content);\n\n        blob = blob.getBlob();\n      } catch (e) {\n        // The proposed API\n        blob = new Blob([content]);\n      }\n\n      return new Worker(URL.createObjectURL(blob));\n    } catch (e) {\n      return new Worker('data:application/javascript,' + encodeURIComponent(content));\n    }\n  } catch (e) {\n    if (!url) {\n      throw Error('Inline worker is not supported');\n    }\n\n    return new Worker(url);\n  }\n};\n\n//# sourceURL=webpack:///./node_modules/_worker-loader@2.0.0@worker-loader/dist/workers/InlineWorker.js?")},"./src/IFCObjectManager.js":
/*!*********************************!*\
  !*** ./src/IFCObjectManager.js ***!
  \*********************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.IFCObjectManager = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /**\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * 构造函数\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @param  IFCObjectManager IFC物体管理器\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * 该管理器主要是管理哪些物体需要使用instance、哪些不做处理、其他物体默认合并\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */\n\n\nvar _defaultObjectStrategy = __webpack_require__(/*! ./defaultObjectStrategy */ \"./src/defaultObjectStrategy.js\");\n\nvar _defaultObjectStrategy2 = _interopRequireDefault(_defaultObjectStrategy);\n\nvar _strategy = __webpack_require__(/*! ./strategy */ \"./src/strategy.js\");\n\nvar _strategy2 = _interopRequireDefault(_strategy);\n\nvar _util = __webpack_require__(/*! ./util */ \"./src/util.js\");\n\nvar _util2 = _interopRequireDefault(_util);\n\n__webpack_require__(/*! ./workers/MergeBufferGeometryUtils */ \"./src/workers/MergeBufferGeometryUtils.js\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar IFCObjectManager = function () {\n    function IFCObjectManager() {\n        _classCallCheck(this, IFCObjectManager);\n\n        this.strategy = _defaultObjectStrategy2.default;\n        this.instanceMinNumber = 4;\n        this.mergeTime = 0;\n        this.mergeObject = [];\n        this.originMergedLength = 0;\n        this.createThingObjTime = 0;\n    }\n\n    /**\r\n     * 注入一个处理策略\r\n     * **/\n\n\n    _createClass(IFCObjectManager, [{\n        key: 'injectStrategy',\n        value: function injectStrategy(strategy) {\n            this.strategy = Object.assign({}, this.strategy, strategy);\n        }\n\n        /**\r\n         * 设置instance物体的最小数量\r\n         * **/\n\n    }, {\n        key: 'setInstanceMinNumber',\n        value: function setInstanceMinNumber(nums) {\n            this.instanceMinNumber = nums;\n        }\n    }, {\n        key: 'getObjectStrategy',\n        value: function getObjectStrategy(objType) {\n            var strategy = this.strategy;\n            return strategy[objType] || _strategy2.default.none;\n        }\n\n        //创建真实的thingjs物体\n        //还要考虑节点的合并问题，感觉又开始耗时了，哈哈\n\n    }, {\n        key: 'createThingObj',\n        value: function createThingObj(meshArr, floor) {\n            meshArr = this._parseMeshArr(meshArr);\n            var geometryKey = {};\n            var matKey = {};\n            for (var i = 0, len = meshArr.length; i < len; i++) {\n                var mesh = meshArr[i];\n                var id = _util2.default.getMaterialId(mesh.material);\n                matKey[id] = mesh.material;\n                //合并物体\n                if (!geometryKey[id]) {\n                    geometryKey[id] = { obj: [], line: [] };\n                }\n                var geometry = mesh.geometry.clone();\n                geometry.applyMatrix(mesh.matrix);\n                geometryKey[id].obj.push(geometry);\n                if (mesh._line) {\n                    var lineGeometry = mesh._line.geometry.clone();\n                    lineGeometry.applyMatrix(mesh.matrix);\n                    geometryKey[id].line.push(lineGeometry);\n                }\n            }\n            var now = new Date().getTime();\n            for (var k in geometryKey) {\n                if (geometryKey[k].obj.length) {\n                    this.originMergedLength += geometryKey[k].obj.length;\n                }\n                var _geometry = this._createMergedObjGeometry(geometryKey[k].obj);\n                var _mesh = new THREE.Mesh(_geometry, matKey[k]);\n\n                var _lineGeometry = this._createMergedLineGeometry(geometryKey[k].line);\n                var line = new THREE.LineSegments(_lineGeometry, _util2.default.defaultLineMaterial);\n\n                _mesh.add(line);\n                floor.node.add(_mesh);\n                this.mergeObject.push(_mesh);\n                //floor.wallNode.add(mesh);\n            }\n            this.mergeTime += new Date().getTime() - now;\n        }\n        //这里的meshArr不一定是mesh，有可能是node，需要处理并且进行世界的更新\n\n    }, {\n        key: '_parseMeshArr',\n        value: function _parseMeshArr(meshArr) {\n            var result = [];\n            for (var i = 0, len = meshArr.length; i < len; i++) {\n                var node = meshArr[i];\n                node.updateMatrixWorld(true);\n                node.traverse(function (v) {\n                    if (v.isMesh) {\n                        result.push(v);\n                    }\n                });\n            }\n            return result;\n        }\n    }, {\n        key: '_createMergedObjGeometry',\n        value: function _createMergedObjGeometry(geometryArr) {\n            // if(window.MG){\n            //     return MG.getMergeGeometryInfo(geometryArr).then(res=>{\n            //         debugger;\n            //     });\n            // }\n            //TODO 是不是要限制一下最大数量，但是目前还得思考下最大数量设置多大比较合适\n            var geometry = THREE.MergeBufferGeometryUtils.mergeBufferGeometries1(geometryArr, null, true)[0];\n            return geometry;\n        }\n    }, {\n        key: '_createMergedLineGeometry',\n        value: function _createMergedLineGeometry(geometryArr) {\n            var geometry = THREE.MergeBufferGeometryUtils.mergeBufferGeometries(geometryArr);\n            return geometry;\n        }\n    }, {\n        key: 'createGeometry',\n        value: function createGeometry(position, normal, uv, index, uv2, uv3, groups, id) {\n            var geometry = new THREE.BufferGeometry();\n            geometry.addAttribute('position', new THREE.BufferAttribute(position, 3));\n            geometry.addAttribute('normal', new THREE.BufferAttribute(normal, 3));\n            geometry.addAttribute('uv', new THREE.BufferAttribute(uv, 2));\n            if (index) {\n                geometry.setIndex(new THREE.BufferAttribute(index, 1));\n            }\n            if (uv2) {\n                geometry.addAttribute('uv2', new THREE.BufferAttribute(uv2, 2));\n            }\n            if (uv3) {\n                geometry.addAttribute('uv3', new THREE.BufferAttribute(uv3, 2));\n            }\n            if (groups) {\n                geometry.groups = groups;\n            }\n            if (id) {\n                geometry.addAttribute('id', new THREE.BufferAttribute(id, 1));\n            }\n            return geometry;\n        }\n    }]);\n\n    return IFCObjectManager;\n}();\n\nexports.IFCObjectManager = IFCObjectManager;\n\n//# sourceURL=webpack:///./src/IFCObjectManager.js?")},"./src/IFCParser.js":
/*!**************************!*\
  !*** ./src/IFCParser.js ***!
  \**************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\nexports.IFCParser = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _buffer = __webpack_require__(/*! ./buffer */ \"./src/buffer.js\");\n\nvar _buffer2 = _interopRequireDefault(_buffer);\n\nvar _IFCObjectManager = __webpack_require__(/*! ./IFCObjectManager */ \"./src/IFCObjectManager.js\");\n\nvar _bufferProcess = __webpack_require__(/*! ./workers/bufferProcess.worker */ \"./src/workers/bufferProcess.worker.js\");\n\nvar _bufferProcess2 = _interopRequireDefault(_bufferProcess);\n\nvar _util = __webpack_require__(/*! ./util */ \"./src/util.js\");\n\nvar _util2 = _interopRequireDefault(_util);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/**\r\n * IFCParser:IFC核心解析器，目前先解析逻辑结构，如果逻辑物体无法解析则加载失败\r\n */\nvar _workerPool = [];\nvar _workerIdx = 0;\nvar urlWorkerCache = new Map();\nvar LoadingState = {\n\tPrepare: 0,\n\tLoading: 1,\n\tReady: 2\n};\n\nvar IFCParser = function () {\n\tfunction IFCParser(json, type, recursion, campus, extensions, options) {\n\t\t_classCallCheck(this, IFCParser);\n\n\t\tthis.json = json || {};\n\t\tthis.extensions = extensions || {};\n\t\tthis.options = options || {};\n\t\tthis.type = type;\n\t\tthis.recursion = recursion;\n\t\tthis.campus = campus;\n\t\tthis.app = campus.app;\n\t\tthis.cache = _buffer2.default;\n\t\tthis.nodeInfo = {};\n\t\tthis.materialInfo = {};\n\t\tthis.buffer = {};\n\t\tthis.gData = {};\n\n\t\tthis.ifcObjectManager = new _IFCObjectManager.IFCObjectManager();\n\n\t\tthis.url = options.url;\n\t\t//levels数据\n\t\tthis.levels = 0;\n\t\t//下载数据 material:1, node:5, buffer50\n\t\tthis.datas = 1 + 5 + 1;\n\t\t//正在下载数据\n\t\tthis.loadingDatas = 0;\n\t\tthis.fileLoader = new THREE.FileLoader(this.options.manager);\n\t\tthis.eventManager = this.options.eventManager;\n\n\t\t//TODO 最后再维护进度吧\n\n\t\t//默认使用worker解析buffer\n\t\t//worker维护\n\t\tthis._maximumThreadsNumber = 5;\n\n\t\t//是否动态加载\n\t\tthis.asyncLoading = true;\n\t\t//动态加载config\n\t\tthis.asyncLoadingConfig = {};\n\t\t//需要下载的数据\n\t\tthis.prepareLoading = [];\n\t\t//当前任务总数\n\t\tthis.totalTask = 0;\n\t\t//当前任务完成数\n\t\tthis.readyTask = 0;\n\t\t//缓存load\n\t\tthis.bufferLoad = new Map();\n\t\t//缓存thingjs对象id\n\t\tthis.bufferTingObject = [];\n\t\t//下载任务\n\t\tthis.totalLoadTask = 0;\n\t\tthis.currentLoadTask = 0;\n\t\tthis.wall = {};\n\t\t//debugBox\n\t\tthis.debugBoundingBox = false;\n\t\t//是否全部加载\n\t\tthis.loadingAll = false;\n\n\t\tthis.debugMesh = [];\n\t}\n\n\t/**\r\n  * 核心解析函数，先解析逻辑物体再去解析buffer创建实际渲染物体\r\n  * **/\n\n\n\t_createClass(IFCParser, [{\n\t\tkey: \"parse\",\n\t\tvalue: function parse(onLoad, onError) {\n\t\t\tthis.pendingRoom = [];\n\t\t\tvar parser = this;\n\t\t\tvar loader = parser.fileLoader;\n\t\t\tvar pending = [];\n\t\t\t//创建worker解析器，等待接收解析完的buffer\n\n\t\t\t//解析node\n\t\t\tpending.push(new Promise(function (resolve, reject) {\n\t\t\t\tloader.load(parser.url + 'node.json', function (node) {\n\t\t\t\t\tparser.nodeInfo = JSON.parse(node);\n\t\t\t\t\tparser.loadingDatas += 5;\n\t\t\t\t\tparser.eventManager.dispatchEvent({\n\t\t\t\t\t\ttype: 'progress',\n\t\t\t\t\t\tprogress: parser.loadingDatas / parser.datas\n\t\t\t\t\t});\n\t\t\t\t\tresolve(node);\n\t\t\t\t});\n\t\t\t}));\n\t\t\t//解析material\n\t\t\tpending.push(new Promise(function (resolve, reject) {\n\t\t\t\tloader.load(parser.url + 'material.json', function (material) {\n\t\t\t\t\tparser.materialInfo = JSON.parse(material);\n\t\t\t\t\tparser.loadingDatas++;\n\t\t\t\t\tparser.eventManager.dispatchEvent({\n\t\t\t\t\t\ttype: 'progress',\n\t\t\t\t\t\tprogress: parser.loadingDatas / parser.datas\n\t\t\t\t\t});\n\t\t\t\t\tresolve(material);\n\t\t\t\t});\n\t\t\t}));\n\t\t\tPromise.all(pending).then(function () {\n\t\t\t\t//开始解析thingjs逻辑物体\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\tparser.parseSite(parser.campus, true);\n\t\t\t\t\t//分发完成的进度\n\t\t\t\t\tparser.eventManager.dispatchEvent({\n\t\t\t\t\t\ttype: 'progress',\n\t\t\t\t\t\tprogress: 1\n\t\t\t\t\t});\n\t\t\t\t\tif (!parser.asyncLoading) {\n\t\t\t\t\t\tparser.total = parser.bufferTotalCount;\n\t\t\t\t\t}\n\t\t\t\t\tif (parser.loadingAll) {\n\t\t\t\t\t\tparser.campus.loadResource(true);\n\t\t\t\t\t\tparser.startToBuild(function (v) {\n\t\t\t\t\t\t\tif (v === 1) {\n\t\t\t\t\t\t\t\tonLoad(parser.campus);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tonLoad(parser.campus);\n\t\t\t\t\t}\n\t\t\t\t}, 10);\n\t\t\t});\n\t\t\tparser.eventManager.addEventListener('finish', function (ev) {\n\t\t\t\tonLoad(ev.data);\n\t\t\t});\n\t\t}\n\n\t\t//解析site,目前园区只能有一个，目前先解析逻辑节点，最终解析bin文件生成真实的mesh节点\n\n\t}, {\n\t\tkey: \"parseSite\",\n\t\tvalue: function parseSite(campus, recursion) {\n\t\t\t//创建campus下的node\n\t\t\tvar app = this.app;\n\t\t\t//return new Promise( function ( resolve ) {\n\t\t\tvar entitys = this.json;\n\t\t\tvar name = entitys.i;\n\t\t\tcampus.id = name;\n\t\t\tcampus.name = 'Campus_' + name;\n\t\t\tif (this.nodeInfo[name]) {\n\t\t\t\tvar thing = app.objectManager.create({\n\t\t\t\t\ttype: 'Thing',\n\t\t\t\t\tparent: campus,\n\t\t\t\t\tid: name + '_thing',\n\t\t\t\t\tuuid: name\n\t\t\t\t});\n\t\t\t\tthing.name = entitys.n;\n\t\t\t\tthing.bimData = entitys;\n\t\t\t\tthing.node.name = entitys.n;\n\t\t\t\tthing.userData['DATA'] = entitys.properties;\n\t\t\t\t//如果动态加载先创建一个box来代替包围盒子,园区和building下的实体比较特殊\n\t\t\t\tif (this.asyncLoading) {\n\t\t\t\t\tvar model = entitys.m;\n\t\t\t\t\tif (model) {\n\t\t\t\t\t\t_util2.default.createBox(model.s, thing, this.debugBoundingBox, entitys.p);\n\t\t\t\t\t\tthis.asyncLoadingConfig[name] = { url: '../models/' + model };\n\t\t\t\t\t\tthis.asyncLoadingConfig[name].object = thing;\n\t\t\t\t\t\tthis.asyncLoadingConfig[name].node = [this.nodeInfo[name]];\n\t\t\t\t\t\tthis.asyncLoadingConfig[name].isParsed = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (recursion) {\n\t\t\t\tthis.parseBuilding(campus, this.json, recursion);\n\t\t\t}\n\t\t\t//});\n\t\t}\n\t}, {\n\t\tkey: \"parseBuilding\",\n\n\n\t\t//解析building\n\t\tvalue: function parseBuilding(campus, data, recursion) {\n\t\t\tvar child = data.c;\n\t\t\tvar app = this.app;\n\t\t\t//this.buildings = Object.keys(child).length;\n\t\t\t//return new Promise( function ( resolve ) {\n\t\t\tfor (var i in child) {\n\t\t\t\tvar building = app.objectManager.create({\n\t\t\t\t\ttype: 'Building',\n\t\t\t\t\tid: i,\n\t\t\t\t\tname: 'building_' + i,\n\t\t\t\t\tparent: campus\n\t\t\t\t});\n\t\t\t\tvar name = i;\n\t\t\t\t//创建facade,外立面比较特殊，需要\n\t\t\t\tvar facade = app.objectManager.create({\n\t\t\t\t\ttype: 'Facade',\n\t\t\t\t\tname: 'Facade',\n\t\t\t\t\tparent: building,\n\t\t\t\t\tid: name + '_facade'\n\t\t\t\t});\n\t\t\t\tif (this.asyncLoading) {\n\t\t\t\t\tfacade.uuid = name;\n\t\t\t\t\tvar count = child[i].bufferCount;\n\t\t\t\t\tthis.asyncLoadingConfig[name] = { url: [] };\n\t\t\t\t\tthis.asyncLoadingConfig[name].node = [];\n\t\t\t\t\tthis.asyncLoadingConfig[name].object = facade;\n\t\t\t\t\tfor (var k = 0; k < count; k++) {\n\t\t\t\t\t\tvar url = './buffer_' + campus.id + '_' + i + '_' + k;\n\t\t\t\t\t\tthis.asyncLoadingConfig[name].url.push(url);\n\t\t\t\t\t}\n\t\t\t\t\tvar size = child[i].s;\n\t\t\t\t\tvar position = child[i].p;\n\t\t\t\t\t_util2.default.createBox(size, facade, this.debugBoundingBox, position);\n\t\t\t\t}\n\t\t\t\t//如果building下有渲染子物体\n\t\t\t\tif (this.nodeInfo[name]) {\n\t\t\t\t\tvar thing = app.objectManager.create({\n\t\t\t\t\t\ttype: 'Thing',\n\t\t\t\t\t\tname: 'thing',\n\t\t\t\t\t\tparent: building,\n\t\t\t\t\t\tid: name,\n\t\t\t\t\t\tuuid: name\n\t\t\t\t\t});\n\t\t\t\t\tthing.name = child[i].n;\n\t\t\t\t\tthing.bimData = child[i];\n\t\t\t\t\tthing.node.name = child[i].n;\n\t\t\t\t\tthing.userData['DATA'] = child[i].properties;\n\t\t\t\t\t//如果动态加载先创建一个box来代替包围盒子\n\t\t\t\t\tif (this.asyncLoading) {\n\t\t\t\t\t\tvar model = child[i].m;\n\t\t\t\t\t\tvar _position = child[i].p;\n\t\t\t\t\t\tif (model) {\n\t\t\t\t\t\t\tvar _size = this.json.models[model].s;\n\t\t\t\t\t\t\t_util2.default.createBox(_size, thing, this.debugBoundingBox, _position);\n\t\t\t\t\t\t\tthis.asyncLoadingConfig[name] = { url: '../models/' + model };\n\t\t\t\t\t\t\tthis.asyncLoadingConfig[name].object = thing;\n\t\t\t\t\t\t\tthis.asyncLoadingConfig[name].node = [this.nodeInfo[name]];\n\t\t\t\t\t\t\tthis.asyncLoadingConfig[name].isParsed = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (recursion) {\n\t\t\t\t\tthis.parseBuildingstorey(campus, building, child[i], this.asyncLoadingConfig[name].node, recursion);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// });\n\t\t}\n\t}, {\n\t\tkey: \"parseBuildingstorey\",\n\t\tvalue: function parseBuildingstorey(campus, building, data, buildingCollection, recursion) {\n\t\t\tvar that = this;\n\t\t\tvar app = this.app;\n\t\t\t//return new Promise( function ( resolve ) {\n\t\t\tvar child = data.c;\n\t\t\tthat.levels = Object.keys(child).length;\n\t\t\tfor (var i in child) {\n\t\t\t\tvar floor = app.objectManager.create({\n\t\t\t\t\ttype: 'Floor',\n\t\t\t\t\tid: i + '_floor',\n\t\t\t\t\tparent: building\n\t\t\t\t});\n\t\t\t\tif (recursion) {\n\t\t\t\t\t//that.pendingRoom.push(that.parseRoom(floor, child[i], i));\n\t\t\t\t\tthat.parseFloor(campus, building, floor, child[i], i, buildingCollection, recursion);\n\t\t\t\t}\n\t\t\t}\n\t\t\t//});\n\t\t}\n\t}, {\n\t\tkey: \"parseFloor\",\n\t\tvalue: function parseFloor(campus, building, floor, data, level, buildingCollection, recursion) {\n\t\t\tvar that = this;\n\t\t\tvar child = data.c;\n\t\t\tvar app = that.app;\n\n\t\t\t//创建内墙\n\t\t\tvar wall = app.objectManager.create({\n\t\t\t\ttype: 'CombinedObject',\n\t\t\t\tname: floor.name + '_wall',\n\t\t\t\tparent: floor,\n\t\t\t\tid: level + '_wall',\n\t\t\t\tuuid: level\n\t\t\t});\n\t\t\t//userData需要设置告诉thingjs是wall\n\t\t\twall.userData.type = 'CombineWallParent';\n\t\t\tif (this.asyncLoading) {\n\t\t\t\tvar count = data.bufferCount;\n\t\t\t\tthis.asyncLoadingConfig[level] = { url: [] };\n\t\t\t\tthis.asyncLoadingConfig[level].node = [];\n\t\t\t\tthis.asyncLoadingConfig[level].object = wall;\n\t\t\t\tfor (var k = 0; k < count; k++) {\n\t\t\t\t\tvar url = './buffer_' + campus.id + '_' + building.id + '_' + level + '_' + k;\n\t\t\t\t\tthis.asyncLoadingConfig[level].url.push(url);\n\t\t\t\t}\n\t\t\t\t//floor暂时没有包围盒\n\t\t\t\t// var size = data.s;\n\t\t\t\t// util.createBox(size, wall,  this.debugBoundingBox);\n\t\t\t}\n\t\t\t//TODO 由于目前bim识别房间比较困难，目前每一层认为是一个房间\n\t\t\tvar room = app.objectManager.create({\n\t\t\t\ttype: 'Room',\n\t\t\t\tname: floor.name + '_room',\n\t\t\t\tid: level + '_room',\n\t\t\t\tparent: floor\n\t\t\t});\n\t\t\tif (recursion) {\n\t\t\t\tthat.parseRoom(room, data, level, this.asyncLoadingConfig[level].node, buildingCollection, recursion);\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: \"parseRoom\",\n\t\tvalue: function parseRoom(room, data, level, collection, buildingCollection) {\n\t\t\tvar child = data.c;\n\t\t\tfor (var i in child) {\n\t\t\t\t//if (this.nodeInfo[i]) {\n\t\t\t\t//const nodeInfo = this.nodeInfo[i];\n\t\t\t\t//if (nodeInfo) {\n\t\t\t\tvar nodeInfo = child[i];\n\t\t\t\tnodeInfo.id = i;\n\t\t\t\tvar t1 = child[i].t1;\n\t\t\t\tif (t1 === 'inside') {\n\t\t\t\t\tcollection.push(nodeInfo);\n\t\t\t\t}\n\t\t\t\t//TODO 后续需要ObjectManager的加入\n\t\t\t\telse if (t1 === 'Wall' || t1 === 'Door' || t1 === 'Window') {\n\t\t\t\t\t\t// buildingCollection.push(nodeInfo);\n\t\t\t\t\t\tbuildingCollection.push(nodeInfo);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar thing = this.app.objectManager.create({\n\t\t\t\t\t\t\ttype: 'Thing',\n\t\t\t\t\t\t\tname: child[i].n,\n\t\t\t\t\t\t\tparent: room,\n\t\t\t\t\t\t\tid: i,\n\t\t\t\t\t\t\tuuid: i\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthing.userData['DATA'] = child[i].properties;\n\t\t\t\t\t\tif (child[i].et) {\n\t\t\t\t\t\t\tthing.userData['effectTag'] = child[i].et;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//如果动态加载先创建一个box来代替包围盒子\n\t\t\t\t\t\tif (this.asyncLoading) {\n\t\t\t\t\t\t\tvar model = child[i].m;\n\t\t\t\t\t\t\tvar positon = child[i].p;\n\t\t\t\t\t\t\tif (model) {\n\t\t\t\t\t\t\t\t//如果没有model一般是墙或者合并的物体\n\t\t\t\t\t\t\t\tvar size = this.json.models[model].s;\n\t\t\t\t\t\t\t\t_util2.default.createBox(size, thing, this.debugBoundingBox, positon);\n\t\t\t\t\t\t\t\tthis.asyncLoadingConfig[i] = { url: '../models/' + model };\n\t\t\t\t\t\t\t\tthis.asyncLoadingConfig[i].object = thing;\n\t\t\t\t\t\t\t\t// this.asyncLoadingConfig[i].node = [this.nodeInfo[i]];\n\t\t\t\t\t\t\t\tthis.asyncLoadingConfig[i].node = [nodeInfo];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t//}\n\t\t\t\t//}\n\t\t\t}\n\t\t}\n\n\t\t//先从urlWorkerCache中去寻找worker，如果找到就不要创建新的了\n\n\t}, {\n\t\tkey: \"getBufferWorker\",\n\t\tvalue: function getBufferWorker(url) {\n\t\t\tvar that = this;\n\t\t\tvar bufferWorker = urlWorkerCache.get(url);\n\t\t\tif (bufferWorker) return bufferWorker;\n\t\t\tbufferWorker = _workerPool[_workerIdx];\n\t\t\tif (!bufferWorker) {\n\t\t\t\t_workerPool[_workerIdx] = new _bufferProcess2.default();\n\t\t\t\tbufferWorker = _workerPool[_workerIdx];\n\t\t\t\tbufferWorker._listeners = new Map();\n\t\t\t\tbufferWorker.onmessage = function (e) {\n\t\t\t\t\tif (e.data) {\n\t\t\t\t\t\tvar methodType = e.data.method;\n\t\t\t\t\t\tswitch (methodType) {\n\t\t\t\t\t\t\tcase 'buffers':\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthat.bufferLoad.set(e.data.url, LoadingState.Ready);\n\t\t\t\t\t\t\t\t\tthat._updateBuffer(e.data.buffers);\n\t\t\t\t\t\t\t\t\tif (bufferWorker._listeners.has(e.data.url)) {\n\t\t\t\t\t\t\t\t\t\tbufferWorker._listeners.get(e.data.url).forEach(function (v, k) {\n\t\t\t\t\t\t\t\t\t\t\tv({ id: k });\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (_workerIdx >= this._maximumThreadsNumber) {\n\t\t\t\t_workerIdx = 0;\n\t\t\t}\n\t\t\t_workerIdx++;\n\t\t\turlWorkerCache.set(url, bufferWorker);\n\t\t\treturn bufferWorker;\n\t\t}\n\t}, {\n\t\tkey: \"getMeshes\",\n\t\tvalue: function getMeshes(url, id, flag) {\n\t\t\tvar promise = void 0;\n\t\t\tvar worker = this.getBufferWorker(url);\n\t\t\tif (this.bufferLoad.get(url) === undefined) {\n\t\t\t\tworker.postMessage({ url: this.url + url + '.bin', id: id, currentUrl: url, flag: flag });\n\t\t\t\tthis.bufferLoad.set(url, LoadingState.Loading);\n\t\t\t} else if (this.bufferLoad.get(url) === LoadingState.Ready) {\n\t\t\t\tpromise = new Promise(function (resolve, reject) {\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\tresolve({ id: id });\n\t\t\t\t\t}, 0);\n\t\t\t\t});\n\t\t\t\treturn promise;\n\t\t\t}\n\t\t\tvar that = this;\n\t\t\tpromise = new Promise(function (resolve, reject) {\n\t\t\t\tif (!worker._listeners.has(url)) {\n\t\t\t\t\tworker._listeners.set(url, new Map());\n\t\t\t\t}\n\t\t\t\tworker._listeners.get(url).set(id, function (data) {\n\t\t\t\t\tworker._listeners.delete(url);\n\t\t\t\t\tthat.readyTask++;\n\t\t\t\t\tthat.bufferLoad.set(url, LoadingState.Ready);\n\t\t\t\t\tresolve(data);\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn promise;\n\t\t}\n\t}, {\n\t\tkey: \"_updateBuffer\",\n\t\tvalue: function _updateBuffer(data) {\n\t\t\tfor (var i in data) {\n\t\t\t\tif (i === 'wall') {\n\t\t\t\t\tfor (var k in data[i]) {\n\t\t\t\t\t\tthis.wall[k] = data[i][k];\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t_buffer2.default.dataBuffer.add(i, data[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// _addEffect(mesh, type) {\n\t\t// \tif(type == '\"Facade\"') {\n\t\t// \t\tmesh._sfStyle='Facade';\n\t\t// \t}\n\t\t// }\n\t\t//缓存了object的id\n\n\t}, {\n\t\tkey: \"_parseMesh\",\n\t\tvalue: function _parseMesh(resource, nodeInfo) {\n\t\t\tvar node = resource.node;\n\t\t\tvar url = resource.url;\n\t\t\tvar object = resource.object;\n\t\t\tvar isParsed = resource.isParsed;\n\t\t\tresource.loaded = true;\n\t\t\tvar unload = this._getUnLoadNode(node);\n\t\t\tif (unload.length === 0) return;\n\t\t\t// if(this.bufferTingObject.indexOf(object.id)!==-1){\n\t\t\t//     console.warn('name:'+object.name+'type:'+object.type+'已经下载过');\n\t\t\t//     return;\n\t\t\t// }else{\n\t\t\t//     this.bufferTingObject.push(object.id);\n\t\t\t// }\n\t\t\t//先删除替代的包围盒\n\t\t\tvar box = _buffer2.default.boxBuffer.get(object.uuid);\n\t\t\tif (box) {\n\t\t\t\tif (!this.debugBoundingBox) {\n\t\t\t\t\tbox.parent.remove(box);\n\t\t\t\t\t_buffer2.default.boxBuffer.delete(object.uuid);\n\t\t\t\t\tdelete object._bimBox;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// if(object._bimBox){\n\t\t\t//     if(!this.debugBoundingBox){\n\t\t\t//         object._bimBox.parent.remove(object._bimBox);\n\t\t\t//         delete object._bimBox;\n\t\t\t//     }\n\t\t\t//     else if(this.testDebugBox){\n\t\t\t//         object._bimBox.parent.remove(object._bimBox);\n\t\t\t//         delete object._bimBox;\n\t\t\t//     }\n\t\t\t// }\n\t\t\tvar meshArr = [];\n\t\t\tfor (var i = 0, len = unload.length; i < len; i++) {\n\t\t\t\tvar curNode = unload[i];\n\t\t\t\tvar bufferData = _buffer2.default.dataBuffer.get(url);\n\t\t\t\tif (object.type === 'CombinedObject' || object.type === 'Facade') {\n\t\t\t\t\tbufferData = this.wall;\n\t\t\t\t}\n\t\t\t\tvar mesh = _util2.default.createNode(object.type, curNode, bufferData, this.materialInfo, this.cache, isParsed, nodeInfo);\n\t\t\t\t//console.log(resource);\n\t\t\t\tthis.debugMesh.push(mesh);\n\t\t\t\tif (mesh) {\n\t\t\t\t\tmeshArr.push(mesh);\n\t\t\t\t\tcurNode.ready = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (meshArr.length > 1) {\n\t\t\t\tthis.ifcObjectManager.createThingObj(meshArr, object);\n\t\t\t} else if (meshArr.length === 0) {\n\t\t\t\tconsole.error('数据解析错误');\n\t\t\t} else {\n\t\t\t\tobject.node.add(meshArr[0]);\n\t\t\t}\n\t\t\t_util2.default.createSfStyle(object);\n\t\t\t// object.node.getMeshes().map(v=>{\n\t\t\t//\n\t\t\t// \tv._sfStyle = 'Facade';\n\t\t\t// \tconsole.log(v);\n\t\t\t// \t//this._addEffect(v, object.type);\n\t\t\t// });\n\t\t}\n\t}, {\n\t\tkey: \"_getUnLoadNode\",\n\t\tvalue: function _getUnLoadNode(node) {\n\t\t\tvar unload = [];\n\t\t\tnode.map(function (v) {\n\t\t\t\tif (!v.ready) {\n\t\t\t\t\tunload.push(v);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn unload;\n\t\t}\n\t}, {\n\t\tkey: \"startToBuild\",\n\t\tvalue: function startToBuild() {\n\t\t\tvar _this = this;\n\n\t\t\tvar progress = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function () {};\n\n\t\t\tthis.debugMesh.length = 0;\n\t\t\tvar result = this._parsePrepareLoading();\n\t\t\tif (result.length <= 0) {\n\t\t\t\tconsole.warn('本次下载的文件已经全部下载过，本次任务没有必要');\n\t\t\t\tprogress(1);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (var i = 0, len = result.length; i < len; i++) {\n\t\t\t\tvar id = result[i];\n\t\t\t\tvar resource = this.asyncLoadingConfig[id];\n\t\t\t\tthis.totalLoadTask++;\n\t\t\t\tthis.load(resource, id);\n\t\t\t}\n\n\t\t\tthis.progressCallbacks = this.progressCallbacks || [];\n\t\t\tthis.progressCallbacks.push(progress);\n\t\t\tif (!this._fn) {\n\t\t\t\tthis.eventManager.addEventListener('progress', function (ev) {\n\t\t\t\t\t_this.progressCallbacks.forEach(function (callback) {\n\t\t\t\t\t\tcallback(ev.progress);\n\t\t\t\t\t});\n\n\t\t\t\t\tif (ev.progress === 1) {\n\t\t\t\t\t\t_this.totalLoadTask = 0;\n\t\t\t\t\t\t_this.currentLoadTask = 0;\n\t\t\t\t\t\t_this.prepareLoading.length = 0;\n\n\t\t\t\t\t\t_this.progressCallbacks = [];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis._fn = true;\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: \"_parsePrepareLoading\",\n\t\tvalue: function _parsePrepareLoading() {\n\t\t\tvar prepareLoading = this.prepareLoading;\n\t\t\tvar result = [];\n\t\t\tif (prepareLoading.length <= 0) return [];\n\t\t\tfor (var i = 0, len = prepareLoading.length; i < len; i++) {\n\t\t\t\tvar currentId = prepareLoading[i];\n\t\t\t\tif (!currentId) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (this.bufferTingObject.indexOf(currentId) === -1) {\n\t\t\t\t\tresult.push(currentId);\n\t\t\t\t\tthis.bufferTingObject.push(currentId);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\t//每次load给一次进度吧\n\n\t}, {\n\t\tkey: \"load\",\n\t\tvalue: function load(resource, id) {\n\t\t\tvar urlArray = resource.url;\n\t\t\tvar pending = [];\n\t\t\tvar that = this;\n\t\t\tif (!Array.isArray(urlArray)) {\n\t\t\t\turlArray = [resource.url];\n\t\t\t}\n\t\t\tfor (var i = 0; i < urlArray.length; i++) {\n\t\t\t\tvar url = urlArray[i];\n\t\t\t\tvar _resource = that.asyncLoadingConfig[id];\n\t\t\t\tvar flag = null;\n\t\t\t\tif (_resource.object.type === 'CombinedObject' || _resource.object.type === 'Facade') {\n\t\t\t\t\tflag = 'wall';\n\t\t\t\t}\n\t\t\t\tvar promise = this.getMeshes(url, id, flag);\n\t\t\t\tpending.push(promise);\n\t\t\t}\n\t\t\treturn Promise.all(pending).then(function (arr) {\n\t\t\t\tarr.map(function (data) {\n\t\t\t\t\tvar resource = that.asyncLoadingConfig[data.id];\n\t\t\t\t\tthat._parseMesh(resource, that.nodeInfo);\n\t\t\t\t});\n\t\t\t\tthat.currentLoadTask++;\n\t\t\t\tthat.eventManager.dispatchEvent({ type: \"progress\", progress: that.currentLoadTask / that.totalLoadTask });\n\t\t\t\tPromise.resolve(id);\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: \"requestToBuild\",\n\t\tvalue: function requestToBuild(id) {\n\t\t\tthis.prepareLoading.push(id);\n\t\t}\n\t\t//TODO 是否要释放buffer和node上面的ready信息那，这个dispose不是特别理解，需要问问\n\n\t}, {\n\t\tkey: \"disposeObject\",\n\t\tvalue: function disposeObject(id) {\n\t\t\tvar index = this.prepareLoading.indexOf(id);\n\t\t\tif (index > -1) {\n\t\t\t\tthis.prepareLoading.splice(index, 1);\n\t\t\t}\n\t\t}\n\t}]);\n\n\treturn IFCParser;\n}();\n\nexports.IFCParser = IFCParser;\n\n//# sourceURL=webpack:///./src/IFCParser.js?")},"./src/Loader.js":
/*!***********************!*\
  !*** ./src/Loader.js ***!
  \***********************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval("\n\nvar _IFCParser = __webpack_require__(/*! ./IFCParser */ \"./src/IFCParser.js\");\n\nTHREE.IFCLoader = function () {\n    function IFCLoader(campus, manager) {\n        this.campus = campus;\n        this.manager = manager !== undefined ? manager : THREE.DefaultLoadingManager;\n        this.eventManager = new THREE.EventDispatcher();\n    }\n    IFCLoader.prototype = {\n        constructor: IFCLoader,\n        crossOrigin: 'anonymous',\n        type: '',\n        load: function load(url, onLoad, onProgress, onError) {\n            this.url = url;\n            var scope = this;\n            var resourcePath;\n            if (this.resourcePath !== undefined) {\n                resourcePath = this.resourcePath;\n            } else if (this.path !== undefined) {\n                resourcePath = this.path;\n            } else {\n                resourcePath = THREE.LoaderUtils.extractUrlBase(url);\n            }\n            resourcePath += 'index.json';\n            // Tells the LoadingManager to track an extra item, which resolves after\n            // the model is fully loaded. This means the count of items loaded will\n            // be incorrect, but ensures manager.onLoad() does not fire early.\n            scope.manager.itemStart(url);\n            var _onError = function _onError(e) {\n                if (onError) {\n                    onError(e);\n                } else {\n                    console.error(e);\n                }\n                scope.manager.itemError(url);\n                scope.manager.itemEnd(url);\n            };\n            var loader = new THREE.FileLoader(scope.manager);\n            loader.setPath(this.path);\n            loader.load(resourcePath, function (data) {\n                try {\n                    scope.parse(data, resourcePath, scope.type, scope.recursion, scope.campus, function (IFC) {\n                        onLoad(IFC);\n                        scope.manager.itemEnd(url);\n                    }, _onError);\n                } catch (e) {\n                    _onError(e);\n                }\n            }, undefined, _onError);\n            scope.eventManager.addEventListener('progress', function (ev) {\n                onProgress(ev.progress);\n            });\n        },\n        setCrossOrigin: function setCrossOrigin(value) {\n            this.crossOrigin = value;\n            return this;\n        },\n\n        setPath: function setPath(value) {\n            this.path = value;\n            return this;\n        },\n\n        setType: function setType(type) {\n            this.type = type;\n            return this;\n        },\n\n        setRecursion: function setRecursion(recursion) {\n            this.recursion = recursion;\n        },\n\n        setResourcePath: function setResourcePath(value) {\n            this.resourcePath = value;\n            return this;\n        },\n\n        parse: function parse(data, path, type, recursion, campus, onLoad, onError) {\n            var content;\n            var extensions = {};\n            content = data;\n            var json = JSON.parse(content);\n            //继续下载buffer,gdata,node,material文件，如果有一个下载失败则失败\n            var parser = new _IFCParser.IFCParser(json, type, recursion, campus, extensions, {\n                url: this.url || '',\n                crossOrigin: this.crossOrigin,\n                manager: this.manager,\n                eventManager: this.eventManager\n            });\n            this.parser = parser;\n            parser.parse(onLoad, onError);\n        },\n\n        requestToBuild: function requestToBuild(id) {\n            this.parser.requestToBuild(id);\n        },\n        startToBuild: function startToBuild(progress) {\n            this.parser.startToBuild(progress);\n        },\n        disposeObject: function disposeObject(id) {\n            this.parser.disposeObject(id);\n        },\n        setLoadingAll: function setLoadingAll() {\n            var flag = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n            this.parser.loadingAll = flag;\n        }\n    };\n    return IFCLoader;\n}(); /**\r\n      * @author zhgu ifcLoader version 1.0\r\n      */\n\n//# sourceURL=webpack:///./src/Loader.js?")},"./src/buffer.js":
/*!***********************!*\
  !*** ./src/buffer.js ***!
  \***********************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n/**\r\n * 构建IFC缓存\r\n * @param  {Object} param 参数列表\r\n *\r\n */\nexports.default = {\n    geometryBuffer: function () {\n        var buffer = {};\n        return {\n            get: function get(name) {\n                return buffer[name];\n            },\n            delete: function _delete(name) {\n                return delete buffer[name];\n            },\n            add: function add(name, obj) {\n                buffer[name] = obj;\n            },\n            getAll: function getAll() {\n                return buffer;\n            },\n            deleteAll: function deleteAll() {\n                buffer = {};\n            }\n        };\n    }(),\n    materialBuffer: function () {\n        var buffer = {};\n        return {\n            get: function get(name) {\n                return buffer[name];\n            },\n            delete: function _delete(name) {\n                return delete buffer[name];\n            },\n            add: function add(name, obj) {\n                buffer[name] = obj;\n            },\n            getAll: function getAll() {\n                return buffer;\n            },\n            deleteAll: function deleteAll() {\n                buffer = {};\n            }\n        };\n    }(),\n    meshBuffer: function () {\n        var buffer = {};\n        return {\n            get: function get(name) {\n                return buffer[name];\n            },\n            delete: function _delete(name) {\n                return delete buffer[name];\n            },\n            add: function add(name, obj) {\n                buffer[name] = obj;\n            },\n            getAll: function getAll() {\n                return buffer;\n            },\n            deleteAll: function deleteAll() {\n                buffer = {};\n            }\n        };\n    }(),\n    dataBuffer: function () {\n        var buffer = {};\n        return {\n            get: function get(name) {\n                return buffer[name];\n            },\n            delete: function _delete(name) {\n                return delete buffer[name];\n            },\n            add: function add(name, obj) {\n                buffer[name] = obj;\n            },\n            getAll: function getAll() {\n                return buffer;\n            },\n            deleteAll: function deleteAll() {\n                buffer = {};\n            }\n        };\n    }(),\n    boxBuffer: function () {\n        var buffer = {};\n        return {\n            get: function get(name) {\n                return buffer[name];\n            },\n            delete: function _delete(name) {\n                return delete buffer[name];\n            },\n            add: function add(name, obj) {\n                buffer[name] = obj;\n            },\n            getAll: function getAll() {\n                return buffer;\n            },\n            deleteAll: function deleteAll() {\n                buffer = {};\n            }\n        };\n    }(),\n    fileBuffer: function () {\n        var buffer = {};\n        return {\n            get: function get(name) {\n                return buffer[name];\n            },\n            delete: function _delete(name) {\n                return delete buffer[name];\n            },\n            add: function add(name, obj) {\n                buffer[name] = obj;\n            },\n            getAll: function getAll() {\n                return buffer;\n            },\n            deleteAll: function deleteAll() {\n                buffer = {};\n            }\n        };\n    }(),\n    instancedBuffer: function () {\n        var objects = {};\n        return {\n            get: function get(key) {\n                var res = [];\n                for (var i in objects) {\n                    if (i.indexOf(key + ':') !== -1) {\n                        res.push(objects[i]);\n                    }\n                }\n                return res;\n            },\n            getLength: function getLength() {\n                var len = 0;\n                for (var i in objects) {\n                    var obj = objects[i];\n                    len += obj.length;\n                }\n                return len;\n            },\n            add: function add(key, object) {\n                if (!(objects[key] instanceof Array)) {\n                    objects[key] = [];\n                    objects[key].push(object);\n                } else {\n                    objects[key].push(object);\n                }\n            },\n            remove: function remove(key) {\n                delete objects[key];\n            },\n            removeAll: function removeAll() {\n                objects = {};\n            },\n            getAll: function getAll() {\n                return objects;\n            }\n        };\n    }()\n};\n\n//# sourceURL=webpack:///./src/buffer.js?")},"./src/defaultObjectStrategy.js":
/*!**************************************!*\
  !*** ./src/defaultObjectStrategy.js ***!
  \**************************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _strategy = __webpack_require__(/*! ./strategy */ \"./src/strategy.js\");\n\nvar _strategy2 = _interopRequireDefault(_strategy);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\r\n * 构造函数\r\n * @param  默认的thingjs物体加载策略:null为不处理、merge为合并策略、instance为instanceDraw策略\r\n * 注意室外尽量不要使用instance类型。因为instance会导致包围盒错误，室内尽量优先使用instance策略\r\n *\r\n */\nexports.default = {\n  'Campus': _strategy2.default.merge,\n  'Building': _strategy2.default.merge,\n  'Floor': _strategy2.default.merge,\n  'Wall': _strategy2.default.merge,\n  'Thing': _strategy2.default.none,\n  'Stair': _strategy2.default.merge,\n  'Door': _strategy2.default.merge\n};\n\n//# sourceURL=webpack:///./src/defaultObjectStrategy.js?")},"./src/main.js":
/*!*********************!*\
  !*** ./src/main.js ***!
  \*********************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\n\n__webpack_require__(/*! ./Loader */ "./src/Loader.js");\n\n//# sourceURL=webpack:///./src/main.js?')},"./src/strategy.js":
/*!*************************!*\
  !*** ./src/strategy.js ***!
  \*************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\n\nObject.defineProperty(exports, "__esModule", {\n  value: true\n});\n/**\r\n * 物体处理策略\r\n * @param  {Object} param 参数列表\r\n *\r\n */\nexports.default = {\n  none: 1,\n  merge: 2,\n  instance: 3\n};\n\n//# sourceURL=webpack:///./src/strategy.js?')},"./src/thingObject.js":
/*!****************************!*\
  !*** ./src/thingObject.js ***!
  \****************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\n\nObject.defineProperty(exports, "__esModule", {\n    value: true\n});\n/**\r\n * 构造函数\r\n * @param  thingjs与bim对象的对应关系表，请在这里更改\r\n *\r\n */\nexports.default = {\n    "IfcSite": \'Campus\', //园区\n    "IfcBuilding": \'Building\', //楼\n    "IfcBuildingStorey": \'Floor\', //楼层\n    "IfcWall": \'Wall\',\n    "IfcBuildingElementProxy": \'Thing\',\n    "IfcRamp": \'Thing\',\n    "IfcStair": \'Stair\',\n    "IfcDoor": \'Door\',\n    "IfcSlab": \'Wall\',\n    "IfcRoof": \'Wall\',\n    //"IfcFlowTerminal": \'Thing\',\n    "IfcFurnishingElement": \'Thing\',\n    "IfcWallStandardCase": \'Wall\',\n    "IfcCurtainWall": \'Wall\',\n    "IfcWindow": \'Wall\'\n};\n\n//# sourceURL=webpack:///./src/thingObject.js?')},"./src/util.js":
/*!*********************!*\
  !*** ./src/util.js ***!
  \*********************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _thingObject = __webpack_require__(/*! ./thingObject */ \"./src/thingObject.js\");\n\nvar _thingObject2 = _interopRequireDefault(_thingObject);\n\nvar _buffer = __webpack_require__(/*! ./buffer */ \"./src/buffer.js\");\n\nvar _buffer2 = _interopRequireDefault(_buffer);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\r\n * 构造函数\r\n * @param  IFC工具类\r\n *\r\n */\nexports.default = {\n    renderObject: _thingObject2.default,\n    userThingObject: ['Campus', 'Building', 'Floor', 'Wall', 'Thing', 'Stair', 'Door', 'Room'],\n    defaultMaterial: new THREE.MeshStandardMaterial({ side: THREE.DoubleSide, color: new THREE.Color(1, 1, 1), transparent: false }),\n    defaultLineMaterial: new THREE.MeshBasicMaterial({ color: new THREE.Color(0, 0, 0) }),\n    defaultBoxMaterial: new THREE.MeshBasicMaterial({ depthTest: false, transparent: true, opacity: 0.5 }),\n    convertToFloat32Array: function convertToFloat32Array(vertices) {\n        var newVertices = new Float32Array(vertices.length);\n        for (var i = 0; i < vertices.length; i++) {\n            newVertices[i] = vertices[i];\n        }\n        return newVertices;\n    },\n    convertToArrayBuffer: function convertToArrayBuffer(data) {\n        var isBase64 = true;\n        data = decodeURIComponent(data);\n\n        if (isBase64) data = atob(data);\n\n        try {\n            var response;\n            var view = new Uint8Array(data.length);\n            for (var i = 0; i < data.length; i++) {\n                view[i] = data.charCodeAt(i);\n            }\n            response = view.buffer;\n            return response;\n        } catch (e) {\n            console.log(e);\n            return null;\n        }\n    },\n    //TODO 暂不解析\n    parseObjectPlacement: function (_parseObjectPlacement) {\n        function parseObjectPlacement(_x, _x2) {\n            return _parseObjectPlacement.apply(this, arguments);\n        }\n\n        parseObjectPlacement.toString = function () {\n            return _parseObjectPlacement.toString();\n        };\n\n        return parseObjectPlacement;\n    }(function (resId, placement) {\n        var res = placement[resId];\n        if (!res._rRelativePlacement) {\n            var result = {};\n            if (res._rLocation) {\n                var locationId = res._rLocation._i;\n                result.location = placement[locationId].Coordinates;\n            }\n            if (res._rAxis) {\n                var rAxisId = res._rAxis._i;\n                result.axis = placement[rAxisId].DirectionRatios;\n            }\n            if (res._rRefDirection) {\n                var directionId = res._rRefDirection._i;\n                result.direction = placement[directionId].DirectionRatios;\n            }\n            return result;\n        } else {\n            resId = placement[resId]._rRelativePlacement._i;\n            return parseObjectPlacement(resId, placement);\n        }\n    }),\n    /**\r\n     * 创建材质通用接口\r\n     * **/\n    createMaterial: function createMaterial(ml, material, materialCache) {\n        var mat = materialCache.get(ml);\n        if (!mat) {\n            var materialInfo = material[ml];\n            //TODO 这里材质数据可能不全\n            if (!materialInfo) {\n                console.log(ml + '数据查找不到');\n                return;\n            }\n            var type = materialInfo.type || 'MeshStandardMaterial';\n            var parameters = materialInfo.parameters;\n            //TODO 目前先不处理自发光\n            var color0 = parameters.color[0] * parameters.ambient[0] + parameters.emissive[0];\n            var color1 = parameters.color[1] * parameters.ambient[1] + parameters.emissive[1];\n            var color2 = parameters.color[2] * parameters.ambient[2] + parameters.emissive[2];\n            color0 = color0 >= 1.0 ? 1.0 : color0;\n            color1 = color1 >= 1.0 ? 1.0 : color1;\n            color2 = color2 >= 1.0 ? 1.0 : color2;\n            //ambient: new THREE.Color(parameters.ambient[0], parameters.ambient[1], parameters.ambient[2]),\n            mat = new THREE[type]({\n                color: new THREE.Color(color0, color1, color2),\n                side: parameters.side, //parameters.side,\n                opacity: parameters.transparency,\n                // wireframe: true,\n                // specular: new THREE.Color(parameters.ambient[0], parameters.ambient[1], parameters.ambient[2]),\n                // shininess: parameters.shininess||30,\n                // specular: new THREE.Color(parameters.specular[0], parameters.specular[1], parameters.specular[2]),\n                // emissive: new THREE.Color(parameters.emissive[0], parameters.emissive[1], parameters.emissive[2]),\n                transparent: true\n            });\n            materialCache.add(ml, mat);\n        }\n        return mat;\n    },\n    /**\r\n     * TODO 这里可能还要优化一下groups的情况，不然还是容易出问题\r\n     * 更新下cache中geometry的数据结构\r\n     *  geoObj = {\r\n     *      geometry:geometry,\r\n     *      line:geometry\r\n     *  }\r\n     * **/\n    createMesh: function createMesh(g, buffer, material, cache) {\n        var mo = null;\n        if (g.mo !== undefined) {\n            mo = Array.from(g.mo);\n        }\n        if (!buffer) return null;\n        var bufferMap = buffer[g.g];\n        if (!bufferMap) return null;\n        var materialCache = cache.materialBuffer;\n        var geometryCache = cache.geometryBuffer;\n        var geoObj = geometryCache.get(g.g);\n        var geometryList = [];\n        var renderMaterialList = [];\n        var eMatcolor;\n        var mat = [];\n        var renderMaterial;\n        if (g.m !== undefined) {\n            for (var i = 0; i < g.m.length; i++) {\n                mat.push(this.createMaterial(g.m[i], material, materialCache));\n            }\n        }\n        if (bufferMap) {\n            if (bufferMap.ii.length > 100000) {\n                console.warn(g.n + ':\\u9876\\u70B9:' + bufferMap.ii.length);\n            }\n            //解析ecolor，如果没有mat，则使用ecolor\n            /*\r\n            var ecolor = cGeometryInfo.c;\r\n            if (ecolor) {\r\n                eMatcolor = ecolor;\r\n            }*/\n            if (!geoObj) {\n                geoObj = {\n                    geometry: null,\n                    line: null\n                };\n                var geometry = new THREE.BufferGeometry();\n                /*geometry = new THREE.InstancedBufferGeometry();\r\n                   //暂时不解析color，因为太多了\r\n                  if(!isMaterial && colorId && buffer[colorId] instanceof Array){\r\n                     geometry.addAttribute('color', new THREE.Float32BufferAttribute(buffer[colorId],4));\r\n                      useColor = true;\r\n                }*/\n\n                geometry.addAttribute('position', new THREE.BufferAttribute(bufferMap.iv, 3));\n                geometry.addAttribute('normal', new THREE.BufferAttribute(bufferMap.in, 3));\n                geometry.setIndex(new THREE.BufferAttribute(bufferMap.ii, 1));\n                //geometry.clearGroups();\n\n                if (mo) {\n                    mo.push(bufferMap.ii.length);\n                    for (var _i = 0; _i < mo.length - 1; _i++) {\n                        geometry.addGroup(mo[_i], mo[_i + 1] - mo[_i], _i);\n                        renderMaterialList.push(mat[_i]);\n                    }\n                }\n\n                geoObj.geometry = geometry;\n\n                //解析线框\n                if (bufferMap.iw) {\n                    var lineGeometry = new THREE.BufferGeometry();\n                    lineGeometry.setIndex(new THREE.BufferAttribute(bufferMap.iw, 1));\n                    lineGeometry.addAttribute('position', new THREE.BufferAttribute(bufferMap.iv, 3));\n                    geoObj.line = lineGeometry;\n                }\n            }\n\n            //TODO 未解析material\n            if (mat.length) {\n                renderMaterial = mat[mat.length - 1];\n            } else {\n                if (!eMatcolor) {\n                    eMatcolor = { x: 1.0, y: 1.0, z: 1.0, w: 1.0 };\n                }\n                var defaultMaterialName = this.getDefaultMaterialName(eMatcolor);\n                renderMaterial = materialCache.get(defaultMaterialName);\n                if (!renderMaterial) {\n                    renderMaterial = defaultMaterial.clone();\n                    renderMaterial.color = new THREE.Color(eMatcolor.x, eMatcolor.y, eMatcolor.z);\n                    if (eMatcolor.w < 1.0) {\n                        renderMaterial.opacity = eMatcolor.w;\n                        renderMaterial.transparent = true;\n                    }\n                    materialCache.add(defaultMaterialName, renderMaterial);\n                }\n            }\n            if (renderMaterialList.length === 0) {\n                renderMaterialList.push(renderMaterial);\n            }\n            var mesh = null;\n            if (renderMaterialList.length === 1) {\n                mesh = new THREE.Mesh(geoObj.geometry, renderMaterialList[0]);\n            } else {\n                mesh = new THREE.Mesh(geoObj.geometry, renderMaterialList);\n            }\n            if (geoObj.line) {\n                var line = new THREE.LineSegments(geoObj.line, this.defaultLineMaterial);\n                mesh.add(line);\n                mesh._line = line;\n            }\n            return mesh;\n        }\n    },\n\n    //TODO 为解析bim的data\n    createParsedNode: function createParsedNode(type, n, buffer, material, cache) {\n        var mesh = null;\n        if (!n) {\n            return null;\n        }\n        if (n.g !== undefined) {\n            mesh = this.createMesh(n, buffer, material, cache);\n            if (!mesh) return null;\n            //mesh.name = curNode;\n            mesh._thingType = type;\n            //mesh.bimData = data;\n            if (n.tf) {\n                var transMatrix = n.tf; //创建的group身上\n                var matrix = new THREE.Matrix4();\n                //transMatrix[12] /= 1000;\n                //transMatrix[13] /= 1000;\n                //transMatrix[14] /= 1000;\n                matrix.fromArray(transMatrix);\n                mesh.applyMatrix(matrix);\n            }\n        }\n        return mesh;\n    },\n    createNode: function createNode(type, n, buffer, material, cache, isParsed, nodeInfo) {\n        if (isParsed) {\n            return this.createParsedNode(type, n, buffer, material, cache);\n        } else {\n            if (!n.id) {\n                return null;\n            } else {\n                if (n.id) {\n                    var node = nodeInfo[n.id];\n                    var root = this.createParsedNode(type, node, buffer, material, cache);\n                    if (!root) {\n                        //如果没有物体则创建空节点,后续不在处理id的情况\n                        root = new THREE.Object3D();\n                    }\n                    this.createUnParsedNode(type, n, buffer, material, cache, isParsed, nodeInfo, root);\n                    return root;\n                } else {\n                    console.warn('该数据存在问题，请认真检查一下');\n                    return null;\n                }\n            }\n        }\n    },\n\n    //广度优先遍历\n    createUnParsedNode: function createUnParsedNode(type, n, buffer, material, cache, isParsed, nodeInfo, root) {\n        var children = n.c;\n        for (var i in children) {\n            var node = nodeInfo[i];\n            var mesh = this.createParsedNode(type, node, buffer, material, cache, isParsed, nodeInfo);\n            if (!mesh) {\n                mesh = new THREE.Object3D();\n            }\n            root.add(mesh);\n            this.createUnParsedNode(type, children[i], buffer, material, cache, isParsed, nodeInfo, mesh);\n        }\n    },\n\n    /**\r\n     * 获取材质id\r\n     * **/\n    getMaterialId: function getMaterialId(mat) {\n        var id = '';\n        if (Array.isArray(mat)) {\n            for (var i = 0, len = mat.length; i < len; i++) {\n                id += mat[i].uuid + '_';\n            }\n        } else {\n            id = mat.uuid;\n        }\n        return id;\n    },\n    /**\r\n     * 克隆材质接口\r\n     * **/\n    cloneMaterial: function cloneMaterial(mat) {\n        var res = void 0;\n        if (Array.isArray(mat)) {\n            res = [];\n            for (var i = 0, len = mat.length; i < len; i++) {\n                res.push(mat[i].clone());\n            }\n        } else {\n            res = mat.clone();\n        }\n        return res;\n    },\n\n    getSFStyle: function getSFStyle(data) {\n        var renderObject = this.renderObject;\n        var rv = 'Thing';\n        if (renderObject[data.t]) {\n            rv = renderObject[data.t];\n        }\n        /*\r\n        if(data.n.indexOf('机柜') !== -1) {\r\n            rv = 'cabinet';\r\n            //console.log(rv);\r\n        } else if(data.n.indexOf('服务器') !== -1 ||\r\n                    data.n.indexOf('交换机') !== -1 ||\r\n                    data.n.indexOf('Server') !== -1 ||\r\n                    data.n.indexOf('录像机') !== -1) {\r\n            rv = 'rack';\r\n            //console.log(rv);\r\n        }*/\n        return rv;\n    },\n\n    isRenderObject: function isRenderObject(node) {\n        var thingType = 'Wall';\n        var renderObject = this.renderObject;\n        for (var i in renderObject) {\n            if (node.t === i) {\n                return renderObject[i];\n            }\n        }\n        //如果没找到默认的对应类型就去找t1\n        var userThingObject = this.userThingObject;\n        if (node.t1) {\n            var t1 = node.t1;\n            if (userThingObject.indexOf(t1) !== -1) {\n                thingType = t1;\n            } else {\n                thingType = 'Thing';\n            }\n        }\n        return thingType;\n    },\n\n    getDefaultMaterialName: function getDefaultMaterialName(eMatcolor) {\n        return 'default_' + eMatcolor.x + '_' + eMatcolor.y + '_' + eMatcolor.z + '_' + eMatcolor.w;\n    },\n    //创建一个具有动态加载信息的盒子x\n    createBox: function createBox(size, thingObj) {\n        var colorWrite = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n        var positon = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : [0, 0, 0];\n\n        if (!size) return;\n        var boxGeometry = new THREE.BoxBufferGeometry(size[0], size[1], size[2]);\n        var material = this.defaultBoxMaterial;\n        // if(colorWrite){\n        //     this.defaultBoxMaterial.colorWrite = true;\n        // }\n        if (colorWrite) {\n            this.defaultBoxMaterial.visible = true;\n        } else {\n            this.defaultBoxMaterial.visible = false;\n        }\n        var cube = new THREE.Mesh(boxGeometry, material);\n        cube.position.set(positon[0], positon[1], positon[2]);\n        _buffer2.default.boxBuffer.add(thingObj.uuid, cube);\n        //跳过勾边和一件科幻\n        cube.userData['skipOutline'] = true;\n        cube.userData['skipStyle'] = true;\n        thingObj.node.add(cube);\n        thingObj._bimBox = cube;\n    },\n    /**打上科幻标签的方法\r\n     * 可以通过类型和userData进行标识\r\n     * **/\n    createSfStyle: function createSfStyle(object) {\n        var type = object.type;\n        var userData = object.userData;\n        if (userData && userData.effectTag) {\n            type = userData.effectTag;\n        }\n        object.node.getMeshes().map(function (v) {\n            //合并物体一般为floor的wall\n            if (type === 'CombinedObject') {\n                v._sfStyle = 'Floor';\n            } else {\n                v._sfStyle = type;\n            }\n        });\n    }\n};\n\n//# sourceURL=webpack:///./src/util.js?")},"./src/workers/MergeBufferGeometryUtils.js":
/*!*************************************************!*\
  !*** ./src/workers/MergeBufferGeometryUtils.js ***!
  \*************************************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval("\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * changed by zhgu\r\n */\n\nTHREE.MergeBufferGeometryUtils = {\n\n            computeTangents: function computeTangents(geometry) {\n\n                        var index = geometry.index;\n                        var attributes = geometry.attributes;\n\n                        // based on http://www.terathon.com/code/tangent.html\n                        // (per vertex tangents)\n\n                        if (index === null || attributes.position === undefined || attributes.normal === undefined || attributes.uv === undefined) {\n\n                                    console.warn('THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()');\n                                    return;\n                        }\n\n                        var indices = index.array;\n                        var positions = attributes.position.array;\n                        var normals = attributes.normal.array;\n                        var uvs = attributes.uv.array;\n\n                        var nVertices = positions.length / 3;\n\n                        if (attributes.tangent === undefined) {\n\n                                    geometry.addAttribute('tangent', new THREE.BufferAttribute(new Float32Array(4 * nVertices), 4));\n                        }\n\n                        var tangents = attributes.tangent.array;\n\n                        var tan1 = [],\n                            tan2 = [];\n\n                        for (var i = 0; i < nVertices; i++) {\n\n                                    tan1[i] = new THREE.Vector3();\n                                    tan2[i] = new THREE.Vector3();\n                        }\n\n                        var vA = new THREE.Vector3(),\n                            vB = new THREE.Vector3(),\n                            vC = new THREE.Vector3(),\n                            uvA = new THREE.Vector2(),\n                            uvB = new THREE.Vector2(),\n                            uvC = new THREE.Vector2(),\n                            sdir = new THREE.Vector3(),\n                            tdir = new THREE.Vector3();\n\n                        function handleTriangle(a, b, c) {\n\n                                    vA.fromArray(positions, a * 3);\n                                    vB.fromArray(positions, b * 3);\n                                    vC.fromArray(positions, c * 3);\n\n                                    uvA.fromArray(uvs, a * 2);\n                                    uvB.fromArray(uvs, b * 2);\n                                    uvC.fromArray(uvs, c * 2);\n\n                                    var x1 = vB.x - vA.x;\n                                    var x2 = vC.x - vA.x;\n\n                                    var y1 = vB.y - vA.y;\n                                    var y2 = vC.y - vA.y;\n\n                                    var z1 = vB.z - vA.z;\n                                    var z2 = vC.z - vA.z;\n\n                                    var s1 = uvB.x - uvA.x;\n                                    var s2 = uvC.x - uvA.x;\n\n                                    var t1 = uvB.y - uvA.y;\n                                    var t2 = uvC.y - uvA.y;\n\n                                    var r = 1.0 / (s1 * t2 - s2 * t1);\n\n                                    sdir.set((t2 * x1 - t1 * x2) * r, (t2 * y1 - t1 * y2) * r, (t2 * z1 - t1 * z2) * r);\n\n                                    tdir.set((s1 * x2 - s2 * x1) * r, (s1 * y2 - s2 * y1) * r, (s1 * z2 - s2 * z1) * r);\n\n                                    tan1[a].add(sdir);\n                                    tan1[b].add(sdir);\n                                    tan1[c].add(sdir);\n\n                                    tan2[a].add(tdir);\n                                    tan2[b].add(tdir);\n                                    tan2[c].add(tdir);\n                        }\n\n                        var groups = geometry.groups;\n\n                        if (groups.length === 0) {\n\n                                    groups = [{\n                                                start: 0,\n                                                count: indices.length\n                                    }];\n                        }\n\n                        for (var i = 0, il = groups.length; i < il; ++i) {\n\n                                    var group = groups[i];\n\n                                    var start = group.start;\n                                    var count = group.count;\n\n                                    for (var j = start, jl = start + count; j < jl; j += 3) {\n\n                                                handleTriangle(indices[j + 0], indices[j + 1], indices[j + 2]);\n                                    }\n                        }\n\n                        var tmp = new THREE.Vector3(),\n                            tmp2 = new THREE.Vector3();\n                        var n = new THREE.Vector3(),\n                            n2 = new THREE.Vector3();\n                        var w, t, test;\n\n                        function handleVertex(v) {\n\n                                    n.fromArray(normals, v * 3);\n                                    n2.copy(n);\n\n                                    t = tan1[v];\n\n                                    // Gram-Schmidt orthogonalize\n\n                                    tmp.copy(t);\n                                    tmp.sub(n.multiplyScalar(n.dot(t))).normalize();\n\n                                    // Calculate handedness\n\n                                    tmp2.crossVectors(n2, t);\n                                    test = tmp2.dot(tan2[v]);\n                                    w = test < 0.0 ? -1.0 : 1.0;\n\n                                    tangents[v * 4] = tmp.x;\n                                    tangents[v * 4 + 1] = tmp.y;\n                                    tangents[v * 4 + 2] = tmp.z;\n                                    tangents[v * 4 + 3] = w;\n                        }\n\n                        for (var i = 0, il = groups.length; i < il; ++i) {\n\n                                    var group = groups[i];\n\n                                    var start = group.start;\n                                    var count = group.count;\n\n                                    for (var j = start, jl = start + count; j < jl; j += 3) {\n\n                                                handleVertex(indices[j + 0]);\n                                                handleVertex(indices[j + 1]);\n                                                handleVertex(indices[j + 2]);\n                                    }\n                        }\n            },\n\n            /**\r\n             * @param  {Array<THREE.BufferGeometry>} geometries\r\n             * @param  {Boolean} useGroups\r\n             * maxCount 最大顶点数量默认 50000 added by zhgu\r\n             * @return {THREE.BufferGeometry}\r\n             */\n            mergeBufferGeometries1: function mergeBufferGeometries1(geometries, maxCount, useGroups) {\n                        if (maxCount === null) {\n                                    maxCount = Infinity;\n                        }\n                        maxCount = maxCount || 50000;\n                        // maxCount *= 3;\n                        var curCount = 0;\n                        var index = 0;\n                        var resultGeo = [[]];\n                        for (var i = 0; i < geometries.length; i++) {\n                                    var geometry = geometries[i];\n                                    if (geometry.attributes.position) {\n                                                var positionCount = geometry.attributes.position.count;\n                                                curCount += positionCount;\n                                                if (curCount < maxCount) {\n                                                            if (!(resultGeo[index] instanceof Array)) {\n                                                                        resultGeo[index] = [];\n                                                            }\n                                                            resultGeo[index].push(geometry);\n                                                } else {\n                                                            curCount = 0;\n                                                            if (!(resultGeo[index] instanceof Array)) {\n                                                                        resultGeo[index] = [];\n                                                            }\n                                                            resultGeo[index].push(geometry);\n                                                            index++;\n                                                }\n                                    } else {\n                                                console.warn('该geometry' + geometry.id + '无position，请检查是否存在问题');\n                                    }\n                        }\n                        var mergedResult = [];\n                        for (var k = 0; k < resultGeo.length; k++) {\n                                    var mergedGeometry = this.mergeBufferGeometries(resultGeo[k], useGroups);\n                                    //继续合并groups\n                                    if (useGroups) {\n                                                this.mergeGroups(mergedGeometry);\n                                    }\n                                    mergedResult.push(mergedGeometry);\n                        }\n                        return mergedResult;\n            },\n            /**\r\n             * @param  {Array<THREE.BufferGeometry>} geometries\r\n             * @param  {Boolean} useGroups\r\n             * maxCount 最大顶点数量默认 50000 added by zhgu\r\n             * @return {THREE.BufferGeometry}\r\n             */\n            mergeBufferGeometries: function mergeBufferGeometries(geometries, useGroups) {\n\n                        var isIndexed = geometries[0].index !== null;\n\n                        var attributesUsed = new Set(Object.keys(geometries[0].attributes));\n                        var morphAttributesUsed = new Set(Object.keys(geometries[0].morphAttributes));\n\n                        var attributes = {};\n                        var morphAttributes = {};\n\n                        var mergedGeometry = new THREE.BufferGeometry();\n\n                        var offset = 0;\n\n                        for (var i = 0; i < geometries.length; ++i) {\n\n                                    var geometry = geometries[i];\n\n                                    // ensure that all geometries are indexed, or none\n\n                                    if (isIndexed !== (geometry.index !== null)) return null;\n\n                                    // gather attributes, exit early if they're different\n\n                                    for (var name in geometry.attributes) {\n\n                                                if (!attributesUsed.has(name)) return null;\n\n                                                if (attributes[name] === undefined) attributes[name] = [];\n\n                                                attributes[name].push(geometry.attributes[name]);\n                                    }\n\n                                    // gather morph attributes, exit early if they're different\n\n                                    for (var name in geometry.morphAttributes) {\n\n                                                if (!morphAttributesUsed.has(name)) return null;\n\n                                                if (morphAttributes[name] === undefined) morphAttributes[name] = [];\n\n                                                morphAttributes[name].push(geometry.morphAttributes[name]);\n                                    }\n\n                                    // gather .userData\n\n                                    mergedGeometry.userData.mergedUserData = mergedGeometry.userData.mergedUserData || [];\n                                    mergedGeometry.userData.mergedUserData.push(geometry.userData);\n\n                                    if (useGroups) {\n\n                                                var count;\n\n                                                if (isIndexed) {\n\n                                                            count = geometry.index.count;\n                                                } else if (geometry.attributes.position !== undefined) {\n\n                                                            count = geometry.attributes.position.count;\n                                                } else {\n\n                                                            return null;\n                                                }\n\n                                                // mergedGeometry.addGroup( offset, count, i );\n                                                //changed by zhgu\n                                                if (geometry.groups) {\n                                                            geometry.groups.map(function (v) {\n                                                                        var start = v.start;\n                                                                        var nums = v.count;\n                                                                        var materialIndex = v.materialIndex;\n                                                                        mergedGeometry.addGroup(offset + start, nums, materialIndex);\n                                                            });\n                                                }\n                                                offset += count;\n                                    }\n\n                                    //needMerge\n                                    if (geometry._needMerge) {\n                                                for (var key in geometry._needMerge) {\n                                                            if (!mergedGeometry._needMerge) {\n                                                                        mergedGeometry._needMerge = {};\n                                                            }\n                                                            if (!mergedGeometry._needMerge[key]) {\n                                                                        mergedGeometry._needMerge[key] = [];\n                                                            }\n                                                            mergedGeometry._needMerge[key].push(geometry._needMerge[key]);\n                                                }\n                                    }\n                        }\n\n                        // merge indices\n\n                        if (isIndexed) {\n\n                                    var indexOffset = 0;\n                                    var mergedIndex = [];\n\n                                    for (var i = 0; i < geometries.length; ++i) {\n\n                                                var index = geometries[i].index;\n\n                                                for (var j = 0; j < index.count; ++j) {\n\n                                                            mergedIndex.push(index.getX(j) + indexOffset);\n                                                }\n\n                                                indexOffset += geometries[i].attributes.position.count;\n                                    }\n\n                                    mergedGeometry.setIndex(mergedIndex);\n                        }\n\n                        // merge attributes\n\n                        for (var name in attributes) {\n\n                                    var mergedAttribute = this.mergeBufferAttributes(attributes[name]);\n\n                                    if (!mergedAttribute) return null;\n\n                                    mergedGeometry.addAttribute(name, mergedAttribute);\n                        }\n\n                        // merge morph attributes\n\n                        for (var name in morphAttributes) {\n\n                                    var numMorphTargets = morphAttributes[name][0].length;\n\n                                    if (numMorphTargets === 0) break;\n\n                                    mergedGeometry.morphAttributes = mergedGeometry.morphAttributes || {};\n                                    mergedGeometry.morphAttributes[name] = [];\n\n                                    for (var i = 0; i < numMorphTargets; ++i) {\n\n                                                var morphAttributesToMerge = [];\n\n                                                for (var j = 0; j < morphAttributes[name].length; ++j) {\n\n                                                            morphAttributesToMerge.push(morphAttributes[name][j][i]);\n                                                }\n\n                                                var mergedMorphAttribute = this.mergeBufferAttributes(morphAttributesToMerge);\n\n                                                if (!mergedMorphAttribute) return null;\n\n                                                mergedGeometry.morphAttributes[name].push(mergedMorphAttribute);\n                                    }\n                        }\n\n                        return mergedGeometry;\n            },\n\n            /**\r\n             *@author zhuguang <zhuguang@uinnova.com>\r\n             *@descripition 为了极限增加性能，需要对geometry的groups进行二次merge\r\n             *@type {String}\r\n             */\n            mergeGroups: function mergeGroups(geometry) {\n                        var groups = geometry.groups;\n                        var indexArr = {};\n                        //目前只考虑attribute的合并\n                        //收集index\n                        for (var i = 0, len = groups.length; i < len; i++) {\n                                    var group = groups[i];\n                                    var materialIndex = group.materialIndex;\n                                    if (!indexArr[materialIndex]) {\n                                                indexArr[materialIndex] = [];\n                                    }\n                                    indexArr[materialIndex].push(group);\n                        }\n                        var index = geometry.index;\n                        if (index) {\n                                    geometry.setIndex(new THREE.BufferAttribute(this._recombinationArr(geometry, 'index', indexArr, true), 1));\n                        } else {\n                                    //遍历attribute\n                                    for (var name in geometry.attributes) {\n                                                //var attr = geometry.attributes(name);\n                                                if (name.indexOf('position') !== -1) {\n                                                            geometry.addAttribute('position', new THREE.BufferAttribute(this._recombinationArr(geometry, name, indexArr, true), 3));\n                                                } else if (name.indexOf('uv') !== -1) {\n                                                            geometry.addAttribute(name, new THREE.BufferAttribute(this._recombinationArr(geometry, name, indexArr), 2));\n                                                } else if (name.indexOf('normal') !== -1) {\n                                                            geometry.addAttribute(name, new THREE.BufferAttribute(this._recombinationArr(geometry, name, indexArr), 3));\n                                                } else if (name.indexOf('id') !== -1) {\n                                                            geometry.addAttribute(name, new THREE.BufferAttribute(this._recombinationArr(geometry, name, indexArr), 1));\n                                                }\n                                    }\n                        }\n            },\n            _recombinationArr: function _recombinationArr(geometry, name, indexArr, updateGroups) {\n                        var attribute;\n                        var isIndex = false;\n                        var res;\n                        if (name === 'index') {\n                                    attribute = geometry.index;\n                                    isIndex = true;\n                        } else {\n                                    attribute = geometry.attributes[name];\n                        }\n                        var arr = attribute.array;\n                        // if(isIndex){\n                        //     res = new Uint16Array(arr.length);\n                        // }else{\n                        //     res = new Float32Array(arr.length);\n                        // }\n                        res = this._getArrayType(arr);\n\n                        var IndexMap = {};\n                        var resIndex = 0;\n                        // arr = arr.join(',');\n                        var interval = attribute.itemSize;\n                        for (var k in indexArr) {\n                                    IndexMap[k] = { start: resIndex / interval };\n                                    var index = indexArr[k];\n                                    var end = 0;\n                                    for (var i = 0, len = index.length; i < len; i++) {\n                                                var group = index[i];\n                                                var start = group.start * interval;\n                                                var size = group.count * interval;\n                                                this._getNewArrayFromArr(res, resIndex, arr, start, size);\n                                                resIndex += size;\n                                                end += size;\n                                    }\n                                    IndexMap[k].count = end / interval;\n                        }\n                        //处理groups,先清空\n                        if (updateGroups) {\n                                    geometry.groups = [];\n                                    for (var nums in IndexMap) {\n                                                var indexMap0 = IndexMap[nums];\n                                                geometry.addGroup(indexMap0.start, indexMap0.count, parseInt(nums));\n                                    }\n                        }\n\n                        return res;\n                        //\n                        // for(var t in res){\n                        //     final = final.concat(res[t]);\n                        // }\n                        //\n                        // return final;\n            },\n\n            _getArrayType: function _getArrayType(arr) {\n                        var result = arr.map(function (v) {\n                                    return 0;\n                        });\n                        return result;\n            },\n\n            _getNewArrayFromArr: function _getNewArrayFromArr(res, resIndex, arr, start, count) {\n                        for (var i = start; i < start + count; i++) {\n                                    res[resIndex] = arr[i];\n                                    resIndex++;\n                        }\n            },\n\n            /**\r\n             * @param {Array<THREE.BufferAttribute>} attributes\r\n             * @return {THREE.BufferAttribute}\r\n             */\n            mergeBufferAttributes: function mergeBufferAttributes(attributes) {\n\n                        var TypedArray;\n                        var itemSize;\n                        var normalized;\n                        var arrayLength = 0;\n\n                        for (var i = 0; i < attributes.length; ++i) {\n\n                                    var attribute = attributes[i];\n\n                                    if (attribute.isInterleavedBufferAttribute) return null;\n\n                                    if (TypedArray === undefined) TypedArray = attribute.array.constructor;\n                                    if (TypedArray !== attribute.array.constructor) return null;\n\n                                    if (itemSize === undefined) itemSize = attribute.itemSize;\n                                    if (itemSize !== attribute.itemSize) return null;\n\n                                    if (normalized === undefined) normalized = attribute.normalized;\n                                    if (normalized !== attribute.normalized) return null;\n\n                                    arrayLength += attribute.array.length;\n                        }\n\n                        var array = new TypedArray(arrayLength);\n                        var offset = 0;\n\n                        for (var i = 0; i < attributes.length; ++i) {\n\n                                    array.set(attributes[i].array, offset);\n\n                                    offset += attributes[i].array.length;\n                        }\n\n                        return new THREE.BufferAttribute(array, itemSize, normalized);\n            }\n\n};\n\n//# sourceURL=webpack:///./src/workers/MergeBufferGeometryUtils.js?")},"./src/workers/bufferProcess.worker.js":
/*!*********************************************!*\
  !*** ./src/workers/bufferProcess.worker.js ***!
  \*********************************************/
/*! no static exports found */function(module,exports,__webpack_require__){eval('module.exports = function() {\n  return __webpack_require__(/*! !./node_modules/_worker-loader@2.0.0@worker-loader/dist/workers/InlineWorker.js */ "./node_modules/_worker-loader@2.0.0@worker-loader/dist/workers/InlineWorker.js")("/******/ (function(modules) { // webpackBootstrap\\n/******/ \\t// The module cache\\n/******/ \\tvar installedModules = {};\\n/******/\\n/******/ \\t// The require function\\n/******/ \\tfunction __webpack_require__(moduleId) {\\n/******/\\n/******/ \\t\\t// Check if module is in cache\\n/******/ \\t\\tif(installedModules[moduleId]) {\\n/******/ \\t\\t\\treturn installedModules[moduleId].exports;\\n/******/ \\t\\t}\\n/******/ \\t\\t// Create a new module (and put it into the cache)\\n/******/ \\t\\tvar module = installedModules[moduleId] = {\\n/******/ \\t\\t\\ti: moduleId,\\n/******/ \\t\\t\\tl: false,\\n/******/ \\t\\t\\texports: {}\\n/******/ \\t\\t};\\n/******/\\n/******/ \\t\\t// Execute the module function\\n/******/ \\t\\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\\n/******/\\n/******/ \\t\\t// Flag the module as loaded\\n/******/ \\t\\tmodule.l = true;\\n/******/\\n/******/ \\t\\t// Return the exports of the module\\n/******/ \\t\\treturn module.exports;\\n/******/ \\t}\\n/******/\\n/******/\\n/******/ \\t// expose the modules object (__webpack_modules__)\\n/******/ \\t__webpack_require__.m = modules;\\n/******/\\n/******/ \\t// expose the module cache\\n/******/ \\t__webpack_require__.c = installedModules;\\n/******/\\n/******/ \\t// define getter function for harmony exports\\n/******/ \\t__webpack_require__.d = function(exports, name, getter) {\\n/******/ \\t\\tif(!__webpack_require__.o(exports, name)) {\\n/******/ \\t\\t\\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\\n/******/ \\t\\t}\\n/******/ \\t};\\n/******/\\n/******/ \\t// define __esModule on exports\\n/******/ \\t__webpack_require__.r = function(exports) {\\n/******/ \\t\\tif(typeof Symbol !== \'undefined\' && Symbol.toStringTag) {\\n/******/ \\t\\t\\tObject.defineProperty(exports, Symbol.toStringTag, { value: \'Module\' });\\n/******/ \\t\\t}\\n/******/ \\t\\tObject.defineProperty(exports, \'__esModule\', { value: true });\\n/******/ \\t};\\n/******/\\n/******/ \\t// create a fake namespace object\\n/******/ \\t// mode & 1: value is a module id, require it\\n/******/ \\t// mode & 2: merge all properties of value into the ns\\n/******/ \\t// mode & 4: return value when already ns object\\n/******/ \\t// mode & 8|1: behave like require\\n/******/ \\t__webpack_require__.t = function(value, mode) {\\n/******/ \\t\\tif(mode & 1) value = __webpack_require__(value);\\n/******/ \\t\\tif(mode & 8) return value;\\n/******/ \\t\\tif((mode & 4) && typeof value === \'object\' && value && value.__esModule) return value;\\n/******/ \\t\\tvar ns = Object.create(null);\\n/******/ \\t\\t__webpack_require__.r(ns);\\n/******/ \\t\\tObject.defineProperty(ns, \'default\', { enumerable: true, value: value });\\n/******/ \\t\\tif(mode & 2 && typeof value != \'string\') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\\n/******/ \\t\\treturn ns;\\n/******/ \\t};\\n/******/\\n/******/ \\t// getDefaultExport function for compatibility with non-harmony modules\\n/******/ \\t__webpack_require__.n = function(module) {\\n/******/ \\t\\tvar getter = module && module.__esModule ?\\n/******/ \\t\\t\\tfunction getDefault() { return module[\'default\']; } :\\n/******/ \\t\\t\\tfunction getModuleExports() { return module; };\\n/******/ \\t\\t__webpack_require__.d(getter, \'a\', getter);\\n/******/ \\t\\treturn getter;\\n/******/ \\t};\\n/******/\\n/******/ \\t// Object.prototype.hasOwnProperty.call\\n/******/ \\t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\\n/******/\\n/******/ \\t// __webpack_public_path__\\n/******/ \\t__webpack_require__.p = \\"\\";\\n/******/\\n/******/\\n/******/ \\t// Load entry module and return exports\\n/******/ \\treturn __webpack_require__(__webpack_require__.s = \\"./node_modules/_babel-loader@7.1.5@babel-loader/lib/index.js?!./src/workers/bufferProcess.worker.js\\");\\n/******/ })\\n/************************************************************************/\\n/******/ ({\\n\\n/***/ \\"./node_modules/_babel-loader@7.1.5@babel-loader/lib/index.js?!./src/workers/bufferProcess.worker.js\\":\\n/*!*********************************************************************************************************!*\\\\\\n  !*** ./node_modules/_babel-loader@7.1.5@babel-loader/lib??ref--5!./src/workers/bufferProcess.worker.js ***!\\n  \\\\*********************************************************************************************************/\\n/*! no static exports found */\\n/***/ (function(module, exports, __webpack_require__) {\\n\\n\\"use strict\\";\\neval(\\"\\\\n\\\\n/**\\\\r\\\\n * bufferProcessWorker：处理buffer的相关逻辑与细节\\\\r\\\\n * **/\\\\nfunction toDecimal(x) {\\\\n    var f = parseFloat(x);\\\\n    if (isNaN(f)) {\\\\n        return;\\\\n    }\\\\n    f = Math.round(x * 1000) / 1000;\\\\n    return f;\\\\n}\\\\n\\\\nfunction convertBuffer(byteArray, id, currentUrl, flag) {\\\\n    var bufferMap = {};\\\\n    var offsetNum = 0;\\\\n    var dataView = new DataView(byteArray);\\\\n    var postCount = 0;\\\\n    var postBufferMap = {};\\\\n    var result = {};\\\\n    if (flag === \'wall\') {\\\\n        result = {\\\\n            wall: postBufferMap\\\\n        };\\\\n    } else {\\\\n        result[currentUrl] = postBufferMap;\\\\n    }\\\\n    while (offsetNum < byteArray.byteLength) {\\\\n        var tmpSize = dataView.getInt32(offsetNum, true);\\\\n        offsetNum += 4;\\\\n        var nodeId = dataView.getInt32(offsetNum, true);\\\\n        offsetNum += 4;\\\\n        var numVertices = dataView.getInt32(offsetNum, true);\\\\n        offsetNum += 4;\\\\n\\\\n        var ivList = new Float32Array(numVertices * 3);\\\\n        var inList = new Float32Array(numVertices * 3);\\\\n\\\\n        for (var i = 0; i < numVertices; i++) {\\\\n            var baseI = i * 6;\\\\n            ivList[3 * i] = toDecimal(dataView.getFloat32(offsetNum + baseI * 4, true));\\\\n            ivList[3 * i + 1] = toDecimal(dataView.getFloat32(offsetNum + (baseI + 1) * 4, true));\\\\n            ivList[3 * i + 2] = toDecimal(dataView.getFloat32(offsetNum + (baseI + 2) * 4, true));\\\\n\\\\n            inList[3 * i] = toDecimal(dataView.getFloat32(offsetNum + (baseI + 3) * 4, true));\\\\n            inList[3 * i + 1] = toDecimal(dataView.getFloat32(offsetNum + (baseI + 4) * 4, true));\\\\n            inList[3 * i + 2] = toDecimal(dataView.getFloat32(offsetNum + (baseI + 5) * 4, true));\\\\n        }\\\\n\\\\n        offsetNum += numVertices * 24; // 4 * 6\\\\n\\\\n        var numIndices = dataView.getInt32(offsetNum, true);\\\\n        offsetNum += 4;\\\\n        var iiList = new Uint32Array(numIndices * 3);\\\\n        for (var _i = 0; _i < numIndices; _i++) {\\\\n            var _baseI = _i * 3;\\\\n            iiList[3 * _i] = dataView.getInt32(offsetNum + _baseI * 4, true);\\\\n            iiList[3 * _i + 1] = dataView.getInt32(offsetNum + (_baseI + 1) * 4, true);\\\\n            iiList[3 * _i + 2] = dataView.getInt32(offsetNum + (_baseI + 2) * 4, true);\\\\n        }\\\\n\\\\n        offsetNum += numIndices * 12; // 4 * 3\\\\n\\\\n        var numIndicesForWireFrame = dataView.getInt32(offsetNum, true);\\\\n        offsetNum += 4;\\\\n        var iwList = new Uint32Array(numIndicesForWireFrame * 2);\\\\n        for (var _i2 = 0; _i2 < numIndicesForWireFrame; _i2++) {\\\\n            var _baseI2 = _i2 * 2;\\\\n            iwList[2 * _i2] = dataView.getInt32(offsetNum + _baseI2 * 4, true);\\\\n            iwList[2 * _i2 + 1] = dataView.getInt32(offsetNum + (_baseI2 + 1) * 4, true);\\\\n        }\\\\n\\\\n        offsetNum += numIndicesForWireFrame * 8; // 4 * 2\\\\n        bufferMap[nodeId] = {\\\\n            \\\\\\"ii\\\\\\": iiList,\\\\n            \\\\\\"iv\\\\\\": ivList,\\\\n            \\\\\\"in\\\\\\": inList,\\\\n            \\\\\\"iw\\\\\\": iwList\\\\n        };\\\\n\\\\n        postBufferMap[nodeId] = {\\\\n            \\\\\\"ii\\\\\\": iiList,\\\\n            \\\\\\"iv\\\\\\": ivList,\\\\n            \\\\\\"in\\\\\\": inList,\\\\n            \\\\\\"iw\\\\\\": iwList\\\\n        };\\\\n        postCount++;\\\\n    }\\\\n    if (postCount > 0) {\\\\n        self.postMessage({ method: \'buffers\', buffers: result, id: id, url: currentUrl });\\\\n    }\\\\n}\\\\n//TODO 这里还有很多工作要做，比如一些错误处理，header头设置等等，目前仅是测试使用\\\\nfunction getBufferBin(url, id, currentUrl, flag) {\\\\n    var oReq = new XMLHttpRequest();\\\\n    oReq.open(\\\\\\"GET\\\\\\", url, true);\\\\n    oReq.responseType = \\\\\\"arraybuffer\\\\\\";\\\\n    oReq.onload = function (oEvent) {\\\\n        if (oReq.status === 200 && oReq.readyState === 4) {\\\\n            var arrayBuffer = oReq.response;\\\\n            convertBuffer(arrayBuffer, id, currentUrl, flag);\\\\n        }\\\\n    };\\\\n    oReq.send();\\\\n}\\\\n\\\\nself.addEventListener(\'message\', function (e) {\\\\n    if (e.data) {\\\\n        getBufferBin(e.data.url, e.data.id, e.data.currentUrl, e.data.flag);\\\\n    }\\\\n}, false);\\\\n\\\\n//# sourceURL=webpack:///./src/workers/bufferProcess.worker.js?./node_modules/_babel-loader@7.1.5@babel-loader/lib??ref--5\\");\\n\\n/***/ })\\n\\n/******/ });", null);\n};\n\n//# sourceURL=webpack:///./src/workers/bufferProcess.worker.js?')}}),SimpleIDW.getInstance=function(){var e=null;return function(){return e||(e=new SimpleIDW),e}}(),SimpleIDW.prototype={defaultCellSize:10,defaultGradient:{0:"#000066",.1:"blue",.2:"cyan",.3:"lime",.4:"yellow",.5:"orange",.6:"red",.7:"Maroon",.8:"#660066",.9:"#990099",1:"#ff66ff"},data:function(e){return this.data!==e&&(this._data=e,this._dataDirty=!0),this},add:function(e){return this._data.push(e),this._dataDirty=!0,this},clear:function(){return this._data=[],this._dataDirty=!0,this},canvas:function(){return this._canvas},setCanvasSize:function(e,t){return this._canvasWidth===e&&this._canvasHeight===t||(this._canvasWidth=this._canvas.width=e,this._canvasHeight=this._canvas.height=t,this._dataDirty=!0),this},setAreaSize:function(e,t){return this._areaWidth===e&&this._areaHeight===t||(this._areaWidth=e,this._areaHeight=t,this._dataDirty=!0),this},min:function(e){return this._min!==e&&(this._min=e),this},max:function(e){return this.max!==e&&(this._max=e),this},alpha:function(e){return this._alpha=e,this},radius:function(e){return this._radius=e,this},opacity:function(e){return this._opacity!==e&&(this._opacity=e),this},exp:function(e){return this._exp=e,this},cellSize:function(e){var t=this._cell=document.createElement("canvas"),n=t.getContext("2d");return this._r=e,t.width=t.height=e,n.beginPath(),n.rect(0,0,e,e),n.fill(),n.closePath(),this},resize:function(){this._canvasWidth=this._canvas.width,this._canvasWidth=this._canvas.height},gradient:function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),i=n.createLinearGradient(0,0,0,256);for(var r in t.width=1,t.height=256,e)i.addColorStop(+r,e[r]);return n.fillStyle=i,n.fillRect(0,0,1,256),this._grad=n.getImageData(0,0,1,256).data,this},_transformData:function(){var e=this._canvasWidth/this._areaWidth,t=this._canvasHeight/this._areaHeight,n=this;this._data.forEach((function(i){var r=i[0],o=i[1];r=r*e+n._canvasWidth/2,o=o*t+n._canvasHeight/2,n._transformedData.push([r,o,i[2]])}))},_redraw:function(){var e,t,n,i,r,o,a,s=[],l=this._r,u=this._exp,c=this._max,h=this._min,p=l/2,d=Math.ceil(this._canvasWidth/l)+1,f=Math.ceil(this._canvasHeight/l)+1;if(this._dataDirty&&this._transformData(),0!==this._transformedData.length){for(e=0,t=f;e<t;e++)for(i=0,r=d;i<r;i++){var m=e*l,g=i*l,v=0,y=0;for(o=0,a=this._transformedData.length;o<a;o++){var b=[g-p,m-p],_=this._transformedData[o],x=Math.sqrt(Math.pow(_[0]-b[0],2)+Math.pow(_[1]-b[1],2)),E=_[2];if(0===x){v=E,y=1;break}x>this._radius&&(v+=0,y+=0);var w=Math.pow(x,u);v+=E/w,y+=1/w}if(n=[i*l,e*l,v/y]){let e=Math.min(n[2],c);e=Math.max(h,e),s.push([Math.round(n[0]),Math.round(n[1]),e])}}this.data(s).draw(),this._frame=null}},draw:function(){this._cell||this.cellSize(this.defaultCellSize),this._grad||this.gradient(this.defaultGradient);var e=this._ctx;e.clearRect(0,0,this._canvasWidth,this._canvasHeight);for(var t,n=0,i=this._data.length;n<i;n++)t=this._data[n],e.globalAlpha=(t[2]-this._min)/this._max,e.drawImage(this._cell,t[0]-this._r,t[1]-this._r);var r=e.getImageData(0,0,this._canvasWidth,this._canvasHeight);return this._colorize(r.data,this._grad,this._opacity),e.putImageData(r,0,0),this},_colorize:function(e,t,n){for(var i,r=0,o=e.length;r<o;r+=4)i=4*e[r+3],e[r]=t[i],e[r+1]=t[i+1],e[r+2]=t[i+2],e[r+3]=256*n}};var MSPE={distributions:{BOX:1,SPHERE:2,DISC:3},valueOverLifetimeLength:4};function SimpleHeatmap(e){this._canvas="string"==typeof e?document.getElementById(e):e,void 0===this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=128,this._canvas.height=128),this._ctx=this._canvas.getContext("2d"),this._max=1,this._min=0,this._dataDirty=!0,this._data=[],this._transformedData=[],this._canvasWidth=this._areaWidth=this._canvas.width,this._canvasHeight=this._areaHeight=this._canvas.height,this._alpha=!1,this._grad={};var t=this._createCanvas();t.width=1,t.height=256,this._gradCtx=t.getContext("2d"),this._gradCache={},this._gradData=null,this._r=0,this._radius=0,this._blur=0,this._circle=this._createCanvas(),this._cirCtx=this._circle.getContext("2d")}"function"==typeof define&&define.amd?define("spe",MSPE):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=MSPE),MSPE.shaderChunks={defines:[].join("\n"),uniforms:["uniform sampler2D tex;"].join("\n"),attributes:["attribute vec3 mcol0;","attribute vec3 mcol1;","attribute vec3 mcol2;","attribute vec3 mcol3;","attribute vec4 color;"].join("\n"),varyings:["varying vec2 vUv;","varying vec4 varyColor;"].join("\n")},MSPE.shaders={vertex:[THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,THREE.ShaderChunk.fog_pars_vertex,MSPE.shaderChunks.uniforms,MSPE.shaderChunks.attributes,MSPE.shaderChunks.varyings,"void main()","{","\tmat4 matrix = mat4(","\t\tvec4( mcol0, 0 ),","\t\tvec4( mcol1, 0 ),","\t\tvec4( mcol2, 0 ),","\t\tvec4( mcol3, 1 )","\t);","\tvaryColor = color;","   vec4 mvPosition = modelViewMatrix * matrix * vec4( position, 1.0 );","   vUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.fog_vertex,"}"].join("\n"),fragment:[THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,MSPE.shaderChunks.uniforms,MSPE.shaderChunks.varyings,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"    gl_FragColor = varyColor * texture2D(tex, vUv);",THREE.ShaderChunk.fog_fragment,"}"].join("\n")},MSPE.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(e,t,n){"use strict";return typeof e===t?e:n},ensureArrayTypedArg:function(e,t,n){"use strict";if(Array.isArray(e)){for(var i=e.length-1;i>=0;--i)if(typeof e[i]!==t)return n;return e}return this.ensureTypedArg(e,t,n)},ensureInstanceOf:function(e,t,n){"use strict";return void 0!==t&&e instanceof t?e:n},ensureArrayInstanceOf:function(e,t,n){"use strict";if(Array.isArray(e)){for(var i=e.length-1;i>=0;--i)if(void 0!==t&&e[i]instanceof t==!1)return n;return e}return this.ensureInstanceOf(e,t,n)},ensureValueOverLifetimeCompliance:function(e,t,n){"use strict";t=t||3,n=n||3,!1===Array.isArray(e._value)&&(e._value=[e._value]),!1===Array.isArray(e._spread)&&(e._spread=[e._spread]);var i=this.clamp(e._value.length,t,n),r=this.clamp(e._spread.length,t,n),o=Math.max(i,r);e._value.length!==o&&(e._value=this.interpolateArray(e._value,o)),e._spread.length!==o&&(e._spread=this.interpolateArray(e._spread,o))},interpolateArray:function(e,t){"use strict";for(var n=e.length,i=["function"==typeof e[0].clone?e[0].clone():e[0]],r=(n-1)/(t-1),o=1;o<t-1;++o){var a=o*r,s=Math.floor(a),l=Math.ceil(a),u=a-s;i[o]=this.lerpTypeAgnostic(e[s],e[l],u)}return i.push("function"==typeof e[n-1].clone?e[n-1].clone():e[n-1]),i},clamp:function(e,t,n){"use strict";return Math.max(t,Math.min(e,n))},zeroToEpsilon:function(e,t){"use strict";var n=e;return n=t?1e-5*Math.random()*10:1e-5,e<0&&e>-1e-5&&(n=-n),n},lerpTypeAgnostic:function(e,t,n){"use strict";var i,r=this.types;return typeof e==r.NUMBER&&typeof t==r.NUMBER?e+(t-e)*n:e instanceof THREE.Vector2&&t instanceof THREE.Vector2||typeof e.x==r.NUMBER&&typeof e.y==r.NUMBER&&null==e.z&&null==e.z&&typeof t.x==r.NUMBER&&typeof t.y==r.NUMBER&&null==t.z&&null==t.z?(e instanceof THREE.Vector2?i=e.clone():((i={}).x=e.x,i.y=e.y),i.x=this.lerp(e.x,t.x,n),i.y=this.lerp(e.y,t.y,n),i):e instanceof THREE.Vector3&&t instanceof THREE.Vector3||typeof e.x==r.NUMBER&&typeof e.y==r.NUMBER&&typeof e.z==r.NUMBER&&null==e.w&&null==e.w&&typeof t.x==r.NUMBER&&typeof t.y==r.NUMBER&&typeof t.z==r.NUMBER&&null==t.w&&null==t.w?(e instanceof THREE.Vector3?i=e.clone():((i={}).x=e.x,i.y=e.y,i.z=e.z),i.x=this.lerp(e.x,t.x,n),i.y=this.lerp(e.y,t.y,n),i.z=this.lerp(e.z,t.z,n),i):e instanceof THREE.Vector4&&t instanceof THREE.Vector4||typeof e.x==r.NUMBER&&typeof e.y==r.NUMBER&&typeof e.z==r.NUMBER&&typeof e.w==r.NUMBER&&typeof t.x==r.NUMBER&&typeof t.y==r.NUMBER&&typeof t.z==r.NUMBER&&typeof t.w==r.NUMBER?(e instanceof THREE.Vector4?i=e.clone():((i={}).x=e.x,i.y=e.y,i.z=e.z,i.w=e.w),i.x=this.lerp(e.x,t.x,n),i.y=this.lerp(e.y,t.y,n),i.z=this.lerp(e.z,t.z,n),i.w=this.lerp(e.w,t.w,n),i):e instanceof THREE.Color&&t instanceof THREE.Color||typeof e.r==r.NUMBER&&typeof e.g==r.NUMBER&&typeof e.b==r.NUMBER&&typeof t.r==r.NUMBER&&typeof t.g==r.NUMBER&&typeof t.b==r.NUMBER?(e instanceof THREE.Color?i=e.clone():((i={}).r=e.r,i.g=e.g,i.b=e.b),i.r=this.lerp(e.r,t.r,n),i.g=this.lerp(e.g,t.g,n),i.b=this.lerp(e.b,t.b,n),i):void console.warn("Invalid argument types, or argument types do not match:",e,t)},lerp:function(e,t,n){"use strict";return e+(t-e)*n},roundToNearestMultiple:function(e,t){"use strict";var n;return 0===t||0===(n=Math.abs(e)%t)?e:e<0?-(Math.abs(e)-n):e+t-n},arrayValuesAreEqual:function(e){"use strict";for(var t=0;t<e.length-1;++t)if(e[t]!==e[t+1])return!1;return!0},randomFloat:function(e,t){"use strict";return e+t*(Math.random()-.5)},randomVector3:function(e,t,n,i,r){"use strict";var o=n.x+(Math.random()*i.x-.5*i.x),a=n.y+(Math.random()*i.y-.5*i.y),s=n.z+(Math.random()*i.z-.5*i.z);r&&(o=.5*-r.x+this.roundToNearestMultiple(o,r.x),a=.5*-r.y+this.roundToNearestMultiple(a,r.y),s=.5*-r.z+this.roundToNearestMultiple(s,r.z)),e.typedArray.setVec3Components(t,o,a,s)},getRandomVector3:function(e,t,n){"use strict";var i=e.x+(Math.random()*t.x-.5*t.x),r=e.y+(Math.random()*t.y-.5*t.y),o=e.z+(Math.random()*t.z-.5*t.z);return n&&(i=.5*-n.x+this.roundToNearestMultiple(i,n.x),r=.5*-n.y+this.roundToNearestMultiple(r,n.y),o=.5*-n.z+this.roundToNearestMultiple(o,n.z)),new THREE.Vector3(i,r,o)},randomColor:function(e,t,n,i){"use strict";var r=n.r+Math.random()*i.x,o=n.g+Math.random()*i.y,a=n.b+Math.random()*i.z;r=this.clamp(r,0,1),o=this.clamp(o,0,1),a=this.clamp(a,0,1),e.typedArray.setVec3Components(t,r,o,a)},randomColorAsHex:function(){"use strict";var e=new THREE.Color;return function(t,n,i,r){for(var o=i.length,a=[],s=0;s<o;++s){var l=r[s];e.copy(i[s]),e.r+=Math.random()*l.x-.5*l.x,e.g+=Math.random()*l.y-.5*l.y,e.b+=Math.random()*l.z-.5*l.z,e.r=this.clamp(e.r,0,1),e.g=this.clamp(e.g,0,1),e.b=this.clamp(e.b,0,1),a.push(e.getHex())}t.typedArray.setVec4Components(n,a[0],a[1],a[2],a[3])}}(),getRandomColor:function(e,t){"use strict";for(var n=e.length,i=[],r=0;r<n;++r){var o=t[r],a=new THREE.Color;a.copy(e[r]),a.r+=Math.random()*o.x-.5*o.x,a.g+=Math.random()*o.y-.5*o.y,a.b+=Math.random()*o.z-.5*o.z,a.r=this.clamp(a.r,0,1),a.g=this.clamp(a.g,0,1),a.b=this.clamp(a.b,0,1),i.push(a)}return i},randomVector3OnSphere:function(e,t,n,i,r,o,a,s){"use strict";var l=2*Math.random()-1,u=6.2832*Math.random(),c=Math.sqrt(1-l*l),h=this.randomFloat(i,r),p=0,d=0,f=0;a&&(h=Math.round(h/a)*a),p=c*Math.cos(u)*h,d=c*Math.sin(u)*h,f=l*h,p*=o.x,d*=o.y,f*=o.z,p+=n.x,d+=n.y,f+=n.z,e.typedArray.setVec3Components(t,p,d,f)},getRandomVector3OnSphere:function(e,t,n,i,r,o){"use strict";var a=2*Math.random()-1,s=6.2832*Math.random(),l=Math.sqrt(1-a*a),u=this.randomFloat(t,n),c=0,h=0,p=0;return r&&(u=Math.round(u/r)*r),c=l*Math.cos(s)*u,h=l*Math.sin(s)*u,p=a*u,c*=i.x,h*=i.y,p*=i.z,c+=e.x,h+=e.y,p+=e.z,new THREE.Vector3(c,h,p)},seededRandom:function(e){var t=1e4*Math.sin(e);return t-(0|t)},randomVector3OnDisc:function(e,t,n,i,r,o,a){"use strict";var s=6.2832*Math.random(),l=Math.abs(this.randomFloat(i,r)),u=0,c=0,h=0;a&&(l=Math.round(l/a)*a),u=Math.cos(s)*l,c=Math.sin(s)*l,u*=o.x,c*=o.y,u+=n.x,c+=n.y,h+=n.z,e.typedArray.setVec3Components(t,u,c,h)},getRandomVector3OnDisc:function(e,t,n,i,r){"use strict";var o=6.2832*Math.random(),a=Math.abs(this.randomFloat(t,n)),s=0,l=0,u=0;return r&&(a=Math.round(a/r)*r),s=Math.cos(o)*a,l=Math.sin(o)*a,s*=i.x,l*=i.y,s+=e.x,l+=e.y,u+=e.z,new THREE.Vector3(s,l,u)},randomDirectionVector3OnSphere:function(){"use strict";var e=new THREE.Vector3;return function(t,n,i,r,o,a,s,l){e.copy(a),e.x-=i,e.y-=r,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(n,e.x,e.y,e.z)}}(),getRandomDirectionVector3OnSphere:function(e,t,n){"use strict";var i=new THREE.Vector3;return i.copy(e),i.x-=this.randomFloat(0,1),i.y-=this.randomFloat(0,1),i.z-=this.randomFloat(0,1),i.normalize().multiplyScalar(-this.randomFloat(t,n)),i},getDirectionVector3OnSphere:function(e,t,n,i,r,o){"use strict";var a=new THREE.Vector3;a.copy(e),a.normalize().multiplyScalar(this.randomFloat(n,i));var s=this.getRandomVector3(r,o);return a.add(s),a},randomDirectionVector3OnDisc:function(){"use strict";var e=new THREE.Vector3;return function(t,n,i,r,o,a,s,l){e.copy(a),e.x-=i,e.y-=r,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(n,e.x,e.y,0)}}(),getPackedRotationAxis:function(){"use strict";var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Color,i=new THREE.Vector3(1,1,1);return function(r,o){return e.copy(r).normalize(),t.copy(o).normalize(),e.x+=.5*-o.x+Math.random()*o.x,e.y+=.5*-o.y+Math.random()*o.y,e.z+=.5*-o.z+Math.random()*o.z,e.normalize().add(i).multiplyScalar(.5),n.setRGB(e.x,e.y,e.z),n.getHex()}}(),getRotationAxis:function(){"use strict";var e=new THREE.Vector3,t=new THREE.Vector3,n=(new THREE.Color,new THREE.Vector3(1,1,1));return function(i,r){return e.copy(i).normalize(),t.copy(r).normalize(),e.x+=.5*-r.x+Math.random()*r.x,e.y+=.5*-r.y+Math.random()*r.y,e.z+=.5*-r.z+Math.random()*r.z,e.normalize().add(n).multiplyScalar(.5),e}}(),setMatrix:function(){var e=new THREE.Quaternion;return function(t,n,i,r){e.setFromEuler(n,!1),r.compose(t,e,i)}}(),clock:function(){var e=new THREE.Clock;return function(){return e}}()},MSPE.Group=function(e){"use strict";var t=MSPE.utils,n=t.types;if((e=t.ensureTypedArg(e,n.OBJECT,{})).texture=t.ensureTypedArg(e.texture,n.OBJECT,{}),this.uuid=THREE.Math.generateUUID(),this.fixedTimeStep=t.ensureTypedArg(e.fixedTimeStep,n.NUMBER,.016),this.texture=t.ensureInstanceOf(e.texture.value,THREE.Texture,null),this.hasPerspective=t.ensureTypedArg(e.hasPerspective,n.BOOLEAN,!0),this.colorize=t.ensureTypedArg(e.colorize,n.BOOLEAN,!0),this.maxParticleCount=t.ensureTypedArg(e.maxParticleCount,n.NUMBER,1e3),this.vec4Quaternion=t.ensureInstanceOf(e.vec4Quaternion,THREE.Vector4,new THREE.Vector4(0,0,0,1)),this.vec4Quaternion=this.vec4Quaternion.normalize(),null==e.bufferGeometry||null==e.bufferGeometry||!(e.bufferGeometry instanceof THREE.BufferGeometry))return console.error("[MSPE.js] : [MSPE.Group] : error options.bufferGeometry!"),null;this.instancedBufferGeometry=null,this.mesh=null,this.materialList=[],this.geometryList=[],this.bufferGeometry=e.bufferGeometry,this.bufferGeometry=this.bufferGeometry.toNonIndexed(),this.bufferGeometry.computeBoundingBox(),this.geometryList.push(this.bufferGeometry),this.instancedBufferGeometry=new THREE.InstancedBufferGeometry,this.geometryList.push(this.instancedBufferGeometry);var i=this.bufferGeometry.attributes.position.clone();if(this.instancedBufferGeometry.setAttribute("position",i),null!=this.bufferGeometry.attributes.uv&&null!=this.bufferGeometry.attributes.uv){var r=this.bufferGeometry.attributes.uv.clone();this.instancedBufferGeometry.setAttribute("uv",r)}this.instanceBuffer=new THREE.InstancedInterleavedBuffer(new Float32Array(16*this.maxParticleCount),16,1).setUsage(THREE.DynamicDrawUsage),this.mcol0=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,0),this.mcol1=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,3),this.mcol2=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,6),this.mcol3=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,9),this.colors=new THREE.InterleavedBufferAttribute(this.instanceBuffer,4,12);!function(){var e=new THREE.Vector3(0,0,0),t=new THREE.Euler(0,0,0),n=new THREE.Quaternion,i=new THREE.Vector3(1,1,1)}();for(var o=new THREE.Matrix4,a=o.elements,s=0,l=this.mcol0.count;s<l;s++){var u=new THREE.Vector3(0,0,0),c=new THREE.Euler(0,0,0),h=new THREE.Vector3(0,0,0);t.setMatrix(u,c,h,o),this.mcol0.setXYZ(s,a[0],a[1],a[2]),this.mcol1.setXYZ(s,a[4],a[5],a[6]),this.mcol2.setXYZ(s,a[8],a[9],a[10]),this.mcol3.setXYZ(s,a[12],a[13],a[14]),this.colors.setXYZW(s,1,1,1,1)}this.instancedBufferGeometry.setAttribute("mcol0",this.mcol0),this.instancedBufferGeometry.setAttribute("mcol1",this.mcol1),this.instancedBufferGeometry.setAttribute("mcol2",this.mcol2),this.instancedBufferGeometry.setAttribute("mcol3",this.mcol3),this.instancedBufferGeometry.setAttribute("color",this.colors),this.blending=t.ensureTypedArg(e.blending,n.NUMBER,THREE.AdditiveBlending),this.transparent=t.ensureTypedArg(e.transparent,n.BOOLEAN,!0),this.alphaTest=parseFloat(t.ensureTypedArg(e.alphaTest,n.NUMBER,0)),this.depthWrite=t.ensureTypedArg(e.depthWrite,n.BOOLEAN,!1),this.depthTest=t.ensureTypedArg(e.depthTest,n.BOOLEAN,!0),this.fog=t.ensureTypedArg(e.fog,n.BOOLEAN,!0),this.scale=t.ensureTypedArg(e.scale,n.NUMBER,300),this.emitters=[],this.emitterIDs=[],this.particleCount=0,this.uniforms={tex:{type:"t",value:this.texture}},this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:MSPE.shaders.vertex,fragmentShader:MSPE.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,fog:this.fog}),this.materialList.push(this.material),this.mesh=new THREE.Mesh(this.instancedBufferGeometry,this.material),this.bEnableTrail=t.ensureTypedArg(e.bEnableTrail,n.BOOLEAN,!1),this.bEnableTrail&&(this.textureTrail=t.ensureInstanceOf(e.textureTrail,THREE.Texture,null),null!=this.textureTrail&&null!=this.textureTrail||(console.error("[MSPE.js] : [MSPE.Group] : error options.textureTrail!"),this.textureTrail=this.texture),this.fTrailLife=parseFloat(t.ensureTypedArg(e.fTrailLife,n.NUMBER,1)),this.fTrailWidthStart=parseFloat(t.ensureTypedArg(e.fTrailWidthStart,n.NUMBER,1)),this.fTrailWidthEnd=parseFloat(t.ensureTypedArg(e.fTrailWidthEnd,n.NUMBER,1)))},MSPE.Group.constructor=MSPE.Group,MSPE.Group.prototype._updateDefines=function(){},MSPE.Group.prototype.addEmitter=function(e){"use strict";if(e instanceof MSPE.Emitter!=!1)if(this.emitterIDs.indexOf(e.uuid)>-1)console.error("[MSPE.js] : [MSPE.Group] : [addEmitter] : Emitter already exists in this group. Will not add again.");else{if(null===e.group){var t,n=this.particleCount;return t=Math.min(n+e.particleCount,this.maxParticleCount),this.particleCount=t,e.particleCount=t-n,e.activationStart=n,e.activationEnd=e.activationStart+e.particleCount,e._calculatePPSValue(e.maxAge._value+e.maxAge._spread),e.attach(this),this.emitters.push(e),this.emitterIDs.push(e.uuid),this.material.needsUpdate=!0,this.instanceBuffer.needsUpdate=!0,this}console.error("[MSPE.js] : [MSPE.Group] : [addEmitter] : Emitter already belongs to another group. Will not add to requested group.")}else console.error("[MSPE.js] : [MSPE.Group] : [addEmitter] : emitter argument must be instance of MSPE.Emitter;")},MSPE.Group.prototype.removeEmitter=function(e){"use strict";var t=this.emitterIDs.indexOf(e.uuid);e instanceof MSPE.Emitter!=!1?-1!==t?(this.emitters[t].dispose(),this.emitters.splice(t,1),this.emitterIDs.splice(t,1),this.particleCount-=e.particleCount,this.material.needsUpdate=!0,this.instanceBuffer.needsUpdate=!0,e.group=null):console.error("[MSPE.js] : [MSPE.Group] : [removeEmitter] : Emitter does not exist in this group. Will not remove."):console.error("[MSPE.js] : [MSPE.Group] : [removeEmitter] : emitter argument must be instance of MSPE.Emitter;")},MSPE.Group.prototype.tick=function(e,t){"use strict";var n=this.emitters,i=n.length,r=e||this.fixedTimeStep;if(0!==i){for(var o=0;o<i;++o)n[o].tick(r,t);this.instanceBuffer.needsUpdate=!0}},MSPE.Group.prototype.dispose=function(){"use strict";return this.materialList.forEach((function(e){e.dispose()})),this.geometryList.forEach((function(e){e.dispose()})),this.materialList=[],this.geometryList=[],this},MSPE.Emitter=function(e){"use strict";var t=MSPE.utils,n=t.types,i=MSPE.valueOverLifetimeLength;for(var r in(e=t.ensureTypedArg(e,n.OBJECT,{})).position=t.ensureTypedArg(e.position,n.OBJECT,{}),e.velocity=t.ensureTypedArg(e.velocity,n.OBJECT,{}),e.acceleration=t.ensureTypedArg(e.acceleration,n.OBJECT,{}),e.radius=t.ensureTypedArg(e.radius,n.OBJECT,{}),e.drag=t.ensureTypedArg(e.drag,n.OBJECT,{}),e.rotation=t.ensureTypedArg(e.rotation,n.OBJECT,{}),e.color=t.ensureTypedArg(e.color,n.OBJECT,{}),e.opacity=t.ensureTypedArg(e.opacity,n.OBJECT,{}),e.size=t.ensureTypedArg(e.size,n.OBJECT,{}),e.angle=t.ensureTypedArg(e.angle,n.OBJECT,{}),e.wiggle=t.ensureTypedArg(e.wiggle,n.OBJECT,{}),e.maxAge=t.ensureTypedArg(e.maxAge,n.OBJECT,{}),this.uuid=THREE.Math.generateUUID(),this.type=t.ensureTypedArg(e.type,n.NUMBER,SPE.distributions.BOX),this.position={_value:t.ensureInstanceOf(e.position.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.position.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.position.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.position.distribution,n.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,n.BOOLEAN,!1),_radius:t.ensureTypedArg(e.position.radius,n.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.position.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.position.distributionClamp,n.NUMBER,0)},this.velocity={_value:t.ensureInstanceOf(e.velocity.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.velocity.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.velocity.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.velocity.distribution,n.NUMBER,this.type),_randomise:t.ensureTypedArg(e.velocity.randomise,n.BOOLEAN,!1),_radius:t.ensureTypedArg(e.velocity.radius,n.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.velocity.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.velocity.distributionClamp,n.NUMBER,0)},this.acceleration={_value:t.ensureInstanceOf(e.acceleration.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.acceleration.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.acceleration.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.acceleration.distribution,n.NUMBER,this.type),_randomise:t.ensureTypedArg(e.acceleration.randomise,n.BOOLEAN,!1),_radius:t.ensureTypedArg(e.acceleration.radius,n.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.acceleration.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.acceleration.distributionClamp,n.NUMBER,0)},this.drag={_value:t.ensureTypedArg(e.drag.value,n.NUMBER,0),_spread:t.ensureTypedArg(e.drag.spread,n.NUMBER,0),_randomise:t.ensureTypedArg(e.drag.randomise,n.BOOLEAN,!1)},this.wiggle={_value:t.ensureTypedArg(e.wiggle.value,n.NUMBER,0),_spread:t.ensureTypedArg(e.wiggle.spread,n.NUMBER,0)},this.rotation={_axis:t.ensureInstanceOf(e.rotation.axis,THREE.Vector3,new THREE.Vector3(0,1,0)),_axisSpread:t.ensureInstanceOf(e.rotation.axisSpread,THREE.Vector3,new THREE.Vector3),_angle:t.ensureTypedArg(e.rotation.angle,n.NUMBER,0),_angleSpread:t.ensureTypedArg(e.rotation.angleSpread,n.NUMBER,0),_static:t.ensureTypedArg(e.rotation.static,n.BOOLEAN,!1),_center:t.ensureInstanceOf(e.rotation.center,THREE.Vector3,this.position._value.clone()),_randomise:t.ensureTypedArg(e.rotation.randomise,n.BOOLEAN,!1)},this.maxAge={_value:t.ensureTypedArg(e.maxAge.value,n.NUMBER,2),_spread:t.ensureTypedArg(e.maxAge.spread,n.NUMBER,0)},this.color={_value:t.ensureArrayInstanceOf(e.color.value,THREE.Color,new THREE.Color),_spread:t.ensureArrayInstanceOf(e.color.spread,THREE.Vector3,new THREE.Vector3),_randomise:t.ensureTypedArg(e.position.randomise,n.BOOLEAN,!1)},this.opacity={_value:t.ensureArrayTypedArg(e.opacity.value,n.NUMBER,1),_spread:t.ensureArrayTypedArg(e.opacity.spread,n.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,n.BOOLEAN,!1)},this.size={_value:t.ensureArrayTypedArg(e.size.value,n.NUMBER,1),_spread:t.ensureArrayTypedArg(e.size.spread,n.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,n.BOOLEAN,!1)},this.angle={_value:t.ensureArrayTypedArg(e.angle.value,n.NUMBER,0),_spread:t.ensureArrayTypedArg(e.angle.spread,n.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,n.BOOLEAN,!1)},this.SHOULD_DRAG_PARTICLES=!!Math.max(this.drag._value,this.drag._spread),this.SHOULD_WIGGLE_PARTICLES=!!Math.max(this.wiggle._value,this.wiggle._spread),this.SHOULD_ROTATE_PARTICLES=!!Math.max(this.rotation._angle,this.rotation._angleSpread),this.SHOULD_COLORIZE_PARTICLES=!0,this.SHOULD_SIZE_PARTICLES=!0,this.SHOULD_ANGLE_PARTICLES=!0,this.particleCount=t.ensureTypedArg(e.particleCount,n.NUMBER,100),this.objPool=new MSPE.BufferAttributeObjPool({iCount:this.particleCount}),this.duration=t.ensureTypedArg(e.duration,n.NUMBER,null),this.isStatic=t.ensureTypedArg(e.isStatic,n.BOOLEAN,!1),this.isLookAtCamera=t.ensureTypedArg(e.isLookAtCamera,n.BOOLEAN,!1),this.isLookAtCameraOnlyY=t.ensureTypedArg(e.isLookAtCameraOnlyY,n.BOOLEAN,!1),this.activeMultiplier=t.ensureTypedArg(e.activeMultiplier,n.NUMBER,1),this.direction=t.ensureTypedArg(e.direction,n.NUMBER,1),this.alive=t.ensureTypedArg(e.alive,n.BOOLEAN,!0),this.particlesPerSecond=0,this.age=0,this.activationStart=t.ensureTypedArg(e.activationStart,n.NUMBER,0),this.activationEnd=this.activationStart+this.particleCount,this._calculatePPSValue(this.maxAge._value+this.maxAge._spread),this.arrayParticles=new Array,this.group=null,this.bInitSpeed=!1,this.bInitSpeedAcc=!1,this.resetFlags={position:t.ensureTypedArg(e.position.randomise,n.BOOLEAN,!1)||t.ensureTypedArg(e.radius.randomise,n.BOOLEAN,!1),velocity:t.ensureTypedArg(e.velocity.randomise,n.BOOLEAN,!1),acceleration:t.ensureTypedArg(e.acceleration.randomise,n.BOOLEAN,!1)||t.ensureTypedArg(e.drag.randomise,n.BOOLEAN,!1),rotation:t.ensureTypedArg(e.rotation.randomise,n.BOOLEAN,!1),rotationCenter:t.ensureTypedArg(e.rotation.randomise,n.BOOLEAN,!1),size:t.ensureTypedArg(e.size.randomise,n.BOOLEAN,!1),color:t.ensureTypedArg(e.color.randomise,n.BOOLEAN,!1),opacity:t.ensureTypedArg(e.opacity.randomise,n.BOOLEAN,!1),angle:t.ensureTypedArg(e.angle.randomise,n.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"},this.updateMap)this.updateMap.hasOwnProperty(r)&&(this.updateCounts[this.updateMap[r]]=0,this.updateFlags[this.updateMap[r]]=!1,this._createGetterSetters(this[r],r));t.ensureValueOverLifetimeCompliance(this.color,i,i),t.ensureValueOverLifetimeCompliance(this.opacity,i,i),t.ensureValueOverLifetimeCompliance(this.size,i,i),t.ensureValueOverLifetimeCompliance(this.angle,i,i)},MSPE.Emitter.constructor=MSPE.Emitter,MSPE.Emitter.prototype._createGetterSetters=function(e,t){"use strict";var n=this;for(var i in e)if(e.hasOwnProperty(i)){var r=i.replace("_","");Object.defineProperty(e,r,{get:function(e){return function(){return this[e]}}(i),set:function(e){return function(i){var r=n.updateMap[t],o=this[e],a=MSPE.valueOverLifetimeLength;"_rotationCenter"===e?(n.updateFlags.rotationCenter=!0,n.updateCounts.rotationCenter=0):"_randomise"===e?n.resetFlags[r]=i:(n.updateFlags[r]=!0,n.updateCounts[r]=0),this[e]=i,Array.isArray(o)&&MSPE.utils.ensureValueOverLifetimeCompliance(n[t],a,a)}}(i)})}},MSPE.Emitter.prototype.attach=function(e){this.group=e},MSPE.Emitter.prototype._calculatePPSValue=function(e){"use strict";var t=this.particleCount;this.duration?this.particlesPerSecond=t/(e<this.duration?e:this.duration):this.particlesPerSecond=t/e},MSPE.Emitter.prototype._activateParticles=function(e,t){"use strict";this.direction;for(var n=0;n<e;++n){var i=new MSPE.Particle({emitter:this});null!=i&&null!=i&&this.arrayParticles.push(i)}},MSPE.Emitter.prototype.tick=function(e,t){"use strict";if(!this.isStatic)if(!1!==this.alive)if(null!==this.duration&&this.age>this.duration){for(var n=0,i=this.arrayParticles.length;n<i;++n)this.arrayParticles[n].tick(e,t),this.arrayParticles[n].alive||(this.arrayParticles[n].dispose(),this.arrayParticles.splice(n,1),i=this.arrayParticles.length,n--);this.arrayParticles.length<=0&&(this.alive=!1,this.age=0)}else{if(this.activationIndex=this.arrayParticles.length,this.activationIndex<this.particleCount){var r=this.activationIndex,o=this.particlesPerSecond*this.activeMultiplier*e,a=1===this.particleCount?r:0|r,s=Math.min(a+o,this.activationEnd)-a;s=Math.min(this.particleCount-this.activationIndex,s),this._activateParticles(s)}for(n=0,i=this.arrayParticles.length;n<i;++n)this.arrayParticles[n].tick(e,t),this.arrayParticles[n].alive||(this.arrayParticles[n].dispose(),this.arrayParticles.splice(n,1),i=this.arrayParticles.length,n--);this.age+=e}else this.age=0},MSPE.Emitter.prototype.dispose=function(){"use strict";for(var e=0,t=this.arrayParticles.length;e<t;++e)this.arrayParticles[e].dispose();this.particlesPerSecond=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.age=0,this.objPool.dispose()},MSPE.Particle=function(e){"use strict";var t=MSPE.utils,n=t.types;if(null!=(e=t.ensureTypedArg(e,n.OBJECT,{})).emitter&&null!=e.emitter&&e.emitter instanceof MSPE.Emitter){if(this.emitter=e.emitter,this.position={_value:e.emitter.position.value,_spread:e.emitter.position.spread,_spreadClamp:e.emitter.position.spreadClamp,_distribution:e.emitter.position.distribution,_randomise:e.emitter.position.randomise,_radius:e.emitter.position.radius,_radiusScale:e.emitter.position.radiusScale,_distributionClamp:e.emitter.position.distributionClamp},this.velocity={_value:e.emitter.velocity.value,_spread:e.emitter.velocity.spread,_spreadClamp:e.emitter.velocity.spreadClamp,_distribution:e.emitter.velocity.distribution,_randomise:e.emitter.velocity.randomise,_radius:e.emitter.velocity.radius,_radiusScale:e.emitter.velocity.radiusScale,_distributionClamp:e.emitter.velocity.distributionClamp},this.acceleration={_value:e.emitter.acceleration.value,_spread:e.emitter.acceleration.spread,_spreadClamp:e.emitter.acceleration.spreadClamp,_distribution:e.emitter.acceleration.distribution,_randomise:e.emitter.acceleration.randomise,_radius:e.emitter.acceleration.radius,_radiusScale:e.emitter.acceleration.radiusScale,_distributionClamp:e.emitter.acceleration.distributionClamp},this.drag={_value:e.emitter.drag.value,_spread:e.emitter.drag.spread,_randomise:e.emitter.position.randomise},this.wiggle={_value:e.emitter.wiggle.value,_spread:e.emitter.wiggle.spread},this.rotation={_axis:e.emitter.rotation.axis,_axisSpread:e.emitter.rotation.axisSpread,_angle:e.emitter.rotation.angle,_angleSpread:e.emitter.rotation.angleSpread,_static:e.emitter.rotation.static,_center:e.emitter.rotation.center,_randomise:e.emitter.position.randomise},this.maxAge={_value:e.emitter.maxAge.value,_spread:e.emitter.maxAge.spread},this.color={_value:e.emitter.color.value,_spread:e.emitter.color.spread,_randomise:e.emitter.position.randomise},this.opacity={_value:e.emitter.opacity.value,_spread:e.emitter.opacity.spread,_randomise:e.emitter.position.randomise},this.size={_value:e.emitter.size.value,_spread:e.emitter.size.spread,_randomise:e.emitter.position.randomise},this.angle={_value:e.emitter.angle.value,_spread:e.emitter.angle.spread,_randomise:e.emitter.position.randomise},this.alive=e.emitter.alive,this.age=0,this.vec3RealPosition=this._assignPositionValue(),this.vec3RealVelocity=this._assignVelocityValue(),this.vec3RealAcceleration=this._assignAccelerationValue(),this.arrayRealColor=this._assignColorValue(),this.arrayRealOpacity=this._assignOpacityAbsLifetimeValue(),this.arrayRealSize=this._assignSizeAbsLifetimeValue(),this.arrayRealAngle=this._assignAngleValue(),this.fRealDrag=t.clamp(t.randomFloat(this.drag._value,this.drag._spread),0,1),this.fRealWiggle=t.randomFloat(this.wiggle._value,this.wiggle._spread),this.fRealMaxAge=MSPE.utils.randomFloat(this.maxAge._value,this.maxAge._spread),this.vec3RealRotationAxis=MSPE.utils.getRotationAxis(this.rotation._axis,this.rotation._axisSpread),this.fRealRotationAngle=MSPE.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.uuidTrial="",this.obj=this.emitter.objPool.takeAnObj(),null==this.obj||null==this.obj)return this.alive=!1,this.dispose(),null;for(var i in this.matrix=new THREE.Matrix4,this.matrixElements=this.matrix.elements,this.vec3Position=new THREE.Vector3(0,0,0),this.vec3Rotation=new THREE.Euler(0,0,0),this.vec3Scale=new THREE.Vector3(.1,.1,.1),this.obj.setUse(!0),this.iBufferIndex=this.obj.iIndex+this.emitter.activationStart,this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"},this.updateMap)this.updateMap.hasOwnProperty(i)&&(this.updateCounts[this.updateMap[i]]=0,this.updateFlags[this.updateMap[i]]=!1,this._createGetterSetters(this[i],i));return this.emitter.group.bEnableTrail&&(this.trailRenderHelper=new TrailRenderHelper,this.trailRenderHelper.onTriggerMeshInited=this.onTriggerMeshInited,this.trailRenderHelper.init({fTimeLong:this.emitter.group.fTrailLife,fTimeStart:MSPE.utils.clock().getElapsedTime(),iStep:0,fWidthStart:this.emitter.group.fTrailWidthStart,fWidthEnd:this.emitter.group.fTrailWidthEnd,shaderColor:new THREE.Vector4(1,1,1,1),shaderTexture:this.emitter.group.textureTrail,shaderTexMode:"Stretch",shaderBlending:this.emitter.group.blending,shaderTransparent:this.emitter.group.transparent,shaderAlphaTest:this.emitter.group.alphaTest,shaderDepthWrite:this.emitter.group.depthWrite,shaderDepthTest:this.emitter.group.depthTest},(function(){})),this.uuidTrial=this.trailRenderHelper.attach((function(e){}))),this}console.error("[MSPE.js] : [MSPE.Particle] : error options.emitter;")},MSPE.Particle.constructor=MSPE.Particle,MSPE.Particle.prototype.onTriggerMeshInited=function(e){this.meshTrial=e},MSPE.Particle.prototype._createGetterSetters=function(e,t){"use strict";var n=this;for(var i in e)if(e.hasOwnProperty(i)){var r=i.replace("_","");Object.defineProperty(e,r,{get:function(e){return function(){return this[e]}}(i),set:function(e){return function(i){var r=n.updateMap[t],o=this[e],a=MSPE.valueOverLifetimeLength;"_rotationCenter"===e?(n.updateFlags.rotationCenter=!0,n.updateCounts.rotationCenter=0):"_randomise"===e?n.resetFlags[r]=i:(n.updateFlags[r]=!0,n.updateCounts[r]=0),this[e]=i,Array.isArray(o)&&MSPE.utils.ensureValueOverLifetimeCompliance(n[t],a,a)}}(i)})}},MSPE.Particle.prototype.tick=function(e,t){"use strict";if(!this.emitter.isStatic){if(!1!==this.emitter.alive&&!1!==this.alive)return null!==this.emitter.duration&&this.age>this.emitter.duration?(this.alive=!1,void(this.age=0)):(this.age+=e,this.running(t),this.age>this.fRealMaxAge?(this.alive=!1,void(this.age=0)):void 0);this.age=0}},MSPE.Particle.prototype._assignPositionValue=function(){"use strict";var e=MSPE.distributions,t=MSPE.utils,n=this.position,i=n._value,r=n._spread,o=this.emitter.type,a=new THREE.Vector3(0,0,0);switch(o){case e.BOX:a=t.getRandomVector3(i,r,n._spreadClamp);break;case e.SPHERE:a=t.getRandomVector3OnSphere(i,n._radius,n._spread.x,n._radiusScale,n._spreadClamp.x,n._distributionClamp||this.particleCount);break;case e.DISC:a=t.getRandomVector3OnDisc(i,n._radius,n._spread.x,n._radiusScale,n._spreadClamp.x)}return a},MSPE.Particle.prototype._assignVelocityValue=function(){"use strict";var e=this.emitter.group.vec4Quaternion.clone();e=e.normalize();var t=MSPE.distributions,n=MSPE.utils,i=this.velocity,r=i._value,o=i._spread,a=this.emitter.type;this.emitter.bInitSpeed||(r=r.applyQuaternion(e),o=o.applyQuaternion(e),this.emitter.bInitSpeed=!0);var s=new THREE.Vector3(0,0,0);switch(a){case t.BOX:s=n.getRandomVector3(r,o);break;case t.SPHERE:s=n.getRandomDirectionVector3OnSphere(this.emitter.position.value,r.x,o.x);break;case t.DISC:s=n.getRandomVector3OnDisc(r,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x)}return s},MSPE.Particle.prototype._assignAccelerationValue=function(){"use strict";var e=this.emitter.group.vec4Quaternion.clone();e=e.normalize();var t=MSPE.distributions,n=MSPE.utils,i=this.acceleration,r=i._value,o=i._spread,a=this.emitter.type;this.emitter.bInitSpeedAcc||(r=r.applyQuaternion(e),o=o.applyQuaternion(e),this.emitter.bInitSpeedAcc=!0);var s=new THREE.Vector3(0,0,0);switch(a){case t.BOX:s=n.getRandomVector3(r,o);break;case t.SPHERE:s=n.getDirectionVector3OnSphere(this.vec3RealVelocity,this.emitter.position.value,this.emitter.velocity.value.y,this.emitter.velocity.spread.y,r,o);break;case t.DISC:s=n.getRandomVector3OnDisc(r,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x)}return s},MSPE.Particle.prototype._assignColorValue=function(){"use strict";return MSPE.utils.getRandomColor(this.color._value,this.color._spread)},MSPE.Particle.prototype._assignOpacityAbsLifetimeValue=function(){"use strict";var e,t,n=this.opacity,i=MSPE.utils;return t=new Array,i.arrayValuesAreEqual(n._value)&&i.arrayValuesAreEqual(n._spread)?(e=Math.abs(i.randomFloat(n._value[0],n._spread[0])),t.push(e),t.push(e),t.push(e),t.push(e)):(e=Math.abs(i.randomFloat(n._value[0],n._spread[0])),t.push(e),e=Math.abs(i.randomFloat(n._value[1],n._spread[1])),t.push(e),e=Math.abs(i.randomFloat(n._value[2],n._spread[2])),t.push(e),e=Math.abs(i.randomFloat(n._value[3],n._spread[3])),t.push(e)),t},MSPE.Particle.prototype._assignSizeAbsLifetimeValue=function(){"use strict";var e,t,n=this.size,i=MSPE.utils;return t=new Array,i.arrayValuesAreEqual(n._value)&&i.arrayValuesAreEqual(n._spread)?(e=Math.abs(i.randomFloat(n._value[0],n._spread[0])),t.push(e),t.push(e),t.push(e),t.push(e)):(e=Math.abs(i.randomFloat(n._value[0],n._spread[0])),t.push(e),e=Math.abs(i.randomFloat(n._value[1],n._spread[1])),t.push(e),e=Math.abs(i.randomFloat(n._value[2],n._spread[2])),t.push(e),e=Math.abs(i.randomFloat(n._value[3],n._spread[3])),t.push(e)),t},MSPE.Particle.prototype._assignAngleValue=function(){"use strict";var e,t=new Array,n=this.angle,i=MSPE.utils;return i.arrayValuesAreEqual(n._value)&&i.arrayValuesAreEqual(n._spread)?(e=i.randomFloat(n._value[0],n._spread[0]),t.push(e),t.push(e),t.push(e),t.push(e)):(e=i.randomFloat(n._value[0],n._spread[0]),t.push(e),e=i.randomFloat(n._value[1],n._spread[1]),t.push(e),e=i.randomFloat(n._value[2],n._spread[2]),t.push(e),e=i.randomFloat(n._value[3],n._spread[3]),t.push(e)),t},MSPE.Particle.prototype.getRotationMatrix=function(e,t){e=e.normalize();var n=Math.sin(t),i=Math.cos(t),r=1-i;return(new THREE.Matrix4).set(r*e.x*e.x+i,r*e.x*e.y-e.z*n,r*e.z*e.x+e.y*n,0,r*e.x*e.y+e.z*n,r*e.y*e.y+i,r*e.y*e.z-e.x*n,0,r*e.z*e.x-e.y*n,r*e.y*e.z+e.x*n,r*e.z*e.z+i,0,0,0,0,1)},MSPE.Particle.prototype.when_gt=function(e,t){return Math.max(Math.sign(e-t),0)},MSPE.Particle.prototype.when_lt=function(e,t){return Math.min(Math.max(1-Math.sign(e-t),0),1)},MSPE.Particle.prototype.when_eq=function(e,t){return 1-Math.abs(Math.sign(e-t))},MSPE.Particle.prototype.when_ge=function(e,t){return 1-this.when_lt(e,t)},MSPE.Particle.prototype.when_le=function(e,t){return 1-this.when_gt(e,t)},MSPE.Particle.prototype.and=function(e,t){return e*t},MSPE.Particle.prototype.or=function(e,t){return Math.min(e+t,1)},MSPE.Particle.prototype.getFloatOverLifetime=function(e,t){var n=0,i=e*(MSPE.valueOverLifetimeLength-1),r=0;n+=t[0]*this.when_eq(i,0);for(var o=0;o<MSPE.valueOverLifetimeLength-1;++o)r=o,n+=this.and(this.when_gt(i,r),this.when_le(i,r+1))*MSPE.utils.lerp(t[o],t[o+1],i-r);return n},MSPE.Particle.prototype.getColorOverLifetime=function(e,t,n,i,r){var o=new THREE.Vector3(0,0,0),a=new Array;a.push(t.r),a.push(n.r),a.push(i.r),a.push(r.r);var s=new Array;s.push(t.g),s.push(n.g),s.push(i.g),s.push(r.g);var l=new Array;return l.push(t.b),l.push(n.b),l.push(i.b),l.push(r.b),o.x=this.getFloatOverLifetime(e,a),o.y=this.getFloatOverLifetime(e,s),o.z=this.getFloatOverLifetime(e,l),o},MSPE.Particle.prototype.getRotation=function(e,t){if(0==this.fRealRotationAngle)return e;var n,i,r=new THREE.Vector3(this.vec3RealRotationAxis.x,this.vec3RealRotationAxis.y,this.vec3RealRotationAxis.z),o=new THREE.Vector3(this.rotation._center.x,this.rotation._center.y,this.rotation._center.z),a=0;a+=this.when_eq(this.rotation._static?0:1,0)*this.fRealRotationAngle,a+=this.when_gt(this.rotation._static?0:1,0)*MSPE.utils.lerp(0,this.fRealRotationAngle,t),n=o.sub(e),i=this.getRotationMatrix(r,a);var s=new THREE.Vector4(n.x,n.y,n.z,0);s.applyMatrix4(i);var l=new THREE.Vector3(s.x,s.y,s.z);return o.sub(l)},MSPE.Particle.prototype.running=function(e){var t=this.age,n=this.age/this.fRealMaxAge,i=new THREE.Vector3(this.vec3RealPosition.x,this.vec3RealPosition.y,this.vec3RealPosition.z),r=new THREE.Vector3(this.vec3RealVelocity.x,this.vec3RealVelocity.y,this.vec3RealVelocity.z),o=new THREE.Vector3(this.vec3RealAcceleration.x,this.vec3RealAcceleration.y,this.vec3RealAcceleration.z);if(this.emitter.SHOULD_DRAG_PARTICLES){var a=1-.5*n*this.fRealDrag;o=o.multiplyScalar(a)}var s=new THREE.Vector3;s.copy(r),s.multiplyScalar(t);var l=new THREE.Vector3;l.copy(o),l.multiplyScalar(t*t*.5);var u=new THREE.Vector3;if(u.copy(i),u.add(s.add(l)),this.emitter.SHOULD_WIGGLE_PARTICLES){var c=n*this.fRealWiggle*Math.PI,h=Math.sin(c),p=Math.cos(c);u.x+=h,u.y+=p,u.z+=h}if(this.emitter.SHOULD_ROTATE_PARTICLES&&(u=this.getRotation(u,n)),this.vec3Position=u,this.emitter.SHOULD_SIZE_PARTICLES){var d=this.getFloatOverLifetime(n,this.arrayRealSize);this.vec3Scale=new THREE.Vector3(d,d,d)}if(this.emitter.isLookAtCamera||this.emitter.isLookAtCameraOnlyY){if(this.emitter.isLookAtCamera)f=(f=new THREE.Euler).setFromQuaternion(e.quaternion),this.vec3Rotation=f;else if(this.emitter.isLookAtCameraOnlyY){var f;f=(f=new THREE.Euler).setFromQuaternion(e.quaternion),this.vec3Rotation=new THREE.Euler(0,f.z,0,"XYZ")}}else if(this.emitter.SHOULD_ANGLE_PARTICLES){var m=this.getFloatOverLifetime(n,this.arrayRealAngle);this.vec3Rotation=new THREE.Euler(m,m,m)}if(this.emitter.group.bEnableTrail){var g=MSPE.utils.clock().getElapsedTime();this.trailRenderHelper.tick({uuid:this.uuidTrial,timeNow:g,position:this.vec3Position,rotation:this.vec3Rotation})}if(MSPE.utils.setMatrix(this.vec3Position,this.vec3Rotation,this.vec3Scale,this.matrix),this.emitter.group.mcol0.setXYZ(this.iBufferIndex,this.matrixElements[0],this.matrixElements[1],this.matrixElements[2]),this.emitter.group.mcol1.setXYZ(this.iBufferIndex,this.matrixElements[4],this.matrixElements[5],this.matrixElements[6]),this.emitter.group.mcol2.setXYZ(this.iBufferIndex,this.matrixElements[8],this.matrixElements[9],this.matrixElements[10]),this.emitter.group.mcol3.setXYZ(this.iBufferIndex,this.matrixElements[12],this.matrixElements[13],this.matrixElements[14]),this.emitter.SHOULD_COLORIZE_PARTICLES){var v=this.getColorOverLifetime(n,this.arrayRealColor[0],this.arrayRealColor[1],this.arrayRealColor[2],this.arrayRealColor[3]),y=this.getFloatOverLifetime(n,this.arrayRealOpacity);this.emitter.group.bEnableTrail&&null!=this.trailRenderHelper&&null!=this.trailRenderHelper&&this.trailRenderHelper.updateColor({r:v.x,g:v.y,b:v.z,a:y}),this.emitter.group.colors.setXYZW(this.iBufferIndex,v.x,v.y,v.z,y)}},MSPE.Particle.prototype.dispose=function(){"use strict";this.emitter.group.bEnableTrail&&(this.trailRenderHelper.detach(this.uuidTrial),this.trailRenderHelper.dispose(),this.meshTrial&&this.meshTrial.parent&&this.meshTrial.parent.remove(this.meshTrial)),null!=this.obj&&null!=this.obj&&this.obj.setUse(!1)},MSPE.BufferAttributeObjPool=function(e){"use strict";var t=MSPE.utils,n=t.types;if(null!=(e=t.ensureTypedArg(e,n.OBJECT,{})).iCount&&null!=e.iCount&&"number"==typeof e.iCount){this.iCount=e.iCount,this.objPool=new Array;for(var i=0;i<this.iCount;i++){var r=new MSPE.BufferAttributeObj({iIndex:i});this.objPool.push(r)}}else console.error("[MSPE] : [BufferAttributeObjPool] : error options.iCount;")},MSPE.BufferAttributeObjPool.constructor=MSPE.BufferAttributeObjPool,MSPE.BufferAttributeObjPool.prototype.setUse=function(e,t){"use strict";null!=e&&null!=e&&"number"==typeof e?e+1>this.objPool.length?console.error("[MSPE] : [BufferAttributeObjPool] : [setUse] : error iIndex; iIndex = "+e+"; while this.objPool.length = "+this.objPool.length):null!=t&&null!=t&&"boolean"==typeof t?this.objPool[e].setUse(t):console.error("[MSPE] : [BufferAttributeObjPool] : [setUse] : error bU;"):console.error("[MSPE] : [BufferAttributeObjPool] : [setUse] : error iIndex;")},MSPE.BufferAttributeObjPool.prototype.getUse=function(e){"use strict";if(null!=e&&null!=e&&"number"==typeof e){if(!(e+1>this.objPool.length))return this.objPool[e].getUse();console.error("[MSPE] : [BufferAttributeObjPool] : [getUse] : error iIndex; iIndex = "+e+"; while this.objPool.length = "+this.objPool.length)}else console.error("[MSPE] : [BufferAttributeObjPool] : [getUse] : error iIndex;")},MSPE.BufferAttributeObjPool.prototype.takeAnObj=function(){"use strict";for(var e=0,t=this.objPool.length;e<t;e++)if(!this.objPool[e].getUse())return this.objPool[e];return null},MSPE.BufferAttributeObjPool.prototype.reset=function(){"use strict";for(var e=0,t=this.objPool.length;e<t;e++)this.objPool[e].setUse(!1)},MSPE.BufferAttributeObjPool.prototype.dispose=function(){"use strict";for(var e=0,t=this.objPool.length;e<t;e++)this.objPool[e].dispose()},MSPE.BufferAttributeObj=function(e){"use strict";var t=MSPE.utils,n=t.types;null!=(e=t.ensureTypedArg(e,n.OBJECT,{})).iIndex&&null!=e.iIndex&&"number"==typeof e.iIndex?(this.iIndex=e.iIndex,this.bUsed=!1):console.error("[MSPE] : [BufferAttributeObj] : error options.iIndex;")},MSPE.BufferAttributeObj.constructor=MSPE.BufferAttributeObj,MSPE.BufferAttributeObj.prototype.setUse=function(e){"use strict";this.bUsed=e},MSPE.BufferAttributeObj.prototype.getUse=function(){"use strict";return this.bUsed},MSPE.BufferAttributeObj.prototype.dispose=function(){},function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).poly2tri=e()}}((function(){return function e(t,n,i){function r(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};t[a][0].call(c.exports,(function(e){return r(t[a][1][e]||e)}),c,c.exports,e,t,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){t.exports={version:"1.5.0"}},{}],2:[function(e,t,n){"use strict";var i=function(e,t){this.head_=e,this.tail_=t,this.search_node_=e};i.prototype.head=function(){return this.head_},i.prototype.setHead=function(e){this.head_=e},i.prototype.tail=function(){return this.tail_},i.prototype.setTail=function(e){this.tail_=e},i.prototype.search=function(){return this.search_node_},i.prototype.setSearch=function(e){this.search_node_=e},i.prototype.findSearchNode=function(){return this.search_node_},i.prototype.locateNode=function(e){var t=this.search_node_;if(e<t.value){for(;t=t.prev;)if(e>=t.value)return this.search_node_=t,t}else for(;t=t.next;)if(e<t.value)return this.search_node_=t.prev,t.prev;return null},i.prototype.locatePoint=function(e){var t=e.x,n=this.findSearchNode(t),i=n.point.x;if(t===i){if(e!==n.point)if(e===n.prev.point)n=n.prev;else{if(e!==n.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");n=n.next}}else if(t<i)for(;(n=n.prev)&&e!==n.point;);else for(;(n=n.next)&&e!==n.point;);return n&&(this.search_node_=n),n},t.exports=i,t.exports.Node=function(e,t){this.point=e,this.triangle=t||null,this.next=null,this.prev=null,this.value=e.x}},{}],3:[function(e,t,n){"use strict";t.exports=function(e,t){if(!e)throw new Error(t||"Assert Failed")}},{}],4:[function(e,t,n){"use strict";var i=e("./xy"),r=function(e,t){this.x=+e||0,this.y=+t||0,this._p2t_edge_list=null};r.prototype.toString=function(){return i.toStringBase(this)},r.prototype.toJSON=function(){return{x:this.x,y:this.y}},r.prototype.clone=function(){return new r(this.x,this.y)},r.prototype.set_zero=function(){return this.x=0,this.y=0,this},r.prototype.set=function(e,t){return this.x=+e||0,this.y=+t||0,this},r.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},r.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},r.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},r.prototype.mul=function(e){return this.x*=e,this.y*=e,this},r.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},r.prototype.normalize=function(){var e=this.length();return this.x/=e,this.y/=e,e},r.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},r.negate=function(e){return new r(-e.x,-e.y)},r.add=function(e,t){return new r(e.x+t.x,e.y+t.y)},r.sub=function(e,t){return new r(e.x-t.x,e.y-t.y)},r.mul=function(e,t){return new r(e*t.x,e*t.y)},r.cross=function(e,t){return"number"==typeof e?"number"==typeof t?e*t:new r(-e*t.y,e*t.x):"number"==typeof t?new r(t*e.y,-t*e.x):e.x*t.y-e.y*t.x},r.toString=i.toString,r.compare=i.compare,r.cmp=i.compare,r.equals=i.equals,r.dot=function(e,t){return e.x*t.x+e.y*t.y},t.exports=r},{"./xy":11}],5:[function(e,t,n){"use strict";var i=e("./xy"),r=function(e,t){this.name="PointError",this.points=t=t||[],this.message=e||"Invalid Points!";for(var n=0;n<t.length;n++)this.message+=" "+i.toString(t[n])};(r.prototype=new Error).constructor=r,t.exports=r},{"./xy":11}],6:[function(e,t,n){(function(t){"use strict";var i=t.poly2tri;n.noConflict=function(){return t.poly2tri=i,n},n.VERSION=e("../dist/version.json").version,n.PointError=e("./pointerror"),n.Point=e("./point"),n.Triangle=e("./triangle"),n.SweepContext=e("./sweepcontext");var r=e("./sweep");n.triangulate=r.triangulate,n.sweep={Triangulate:r.triangulate}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(e,t,n){"use strict";function i(e,t){var n=e.locateNode(t),i=function(e,t,n){var i=new b(t,n.point,n.next.point);i.markNeighbor(n.triangle),e.addToMap(i);var r=new _(t);return r.next=n.next,r.prev=n,n.next.prev=r,n.next=r,l(e,i)||e.mapTriangleToNodes(i),r}(e,t,n);return t.x<=n.point.x+E&&s(e,n),function(e,t){for(var n=t.next;n.next&&!S(n.point,n.next.point,n.prev.point);)s(e,n),n=n.next;for(n=t.prev;n.prev&&!S(n.point,n.next.point,n.prev.point);)s(e,n),n=n.prev;t.next&&t.next.next&&function(e){var t=e.point.x-e.next.next.point.x,n=e.point.y-e.next.next.point.y;return v(n>=0,"unordered y"),t>=0||Math.abs(t)<n}(t)&&function(e,t){for(T(t.point,t.next.point,t.next.next.point)===w.CCW?e.basin.left_node=t.next.next:e.basin.left_node=t.next,e.basin.bottom_node=e.basin.left_node;e.basin.bottom_node.next&&e.basin.bottom_node.point.y>=e.basin.bottom_node.next.point.y;)e.basin.bottom_node=e.basin.bottom_node.next;if(e.basin.bottom_node!==e.basin.left_node){for(e.basin.right_node=e.basin.bottom_node;e.basin.right_node.next&&e.basin.right_node.point.y<e.basin.right_node.next.point.y;)e.basin.right_node=e.basin.right_node.next;e.basin.right_node!==e.basin.bottom_node&&(e.basin.width=e.basin.right_node.point.x-e.basin.left_node.point.x,e.basin.left_highest=e.basin.left_node.point.y>e.basin.right_node.point.y,function e(t,n){if(!function(e,t){var n;return n=e.basin.left_highest?e.basin.left_node.point.y-t.point.y:e.basin.right_node.point.y-t.point.y,e.basin.width>n}(t,n)&&(s(t,n),n.prev!==t.basin.left_node||n.next!==t.basin.right_node)){if(n.prev===t.basin.left_node){if(T(n.point,n.next.point,n.next.next.point)===w.CW)return;n=n.next}else if(n.next===t.basin.right_node){if(T(n.point,n.prev.point,n.prev.prev.point)===w.CCW)return;n=n.prev}else n=n.prev.point.y<n.next.point.y?n.prev:n.next;e(t,n)}}(e,e.basin.bottom_node))}}(e,t)}(e,i),i}function r(e,t,n){e.edge_event.constrained_edge=t,e.edge_event.right=t.p.x>t.q.x,a(n.triangle,t.p,t.q)||(function(e,t,n){e.edge_event.right?function(e,t,n){for(;n.next.point.x<t.p.x;)T(t.q,n.next.point,t.p)===w.CCW?h(e,t,n):n=n.next}(e,t,n):function(e,t,n){for(;n.prev.point.x>t.p.x;)T(t.q,n.prev.point,t.p)===w.CW?d(e,t,n):n=n.prev}(e,t,n)}(e,t,n),o(e,t.p,t.q,n.triangle,t.q))}function o(e,t,n,i,r){if(!a(i,t,n)){var s=i.pointCCW(r),l=T(n,s,t);if(l===w.COLLINEAR)throw new y("poly2tri EdgeEvent: Collinear not supported!",[n,s,t]);var u=i.pointCW(r),c=T(n,u,t);if(c===w.COLLINEAR)throw new y("poly2tri EdgeEvent: Collinear not supported!",[n,u,t]);l===c?o(e,t,n,i=l===w.CW?i.neighborCCW(r):i.neighborCW(r),r):m(e,t,n,i,r)}}function a(e,t,n){var i=e.edgeIndex(t,n);if(-1!==i){e.markConstrainedEdgeByIndex(i);var r=e.getNeighbor(i);return r&&r.markConstrainedEdgeByPoints(t,n),!0}return!1}function s(e,t){var n=new b(t.prev.point,t.point,t.next.point);n.markNeighbor(t.prev.triangle),n.markNeighbor(t.triangle),e.addToMap(n),t.prev.next=t.next,t.next.prev=t.prev,l(e,n)||e.mapTriangleToNodes(n)}function l(e,t){for(var n=0;n<3;++n)if(!t.delaunay_edge[n]){var i=t.getNeighbor(n);if(i){var r=t.getPoint(n),o=i.oppositePoint(t,r),a=i.index(o);if(i.constrained_edge[a]||i.delaunay_edge[a]){t.constrained_edge[n]=i.constrained_edge[a];continue}if(u(r,t.pointCCW(r),t.pointCW(r),o)){t.delaunay_edge[n]=!0,i.delaunay_edge[a]=!0,c(t,r,i,o);var s=!l(e,t);return s&&e.mapTriangleToNodes(t),(s=!l(e,i))&&e.mapTriangleToNodes(i),t.delaunay_edge[n]=!1,i.delaunay_edge[a]=!1,!0}}}return!1}function u(e,t,n,i){var r=e.x-i.x,o=e.y-i.y,a=t.x-i.x,s=t.y-i.y,l=r*s-a*o;if(l<=0)return!1;var u=n.x-i.x,c=n.y-i.y,h=u*o-r*c;return!(h<=0)&&(r*r+o*o)*(a*c-u*s)+(a*a+s*s)*h+(u*u+c*c)*l>0}function c(e,t,n,i){var r,o,a,s,l,u,c,h,p,d,f,m;r=e.neighborCCW(t),o=e.neighborCW(t),a=n.neighborCCW(i),s=n.neighborCW(i),l=e.getConstrainedEdgeCCW(t),u=e.getConstrainedEdgeCW(t),c=n.getConstrainedEdgeCCW(i),h=n.getConstrainedEdgeCW(i),p=e.getDelaunayEdgeCCW(t),d=e.getDelaunayEdgeCW(t),f=n.getDelaunayEdgeCCW(i),m=n.getDelaunayEdgeCW(i),e.legalize(t,i),n.legalize(i,t),n.setDelaunayEdgeCCW(t,p),e.setDelaunayEdgeCW(t,d),e.setDelaunayEdgeCCW(i,f),n.setDelaunayEdgeCW(i,m),n.setConstrainedEdgeCCW(t,l),e.setConstrainedEdgeCW(t,u),e.setConstrainedEdgeCCW(i,c),n.setConstrainedEdgeCW(i,h),e.clearNeighbors(),n.clearNeighbors(),r&&n.markNeighbor(r),o&&e.markNeighbor(o),a&&e.markNeighbor(a),s&&n.markNeighbor(s),e.markNeighbor(n)}function h(e,t,n){n.point.x<t.p.x&&(T(n.point,n.next.point,n.next.next.point)===w.CCW?p(e,t,n):(function e(t,n,i){T(i.next.point,i.next.next.point,i.next.next.next.point)===w.CCW?p(t,n,i.next):T(n.q,i.next.next.point,n.p)===w.CCW&&e(t,n,i.next)}(e,t,n),h(e,t,n)))}function p(e,t,n){s(e,n.next),n.next.point!==t.p&&T(t.q,n.next.point,t.p)===w.CCW&&T(n.point,n.next.point,n.next.next.point)===w.CCW&&p(e,t,n)}function d(e,t,n){n.point.x>t.p.x&&(T(n.point,n.prev.point,n.prev.prev.point)===w.CW?f(e,t,n):(function e(t,n,i){T(i.prev.point,i.prev.prev.point,i.prev.prev.prev.point)===w.CW?f(t,n,i.prev):T(n.q,i.prev.prev.point,n.p)===w.CW&&e(t,n,i.prev)}(e,t,n),d(e,t,n)))}function f(e,t,n){s(e,n.prev),n.prev.point!==t.p&&T(t.q,n.prev.point,t.p)===w.CW&&T(n.point,n.prev.point,n.prev.prev.point)===w.CW&&f(e,t,n)}function m(e,t,n,i,r){var a=i.neighborAcross(r);v(a,"FLIP failed due to missing triangle!");var s=a.oppositePoint(i,r);if(i.getConstrainedEdgeAcross(r)){var u=i.index(r);throw new y("poly2tri Intersecting Constraints",[r,s,i.getPoint((u+1)%3),i.getPoint((u+2)%3)])}if(M(r,i.pointCCW(r),i.pointCW(r),s))if(c(i,r,a,s),e.mapTriangleToNodes(i),e.mapTriangleToNodes(a),r===n&&s===t)n===e.edge_event.constrained_edge.q&&t===e.edge_event.constrained_edge.p&&(i.markConstrainedEdgeByPoints(t,n),a.markConstrainedEdgeByPoints(t,n),l(e,i),l(e,a));else{i=function(e,t,n,i,r,o){var a;return t===w.CCW?(a=i.edgeIndex(r,o),i.delaunay_edge[a]=!0,l(e,i),i.clearDelaunayEdges(),n):(a=n.edgeIndex(r,o),n.delaunay_edge[a]=!0,l(e,n),n.clearDelaunayEdges(),i)}(e,T(n,s,t),i,a,r,s),m(e,t,n,i,r)}else(function e(t,n,i,r,o,a){var s=o.neighborAcross(a);v(s,"FLIP failed due to missing triangle");var l=s.oppositePoint(o,a);M(i,r.pointCCW(i),r.pointCW(i),l)?m(t,i,l,s,l):e(t,n,i,r,s,g(n,i,s,l))})(e,t,n,i,a,g(t,n,a,s)),o(e,t,n,i,r)}function g(e,t,n,i){var r=T(t,i,e);if(r===w.CW)return n.pointCCW(i);if(r===w.CCW)return n.pointCW(i);throw new y("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,i,e])}var v=e("./assert"),y=e("./pointerror"),b=e("./triangle"),_=e("./advancingfront").Node,x=e("./utils"),E=x.EPSILON,w=x.Orientation,T=x.orient2d,M=x.inScanArea,S=x.isAngleObtuse;n.triangulate=function(e){e.initTriangulation(),e.createAdvancingFront(),function(e){var t,n=e.pointCount();for(t=1;t<n;++t)for(var o=e.getPoint(t),a=i(e,o),s=o._p2t_edge_list,l=0;s&&l<s.length;++l)r(e,s[l],a)}(e),function(e){for(var t=e.front().head().next.triangle,n=e.front().head().next.point;!t.getConstrainedEdgeCW(n);)t=t.neighborCCW(n);e.meshClean(t)}(e)}},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(e,t,n){"use strict";var i=e("./pointerror"),r=e("./point"),o=e("./triangle"),a=e("./sweep"),s=e("./advancingfront"),l=s.Node,u=function(e,t){if(this.p=e,this.q=t,e.y>t.y)this.q=e,this.p=t;else if(e.y===t.y)if(e.x>t.x)this.q=e,this.p=t;else if(e.x===t.x)throw new i("poly2tri Invalid Edge constructor: repeated points!",[e]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},c=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};c.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var h=function(){this.constrained_edge=null,this.right=!1},p=function(e,t){t=t||{},this.triangles_=[],this.map_=[],this.points_=t.cloneArrays?e.slice(0):e,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new c,this.edge_event=new h,this.initEdges(this.points_)};p.prototype.addHole=function(e){this.initEdges(e);var t,n=e.length;for(t=0;t<n;t++)this.points_.push(e[t]);return this},p.prototype.AddHole=p.prototype.addHole,p.prototype.addHoles=function(e){var t,n=e.length;for(t=0;t<n;t++)this.initEdges(e[t]);return this.points_=this.points_.concat.apply(this.points_,e),this},p.prototype.addPoint=function(e){return this.points_.push(e),this},p.prototype.AddPoint=p.prototype.addPoint,p.prototype.addPoints=function(e){return this.points_=this.points_.concat(e),this},p.prototype.triangulate=function(){return a.triangulate(this),this},p.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},p.prototype.getTriangles=function(){return this.triangles_},p.prototype.GetTriangles=p.prototype.getTriangles,p.prototype.front=function(){return this.front_},p.prototype.pointCount=function(){return this.points_.length},p.prototype.head=function(){return this.head_},p.prototype.setHead=function(e){this.head_=e},p.prototype.tail=function(){return this.tail_},p.prototype.setTail=function(e){this.tail_=e},p.prototype.getMap=function(){return this.map_},p.prototype.initTriangulation=function(){var e,t=this.points_[0].x,n=this.points_[0].x,i=this.points_[0].y,o=this.points_[0].y,a=this.points_.length;for(e=1;e<a;e++){var s=this.points_[e];s.x>t&&(t=s.x),s.x<n&&(n=s.x),s.y>i&&(i=s.y),s.y<o&&(o=s.y)}this.pmin_=new r(n,o),this.pmax_=new r(t,i);var l=.3*(t-n),u=.3*(i-o);this.head_=new r(t+l,o-u),this.tail_=new r(n-l,o-u),this.points_.sort(r.compare)},p.prototype.initEdges=function(e){var t,n=e.length;for(t=0;t<n;++t)this.edge_list.push(new u(e[t],e[(t+1)%n]))},p.prototype.getPoint=function(e){return this.points_[e]},p.prototype.addToMap=function(e){this.map_.push(e)},p.prototype.locateNode=function(e){return this.front_.locateNode(e.x)},p.prototype.createAdvancingFront=function(){var e,t,n,i=new o(this.points_[0],this.tail_,this.head_);this.map_.push(i),e=new l(i.getPoint(1),i),t=new l(i.getPoint(0),i),n=new l(i.getPoint(2)),this.front_=new s(e,n),e.next=t,t.next=n,t.prev=e,n.prev=t},p.prototype.removeNode=function(e){},p.prototype.mapTriangleToNodes=function(e){for(var t=0;t<3;++t)if(!e.getNeighbor(t)){var n=this.front_.locatePoint(e.pointCW(e.getPoint(t)));n&&(n.triangle=e)}},p.prototype.removeFromMap=function(e){var t,n=this.map_,i=n.length;for(t=0;t<i;t++)if(n[t]===e){n.splice(t,1);break}},p.prototype.meshClean=function(e){for(var t,n,i=[e];t=i.pop();)if(!t.isInterior())for(t.setInterior(!0),this.triangles_.push(t),n=0;n<3;n++)t.constrained_edge[n]||i.push(t.getNeighbor(n))},t.exports=p},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(e,t,n){"use strict";var i=function(e,t,n){this.points_=[e,t,n],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},r=e("./xy").toString;i.prototype.toString=function(){return"["+r(this.points_[0])+r(this.points_[1])+r(this.points_[2])+"]"},i.prototype.getPoint=function(e){return this.points_[e]},i.prototype.GetPoint=i.prototype.getPoint,i.prototype.getPoints=function(){return this.points_},i.prototype.getNeighbor=function(e){return this.neighbors_[e]},i.prototype.containsPoint=function(e){var t=this.points_;return e===t[0]||e===t[1]||e===t[2]},i.prototype.containsEdge=function(e){return this.containsPoint(e.p)&&this.containsPoint(e.q)},i.prototype.containsPoints=function(e,t){return this.containsPoint(e)&&this.containsPoint(t)},i.prototype.isInterior=function(){return this.interior_},i.prototype.setInterior=function(e){return this.interior_=e,this},i.prototype.markNeighborPointers=function(e,t,n){var i=this.points_;if(e===i[2]&&t===i[1]||e===i[1]&&t===i[2])this.neighbors_[0]=n;else if(e===i[0]&&t===i[2]||e===i[2]&&t===i[0])this.neighbors_[1]=n;else{if(!(e===i[0]&&t===i[1]||e===i[1]&&t===i[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=n}},i.prototype.markNeighbor=function(e){var t=this.points_;e.containsPoints(t[1],t[2])?(this.neighbors_[0]=e,e.markNeighborPointers(t[1],t[2],this)):e.containsPoints(t[0],t[2])?(this.neighbors_[1]=e,e.markNeighborPointers(t[0],t[2],this)):e.containsPoints(t[0],t[1])&&(this.neighbors_[2]=e,e.markNeighborPointers(t[0],t[1],this))},i.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},i.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},i.prototype.pointCW=function(e){var t=this.points_;return e===t[0]?t[2]:e===t[1]?t[0]:e===t[2]?t[1]:null},i.prototype.pointCCW=function(e){var t=this.points_;return e===t[0]?t[1]:e===t[1]?t[2]:e===t[2]?t[0]:null},i.prototype.neighborCW=function(e){return e===this.points_[0]?this.neighbors_[1]:e===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},i.prototype.neighborCCW=function(e){return e===this.points_[0]?this.neighbors_[2]:e===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},i.prototype.getConstrainedEdgeCW=function(e){return e===this.points_[0]?this.constrained_edge[1]:e===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},i.prototype.getConstrainedEdgeCCW=function(e){return e===this.points_[0]?this.constrained_edge[2]:e===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},i.prototype.getConstrainedEdgeAcross=function(e){return e===this.points_[0]?this.constrained_edge[0]:e===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},i.prototype.setConstrainedEdgeCW=function(e,t){e===this.points_[0]?this.constrained_edge[1]=t:e===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t},i.prototype.setConstrainedEdgeCCW=function(e,t){e===this.points_[0]?this.constrained_edge[2]=t:e===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t},i.prototype.getDelaunayEdgeCW=function(e){return e===this.points_[0]?this.delaunay_edge[1]:e===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},i.prototype.getDelaunayEdgeCCW=function(e){return e===this.points_[0]?this.delaunay_edge[2]:e===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},i.prototype.setDelaunayEdgeCW=function(e,t){e===this.points_[0]?this.delaunay_edge[1]=t:e===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t},i.prototype.setDelaunayEdgeCCW=function(e,t){e===this.points_[0]?this.delaunay_edge[2]=t:e===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t},i.prototype.neighborAcross=function(e){return e===this.points_[0]?this.neighbors_[0]:e===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},i.prototype.oppositePoint=function(e,t){var n=e.pointCW(t);return this.pointCW(n)},i.prototype.legalize=function(e,t){var n=this.points_;if(e===n[0])n[1]=n[0],n[0]=n[2],n[2]=t;else if(e===n[1])n[2]=n[1],n[1]=n[0],n[0]=t;else{if(e!==n[2])throw new Error("poly2tri Invalid Triangle.legalize() call");n[0]=n[2],n[2]=n[1],n[1]=t}},i.prototype.index=function(e){var t=this.points_;if(e===t[0])return 0;if(e===t[1])return 1;if(e===t[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},i.prototype.edgeIndex=function(e,t){var n=this.points_;if(e===n[0]){if(t===n[1])return 2;if(t===n[2])return 1}else if(e===n[1]){if(t===n[2])return 0;if(t===n[0])return 2}else if(e===n[2]){if(t===n[0])return 1;if(t===n[1])return 0}return-1},i.prototype.markConstrainedEdgeByIndex=function(e){this.constrained_edge[e]=!0},i.prototype.markConstrainedEdgeByEdge=function(e){this.markConstrainedEdgeByPoints(e.p,e.q)},i.prototype.markConstrainedEdgeByPoints=function(e,t){var n=this.points_;t===n[0]&&e===n[1]||t===n[1]&&e===n[0]?this.constrained_edge[2]=!0:t===n[0]&&e===n[2]||t===n[2]&&e===n[0]?this.constrained_edge[1]=!0:(t===n[1]&&e===n[2]||t===n[2]&&e===n[1])&&(this.constrained_edge[0]=!0)},t.exports=i},{"./xy":11}],10:[function(e,t,n){"use strict";var i=1e-12;n.EPSILON=i;var r={CW:1,CCW:-1,COLLINEAR:0};n.Orientation=r,n.orient2d=function(e,t,n){var o=(e.x-n.x)*(t.y-n.y)-(e.y-n.y)*(t.x-n.x);return o>-i&&o<i?r.COLLINEAR:o>0?r.CCW:r.CW},n.inScanArea=function(e,t,n,r){return!((e.x-t.x)*(r.y-t.y)-(r.x-t.x)*(e.y-t.y)>=-i||(e.x-n.x)*(r.y-n.y)-(r.x-n.x)*(e.y-n.y)<=i)},n.isAngleObtuse=function(e,t,n){var i=t.x-e.x,r=t.y-e.y;return i*(n.x-e.x)+r*(n.y-e.y)<0}},{}],11:[function(e,t,n){"use strict";function i(e){return"("+e.x+";"+e.y+")"}t.exports={toString:function(e){var t=e.toString();return"[object Object]"===t?i(e):t},toStringBase:i,compare:function(e,t){return e.y===t.y?e.x-t.x:e.y-t.y},equals:function(e,t){return e.x===t.x&&e.y===t.y}}},{}]},{},[6])(6)})),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).polylabel=e()}}((function(){return function e(t,n,i){function r(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};t[a][0].call(c.exports,(function(e){var n=t[a][1][e];return r(n||e)}),c,c.exports,e,t,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){"use strict";var i=e("tinyqueue");function r(e,t,n){var r,s,l,u;t=t||1;for(var c=0;c<e[0].length;c++){var h=e[0][c];(!c||h[0]<r)&&(r=h[0]),(!c||h[1]<s)&&(s=h[1]),(!c||h[0]>l)&&(l=h[0]),(!c||h[1]>u)&&(u=h[1])}var p=l-r,d=u-s,f=Math.min(p,d),m=f/2,g=new i(null,o);if(0===f)return[r,s];for(var v=r;v<l;v+=f)for(var y=s;y<u;y+=f)g.push(new a(v+m,y+m,m,e));var b=function(e){for(var t=0,n=0,i=0,r=e[0],o=0,s=r.length,l=s-1;o<s;l=o++){var u=r[o],c=r[l],h=u[0]*c[1]-c[0]*u[1];n+=(u[0]+c[0])*h,i+=(u[1]+c[1])*h,t+=3*h}return 0===t?new a(r[0][0],r[0][1],0,e):new a(n/t,i/t,0,e)}(e),_=new a(r+p/2,s+d/2,0,e);_.d>b.d&&(b=_);for(var x=g.length;g.length;){var E=g.pop();E.d>b.d&&(b=E,n&&console.log("found best %d after %d probes",Math.round(1e4*E.d)/1e4,x)),E.max-b.d<=t||(m=E.h/2,g.push(new a(E.x-m,E.y-m,m,e)),g.push(new a(E.x+m,E.y-m,m,e)),g.push(new a(E.x-m,E.y+m,m,e)),g.push(new a(E.x+m,E.y+m,m,e)),x+=4)}return n&&(console.log("num probes: "+x),console.log("best distance: "+b.d)),[b.x,b.y]}function o(e,t){return t.max-e.max}function a(e,t,n,i){this.x=e,this.y=t,this.h=n,this.d=function(e,t,n){for(var i=!1,r=1/0,o=0;o<n.length;o++)for(var a=n[o],l=0,u=a.length,c=u-1;l<u;c=l++){var h=a[l],p=a[c];h[1]>t!=p[1]>t&&e<(p[0]-h[0])*(t-h[1])/(p[1]-h[1])+h[0]&&(i=!i),r=Math.min(r,s(e,t,h,p))}return(i?1:-1)*Math.sqrt(r)}(e,t,i),this.max=this.d+this.h*Math.SQRT2}function s(e,t,n,i){var r=n[0],o=n[1],a=i[0]-r,s=i[1]-o;if(0!==a||0!==s){var l=((e-r)*a+(t-o)*s)/(a*a+s*s);l>1?(r=i[0],o=i[1]):l>0&&(r+=a*l,o+=s*l)}return(a=e-r)*a+(s=t-o)*s}t.exports=r,t.exports.default=r},{tinyqueue:2}],2:[function(e,t,n){"use strict";function i(e,t){if(!(this instanceof i))return new i(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||r,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)}function r(e,t){return e<t?-1:e>t?1:0}t.exports=i,t.exports.default=i,i.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,n=this.compare,i=t[e];e>0;){var r=e-1>>1,o=t[r];if(n(i,o)>=0)break;t[e]=o,e=r}t[e]=i},_down:function(e){for(var t=this.data,n=this.compare,i=this.length>>1,r=t[e];e<i;){var o=1+(e<<1),a=o+1,s=t[o];if(a<this.length&&n(t[a],s)<0&&(o=a,s=t[a]),n(s,r)>=0)break;t[e]=s,e=o}t[e]=r}}},{}]},{},[1])(1)})),SimpleHeatmap.getInstance=function(){var e=null;return function(){return e||(e=new SimpleHeatmap),e}}(),SimpleHeatmap.prototype=Object.assign(Object.create({}),{constructor:SimpleHeatmap,defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},canvas:function(){return this._canvas},data:function(e){return this._data=e,this._dataDirty=!0,this},add:function(e){return this._data.push(e),this._dataDirty=!0,this},clear:function(){return this._data=[],this._dataDirty=!0,this},max:function(e){return this._max!==e&&(this._max=e,this._dataDirty=!0),this},min:function(e){return this._min!==e&&(this._min=e,this._dataDirty=!0),this},setCanvasSize:function(e,t){return this._canvasWidth===e&&this._canvasHeight===t||(this._canvasWidth=this._canvas.width=e,this._canvasHeight=this._canvas.height=t,this._dataDirty=!0),this},setAreaSize:function(e,t){return this._areaWidth===e&&this._areaHeight===t||(this._areaWidth=e,this._areaHeight=t,this._dataDirty=!0),this},alpha:function(e){return this._alpha=e,this},radius:function(e,t){if(t=void 0!==t?t:15,e===this._radius&&t===this._blur)return this;this._radius=e,this._blur=t,this._r=this._radius+this._blur;var n=this._circle,i=this._cirCtx;return n.width=n.height=2*this._r,i.shadowOffsetX=i.shadowOffsetY=2*this._r,i.shadowBlur=t,i.shadowColor="black",i.beginPath(),i.arc(-this._r,-this._r,e,0,2*Math.PI,!0),i.closePath(),i.fill(),this},gradient:function(e){var t=this._getGradientCode(this._grad),n=this._getGradientCode(e);if(t===n)return this;if(this._grad=Object.assign({},e),this._gradCache[n])return this._gradData=this._gradCache[n],this;var i=this._gradCtx.createLinearGradient(0,0,0,256);for(var r in e)i.addColorStop(+r,e[r]);return this._gradCtx.fillStyle=i,this._gradCtx.fillRect(0,0,1,256),this._gradData=this._gradCtx.getImageData(0,0,1,256).data,this._gradCache[n]=this._gradData,this},draw:function(){0===this._r&&this.radius(this.defaultRadius),this._gradData||this.gradient(this.defaultGradient),this._dataDirty&&this._transformData();var e=this._ctx;e.clearRect(0,0,this._canvasWidth,this._canvasHeight);for(var t,n=0,i=this._transformedData.length;n<i;n++)t=this._transformedData[n],e.globalAlpha=t[2],e.drawImage(this._circle,t[0]-this._r,t[1]-this._r);var r=e.getImageData(0,0,this._canvasWidth,this._canvasHeight);return this._colorize(r.data,this._gradData,this._alpha),e.putImageData(r,0,0),this},_transformData:function(){this._transformedData=[];var e=this._canvasWidth/this._areaWidth,t=this._canvasHeight/this._areaHeight,n=this;this._data.map((function(i){var r=i[0],o=i[1];r=r*e+n._canvasWidth/2,o=o*t+n._canvasHeight/2;var a=Math.min(Math.max((i[2]-n._min)/(n._max-n._min),.05),1);n._transformedData.push([r,o,a])}))},_colorize:function(e,t,n){for(var i,r=0,o=e.length;r<o;r+=4)i=4*e[r+3],n&&0===i||(e[r]=t[i],e[r+1]=t[i+1],e[r+2]=t[i+2],n||(e[r+3]=255))},_getGradientCode:function(e){var t="grad:(";for(var n in e)t+=n+":"+e[n]+",";return t+=")"},_createCanvas:function(){return"undefined"!=typeof document?document.createElement("canvas"):new this._canvas.constructor}}),function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;try{t=window}catch(e){t=self}t.SparkMD5=e()}}((function(e){"use strict";var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(e,t){var n=e[0],i=e[1],r=e[2],o=e[3];i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&r|~i&o)+t[0]-680876936|0)<<7|n>>>25)+i|0)&i|~n&r)+t[1]-389564586|0)<<12|o>>>20)+n|0)&n|~o&i)+t[2]+606105819|0)<<17|r>>>15)+o|0)&o|~r&n)+t[3]-1044525330|0)<<22|i>>>10)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&r|~i&o)+t[4]-176418897|0)<<7|n>>>25)+i|0)&i|~n&r)+t[5]+1200080426|0)<<12|o>>>20)+n|0)&n|~o&i)+t[6]-1473231341|0)<<17|r>>>15)+o|0)&o|~r&n)+t[7]-45705983|0)<<22|i>>>10)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&r|~i&o)+t[8]+1770035416|0)<<7|n>>>25)+i|0)&i|~n&r)+t[9]-1958414417|0)<<12|o>>>20)+n|0)&n|~o&i)+t[10]-42063|0)<<17|r>>>15)+o|0)&o|~r&n)+t[11]-1990404162|0)<<22|i>>>10)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&r|~i&o)+t[12]+1804603682|0)<<7|n>>>25)+i|0)&i|~n&r)+t[13]-40341101|0)<<12|o>>>20)+n|0)&n|~o&i)+t[14]-1502002290|0)<<17|r>>>15)+o|0)&o|~r&n)+t[15]+1236535329|0)<<22|i>>>10)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&o|r&~o)+t[1]-165796510|0)<<5|n>>>27)+i|0)&r|i&~r)+t[6]-1069501632|0)<<9|o>>>23)+n|0)&i|n&~i)+t[11]+643717713|0)<<14|r>>>18)+o|0)&n|o&~n)+t[0]-373897302|0)<<20|i>>>12)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&o|r&~o)+t[5]-701558691|0)<<5|n>>>27)+i|0)&r|i&~r)+t[10]+38016083|0)<<9|o>>>23)+n|0)&i|n&~i)+t[15]-660478335|0)<<14|r>>>18)+o|0)&n|o&~n)+t[4]-405537848|0)<<20|i>>>12)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&o|r&~o)+t[9]+568446438|0)<<5|n>>>27)+i|0)&r|i&~r)+t[14]-1019803690|0)<<9|o>>>23)+n|0)&i|n&~i)+t[3]-187363961|0)<<14|r>>>18)+o|0)&n|o&~n)+t[8]+1163531501|0)<<20|i>>>12)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&o|r&~o)+t[13]-1444681467|0)<<5|n>>>27)+i|0)&r|i&~r)+t[2]-51403784|0)<<9|o>>>23)+n|0)&i|n&~i)+t[7]+1735328473|0)<<14|r>>>18)+o|0)&n|o&~n)+t[12]-1926607734|0)<<20|i>>>12)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i^r^o)+t[5]-378558|0)<<4|n>>>28)+i|0)^i^r)+t[8]-2022574463|0)<<11|o>>>21)+n|0)^n^i)+t[11]+1839030562|0)<<16|r>>>16)+o|0)^o^n)+t[14]-35309556|0)<<23|i>>>9)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i^r^o)+t[1]-1530992060|0)<<4|n>>>28)+i|0)^i^r)+t[4]+1272893353|0)<<11|o>>>21)+n|0)^n^i)+t[7]-155497632|0)<<16|r>>>16)+o|0)^o^n)+t[10]-1094730640|0)<<23|i>>>9)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i^r^o)+t[13]+681279174|0)<<4|n>>>28)+i|0)^i^r)+t[0]-358537222|0)<<11|o>>>21)+n|0)^n^i)+t[3]-722521979|0)<<16|r>>>16)+o|0)^o^n)+t[6]+76029189|0)<<23|i>>>9)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i^r^o)+t[9]-640364487|0)<<4|n>>>28)+i|0)^i^r)+t[12]-421815835|0)<<11|o>>>21)+n|0)^n^i)+t[15]+530742520|0)<<16|r>>>16)+o|0)^o^n)+t[2]-995338651|0)<<23|i>>>9)+r|0,i=((i+=((o=((o+=(i^((n=((n+=(r^(i|~o))+t[0]-198630844|0)<<6|n>>>26)+i|0)|~r))+t[7]+1126891415|0)<<10|o>>>22)+n|0)^((r=((r+=(n^(o|~i))+t[14]-1416354905|0)<<15|r>>>17)+o|0)|~n))+t[5]-57434055|0)<<21|i>>>11)+r|0,i=((i+=((o=((o+=(i^((n=((n+=(r^(i|~o))+t[12]+1700485571|0)<<6|n>>>26)+i|0)|~r))+t[3]-1894986606|0)<<10|o>>>22)+n|0)^((r=((r+=(n^(o|~i))+t[10]-1051523|0)<<15|r>>>17)+o|0)|~n))+t[1]-2054922799|0)<<21|i>>>11)+r|0,i=((i+=((o=((o+=(i^((n=((n+=(r^(i|~o))+t[8]+1873313359|0)<<6|n>>>26)+i|0)|~r))+t[15]-30611744|0)<<10|o>>>22)+n|0)^((r=((r+=(n^(o|~i))+t[6]-1560198380|0)<<15|r>>>17)+o|0)|~n))+t[13]+1309151649|0)<<21|i>>>11)+r|0,i=((i+=((o=((o+=(i^((n=((n+=(r^(i|~o))+t[4]-145523070|0)<<6|n>>>26)+i|0)|~r))+t[11]-1120210379|0)<<10|o>>>22)+n|0)^((r=((r+=(n^(o|~i))+t[2]+718787259|0)<<15|r>>>17)+o|0)|~n))+t[9]-343485551|0)<<21|i>>>11)+r|0,e[0]=n+e[0]|0,e[1]=i+e[1]|0,e[2]=r+e[2]|0,e[3]=o+e[3]|0}function i(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function r(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n}function o(e){var t,r,o,a,s,l,u=e.length,c=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=u;t+=64)n(c,i(e.substring(t-64,t)));for(r=(e=e.substring(t-64)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)o[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(n(c,o),t=0;t<16;t+=1)o[t]=0;return a=(a=8*u).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),l=parseInt(a[1],16)||0,o[14]=s,o[15]=l,n(c,o),c}function a(e){var n,i="";for(n=0;n<4;n+=1)i+=t[e>>8*n+4&15]+t[e>>8*n&15];return i}function s(e){var t;for(t=0;t<e.length;t+=1)e[t]=a(e[t]);return e.join("")}function l(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function u(e){var t,n=[],i=e.length;for(t=0;t<i-1;t+=2)n.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,n)}function c(){this.reset()}return"5d41402abc4b2a76b9719d911017c592"!==s(o("hello"))&&function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(n,i){var r,o,a,s,l=this.byteLength,u=t(n,l),c=l;return i!==e&&(c=t(i,l)),u>c?new ArrayBuffer(0):(r=c-u,o=new ArrayBuffer(r),a=new Uint8Array(o),s=new Uint8Array(this,u,r),a.set(s),o)}}(),c.prototype.append=function(e){return this.appendBinary(l(e)),this},c.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,r=this._buff.length;for(t=64;t<=r;t+=64)n(this._hash,i(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},c.prototype.end=function(e){var t,n,i=this._buff,r=i.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<r;t+=1)o[t>>2]|=i.charCodeAt(t)<<(t%4<<3);return this._finish(o,r),n=s(this._hash),e&&(n=u(n)),this.reset(),n},c.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},c.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},c.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},c.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},c.prototype._finish=function(e,t){var i,r,o,a=t;if(e[a>>2]|=128<<(a%4<<3),a>55)for(n(this._hash,e),a=0;a<16;a+=1)e[a]=0;i=(i=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(i[2],16),o=parseInt(i[1],16)||0,e[14]=r,e[15]=o,n(this._hash,e)},c.hash=function(e,t){return c.hashBinary(l(e),t)},c.hashBinary=function(e,t){var n=s(o(e));return t?u(n):n},c.ArrayBuffer=function(){this.reset()},c.ArrayBuffer.prototype.append=function(e){var t,i,o,a,s,l=(i=this._buff.buffer,o=e,a=!0,(s=new Uint8Array(i.byteLength+o.byteLength)).set(new Uint8Array(i)),s.set(new Uint8Array(o),i.byteLength),a?s:s.buffer),u=l.length;for(this._length+=e.byteLength,t=64;t<=u;t+=64)n(this._hash,r(l.subarray(t-64,t)));return this._buff=t-64<u?new Uint8Array(l.buffer.slice(t-64)):new Uint8Array(0),this},c.ArrayBuffer.prototype.end=function(e){var t,n,i=this._buff,r=i.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<r;t+=1)o[t>>2]|=i[t]<<(t%4<<3);return this._finish(o,r),n=s(this._hash),e&&(n=u(n)),this.reset(),n},c.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},c.ArrayBuffer.prototype.getState=function(){var e,t=c.prototype.getState.call(this);return t.buff=(e=t.buff,String.fromCharCode.apply(null,new Uint8Array(e))),t},c.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var n,i=e.length,r=new ArrayBuffer(i),o=new Uint8Array(r);for(n=0;n<i;n+=1)o[n]=e.charCodeAt(n);return t?o:r}(e.buff,!0),c.prototype.setState.call(this,e)},c.ArrayBuffer.prototype.destroy=c.prototype.destroy,c.ArrayBuffer.prototype._finish=c.prototype._finish,c.ArrayBuffer.hash=function(e,t){var i=s(function(e){var t,i,o,a,s,l,u=e.length,c=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=u;t+=64)n(c,r(e.subarray(t-64,t)));for(i=(e=t-64<u?e.subarray(t-64):new Uint8Array(0)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<i;t+=1)o[t>>2]|=e[t]<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(n(c,o),t=0;t<16;t+=1)o[t]=0;return a=(a=8*u).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),l=parseInt(a[1],16)||0,o[14]=s,o[15]=l,n(c,o),c}(new Uint8Array(e)));return t?u(i):i},c}));var SPE={distributions:{BOX:1,SPHERE:2,DISC:3},valueOverLifetimeLength:4};function TextEncoderLite(){}function TextDecoderLite(){}"function"==typeof define&&define.amd?define("spe",SPE):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=SPE),SPE.TypedArrayHelper=function(e,t,n,i){"use strict";this.componentSize=n||1,this.size=t||1,this.TypedArrayConstructor=e||Float32Array,this.array=new e(t*this.componentSize),this.indexOffset=i||0},SPE.TypedArrayHelper.constructor=SPE.TypedArrayHelper,SPE.TypedArrayHelper.prototype.setSize=function(e,t){"use strict";var n=this.array.length;return t||(e*=this.componentSize),e<n?this.shrink(e):e>n?this.grow(e):void console.info("TypedArray is already of size:",e+".","Will not resize.")},SPE.TypedArrayHelper.prototype.shrink=function(e){"use strict";return this.array=this.array.subarray(0,e),this.size=e,this},SPE.TypedArrayHelper.prototype.grow=function(e){"use strict";var t=this.array,n=new this.TypedArrayConstructor(e);return n.set(t),this.array=n,this.size=e,this},SPE.TypedArrayHelper.prototype.splice=function(e,t){"use strict";e*=this.componentSize,t*=this.componentSize;for(var n=[],i=this.array,r=i.length,o=0;o<r;++o)(o<e||o>=t)&&n.push(i[o]);return this.setFromArray(0,n),this},SPE.TypedArrayHelper.prototype.setFromArray=function(e,t){"use strict";var n=e+t.length;return n>this.array.length?this.grow(n):n<this.array.length&&this.shrink(n),this.array.set(t,this.indexOffset+e),this},SPE.TypedArrayHelper.prototype.setVec2=function(e,t){"use strict";return this.setVec2Components(e,t.x,t.y)},SPE.TypedArrayHelper.prototype.setVec2Components=function(e,t,n){"use strict";var i=this.array,r=this.indexOffset+e*this.componentSize;return i[r]=t,i[r+1]=n,this},SPE.TypedArrayHelper.prototype.setVec3=function(e,t){"use strict";return this.setVec3Components(e,t.x,t.y,t.z)},SPE.TypedArrayHelper.prototype.setVec3Components=function(e,t,n,i){"use strict";var r=this.array,o=this.indexOffset+e*this.componentSize;return r[o]=t,r[o+1]=n,r[o+2]=i,this},SPE.TypedArrayHelper.prototype.setVec4=function(e,t){"use strict";return this.setVec4Components(e,t.x,t.y,t.z,t.w)},SPE.TypedArrayHelper.prototype.setVec4Components=function(e,t,n,i,r){"use strict";var o=this.array,a=this.indexOffset+e*this.componentSize;return o[a]=t,o[a+1]=n,o[a+2]=i,o[a+3]=r,this},SPE.TypedArrayHelper.prototype.setMat3=function(e,t){"use strict";return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)},SPE.TypedArrayHelper.prototype.setMat4=function(e,t){"use strict";return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)},SPE.TypedArrayHelper.prototype.setColor=function(e,t){"use strict";return this.setVec3Components(e,t.r,t.g,t.b)},SPE.TypedArrayHelper.prototype.setNumber=function(e,t){"use strict";return this.array[this.indexOffset+e*this.componentSize]=t,this},SPE.TypedArrayHelper.prototype.getValueAtIndex=function(e){"use strict";return this.array[this.indexOffset+e]},SPE.TypedArrayHelper.prototype.getComponentValueAtIndex=function(e){"use strict";return this.array.subarray(this.indexOffset+e*this.componentSize)},SPE.ShaderAttribute=function(e,t,n){"use strict";var i=SPE.ShaderAttribute.typeSizeMap;this.type="string"==typeof e&&i.hasOwnProperty(e)?e:"f",this.componentSize=i[this.type],this.arrayType=n||Float32Array,this.typedArray=null,this.bufferAttribute=null,this.dynamicBuffer=!!t,this.updateMin=0,this.updateMax=0},SPE.ShaderAttribute.constructor=SPE.ShaderAttribute,SPE.ShaderAttribute.typeSizeMap={f:1,v2:2,v3:3,v4:4,c:3,m3:9,m4:16},SPE.ShaderAttribute.prototype.setUpdateRange=function(e,t){"use strict";this.updateMin=Math.min(e*this.componentSize,this.updateMin*this.componentSize),this.updateMax=Math.max(t*this.componentSize,this.updateMax*this.componentSize)},SPE.ShaderAttribute.prototype.flagUpdate=function(){"use strict";var e=this.bufferAttribute,t=e.updateRange;t.offset=this.updateMin,t.count=Math.min(this.updateMax-this.updateMin+this.componentSize,this.typedArray.array.length),e.needsUpdate=!0},SPE.ShaderAttribute.prototype.resetUpdateRange=function(){"use strict";this.updateMin=0,this.updateMax=0},SPE.ShaderAttribute.prototype.resetDynamic=function(){"use strict";this.bufferAttribute.setUsage(!0===this.dynamicBuffer?THREE.DynamicDrawUsage:THREE.StaticDrawUsage)},SPE.ShaderAttribute.prototype.splice=function(e,t){"use strict";this.typedArray.splice(e,t),this.forceUpdateAll()},SPE.ShaderAttribute.prototype.forceUpdateAll=function(){"use strict";this.bufferAttribute.array=this.typedArray.array,this.bufferAttribute.updateRange.offset=0,this.bufferAttribute.updateRange.count=-1,this.bufferAttribute.setUsage(THREE.StaticDrawUsage),this.bufferAttribute.needsUpdate=!0},SPE.ShaderAttribute.prototype._ensureTypedArray=function(e){"use strict";null!==this.typedArray&&this.typedArray.size===e*this.componentSize||(null!==this.typedArray&&this.typedArray.size!==e?this.typedArray.setSize(e):null===this.typedArray&&(this.typedArray=new SPE.TypedArrayHelper(this.arrayType,e,this.componentSize)))},SPE.ShaderAttribute.prototype._createBufferAttribute=function(e){"use strict";if(this._ensureTypedArray(e),null!==this.bufferAttribute)return this.bufferAttribute.array=this.typedArray.array,parseFloat(THREE.REVISION)>=81&&(this.bufferAttribute.count=this.bufferAttribute.array.length/this.bufferAttribute.itemSize),void(this.bufferAttribute.needsUpdate=!0);this.bufferAttribute=new THREE.BufferAttribute(this.typedArray.array,this.componentSize),this.bufferAttribute.setUsage(!0===this.dynamicBuffer?THREE.DynamicDrawUsage:THREE.StaticDrawUsage)},SPE.ShaderAttribute.prototype.getLength=function(){"use strict";return null===this.typedArray?0:this.typedArray.array.length},SPE.shaderChunks={defines:["#define PACKED_COLOR_SIZE 256.0","#define PACKED_COLOR_DIVISOR 255.0"].join("\n"),uniforms:["uniform float deltaTime;","uniform float runTime;","uniform sampler2D tex;","uniform vec4 textureAnimation;","uniform float scale;"].join("\n"),attributes:["attribute vec4 acceleration;","attribute vec3 velocity;","attribute vec4 rotation;","attribute vec3 rotationCenter;","attribute vec4 params;","attribute vec4 size;","attribute vec4 angle;","attribute vec4 color;","attribute vec4 opacity;","attribute vec4 trail;"].join("\n"),varyings:["varying vec4 vColor;","//#ifdef SHOULD_ROTATE_TEXTURE","    varying float vAngle;","//#endif","#ifdef SHOULD_CALCULATE_SPRITE","    varying vec4 vSpriteSheet;","#endif","#ifdef SHOULD_TRAIL_PARTICLES","    varying float fTrailSpeed;","    varying vec4 vec4Path_0;","    varying vec4 vec4Path_1;","    varying vec4 vec4Path_2;","    varying vec4 vec4Path_3;","    varying vec4 vec4Path_4;","    varying vec4 vec4Path_5;","    varying vec4 vec4Path_6;","    varying vec4 vec4Path_7;","    varying vec4 vec4Path_8;","    varying vec4 vec4Path_9;","#endif"].join("\n"),branchAvoidanceFunctions:["float when_gt(float x, float y) {","    return max(sign(x - y), 0.0);","}","float when_lt(float x, float y) {","    return min( max(1.0 - sign(x - y), 0.0), 1.0 );","}","float when_eq( float x, float y ) {","    return 1.0 - abs( sign( x - y ) );","}","float when_ge(float x, float y) {","  return 1.0 - when_lt(x, y);","}","float when_le(float x, float y) {","  return 1.0 - when_gt(x, y);","}","float and(float a, float b) {","    return a * b;","}","float or(float a, float b) {","    return min(a + b, 1.0);","}"].join("\n"),unpackColor:["vec3 unpackColor( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   return c;","}"].join("\n"),unpackRotationAxis:["vec3 unpackRotationAxis( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   c *= vec3( 2.0 );","   c -= vec3( 1.0 );","   return c;","}"].join("\n"),floatOverLifetime:["float getFloatOverLifetime( in float positionInTime, in vec4 attr ) {","    highp float value = 0.0;","    float deltaAge = positionInTime * float( VALUE_OVER_LIFETIME_LENGTH - 1 );","    float fIndex = 0.0;","    float shouldApplyValue = 0.0;","    value += attr[ 0 ] * when_eq( deltaAge, 0.0 );","","    for( int i = 0; i < VALUE_OVER_LIFETIME_LENGTH - 1; ++i ) {","       fIndex = float( i );","       shouldApplyValue = and( when_gt( deltaAge, fIndex ), when_le( deltaAge, fIndex + 1.0 ) );","       value += shouldApplyValue * mix( attr[ i ], attr[ i + 1 ], deltaAge - fIndex );","    }","","    return value;","}"].join("\n"),colorOverLifetime:["vec3 getColorOverLifetime( in float positionInTime, in vec3 color1, in vec3 color2, in vec3 color3, in vec3 color4 ) {","    vec3 value = vec3( 0.0 );","    value.x = getFloatOverLifetime( positionInTime, vec4( color1.x, color2.x, color3.x, color4.x ) );","    value.y = getFloatOverLifetime( positionInTime, vec4( color1.y, color2.y, color3.y, color4.y ) );","    value.z = getFloatOverLifetime( positionInTime, vec4( color1.z, color2.z, color3.z, color4.z ) );","    return value;","}"].join("\n"),paramFetchingFunctions:["float getAlive() {","   return params.x;","}","float getAge() {","   return params.y;","}","float getMaxAge() {","   return params.z;","}","float getWiggle() {","   return params.w;","}"].join("\n"),forceFetchingFunctions:["vec4 getPosition( in float age ) {","   return modelViewMatrix * vec4( position, 1.0 );","}","vec3 getVelocity( in float age ) {","   return velocity * age;","}","vec3 getAcceleration( in float age ) {","   return acceleration.xyz * age;","}"].join("\n"),rotationFunctions:["#ifdef SHOULD_ROTATE_PARTICLES","   mat4 getRotationMatrix( in vec3 axis, in float angle) {","       axis = normalize(axis);","       float s = sin(angle);","       float c = cos(angle);","       float oc = 1.0 - c;","","       return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,","                   oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,","                   oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,","                   0.0,                                0.0,                                0.0,                                1.0);","   }","","   vec3 getRotation( in vec3 pos, in float positionInTime ) {","      if( rotation.y == 0.0 ) {","           return pos;","      }","","      vec3 axis = unpackRotationAxis( rotation.x );","      vec3 center = rotationCenter;","      vec3 translated;","      mat4 rotationMatrix;","      float angle = 0.0;","      angle += when_eq( rotation.z, 0.0 ) * rotation.y;","      angle += when_gt( rotation.z, 0.0 ) * mix( 0.0, rotation.y, positionInTime );","      translated = rotationCenter - pos;","      rotationMatrix = getRotationMatrix( axis, angle );","      return center - vec3( rotationMatrix * vec4( translated, 0.0 ) );","   }","#endif"].join("\n"),rotateTexture:["    vec2 vUv = vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y );","","    #ifdef SHOULD_ROTATE_TEXTURE","       float x = gl_PointCoord.x - 0.5;","       float y = 1.0 - gl_PointCoord.y - 0.5;","       float c = cos( -vAngle );","       float s = sin( -vAngle );","       vUv = vec2( c * x + s * y + 0.5, c * y - s * x + 0.5 );","    #endif","","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = vSpriteSheet.x;","        float framesY = vSpriteSheet.y;","        float columnNorm = vSpriteSheet.z;","        float rowNorm = vSpriteSheet.w;","        vUv.x = gl_PointCoord.x * framesX + columnNorm;","        vUv.y = 1.0 - (gl_PointCoord.y * framesY + rowNorm);","       if(vAngle != 0.0)","       {","           lowp float cos50 = cos(-vAngle);","           lowp float sin50 = sin(-vAngle);","           vec2 rotator50 = vUv;","           lowp float fWCeil = 1.0 / textureAnimation.x;","           lowp float fHCeil = 1.0 / textureAnimation.y;","           lowp float fHalfWCeil = fWCeil * 0.5;","           lowp float fHalfHCeil = fHCeil * 0.5;","           lowp float fXCenter = 0.0;","           lowp float fYCenter = 0.0;","           for(lowp float i = 0.0; i < 20.0; i+=1.0)","           {","               if(i >= textureAnimation.x) break;","               for(lowp float j = 0.0; j < 20.0; j+=1.0)","               {","                   if(j >= textureAnimation.y) break;","                   fXCenter = (i) * (fWCeil) + fHalfWCeil;","                   fYCenter = (j) * (fHCeil) + fHalfHCeil;","                   if(pow(((vUv.x - fXCenter)/(fHalfWCeil)), 2.0) + pow(((vUv.y - fYCenter)/(fHalfHCeil)), 2.0) <= 1.0)","                       rotator50 = (mat2( cos50 , -sin50 , sin50 , cos50 ) * (vUv - vec2( fXCenter,fYCenter ))) + vec2( fXCenter,fYCenter );","                   vUv = rotator50;","               }","           }","       }","      #else","       if(vAngle != 0.0)","       {","           lowp float cos50 = cos(-vAngle);","           lowp float sin50 = sin(-vAngle);","           vec2 rotator50 = vUv;","           lowp float fWCeil = 1.0 / textureAnimation.x;","           lowp float fHCeil = 1.0 / textureAnimation.y;","           lowp float fHalfWCeil = fWCeil * 0.5;","           lowp float fHalfHCeil = fHCeil * 0.5;","           lowp float fXCenter = 0.0;","           lowp float fYCenter = 0.0;","           for(lowp float i = 0.0; i < 20.0; i+=1.0)","           {","               if(i >= textureAnimation.x) break;","               for(lowp float j = 0.0; j < 20.0; j+=1.0)","               {","                   if(j >= textureAnimation.y) break;","                   fXCenter = (i) * (fWCeil) + fHalfWCeil;","                   fYCenter = (j) * (fHCeil) + fHalfHCeil;","                   if(pow(((vUv.x - fXCenter)/(fHalfWCeil)), 2.0) + pow(((vUv.y - fYCenter)/(fHalfHCeil)), 2.0) <= 1.0)","                       rotator50 = (mat2( cos50 , -sin50 , sin50 , cos50 ) * (vUv - vec2( fXCenter,fYCenter ))) + vec2( fXCenter,fYCenter );","                   vUv = rotator50;","               }","           }","       }","    #endif","","    vec4 rotatedTexture = texture2D( tex, vUv );","    #ifdef SHOULD_TRAIL_PARTICLES","\t    float fVelocityScale = fTrailSpeed;","\t    vec2 a_0 = (vec4Path_1.xy / vec4Path_1.w) * 0.5 + 0.5;","\t    vec2 b_0 = (vec4Path_0.xy / vec4Path_0.w) * 0.5 + 0.5;","\t    vec2 velocity_0 = fVelocityScale * (a_0 - b_0);","\t    vec2 a_1 = (vec4Path_2.xy / vec4Path_2.w) * 0.5 + 0.5;","\t    vec2 b_1 = (vec4Path_1.xy / vec4Path_1.w) * 0.5 + 0.5;","\t    vec2 velocity_1 = fVelocityScale * (a_1 - b_0);","\t    vec2 a_2 = (vec4Path_3.xy / vec4Path_3.w) * 0.5 + 0.5;","\t    vec2 b_2 = (vec4Path_2.xy / vec4Path_2.w) * 0.5 + 0.5;","\t    vec2 velocity_2 = fVelocityScale * (a_2 - b_0);","\t    vec2 a_3 = (vec4Path_4.xy / vec4Path_4.w) * 0.5 + 0.5;","\t    vec2 b_3 = (vec4Path_3.xy / vec4Path_3.w) * 0.5 + 0.5;","\t    vec2 velocity_3 = fVelocityScale * (a_3 - b_0);","\t    vec2 a_4 = (vec4Path_5.xy / vec4Path_5.w) * 0.5 + 0.5;","\t    vec2 b_4 = (vec4Path_4.xy / vec4Path_4.w) * 0.5 + 0.5;","\t    vec2 velocity_4 = fVelocityScale * (a_4 - b_0);","\t    vec2 a_5 = (vec4Path_6.xy / vec4Path_6.w) * 0.5 + 0.5;","\t    vec2 b_5 = (vec4Path_5.xy / vec4Path_5.w) * 0.5 + 0.5;","\t    vec2 velocity_5 = fVelocityScale * (a_5 - b_0);","\t    vec2 a_6 = (vec4Path_7.xy / vec4Path_7.w) * 0.5 + 0.5;","\t    vec2 b_6 = (vec4Path_6.xy / vec4Path_6.w) * 0.5 + 0.5;","\t    vec2 velocity_6 = fVelocityScale * (a_6 - b_0);","\t    vec2 a_7 = (vec4Path_8.xy / vec4Path_8.w) * 0.5 + 0.5;","\t    vec2 b_7 = (vec4Path_7.xy / vec4Path_7.w) * 0.5 + 0.5;","\t    vec2 velocity_7 = fVelocityScale * (a_7 - b_0);","\t    vec2 a_8 = (vec4Path_9.xy / vec4Path_9.w) * 0.5 + 0.5;","\t    vec2 b_8 = (vec4Path_8.xy / vec4Path_8.w) * 0.5 + 0.5;","\t    vec2 velocity_8 = fVelocityScale * (a_8 - b_0);","\t    vec4 oResult;","\t    oResult = texture2D(tex, vUv);","\t    vec2 offset_0 = velocity_0 * (float(1) / float(9) - 0.5);","\t    vec2 offset_1 = velocity_1 * (float(2) / float(9) - 0.5);","\t    vec2 offset_2 = velocity_2 * (float(3) / float(9) - 0.5);","\t    vec2 offset_3 = velocity_3 * (float(4) / float(9) - 0.5);","\t    vec2 offset_4 = velocity_4 * (float(5) / float(9) - 0.5);","\t    vec2 offset_5 = velocity_5 * (float(6) / float(9) - 0.5);","\t    vec2 offset_6 = velocity_6 * (float(7) / float(9) - 0.5);","\t    vec2 offset_7 = velocity_7 * (float(8) / float(9) - 0.5);","\t    vec2 offset_8 = velocity_8 * (float(9) / float(9) - 0.5);","\t    oResult += texture2D(tex, vUv + offset_0);","\t    oResult += texture2D(tex, vUv + offset_1);","\t    oResult += texture2D(tex, vUv + offset_2);","\t    oResult += texture2D(tex, vUv + offset_3);","\t    oResult += texture2D(tex, vUv + offset_4);","\t    oResult += texture2D(tex, vUv + offset_5);","\t    oResult += texture2D(tex, vUv + offset_6);","\t    oResult += texture2D(tex, vUv + offset_7);","\t    oResult += texture2D(tex, vUv + offset_8);","       rotatedTexture = oResult;","    #endif"].join("\n")},SPE.shaders={vertex:[SPE.shaderChunks.defines,SPE.shaderChunks.uniforms,SPE.shaderChunks.attributes,SPE.shaderChunks.varyings,THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,THREE.ShaderChunk.fog_pars_vertex,SPE.shaderChunks.branchAvoidanceFunctions,SPE.shaderChunks.unpackColor,SPE.shaderChunks.unpackRotationAxis,SPE.shaderChunks.floatOverLifetime,SPE.shaderChunks.colorOverLifetime,SPE.shaderChunks.paramFetchingFunctions,SPE.shaderChunks.forceFetchingFunctions,SPE.shaderChunks.rotationFunctions,"void main() {","    highp float age = getAge();","    highp float alive = getAlive();","    highp float maxAge = getMaxAge();","    highp float positionInTime = (age / maxAge);","    highp float isAlive = when_gt( alive, 0.0 );","    #ifdef SHOULD_WIGGLE_PARTICLES","        float wiggleAmount = positionInTime * getWiggle();","        float wiggleSin = isAlive * sin( wiggleAmount );","        float wiggleCos = isAlive * cos( wiggleAmount );","    #endif","    vec3 vel = getVelocity( age );","    vec3 accel = getAcceleration( age );","    vec3 force = vec3( 0.0 );","    vec3 pos = vec3( position );","    float drag = 1.0 - (positionInTime * 0.5) * acceleration.w;","    force += vel;","    force *= drag;","    force += accel * age;","    pos += force;","    #ifdef SHOULD_WIGGLE_PARTICLES","        pos.x += wiggleSin;","        pos.y += wiggleCos;","        pos.z += wiggleSin;","    #endif","    #ifdef SHOULD_ROTATE_PARTICLES","        pos = getRotation( pos, positionInTime );","    #endif","    vec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );","    #ifdef SHOULD_TRAIL_PARTICLES","    float fTimeStep = trail.x * trail.z;","    fTrailSpeed = trail.y;","    for(int i = 0; i < 10; i++)","    {","       highp float age_i = age - float(i) * fTimeStep;","       highp float positionInTime_i = (age_i / maxAge);","       #ifdef SHOULD_WIGGLE_PARTICLES","           float wiggleAmount_i = positionInTime_i * getWiggle();","           float wiggleSin_i = isAlive * sin( wiggleAmount_i );","           float wiggleCos_i = isAlive * cos( wiggleAmount_i );","       #endif","       vec3 vel_i = getVelocity( age_i );","       vec3 accel_i = getAcceleration( age_i );","       vec3 force_i = vec3( 0.0 );","       vec3 pos_i = vec3( position );","       float drag_i = 1.0 - (positionInTime_i * 0.5) * acceleration.w;","       force_i += vel_i;","       force_i *= drag_i;","       force_i += accel_i * age_i;","       pos_i += force_i;","       #ifdef SHOULD_WIGGLE_PARTICLES","           pos_i.x += wiggleSin_i;","           pos_i.y += wiggleCos_i;","           pos_i.z += wiggleSin_i;","       #endif","       #ifdef SHOULD_ROTATE_PARTICLES","           pos_i = getRotation( pos_i, positionInTime_i );","       #endif","       vec4 mvPosition_i = projectionMatrix * modelViewMatrix * vec4( pos_i, 1.0 );","       if(i == 0) vec4Path_0 = mvPosition_i;","       if(i == 1) vec4Path_1 = mvPosition_i;","       if(i == 2) vec4Path_2 = mvPosition_i;","       if(i == 3) vec4Path_3 = mvPosition_i;","       if(i == 4) vec4Path_4 = mvPosition_i;","       if(i == 5) vec4Path_5 = mvPosition_i;","       if(i == 6) vec4Path_6 = mvPosition_i;","       if(i == 7) vec4Path_7 = mvPosition_i;","       if(i == 8) vec4Path_8 = mvPosition_i;","       if(i == 9) vec4Path_9 = mvPosition_i;","    }","    #endif","    highp float pointSize = getFloatOverLifetime( positionInTime, size ) * isAlive;","    #ifdef HAS_PERSPECTIVE","        float perspective = scale / length( mvPosition.xyz );","    #else","        float perspective = 1.0;","    #endif","    float pointSizePerspective = pointSize * perspective;","    #ifdef COLORIZE","       vec3 c = isAlive * getColorOverLifetime(","           positionInTime,","           unpackColor( color.x ),","           unpackColor( color.y ),","           unpackColor( color.z ),","           unpackColor( color.w )","       );","    #else","       vec3 c = vec3(1.0);","    #endif","    float o = isAlive * getFloatOverLifetime( positionInTime, opacity );","    vColor = vec4( c, o );","    //#ifdef SHOULD_ROTATE_TEXTURE","        vAngle = isAlive * getFloatOverLifetime( positionInTime, angle );","    //#endif","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = textureAnimation.x;","        float framesY = textureAnimation.y;","        float loopCount = textureAnimation.w;","        float totalFrames = textureAnimation.z;","        float frameNumber = mod( (positionInTime * loopCount) * totalFrames, totalFrames );","        float column = floor(mod( frameNumber, framesX ));","        float row = floor( (frameNumber - column) / framesX );","        float columnNorm = column / framesX;","        float rowNorm = row / framesY;","        vSpriteSheet.x = 1.0 / framesX;","        vSpriteSheet.y = 1.0 / framesY;","        vSpriteSheet.z = columnNorm;","        vSpriteSheet.w = rowNorm;","    #endif","    gl_PointSize = pointSizePerspective;","    gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.fog_vertex,"}"].join("\n"),fragment:[SPE.shaderChunks.uniforms,THREE.ShaderChunk.common,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,SPE.shaderChunks.varyings,SPE.shaderChunks.branchAvoidanceFunctions,"void main() {","    vec3 outgoingLight = vColor.xyz;","    ","    #ifdef ALPHATEST","       if ( vColor.w < float(ALPHATEST) ) discard;","    #endif",SPE.shaderChunks.rotateTexture,THREE.ShaderChunk.logdepthbuf_fragment,"    outgoingLight = vColor.xyz * rotatedTexture.xyz;","    gl_FragColor = vec4( outgoingLight.xyz, rotatedTexture.w * vColor.w );",THREE.ShaderChunk.fog_fragment,"}"].join("\n")},SPE.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(e,t,n){"use strict";return typeof e===t?e:n},ensureArrayTypedArg:function(e,t,n){"use strict";if(Array.isArray(e)){for(var i=e.length-1;i>=0;--i)if(typeof e[i]!==t)return n;return e}return this.ensureTypedArg(e,t,n)},ensureInstanceOf:function(e,t,n){"use strict";return void 0!==t&&e instanceof t?e:n},ensureArrayInstanceOf:function(e,t,n){"use strict";if(Array.isArray(e)){for(var i=e.length-1;i>=0;--i)if(void 0!==t&&e[i]instanceof t==!1)return n;return e}return this.ensureInstanceOf(e,t,n)},ensureValueOverLifetimeCompliance:function(e,t,n){"use strict";t=t||3,n=n||3,!1===Array.isArray(e._value)&&(e._value=[e._value]),!1===Array.isArray(e._spread)&&(e._spread=[e._spread]);var i=this.clamp(e._value.length,t,n),r=this.clamp(e._spread.length,t,n),o=Math.max(i,r);e._value.length!==o&&(e._value=this.interpolateArray(e._value,o)),e._spread.length!==o&&(e._spread=this.interpolateArray(e._spread,o))},interpolateArray:function(e,t){"use strict";for(var n=e.length,i=["function"==typeof e[0].clone?e[0].clone():e[0]],r=(n-1)/(t-1),o=1;o<t-1;++o){var a=o*r,s=Math.floor(a),l=Math.ceil(a),u=a-s;i[o]=this.lerpTypeAgnostic(e[s],e[l],u)}return i.push("function"==typeof e[n-1].clone?e[n-1].clone():e[n-1]),i},clamp:function(e,t,n){"use strict";return Math.max(t,Math.min(e,n))},zeroToEpsilon:function(e,t){"use strict";var n=e;return n=t?1e-5*Math.random()*10:1e-5,e<0&&e>-1e-5&&(n=-n),n},lerpTypeAgnostic:function(e,t,n){"use strict";var i,r=this.types;return typeof e==r.NUMBER&&typeof t==r.NUMBER?e+(t-e)*n:e instanceof THREE.Vector2&&t instanceof THREE.Vector2||typeof e.x==r.NUMBER&&typeof e.y==r.NUMBER&&null==e.z&&null==e.z&&typeof t.x==r.NUMBER&&typeof t.y==r.NUMBER&&null==t.z&&null==t.z?(e instanceof THREE.Vector2?i=e.clone():((i={}).x=e.x,i.y=e.y),i.x=this.lerp(e.x,t.x,n),i.y=this.lerp(e.y,t.y,n),i):e instanceof THREE.Vector3&&t instanceof THREE.Vector3||typeof e.x==r.NUMBER&&typeof e.y==r.NUMBER&&typeof e.z==r.NUMBER&&null==e.w&&null==e.w&&typeof t.x==r.NUMBER&&typeof t.y==r.NUMBER&&typeof t.z==r.NUMBER&&null==t.w&&null==t.w?(e instanceof THREE.Vector3?i=e.clone():((i={}).x=e.x,i.y=e.y,i.z=e.z),i.x=this.lerp(e.x,t.x,n),i.y=this.lerp(e.y,t.y,n),i.z=this.lerp(e.z,t.z,n),i):e instanceof THREE.Vector4&&t instanceof THREE.Vector4||typeof e.x==r.NUMBER&&typeof e.y==r.NUMBER&&typeof e.z==r.NUMBER&&typeof e.w==r.NUMBER&&typeof t.x==r.NUMBER&&typeof t.y==r.NUMBER&&typeof t.z==r.NUMBER&&typeof t.w==r.NUMBER?(e instanceof THREE.Vector4?i=e.clone():((i={}).x=e.x,i.y=e.y,i.z=e.z,i.w=e.w),i.x=this.lerp(e.x,t.x,n),i.y=this.lerp(e.y,t.y,n),i.z=this.lerp(e.z,t.z,n),i.w=this.lerp(e.w,t.w,n),i):e instanceof THREE.Color&&t instanceof THREE.Color||typeof e.r==r.NUMBER&&typeof e.g==r.NUMBER&&typeof e.b==r.NUMBER&&typeof t.r==r.NUMBER&&typeof t.g==r.NUMBER&&typeof t.b==r.NUMBER?(e instanceof THREE.Color?i=e.clone():((i={}).r=e.r,i.g=e.g,i.b=e.b),i.r=this.lerp(e.r,t.r,n),i.g=this.lerp(e.g,t.g,n),i.b=this.lerp(e.b,t.b,n),i):void console.warn("Invalid argument types, or argument types do not match:",e,t)},lerp:function(e,t,n){"use strict";return e+(t-e)*n},roundToNearestMultiple:function(e,t){"use strict";var n;return 0===t||0===(n=Math.abs(e)%t)?e:e<0?-(Math.abs(e)-n):e+t-n},arrayValuesAreEqual:function(e){"use strict";for(var t=0;t<e.length-1;++t)if(e[t]!==e[t+1])return!1;return!0},randomFloat:function(e,t){"use strict";return e+t*(Math.random()-.5)},randomVector3:function(e,t,n,i,r){"use strict";var o=n.x+(Math.random()*i.x-.5*i.x),a=n.y+(Math.random()*i.y-.5*i.y),s=n.z+(Math.random()*i.z-.5*i.z);r&&(o=.5*-r.x+this.roundToNearestMultiple(o,r.x),a=.5*-r.y+this.roundToNearestMultiple(a,r.y),s=.5*-r.z+this.roundToNearestMultiple(s,r.z)),e.typedArray.setVec3Components(t,o,a,s)},getRandomVector3:function(e,t,n){"use strict";var i=e.x+(Math.random()*t.x-.5*t.x),r=e.y+(Math.random()*t.y-.5*t.y),o=e.z+(Math.random()*t.z-.5*t.z);return n&&(i=.5*-n.x+this.roundToNearestMultiple(i,n.x),r=.5*-n.y+this.roundToNearestMultiple(r,n.y),o=.5*-n.z+this.roundToNearestMultiple(o,n.z)),new THREE.Vector3(i,r,o)},randomColor:function(e,t,n,i){"use strict";var r=n.r+Math.random()*i.x,o=n.g+Math.random()*i.y,a=n.b+Math.random()*i.z;r=this.clamp(r,0,1),o=this.clamp(o,0,1),a=this.clamp(a,0,1),e.typedArray.setVec3Components(t,r,o,a)},randomColorAsHex:function(){"use strict";var e=new THREE.Color;return function(t,n,i,r){for(var o=i.length,a=[],s=0;s<o;++s){var l=r[s];e.copy(i[s]),e.r+=Math.random()*l.x-.5*l.x,e.g+=Math.random()*l.y-.5*l.y,e.b+=Math.random()*l.z-.5*l.z,e.r=this.clamp(e.r,0,1),e.g=this.clamp(e.g,0,1),e.b=this.clamp(e.b,0,1),a.push(e.getHex())}t.typedArray.setVec4Components(n,a[0],a[1],a[2],a[3])}}(),randomVector3OnSphere:function(e,t,n,i,r,o,a,s){"use strict";var l=2*Math.random()-1,u=6.2832*Math.random(),c=Math.sqrt(1-l*l),h=this.randomFloat(i,r),p=0,d=0,f=0;a&&(h=Math.round(h/a)*a),p=c*Math.cos(u)*h,d=c*Math.sin(u)*h,f=l*h,p*=o.x,d*=o.y,f*=o.z,p+=n.x,d+=n.y,f+=n.z,e.typedArray.setVec3Components(t,p,d,f)},seededRandom:function(e){var t=1e4*Math.sin(e);return t-(0|t)},randomVector3OnDisc:function(e,t,n,i,r,o,a){"use strict";var s=6.2832*Math.random(),l=Math.abs(this.randomFloat(i,r)),u=0,c=0,h=0;a&&(l=Math.round(l/a)*a),u=Math.cos(s)*l,c=Math.sin(s)*l,u*=o.x,c*=o.y,u+=n.x,c+=n.y,h+=n.z,e.typedArray.setVec3Components(t,u,c,h)},randomDirectionVector3OnSphere:function(){"use strict";var e=new THREE.Vector3;return function(t,n,i,r,o,a,s,l){e.copy(a),e.x-=i,e.y-=r,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(n,e.x,e.y,e.z)}}(),directionVector3OnSphere:function(){"use strict";var e=new THREE.Vector3;return function(t,n,i,r,o,a,s,l,u,c){e.copy(a),e.x-=i,e.y-=r,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l));var h=this.getRandomVector3(u,c);e.add(h),t.typedArray.setVec3Components(n,e.x,e.y,e.z)}}(),randomDirectionVector3OnDisc:function(){"use strict";var e=new THREE.Vector3;return function(t,n,i,r,o,a,s,l){e.copy(a),e.x-=i,e.y-=r,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(n,e.x,e.y,0)}}(),getPackedRotationAxis:function(){"use strict";var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Color,i=new THREE.Vector3(1,1,1);return function(r,o){return e.copy(r).normalize(),t.copy(o).normalize(),e.x+=.5*-o.x+Math.random()*o.x,e.y+=.5*-o.y+Math.random()*o.y,e.z+=.5*-o.z+Math.random()*o.z,e.normalize().add(i).multiplyScalar(.5),n.setRGB(e.x,e.y,e.z),n.getHex()}}()},SPE.Group=function(e){"use strict";var t=SPE.utils,n=t.types;(e=t.ensureTypedArg(e,n.OBJECT,{})).texture=t.ensureTypedArg(e.texture,n.OBJECT,{}),this.uuid=THREE.Math.generateUUID(),this.fixedTimeStep=t.ensureTypedArg(e.fixedTimeStep,n.NUMBER,.016),null!=e.texture.frames&&null!=e.texture.frames&&(e.texture.frames.x=t.ensureTypedArg(e.texture.frames.x,n.NUMBER,1),e.texture.frames.y=t.ensureTypedArg(e.texture.frames.y,n.NUMBER,1)),this.texture=t.ensureInstanceOf(e.texture.value,THREE.Texture,null),this.textureFrames=t.ensureInstanceOf(new THREE.Vector2(e.texture.frames.x,e.texture.frames.y),THREE.Vector2,new THREE.Vector2(1,1)),this.textureFrameCount=t.ensureTypedArg(e.texture.frameCount,n.NUMBER,this.textureFrames.x*this.textureFrames.y),this.textureLoop=t.ensureTypedArg(e.texture.loop,n.NUMBER,1),this.textureFrames.max(new THREE.Vector2(1,1)),this.hasPerspective=t.ensureTypedArg(e.hasPerspective,n.BOOLEAN,!0),this.colorize=t.ensureTypedArg(e.colorize,n.BOOLEAN,!0),this.maxParticleCount=t.ensureTypedArg(e.maxParticleCount,n.NUMBER,null),this.vec4Quaternion=t.ensureInstanceOf(e.vec4Quaternion,THREE.Vector4,new THREE.Vector4(0,0,0,1)),this.vec4Quaternion=this.vec4Quaternion.normalize(),this.blending=t.ensureTypedArg(e.blending,n.NUMBER,THREE.AdditiveBlending),this.transparent=t.ensureTypedArg(e.transparent,n.BOOLEAN,!0),this.alphaTest=parseFloat(t.ensureTypedArg(e.alphaTest,n.NUMBER,0)),this.depthWrite=t.ensureTypedArg(e.depthWrite,n.BOOLEAN,!1),this.depthTest=t.ensureTypedArg(e.depthTest,n.BOOLEAN,!0),this.fog=t.ensureTypedArg(e.fog,n.BOOLEAN,!0),this.scale=t.ensureTypedArg(e.scale,n.NUMBER,300),this.emitters=[],this.emitterIDs=[],this._pool=[],this._poolCreationSettings=null,this._createNewWhenPoolEmpty=0,this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!1,this.particleCount=0,this.uniforms={tex:{type:"t",value:this.texture},textureAnimation:{type:"v4",value:new THREE.Vector4(this.textureFrames.x,this.textureFrames.y,this.textureFrameCount,Math.max(Math.abs(this.textureLoop),1))},fogColor:{type:"c",value:null},fogNear:{type:"f",value:10},fogFar:{type:"f",value:200},fogDensity:{type:"f",value:.5},deltaTime:{type:"f",value:0},runTime:{type:"f",value:0},scale:{type:"f",value:this.scale}},this.defines={HAS_PERSPECTIVE:this.hasPerspective,COLORIZE:this.colorize,VALUE_OVER_LIFETIME_LENGTH:SPE.valueOverLifetimeLength,SHOULD_ROTATE_TEXTURE:!1,SHOULD_TRAIL_PARTICLES:!1,SHOULD_ROTATE_PARTICLES:!1,SHOULD_WIGGLE_PARTICLES:!1,SHOULD_CALCULATE_SPRITE:this.textureFrames.x>1||this.textureFrames.y>1},this.attributes={position:new SPE.ShaderAttribute("v3",!0),acceleration:new SPE.ShaderAttribute("v4",!0),velocity:new SPE.ShaderAttribute("v3",!0),rotation:new SPE.ShaderAttribute("v4",!0),rotationCenter:new SPE.ShaderAttribute("v3",!0),params:new SPE.ShaderAttribute("v4",!0),size:new SPE.ShaderAttribute("v4",!0),angle:new SPE.ShaderAttribute("v4",!0),color:new SPE.ShaderAttribute("v4",!0),opacity:new SPE.ShaderAttribute("v4",!0),trail:new SPE.ShaderAttribute("v4",!0)},this.attributeKeys=Object.keys(this.attributes),this.attributeCount=this.attributeKeys.length,this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:SPE.shaders.vertex,fragmentShader:SPE.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,defines:this.defines,fog:this.fog}),this.geometry=new THREE.BufferGeometry,this.mesh=new THREE.Points(this.geometry,this.material),null===this.maxParticleCount&&console.warn("SPE.Group: No maxParticleCount specified. Adding emitters after rendering will probably cause errors.")},SPE.Group.constructor=SPE.Group,SPE.Group.prototype._updateDefines=function(){"use strict";for(var e,t=this.emitters,n=t.length-1,i=this.defines;n>=0;--n)e=t[n],i.SHOULD_CALCULATE_SPRITE||(i.SHOULD_ROTATE_TEXTURE=i.SHOULD_ROTATE_TEXTURE||!!Math.max(Math.max.apply(null,e.angle.value),Math.max.apply(null,e.angle.spread))),i.SHOULD_ROTATE_PARTICLES=i.SHOULD_ROTATE_PARTICLES||!!Math.max(e.rotation.angle,e.rotation.angleSpread),i.SHOULD_WIGGLE_PARTICLES=i.SHOULD_WIGGLE_PARTICLES||!!Math.max(e.wiggle.value,e.wiggle.spread),i.SHOULD_TRAIL_PARTICLES=i.SHOULD_TRAIL_PARTICLES||!!Math.max(e.trail.value,e.trail.spread);this.material.needsUpdate=!0},SPE.Group.prototype._applyAttributesToGeometry=function(){"use strict";var e,t,n=this.attributes,i=this.geometry,r=i.attributes;for(var o in n)n.hasOwnProperty(o)&&(e=n[o],(t=r[o])?t.array=e.typedArray.array:i.setAttribute(o,e.bufferAttribute),e.bufferAttribute.needsUpdate=!0);this.geometry.setDrawRange(0,this.particleCount)},SPE.Group.prototype.addEmitter=function(e){"use strict";if(e instanceof SPE.Emitter!=!1)if(this.emitterIDs.indexOf(e.uuid)>-1)console.error("Emitter already exists in this group. Will not add again.");else{if(null===e.group){var t=this.attributes,n=this.particleCount,i=n+e.particleCount;for(var r in this.particleCount=i,null!==this.maxParticleCount&&this.particleCount>this.maxParticleCount&&console.warn("SPE.Group: maxParticleCount exceeded. Requesting",this.particleCount,"particles, can support only",this.maxParticleCount),e._calculatePPSValue(e.maxAge._value+e.maxAge._spread),e._setBufferUpdateRanges(this.attributeKeys),e._setAttributeOffset(n),e.group=this,e.attributes=this.attributes,t)t.hasOwnProperty(r)&&t[r]._createBufferAttribute(null!==this.maxParticleCount?this.maxParticleCount:this.particleCount);for(var o=n;o<i;++o)e._assignPositionValue(o),e._assignForceValue(o,"velocity"),e._assignAccForceValue(o,"acceleration"),e._assignAbsLifetimeValue(o,"opacity"),e._assignAbsLifetimeValue(o,"size"),e._assignAngleValue(o),e._assignRotationValue(o),e._assignParamsValue(o),e._assignColorValue(o),e._assignTrailValue(o);return this._applyAttributesToGeometry(),this.emitters.push(e),this.emitterIDs.push(e.uuid),this._updateDefines(e),this.material.needsUpdate=!0,this.geometry.needsUpdate=!0,this._attributesNeedRefresh=!0,this}console.error("Emitter already belongs to another group. Will not add to requested group.")}else console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",e)},SPE.Group.prototype.removeEmitter=function(e){"use strict";var t=this.emitterIDs.indexOf(e.uuid);if(e instanceof SPE.Emitter!=!1)if(-1!==t){for(var n=e.attributeOffset,i=n+e.particleCount,r=this.attributes.params.typedArray,o=n;o<i;++o)r.array[4*o]=0,r.array[4*o+1]=0;for(var a in this.emitters.splice(t,1),this.emitterIDs.splice(t,1),this.attributes)this.attributes.hasOwnProperty(a)&&this.attributes[a].splice(n,i);this.particleCount-=e.particleCount,e._onRemove(),this._attributesNeedRefresh=!0}else console.error("Emitter does not exist in this group. Will not remove.");else console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",e)},SPE.Group.prototype.getFromPool=function(){"use strict";var e=this._pool,t=this._createNewWhenPoolEmpty;if(e.length)return e.pop();if(t){var n=new SPE.Emitter(this._poolCreationSettings);return this.addEmitter(n),n}return null},SPE.Group.prototype.releaseIntoPool=function(e){"use strict";if(e instanceof SPE.Emitter!=!1)return e.reset(),this._pool.unshift(e),this;console.error("Argument is not instanceof SPE.Emitter:",e)},SPE.Group.prototype.getPool=function(){"use strict";return this._pool},SPE.Group.prototype.addPool=function(e,t,n){"use strict";var i;this._poolCreationSettings=t,this._createNewWhenPoolEmpty=!!n;for(var r=0;r<e;++r)i=Array.isArray(t)?new SPE.Emitter(t[r]):new SPE.Emitter(t),this.addEmitter(i),this.releaseIntoPool(i);return this},SPE.Group.prototype._triggerSingleEmitter=function(e){"use strict";var t=this.getFromPool(),n=this;if(null!==t)return e instanceof THREE.Vector3&&(t.position.value.copy(e),t.position.value=t.position.value),t.enable(),setTimeout((function(){t.disable(),n.releaseIntoPool(t)}),1e3*Math.max(t.duration,t.maxAge.value+t.maxAge.spread)),this;console.log("SPE.Group pool ran out.")},SPE.Group.prototype.triggerPoolEmitter=function(e,t){"use strict";if("number"==typeof e&&e>1)for(var n=0;n<e;++n)this._triggerSingleEmitter(t);else this._triggerSingleEmitter(t);return this},SPE.Group.prototype._updateUniforms=function(e){"use strict";this.uniforms.runTime.value+=e,this.uniforms.deltaTime.value=e},SPE.Group.prototype._resetBufferRanges=function(){"use strict";for(var e=this.attributeKeys,t=this.attributeCount-1,n=this.attributes;t>=0;--t)n[e[t]].resetUpdateRange()},SPE.Group.prototype._updateBuffers=function(e){"use strict";for(var t,n,i,r=this.attributeKeys,o=this.attributeCount-1,a=this.attributes,s=e.bufferUpdateRanges;o>=0;--o)n=s[t=r[o]],(i=a[t]).setUpdateRange(n.min,n.max),i.flagUpdate()},SPE.Group.prototype.tick=function(e){"use strict";var t=this.emitters,n=t.length,i=e||this.fixedTimeStep,r=this.attributeKeys,o=this.attributes;if(this._updateUniforms(i),this._resetBufferRanges(),0!==n||!1!==this._attributesNeedRefresh||!1!==this._attributesNeedDynamicReset){for(var a,s=0;s<n;++s)(a=t[s]).tick(i),this._updateBuffers(a);if(!0===this._attributesNeedDynamicReset){for(s=this.attributeCount-1;s>=0;--s)o[r[s]].resetDynamic();this._attributesNeedDynamicReset=!1}if(!0===this._attributesNeedRefresh){for(s=this.attributeCount-1;s>=0;--s)o[r[s]].forceUpdateAll();this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!0}}},SPE.Group.prototype.dispose=function(){"use strict";return this.geometry.dispose(),this.material.dispose(),this},SPE.Emitter=function(e){"use strict";var t=SPE.utils,n=t.types,i=SPE.valueOverLifetimeLength;for(var r in(e=t.ensureTypedArg(e,n.OBJECT,{})).position=t.ensureTypedArg(e.position,n.OBJECT,{}),e.velocity=t.ensureTypedArg(e.velocity,n.OBJECT,{}),e.acceleration=t.ensureTypedArg(e.acceleration,n.OBJECT,{}),e.radius=t.ensureTypedArg(e.radius,n.OBJECT,{}),e.drag=t.ensureTypedArg(e.drag,n.OBJECT,{}),e.rotation=t.ensureTypedArg(e.rotation,n.OBJECT,{}),e.color=t.ensureTypedArg(e.color,n.OBJECT,{}),e.opacity=t.ensureTypedArg(e.opacity,n.OBJECT,{}),e.size=t.ensureTypedArg(e.size,n.OBJECT,{}),e.angle=t.ensureTypedArg(e.angle,n.OBJECT,{}),e.wiggle=t.ensureTypedArg(e.wiggle,n.OBJECT,{}),e.trail=t.ensureTypedArg(e.trail,n.OBJECT,{}),e.maxAge=t.ensureTypedArg(e.maxAge,n.OBJECT,{}),e.onParticleSpawn&&console.warn("onParticleSpawn has been removed. Please set properties directly to alter values at runtime."),this.uuid=THREE.Math.generateUUID(),this.type=t.ensureTypedArg(e.type,n.NUMBER,SPE.distributions.BOX),this.position={_value:t.ensureInstanceOf(e.position.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.position.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.position.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.position.distribution,n.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,n.BOOLEAN,!1),_radius:t.ensureTypedArg(e.position.radius,n.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.position.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.position.distributionClamp,n.NUMBER,0)},this.velocity={_value:t.ensureInstanceOf(e.velocity.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.velocity.spread,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.velocity.distribution,n.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,n.BOOLEAN,!1)},this.acceleration={_value:t.ensureInstanceOf(e.acceleration.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.acceleration.spread,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.acceleration.distribution,n.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,n.BOOLEAN,!1)},this.drag={_value:t.ensureTypedArg(e.drag.value,n.NUMBER,0),_spread:t.ensureTypedArg(e.drag.spread,n.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,n.BOOLEAN,!1)},this.wiggle={_value:t.ensureTypedArg(e.wiggle.value,n.NUMBER,0),_spread:t.ensureTypedArg(e.wiggle.spread,n.NUMBER,0)},this.rotation={_axis:t.ensureInstanceOf(e.rotation.axis,THREE.Vector3,new THREE.Vector3(0,1,0)),_axisSpread:t.ensureInstanceOf(e.rotation.axisSpread,THREE.Vector3,new THREE.Vector3),_angle:t.ensureTypedArg(e.rotation.angle,n.NUMBER,0),_angleSpread:t.ensureTypedArg(e.rotation.angleSpread,n.NUMBER,0),_static:t.ensureTypedArg(e.rotation.static,n.BOOLEAN,!1),_center:t.ensureInstanceOf(e.rotation.center,THREE.Vector3,this.position._value.clone()),_randomise:t.ensureTypedArg(e.position.randomise,n.BOOLEAN,!1)},this.maxAge={_value:t.ensureTypedArg(e.maxAge.value,n.NUMBER,2),_spread:t.ensureTypedArg(e.maxAge.spread,n.NUMBER,0)},this.color={_value:t.ensureArrayInstanceOf(e.color.value,THREE.Color,new THREE.Color),_spread:t.ensureArrayInstanceOf(e.color.spread,THREE.Vector3,new THREE.Vector3),_randomise:t.ensureTypedArg(e.position.randomise,n.BOOLEAN,!1)},this.opacity={_value:t.ensureArrayTypedArg(e.opacity.value,n.NUMBER,1),_spread:t.ensureArrayTypedArg(e.opacity.spread,n.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,n.BOOLEAN,!1)},this.size={_value:t.ensureArrayTypedArg(e.size.value,n.NUMBER,1),_spread:t.ensureArrayTypedArg(e.size.spread,n.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,n.BOOLEAN,!1)},this.angle={_value:t.ensureArrayTypedArg(e.angle.value,n.NUMBER,0),_spread:t.ensureArrayTypedArg(e.angle.spread,n.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,n.BOOLEAN,!1)},this.bInitSpeed=!1,this.bInitSpeedAcc=!1,this.particleCount=t.ensureTypedArg(e.particleCount,n.NUMBER,100),this.duration=t.ensureTypedArg(e.duration,n.NUMBER,null),this.isStatic=t.ensureTypedArg(e.isStatic,n.BOOLEAN,!1),this.activeMultiplier=t.ensureTypedArg(e.activeMultiplier,n.NUMBER,1),this.direction=t.ensureTypedArg(e.direction,n.NUMBER,1),this.trail={_value:t.ensureArrayTypedArg(e.trail.value,n.NUMBER,0),_spread:t.ensureArrayTypedArg(e.trail.spread,n.NUMBER,0),_step:t.ensureArrayTypedArg(e.trail.step,n.NUMBER,0),_stepSpread:t.ensureArrayTypedArg(e.trail.stepSpread,n.NUMBER,0),_direction:t.ensureArrayTypedArg(e.trail.direction,n.NUMBER,-1*this.direction)},this.alive=t.ensureTypedArg(e.alive,n.BOOLEAN,!0),this.particlesPerSecond=0,this.activationIndex=0,this.attributeOffset=0,this.attributeEnd=0,this.age=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.resetFlags={position:t.ensureTypedArg(e.position.randomise,n.BOOLEAN,!1)||t.ensureTypedArg(e.radius.randomise,n.BOOLEAN,!1),velocity:t.ensureTypedArg(e.velocity.randomise,n.BOOLEAN,!1),acceleration:t.ensureTypedArg(e.acceleration.randomise,n.BOOLEAN,!1)||t.ensureTypedArg(e.drag.randomise,n.BOOLEAN,!1),rotation:t.ensureTypedArg(e.rotation.randomise,n.BOOLEAN,!1),rotationCenter:t.ensureTypedArg(e.rotation.randomise,n.BOOLEAN,!1),size:t.ensureTypedArg(e.size.randomise,n.BOOLEAN,!1),color:t.ensureTypedArg(e.color.randomise,n.BOOLEAN,!1),opacity:t.ensureTypedArg(e.opacity.randomise,n.BOOLEAN,!1),angle:t.ensureTypedArg(e.angle.randomise,n.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle",trail:"trail"},this.updateMap)this.updateMap.hasOwnProperty(r)&&(this.updateCounts[this.updateMap[r]]=0,this.updateFlags[this.updateMap[r]]=!1,this._createGetterSetters(this[r],r));this.bufferUpdateRanges={},this.attributeKeys=null,this.attributeCount=0,t.ensureValueOverLifetimeCompliance(this.color,i,i),t.ensureValueOverLifetimeCompliance(this.opacity,i,i),t.ensureValueOverLifetimeCompliance(this.size,i,i),t.ensureValueOverLifetimeCompliance(this.angle,i,i)},SPE.Emitter.constructor=SPE.Emitter,SPE.Emitter.prototype._createGetterSetters=function(e,t){"use strict";var n=this;for(var i in e)if(e.hasOwnProperty(i)){var r=i.replace("_","");Object.defineProperty(e,r,{get:function(e){return function(){return this[e]}}(i),set:function(e){return function(i){var r=n.updateMap[t],o=this[e],a=SPE.valueOverLifetimeLength;"_rotationCenter"===e?(n.updateFlags.rotationCenter=!0,n.updateCounts.rotationCenter=0):"_randomise"===e?n.resetFlags[r]=i:(n.updateFlags[r]=!0,n.updateCounts[r]=0),n.group._updateDefines(),this[e]=i,Array.isArray(o)&&SPE.utils.ensureValueOverLifetimeCompliance(n[t],a,a)}}(i)})}},SPE.Emitter.prototype._setBufferUpdateRanges=function(e){"use strict";this.attributeKeys=e,this.attributeCount=e.length;for(var t=this.attributeCount-1;t>=0;--t)this.bufferUpdateRanges[e[t]]={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}},SPE.Emitter.prototype._calculatePPSValue=function(e){"use strict";var t=this.particleCount;this.duration?this.particlesPerSecond=t/(e<this.duration?e:this.duration):this.particlesPerSecond=t/e},SPE.Emitter.prototype._setAttributeOffset=function(e){this.attributeOffset=e,this.activationIndex=e,this.activationEnd=e+this.particleCount},SPE.Emitter.prototype._assignValue=function(e,t){"use strict";switch(e){case"position":this._assignPositionValue(t);break;case"velocity":this._assignForceValue(t,e);break;case"acceleration":this._assignAccForceValue(t,e);break;case"size":case"opacity":this._assignAbsLifetimeValue(t,e);break;case"angle":this._assignAngleValue(t);break;case"params":this._assignParamsValue(t);break;case"rotation":this._assignRotationValue(t);break;case"color":this._assignColorValue(t);break;case"trail":this._assignTrailValue(t)}},SPE.Emitter.prototype._assignPositionValue=function(e){"use strict";var t=SPE.distributions,n=SPE.utils,i=this.position,r=this.attributes.position,o=i._value,a=i._spread;switch(i._distribution){case t.BOX:n.randomVector3(r,e,o,a,i._spreadClamp);break;case t.SPHERE:n.randomVector3OnSphere(r,e,o,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x,i._distributionClamp||this.particleCount);break;case t.DISC:n.randomVector3OnDisc(r,e,o,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x)}},SPE.Emitter.prototype._assignTrailValue=function(e){"use strict";this.attributes.trail.typedArray.setVec4Components(e,this.trail._direction,SPE.utils.randomFloat(this.trail._value,this.trail._spread),SPE.utils.randomFloat(this.trail._step,this.trail._stepSpread))},SPE.Emitter.prototype._assignForceValue=function(e,t){"use strict";var n=this.group.vec4Quaternion.clone();n=n.normalize();var i,r,o,a,s,l=SPE.distributions,u=SPE.utils,c=this[t],h=c._value,p=c._spread,d=c._distribution;switch(this.bInitSpeed||(h=h.applyQuaternion(n),p=p.applyQuaternion(n),this.bInitSpeed=!0),d){case l.BOX:u.randomVector3(this.attributes[t],e,h,p);break;case l.SPHERE:r=(i=this.attributes.position.typedArray.array)[s=3*e],o=i[s+1],a=i[s+2],u.randomDirectionVector3OnSphere(this.attributes[t],e,r,o,a,this.position._value,c._value.x,c._spread.x);break;case l.DISC:r=(i=this.attributes.position.typedArray.array)[s=3*e],o=i[s+1],a=i[s+2],u.randomDirectionVector3OnDisc(this.attributes[t],e,r,o,a,this.position._value,c._value.x,c._spread.x)}if("acceleration"===t){var f=u.clamp(u.randomFloat(this.drag._value,this.drag._spread),0,2);this.attributes.acceleration.typedArray.array[4*e+3]=f}},SPE.Emitter.prototype._assignAccForceValue=function(e,t){"use strict";var n=this.group.vec4Quaternion.clone();n=n.normalize();var i,r,o,a,s,l=SPE.distributions,u=SPE.utils,c=this[t],h=this.velocity,p=c._value,d=c._spread,f=c._distribution;switch(this.bInitSpeedAcc||(p=p.applyQuaternion(n),d=d.applyQuaternion(n),this.bInitSpeedAcc=!0),f){case l.BOX:u.randomVector3(this.attributes[t],e,p,d);break;case l.SPHERE:r=(i=this.attributes.position.typedArray.array)[s=3*e],o=i[s+1],a=i[s+2],u.directionVector3OnSphere(this.attributes[t],e,r,o,a,this.position._value,h._value.y,h._spread.y,c._value,c._spread);break;case l.DISC:r=(i=this.attributes.position.typedArray.array)[s=3*e],o=i[s+1],a=i[s+2],u.randomDirectionVector3OnDisc(this.attributes[t],e,r,o,a,this.position._value,c._value.x,c._spread.x)}if("acceleration"===t){var m=u.clamp(u.randomFloat(this.drag._value,this.drag._spread),0,2);this.attributes.acceleration.typedArray.array[4*e+3]=m}},SPE.Emitter.prototype._assignAbsLifetimeValue=function(e,t){"use strict";var n,i=this.attributes[t].typedArray,r=this[t],o=SPE.utils;o.arrayValuesAreEqual(r._value)&&o.arrayValuesAreEqual(r._spread)?(n=Math.abs(o.randomFloat(r._value[0],r._spread[0])),i.setVec4Components(e,n,n,n,n)):i.setVec4Components(e,Math.abs(o.randomFloat(r._value[0],r._spread[0])),Math.abs(o.randomFloat(r._value[1],r._spread[1])),Math.abs(o.randomFloat(r._value[2],r._spread[2])),Math.abs(o.randomFloat(r._value[3],r._spread[3])))},SPE.Emitter.prototype._assignAngleValue=function(e){"use strict";var t,n=this.attributes.angle.typedArray,i=this.angle,r=SPE.utils;r.arrayValuesAreEqual(i._value)&&r.arrayValuesAreEqual(i._spread)?(t=r.randomFloat(i._value[0],i._spread[0]),n.setVec4Components(e,t,t,t,t)):n.setVec4Components(e,r.randomFloat(i._value[0],i._spread[0]),r.randomFloat(i._value[1],i._spread[1]),r.randomFloat(i._value[2],i._spread[2]),r.randomFloat(i._value[3],i._spread[3]))},SPE.Emitter.prototype._assignParamsValue=function(e){"use strict";this.attributes.params.typedArray.setVec4Components(e,this.isStatic?1:0,0,Math.abs(SPE.utils.randomFloat(this.maxAge._value,this.maxAge._spread)),SPE.utils.randomFloat(this.wiggle._value,this.wiggle._spread))},SPE.Emitter.prototype._assignRotationValue=function(e){"use strict";this.attributes.rotation.typedArray.setVec3Components(e,SPE.utils.getPackedRotationAxis(this.rotation._axis,this.rotation._axisSpread),SPE.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.rotation._static?0:1),this.attributes.rotationCenter.typedArray.setVec3(e,this.rotation._center)},SPE.Emitter.prototype._assignColorValue=function(e){"use strict";SPE.utils.randomColorAsHex(this.attributes.color,e,this.color._value,this.color._spread)},SPE.Emitter.prototype._resetParticle=function(e){"use strict";for(var t,n,i=this.resetFlags,r=this.updateFlags,o=this.updateCounts,a=this.attributeKeys,s=this.attributeCount-1;s>=0;--s)n=r[t=a[s]],!0!==i[t]&&!0!==n||(this._assignValue(t,e),this._updateAttributeUpdateRange(t,e),!0===n&&o[t]===this.particleCount?(r[t]=!1,o[t]=0):1==n&&++o[t])},SPE.Emitter.prototype._updateAttributeUpdateRange=function(e,t){"use strict";var n=this.bufferUpdateRanges[e];n.min=Math.min(t,n.min),n.max=Math.max(t,n.max)},SPE.Emitter.prototype._resetBufferRanges=function(){"use strict";for(var e,t=this.bufferUpdateRanges,n=this.bufferUpdateKeys,i=this.bufferUpdateCount-1;i>=0;--i)t[e=n[i]].min=Number.POSITIVE_INFINITY,t[e].max=Number.NEGATIVE_INFINITY},SPE.Emitter.prototype._onRemove=function(){"use strict";this.particlesPerSecond=0,this.attributeOffset=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.age=0},SPE.Emitter.prototype._decrementParticleCount=function(){"use strict";--this.activeParticleCount},SPE.Emitter.prototype._incrementParticleCount=function(){"use strict";++this.activeParticleCount},SPE.Emitter.prototype._checkParticleAges=function(e,t,n,i){"use strict";for(var r,o,a,s,l=t-1;l>=e;--l)0!==(s=n[r=4*l])&&(a=n[r+1],o=n[r+2],1===this.direction?(a+=i)>=o&&(a=0,s=0,this._decrementParticleCount()):(a-=i)<=0&&(a=o,s=0,this._decrementParticleCount()),n[r]=s,n[r+1]=a,this._updateAttributeUpdateRange("params",l))},SPE.Emitter.prototype._activateParticles=function(e,t,n,i){"use strict";for(var r,o,a=this.direction,s=e;s<t;++s)0!=n[r=4*s]&&1!==this.particleCount||(this._incrementParticleCount(),n[r]=1,this._resetParticle(s),o=i*(s-e),n[r+1]=-1===a?n[r+2]-o:o,this._updateAttributeUpdateRange("params",s))},SPE.Emitter.prototype.tick=function(e){"use strict";if(!this.isStatic){null===this.paramsArray&&(this.paramsArray=this.attributes.params.typedArray.array);var t=this.attributeOffset,n=t+this.particleCount,i=this.paramsArray,r=this.particlesPerSecond*this.activeMultiplier*e,o=this.activationIndex;if(this._resetBufferRanges(),this._checkParticleAges(t,n,i,e),!1!==this.alive){if(null!==this.duration&&this.age>this.duration)return this.alive=!1,void(this.age=0);var a=1===this.particleCount?o:0|o,s=Math.min(a+r,this.activationEnd),l=s-this.activationIndex|0,u=l>0?e/l:0;this._activateParticles(a,s,i,u),this.activationIndex+=r,this.activationIndex>n&&(this.activationIndex=t),this.age+=e}else this.age=0}},SPE.Emitter.prototype.reset=function(e){"use strict";if(this.age=0,this.alive=!1,!0===e){for(var t,n=this.attributeOffset,i=n+this.particleCount,r=this.paramsArray,o=this.attributes.params.bufferAttribute,a=i-1;a>=n;--a)r[t=4*a]=0,r[t+1]=0;o.updateRange.offset=0,o.updateRange.count=-1,o.needsUpdate=!0}return this},SPE.Emitter.prototype.enable=function(){"use strict";return this.alive=!0,this},SPE.Emitter.prototype.disable=function(){"use strict";return this.alive=!1,this},SPE.Emitter.prototype.remove=function(){"use strict";return null!==this.group?this.group.removeEmitter(this):console.error("Emitter does not belong to a group, cannot remove."),this},function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Stats=t()}(this,(function(){var e=function(){function t(e){return r.appendChild(e.dom),e}function n(e){for(var t=0;t<r.children.length;t++)r.children[t].style.display=t===e?"block":"none";i=e}var i=0,r=document.createElement("div");r.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",(function(e){e.preventDefault(),n(++i%r.children.length)}),!1);var o=(performance||Date).now(),a=o,s=0,l=t(new e.Panel("FPS","#0ff","#002")),u=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new e.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:r,addPanel:t,showPanel:n,begin:function(){o=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(u.update(e-o,200),e>a+1e3&&(l.update(1e3*s/(e-a),100),a=e,s=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:r,setMode:n}};return e.Panel=function(e,t,n){var i=1/0,r=0,o=Math.round,a=o(window.devicePixelRatio||1),s=80*a,l=48*a,u=3*a,c=2*a,h=3*a,p=15*a,d=74*a,f=30*a,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*a+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,s,l),g.fillStyle=t,g.fillText(e,u,c),g.fillRect(h,p,d,f),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h,p,d,f),{dom:m,update:function(l,v){i=Math.min(i,l),r=Math.max(r,l),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,s,p),g.fillStyle=t,g.fillText(o(l)+" "+e+" ("+o(i)+"-"+o(r)+")",u,c),g.drawImage(m,h+a,p,d-a,f,h,p,d-a,f),g.fillRect(h+d-a,p,a,f),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h+d-a,p,a,o((1-l/v)*f))}}},e})),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.thingjs={})}(this,(function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function o(e){THREE.Loader.call(this,e),this.dracoLoader=null,this.ddsLoader=null,this.options={}}function a(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}o.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:o,load:function(e,t,n,i){var r,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=this;a.options=o,r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),a.manager.itemStart(e);var s=function(t){var n=!1;i?n=i(t):console.error(t),n||a.manager.itemError(e),a.manager.itemEnd(e)},l=new THREE.FileLoader(a.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),"use-credentials"===a.crossOrigin&&l.setWithCredentials(!0),l.load(e,(function(n){try{a.parse(n,r,(function(n){t(n),a.manager.itemEnd(e)}),s)}catch(e){s(e)}}),n,s)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},parse:function(e,t,n,i){var r,o={};if("string"==typeof e)r=e;else if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===h){try{o[s.KHR_BINARY_GLTF]=new f(e)}catch(e){return void(i&&i(e))}r=o[s.KHR_BINARY_GLTF].content}else r=THREE.LoaderUtils.decodeText(new Uint8Array(e));var a=JSON.parseX(r,this);if(a)if(void 0===a.asset||a.asset.version[0]<2)i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(a.extensionsUsed)for(var p=0;p<a.extensionsUsed.length;++p){var d=a.extensionsUsed[p],v=a.extensionsRequired||[];switch(d){case s.KHR_LIGHTS_PUNCTUAL:o[d]=new u(a);break;case s.KHR_MATERIALS_UNLIT:o[d]=new c;break;case s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[d]=new y;break;case s.KHR_DRACO_MESH_COMPRESSION:o[d]=new m(a,this.dracoLoader);break;case s.MSFT_TEXTURE_DDS:o[s.MSFT_TEXTURE_DDS]=new l(this.ddsLoader);break;case s.KHR_TEXTURE_TRANSFORM:o[d]=new g;break;case s.KHR_MESH_QUANTIZATION:o[d]=new b;break;default:v.indexOf(d)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}new q(a,o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,staticImage:this.options.staticImage}).parse(n,i)}else i&&i(new Error("THREE.GLTFLoader: Unsupported JSON data."))}});var s={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function l(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=s.MSFT_TEXTURE_DDS,this.ddsLoader=e}function u(e){this.name=s.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[s.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function c(e){this.name=s.KHR_MATERIALS_UNLIT}u.prototype.loadLight=function(e){var t,n=this.lightDefs[e],i=new THREE.Color(16777215);void 0!==n.color&&i.fromArray(n.color);var r=void 0!==n.range?n.range:0;switch(n.type){case"directional":(t=new THREE.DirectionalLight(i)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new THREE.PointLight(i)).distance=r;break;case"spot":(t=new THREE.SpotLight(i)).distance=r,n.spot=n.spot||{},n.spot.innerConeAngle=void 0!==n.spot.innerConeAngle?n.spot.innerConeAngle:0,n.spot.outerConeAngle=void 0!==n.spot.outerConeAngle?n.spot.outerConeAngle:Math.PI/4,t.angle=n.spot.outerConeAngle,t.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+n.type+'".')}return t.position.set(0,0,0),t.decay=2,void 0!==n.intensity&&(t.intensity=n.intensity),t.name=n.name||"light_"+e,Promise.resolve(t)},c.prototype.getMaterialType=function(){return THREE.MeshBasicMaterial},c.prototype.extendParams=function(e,t,n){var i=[];e.color=new THREE.Color(1,1,1),e.opacity=1;var r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){var o=r.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(e,"map",r.baseColorTexture))}return Promise.all(i)};var h="glTF",p=1313821514,d=5130562;function f(e){this.name=s.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,12);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==h)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var n=new DataView(e,12),i=0;i<n.byteLength;){var r=n.getUint32(i,!0);i+=4;var o=n.getUint32(i,!0);if(i+=4,o===p){var a=new Uint8Array(e,12+i,r);this.content=THREE.LoaderUtils.decodeText(a)}else if(o===d){var l=12+i;this.body=e.slice(l,l+r)}i+=r}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function m(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=s.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function g(){this.name=s.KHR_TEXTURE_TRANSFORM}function v(e){THREE.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),a={specular:{value:(new THREE.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(e){for(var s in a)e.uniforms[s]=a[s];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),e.fragmentShader=e.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_pars_fragment>",t),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_pars_fragment>",n),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_fragment>",i),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_fragment>",r),e.fragmentShader=e.fragmentShader.replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(e){a.specular.value=e}},specularMap:{get:function(){return a.specularMap.value},set:function(e){a.specularMap.value=e}},glossiness:{get:function(){return a.glossiness.value},set:function(e){a.glossiness.value=e}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(e){a.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function y(){return{name:s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return v},extendParams:function(e,t,n){var i=t.extensions[this.name];e.color=new THREE.Color(1,1,1),e.opacity=1;var r=[];if(Array.isArray(i.diffuseFactor)){var o=i.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(void 0!==i.diffuseTexture&&r.push(n.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){var a=i.specularGlossinessTexture;r.push(n.assignTexture(e,"glossinessMap",a)),r.push(n.assignTexture(e,"specularMap",a))}return Promise.all(r)},createMaterial:function(e){var t=new v(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=THREE.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function b(){this.name=s.KHR_MESH_QUANTIZATION}function _(e,t,n,i){THREE.Interpolant.call(this,e,t,n,i)}m.prototype.decodePrimitive=function(e,t){var n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},s={},l={};for(var u in o){var c=k[u]||u.toLowerCase();a[c]=o[u]}for(u in e.attributes){c=k[u]||u.toLowerCase();if(void 0!==o[u]){var h=n.accessors[e.attributes[u]],p=A[h.componentType];l[c]=p,s[c]=!0===h.normalized}}return t.getDependency("bufferView",r).then((function(e){return new Promise((function(t){i.decodeDracoFile(e,(function(e){for(var n in e.attributes){var i=e.attributes[n],r=s[n];void 0!==r&&(i.normalized=r)}t(e)}),a,l)}))}))},g.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},v.prototype=Object.create(THREE.MeshStandardMaterial.prototype),v.prototype.constructor=v,v.prototype.copy=function(e){return THREE.MeshStandardMaterial.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},_.prototype=Object.create(THREE.Interpolant.prototype),_.prototype.constructor=_,_.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i,o=0;o!==i;o++)t[o]=n[r+o];return t},_.prototype.beforeStart_=_.prototype.copySampleValue_,_.prototype.afterEnd_=_.prototype.copySampleValue_,_.prototype.interpolate_=function(e,t,n,i){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,u=i-t,c=(n-t)/u,h=c*c,p=h*c,d=e*l,f=d-l,m=-2*p+3*h,g=p-h,v=1-m,y=g-h+c,b=0;b!==a;b++){var _=o[f+b+a],x=o[f+b+s]*u,E=o[d+b+a],w=o[d+b]*u;r[b]=v*_+y*x+m*E+g*w}return r};var x=0,E=1,w=2,T=3,M=4,S=5,C=6,A={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},R={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},P={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},D={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},k={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",TEXCOORD_2:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},j={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},O={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},F="OPAQUE",B="MASK",L="BLEND",I={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};function N(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function H(e,t,n){for(var i in n.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function z(e,n){void 0!==n.extras&&("object"===t(n.extras)?Object.assign(e.userData,n.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+n.extras))}function U(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,i=t.weights.length;n<i;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(n=0,i=r.length;n<i;n++)e.morphTargetDictionary[r[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function V(e){for(var t="",n=Object.keys(e).sort(),i=0,r=n.length;i<r;i++)t+=n[i]+":"+e[n[i]]+";";return t}function q(e,t,n){this.json=e||{},this.extensions=t||{},this.options=n||{},this.cache=new a,this.primitiveCache=[],this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function G(e,t,n){var i=t.attributes,r=[];function o(t,i){return n.getDependency("accessor",t).then((function(t){e.addAttribute(i,t)}))}for(var a in i){var s=k[a]||a.toLowerCase();s&&(s in e.attributes||r.push(o(i[a],s)))}if(void 0!==t.indices&&!e.index){var l=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));r.push(l)}return z(e,t),function(e,t,n){var i=t.attributes,r=new THREE.Box3;if(void 0!==i.POSITION){var o=(h=n.json.accessors[i.POSITION]).min,a=h.max;if(void 0!==o&&void 0!==a){r.set(new THREE.Vector3(o[0],o[1],o[2]),new THREE.Vector3(a[0],a[1],a[2]));var s=t.targets;if(void 0!==s)for(var l=new THREE.Vector3,u=0,c=s.length;u<c;u++){var h,p=s[u];if(void 0!==p.POSITION)o=(h=n.json.accessors[p.POSITION]).min,a=h.max,void 0!==o&&void 0!==a?(l.setX(Math.max(Math.abs(o[0]),Math.abs(a[0]))),l.setY(Math.max(Math.abs(o[1]),Math.abs(a[1]))),l.setZ(Math.max(Math.abs(o[2]),Math.abs(a[2]))),r.expandByVector(l)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}e.boundingBox=r;var d=new THREE.Sphere;r.getCenter(d.center),d.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=d}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,n),Promise.all(r).then((function(){return void 0!==t.targets?function(e,t,n){for(var i=!1,r=!1,o=0,a=t.length;o<a&&(void 0!==(u=t[o]).POSITION&&(i=!0),void 0!==u.NORMAL&&(r=!0),!i||!r);o++);if(!i&&!r)return Promise.resolve(e);var s=[],l=[];for(o=0,a=t.length;o<a;o++){var u=t[o];if(i){var c=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):e.attributes.position;s.push(c)}r&&(c=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):e.attributes.normal,l.push(c))}return Promise.all([Promise.all(s),Promise.all(l)]).then((function(t){var n=t[0],o=t[1];return i&&(e.morphAttributes.position=n),r&&(e.morphAttributes.normal=o),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function W(e,t){var n=e.getIndex();if(null===n){var i=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var o=0;o<r.count;o++)i.push(o);e.setIndex(i),n=e.getIndex()}var a=n.count-2,s=[];if(t===THREE.TriangleFanDrawMode)for(o=1;o<=a;o++)s.push(n.getX(0)),s.push(n.getX(o)),s.push(n.getX(o+1));else for(o=0;o<a;o++)o%2==0?(s.push(n.getX(o)),s.push(n.getX(o+1)),s.push(n.getX(o+2))):(s.push(n.getX(o+2)),s.push(n.getX(o+1)),s.push(n.getX(o)));s.length/3!==a&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=e.clone();return l.setIndex(s),l}q.prototype.parse=function(e,t){var n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera"),this.getDependencies("material")]).then((function(t){var o={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],materials:t[3],asset:i.asset,parser:n,userData:{}};H(r,o,i),z(o,i),e(o)})).catch(t)},q.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],i={},r={},o=0,a=t.length;o<a;o++)for(var s=t[o].joints,l=0,u=s.length;l<u;l++)e[s[l]].isBone=!0;for(var c=0,h=e.length;c<h;c++){var p=e[c];void 0!==p.mesh&&(void 0===i[p.mesh]&&(i[p.mesh]=r[p.mesh]=0),i[p.mesh]++,void 0!==p.skin&&(n[p.mesh].isSkinnedMesh=!0))}this.json.meshReferences=i,this.json.meshUses=r},q.prototype.getDependency=function(e,t){var n=e+":"+t,i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this.loadMesh(t);break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this.loadBufferView(t);break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this.loadMaterial(t);break;case"texture":i=this.loadTexture(t);break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;case"light":i=this.extensions[s.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i},q.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var n=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map((function(t,i){return n.getDependency(e,i)}))),this.cache.add(e,t)}return t},q.prototype.loadBuffer=function(e){var t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[s.KHR_BINARY_GLTF].body);var i=this.options;return new Promise((function(e,r){n.load(N(t.uri,i.path),e,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},q.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var n=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+n)}))},q.prototype.loadAccessor=function(e){var t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);var r=[];return void 0!==i.bufferView?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),void 0!==i.sparse&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then((function(e){var r,o,a=e[0],s=D[i.type],l=A[i.componentType],u=l.BYTES_PER_ELEMENT,c=u*s,h=i.byteOffset||0,p=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,d=!0===i.normalized;if(p&&p!==c){var f=Math.floor(h/p),m="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+f+":"+i.count,g=t.cache.get(m);g||(r=new l(a,f*p,i.count*p/u),g=new THREE.InterleavedBuffer(r,p/u),t.cache.add(m,g)),o=new THREE.InterleavedBufferAttribute(g,s,h%p/u,d)}else r=null===a?new l(i.count*s):new l(a,h,i.count*s),o=new THREE.BufferAttribute(r,s,d);if(void 0!==i.sparse){var v=D.SCALAR,y=A[i.sparse.indices.componentType],b=i.sparse.indices.byteOffset||0,_=i.sparse.values.byteOffset||0,x=new y(e[1],b,i.sparse.count*v),E=new l(e[2],_,i.sparse.count*s);null!==a&&(o=new THREE.BufferAttribute(o.array.slice(),o.itemSize,o.normalized));for(var w=0,T=x.length;w<T;w++){var M=x[w];if(o.setX(M,E[w*s]),s>=2&&o.setY(M,E[w*s+1]),s>=3&&o.setZ(M,E[w*s+2]),s>=4&&o.setW(M,E[w*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o}))},q.prototype.loadTexture=function(e){var t,n=this,i=this.json,r=this.options,o=this.textureLoader,a=window.URL||window.webkitURL,l=i.textures[e],u=l.extensions||{},c=(t=u[s.MSFT_TEXTURE_DDS]?i.images[u[s.MSFT_TEXTURE_DDS].source]:i.images[l.source]).uri,h=!1;return void 0!==t.bufferView&&(c=n.getDependency("bufferView",t.bufferView).then((function(e){h=!0;var n=new Blob([e],{type:t.mimeType});return c=a.createObjectURL(n)}))),Promise.resolve(c).then((function(e){var t=r.manager.getHandler(e);return t||(t=u[s.MSFT_TEXTURE_DDS]?n.extensions[s.MSFT_TEXTURE_DDS].ddsLoader:o),new Promise((function(n,i){if(r&&r.staticImage){var o=new THREE.Texture;o.image=r.staticImage,o.format=THREE.RGBAFormat,o.needsUpdate=!0,n(o)}else t.load(N(e,r.path),n,void 0,i)}))})).then((function(e){!0===h&&a.revokeObjectURL(c),e.flipY=!1,void 0!==l.name&&(e.name=l.name),t.mimeType in I&&(e.format=I[t.mimeType]);var n=(i.samplers||{})[l.sampler]||{};return e.magFilter=R[n.magFilter]||THREE.LinearFilter,e.minFilter=R[n.minFilter]||THREE.LinearMipMapLinearFilter,e.wrapS=P[n.wrapS]||THREE.RepeatWrapping,e.wrapT=P[n.wrapT]||THREE.RepeatWrapping,e}))},q.prototype.assignTexture=function(e,t,n){var i=this,r=this;if(void 0!==n.extensions&&n.extensions.textureExtensions){var o=n.extensions.textureExtensions.map((function(e){return i.getDependency("texture",e.index)}));return Promise.all(o).then((function(n){e[t]=n[0],e["_replace_"+t]=n}))}return this.getDependency("texture",n.index).then((function(i){if(i.isCompressedTexture,r.extensions[s.KHR_TEXTURE_TRANSFORM]){var o=void 0!==n.extensions?n.extensions[s.KHR_TEXTURE_TRANSFORM]:void 0;o&&(i=r.extensions[s.KHR_TEXTURE_TRANSFORM].extendTexture(i,o))}e[t]=i}))},q.prototype.assignFinalMaterial=function(e){var t=e.geometry,n=e.material,i=(this.extensions,void 0!==t.attributes.tangent),r=void 0!==t.attributes.color,o=void 0!==t.attributes.alphaIndex,a=void 0===t.attributes.normal,s=!0===e.isSkinnedMesh,l=Object.keys(t.morphAttributes).length>0,u=l&&void 0!==t.morphAttributes.normal;if(e.isPoints){var c="PointsMaterial:"+n.uuid,h=this.cache.get(c);h||(h=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(h,n),h.color.copy(n.color),h.map=n.map,h.sizeAttenuation=!1,this.cache.add(c,h)),n=h}else if(e.isLine){c="LineBasicMaterial:"+n.uuid;var p=this.cache.get(c);p||(p=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(p,n),p.color.copy(n.color),this.cache.add(c,p)),n=p}if(i||r||o||a||s||l){c="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),s&&(c+="skinning:"),i&&(c+="vertex-tangents:"),r&&(c+="vertex-colors:"),o&&(c+="vertex-alpha:"),a&&(c+="flat-shading:"),l&&(c+="morph-targets:"),u&&(c+="morph-normals:");var d=this.cache.get(c);d||(d=n.clone(),s&&(d.skinning=!0),i&&(d.vertexTangents=!0),r&&(d.vertexColors=!0),o&&(d.defines=d.defines||{},d.defines.USE_ALPHAINDEX=!0),a&&(d.flatShading=!0),l&&(d.morphTargets=!0),u&&(d.morphNormals=!0),this.cache.add(c,d)),n=d}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",new THREE.BufferAttribute(t.attributes.uv.array,2)),n.normalScale&&!i&&(n.normalScale.y=-n.normalScale.y),e.material=n},q.prototype.loadMaterial=function(e){var t,n=this.json,i=this.extensions,r=n.materials[e],o={},a=r.extensions||{},l=[];if(a[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=i[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=u.getMaterialType(r),l.push(u.extendParams(o,r,this))}else if(a[s.KHR_MATERIALS_UNLIT]){var c=i[s.KHR_MATERIALS_UNLIT];t=c.getMaterialType(r),l.push(c.extendParams(o,r,this))}else{t=THREE.MeshStandardMaterial;var h=r.pbrMetallicRoughness||{};if(o.color=new THREE.Color(1,1,1),o.opacity=1,Array.isArray(h.baseColorFactor)){var p=h.baseColorFactor;o.color.fromArray(p),o.opacity=p[3]}void 0!==h.baseColorTexture&&(l.push(this.assignTexture(o,"map",h.baseColorTexture)),1==h.baseColorTexture.texCoord&&(o.__useDiffuseUV2=!0)),o.metalness=void 0!==h.metallicFactor?h.metallicFactor:1,o.roughness=void 0!==h.roughnessFactor?h.roughnessFactor:1,void 0!==h.metallicRoughnessTexture&&(l.push(this.assignTexture(o,"metalnessMap",h.metallicRoughnessTexture)),l.push(this.assignTexture(o,"roughnessMap",h.metallicRoughnessTexture)))}!0===r.doubleSided&&(o.side=THREE.DoubleSide);var d=r.alphaMode||F;d===L?o.transparent=!0:(o.transparent=!1,d===B&&(o.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&t!==THREE.MeshBasicMaterial&&(l.push(this.assignTexture(o,"normalMap",r.normalTexture)),o.normalScale=new THREE.Vector2(1,1),void 0!==r.normalTexture.scale&&o.normalScale.set(r.normalTexture.scale,r.normalTexture.scale)),void 0!==r.occlusionTexture&&t!==THREE.MeshBasicMaterial&&(l.push(this.assignTexture(o,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(o.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&t!==THREE.MeshBasicMaterial&&(o.emissive=(new THREE.Color).fromArray(r.emissiveFactor)),void 0!==r.emissiveTexture&&t!==THREE.MeshBasicMaterial&&l.push(this.assignTexture(o,"emissiveMap",r.emissiveTexture));var f=[],m=a.blend;if(m)for(var g=0;g<m.length;g++)m[g].maskTexture&&l.push(this.assignTexture(f,g,m[g].maskTexture));return Promise.all(l).then((function(){var e,n=o.__useDiffuseUV2;n&&delete o.__useDiffuseUV2;var l=o._replace_map;l&&delete o._replace_map;var u=o._replace_emissiveMap;for(var c in u&&delete o._replace_emissiveMap,e=t===v?i[s.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new t(o),void 0!==r.name&&(e.name=r.name),e.map&&(e.map.encoding=THREE.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=THREE.sRGBEncoding),z(e,r),r.extensions&&H(i,e,r),a)void 0===i[c]&&("sceneBlend"===c?(e.transparent=!0,e.blending=void 0===THREE[a[c]+"Blending"]?1:THREE[a[c]+"Blending"]):"blend"===c?e.__texture=f:"depthWrite"===c?e.depthWrite=!!a[c]:"wireframe"===c&&(e.wireframe=!!a[c]));l&&(e._replace_map=l);var h=(r.pbrMetallicRoughness||{}).baseColorTexture,p=r.emissiveTexture,d=r.normalTexture;return void 0===e.userData.gltfExtensions&&(e.userData.gltfExtensions={}),h&&h.extensions&&(e.userData.gltfExtensions.baseColorTexture=h.extensions),p&&p.extensions&&(e.userData.gltfExtensions.emissiveTexture=p.extensions),d&&d.extensions&&(e.userData.gltfExtensions.normalTexture=d.extensions),n&&(e.userData.gltfExtensions.useDiffuseUV2=!0),e}))},q.prototype.loadGeometries=function(e){var t=this,n=this.extensions,i=this.primitiveCache;function r(e){return n[s.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return G(n,e,t)}))}for(var o,a,l=[],u=0,c=e.length;u<c;u++){var h,p=e[u],d=(a=void 0,(a=(o=p).extensions&&o.extensions[s.KHR_DRACO_MESH_COMPRESSION])?"draco:"+a.bufferView+":"+a.indices+":"+V(a.attributes):o.indices+":"+V(o.attributes)+":"+o.mode),f=i[d];if(f)l.push(f.promise);else h=p.extensions&&p.extensions[s.KHR_DRACO_MESH_COMPRESSION]?r(p):G(new THREE.BufferGeometry,p,t),i[d]={primitive:p,promise:h},l.push(h)}return Promise.all(l).then((function(e){return e.forEach((function(e){var t=e.attributes.color;if(t&&4===t.itemSize){for(var n=t.count,i=new Float32Array(n),r=0;r<n;r++)i.set([t.getW(r)],r);var o=new THREE.BufferAttribute(i,1);e.addAttribute("alphaIndex",o)}})),e}))},q.prototype.loadMesh=function(e){for(var t,n=this,i=this.json.meshes[e],r=i.primitives,o=[],a=0,s=r.length;a<s;a++){var l=void 0===r[a].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),t.DefaultMaterial):this.getDependency("material",r[a].material);o.push(l)}return o.push(n.loadGeometries(r)),Promise.all(o).then((function(t){for(var o=t.slice(0,t.length-1),a=t[t.length-1],s=[],l=0,u=a.length;l<u;l++){var c,h=a[l],p=r[l],d=o[l];if(p.mode===M||p.mode===S||p.mode===C||void 0===p.mode)!0!==(c=!0===i.isSkinnedMesh?new THREE.SkinnedMesh(h,d):new THREE.Mesh(h,d)).isSkinnedMesh||c.geometry.attributes.skinWeight.normalized||c.normalizeSkinWeights(),p.mode===S?c.geometry=W(c.geometry,THREE.TriangleStripDrawMode):p.mode===C&&(c.geometry=W(c.geometry,THREE.TriangleFanDrawMode));else if(p.mode===E)c=new THREE.LineSegments(h,d);else if(p.mode===T)c=new THREE.Line(h,d);else if(p.mode===w)c=new THREE.LineLoop(h,d);else{if(p.mode!==x)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);c=new THREE.Points(h,d)}Object.keys(c.geometry.morphAttributes).length>0&&U(c,i),c.name=i.name||"mesh_"+e,a.length>1&&(c._wName=0===l?c.name:"_skip_wireframes_",c.name+="_"+l),z(c,i),n.assignFinalMaterial(c),s.push(c)}if(1===s.length)return s[0];var f=new THREE.Group;for(l=0,u=s.length;l<u;l++)f.add(s[l]);return f}))},q.prototype.loadCamera=function(e){var t,n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new THREE.OrthographicCamera(i.xmag/-2,i.xmag/2,i.ymag/2,i.ymag/-2,i.znear,i.zfar)),void 0!==n.name&&(t.name=n.name),z(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},q.prototype.loadSkin=function(e){var t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))},q.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],n=[],i=[],r=[],o=[],a=[],s=0,l=t.channels.length;s<l;s++){var u=t.channels[s],c=t.samplers[u.sampler],h=u.target,p=void 0!==h.node?h.node:h.id,d=void 0!==t.parameters?t.parameters[c.input]:c.input,f=void 0!==t.parameters?t.parameters[c.output]:c.output;n.push(this.getDependency("node",p)),i.push(this.getDependency("accessor",d)),r.push(this.getDependency("accessor",f)),o.push(c),a.push(h)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(r),Promise.all(o),Promise.all(a)]).then((function(n){for(var i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=[],u=0,c=i.length;u<c;u++){var h=i[u],p=r[u],d=o[u],f=a[u],m=s[u];if(void 0!==h){var g;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,j[m.path]){case j.weights:g=THREE.NumberKeyframeTrack;break;case j.rotation:g=THREE.QuaternionKeyframeTrack;break;case j.position:case j.scale:default:g=THREE.VectorKeyframeTrack}var v=h.name?h.name:h.uuid,y=void 0!==f.interpolation?O[f.interpolation]:THREE.InterpolateLinear,b=[];j[m.path]===j.weights?h.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&b.push(e.name?e.name:e.uuid)})):b.push(v);var x=d.array;if(d.normalized){var E;if(x.constructor===Int8Array)E=1/127;else if(x.constructor===Uint8Array)E=1/255;else if(x.constructor==Int16Array)E=1/32767;else{if(x.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");E=1/65535}for(var w=new Float32Array(x.length),T=0,M=x.length;T<M;T++)w[T]=x[T]*E;x=w}for(T=0,M=b.length;T<M;T++){var S=new g(b[T]+"."+j[m.path],p.array,x,y);"CUBICSPLINE"===f.interpolation&&(S.createInterpolant=function(e){return new _(this.times,this.values,this.getValueSize()/3,e)},S.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(S)}}}var C=void 0!==t.name?t.name:"animation_"+e;return new THREE.AnimationClip(C,void 0,l)}))},q.prototype.loadNode=function(e){var t,n=this.json,i=this.extensions,r=this,o=n.meshReferences,a=n.meshUses,l=n.nodes[e];return(t=[],void 0!==l.mesh&&t.push(r.getDependency("mesh",l.mesh).then((function(e){var t;if(o[l.mesh]>1){var n=a[l.mesh]++;(t=e.clone()).name+="_instance_"+n}else t=e;return void 0!==l.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,n=l.weights.length;t<n;t++)e.morphTargetInfluences[t]=l.weights[t]})),t}))),void 0!==l.camera&&t.push(r.getDependency("camera",l.camera)),l.extensions&&l.extensions[s.KHR_LIGHTS_PUNCTUAL]&&void 0!==l.extensions[s.KHR_LIGHTS_PUNCTUAL].light&&t.push(r.getDependency("light",l.extensions[s.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(t)).then((function(e){var t;if((t=!0===l.isBone?new THREE.Bone:e.length>1?new THREE.Group:1===e.length?e[0]:new THREE.Object3D)!==e[0])for(var n=0,r=e.length;n<r;n++)t.add(e[n]);if(void 0!==l.name&&(t.userData.name=l.name,t.name=THREE.PropertyBinding.sanitizeNodeName(l.name)),z(t,l),l.extensions&&H(i,t,l),void 0!==l.matrix){var o=new THREE.Matrix4;o.fromArray(l.matrix),t.applyMatrix4(o)}else void 0!==l.translation&&t.position.fromArray(l.translation),void 0!==l.rotation&&t.quaternion.fromArray(l.rotation),void 0!==l.scale&&t.scale.fromArray(l.scale);return t}))},q.prototype.loadScene=function(){function e(t,n,i,r){var o=i.nodes[t];return r.getDependency("node",t).then((function(e){return void 0===o.skin?e:r.getDependency("skin",o.skin).then((function(e){for(var n=[],i=0,o=(t=e).joints.length;i<o;i++)n.push(r.getDependency("node",t.joints[i]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(e.isMesh){for(var i=[],r=[],o=0,a=n.length;o<a;o++){var s=n[o];if(s){i.push(s);var l=new THREE.Matrix4;void 0!==t.inverseBindMatrices&&l.fromArray(t.inverseBindMatrices.array,16*o),r.push(l)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}e.bind(new THREE.Skeleton(i,r),e.matrixWorld)}})),e}));var t})).then((function(t){n.add(t);var a=[];if(o.children)for(var s=o.children,l=0,u=s.length;l<u;l++){var c=s[l];a.push(e(c,t,i,r))}return Promise.all(a)}))}return function(t){var n=this.json,i=this.extensions,r=this.json.scenes[t],o=new THREE.Scene;void 0!==r.name&&(o.name=r.name),z(o,r),r.extensions&&H(i,o,r);for(var a=r.nodes||[],s=[],l=0,u=a.length;l<u;l++)s.push(e(a[l],o,n,this));return Promise.all(s).then((function(){return o}))}}();var X=Object.prototype.toString,J=function(e){return function(t){return X.call(t)=="[object "+e+"]"}};var Y=function(){var e=1,t=1,n=128/e,i=128/t,r=["rgb(255,255,255)"],o=document.createElement("canvas");o.width=128,o.height=128;for(var a=o.getContext("2d"),s=0;s<t;s++)for(var l=0;l<e;l++)a.fillStyle=r[(l+s)%2],a.fillRect(l*n,s*i,n,i);return o}(),Q={diffuseImage:Y,isType:J,isArray:J("Array"),isObject:J("Object"),isString:J("String"),isNumber:J("Number"),isFunction:J("Function"),isRegExp:J("RegExp"),isUndefined:J("Undefined"),isNull:function(e){return null==e},parseValue:function(e,t){return Q.isNull(e)?t:e},objectKeysToLowerCase:function(e,n,i){var r,o,a,s,l,u,c,h;if(u=Q.objectKeysToLowerCase,"undefined"===(c=t(n))||null===n||0===n||!1===n)n=0;else if("object"===c){if(!(n instanceof u))throw new TypeError('Expected "deep" to be a special object')}else if(!0===n)n=1/0;else{if("number"!==c)throw new TypeError('Expected "deep" to be a boolean, number or object, got "'+c+'"');if(isNaN(n)||n<0)throw new RangeError('Expected "deep" to be a positive number, got '+n)}if(null===e||"object"!==t(e))throw new TypeError('Expected "input" to be an object');if(c=t(i),null!==i&&"undefined"!==c&&"function"!==c)throw new TypeError('Expected "filter" to be a function');if(i=i||null,s=(a=Object.keys(e)).length-1,l={},n){if("number"==typeof n)n=Object.seal(Object.create(u.prototype,{input:{value:[]},output:{value:[]},level:{value:-1,writable:!0},max:{value:n,writable:!1}}));else if(~(r=n.input.indexOf(e)))return n.output[r];for(n.level+=1,n.input.push(e),n.output.push(l),r=s+1;r--;)"object"===t(h=e[o=a[s-r]])&&h&&n.level<n.max&&(i?i(h):h.constructor===Object)&&(h=u(h,n,i)),l[o.toLowerCase()]=h;n.level-=1}else for(r=s+1;r--;)l[(o=a[s-r]).toLowerCase()]=e[o];return l}};String.prototype.removeAt=function(e){var t=this.substring(0);return e>=this.length?t:t.slice(0,e)+t.slice(e+1)},String.prototype.getPath=function(){var e=this.indexOf("\\")>=0?this.lastIndexOf("\\"):this.lastIndexOf("/");return this.substring(0,e)},String.prototype.getExtension=function(){var e=this.split(".");return e.length>1?e.pop():""},String.prototype.getFileName=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.indexOf("\\")>=0?this.lastIndexOf("\\"):this.lastIndexOf("/");if(-1===t)return e?this:this.split(".")[0];var n=this.substring(t);return 0!==n.indexOf("\\")&&0!==n.indexOf("/")||(n=n.substring(1)),e?n:n.split(".")[0]},String.prototype._trimLeft=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("^["+e+"]+"),"")},String.prototype._trimRight=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("["+e+"]+$"),"")},String.prototype.trimBoth=function(e){return this._trimLeft(e)._trimRight(e)},String.prototype.appendPath=function(e){return this._trimRight("/")+"/"+e._trimLeft("/")._trimRight("/")},String.prototype.replaceAll=function(e,t){if(!this.length)return"";for(var n=this.substring(0);-1!==n.indexOf(e);)n=n.replace(e,t);return n};var Z=THREE.TextureLoader.prototype.load;THREE.TextureLoader.prototype.load=function(e,t,n,i){if(this.enableStaticImage){var r=new THREE.Texture;return r.image=Y,r.format=THREE.RGBAFormat,r.needsUpdate=!0,t&&t(r),r}return Z.call(this,e,t,n,i)};var K=function(){function e(t){n(this,e),this._major=0,this._minor=0,this._modified=0;var i=t.split(".");this._major=parseInt(i.length>=1?i[0]:0),this._minor=parseInt(i.length>=2?i[1]:0),this._modified=parseInt(i.length>=3?i[2]:0)}return r(e,[{key:"compare",value:function(t){return Q.isString(t)&&(t=new e(t)),this._major!=t._major?this._major>t._major?1:-1:this._minor!=t._minor?this._minor>t._minor?1:-1:this._modified!=t._modified?this._modified>t._modified?1:-1:0}},{key:"major",get:function(){return this._major}},{key:"minor",get:function(){return this._minor}},{key:"modified",get:function(){return this._modified}}]),e}(),$=function(){function e(t){n(this,e);var i=t.split(" ");this.initYear(i[0]),this.initTime(i[1])}return r(e,[{key:"initYear",value:function(e){var t=e.split("-");this._year=parseInt(t[0],10),this._month=parseInt(t[1],10),this._date=parseInt(t[2],10)}},{key:"initTime",value:function(e){var t=e.split(":");this._hours=parseInt(t[0],10),this._minutes=parseInt(t[1],10),this._seconds=parseInt(t[2],10)}},{key:"getYear",value:function(){return this._year}},{key:"getMonth",value:function(){return this._month-1}},{key:"getDate",value:function(){return this._date}},{key:"getHours",value:function(){return this._hours}},{key:"getMinutes",value:function(){return this._minutes}},{key:"getSeconds",value:function(){return this._seconds}}]),e}(),ee=function(){function e(){n(this,e)}return r(e,[{key:"GLTF_decoder_1_count",value:function(e,t,n,i){return 0==e?i-t:e%2?n%2?i+t:i:i-t}},{key:"GLTF_decoder_1_offset",value:function(e,t,n,i){return 0==e?i:e%2?i-(t*=n):i}},{key:"GLTF_decoder_1_length",value:function(e,t,n,i,r){return t*=n,0==e?r-t:e%2?i%2?r+t:r:r-t}},{key:"GLTF_decoder_2_offset",value:function(e,t,n,i){return e%2?i-(t*=n):i}},{key:"GLTF_decoder_2_length",value:function(e,t,n,i,r){return t*=n,e%2?i%2?r+t:r:r-t}},{key:"GLTF_decoder_3_offset",value:function(e,t,n,i){return e%2?i-(t*=n):i}},{key:"GLTF_decoder_3_length",value:function(e,t,n,i,r){return t*=n,e%2?i%2?r+t:r:r-t}}]),e}(),te=function(){function e(t,i){n(this,e),this._decoder={},this._nameDecoder={},i?(i.data=Q.objectKeysToLowerCase(t),this._init(i.data)):this._init(t)}return r(e,[{key:"_initDecoder",value:function(e){var t=e.createtime;if(t){var n=new $(t),i=n.getSeconds();this._decoder.version=Math.floor(i/10);for(var r=e.size,o=1,a=0;a<r.length;a++){var s=r[a].toString();-1!==s.indexOf(".")&&(o+=Math.floor(s.substring(s.length-1)))}this._decoder.randomWeight=o,this._decoder.randomRanges=[n.getHours()+1,n.getDate()+1,n.getSeconds()%13+1,n.getMinutes()%13+1,o%5*(o%5)+1,e.verts%13+1,e.faces%13+1,e.nodes%13+1]}}},{key:"_nodecode_name",value:function(e,t){return e}},{key:"_decode21_name",value:function(e,t){var n=["F7WD3HNR2OPYV6AUS5TKM018ZBJL4EQXIGC9F","A0JQM9PSLXF18647URV3DNHOCY52TEZBWIGKA","B0IE6Q4S3C7OA28UHTPXDW9NYMGLF1K5VJRZB","EQ72MKL3DYNF5RU1PWBT64X9CIZVJHS8G0OAE"],i=e.charAt(0),r=n[1].indexOf(i);if(-1!==r){r++,r=Math.floor(r/2)+1;var o=(e=e.removeAt(r)).getExtension();e=e.getFileName(!1);for(var a="",s=0;s<e.length;s++){var l=e[s],u=n[(s+1+t)%4],c=u.indexOf(l);0===c?c=35:c--,a+=u[c]}return o?a+"."+o:a}}},{key:"_decode23_name",value:function(e,t){var n=["T64X9CIZVYNF5RU1PWBJHS8G0OAEQ72MKL3DT"],i=e.charAt(0),r=n[0].indexOf(i);if(-1!==r){r++,r=Math.floor(r/2)+1;var o=(e=e.removeAt(r)).getExtension();e=e.getFileName(!1);for(var a="",s=0;s<e.length;s++){var l=e[s],u=n[0],c=u.indexOf(l);0===c?c=35:c--,a+=u[c]}return o?a+"."+o:a}}},{key:"_initResourceDecoder",value:function(e,t){var n=t.texfiles;if(n){var i=new K(e),r=this._nodecode_name;2==i.major&&1==i.minor?r=this._decode21_name:2==i.major&&3==i.minor&&(r=this._decode23_name);var o=Object.keys(n).length,a=t.gltffiles||t.modelfiles;if(a)for(var s=0;s<a.length;s++)a[s]=r(a[s],o);var l=t.lod;if(l){var u=Object.keys(l);for(s=0;s<u.length;s++){var c=u[s];l[r(c,o)]=l[c],delete l[c]}}this._nameDecoder.version=i,this._nameDecoder.decodeFunc=r}}},{key:"_init",value:function(e){if(e){var t=e.version;if(t)new K(t).compare("2.0")<=0||(this._initDecoder(e),this._initResourceDecoder(t,e))}}},{key:"_decode_lt_2_2",value:function(e,t,n){var i=new ee,r=this._nameDecoder.version,o=r&&2==r.major&&2==r.minor;switch(this._decoder.version){case 0:case 3:var a=this._decoder.randomWeight;if("_accessors"==t)for(var s=0;s<n.length;s++){var l=n[s];if(!o||void 0!==l.byteType)(u=e.bufferViews[l.bufferView]).factor=Math.floor(u.byteLength/l.count),u.opFactor=l.byteType,l.count=i.GLTF_decoder_1_count(s,a,l.byteType,l.count),delete l.byteType}else if("_bufferViews"==t)for(s=0;s<n.length;s++){var u=n[s];if(!o||void 0!==u.byteType){var c=u.factor;u.byteOffset=i.GLTF_decoder_1_offset(s,a,c,Q.parseValue(u.uinOffset,u.byteOffset)),u.byteLength=i.GLTF_decoder_1_length(s,a,c,u.opFactor,u.byteLength),delete u.factor,delete u.opFactor}}break;case 1:case 4:var h=this._decoder.randomRanges;if("_accessors"==t)for(s=0;s<n.length;s++){l=n[s];if(!o||void 0!==l.byteType){(u=e.bufferViews[l.bufferView]).factor=Math.floor(u.byteLength/l.count),u.opFactor=l.byteType;a=h[Math.floor(s/2)%8]+(s+1)%7;l.count=i.GLTF_decoder_1_count(s,a,l.byteType,l.count),delete l.byteType}}else if("_bufferViews"==t)for(s=0;s<n.length;s++){u=n[s];if(!o||void 0!==u.byteType){var p=h[Math.floor(s/2)%8]+(s+1)%7;c=u.factor;u.byteOffset=i.GLTF_decoder_2_offset(s,p,c,Q.parseValue(u.uinOffset,u.byteOffset)),u.byteLength=i.GLTF_decoder_2_length(s,p,c,u.opFactor,u.byteLength),delete u.factor,delete u.opFactor}}break;case 2:case 5:this._decoder.randomRanges3=[this._decoder.randomRanges[7],7*e.materials.length%10];var d=(e.buffers[0].byteLength-999).toString();for(s=0;s<d.length;s++){var f=10-Math.floor(d[s]);this._decoder.randomRanges3.push(f)}this._decoder.randomRanges3.push(this._decoder.randomRanges[3]);h=this._decoder.randomRanges3;if("_accessors"==t)for(s=0;s<n.length;s++){l=n[s];if(!o||void 0!==l.byteType){u=e.bufferViews[l.bufferView],a=h[Math.floor(s/2)%h.length]+Math.floor(s+1)%7;u.factor=Math.floor(u.byteLength/l.count),u.opFactor=l.byteType,l.count=i.GLTF_decoder_1_count(s,a,l.byteType,l.count),delete l.byteType}}else if("_bufferViews"==t)for(s=0;s<n.length;s++){u=n[s];if(!o||void 0!==u.byteType){p=h[Math.floor(s/2)%h.length]+Math.floor(s+1)%7,c=u.factor;u.byteOffset=i.GLTF_decoder_3_offset(s,p,c,Q.parseValue(u.uinOffset,u.byteOffset)),u.byteLength=i.GLTF_decoder_3_length(s,p,c,u.opFactor,u.byteLength),delete u.factor,delete u.opFactor}}}}},{key:"_decode_2_3",value:function(e,t){if("_accessors"==e)for(var n=0;n<t.length;n++){t[n].count--}else if("_bufferViews"==e)for(n=0;n<t.length;n++){var i=t[n];i.byteOffset--,i.byteLength--}}},{key:"decode",value:function(e,t,n){var i=this._nameDecoder.version;i&&(i.major<=2&&i.minor<=2?this._decode_lt_2_2(e,t,n):2==i.major&&3==i.minor&&this._decode_2_3(t,n));var r=this._nameDecoder.decodeFunc;if(r&&("_buffers"==t||"_images"==t))for(var o=e.buffers.length+e.images.length,a=0;a<n.length;a++){var s=r(n[a].uri,o);s&&(n[a].uri=s)}}},{key:"decodeDracoFile",value:function(e,t,n){}}]),e}();var ne={process:function(e,t){var n=[];e.traverse((function(e){!function(e,t){if(e.material&&e.material.userData&&e.material.userData.gltfExtensions){var n=e.material.userData.gltfExtensions.blend;if(n){var i,r,o,a=e.material.__texture,s=e.geometry.index.count,l=[{materialIndex:0,start:0,count:s}],u=[e.material],c=!1;for(e.material.defines&&e.material.defines.USE_ALPHAINDEX&&(c=!0),i=0;i<n.length;i++)(r=t[n[i].subMaterial].clone())&&(r.transparent=!0,c&&(r.defines=r.defines||{},r.defines.USE_ALPHAINDEX=!0),n[i].maskTexture&&(1===(o=n[i].maskTexture.texCoord||0)&&(r.defines.USE_ALPHA_UV2=""),2===o&&(r.defines.USE_ALPHA_UV3=""),n[i].maskTexture.extensions&&(r.userData.gltfExtensions.alphaTexture=n[i].maskTexture.extensions),r.alphaMap=a[i],r.needsUpdate=!0),u.push(r),l.push({materialIndex:u.length-1,start:0,count:s}));e.material=u,e.geometry.groups=l}}}(e,t),function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}(e),function(e){e.material&&(Array.isArray(e.material)?e.material.forEach((function(e){e.map&&(e.userData.gltfExtensions.useDiffuseUV2&&(e.defines=e.defines||{},e.defines.USE_DIFFUSE_UV2=""),e.map.anisotropy=16,e.map.needsUpdate=!0)})):e.material.map&&(e.material.userData.gltfExtensions.useDiffuseUV2&&(e.material.defines=e.material.defines||{},e.material.defines.USE_DIFFUSE_UV2=""),e.material.map.anisotropy=16,e.material.map.needsUpdate=!0))}(e),function(e){e.userData&&e.userData.gltfExtensions&&(e.userData.gltfExtensions.effects&&(e.technique={},e.userData.gltfExtensions.effects.skipGlow&&(e.technique.middleGlow="skip",e.traverse((function(e){(e.isMesh||e.isLine||e.isSprite||e.isPoints)&&(e.technique=e.technique||{},e.technique.middleGlow="skip")}))),(e.userData.gltfExtensions.effects.bloom||e.userData.gltfExtensions.effects.glow)&&(e.technique.middleGlow=!0,e.traverse((function(e){(e.isMesh||e.isLine||e.isSprite||e.isPoints)&&(e.technique=e.technique||{},e.technique.middleGlow=!0)}))),e.userData.gltfExtensions.effects.skipInnerGlow&&(e.technique.innerGlow="skip",e.traverse((function(e){(e.isMesh||e.isLine||e.isSprite||e.isPoints)&&(e.technique=e.technique||{},e.technique.innerGlow="skip")}))),(e.userData.gltfExtensions.effects.glowInset||e.userData.gltfExtensions.effects.innerGlow)&&(e.technique.innerGlow=!0,e.traverse((function(e){(e.isMesh||e.isLine||e.isSprite||e.isPoints)&&(e.technique=e.technique||{},e.technique.innerGlow=!0)}))),e._cachedTechnique=JSON.parse(JSON.stringify(e.technique)),delete e.userData.effects),void 0!==e.userData.gltfExtensions.renderOrder&&(e.renderOrder=Number(e.userData.gltfExtensions.renderOrder)),void 0!==e.userData.gltfExtensions.castShadows&&(e.castShadow=!!e.userData.gltfExtensions.castShadows),void 0!==e.userData.gltfExtensions.receiveShadows&&(e.receiveShadow=!!e.userData.gltfExtensions.receiveShadows))}(e),function(e,t){if(e.userData&&e.userData.gltfExtensions&&e.userData.gltfExtensions.wireframe){var n=e.userData.gltfExtensions;if(2==n.wireframe.type){if(n.wireframe.wireframeVerts){var i=[],r=[];n.wireframe.wireframeVerts.forEach((function(e){var t=JSON.parse(e.pos1),n=JSON.parse(e.pos2),o=JSON.parse(e.uv1),a=JSON.parse(e.uv2);i.push(t[0],t[1],t[2],n[0],n[1],n[2]),r.push(o[0],o[1],a[0],a[1])}));var o=new THREE.BufferGeometry;o.addAttribute("position",new THREE.Float32BufferAttribute(i,3)),o.addAttribute("uv",new THREE.Float32BufferAttribute(r,2));var a=e.material;if(!a&&e.children[0]&&(a=e.children[0].material),Array.isArray(a)&&(a=a[0]),a.defines.USE_ALPHAINDEX||a.vertexColors===THREE.VertexColors){var s=a.clone();s.vertexColors=0,s.defines&&delete s.defines.USE_ALPHAINDEX,s.userData=a.userData||{},a=s}var l=new THREE.LineSegments(o,a);l.userData.skipStyle=!0,l.technique=e.technique,l.material.flatShading=!0,l.renderOrder=1,t.push(e),e.parent.add(l)}}else 3==n.wireframe.type&&e.children.slice().forEach((function(i){if(i.isMesh){var r,o=new THREE.EdgesGeometry(i.geometry,n.wireframe.wireframeThreshold||.1);Array.isArray(i.material)?(r=(r=i.material.map((function(e){return new THREE.MeshBasicMaterial({color:e.color,map:e.map,alphaMap:e.alphaMap,transparent:e.transparent,depthWrite:e.depthWrite,blending:e.blending})})))[0]).userData=i.material[0].userData||{}:(r=new THREE.MeshBasicMaterial({color:i.material.color,map:i.material.map,alphaMap:i.material.alphaMap,transparent:i.material.transparent,depthWrite:i.material.depthWrite,blending:i.material.blending})).userData=i.material.userData||{};var a=new THREE.LineSegments(o,r);a.userData.skipStyle=!0,a.name=i.name,a.position.copy(i.position),a.scale.copy(i.scale),a.quaternion.copy(i.quaternion),a.technique=i.technique,a.material.flatShading=!0,a.renderOrder=1,e.add(a),t.push(i)}}));delete n.wireframe}}(e,n)})),n.forEach((function(e){e.parent&&e.parent.remove(e)}))}},ie=function(){function e(t){n(this,e),this._manager=e.defaultManager||t,this._loader=new o(this._manager)}return r(e,[{key:"_ProcessProgressCallback",value:function(e,t,n){var i=0;t.lengthComputable&&t.total>0?t.target.readyState>1&&(i=t.loaded/t.total):i=1,n&&1==(i*=(n.cur+1)/n.total)&&n.cur++,e({progress:i})}},{key:"_loadGLTFs",value:function(e,t,n,i,r,o,a,s,l,u){var c=this,h=this._loader;h.loadingIndex=i,h.setDRACOLoader(e),h.setCrossOrigin("anonymous");var p=(n.gltffiles||n.modelfiles)[i],d=t.appendPath(p),f=n.lod;this.load(d,(function(e){if(f){var t=p.getFileName(!1),n=f[t];Q.isNumber(n)||(console.error("The '"+t+"' distance is invalid, please check name is existing in index.json"),n=1e4),r.addLevel(e.scene,n)}else r.add(e.scene);o.models=o.models||[],o.models.push({animations:e.animations,materials:e.materials}),e.animations&&e.animations.length&&(o.animations=e.animations),o.loadedNumber++,o.loadedNumber===o.totalNumber&&s&&s({url:d.getPath(),node:r,animations:o.animations})}),(function(e){a&&c._ProcessProgressCallback(a,e,o)}),(function(e){if(l)return l(e)}),u)}},{key:"loadGLTFs",value:function(e,t,n,i,r,o,a){var s;t&&null!=n&&n(t),s=t.lod?new THREE.LOD:new THREE.Group;for(var l=t.gltffiles||t.modelfiles,u={loadedNumber:0,totalNumber:l.length,cur:0,total:l.length},c={},h=new te(t,c),p=0;p<l.length;p++)this._loadGLTFs(h,e,c.data,p,s,u,r,i,o,a)}},{key:"loadGLTF",value:function(e,t,n,i,r,o,a){t=t||{};var s,l={},u=this._loader;u.setDRACOLoader(new te(t,l)),u.setCrossOrigin("anonymous"),t=l.data,null!=n&&n(t);var c=t.gltffiles||t.modelfiles;s=c&&c.length?e.appendPath(c[0]):e.appendPath("scene.gltf");var h=this;this.load(s,(function(e){null!=i&&i({url:s.getPath(),node:e.scene,animations:e.animations,materials:e.materials})}),(function(e){r&&h._ProcessProgressCallback(r,e)}),(function(e){if(o)return o(e)}),a)}},{key:"downloadGLTF",value:function(e,t,n,i,r){var o=this;this.load(e,(function(n){null!=t&&t({url:e,node:n.scene,animations:n.animations,materials:n.materials})}),(function(e){n&&o._ProcessProgressCallback(n,e)}),(function(e){if(i)return i(e)}),r)}},{key:"downloadGLTFPackage",value:function(e,t,n,i,r,o){var a=e.appendPath("index.json"),s=this;new THREE.FileLoader(this._manager).load(a,(function(a){if(a)try{var l=Q.objectKeysToLowerCase(JSON.parse(a)),u=l.gltffiles||l.modelfiles;if(u&&0!==u.length){for(var c=0;c<u.length;c++)u[c]||u.splice(c--,1);1===u.length?s.loadGLTF(e,l,t,n,i,r,o):s.loadGLTFs(e,l,t,n,i,r,o)}else s.loadGLTF(e,l,t,n,i,r,o)}catch(e){console.error(e),r&&r(e)}}),(function(){}),(function(o){var a=!1;r&&(a=r(o)),a||s.loadGLTF(e,null,t,n,i,r)}))}},{key:"downloadJSON",value:function(e,t,n){(new THREE.JSONLoader).load(e,(function(n,i){for(var r in i)i[r].skinning=!0;null!=t&&t({url:e,geometry:n,materials:i})}))}},{key:"loadFromURL",value:function(e){var t=e.url,n=e.useStaticImage,i=e.jsonCallback,r=e.modelCallback,o=e.progressCallback,a=e.errorCallback,s=t.getExtension(),l={};n&&(l.staticImage=Q.diffuseImage),"js"==s?this.downloadJSON(t,r,l):"gltf"==s||"glb"==s?this.downloadGLTF(t,r,o,a,l):this.downloadGLTFPackage(t,i,r,o,a,l)}},{key:"load",value:function(e,t,n,i,r){this._loader.load(e,(function(e){ne.process(e.scene,e.materials),t&&t(e)}),n,i,r);var o=this;return{then:function(a,s){return o._loader.load(e,(function(e){ne.process(e.scene,e.materials),t&&t(e),a(e)}),n,(function(e){i&&i(e),s(e)}),r),this}}}},{key:"setCrossOrigin",value:function(e){return this._loader.setCrossOrigin(e),this}},{key:"setPath",value:function(e){return this._loader.setPath(e),this}},{key:"setResourcePath",value:function(e){return this._loader.setResourcePath(e),this}}]),e}(),re=function(){function e(t,i){n(this,e);var r=JSON.parse(t);this._asset=r.asset,this._scene=r.scene,this._scenes=r.scenes,this._extensionsUsed=r.extensionsUsed,this._extensions=r.extensions,this._nodes=r.nodes,this._accessors=r.accessors,this._images=r.images,this._skins=r.skins,this._meshes=r.meshes,this._textures=r.textures,this._samplers=r.samplers,this._materials=r.materials,this._cameras=r.cameras,this._animations=r.animations,this._buffers=r.buffers,this._bufferViews=r.bufferViews,this._meshReferences=r.meshReferences,this._meshUses=r.meshUses,this._init(i)}return r(e,[{key:"_init",value:function(e){var t=e.dracoLoader;if(t)for(var n=Object.keys(this),i=0;i<n.length;i++){var r=n[i],o=this[r];o&&t.decode(this,r,o)}}},{key:"asset",get:function(){return this._asset}},{key:"scene",get:function(){return this._scene}},{key:"scenes",get:function(){return this._scenes}},{key:"extensionsUsed",get:function(){return this._extensionsUsed}},{key:"extensions",get:function(){return this._extensions}},{key:"nodes",get:function(){return this._nodes}},{key:"accessors",get:function(){return this._accessors}},{key:"images",get:function(){return this._images}},{key:"skins",get:function(){return this._skins}},{key:"meshes",get:function(){return this._meshes}},{key:"textures",get:function(){return this._textures}},{key:"samplers",get:function(){return this._samplers}},{key:"materials",get:function(){return this._materials}},{key:"cameras",get:function(){return this._cameras}},{key:"animations",get:function(){return this._animations}},{key:"buffers",get:function(){return this._buffers}},{key:"bufferViews",get:function(){return this._bufferViews}},{key:"meshReferences",set:function(e){this._meshReferences=e},get:function(){return this._meshReferences}},{key:"meshUses",set:function(e){this._meshUses=e},get:function(){return this._meshUses}}]),e}();JSON.parseX=function(e,t){try{return new re(e,t)}catch(e){return console.error(e),null}},re.prototype.toJSON=function(){},THREE&&(THREE.GLTFLoader=ie),e.GLTFLoader=ie,e.JSONXLoader=re,Object.defineProperty(e,"__esModule",{value:!0})})),function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}({"./node_modules/escodegen/escodegen.js":
/*!*********************************************!*\
  !*** ./node_modules/escodegen/escodegen.js ***!
  \*********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,n){(function(e){!function(){"use strict";var i,r,o,a,s,l,u,c,h,p,d,f,m,g,v,y,b,_,x,E,w,T,M,S,C,A;function R(e){return X.Statement.hasOwnProperty(e.type)}s=n(/*! estraverse */"./node_modules/estraverse/estraverse.js"),l=n(/*! esutils */"./node_modules/esutils/lib/utils.js"),i=s.Syntax,o={"||":(r={Sequence:0,Yield:1,Assignment:1,Conditional:2,ArrowFunction:2,LogicalOR:3,LogicalAND:4,BitwiseOR:5,BitwiseXOR:6,BitwiseAND:7,Equality:8,Relational:9,BitwiseSHIFT:10,Additive:11,Multiplicative:12,Await:13,Unary:13,Postfix:14,Call:15,New:16,TaggedTemplate:17,Member:18,Primary:19}).LogicalOR,"&&":r.LogicalAND,"|":r.BitwiseOR,"^":r.BitwiseXOR,"&":r.BitwiseAND,"==":r.Equality,"!=":r.Equality,"===":r.Equality,"!==":r.Equality,is:r.Equality,isnt:r.Equality,"<":r.Relational,">":r.Relational,"<=":r.Relational,">=":r.Relational,in:r.Relational,instanceof:r.Relational,"<<":r.BitwiseSHIFT,">>":r.BitwiseSHIFT,">>>":r.BitwiseSHIFT,"+":r.Additive,"-":r.Additive,"*":r.Multiplicative,"%":r.Multiplicative,"/":r.Multiplicative};function P(e,t){var n="";for(t|=0;t>0;t>>>=1,e+=e)1&t&&(n+=e);return n}function D(e){var t=e.length;return t&&l.code.isLineTerminator(e.charCodeAt(t-1))}function k(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function j(e,t){var n,i;function r(e){return"object"==typeof e&&e instanceof Object&&!(e instanceof RegExp)}for(n in t)t.hasOwnProperty(n)&&(r(i=t[n])?r(e[n])?j(e[n],i):e[n]=j({},i):e[n]=i);return e}function O(e,t){return 8232==(-2&e)?(t?"u":"\\u")+(8232===e?"2028":"2029"):10===e||13===e?(t?"":"\\")+(10===e?"n":"r"):String.fromCharCode(e)}function F(e,t){var n;return 8===e?"\\b":12===e?"\\f":9===e?"\\t":(n=e.toString(16).toUpperCase(),h||e>255?"\\u"+"0000".slice(n.length)+n:0!==e||l.code.isDecimalDigit(t)?11===e?"\\x0B":"\\x"+"00".slice(n.length)+n:"\\0")}function B(e){if(92===e)return"\\\\";if(10===e)return"\\n";if(13===e)return"\\r";if(8232===e)return"\\u2028";if(8233===e)return"\\u2029";throw new Error("Incorrectly classified character")}function L(e,t){if(!T)return Array.isArray(e)?function e(t){var n,i,r,o="";for(n=0,i=t.length;n<i;++n)r=t[n],o+=Array.isArray(r)?e(r):r;return o}(e):e;if(null==t){if(e instanceof a)return e;t={}}return null==t.loc?new a(null,null,T,e,t.name||null):new a(t.loc.start.line,t.loc.start.column,!0===T?t.loc.source||null:T,e,t.name||null)}function I(){return v||" "}function N(e,t){var n,i,r,o;return 0===(n=L(e).toString()).length?[t]:0===(i=L(t).toString()).length?[e]:(r=n.charCodeAt(n.length-1),o=i.charCodeAt(0),(43===r||45===r)&&r===o||l.code.isIdentifierPartES5(r)&&l.code.isIdentifierPartES5(o)||47===r&&105===o?[e,I(),t]:l.code.isWhiteSpace(r)||l.code.isLineTerminator(r)||l.code.isWhiteSpace(o)||l.code.isLineTerminator(o)?[e,t]:[e,v,t])}function H(e){return[u,e]}function z(e){var t;t=u,e(u+=c),u=t}function U(e,t){if("Line"===e.type){if(D(e.value))return"//"+e.value;var n="//"+e.value;return S||(n+="\n"),n}return E.format.indent.adjustMultilineComment&&/[\n\r]/.test(e.value)?function(e,t){var n,i,r,o,a,s,c,h;for(n=e.split(/\r\n|[\r\n]/),s=Number.MAX_VALUE,i=1,r=n.length;i<r;++i){for(o=n[i],a=0;a<o.length&&l.code.isWhiteSpace(o.charCodeAt(a));)++a;s>a&&(s=a)}for(void 0!==t?(c=u,"*"===n[1][s]&&(t+=" "),u=t):(1&s&&--s,c=u),i=1,r=n.length;i<r;++i)h=L(H(n[i].slice(s))),n[i]=T?h.join(""):h;return u=c,n.join("\n")}("/*"+e.value+"*/",t):"/*"+e.value+"*/"}function V(e,t){var n,r,o,a,s,h,p,d,f,m,g,v;if(e.leadingComments&&e.leadingComments.length>0){if(a=t,S){for(t=[],d=(o=e.leadingComments[0]).extendedRange,f=o.range,(v=((g=M.substring(d[0],f[0])).match(/\n/g)||[]).length)>0?(t.push(P("\n",v)),t.push(H(U(o)))):(t.push(g),t.push(U(o))),m=f,n=1,r=e.leadingComments.length;n<r;n++)f=(o=e.leadingComments[n]).range,v=(M.substring(m[1],f[0]).match(/\n/g)||[]).length,t.push(P("\n",v)),t.push(H(U(o))),m=f;v=(M.substring(f[1],d[1]).match(/\n/g)||[]).length,t.push(P("\n",v))}else for(o=e.leadingComments[0],t=[],_&&e.type===i.Program&&0===e.body.length&&t.push("\n"),t.push(U(o)),D(L(t).toString())||t.push("\n"),n=1,r=e.leadingComments.length;n<r;++n)D(L(p=[U(o=e.leadingComments[n])]).toString())||p.push("\n"),t.push(H(p));t.push(H(a))}if(e.trailingComments)if(S)d=(o=e.trailingComments[0]).extendedRange,f=o.range,(v=((g=M.substring(d[0],f[0])).match(/\n/g)||[]).length)>0?(t.push(P("\n",v)),t.push(H(U(o)))):(t.push(g),t.push(U(o)));else for(s=!D(L(t).toString()),h=P(" ",function(e){var t;for(t=e.length-1;t>=0&&!l.code.isLineTerminator(e.charCodeAt(t));--t);return e.length-1-t}(L([u,t,c]).toString())),n=0,r=e.trailingComments.length;n<r;++n)o=e.trailingComments[n],s?(t=0===n?[t,c]:[t,h]).push(U(o,h)):t=[t,H(U(o))],n===r-1||D(L(t).toString())||(t=[t,"\n"]);return t}function q(e,t,n){var i,r=0;for(i=e;i<t;i++)"\n"===M[i]&&r++;for(i=1;i<r;i++)n.push(g)}function G(e,t,n){return t<n?["(",e,")"]:e}function W(e){var t,n,i;for(t=1,n=(i=e.split(/\r\n|\n/)).length;t<n;t++)i[t]=g+u+i[t];return i}function X(){}function J(e){return L(e.name,e)}function Y(e,t){return e.async?"async"+(t?I():v):""}function Q(e){return e.generator&&!E.moz.starlessGenerator?"*"+v:""}function Z(e){var t=e.value,n="";return t.async&&(n+=Y(t,!e.computed)),t.generator&&(n+=Q(t)?"*":""),n}function K(e){var t;if(t=new X,R(e))return t.generateStatement(e,1);if(function(e){return X.Expression.hasOwnProperty(e.type)}(e))return t.generateExpression(e,r.Sequence,7);throw new Error("Unknown node type: "+e.type)}X.prototype.maybeBlock=function(e,t){var n,r,o=this;return r=!E.comment||!e.leadingComments,e.type===i.BlockStatement&&r?[v,this.generateStatement(e,t)]:e.type===i.EmptyStatement&&r?";":(z((function(){n=[g,H(o.generateStatement(e,t))]})),n)},X.prototype.maybeBlockSuffix=function(e,t){var n=D(L(t).toString());return e.type!==i.BlockStatement||E.comment&&e.leadingComments||n?n?[t,u]:[t,g,u]:[t,v]},X.prototype.generatePattern=function(e,t,n){return e.type===i.Identifier?J(e):this.generateExpression(e,t,n)},X.prototype.generateFunctionParams=function(e){var t,n,o,a;if(a=!1,e.type!==i.ArrowFunctionExpression||e.rest||e.defaults&&0!==e.defaults.length||1!==e.params.length||e.params[0].type!==i.Identifier){for((o=e.type===i.ArrowFunctionExpression?[Y(e,!1)]:[]).push("("),e.defaults&&(a=!0),t=0,n=e.params.length;t<n;++t)a&&e.defaults[t]?o.push(this.generateAssignment(e.params[t],e.defaults[t],"=",r.Assignment,7)):o.push(this.generatePattern(e.params[t],r.Assignment,7)),t+1<n&&o.push(","+v);e.rest&&(e.params.length&&o.push(","+v),o.push("..."),o.push(J(e.rest))),o.push(")")}else o=[Y(e,!0),J(e.params[0])];return o},X.prototype.generateFunctionBody=function(e){var t,n;return t=this.generateFunctionParams(e),e.type===i.ArrowFunctionExpression&&(t.push(v),t.push("=>")),e.expression?(t.push(v),"{"===(n=this.generateExpression(e.body,r.Assignment,7)).toString().charAt(0)&&(n=["(",n,")"]),t.push(n)):t.push(this.maybeBlock(e.body,9)),t},X.prototype.generateIterationForStatement=function(e,t,n){var o=["for"+v+(t.await?"await"+v:"")+"("],a=this;return z((function(){t.left.type===i.VariableDeclaration?z((function(){o.push(t.left.kind+I()),o.push(a.generateStatement(t.left.declarations[0],0))})):o.push(a.generateExpression(t.left,r.Call,7)),o=N(o,e),o=[N(o,a.generateExpression(t.right,r.Assignment,7)),")"]})),o.push(this.maybeBlock(t.body,n)),o},X.prototype.generatePropertyKey=function(e,t){var n=[];return t&&n.push("["),n.push(this.generateExpression(e,r.Sequence,7)),t&&n.push("]"),n},X.prototype.generateAssignment=function(e,t,n,i,o){return r.Assignment<i&&(o|=1),G([this.generateExpression(e,r.Call,o),v+n+v,this.generateExpression(t,r.Assignment,o)],r.Assignment,i)},X.prototype.semicolon=function(e){return!b&&32&e?"":";"},X.Statement={BlockStatement:function(e,t){var n,i,r=["{",g],o=this;return z((function(){var a,s,l,u;for(0===e.body.length&&S&&(n=e.range)[1]-n[0]>2&&("\n"===(i=M.substring(n[0]+1,n[1]-1))[0]&&(r=["{"]),r.push(i)),u=1,8&t&&(u|=16),a=0,s=e.body.length;a<s;++a)S&&(0===a&&(e.body[0].leadingComments&&(n=e.body[0].leadingComments[0].extendedRange,"\n"===(i=M.substring(n[0],n[1]))[0]&&(r=["{"])),e.body[0].leadingComments||q(e.range[0],e.body[0].range[0],r)),a>0&&(e.body[a-1].trailingComments||e.body[a].leadingComments||q(e.body[a-1].range[1],e.body[a].range[0],r))),a===s-1&&(u|=32),l=e.body[a].leadingComments&&S?o.generateStatement(e.body[a],u):H(o.generateStatement(e.body[a],u)),r.push(l),D(L(l).toString())||S&&a<s-1&&e.body[a+1].leadingComments||r.push(g),S&&a===s-1&&(e.body[a].trailingComments||q(e.body[a].range[1],e.range[1],r))})),r.push(H("}")),r},BreakStatement:function(e,t){return e.label?"break "+e.label.name+this.semicolon(t):"break"+this.semicolon(t)},ContinueStatement:function(e,t){return e.label?"continue "+e.label.name+this.semicolon(t):"continue"+this.semicolon(t)},ClassBody:function(e,t){var n=["{",g],i=this;return z((function(t){var o,a;for(o=0,a=e.body.length;o<a;++o)n.push(t),n.push(i.generateExpression(e.body[o],r.Sequence,7)),o+1<a&&n.push(g)})),D(L(n).toString())||n.push(g),n.push(u),n.push("}"),n},ClassDeclaration:function(e,t){var n,i;return n=["class"],e.id&&(n=N(n,this.generateExpression(e.id,r.Sequence,7))),e.superClass&&(i=N("extends",this.generateExpression(e.superClass,r.Assignment,7)),n=N(n,i)),n.push(v),n.push(this.generateStatement(e.body,33)),n},DirectiveStatement:function(e,t){return E.raw&&e.raw?e.raw+this.semicolon(t):function(e){var t,n,i,r;for(r="double"===f?'"':"'",t=0,n=e.length;t<n;++t){if(39===(i=e.charCodeAt(t))){r='"';break}if(34===i){r="'";break}92===i&&++t}return r+e+r}(e.directive)+this.semicolon(t)},DoWhileStatement:function(e,t){var n=N("do",this.maybeBlock(e.body,1));return N(n=this.maybeBlockSuffix(e.body,n),["while"+v+"(",this.generateExpression(e.test,r.Sequence,7),")"+this.semicolon(t)])},CatchClause:function(e,t){var n,i=this;return z((function(){var t;n=["catch"+v+"(",i.generateExpression(e.param,r.Sequence,7),")"],e.guard&&(t=i.generateExpression(e.guard,r.Sequence,7),n.splice(2,0," if ",t))})),n.push(this.maybeBlock(e.body,1)),n},DebuggerStatement:function(e,t){return"debugger"+this.semicolon(t)},EmptyStatement:function(e,t){return";"},ExportDefaultDeclaration:function(e,t){var n,i=["export"];return n=32&t?33:1,i=N(i,"default"),R(e.declaration)?N(i,this.generateStatement(e.declaration,n)):N(i,this.generateExpression(e.declaration,r.Assignment,7)+this.semicolon(t))},ExportNamedDeclaration:function(e,t){var n,o=["export"],a=this;return n=32&t?33:1,e.declaration?N(o,this.generateStatement(e.declaration,n)):(e.specifiers&&(0===e.specifiers.length?o=N(o,"{"+v+"}"):e.specifiers[0].type===i.ExportBatchSpecifier?o=N(o,this.generateExpression(e.specifiers[0],r.Sequence,7)):(o=N(o,"{"),z((function(t){var n,i;for(o.push(g),n=0,i=e.specifiers.length;n<i;++n)o.push(t),o.push(a.generateExpression(e.specifiers[n],r.Sequence,7)),n+1<i&&o.push(","+g)})),D(L(o).toString())||o.push(g),o.push(u+"}")),e.source?o=N(o,["from"+v,this.generateExpression(e.source,r.Sequence,7),this.semicolon(t)]):o.push(this.semicolon(t))),o)},ExportAllDeclaration:function(e,t){return["export"+v,"*"+v,"from"+v,this.generateExpression(e.source,r.Sequence,7),this.semicolon(t)]},ExpressionStatement:function(e,t){var n,o;return 123===(o=L(n=[this.generateExpression(e.expression,r.Sequence,7)]).toString()).charCodeAt(0)||function(e){var t;return"class"===e.slice(0,5)&&(123===(t=e.charCodeAt(5))||l.code.isWhiteSpace(t)||l.code.isLineTerminator(t))}(o)||function(e){var t;return"function"===e.slice(0,8)&&(40===(t=e.charCodeAt(8))||l.code.isWhiteSpace(t)||42===t||l.code.isLineTerminator(t))}(o)||function(e){var t,n,i;if("async"!==e.slice(0,5))return!1;if(!l.code.isWhiteSpace(e.charCodeAt(5)))return!1;for(n=6,i=e.length;n<i&&l.code.isWhiteSpace(e.charCodeAt(n));++n);return n!==i&&"function"===e.slice(n,n+8)&&(40===(t=e.charCodeAt(n+8))||l.code.isWhiteSpace(t)||42===t||l.code.isLineTerminator(t))}(o)||x&&16&t&&e.expression.type===i.Literal&&"string"==typeof e.expression.value?n=["(",n,")"+this.semicolon(t)]:n.push(this.semicolon(t)),n},ImportDeclaration:function(e,t){var n,o,a=this;return 0===e.specifiers.length?["import",v,this.generateExpression(e.source,r.Sequence,7),this.semicolon(t)]:(n=["import"],o=0,e.specifiers[o].type===i.ImportDefaultSpecifier&&(n=N(n,[this.generateExpression(e.specifiers[o],r.Sequence,7)]),++o),e.specifiers[o]&&(0!==o&&n.push(","),e.specifiers[o].type===i.ImportNamespaceSpecifier?n=N(n,[v,this.generateExpression(e.specifiers[o],r.Sequence,7)]):(n.push(v+"{"),e.specifiers.length-o==1?(n.push(v),n.push(this.generateExpression(e.specifiers[o],r.Sequence,7)),n.push(v+"}"+v)):(z((function(t){var i,s;for(n.push(g),i=o,s=e.specifiers.length;i<s;++i)n.push(t),n.push(a.generateExpression(e.specifiers[i],r.Sequence,7)),i+1<s&&n.push(","+g)})),D(L(n).toString())||n.push(g),n.push(u+"}"+v)))),n=N(n,["from"+v,this.generateExpression(e.source,r.Sequence,7),this.semicolon(t)]))},VariableDeclarator:function(e,t){var n=1&t?7:6;return e.init?[this.generateExpression(e.id,r.Assignment,n),v,"=",v,this.generateExpression(e.init,r.Assignment,n)]:this.generatePattern(e.id,r.Assignment,n)},VariableDeclaration:function(e,t){var n,i,r,o,a,s=this;function l(){for(o=e.declarations[0],E.comment&&o.leadingComments?(n.push("\n"),n.push(H(s.generateStatement(o,a)))):(n.push(I()),n.push(s.generateStatement(o,a))),i=1,r=e.declarations.length;i<r;++i)o=e.declarations[i],E.comment&&o.leadingComments?(n.push(","+g),n.push(H(s.generateStatement(o,a)))):(n.push(","+v),n.push(s.generateStatement(o,a)))}return n=[e.kind],a=1&t?1:0,e.declarations.length>1?z(l):l(),n.push(this.semicolon(t)),n},ThrowStatement:function(e,t){return[N("throw",this.generateExpression(e.argument,r.Sequence,7)),this.semicolon(t)]},TryStatement:function(e,t){var n,i,r,o;if(n=["try",this.maybeBlock(e.block,1)],n=this.maybeBlockSuffix(e.block,n),e.handlers)for(i=0,r=e.handlers.length;i<r;++i)n=N(n,this.generateStatement(e.handlers[i],1)),(e.finalizer||i+1!==r)&&(n=this.maybeBlockSuffix(e.handlers[i].body,n));else{for(i=0,r=(o=e.guardedHandlers||[]).length;i<r;++i)n=N(n,this.generateStatement(o[i],1)),(e.finalizer||i+1!==r)&&(n=this.maybeBlockSuffix(o[i].body,n));if(e.handler)if(Array.isArray(e.handler))for(i=0,r=e.handler.length;i<r;++i)n=N(n,this.generateStatement(e.handler[i],1)),(e.finalizer||i+1!==r)&&(n=this.maybeBlockSuffix(e.handler[i].body,n));else n=N(n,this.generateStatement(e.handler,1)),e.finalizer&&(n=this.maybeBlockSuffix(e.handler.body,n))}return e.finalizer&&(n=N(n,["finally",this.maybeBlock(e.finalizer,1)])),n},SwitchStatement:function(e,t){var n,i,o,a,s,l=this;if(z((function(){n=["switch"+v+"(",l.generateExpression(e.discriminant,r.Sequence,7),")"+v+"{"+g]})),e.cases)for(s=1,o=0,a=e.cases.length;o<a;++o)o===a-1&&(s|=32),i=H(this.generateStatement(e.cases[o],s)),n.push(i),D(L(i).toString())||n.push(g);return n.push(H("}")),n},SwitchCase:function(e,t){var n,o,a,s,l,u=this;return z((function(){for(n=e.test?[N("case",u.generateExpression(e.test,r.Sequence,7)),":"]:["default:"],a=0,(s=e.consequent.length)&&e.consequent[0].type===i.BlockStatement&&(o=u.maybeBlock(e.consequent[0],1),n.push(o),a=1),a===s||D(L(n).toString())||n.push(g),l=1;a<s;++a)a===s-1&&32&t&&(l|=32),o=H(u.generateStatement(e.consequent[a],l)),n.push(o),a+1===s||D(L(o).toString())||n.push(g)})),n},IfStatement:function(e,t){var n,o,a=this;return z((function(){n=["if"+v+"(",a.generateExpression(e.test,r.Sequence,7),")"]})),o=1,32&t&&(o|=32),e.alternate?(n.push(this.maybeBlock(e.consequent,1)),n=this.maybeBlockSuffix(e.consequent,n),n=e.alternate.type===i.IfStatement?N(n,["else ",this.generateStatement(e.alternate,o)]):N(n,N("else",this.maybeBlock(e.alternate,o)))):n.push(this.maybeBlock(e.consequent,o)),n},ForStatement:function(e,t){var n,o=this;return z((function(){n=["for"+v+"("],e.init?e.init.type===i.VariableDeclaration?n.push(o.generateStatement(e.init,0)):(n.push(o.generateExpression(e.init,r.Sequence,6)),n.push(";")):n.push(";"),e.test?(n.push(v),n.push(o.generateExpression(e.test,r.Sequence,7)),n.push(";")):n.push(";"),e.update?(n.push(v),n.push(o.generateExpression(e.update,r.Sequence,7)),n.push(")")):n.push(")")})),n.push(this.maybeBlock(e.body,32&t?33:1)),n},ForInStatement:function(e,t){return this.generateIterationForStatement("in",e,32&t?33:1)},ForOfStatement:function(e,t){return this.generateIterationForStatement("of",e,32&t?33:1)},LabeledStatement:function(e,t){return[e.label.name+":",this.maybeBlock(e.body,32&t?33:1)]},Program:function(e,t){var n,i,r,o,a;for(o=e.body.length,n=[_&&o>0?"\n":""],a=17,r=0;r<o;++r)_||r!==o-1||(a|=32),S&&(0===r&&(e.body[0].leadingComments||q(e.range[0],e.body[r].range[0],n)),r>0&&(e.body[r-1].trailingComments||e.body[r].leadingComments||q(e.body[r-1].range[1],e.body[r].range[0],n))),i=H(this.generateStatement(e.body[r],a)),n.push(i),r+1<o&&!D(L(i).toString())&&(S&&e.body[r+1].leadingComments||n.push(g)),S&&r===o-1&&(e.body[r].trailingComments||q(e.body[r].range[1],e.range[1],n));return n},FunctionDeclaration:function(e,t){return[Y(e,!0),"function",Q(e)||I(),e.id?J(e.id):"",this.generateFunctionBody(e)]},ReturnStatement:function(e,t){return e.argument?[N("return",this.generateExpression(e.argument,r.Sequence,7)),this.semicolon(t)]:["return"+this.semicolon(t)]},WhileStatement:function(e,t){var n,i=this;return z((function(){n=["while"+v+"(",i.generateExpression(e.test,r.Sequence,7),")"]})),n.push(this.maybeBlock(e.body,32&t?33:1)),n},WithStatement:function(e,t){var n,i=this;return z((function(){n=["with"+v+"(",i.generateExpression(e.object,r.Sequence,7),")"]})),n.push(this.maybeBlock(e.body,32&t?33:1)),n}},k(X.prototype,X.Statement),X.Expression={SequenceExpression:function(e,t,n){var i,o,a;for(r.Sequence<t&&(n|=1),i=[],o=0,a=e.expressions.length;o<a;++o)i.push(this.generateExpression(e.expressions[o],r.Assignment,n)),o+1<a&&i.push(","+v);return G(i,r.Sequence,t)},AssignmentExpression:function(e,t,n){return this.generateAssignment(e.left,e.right,e.operator,t,n)},ArrowFunctionExpression:function(e,t,n){return G(this.generateFunctionBody(e),r.ArrowFunction,t)},ConditionalExpression:function(e,t,n){return r.Conditional<t&&(n|=1),G([this.generateExpression(e.test,r.LogicalOR,n),v+"?"+v,this.generateExpression(e.consequent,r.Assignment,n),v+":"+v,this.generateExpression(e.alternate,r.Assignment,n)],r.Conditional,t)},LogicalExpression:function(e,t,n){return this.BinaryExpression(e,t,n)},BinaryExpression:function(e,t,n){var i,r,a,s;return(r=o[e.operator])<t&&(n|=1),i=47===(s=(a=this.generateExpression(e.left,r,n)).toString()).charCodeAt(s.length-1)&&l.code.isIdentifierPartES5(e.operator.charCodeAt(0))?[a,I(),e.operator]:N(a,e.operator),a=this.generateExpression(e.right,r+1,n),"/"===e.operator&&"/"===a.toString().charAt(0)||"<"===e.operator.slice(-1)&&"!--"===a.toString().slice(0,3)?(i.push(I()),i.push(a)):i=N(i,a),"in"!==e.operator||1&n?G(i,r,t):["(",i,")"]},CallExpression:function(e,t,n){var i,o,a;for((i=[this.generateExpression(e.callee,r.Call,3)]).push("("),o=0,a=e.arguments.length;o<a;++o)i.push(this.generateExpression(e.arguments[o],r.Assignment,7)),o+1<a&&i.push(","+v);return i.push(")"),2&n?G(i,r.Call,t):["(",i,")"]},NewExpression:function(e,t,n){var i,o,a,s,l;if(o=e.arguments.length,l=4&n&&!y&&0===o?5:1,i=N("new",this.generateExpression(e.callee,r.New,l)),!(4&n)||y||o>0){for(i.push("("),a=0,s=o;a<s;++a)i.push(this.generateExpression(e.arguments[a],r.Assignment,7)),a+1<s&&i.push(","+v);i.push(")")}return G(i,r.New,t)},MemberExpression:function(e,t,n){var o,a;return o=[this.generateExpression(e.object,r.Call,2&n?3:1)],e.computed?(o.push("["),o.push(this.generateExpression(e.property,r.Sequence,2&n?7:5)),o.push("]")):(e.object.type===i.Literal&&"number"==typeof e.object.value&&(a=L(o).toString()).indexOf(".")<0&&!/[eExX]/.test(a)&&l.code.isDecimalDigit(a.charCodeAt(a.length-1))&&!(a.length>=2&&48===a.charCodeAt(0))&&o.push(" "),o.push("."),o.push(J(e.property))),G(o,r.Member,t)},MetaProperty:function(e,t,n){var i;return(i=[]).push("string"==typeof e.meta?e.meta:J(e.meta)),i.push("."),i.push("string"==typeof e.property?e.property:J(e.property)),G(i,r.Member,t)},UnaryExpression:function(e,t,n){var i,o,a,s,u;return o=this.generateExpression(e.argument,r.Unary,7),""===v?i=N(e.operator,o):(i=[e.operator],e.operator.length>2?i=N(i,o):(u=(s=L(i).toString()).charCodeAt(s.length-1),a=o.toString().charCodeAt(0),(43===u||45===u)&&u===a||l.code.isIdentifierPartES5(u)&&l.code.isIdentifierPartES5(a)?(i.push(I()),i.push(o)):i.push(o))),G(i,r.Unary,t)},YieldExpression:function(e,t,n){var i;return i=e.delegate?"yield*":"yield",e.argument&&(i=N(i,this.generateExpression(e.argument,r.Yield,7))),G(i,r.Yield,t)},AwaitExpression:function(e,t,n){return G(N(e.all?"await*":"await",this.generateExpression(e.argument,r.Await,7)),r.Await,t)},UpdateExpression:function(e,t,n){return e.prefix?G([e.operator,this.generateExpression(e.argument,r.Unary,7)],r.Unary,t):G([this.generateExpression(e.argument,r.Postfix,7),e.operator],r.Postfix,t)},FunctionExpression:function(e,t,n){var i=[Y(e,!0),"function"];return e.id?(i.push(Q(e)||I()),i.push(J(e.id))):i.push(Q(e)||v),i.push(this.generateFunctionBody(e)),i},ArrayPattern:function(e,t,n){return this.ArrayExpression(e,t,n,!0)},ArrayExpression:function(e,t,n,i){var o,a,s=this;return e.elements.length?(a=!i&&e.elements.length>1,o=["[",a?g:""],z((function(t){var n,i;for(n=0,i=e.elements.length;n<i;++n)e.elements[n]?(o.push(a?t:""),o.push(s.generateExpression(e.elements[n],r.Assignment,7))):(a&&o.push(t),n+1===i&&o.push(",")),n+1<i&&o.push(","+(a?g:v))})),a&&!D(L(o).toString())&&o.push(g),o.push(a?u:""),o.push("]"),o):"[]"},RestElement:function(e,t,n){return"..."+this.generatePattern(e.argument)},ClassExpression:function(e,t,n){var i,o;return i=["class"],e.id&&(i=N(i,this.generateExpression(e.id,r.Sequence,7))),e.superClass&&(o=N("extends",this.generateExpression(e.superClass,r.Assignment,7)),i=N(i,o)),i.push(v),i.push(this.generateStatement(e.body,33)),i},MethodDefinition:function(e,t,n){var i,r;return i=e.static?["static"+v]:[],r="get"===e.kind||"set"===e.kind?[N(e.kind,this.generatePropertyKey(e.key,e.computed)),this.generateFunctionBody(e.value)]:[Z(e),this.generatePropertyKey(e.key,e.computed),this.generateFunctionBody(e.value)],N(i,r)},Property:function(e,t,n){return"get"===e.kind||"set"===e.kind?[e.kind,I(),this.generatePropertyKey(e.key,e.computed),this.generateFunctionBody(e.value)]:e.shorthand?"AssignmentPattern"===e.value.type?this.AssignmentPattern(e.value,r.Sequence,7):this.generatePropertyKey(e.key,e.computed):e.method?[Z(e),this.generatePropertyKey(e.key,e.computed),this.generateFunctionBody(e.value)]:[this.generatePropertyKey(e.key,e.computed),":"+v,this.generateExpression(e.value,r.Assignment,7)]},ObjectExpression:function(e,t,n){var i,o,a,s,l=this;return e.properties.length?(i=e.properties.length>1,z((function(){a=l.generateExpression(e.properties[0],r.Sequence,7)})),i||(s=L(a).toString(),/[\r\n]/g.test(s))?(z((function(t){var n,s;if(o=["{",g,t,a],i)for(o.push(","+g),n=1,s=e.properties.length;n<s;++n)o.push(t),o.push(l.generateExpression(e.properties[n],r.Sequence,7)),n+1<s&&o.push(","+g)})),D(L(o).toString())||o.push(g),o.push(u),o.push("}"),o):["{",v,a,v,"}"]):"{}"},AssignmentPattern:function(e,t,n){return this.generateAssignment(e.left,e.right,"=",t,n)},ObjectPattern:function(e,t,n){var o,a,s,l,c=this;if(!e.properties.length)return"{}";if(l=!1,1===e.properties.length)e.properties[0].value.type!==i.Identifier&&(l=!0);else for(a=0,s=e.properties.length;a<s;++a)if(!e.properties[a].shorthand){l=!0;break}return o=["{",l?g:""],z((function(t){var n,i;for(n=0,i=e.properties.length;n<i;++n)o.push(l?t:""),o.push(c.generateExpression(e.properties[n],r.Sequence,7)),n+1<i&&o.push(","+(l?g:v))})),l&&!D(L(o).toString())&&o.push(g),o.push(l?u:""),o.push("}"),o},ThisExpression:function(e,t,n){return"this"},Super:function(e,t,n){return"super"},Identifier:function(e,t,n){return J(e)},ImportDefaultSpecifier:function(e,t,n){return J(e.id||e.local)},ImportNamespaceSpecifier:function(e,t,n){var i=["*"],r=e.id||e.local;return r&&i.push(v+"as"+I()+J(r)),i},ImportSpecifier:function(e,t,n){var i=e.imported,r=[i.name],o=e.local;return o&&o.name!==i.name&&r.push(I()+"as"+I()+J(o)),r},ExportSpecifier:function(e,t,n){var i=e.local,r=[i.name],o=e.exported;return o&&o.name!==i.name&&r.push(I()+"as"+I()+J(o)),r},Literal:function(e,t,n){var r;if(e.hasOwnProperty("raw")&&w&&E.raw)try{if((r=w(e.raw).body[0].expression).type===i.Literal&&r.value===e.value)return e.raw}catch(e){}return null===e.value?"null":"string"==typeof e.value?function(e){var t,n,i,r,o,a="",s=0,u=0;for(t=0,n=e.length;t<n;++t){if(39===(i=e.charCodeAt(t)))++s;else if(34===i)++u;else if(47===i&&h)a+="\\";else{if(l.code.isLineTerminator(i)||92===i){a+=B(i);continue}if(!l.code.isIdentifierPartES5(i)&&(h&&i<32||!h&&!m&&(i<32||i>126))){a+=F(i,e.charCodeAt(t+1));continue}}a+=String.fromCharCode(i)}if(o=(r=!("double"===f||"auto"===f&&u<s))?"'":'"',!(r?s:u))return o+a+o;for(e=a,a=o,t=0,n=e.length;t<n;++t)(39===(i=e.charCodeAt(t))&&r||34===i&&!r)&&(a+="\\"),a+=String.fromCharCode(i);return a+o}(e.value):"number"==typeof e.value?function(e){var t,n,i,r,o;if(e!=e)throw new Error("Numeric literal whose value is NaN");if(e<0||0===e&&1/e<0)throw new Error("Numeric literal whose value is negative");if(e===1/0)return h?"null":p?"1e400":"1e+400";if(t=""+e,!p||t.length<3)return t;for(n=t.indexOf("."),h||48!==t.charCodeAt(0)||1!==n||(n=0,t=t.slice(1)),i=t,t=t.replace("e+","e"),r=0,(o=i.indexOf("e"))>0&&(r=+i.slice(o+1),i=i.slice(0,o)),n>=0&&(r-=i.length-n-1,i=+(i.slice(0,n)+i.slice(n+1))+""),o=0;48===i.charCodeAt(i.length+o-1);)--o;return 0!==o&&(r-=o,i=i.slice(0,o)),0!==r&&(i+="e"+r),(i.length<t.length||d&&e>1e12&&Math.floor(e)===e&&(i="0x"+e.toString(16)).length<t.length)&&+i===e&&(t=i),t}(e.value):"boolean"==typeof e.value?e.value?"true":"false":e.regex?"/"+e.regex.pattern+"/"+e.regex.flags:function(e){var t,n,i,r,o,a,s,l;if(n=e.toString(),e.source){if(!(t=n.match(/\/([^/]*)$/)))return n;for(i=t[1],n="",s=!1,l=!1,r=0,o=e.source.length;r<o;++r)a=e.source.charCodeAt(r),l?(n+=O(a,l),l=!1):(s?93===a&&(s=!1):47===a?n+="\\":91===a&&(s=!0),n+=O(a,l),l=92===a);return"/"+n+"/"+i}return n}(e.value)},GeneratorExpression:function(e,t,n){return this.ComprehensionExpression(e,t,n)},ComprehensionExpression:function(e,t,n){var o,a,s,l,u=this;return o=e.type===i.GeneratorExpression?["("]:["["],E.moz.comprehensionExpressionStartsWithAssignment&&(l=this.generateExpression(e.body,r.Assignment,7),o.push(l)),e.blocks&&z((function(){for(a=0,s=e.blocks.length;a<s;++a)l=u.generateExpression(e.blocks[a],r.Sequence,7),a>0||E.moz.comprehensionExpressionStartsWithAssignment?o=N(o,l):o.push(l)})),e.filter&&(o=N(o,"if"+v),l=this.generateExpression(e.filter,r.Sequence,7),o=N(o,["(",l,")"])),E.moz.comprehensionExpressionStartsWithAssignment||(l=this.generateExpression(e.body,r.Assignment,7),o=N(o,l)),o.push(e.type===i.GeneratorExpression?")":"]"),o},ComprehensionBlock:function(e,t,n){var o;return o=N(o=e.left.type===i.VariableDeclaration?[e.left.kind,I(),this.generateStatement(e.left.declarations[0],0)]:this.generateExpression(e.left,r.Call,7),e.of?"of":"in"),o=N(o,this.generateExpression(e.right,r.Sequence,7)),["for"+v+"(",o,")"]},SpreadElement:function(e,t,n){return["...",this.generateExpression(e.argument,r.Assignment,7)]},TaggedTemplateExpression:function(e,t,n){var i=3;return 2&n||(i=1),G([this.generateExpression(e.tag,r.Call,i),this.generateExpression(e.quasi,r.Primary,4)],r.TaggedTemplate,t)},TemplateElement:function(e,t,n){return e.value.raw},TemplateLiteral:function(e,t,n){var i,o,a;for(i=["`"],o=0,a=e.quasis.length;o<a;++o)i.push(this.generateExpression(e.quasis[o],r.Primary,7)),o+1<a&&(i.push("${"+v),i.push(this.generateExpression(e.expressions[o],r.Sequence,7)),i.push(v+"}"));return i.push("`"),i},ModuleSpecifier:function(e,t,n){return this.Literal(e,t,n)},ImportExpression:function(e,t,n){return G(["import(",this.generateExpression(e.source,r.Assignment,7),")"],r.Call,t)}},k(X.prototype,X.Expression),X.prototype.generateExpression=function(e,t,n){var o,a;return a=e.type||i.Property,E.verbatim&&e.hasOwnProperty(E.verbatim)?function(e,t){var n;return L("string"==typeof(n=e[E.verbatim])?G(W(n),r.Sequence,t):G(W(n.content),null!=n.precedence?n.precedence:r.Sequence,t),e)}(e,t):(o=this[a](e,t,n),E.comment&&(o=V(e,o)),L(o,e))},X.prototype.generateStatement=function(e,t){var n,r;return n=this[e.type](e,t),E.comment&&(n=V(e,n)),r=L(n).toString(),e.type!==i.Program||_||""!==g||"\n"!==r.charAt(r.length-1)||(n=T?L(n).replaceRight(/\s+$/,""):r.replace(/\s+$/,"")),L(n,e)},C={indent:{style:"",base:0},renumber:!0,hexadecimal:!0,quotes:"auto",escapeless:!0,compact:!0,parentheses:!1,semicolons:!1},A={indent:{style:"    ",base:0,adjustMultilineComment:!1},newline:"\n",space:" ",json:!1,renumber:!1,hexadecimal:!1,quotes:"single",escapeless:!1,compact:!1,parentheses:!0,semicolons:!0,safeConcatenation:!1,preserveBlankLines:!1},t.version=n(/*! ./package.json */"./node_modules/escodegen/package.json").version,t.generate=function(i,r){var o,s,l={indent:null,base:null,parse:null,comment:!1,format:{indent:{style:"    ",base:0,adjustMultilineComment:!1},newline:"\n",space:" ",json:!1,renumber:!1,hexadecimal:!1,quotes:"single",escapeless:!1,compact:!1,parentheses:!0,semicolons:!0,safeConcatenation:!1,preserveBlankLines:!1},moz:{comprehensionExpressionStartsWithAssignment:!1,starlessGenerator:!1},sourceMap:null,sourceMapRoot:null,sourceMapWithCode:!1,directive:!1,raw:!0,verbatim:null,sourceCode:null};return null!=r?("string"==typeof r.indent&&(l.format.indent.style=r.indent),"number"==typeof r.base&&(l.format.indent.base=r.base),r=j(l,r),c=r.format.indent.style,u="string"==typeof r.base?r.base:P(c,r.format.indent.base)):(c=(r=l).format.indent.style,u=P(c,r.format.indent.base)),h=r.format.json,p=r.format.renumber,d=!h&&r.format.hexadecimal,f=h?"double":r.format.quotes,m=r.format.escapeless,g=r.format.newline,v=r.format.space,r.format.compact&&(g=v=c=u=""),y=r.format.parentheses,b=r.format.semicolons,_=r.format.safeConcatenation,x=r.directive,w=h?null:r.parse,T=r.sourceMap,M=r.sourceCode,S=r.format.preserveBlankLines&&null!==M,E=r,T&&(a=t.browser?e.sourceMap.SourceNode:n(/*! source-map */"./node_modules/source-map/source-map.js").SourceNode),o=K(i),T?(s=o.toStringWithSourceMap({file:r.file,sourceRoot:r.sourceMapRoot}),r.sourceContent&&s.map.setSourceContent(r.sourceMap,r.sourceContent),r.sourceMapWithCode?s:s.map.toString()):(s={code:o.toString(),map:null},r.sourceMapWithCode?s:s.code)},t.attachComments=s.attachComments,t.Precedence=j({},r),t.browser=!1,t.FORMAT_MINIFY=C,t.FORMAT_DEFAULTS=A}()}).call(this,n(/*! ./../webpack/buildin/global.js */"./node_modules/webpack/buildin/global.js"))},"./node_modules/escodegen/package.json":
/*!*********************************************!*\
  !*** ./node_modules/escodegen/package.json ***!
  \*********************************************/
/*! exports provided: _from, _id, _inBundle, _integrity, _location, _phantomChildren, _requested, _requiredBy, _resolved, _shasum, _spec, _where, bin, bugs, bundleDependencies, dependencies, deprecated, description, devDependencies, engines, files, homepage, license, main, maintainers, name, optionalDependencies, repository, scripts, version, default */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e){e.exports=JSON.parse('{"_from":"escodegen","_id":"escodegen@1.12.0","_inBundle":false,"_integrity":"sha512-TuA+EhsanGcme5T3R0L80u4t8CpbXQjegRmf7+FPTJrtCTErXFeelblRgHQa1FofEzqYYJmJ/OqjTwREp9qgmg==","_location":"/escodegen","_phantomChildren":{},"_requested":{"type":"tag","registry":true,"raw":"escodegen","name":"escodegen","escapedName":"escodegen","rawSpec":"","saveSpec":null,"fetchSpec":"latest"},"_requiredBy":["#USER","/"],"_resolved":"https://registry.npmjs.org/escodegen/-/escodegen-1.12.0.tgz","_shasum":"f763daf840af172bb3a2b6dd7219c0e17f7ff541","_spec":"escodegen","_where":"D:\\\\SourceCodes\\\\THING.EVAL","bin":{"esgenerate":"./bin/esgenerate.js","escodegen":"./bin/escodegen.js"},"bugs":{"url":"https://github.com/estools/escodegen/issues"},"bundleDependencies":false,"dependencies":{"esprima":"^3.1.3","estraverse":"^4.2.0","esutils":"^2.0.2","optionator":"^0.8.1","source-map":"~0.6.1"},"deprecated":false,"description":"ECMAScript code generator","devDependencies":{"acorn":"^4.0.4","bluebird":"^3.4.7","bower-registry-client":"^1.0.0","chai":"^3.5.0","commonjs-everywhere":"^0.9.7","gulp":"^3.8.10","gulp-eslint":"^3.0.1","gulp-mocha":"^3.0.1","semver":"^5.1.0"},"engines":{"node":">=4.0"},"files":["LICENSE.BSD","README.md","bin","escodegen.js","package.json"],"homepage":"http://github.com/estools/escodegen","license":"BSD-2-Clause","main":"escodegen.js","maintainers":[{"name":"Yusuke Suzuki","email":"utatane.tea@gmail.com","url":"http://github.com/Constellation"}],"name":"escodegen","optionalDependencies":{"source-map":"~0.6.1"},"repository":{"type":"git","url":"git+ssh://git@github.com/estools/escodegen.git"},"scripts":{"build":"cjsify -a path: tools/entry-point.js > escodegen.browser.js","build-min":"cjsify -ma path: tools/entry-point.js > escodegen.browser.min.js","lint":"gulp lint","release":"node tools/release.js","test":"gulp travis","unit-test":"gulp test"},"version":"1.12.0"}')},"./node_modules/esprima/dist/esprima.js":
/*!**********************************************!*\
  !*** ./node_modules/esprima/dist/esprima.js ***!
  \**********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,n){var i;i=function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}return n.m=e,n.c=t,n.p="",n(0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(3),o=n(8),a=n(15);function s(e,t,n){var a=null,s=function(e,t){n&&n(e,t),a&&a.visit(e,t)},l="function"==typeof n?s:null,u=!1;if(t){u="boolean"==typeof t.comment&&t.comment;var c="boolean"==typeof t.attachComment&&t.attachComment;(u||c)&&((a=new i.CommentHandler).attach=c,t.comment=!0,l=s)}var h,p=!1;t&&"string"==typeof t.sourceType&&(p="module"===t.sourceType),h=t&&"boolean"==typeof t.jsx&&t.jsx?new r.JSXParser(e,t,l):new o.Parser(e,t,l);var d=p?h.parseModule():h.parseScript();return u&&a&&(d.comments=a.comments),h.config.tokens&&(d.tokens=h.tokens),h.config.tolerant&&(d.errors=h.errorHandler.errors),d}t.parse=s,t.parseModule=function(e,t,n){var i=t||{};return i.sourceType="module",s(e,i,n)},t.parseScript=function(e,t,n){var i=t||{};return i.sourceType="script",s(e,i,n)},t.tokenize=function(e,t,n){var i,r=new a.Tokenizer(e,t);i=[];try{for(;;){var o=r.getNextToken();if(!o)break;n&&(o=n(o)),i.push(o)}}catch(e){r.errorHandler.tolerate(e)}return r.errorHandler.tolerant&&(i.errors=r.errors()),i};var l=n(2);t.Syntax=l.Syntax,t.version="4.0.1"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=function(){function e(){this.attach=!1,this.comments=[],this.stack=[],this.leading=[],this.trailing=[]}return e.prototype.insertInnerComments=function(e,t){if(e.type===i.Syntax.BlockStatement&&0===e.body.length){for(var n=[],r=this.leading.length-1;r>=0;--r){var o=this.leading[r];t.end.offset>=o.start&&(n.unshift(o.comment),this.leading.splice(r,1),this.trailing.splice(r,1))}n.length&&(e.innerComments=n)}},e.prototype.findTrailingComments=function(e){var t=[];if(this.trailing.length>0){for(var n=this.trailing.length-1;n>=0;--n){var i=this.trailing[n];i.start>=e.end.offset&&t.unshift(i.comment)}return this.trailing.length=0,t}var r=this.stack[this.stack.length-1];if(r&&r.node.trailingComments){var o=r.node.trailingComments[0];o&&o.range[0]>=e.end.offset&&(t=r.node.trailingComments,delete r.node.trailingComments)}return t},e.prototype.findLeadingComments=function(e){for(var t,n=[];this.stack.length>0&&(o=this.stack[this.stack.length-1])&&o.start>=e.start.offset;)t=o.node,this.stack.pop();if(t){for(var i=(t.leadingComments?t.leadingComments.length:0)-1;i>=0;--i){var r=t.leadingComments[i];r.range[1]<=e.start.offset&&(n.unshift(r),t.leadingComments.splice(i,1))}return t.leadingComments&&0===t.leadingComments.length&&delete t.leadingComments,n}for(i=this.leading.length-1;i>=0;--i){var o;(o=this.leading[i]).start<=e.start.offset&&(n.unshift(o.comment),this.leading.splice(i,1))}return n},e.prototype.visitNode=function(e,t){if(!(e.type===i.Syntax.Program&&e.body.length>0)){this.insertInnerComments(e,t);var n=this.findTrailingComments(t),r=this.findLeadingComments(t);r.length>0&&(e.leadingComments=r),n.length>0&&(e.trailingComments=n),this.stack.push({node:e,start:t.start.offset})}},e.prototype.visitComment=function(e,t){var n="L"===e.type[0]?"Line":"Block",i={type:n,value:e.value};if(e.range&&(i.range=e.range),e.loc&&(i.loc=e.loc),this.comments.push(i),this.attach){var r={comment:{type:n,value:e.value,range:[t.start.offset,t.end.offset]},start:t.start.offset};e.loc&&(r.comment.loc=e.loc),e.type=n,this.leading.push(r),this.trailing.push(r)}},e.prototype.visit=function(e,t){"LineComment"===e.type||"BlockComment"===e.type?this.visitComment(e,t):this.attach&&this.visitNode(e,t)},e}();t.CommentHandler=r},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(5),s=n(6),l=n(7),u=n(8),c=n(13),h=n(14);function p(e){var t;switch(e.type){case s.JSXSyntax.JSXIdentifier:t=e.name;break;case s.JSXSyntax.JSXNamespacedName:var n=e;t=p(n.namespace)+":"+p(n.name);break;case s.JSXSyntax.JSXMemberExpression:var i=e;t=p(i.object)+"."+p(i.property)}return t}c.TokenName[100]="JSXIdentifier",c.TokenName[101]="JSXText";var d=function(e){function t(t,n,i){return e.call(this,t,n,i)||this}return r(t,e),t.prototype.parsePrimaryExpression=function(){return this.match("<")?this.parseJSXRoot():e.prototype.parsePrimaryExpression.call(this)},t.prototype.startJSX=function(){this.scanner.index=this.startMarker.index,this.scanner.lineNumber=this.startMarker.line,this.scanner.lineStart=this.startMarker.index-this.startMarker.column},t.prototype.finishJSX=function(){this.nextToken()},t.prototype.reenterJSX=function(){this.startJSX(),this.expectJSX("}"),this.config.tokens&&this.tokens.pop()},t.prototype.createJSXNode=function(){return this.collectComments(),{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},t.prototype.createJSXChildNode=function(){return{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},t.prototype.scanXHTMLEntity=function(e){for(var t="&",n=!0,i=!1,r=!1,a=!1;!this.scanner.eof()&&n&&!i;){var s=this.scanner.source[this.scanner.index];if(s===e)break;if(i=";"===s,t+=s,++this.scanner.index,!i)switch(t.length){case 2:r="#"===s;break;case 3:r&&(n=(a="x"===s)||o.Character.isDecimalDigit(s.charCodeAt(0)),r=r&&!a);break;default:n=(n=n&&!(r&&!o.Character.isDecimalDigit(s.charCodeAt(0))))&&!(a&&!o.Character.isHexDigit(s.charCodeAt(0)))}}if(n&&i&&t.length>2){var l=t.substr(1,t.length-2);r&&l.length>1?t=String.fromCharCode(parseInt(l.substr(1),10)):a&&l.length>2?t=String.fromCharCode(parseInt("0"+l.substr(1),16)):r||a||!h.XHTMLEntities[l]||(t=h.XHTMLEntities[l])}return t},t.prototype.lexJSX=function(){var e=this.scanner.source.charCodeAt(this.scanner.index);if(60===e||62===e||47===e||58===e||61===e||123===e||125===e)return{type:7,value:s=this.scanner.source[this.scanner.index++],lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index-1,end:this.scanner.index};if(34===e||39===e){for(var t=this.scanner.index,n=this.scanner.source[this.scanner.index++],i="";!this.scanner.eof()&&(l=this.scanner.source[this.scanner.index++])!==n;)i+="&"===l?this.scanXHTMLEntity(n):l;return{type:8,value:i,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}if(46===e){var r=this.scanner.source.charCodeAt(this.scanner.index+1),a=this.scanner.source.charCodeAt(this.scanner.index+2),s=46===r&&46===a?"...":".";return t=this.scanner.index,this.scanner.index+=s.length,{type:7,value:s,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}if(96===e)return{type:10,value:"",lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index,end:this.scanner.index};if(o.Character.isIdentifierStart(e)&&92!==e){for(t=this.scanner.index,++this.scanner.index;!this.scanner.eof();){var l=this.scanner.source.charCodeAt(this.scanner.index);if(o.Character.isIdentifierPart(l)&&92!==l)++this.scanner.index;else{if(45!==l)break;++this.scanner.index}}return{type:100,value:this.scanner.source.slice(t,this.scanner.index),lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}return this.scanner.lex()},t.prototype.nextJSXToken=function(){this.collectComments(),this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;var e=this.lexJSX();return this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.config.tokens&&this.tokens.push(this.convertToken(e)),e},t.prototype.nextJSXText=function(){this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;for(var e=this.scanner.index,t="";!this.scanner.eof();){var n=this.scanner.source[this.scanner.index];if("{"===n||"<"===n)break;++this.scanner.index,t+=n,o.Character.isLineTerminator(n.charCodeAt(0))&&(++this.scanner.lineNumber,"\r"===n&&"\n"===this.scanner.source[this.scanner.index]&&++this.scanner.index,this.scanner.lineStart=this.scanner.index)}this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart;var i={type:101,value:t,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:e,end:this.scanner.index};return t.length>0&&this.config.tokens&&this.tokens.push(this.convertToken(i)),i},t.prototype.peekJSXToken=function(){var e=this.scanner.saveState();this.scanner.scanComments();var t=this.lexJSX();return this.scanner.restoreState(e),t},t.prototype.expectJSX=function(e){var t=this.nextJSXToken();7===t.type&&t.value===e||this.throwUnexpectedToken(t)},t.prototype.matchJSX=function(e){var t=this.peekJSXToken();return 7===t.type&&t.value===e},t.prototype.parseJSXIdentifier=function(){var e=this.createJSXNode(),t=this.nextJSXToken();return 100!==t.type&&this.throwUnexpectedToken(t),this.finalize(e,new a.JSXIdentifier(t.value))},t.prototype.parseJSXElementName=function(){var e=this.createJSXNode(),t=this.parseJSXIdentifier();if(this.matchJSX(":")){var n=t;this.expectJSX(":");var i=this.parseJSXIdentifier();t=this.finalize(e,new a.JSXNamespacedName(n,i))}else if(this.matchJSX("."))for(;this.matchJSX(".");){var r=t;this.expectJSX(".");var o=this.parseJSXIdentifier();t=this.finalize(e,new a.JSXMemberExpression(r,o))}return t},t.prototype.parseJSXAttributeName=function(){var e,t=this.createJSXNode(),n=this.parseJSXIdentifier();if(this.matchJSX(":")){var i=n;this.expectJSX(":");var r=this.parseJSXIdentifier();e=this.finalize(t,new a.JSXNamespacedName(i,r))}else e=n;return e},t.prototype.parseJSXStringLiteralAttribute=function(){var e=this.createJSXNode(),t=this.nextJSXToken();8!==t.type&&this.throwUnexpectedToken(t);var n=this.getTokenRaw(t);return this.finalize(e,new l.Literal(t.value,n))},t.prototype.parseJSXExpressionAttribute=function(){var e=this.createJSXNode();this.expectJSX("{"),this.finishJSX(),this.match("}")&&this.tolerateError("JSX attributes must only be assigned a non-empty expression");var t=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(e,new a.JSXExpressionContainer(t))},t.prototype.parseJSXAttributeValue=function(){return this.matchJSX("{")?this.parseJSXExpressionAttribute():this.matchJSX("<")?this.parseJSXElement():this.parseJSXStringLiteralAttribute()},t.prototype.parseJSXNameValueAttribute=function(){var e=this.createJSXNode(),t=this.parseJSXAttributeName(),n=null;return this.matchJSX("=")&&(this.expectJSX("="),n=this.parseJSXAttributeValue()),this.finalize(e,new a.JSXAttribute(t,n))},t.prototype.parseJSXSpreadAttribute=function(){var e=this.createJSXNode();this.expectJSX("{"),this.expectJSX("..."),this.finishJSX();var t=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(e,new a.JSXSpreadAttribute(t))},t.prototype.parseJSXAttributes=function(){for(var e=[];!this.matchJSX("/")&&!this.matchJSX(">");){var t=this.matchJSX("{")?this.parseJSXSpreadAttribute():this.parseJSXNameValueAttribute();e.push(t)}return e},t.prototype.parseJSXOpeningElement=function(){var e=this.createJSXNode();this.expectJSX("<");var t=this.parseJSXElementName(),n=this.parseJSXAttributes(),i=this.matchJSX("/");return i&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(e,new a.JSXOpeningElement(t,i,n))},t.prototype.parseJSXBoundaryElement=function(){var e=this.createJSXNode();if(this.expectJSX("<"),this.matchJSX("/")){this.expectJSX("/");var t=this.parseJSXElementName();return this.expectJSX(">"),this.finalize(e,new a.JSXClosingElement(t))}var n=this.parseJSXElementName(),i=this.parseJSXAttributes(),r=this.matchJSX("/");return r&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(e,new a.JSXOpeningElement(n,r,i))},t.prototype.parseJSXEmptyExpression=function(){var e=this.createJSXChildNode();return this.collectComments(),this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.finalize(e,new a.JSXEmptyExpression)},t.prototype.parseJSXExpressionContainer=function(){var e,t=this.createJSXNode();return this.expectJSX("{"),this.matchJSX("}")?(e=this.parseJSXEmptyExpression(),this.expectJSX("}")):(this.finishJSX(),e=this.parseAssignmentExpression(),this.reenterJSX()),this.finalize(t,new a.JSXExpressionContainer(e))},t.prototype.parseJSXChildren=function(){for(var e=[];!this.scanner.eof();){var t=this.createJSXChildNode(),n=this.nextJSXText();if(n.start<n.end){var i=this.getTokenRaw(n),r=this.finalize(t,new a.JSXText(n.value,i));e.push(r)}if("{"!==this.scanner.source[this.scanner.index])break;var o=this.parseJSXExpressionContainer();e.push(o)}return e},t.prototype.parseComplexJSXElement=function(e){for(var t=[];!this.scanner.eof();){e.children=e.children.concat(this.parseJSXChildren());var n=this.createJSXChildNode(),i=this.parseJSXBoundaryElement();if(i.type===s.JSXSyntax.JSXOpeningElement){var r=i;if(r.selfClosing){var o=this.finalize(n,new a.JSXElement(r,[],null));e.children.push(o)}else t.push(e),e={node:n,opening:r,closing:null,children:[]}}if(i.type===s.JSXSyntax.JSXClosingElement){e.closing=i;var l=p(e.opening.name);if(l!==p(e.closing.name)&&this.tolerateError("Expected corresponding JSX closing tag for %0",l),!(t.length>0))break;o=this.finalize(e.node,new a.JSXElement(e.opening,e.children,e.closing)),(e=t[t.length-1]).children.push(o),t.pop()}}return e},t.prototype.parseJSXElement=function(){var e=this.createJSXNode(),t=this.parseJSXOpeningElement(),n=[],i=null;if(!t.selfClosing){var r=this.parseComplexJSXElement({node:e,opening:t,closing:i,children:n});n=r.children,i=r.closing}return this.finalize(e,new a.JSXElement(t,n,i))},t.prototype.parseJSXRoot=function(){this.config.tokens&&this.tokens.pop(),this.startJSX();var e=this.parseJSXElement();return this.finishJSX(),e},t.prototype.isStartOfExpression=function(){return e.prototype.isStartOfExpression.call(this)||this.match("<")},t}(u.Parser);t.JSXParser=d},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};t.Character={fromCodePoint:function(e){return e<65536?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10))+String.fromCharCode(56320+(e-65536&1023))},isWhiteSpace:function(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0},isLineTerminator:function(e){return 10===e||13===e||8232===e||8233===e},isIdentifierStart:function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&n.NonAsciiIdentifierStart.test(t.Character.fromCodePoint(e))},isIdentifierPart:function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&n.NonAsciiIdentifierPart.test(t.Character.fromCodePoint(e))},isDecimalDigit:function(e){return e>=48&&e<=57},isHexDigit:function(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102},isOctalDigit:function(e){return e>=48&&e<=55}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6);t.JSXClosingElement=function(e){this.type=i.JSXSyntax.JSXClosingElement,this.name=e};t.JSXElement=function(e,t,n){this.type=i.JSXSyntax.JSXElement,this.openingElement=e,this.children=t,this.closingElement=n};t.JSXEmptyExpression=function(){this.type=i.JSXSyntax.JSXEmptyExpression};t.JSXExpressionContainer=function(e){this.type=i.JSXSyntax.JSXExpressionContainer,this.expression=e};t.JSXIdentifier=function(e){this.type=i.JSXSyntax.JSXIdentifier,this.name=e};t.JSXMemberExpression=function(e,t){this.type=i.JSXSyntax.JSXMemberExpression,this.object=e,this.property=t};t.JSXAttribute=function(e,t){this.type=i.JSXSyntax.JSXAttribute,this.name=e,this.value=t};t.JSXNamespacedName=function(e,t){this.type=i.JSXSyntax.JSXNamespacedName,this.namespace=e,this.name=t};t.JSXOpeningElement=function(e,t,n){this.type=i.JSXSyntax.JSXOpeningElement,this.name=e,this.selfClosing=t,this.attributes=n};t.JSXSpreadAttribute=function(e){this.type=i.JSXSyntax.JSXSpreadAttribute,this.argument=e};t.JSXText=function(e,t){this.type=i.JSXSyntax.JSXText,this.value=e,this.raw=t}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JSXSyntax={JSXAttribute:"JSXAttribute",JSXClosingElement:"JSXClosingElement",JSXElement:"JSXElement",JSXEmptyExpression:"JSXEmptyExpression",JSXExpressionContainer:"JSXExpressionContainer",JSXIdentifier:"JSXIdentifier",JSXMemberExpression:"JSXMemberExpression",JSXNamespacedName:"JSXNamespacedName",JSXOpeningElement:"JSXOpeningElement",JSXSpreadAttribute:"JSXSpreadAttribute",JSXText:"JSXText"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2);t.ArrayExpression=function(e){this.type=i.Syntax.ArrayExpression,this.elements=e};t.ArrayPattern=function(e){this.type=i.Syntax.ArrayPattern,this.elements=e};t.ArrowFunctionExpression=function(e,t,n){this.type=i.Syntax.ArrowFunctionExpression,this.id=null,this.params=e,this.body=t,this.generator=!1,this.expression=n,this.async=!1};t.AssignmentExpression=function(e,t,n){this.type=i.Syntax.AssignmentExpression,this.operator=e,this.left=t,this.right=n};t.AssignmentPattern=function(e,t){this.type=i.Syntax.AssignmentPattern,this.left=e,this.right=t};t.AsyncArrowFunctionExpression=function(e,t,n){this.type=i.Syntax.ArrowFunctionExpression,this.id=null,this.params=e,this.body=t,this.generator=!1,this.expression=n,this.async=!0};t.AsyncFunctionDeclaration=function(e,t,n){this.type=i.Syntax.FunctionDeclaration,this.id=e,this.params=t,this.body=n,this.generator=!1,this.expression=!1,this.async=!0};t.AsyncFunctionExpression=function(e,t,n){this.type=i.Syntax.FunctionExpression,this.id=e,this.params=t,this.body=n,this.generator=!1,this.expression=!1,this.async=!0};t.AwaitExpression=function(e){this.type=i.Syntax.AwaitExpression,this.argument=e};t.BinaryExpression=function(e,t,n){var r="||"===e||"&&"===e;this.type=r?i.Syntax.LogicalExpression:i.Syntax.BinaryExpression,this.operator=e,this.left=t,this.right=n};t.BlockStatement=function(e){this.type=i.Syntax.BlockStatement,this.body=e};t.BreakStatement=function(e){this.type=i.Syntax.BreakStatement,this.label=e};t.CallExpression=function(e,t){this.type=i.Syntax.CallExpression,this.callee=e,this.arguments=t};t.CatchClause=function(e,t){this.type=i.Syntax.CatchClause,this.param=e,this.body=t};t.ClassBody=function(e){this.type=i.Syntax.ClassBody,this.body=e};t.ClassDeclaration=function(e,t,n){this.type=i.Syntax.ClassDeclaration,this.id=e,this.superClass=t,this.body=n};t.ClassExpression=function(e,t,n){this.type=i.Syntax.ClassExpression,this.id=e,this.superClass=t,this.body=n};t.ComputedMemberExpression=function(e,t){this.type=i.Syntax.MemberExpression,this.computed=!0,this.object=e,this.property=t};t.ConditionalExpression=function(e,t,n){this.type=i.Syntax.ConditionalExpression,this.test=e,this.consequent=t,this.alternate=n};t.ContinueStatement=function(e){this.type=i.Syntax.ContinueStatement,this.label=e};t.DebuggerStatement=function(){this.type=i.Syntax.DebuggerStatement};t.Directive=function(e,t){this.type=i.Syntax.ExpressionStatement,this.expression=e,this.directive=t};t.DoWhileStatement=function(e,t){this.type=i.Syntax.DoWhileStatement,this.body=e,this.test=t};t.EmptyStatement=function(){this.type=i.Syntax.EmptyStatement};t.ExportAllDeclaration=function(e){this.type=i.Syntax.ExportAllDeclaration,this.source=e};t.ExportDefaultDeclaration=function(e){this.type=i.Syntax.ExportDefaultDeclaration,this.declaration=e};t.ExportNamedDeclaration=function(e,t,n){this.type=i.Syntax.ExportNamedDeclaration,this.declaration=e,this.specifiers=t,this.source=n};t.ExportSpecifier=function(e,t){this.type=i.Syntax.ExportSpecifier,this.exported=t,this.local=e};t.ExpressionStatement=function(e){this.type=i.Syntax.ExpressionStatement,this.expression=e};t.ForInStatement=function(e,t,n){this.type=i.Syntax.ForInStatement,this.left=e,this.right=t,this.body=n,this.each=!1};t.ForOfStatement=function(e,t,n){this.type=i.Syntax.ForOfStatement,this.left=e,this.right=t,this.body=n};t.ForStatement=function(e,t,n,r){this.type=i.Syntax.ForStatement,this.init=e,this.test=t,this.update=n,this.body=r};t.FunctionDeclaration=function(e,t,n,r){this.type=i.Syntax.FunctionDeclaration,this.id=e,this.params=t,this.body=n,this.generator=r,this.expression=!1,this.async=!1};t.FunctionExpression=function(e,t,n,r){this.type=i.Syntax.FunctionExpression,this.id=e,this.params=t,this.body=n,this.generator=r,this.expression=!1,this.async=!1};t.Identifier=function(e){this.type=i.Syntax.Identifier,this.name=e};t.IfStatement=function(e,t,n){this.type=i.Syntax.IfStatement,this.test=e,this.consequent=t,this.alternate=n};t.ImportDeclaration=function(e,t){this.type=i.Syntax.ImportDeclaration,this.specifiers=e,this.source=t};t.ImportDefaultSpecifier=function(e){this.type=i.Syntax.ImportDefaultSpecifier,this.local=e};t.ImportNamespaceSpecifier=function(e){this.type=i.Syntax.ImportNamespaceSpecifier,this.local=e};t.ImportSpecifier=function(e,t){this.type=i.Syntax.ImportSpecifier,this.local=e,this.imported=t};t.LabeledStatement=function(e,t){this.type=i.Syntax.LabeledStatement,this.label=e,this.body=t};t.Literal=function(e,t){this.type=i.Syntax.Literal,this.value=e,this.raw=t};t.MetaProperty=function(e,t){this.type=i.Syntax.MetaProperty,this.meta=e,this.property=t};t.MethodDefinition=function(e,t,n,r,o){this.type=i.Syntax.MethodDefinition,this.key=e,this.computed=t,this.value=n,this.kind=r,this.static=o};t.Module=function(e){this.type=i.Syntax.Program,this.body=e,this.sourceType="module"};t.NewExpression=function(e,t){this.type=i.Syntax.NewExpression,this.callee=e,this.arguments=t};t.ObjectExpression=function(e){this.type=i.Syntax.ObjectExpression,this.properties=e};t.ObjectPattern=function(e){this.type=i.Syntax.ObjectPattern,this.properties=e};t.Property=function(e,t,n,r,o,a){this.type=i.Syntax.Property,this.key=t,this.computed=n,this.value=r,this.kind=e,this.method=o,this.shorthand=a};t.RegexLiteral=function(e,t,n,r){this.type=i.Syntax.Literal,this.value=e,this.raw=t,this.regex={pattern:n,flags:r}};t.RestElement=function(e){this.type=i.Syntax.RestElement,this.argument=e};t.ReturnStatement=function(e){this.type=i.Syntax.ReturnStatement,this.argument=e};t.Script=function(e){this.type=i.Syntax.Program,this.body=e,this.sourceType="script"};t.SequenceExpression=function(e){this.type=i.Syntax.SequenceExpression,this.expressions=e};t.SpreadElement=function(e){this.type=i.Syntax.SpreadElement,this.argument=e};t.StaticMemberExpression=function(e,t){this.type=i.Syntax.MemberExpression,this.computed=!1,this.object=e,this.property=t};t.Super=function(){this.type=i.Syntax.Super};t.SwitchCase=function(e,t){this.type=i.Syntax.SwitchCase,this.test=e,this.consequent=t};t.SwitchStatement=function(e,t){this.type=i.Syntax.SwitchStatement,this.discriminant=e,this.cases=t};t.TaggedTemplateExpression=function(e,t){this.type=i.Syntax.TaggedTemplateExpression,this.tag=e,this.quasi=t};t.TemplateElement=function(e,t){this.type=i.Syntax.TemplateElement,this.value=e,this.tail=t};t.TemplateLiteral=function(e,t){this.type=i.Syntax.TemplateLiteral,this.quasis=e,this.expressions=t};t.ThisExpression=function(){this.type=i.Syntax.ThisExpression};t.ThrowStatement=function(e){this.type=i.Syntax.ThrowStatement,this.argument=e};t.TryStatement=function(e,t,n){this.type=i.Syntax.TryStatement,this.block=e,this.handler=t,this.finalizer=n};t.UnaryExpression=function(e,t){this.type=i.Syntax.UnaryExpression,this.operator=e,this.argument=t,this.prefix=!0};t.UpdateExpression=function(e,t,n){this.type=i.Syntax.UpdateExpression,this.operator=e,this.argument=t,this.prefix=n};t.VariableDeclaration=function(e,t){this.type=i.Syntax.VariableDeclaration,this.declarations=e,this.kind=t};t.VariableDeclarator=function(e,t){this.type=i.Syntax.VariableDeclarator,this.id=e,this.init=t};t.WhileStatement=function(e,t){this.type=i.Syntax.WhileStatement,this.test=e,this.body=t};t.WithStatement=function(e,t){this.type=i.Syntax.WithStatement,this.object=e,this.body=t};t.YieldExpression=function(e,t){this.type=i.Syntax.YieldExpression,this.argument=e,this.delegate=t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),r=n(10),o=n(11),a=n(7),s=n(12),l=n(2),u=n(13),c=function(){function e(e,t,n){void 0===t&&(t={}),this.config={range:"boolean"==typeof t.range&&t.range,loc:"boolean"==typeof t.loc&&t.loc,source:null,tokens:"boolean"==typeof t.tokens&&t.tokens,comment:"boolean"==typeof t.comment&&t.comment,tolerant:"boolean"==typeof t.tolerant&&t.tolerant},this.config.loc&&t.source&&null!==t.source&&(this.config.source=String(t.source)),this.delegate=n,this.errorHandler=new r.ErrorHandler,this.errorHandler.tolerant=this.config.tolerant,this.scanner=new s.Scanner(e,this.errorHandler),this.scanner.trackComment=this.config.comment,this.operatorPrecedence={")":0,";":0,",":0,"=":0,"]":0,"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},this.lookahead={type:2,value:"",lineNumber:this.scanner.lineNumber,lineStart:0,start:0,end:0},this.hasLineTerminator=!1,this.context={isModule:!1,await:!1,allowIn:!0,allowStrictDirective:!0,allowYield:!0,firstCoverInitializedNameError:null,isAssignmentTarget:!1,isBindingElement:!1,inFunctionBody:!1,inIteration:!1,inSwitch:!1,labelSet:{},strict:!1},this.tokens=[],this.startMarker={index:0,line:this.scanner.lineNumber,column:0},this.lastMarker={index:0,line:this.scanner.lineNumber,column:0},this.nextToken(),this.lastMarker={index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}return e.prototype.throwError=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=Array.prototype.slice.call(arguments,1),o=e.replace(/%(\d)/g,(function(e,t){return i.assert(t<r.length,"Message reference must be in range"),r[t]})),a=this.lastMarker.index,s=this.lastMarker.line,l=this.lastMarker.column+1;throw this.errorHandler.createError(a,s,l,o)},e.prototype.tolerateError=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=Array.prototype.slice.call(arguments,1),o=e.replace(/%(\d)/g,(function(e,t){return i.assert(t<r.length,"Message reference must be in range"),r[t]})),a=this.lastMarker.index,s=this.scanner.lineNumber,l=this.lastMarker.column+1;this.errorHandler.tolerateError(a,s,l,o)},e.prototype.unexpectedTokenError=function(e,t){var n,i=t||o.Messages.UnexpectedToken;if(e?(t||(i=2===e.type?o.Messages.UnexpectedEOS:3===e.type?o.Messages.UnexpectedIdentifier:6===e.type?o.Messages.UnexpectedNumber:8===e.type?o.Messages.UnexpectedString:10===e.type?o.Messages.UnexpectedTemplate:o.Messages.UnexpectedToken,4===e.type&&(this.scanner.isFutureReservedWord(e.value)?i=o.Messages.UnexpectedReserved:this.context.strict&&this.scanner.isStrictModeReservedWord(e.value)&&(i=o.Messages.StrictReservedWord))),n=e.value):n="ILLEGAL",i=i.replace("%0",n),e&&"number"==typeof e.lineNumber){var r=e.start,a=e.lineNumber,s=this.lastMarker.index-this.lastMarker.column,l=e.start-s+1;return this.errorHandler.createError(r,a,l,i)}return r=this.lastMarker.index,a=this.lastMarker.line,l=this.lastMarker.column+1,this.errorHandler.createError(r,a,l,i)},e.prototype.throwUnexpectedToken=function(e,t){throw this.unexpectedTokenError(e,t)},e.prototype.tolerateUnexpectedToken=function(e,t){this.errorHandler.tolerate(this.unexpectedTokenError(e,t))},e.prototype.collectComments=function(){if(this.config.comment){var e=this.scanner.scanComments();if(e.length>0&&this.delegate)for(var t=0;t<e.length;++t){var n=e[t],i=void 0;i={type:n.multiLine?"BlockComment":"LineComment",value:this.scanner.source.slice(n.slice[0],n.slice[1])},this.config.range&&(i.range=n.range),this.config.loc&&(i.loc=n.loc);var r={start:{line:n.loc.start.line,column:n.loc.start.column,offset:n.range[0]},end:{line:n.loc.end.line,column:n.loc.end.column,offset:n.range[1]}};this.delegate(i,r)}}else this.scanner.scanComments()},e.prototype.getTokenRaw=function(e){return this.scanner.source.slice(e.start,e.end)},e.prototype.convertToken=function(e){var t={type:u.TokenName[e.type],value:this.getTokenRaw(e)};if(this.config.range&&(t.range=[e.start,e.end]),this.config.loc&&(t.loc={start:{line:this.startMarker.line,column:this.startMarker.column},end:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}),9===e.type){var n=e.pattern,i=e.flags;t.regex={pattern:n,flags:i}}return t},e.prototype.nextToken=function(){var e=this.lookahead;this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.collectComments(),this.scanner.index!==this.startMarker.index&&(this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart);var t=this.scanner.lex();return this.hasLineTerminator=e.lineNumber!==t.lineNumber,t&&this.context.strict&&3===t.type&&this.scanner.isStrictModeReservedWord(t.value)&&(t.type=4),this.lookahead=t,this.config.tokens&&2!==t.type&&this.tokens.push(this.convertToken(t)),e},e.prototype.nextRegexToken=function(){this.collectComments();var e=this.scanner.scanRegExp();return this.config.tokens&&(this.tokens.pop(),this.tokens.push(this.convertToken(e))),this.lookahead=e,this.nextToken(),e},e.prototype.createNode=function(){return{index:this.startMarker.index,line:this.startMarker.line,column:this.startMarker.column}},e.prototype.startNode=function(e,t){void 0===t&&(t=0);var n=e.start-e.lineStart,i=e.lineNumber;return n<0&&(n+=t,i--),{index:e.start,line:i,column:n}},e.prototype.finalize=function(e,t){if(this.config.range&&(t.range=[e.index,this.lastMarker.index]),this.config.loc&&(t.loc={start:{line:e.line,column:e.column},end:{line:this.lastMarker.line,column:this.lastMarker.column}},this.config.source&&(t.loc.source=this.config.source)),this.delegate){var n={start:{line:e.line,column:e.column,offset:e.index},end:{line:this.lastMarker.line,column:this.lastMarker.column,offset:this.lastMarker.index}};this.delegate(t,n)}return t},e.prototype.expect=function(e){var t=this.nextToken();7===t.type&&t.value===e||this.throwUnexpectedToken(t)},e.prototype.expectCommaSeparator=function(){if(this.config.tolerant){var e=this.lookahead;7===e.type&&","===e.value?this.nextToken():7===e.type&&";"===e.value?(this.nextToken(),this.tolerateUnexpectedToken(e)):this.tolerateUnexpectedToken(e,o.Messages.UnexpectedToken)}else this.expect(",")},e.prototype.expectKeyword=function(e){var t=this.nextToken();4===t.type&&t.value===e||this.throwUnexpectedToken(t)},e.prototype.match=function(e){return 7===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchKeyword=function(e){return 4===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchContextualKeyword=function(e){return 3===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchAssign=function(){if(7!==this.lookahead.type)return!1;var e=this.lookahead.value;return"="===e||"*="===e||"**="===e||"/="===e||"%="===e||"+="===e||"-="===e||"<<="===e||">>="===e||">>>="===e||"&="===e||"^="===e||"|="===e},e.prototype.isolateCoverGrammar=function(e){var t=this.context.isBindingElement,n=this.context.isAssignmentTarget,i=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var r=e.call(this);return null!==this.context.firstCoverInitializedNameError&&this.throwUnexpectedToken(this.context.firstCoverInitializedNameError),this.context.isBindingElement=t,this.context.isAssignmentTarget=n,this.context.firstCoverInitializedNameError=i,r},e.prototype.inheritCoverGrammar=function(e){var t=this.context.isBindingElement,n=this.context.isAssignmentTarget,i=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var r=e.call(this);return this.context.isBindingElement=this.context.isBindingElement&&t,this.context.isAssignmentTarget=this.context.isAssignmentTarget&&n,this.context.firstCoverInitializedNameError=i||this.context.firstCoverInitializedNameError,r},e.prototype.consumeSemicolon=function(){this.match(";")?this.nextToken():this.hasLineTerminator||(2===this.lookahead.type||this.match("}")||this.throwUnexpectedToken(this.lookahead),this.lastMarker.index=this.startMarker.index,this.lastMarker.line=this.startMarker.line,this.lastMarker.column=this.startMarker.column)},e.prototype.parsePrimaryExpression=function(){var e,t,n,i=this.createNode();switch(this.lookahead.type){case 3:(this.context.isModule||this.context.await)&&"await"===this.lookahead.value&&this.tolerateUnexpectedToken(this.lookahead),e=this.matchAsyncFunction()?this.parseFunctionExpression():this.finalize(i,new a.Identifier(this.nextToken().value));break;case 6:case 8:this.context.strict&&this.lookahead.octal&&this.tolerateUnexpectedToken(this.lookahead,o.Messages.StrictOctalLiteral),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),n=this.getTokenRaw(t),e=this.finalize(i,new a.Literal(t.value,n));break;case 1:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),n=this.getTokenRaw(t),e=this.finalize(i,new a.Literal("true"===t.value,n));break;case 5:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),n=this.getTokenRaw(t),e=this.finalize(i,new a.Literal(null,n));break;case 10:e=this.parseTemplateLiteral();break;case 7:switch(this.lookahead.value){case"(":this.context.isBindingElement=!1,e=this.inheritCoverGrammar(this.parseGroupExpression);break;case"[":e=this.inheritCoverGrammar(this.parseArrayInitializer);break;case"{":e=this.inheritCoverGrammar(this.parseObjectInitializer);break;case"/":case"/=":this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.scanner.index=this.startMarker.index,t=this.nextRegexToken(),n=this.getTokenRaw(t),e=this.finalize(i,new a.RegexLiteral(t.regex,n,t.pattern,t.flags));break;default:e=this.throwUnexpectedToken(this.nextToken())}break;case 4:!this.context.strict&&this.context.allowYield&&this.matchKeyword("yield")?e=this.parseIdentifierName():!this.context.strict&&this.matchKeyword("let")?e=this.finalize(i,new a.Identifier(this.nextToken().value)):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.matchKeyword("function")?e=this.parseFunctionExpression():this.matchKeyword("this")?(this.nextToken(),e=this.finalize(i,new a.ThisExpression)):e=this.matchKeyword("class")?this.parseClassExpression():this.throwUnexpectedToken(this.nextToken()));break;default:e=this.throwUnexpectedToken(this.nextToken())}return e},e.prototype.parseSpreadElement=function(){var e=this.createNode();this.expect("...");var t=this.inheritCoverGrammar(this.parseAssignmentExpression);return this.finalize(e,new a.SpreadElement(t))},e.prototype.parseArrayInitializer=function(){var e=this.createNode(),t=[];for(this.expect("[");!this.match("]");)if(this.match(","))this.nextToken(),t.push(null);else if(this.match("...")){var n=this.parseSpreadElement();this.match("]")||(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.expect(",")),t.push(n)}else t.push(this.inheritCoverGrammar(this.parseAssignmentExpression)),this.match("]")||this.expect(",");return this.expect("]"),this.finalize(e,new a.ArrayExpression(t))},e.prototype.parsePropertyMethod=function(e){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var t=this.context.strict,n=this.context.allowStrictDirective;this.context.allowStrictDirective=e.simple;var i=this.isolateCoverGrammar(this.parseFunctionSourceElements);return this.context.strict&&e.firstRestricted&&this.tolerateUnexpectedToken(e.firstRestricted,e.message),this.context.strict&&e.stricted&&this.tolerateUnexpectedToken(e.stricted,e.message),this.context.strict=t,this.context.allowStrictDirective=n,i},e.prototype.parsePropertyMethodFunction=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var n=this.parseFormalParameters(),i=this.parsePropertyMethod(n);return this.context.allowYield=t,this.finalize(e,new a.FunctionExpression(null,n.params,i,!1))},e.prototype.parsePropertyMethodAsyncFunction=function(){var e=this.createNode(),t=this.context.allowYield,n=this.context.await;this.context.allowYield=!1,this.context.await=!0;var i=this.parseFormalParameters(),r=this.parsePropertyMethod(i);return this.context.allowYield=t,this.context.await=n,this.finalize(e,new a.AsyncFunctionExpression(null,i.params,r))},e.prototype.parseObjectPropertyKey=function(){var e,t=this.createNode(),n=this.nextToken();switch(n.type){case 8:case 6:this.context.strict&&n.octal&&this.tolerateUnexpectedToken(n,o.Messages.StrictOctalLiteral);var i=this.getTokenRaw(n);e=this.finalize(t,new a.Literal(n.value,i));break;case 3:case 1:case 5:case 4:e=this.finalize(t,new a.Identifier(n.value));break;case 7:"["===n.value?(e=this.isolateCoverGrammar(this.parseAssignmentExpression),this.expect("]")):e=this.throwUnexpectedToken(n);break;default:e=this.throwUnexpectedToken(n)}return e},e.prototype.isPropertyKey=function(e,t){return e.type===l.Syntax.Identifier&&e.name===t||e.type===l.Syntax.Literal&&e.value===t},e.prototype.parseObjectProperty=function(e){var t,n=this.createNode(),i=this.lookahead,r=null,s=null,l=!1,u=!1,c=!1,h=!1;if(3===i.type){var p=i.value;this.nextToken(),l=this.match("["),r=(h=!(this.hasLineTerminator||"async"!==p||this.match(":")||this.match("(")||this.match("*")||this.match(",")))?this.parseObjectPropertyKey():this.finalize(n,new a.Identifier(p))}else this.match("*")?this.nextToken():(l=this.match("["),r=this.parseObjectPropertyKey());var d=this.qualifiedPropertyName(this.lookahead);if(3===i.type&&!h&&"get"===i.value&&d)t="get",l=this.match("["),r=this.parseObjectPropertyKey(),this.context.allowYield=!1,s=this.parseGetterMethod();else if(3===i.type&&!h&&"set"===i.value&&d)t="set",l=this.match("["),r=this.parseObjectPropertyKey(),s=this.parseSetterMethod();else if(7===i.type&&"*"===i.value&&d)t="init",l=this.match("["),r=this.parseObjectPropertyKey(),s=this.parseGeneratorMethod(),u=!0;else if(r||this.throwUnexpectedToken(this.lookahead),t="init",this.match(":")&&!h)!l&&this.isPropertyKey(r,"__proto__")&&(e.value&&this.tolerateError(o.Messages.DuplicateProtoProperty),e.value=!0),this.nextToken(),s=this.inheritCoverGrammar(this.parseAssignmentExpression);else if(this.match("("))s=h?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),u=!0;else if(3===i.type)if(p=this.finalize(n,new a.Identifier(i.value)),this.match("=")){this.context.firstCoverInitializedNameError=this.lookahead,this.nextToken(),c=!0;var f=this.isolateCoverGrammar(this.parseAssignmentExpression);s=this.finalize(n,new a.AssignmentPattern(p,f))}else c=!0,s=p;else this.throwUnexpectedToken(this.nextToken());return this.finalize(n,new a.Property(t,r,l,s,u,c))},e.prototype.parseObjectInitializer=function(){var e=this.createNode();this.expect("{");for(var t=[],n={value:!1};!this.match("}");)t.push(this.parseObjectProperty(n)),this.match("}")||this.expectCommaSeparator();return this.expect("}"),this.finalize(e,new a.ObjectExpression(t))},e.prototype.parseTemplateHead=function(){i.assert(this.lookahead.head,"Template literal must start with a template head");var e=this.createNode(),t=this.nextToken(),n=t.value,r=t.cooked;return this.finalize(e,new a.TemplateElement({raw:n,cooked:r},t.tail))},e.prototype.parseTemplateElement=function(){10!==this.lookahead.type&&this.throwUnexpectedToken();var e=this.createNode(),t=this.nextToken(),n=t.value,i=t.cooked;return this.finalize(e,new a.TemplateElement({raw:n,cooked:i},t.tail))},e.prototype.parseTemplateLiteral=function(){var e=this.createNode(),t=[],n=[],i=this.parseTemplateHead();for(n.push(i);!i.tail;)t.push(this.parseExpression()),i=this.parseTemplateElement(),n.push(i);return this.finalize(e,new a.TemplateLiteral(n,t))},e.prototype.reinterpretExpressionAsPattern=function(e){switch(e.type){case l.Syntax.Identifier:case l.Syntax.MemberExpression:case l.Syntax.RestElement:case l.Syntax.AssignmentPattern:break;case l.Syntax.SpreadElement:e.type=l.Syntax.RestElement,this.reinterpretExpressionAsPattern(e.argument);break;case l.Syntax.ArrayExpression:e.type=l.Syntax.ArrayPattern;for(var t=0;t<e.elements.length;t++)null!==e.elements[t]&&this.reinterpretExpressionAsPattern(e.elements[t]);break;case l.Syntax.ObjectExpression:for(e.type=l.Syntax.ObjectPattern,t=0;t<e.properties.length;t++)this.reinterpretExpressionAsPattern(e.properties[t].value);break;case l.Syntax.AssignmentExpression:e.type=l.Syntax.AssignmentPattern,delete e.operator,this.reinterpretExpressionAsPattern(e.left)}},e.prototype.parseGroupExpression=function(){var e;if(this.expect("("),this.match(")"))this.nextToken(),this.match("=>")||this.expect("=>"),e={type:"ArrowParameterPlaceHolder",params:[],async:!1};else{var t=this.lookahead,n=[];if(this.match("..."))e=this.parseRestElement(n),this.expect(")"),this.match("=>")||this.expect("=>"),e={type:"ArrowParameterPlaceHolder",params:[e],async:!1};else{var i=!1;if(this.context.isBindingElement=!0,e=this.inheritCoverGrammar(this.parseAssignmentExpression),this.match(",")){var r=[];for(this.context.isAssignmentTarget=!1,r.push(e);2!==this.lookahead.type&&this.match(",");){if(this.nextToken(),this.match(")")){this.nextToken();for(var o=0;o<r.length;o++)this.reinterpretExpressionAsPattern(r[o]);i=!0,e={type:"ArrowParameterPlaceHolder",params:r,async:!1}}else if(this.match("...")){for(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),r.push(this.parseRestElement(n)),this.expect(")"),this.match("=>")||this.expect("=>"),this.context.isBindingElement=!1,o=0;o<r.length;o++)this.reinterpretExpressionAsPattern(r[o]);i=!0,e={type:"ArrowParameterPlaceHolder",params:r,async:!1}}else r.push(this.inheritCoverGrammar(this.parseAssignmentExpression));if(i)break}i||(e=this.finalize(this.startNode(t),new a.SequenceExpression(r)))}if(!i){if(this.expect(")"),this.match("=>")&&(e.type===l.Syntax.Identifier&&"yield"===e.name&&(i=!0,e={type:"ArrowParameterPlaceHolder",params:[e],async:!1}),!i)){if(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),e.type===l.Syntax.SequenceExpression)for(o=0;o<e.expressions.length;o++)this.reinterpretExpressionAsPattern(e.expressions[o]);else this.reinterpretExpressionAsPattern(e);e={type:"ArrowParameterPlaceHolder",params:e.type===l.Syntax.SequenceExpression?e.expressions:[e],async:!1}}this.context.isBindingElement=!1}}}return e},e.prototype.parseArguments=function(){this.expect("(");var e=[];if(!this.match(")"))for(;;){var t=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAssignmentExpression);if(e.push(t),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),e},e.prototype.isIdentifierName=function(e){return 3===e.type||4===e.type||1===e.type||5===e.type},e.prototype.parseIdentifierName=function(){var e=this.createNode(),t=this.nextToken();return this.isIdentifierName(t)||this.throwUnexpectedToken(t),this.finalize(e,new a.Identifier(t.value))},e.prototype.parseNewExpression=function(){var e,t=this.createNode(),n=this.parseIdentifierName();if(i.assert("new"===n.name,"New expression must start with `new`"),this.match("."))if(this.nextToken(),3===this.lookahead.type&&this.context.inFunctionBody&&"target"===this.lookahead.value){var r=this.parseIdentifierName();e=new a.MetaProperty(n,r)}else this.throwUnexpectedToken(this.lookahead);else{var o=this.isolateCoverGrammar(this.parseLeftHandSideExpression),s=this.match("(")?this.parseArguments():[];e=new a.NewExpression(o,s),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return this.finalize(t,e)},e.prototype.parseAsyncArgument=function(){var e=this.parseAssignmentExpression();return this.context.firstCoverInitializedNameError=null,e},e.prototype.parseAsyncArguments=function(){this.expect("(");var e=[];if(!this.match(")"))for(;;){var t=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAsyncArgument);if(e.push(t),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),e},e.prototype.parseLeftHandSideExpressionAllowCall=function(){var e,t=this.lookahead,n=this.matchContextualKeyword("async"),i=this.context.allowIn;for(this.context.allowIn=!0,this.matchKeyword("super")&&this.context.inFunctionBody?(e=this.createNode(),this.nextToken(),e=this.finalize(e,new a.Super),this.match("(")||this.match(".")||this.match("[")||this.throwUnexpectedToken(this.lookahead)):e=this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match(".")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");var r=this.parseIdentifierName();e=this.finalize(this.startNode(t),new a.StaticMemberExpression(e,r))}else if(this.match("(")){var o=n&&t.lineNumber===this.lookahead.lineNumber;this.context.isBindingElement=!1,this.context.isAssignmentTarget=!1;var s=o?this.parseAsyncArguments():this.parseArguments();if(e=this.finalize(this.startNode(t),new a.CallExpression(e,s)),o&&this.match("=>")){for(var l=0;l<s.length;++l)this.reinterpretExpressionAsPattern(s[l]);e={type:"ArrowParameterPlaceHolder",params:s,async:!0}}}else if(this.match("["))this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("["),r=this.isolateCoverGrammar(this.parseExpression),this.expect("]"),e=this.finalize(this.startNode(t),new a.ComputedMemberExpression(e,r));else{if(10!==this.lookahead.type||!this.lookahead.head)break;var u=this.parseTemplateLiteral();e=this.finalize(this.startNode(t),new a.TaggedTemplateExpression(e,u))}return this.context.allowIn=i,e},e.prototype.parseSuper=function(){var e=this.createNode();return this.expectKeyword("super"),this.match("[")||this.match(".")||this.throwUnexpectedToken(this.lookahead),this.finalize(e,new a.Super)},e.prototype.parseLeftHandSideExpression=function(){i.assert(this.context.allowIn,"callee of new expression always allow in keyword.");for(var e=this.startNode(this.lookahead),t=this.matchKeyword("super")&&this.context.inFunctionBody?this.parseSuper():this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");var n=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),t=this.finalize(e,new a.ComputedMemberExpression(t,n))}else if(this.match("."))this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("."),n=this.parseIdentifierName(),t=this.finalize(e,new a.StaticMemberExpression(t,n));else{if(10!==this.lookahead.type||!this.lookahead.head)break;var r=this.parseTemplateLiteral();t=this.finalize(e,new a.TaggedTemplateExpression(t,r))}return t},e.prototype.parseUpdateExpression=function(){var e,t=this.lookahead;if(this.match("++")||this.match("--")){var n=this.startNode(t),i=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),this.context.strict&&e.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(e.name)&&this.tolerateError(o.Messages.StrictLHSPrefix),this.context.isAssignmentTarget||this.tolerateError(o.Messages.InvalidLHSInAssignment);var r=!0;e=this.finalize(n,new a.UpdateExpression(i.value,e,r)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else if(e=this.inheritCoverGrammar(this.parseLeftHandSideExpressionAllowCall),!this.hasLineTerminator&&7===this.lookahead.type&&(this.match("++")||this.match("--"))){this.context.strict&&e.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(e.name)&&this.tolerateError(o.Messages.StrictLHSPostfix),this.context.isAssignmentTarget||this.tolerateError(o.Messages.InvalidLHSInAssignment),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var s=this.nextToken().value;r=!1,e=this.finalize(this.startNode(t),new a.UpdateExpression(s,e,r))}return e},e.prototype.parseAwaitExpression=function(){var e=this.createNode();this.nextToken();var t=this.parseUnaryExpression();return this.finalize(e,new a.AwaitExpression(t))},e.prototype.parseUnaryExpression=function(){var e;if(this.match("+")||this.match("-")||this.match("~")||this.match("!")||this.matchKeyword("delete")||this.matchKeyword("void")||this.matchKeyword("typeof")){var t=this.startNode(this.lookahead),n=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),e=this.finalize(t,new a.UnaryExpression(n.value,e)),this.context.strict&&"delete"===e.operator&&e.argument.type===l.Syntax.Identifier&&this.tolerateError(o.Messages.StrictDelete),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else e=this.context.await&&this.matchContextualKeyword("await")?this.parseAwaitExpression():this.parseUpdateExpression();return e},e.prototype.parseExponentiationExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseUnaryExpression);if(t.type!==l.Syntax.UnaryExpression&&this.match("**")){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var n=t,i=this.isolateCoverGrammar(this.parseExponentiationExpression);t=this.finalize(this.startNode(e),new a.BinaryExpression("**",n,i))}return t},e.prototype.binaryPrecedence=function(e){var t=e.value;return 7===e.type?this.operatorPrecedence[t]||0:4===e.type&&("instanceof"===t||this.context.allowIn&&"in"===t)?7:0},e.prototype.parseBinaryExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseExponentiationExpression),n=this.lookahead,i=this.binaryPrecedence(n);if(i>0){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;for(var r=[e,this.lookahead],o=t,s=this.isolateCoverGrammar(this.parseExponentiationExpression),l=[o,n.value,s],u=[i];!((i=this.binaryPrecedence(this.lookahead))<=0);){for(;l.length>2&&i<=u[u.length-1];){s=l.pop();var c=l.pop();u.pop(),o=l.pop(),r.pop();var h=this.startNode(r[r.length-1]);l.push(this.finalize(h,new a.BinaryExpression(c,o,s)))}l.push(this.nextToken().value),u.push(i),r.push(this.lookahead),l.push(this.isolateCoverGrammar(this.parseExponentiationExpression))}var p=l.length-1;t=l[p];for(var d=r.pop();p>1;){var f=r.pop(),m=d&&d.lineStart;h=this.startNode(f,m),c=l[p-1],t=this.finalize(h,new a.BinaryExpression(c,l[p-2],t)),p-=2,d=f}}return t},e.prototype.parseConditionalExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseBinaryExpression);if(this.match("?")){this.nextToken();var n=this.context.allowIn;this.context.allowIn=!0;var i=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowIn=n,this.expect(":");var r=this.isolateCoverGrammar(this.parseAssignmentExpression);t=this.finalize(this.startNode(e),new a.ConditionalExpression(t,i,r)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return t},e.prototype.checkPatternParam=function(e,t){switch(t.type){case l.Syntax.Identifier:this.validateParam(e,t,t.name);break;case l.Syntax.RestElement:this.checkPatternParam(e,t.argument);break;case l.Syntax.AssignmentPattern:this.checkPatternParam(e,t.left);break;case l.Syntax.ArrayPattern:for(var n=0;n<t.elements.length;n++)null!==t.elements[n]&&this.checkPatternParam(e,t.elements[n]);break;case l.Syntax.ObjectPattern:for(n=0;n<t.properties.length;n++)this.checkPatternParam(e,t.properties[n].value)}e.simple=e.simple&&t instanceof a.Identifier},e.prototype.reinterpretAsCoverFormalsList=function(e){var t,n=[e],i=!1;switch(e.type){case l.Syntax.Identifier:break;case"ArrowParameterPlaceHolder":n=e.params,i=e.async;break;default:return null}t={simple:!0,paramSet:{}};for(var r=0;r<n.length;++r)(a=n[r]).type===l.Syntax.AssignmentPattern?a.right.type===l.Syntax.YieldExpression&&(a.right.argument&&this.throwUnexpectedToken(this.lookahead),a.right.type=l.Syntax.Identifier,a.right.name="yield",delete a.right.argument,delete a.right.delegate):i&&a.type===l.Syntax.Identifier&&"await"===a.name&&this.throwUnexpectedToken(this.lookahead),this.checkPatternParam(t,a),n[r]=a;if(this.context.strict||!this.context.allowYield)for(r=0;r<n.length;++r){var a;(a=n[r]).type===l.Syntax.YieldExpression&&this.throwUnexpectedToken(this.lookahead)}if(t.message===o.Messages.StrictParamDupe){var s=this.context.strict?t.stricted:t.firstRestricted;this.throwUnexpectedToken(s,t.message)}return{simple:t.simple,params:n,stricted:t.stricted,firstRestricted:t.firstRestricted,message:t.message}},e.prototype.parseAssignmentExpression=function(){var e;if(!this.context.allowYield&&this.matchKeyword("yield"))e=this.parseYieldExpression();else{var t=this.lookahead,n=t;if(e=this.parseConditionalExpression(),3===n.type&&n.lineNumber===this.lookahead.lineNumber&&"async"===n.value&&(3===this.lookahead.type||this.matchKeyword("yield"))){var i=this.parsePrimaryExpression();this.reinterpretExpressionAsPattern(i),e={type:"ArrowParameterPlaceHolder",params:[i],async:!0}}if("ArrowParameterPlaceHolder"===e.type||this.match("=>")){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var r=e.async,s=this.reinterpretAsCoverFormalsList(e);if(s){this.hasLineTerminator&&this.tolerateUnexpectedToken(this.lookahead),this.context.firstCoverInitializedNameError=null;var u=this.context.strict,c=this.context.allowStrictDirective;this.context.allowStrictDirective=s.simple;var h=this.context.allowYield,p=this.context.await;this.context.allowYield=!0,this.context.await=r;var d=this.startNode(t);this.expect("=>");var f=void 0;if(this.match("{")){var m=this.context.allowIn;this.context.allowIn=!0,f=this.parseFunctionSourceElements(),this.context.allowIn=m}else f=this.isolateCoverGrammar(this.parseAssignmentExpression);var g=f.type!==l.Syntax.BlockStatement;this.context.strict&&s.firstRestricted&&this.throwUnexpectedToken(s.firstRestricted,s.message),this.context.strict&&s.stricted&&this.tolerateUnexpectedToken(s.stricted,s.message),e=r?this.finalize(d,new a.AsyncArrowFunctionExpression(s.params,f,g)):this.finalize(d,new a.ArrowFunctionExpression(s.params,f,g)),this.context.strict=u,this.context.allowStrictDirective=c,this.context.allowYield=h,this.context.await=p}}else if(this.matchAssign()){if(this.context.isAssignmentTarget||this.tolerateError(o.Messages.InvalidLHSInAssignment),this.context.strict&&e.type===l.Syntax.Identifier){var v=e;this.scanner.isRestrictedWord(v.name)&&this.tolerateUnexpectedToken(n,o.Messages.StrictLHSAssignment),this.scanner.isStrictModeReservedWord(v.name)&&this.tolerateUnexpectedToken(n,o.Messages.StrictReservedWord)}this.match("=")?this.reinterpretExpressionAsPattern(e):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1);var y=(n=this.nextToken()).value,b=this.isolateCoverGrammar(this.parseAssignmentExpression);e=this.finalize(this.startNode(t),new a.AssignmentExpression(y,e,b)),this.context.firstCoverInitializedNameError=null}}return e},e.prototype.parseExpression=function(){var e=this.lookahead,t=this.isolateCoverGrammar(this.parseAssignmentExpression);if(this.match(",")){var n=[];for(n.push(t);2!==this.lookahead.type&&this.match(",");)this.nextToken(),n.push(this.isolateCoverGrammar(this.parseAssignmentExpression));t=this.finalize(this.startNode(e),new a.SequenceExpression(n))}return t},e.prototype.parseStatementListItem=function(){var e;if(this.context.isAssignmentTarget=!0,this.context.isBindingElement=!0,4===this.lookahead.type)switch(this.lookahead.value){case"export":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,o.Messages.IllegalExportDeclaration),e=this.parseExportDeclaration();break;case"import":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,o.Messages.IllegalImportDeclaration),e=this.parseImportDeclaration();break;case"const":e=this.parseLexicalDeclaration({inFor:!1});break;case"function":e=this.parseFunctionDeclaration();break;case"class":e=this.parseClassDeclaration();break;case"let":e=this.isLexicalDeclaration()?this.parseLexicalDeclaration({inFor:!1}):this.parseStatement();break;default:e=this.parseStatement()}else e=this.parseStatement();return e},e.prototype.parseBlock=function(){var e=this.createNode();this.expect("{");for(var t=[];!this.match("}");)t.push(this.parseStatementListItem());return this.expect("}"),this.finalize(e,new a.BlockStatement(t))},e.prototype.parseLexicalBinding=function(e,t){var n=this.createNode(),i=this.parsePattern([],e);this.context.strict&&i.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(i.name)&&this.tolerateError(o.Messages.StrictVarName);var r=null;return"const"===e?this.matchKeyword("in")||this.matchContextualKeyword("of")||(this.match("=")?(this.nextToken(),r=this.isolateCoverGrammar(this.parseAssignmentExpression)):this.throwError(o.Messages.DeclarationMissingInitializer,"const")):(!t.inFor&&i.type!==l.Syntax.Identifier||this.match("="))&&(this.expect("="),r=this.isolateCoverGrammar(this.parseAssignmentExpression)),this.finalize(n,new a.VariableDeclarator(i,r))},e.prototype.parseBindingList=function(e,t){for(var n=[this.parseLexicalBinding(e,t)];this.match(",");)this.nextToken(),n.push(this.parseLexicalBinding(e,t));return n},e.prototype.isLexicalDeclaration=function(){var e=this.scanner.saveState();this.scanner.scanComments();var t=this.scanner.lex();return this.scanner.restoreState(e),3===t.type||7===t.type&&"["===t.value||7===t.type&&"{"===t.value||4===t.type&&"let"===t.value||4===t.type&&"yield"===t.value},e.prototype.parseLexicalDeclaration=function(e){var t=this.createNode(),n=this.nextToken().value;i.assert("let"===n||"const"===n,"Lexical declaration must be either let or const");var r=this.parseBindingList(n,e);return this.consumeSemicolon(),this.finalize(t,new a.VariableDeclaration(r,n))},e.prototype.parseBindingRestElement=function(e,t){var n=this.createNode();this.expect("...");var i=this.parsePattern(e,t);return this.finalize(n,new a.RestElement(i))},e.prototype.parseArrayPattern=function(e,t){var n=this.createNode();this.expect("[");for(var i=[];!this.match("]");)if(this.match(","))this.nextToken(),i.push(null);else{if(this.match("...")){i.push(this.parseBindingRestElement(e,t));break}i.push(this.parsePatternWithDefault(e,t)),this.match("]")||this.expect(",")}return this.expect("]"),this.finalize(n,new a.ArrayPattern(i))},e.prototype.parsePropertyPattern=function(e,t){var n,i,r=this.createNode(),o=!1,s=!1;if(3===this.lookahead.type){var l=this.lookahead;n=this.parseVariableIdentifier();var u=this.finalize(r,new a.Identifier(l.value));if(this.match("=")){e.push(l),s=!0,this.nextToken();var c=this.parseAssignmentExpression();i=this.finalize(this.startNode(l),new a.AssignmentPattern(u,c))}else this.match(":")?(this.expect(":"),i=this.parsePatternWithDefault(e,t)):(e.push(l),s=!0,i=u)}else o=this.match("["),n=this.parseObjectPropertyKey(),this.expect(":"),i=this.parsePatternWithDefault(e,t);return this.finalize(r,new a.Property("init",n,o,i,!1,s))},e.prototype.parseObjectPattern=function(e,t){var n=this.createNode(),i=[];for(this.expect("{");!this.match("}");)i.push(this.parsePropertyPattern(e,t)),this.match("}")||this.expect(",");return this.expect("}"),this.finalize(n,new a.ObjectPattern(i))},e.prototype.parsePattern=function(e,t){var n;return this.match("[")?n=this.parseArrayPattern(e,t):this.match("{")?n=this.parseObjectPattern(e,t):(!this.matchKeyword("let")||"const"!==t&&"let"!==t||this.tolerateUnexpectedToken(this.lookahead,o.Messages.LetInLexicalBinding),e.push(this.lookahead),n=this.parseVariableIdentifier(t)),n},e.prototype.parsePatternWithDefault=function(e,t){var n=this.lookahead,i=this.parsePattern(e,t);if(this.match("=")){this.nextToken();var r=this.context.allowYield;this.context.allowYield=!0;var o=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowYield=r,i=this.finalize(this.startNode(n),new a.AssignmentPattern(i,o))}return i},e.prototype.parseVariableIdentifier=function(e){var t=this.createNode(),n=this.nextToken();return 4===n.type&&"yield"===n.value?this.context.strict?this.tolerateUnexpectedToken(n,o.Messages.StrictReservedWord):this.context.allowYield||this.throwUnexpectedToken(n):3!==n.type?this.context.strict&&4===n.type&&this.scanner.isStrictModeReservedWord(n.value)?this.tolerateUnexpectedToken(n,o.Messages.StrictReservedWord):(this.context.strict||"let"!==n.value||"var"!==e)&&this.throwUnexpectedToken(n):(this.context.isModule||this.context.await)&&3===n.type&&"await"===n.value&&this.tolerateUnexpectedToken(n),this.finalize(t,new a.Identifier(n.value))},e.prototype.parseVariableDeclaration=function(e){var t=this.createNode(),n=this.parsePattern([],"var");this.context.strict&&n.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(n.name)&&this.tolerateError(o.Messages.StrictVarName);var i=null;return this.match("=")?(this.nextToken(),i=this.isolateCoverGrammar(this.parseAssignmentExpression)):n.type===l.Syntax.Identifier||e.inFor||this.expect("="),this.finalize(t,new a.VariableDeclarator(n,i))},e.prototype.parseVariableDeclarationList=function(e){var t={inFor:e.inFor},n=[];for(n.push(this.parseVariableDeclaration(t));this.match(",");)this.nextToken(),n.push(this.parseVariableDeclaration(t));return n},e.prototype.parseVariableStatement=function(){var e=this.createNode();this.expectKeyword("var");var t=this.parseVariableDeclarationList({inFor:!1});return this.consumeSemicolon(),this.finalize(e,new a.VariableDeclaration(t,"var"))},e.prototype.parseEmptyStatement=function(){var e=this.createNode();return this.expect(";"),this.finalize(e,new a.EmptyStatement)},e.prototype.parseExpressionStatement=function(){var e=this.createNode(),t=this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new a.ExpressionStatement(t))},e.prototype.parseIfClause=function(){return this.context.strict&&this.matchKeyword("function")&&this.tolerateError(o.Messages.StrictFunction),this.parseStatement()},e.prototype.parseIfStatement=function(){var e,t=this.createNode(),n=null;this.expectKeyword("if"),this.expect("(");var i=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new a.EmptyStatement)):(this.expect(")"),e=this.parseIfClause(),this.matchKeyword("else")&&(this.nextToken(),n=this.parseIfClause())),this.finalize(t,new a.IfStatement(i,e,n))},e.prototype.parseDoWhileStatement=function(){var e=this.createNode();this.expectKeyword("do");var t=this.context.inIteration;this.context.inIteration=!0;var n=this.parseStatement();this.context.inIteration=t,this.expectKeyword("while"),this.expect("(");var i=this.parseExpression();return!this.match(")")&&this.config.tolerant?this.tolerateUnexpectedToken(this.nextToken()):(this.expect(")"),this.match(";")&&this.nextToken()),this.finalize(e,new a.DoWhileStatement(n,i))},e.prototype.parseWhileStatement=function(){var e,t=this.createNode();this.expectKeyword("while"),this.expect("(");var n=this.parseExpression();if(!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new a.EmptyStatement);else{this.expect(")");var i=this.context.inIteration;this.context.inIteration=!0,e=this.parseStatement(),this.context.inIteration=i}return this.finalize(t,new a.WhileStatement(n,e))},e.prototype.parseForStatement=function(){var e,t,n,i=null,r=null,s=null,u=!0,c=this.createNode();if(this.expectKeyword("for"),this.expect("("),this.match(";"))this.nextToken();else if(this.matchKeyword("var")){i=this.createNode(),this.nextToken();var h=this.context.allowIn;this.context.allowIn=!1;var p=this.parseVariableDeclarationList({inFor:!0});if(this.context.allowIn=h,1===p.length&&this.matchKeyword("in")){var d=p[0];d.init&&(d.id.type===l.Syntax.ArrayPattern||d.id.type===l.Syntax.ObjectPattern||this.context.strict)&&this.tolerateError(o.Messages.ForInOfLoopInitializer,"for-in"),i=this.finalize(i,new a.VariableDeclaration(p,"var")),this.nextToken(),e=i,t=this.parseExpression(),i=null}else 1===p.length&&null===p[0].init&&this.matchContextualKeyword("of")?(i=this.finalize(i,new a.VariableDeclaration(p,"var")),this.nextToken(),e=i,t=this.parseAssignmentExpression(),i=null,u=!1):(i=this.finalize(i,new a.VariableDeclaration(p,"var")),this.expect(";"))}else if(this.matchKeyword("const")||this.matchKeyword("let")){i=this.createNode();var f=this.nextToken().value;this.context.strict||"in"!==this.lookahead.value?(h=this.context.allowIn,this.context.allowIn=!1,p=this.parseBindingList(f,{inFor:!0}),this.context.allowIn=h,1===p.length&&null===p[0].init&&this.matchKeyword("in")?(i=this.finalize(i,new a.VariableDeclaration(p,f)),this.nextToken(),e=i,t=this.parseExpression(),i=null):1===p.length&&null===p[0].init&&this.matchContextualKeyword("of")?(i=this.finalize(i,new a.VariableDeclaration(p,f)),this.nextToken(),e=i,t=this.parseAssignmentExpression(),i=null,u=!1):(this.consumeSemicolon(),i=this.finalize(i,new a.VariableDeclaration(p,f)))):(i=this.finalize(i,new a.Identifier(f)),this.nextToken(),e=i,t=this.parseExpression(),i=null)}else{var m=this.lookahead;if(h=this.context.allowIn,this.context.allowIn=!1,i=this.inheritCoverGrammar(this.parseAssignmentExpression),this.context.allowIn=h,this.matchKeyword("in"))this.context.isAssignmentTarget&&i.type!==l.Syntax.AssignmentExpression||this.tolerateError(o.Messages.InvalidLHSInForIn),this.nextToken(),this.reinterpretExpressionAsPattern(i),e=i,t=this.parseExpression(),i=null;else if(this.matchContextualKeyword("of"))this.context.isAssignmentTarget&&i.type!==l.Syntax.AssignmentExpression||this.tolerateError(o.Messages.InvalidLHSInForLoop),this.nextToken(),this.reinterpretExpressionAsPattern(i),e=i,t=this.parseAssignmentExpression(),i=null,u=!1;else{if(this.match(",")){for(var g=[i];this.match(",");)this.nextToken(),g.push(this.isolateCoverGrammar(this.parseAssignmentExpression));i=this.finalize(this.startNode(m),new a.SequenceExpression(g))}this.expect(";")}}if(void 0===e&&(this.match(";")||(r=this.parseExpression()),this.expect(";"),this.match(")")||(s=this.parseExpression())),!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),n=this.finalize(this.createNode(),new a.EmptyStatement);else{this.expect(")");var v=this.context.inIteration;this.context.inIteration=!0,n=this.isolateCoverGrammar(this.parseStatement),this.context.inIteration=v}return void 0===e?this.finalize(c,new a.ForStatement(i,r,s,n)):u?this.finalize(c,new a.ForInStatement(e,t,n)):this.finalize(c,new a.ForOfStatement(e,t,n))},e.prototype.parseContinueStatement=function(){var e=this.createNode();this.expectKeyword("continue");var t=null;if(3===this.lookahead.type&&!this.hasLineTerminator){var n=this.parseVariableIdentifier();t=n;var i="$"+n.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,i)||this.throwError(o.Messages.UnknownLabel,n.name)}return this.consumeSemicolon(),null!==t||this.context.inIteration||this.throwError(o.Messages.IllegalContinue),this.finalize(e,new a.ContinueStatement(t))},e.prototype.parseBreakStatement=function(){var e=this.createNode();this.expectKeyword("break");var t=null;if(3===this.lookahead.type&&!this.hasLineTerminator){var n=this.parseVariableIdentifier(),i="$"+n.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,i)||this.throwError(o.Messages.UnknownLabel,n.name),t=n}return this.consumeSemicolon(),null!==t||this.context.inIteration||this.context.inSwitch||this.throwError(o.Messages.IllegalBreak),this.finalize(e,new a.BreakStatement(t))},e.prototype.parseReturnStatement=function(){this.context.inFunctionBody||this.tolerateError(o.Messages.IllegalReturn);var e=this.createNode();this.expectKeyword("return");var t=(this.match(";")||this.match("}")||this.hasLineTerminator||2===this.lookahead.type)&&8!==this.lookahead.type&&10!==this.lookahead.type?null:this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new a.ReturnStatement(t))},e.prototype.parseWithStatement=function(){this.context.strict&&this.tolerateError(o.Messages.StrictModeWith);var e,t=this.createNode();this.expectKeyword("with"),this.expect("(");var n=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new a.EmptyStatement)):(this.expect(")"),e=this.parseStatement()),this.finalize(t,new a.WithStatement(n,e))},e.prototype.parseSwitchCase=function(){var e,t=this.createNode();this.matchKeyword("default")?(this.nextToken(),e=null):(this.expectKeyword("case"),e=this.parseExpression()),this.expect(":");for(var n=[];!(this.match("}")||this.matchKeyword("default")||this.matchKeyword("case"));)n.push(this.parseStatementListItem());return this.finalize(t,new a.SwitchCase(e,n))},e.prototype.parseSwitchStatement=function(){var e=this.createNode();this.expectKeyword("switch"),this.expect("(");var t=this.parseExpression();this.expect(")");var n=this.context.inSwitch;this.context.inSwitch=!0;var i=[],r=!1;for(this.expect("{");!this.match("}");){var s=this.parseSwitchCase();null===s.test&&(r&&this.throwError(o.Messages.MultipleDefaultsInSwitch),r=!0),i.push(s)}return this.expect("}"),this.context.inSwitch=n,this.finalize(e,new a.SwitchStatement(t,i))},e.prototype.parseLabelledStatement=function(){var e,t=this.createNode(),n=this.parseExpression();if(n.type===l.Syntax.Identifier&&this.match(":")){this.nextToken();var i=n,r="$"+i.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,r)&&this.throwError(o.Messages.Redeclaration,"Label",i.name),this.context.labelSet[r]=!0;var s=void 0;if(this.matchKeyword("class"))this.tolerateUnexpectedToken(this.lookahead),s=this.parseClassDeclaration();else if(this.matchKeyword("function")){var u=this.lookahead,c=this.parseFunctionDeclaration();this.context.strict?this.tolerateUnexpectedToken(u,o.Messages.StrictFunction):c.generator&&this.tolerateUnexpectedToken(u,o.Messages.GeneratorInLegacyContext),s=c}else s=this.parseStatement();delete this.context.labelSet[r],e=new a.LabeledStatement(i,s)}else this.consumeSemicolon(),e=new a.ExpressionStatement(n);return this.finalize(t,e)},e.prototype.parseThrowStatement=function(){var e=this.createNode();this.expectKeyword("throw"),this.hasLineTerminator&&this.throwError(o.Messages.NewlineAfterThrow);var t=this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new a.ThrowStatement(t))},e.prototype.parseCatchClause=function(){var e=this.createNode();this.expectKeyword("catch"),this.expect("("),this.match(")")&&this.throwUnexpectedToken(this.lookahead);for(var t=[],n=this.parsePattern(t),i={},r=0;r<t.length;r++){var s="$"+t[r].value;Object.prototype.hasOwnProperty.call(i,s)&&this.tolerateError(o.Messages.DuplicateBinding,t[r].value),i[s]=!0}this.context.strict&&n.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(n.name)&&this.tolerateError(o.Messages.StrictCatchVariable),this.expect(")");var u=this.parseBlock();return this.finalize(e,new a.CatchClause(n,u))},e.prototype.parseFinallyClause=function(){return this.expectKeyword("finally"),this.parseBlock()},e.prototype.parseTryStatement=function(){var e=this.createNode();this.expectKeyword("try");var t=this.parseBlock(),n=this.matchKeyword("catch")?this.parseCatchClause():null,i=this.matchKeyword("finally")?this.parseFinallyClause():null;return n||i||this.throwError(o.Messages.NoCatchOrFinally),this.finalize(e,new a.TryStatement(t,n,i))},e.prototype.parseDebuggerStatement=function(){var e=this.createNode();return this.expectKeyword("debugger"),this.consumeSemicolon(),this.finalize(e,new a.DebuggerStatement)},e.prototype.parseStatement=function(){var e;switch(this.lookahead.type){case 1:case 5:case 6:case 8:case 10:case 9:e=this.parseExpressionStatement();break;case 7:var t=this.lookahead.value;e="{"===t?this.parseBlock():"("===t?this.parseExpressionStatement():";"===t?this.parseEmptyStatement():this.parseExpressionStatement();break;case 3:e=this.matchAsyncFunction()?this.parseFunctionDeclaration():this.parseLabelledStatement();break;case 4:switch(this.lookahead.value){case"break":e=this.parseBreakStatement();break;case"continue":e=this.parseContinueStatement();break;case"debugger":e=this.parseDebuggerStatement();break;case"do":e=this.parseDoWhileStatement();break;case"for":e=this.parseForStatement();break;case"function":e=this.parseFunctionDeclaration();break;case"if":e=this.parseIfStatement();break;case"return":e=this.parseReturnStatement();break;case"switch":e=this.parseSwitchStatement();break;case"throw":e=this.parseThrowStatement();break;case"try":e=this.parseTryStatement();break;case"var":e=this.parseVariableStatement();break;case"while":e=this.parseWhileStatement();break;case"with":e=this.parseWithStatement();break;default:e=this.parseExpressionStatement()}break;default:e=this.throwUnexpectedToken(this.lookahead)}return e},e.prototype.parseFunctionSourceElements=function(){var e=this.createNode();this.expect("{");var t=this.parseDirectivePrologues(),n=this.context.labelSet,i=this.context.inIteration,r=this.context.inSwitch,o=this.context.inFunctionBody;for(this.context.labelSet={},this.context.inIteration=!1,this.context.inSwitch=!1,this.context.inFunctionBody=!0;2!==this.lookahead.type&&!this.match("}");)t.push(this.parseStatementListItem());return this.expect("}"),this.context.labelSet=n,this.context.inIteration=i,this.context.inSwitch=r,this.context.inFunctionBody=o,this.finalize(e,new a.BlockStatement(t))},e.prototype.validateParam=function(e,t,n){var i="$"+n;this.context.strict?(this.scanner.isRestrictedWord(n)&&(e.stricted=t,e.message=o.Messages.StrictParamName),Object.prototype.hasOwnProperty.call(e.paramSet,i)&&(e.stricted=t,e.message=o.Messages.StrictParamDupe)):e.firstRestricted||(this.scanner.isRestrictedWord(n)?(e.firstRestricted=t,e.message=o.Messages.StrictParamName):this.scanner.isStrictModeReservedWord(n)?(e.firstRestricted=t,e.message=o.Messages.StrictReservedWord):Object.prototype.hasOwnProperty.call(e.paramSet,i)&&(e.stricted=t,e.message=o.Messages.StrictParamDupe)),"function"==typeof Object.defineProperty?Object.defineProperty(e.paramSet,i,{value:!0,enumerable:!0,writable:!0,configurable:!0}):e.paramSet[i]=!0},e.prototype.parseRestElement=function(e){var t=this.createNode();this.expect("...");var n=this.parsePattern(e);return this.match("=")&&this.throwError(o.Messages.DefaultRestParameter),this.match(")")||this.throwError(o.Messages.ParameterAfterRestParameter),this.finalize(t,new a.RestElement(n))},e.prototype.parseFormalParameter=function(e){for(var t=[],n=this.match("...")?this.parseRestElement(t):this.parsePatternWithDefault(t),i=0;i<t.length;i++)this.validateParam(e,t[i],t[i].value);e.simple=e.simple&&n instanceof a.Identifier,e.params.push(n)},e.prototype.parseFormalParameters=function(e){var t;if(t={simple:!0,params:[],firstRestricted:e},this.expect("("),!this.match(")"))for(t.paramSet={};2!==this.lookahead.type&&(this.parseFormalParameter(t),!this.match(")"))&&(this.expect(","),!this.match(")")););return this.expect(")"),{simple:t.simple,params:t.params,stricted:t.stricted,firstRestricted:t.firstRestricted,message:t.message}},e.prototype.matchAsyncFunction=function(){var e=this.matchContextualKeyword("async");if(e){var t=this.scanner.saveState();this.scanner.scanComments();var n=this.scanner.lex();this.scanner.restoreState(t),e=t.lineNumber===n.lineNumber&&4===n.type&&"function"===n.value}return e},e.prototype.parseFunctionDeclaration=function(e){var t=this.createNode(),n=this.matchContextualKeyword("async");n&&this.nextToken(),this.expectKeyword("function");var i,r=!n&&this.match("*");r&&this.nextToken();var s=null,l=null;if(!e||!this.match("(")){var u=this.lookahead;s=this.parseVariableIdentifier(),this.context.strict?this.scanner.isRestrictedWord(u.value)&&this.tolerateUnexpectedToken(u,o.Messages.StrictFunctionName):this.scanner.isRestrictedWord(u.value)?(l=u,i=o.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(u.value)&&(l=u,i=o.Messages.StrictReservedWord)}var c=this.context.await,h=this.context.allowYield;this.context.await=n,this.context.allowYield=!r;var p=this.parseFormalParameters(l),d=p.params,f=p.stricted;l=p.firstRestricted,p.message&&(i=p.message);var m=this.context.strict,g=this.context.allowStrictDirective;this.context.allowStrictDirective=p.simple;var v=this.parseFunctionSourceElements();return this.context.strict&&l&&this.throwUnexpectedToken(l,i),this.context.strict&&f&&this.tolerateUnexpectedToken(f,i),this.context.strict=m,this.context.allowStrictDirective=g,this.context.await=c,this.context.allowYield=h,n?this.finalize(t,new a.AsyncFunctionDeclaration(s,d,v)):this.finalize(t,new a.FunctionDeclaration(s,d,v,r))},e.prototype.parseFunctionExpression=function(){var e=this.createNode(),t=this.matchContextualKeyword("async");t&&this.nextToken(),this.expectKeyword("function");var n,i=!t&&this.match("*");i&&this.nextToken();var r,s=null,l=this.context.await,u=this.context.allowYield;if(this.context.await=t,this.context.allowYield=!i,!this.match("(")){var c=this.lookahead;s=this.context.strict||i||!this.matchKeyword("yield")?this.parseVariableIdentifier():this.parseIdentifierName(),this.context.strict?this.scanner.isRestrictedWord(c.value)&&this.tolerateUnexpectedToken(c,o.Messages.StrictFunctionName):this.scanner.isRestrictedWord(c.value)?(r=c,n=o.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(c.value)&&(r=c,n=o.Messages.StrictReservedWord)}var h=this.parseFormalParameters(r),p=h.params,d=h.stricted;r=h.firstRestricted,h.message&&(n=h.message);var f=this.context.strict,m=this.context.allowStrictDirective;this.context.allowStrictDirective=h.simple;var g=this.parseFunctionSourceElements();return this.context.strict&&r&&this.throwUnexpectedToken(r,n),this.context.strict&&d&&this.tolerateUnexpectedToken(d,n),this.context.strict=f,this.context.allowStrictDirective=m,this.context.await=l,this.context.allowYield=u,t?this.finalize(e,new a.AsyncFunctionExpression(s,p,g)):this.finalize(e,new a.FunctionExpression(s,p,g,i))},e.prototype.parseDirective=function(){var e=this.lookahead,t=this.createNode(),n=this.parseExpression(),i=n.type===l.Syntax.Literal?this.getTokenRaw(e).slice(1,-1):null;return this.consumeSemicolon(),this.finalize(t,i?new a.Directive(n,i):new a.ExpressionStatement(n))},e.prototype.parseDirectivePrologues=function(){for(var e=null,t=[];;){var n=this.lookahead;if(8!==n.type)break;var i=this.parseDirective();t.push(i);var r=i.directive;if("string"!=typeof r)break;"use strict"===r?(this.context.strict=!0,e&&this.tolerateUnexpectedToken(e,o.Messages.StrictOctalLiteral),this.context.allowStrictDirective||this.tolerateUnexpectedToken(n,o.Messages.IllegalLanguageModeDirective)):!e&&n.octal&&(e=n)}return t},e.prototype.qualifiedPropertyName=function(e){switch(e.type){case 3:case 8:case 1:case 5:case 6:case 4:return!0;case 7:return"["===e.value}return!1},e.prototype.parseGetterMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var n=this.parseFormalParameters();n.params.length>0&&this.tolerateError(o.Messages.BadGetterArity);var i=this.parsePropertyMethod(n);return this.context.allowYield=t,this.finalize(e,new a.FunctionExpression(null,n.params,i,!1))},e.prototype.parseSetterMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var n=this.parseFormalParameters();1!==n.params.length?this.tolerateError(o.Messages.BadSetterArity):n.params[0]instanceof a.RestElement&&this.tolerateError(o.Messages.BadSetterRestParameter);var i=this.parsePropertyMethod(n);return this.context.allowYield=t,this.finalize(e,new a.FunctionExpression(null,n.params,i,!1))},e.prototype.parseGeneratorMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var n=this.parseFormalParameters();this.context.allowYield=!1;var i=this.parsePropertyMethod(n);return this.context.allowYield=t,this.finalize(e,new a.FunctionExpression(null,n.params,i,!0))},e.prototype.isStartOfExpression=function(){var e=!0,t=this.lookahead.value;switch(this.lookahead.type){case 7:e="["===t||"("===t||"{"===t||"+"===t||"-"===t||"!"===t||"~"===t||"++"===t||"--"===t||"/"===t||"/="===t;break;case 4:e="class"===t||"delete"===t||"function"===t||"let"===t||"new"===t||"super"===t||"this"===t||"typeof"===t||"void"===t||"yield"===t}return e},e.prototype.parseYieldExpression=function(){var e=this.createNode();this.expectKeyword("yield");var t=null,n=!1;if(!this.hasLineTerminator){var i=this.context.allowYield;this.context.allowYield=!1,(n=this.match("*"))?(this.nextToken(),t=this.parseAssignmentExpression()):this.isStartOfExpression()&&(t=this.parseAssignmentExpression()),this.context.allowYield=i}return this.finalize(e,new a.YieldExpression(t,n))},e.prototype.parseClassElement=function(e){var t=this.lookahead,n=this.createNode(),i="",r=null,s=null,l=!1,u=!1,c=!1,h=!1;if(this.match("*"))this.nextToken();else if(l=this.match("["),"static"===(r=this.parseObjectPropertyKey()).name&&(this.qualifiedPropertyName(this.lookahead)||this.match("*"))&&(t=this.lookahead,c=!0,l=this.match("["),this.match("*")?this.nextToken():r=this.parseObjectPropertyKey()),3===t.type&&!this.hasLineTerminator&&"async"===t.value){var p=this.lookahead.value;":"!==p&&"("!==p&&"*"!==p&&(h=!0,t=this.lookahead,r=this.parseObjectPropertyKey(),3===t.type&&"constructor"===t.value&&this.tolerateUnexpectedToken(t,o.Messages.ConstructorIsAsync))}var d=this.qualifiedPropertyName(this.lookahead);return 3===t.type?"get"===t.value&&d?(i="get",l=this.match("["),r=this.parseObjectPropertyKey(),this.context.allowYield=!1,s=this.parseGetterMethod()):"set"===t.value&&d&&(i="set",l=this.match("["),r=this.parseObjectPropertyKey(),s=this.parseSetterMethod()):7===t.type&&"*"===t.value&&d&&(i="init",l=this.match("["),r=this.parseObjectPropertyKey(),s=this.parseGeneratorMethod(),u=!0),!i&&r&&this.match("(")&&(i="init",s=h?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),u=!0),i||this.throwUnexpectedToken(this.lookahead),"init"===i&&(i="method"),l||(c&&this.isPropertyKey(r,"prototype")&&this.throwUnexpectedToken(t,o.Messages.StaticPrototype),!c&&this.isPropertyKey(r,"constructor")&&(("method"!==i||!u||s&&s.generator)&&this.throwUnexpectedToken(t,o.Messages.ConstructorSpecialMethod),e.value?this.throwUnexpectedToken(t,o.Messages.DuplicateConstructor):e.value=!0,i="constructor")),this.finalize(n,new a.MethodDefinition(r,l,s,i,c))},e.prototype.parseClassElementList=function(){var e=[],t={value:!1};for(this.expect("{");!this.match("}");)this.match(";")?this.nextToken():e.push(this.parseClassElement(t));return this.expect("}"),e},e.prototype.parseClassBody=function(){var e=this.createNode(),t=this.parseClassElementList();return this.finalize(e,new a.ClassBody(t))},e.prototype.parseClassDeclaration=function(e){var t=this.createNode(),n=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var i=e&&3!==this.lookahead.type?null:this.parseVariableIdentifier(),r=null;this.matchKeyword("extends")&&(this.nextToken(),r=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var o=this.parseClassBody();return this.context.strict=n,this.finalize(t,new a.ClassDeclaration(i,r,o))},e.prototype.parseClassExpression=function(){var e=this.createNode(),t=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var n=3===this.lookahead.type?this.parseVariableIdentifier():null,i=null;this.matchKeyword("extends")&&(this.nextToken(),i=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var r=this.parseClassBody();return this.context.strict=t,this.finalize(e,new a.ClassExpression(n,i,r))},e.prototype.parseModule=function(){this.context.strict=!0,this.context.isModule=!0,this.scanner.isModule=!0;for(var e=this.createNode(),t=this.parseDirectivePrologues();2!==this.lookahead.type;)t.push(this.parseStatementListItem());return this.finalize(e,new a.Module(t))},e.prototype.parseScript=function(){for(var e=this.createNode(),t=this.parseDirectivePrologues();2!==this.lookahead.type;)t.push(this.parseStatementListItem());return this.finalize(e,new a.Script(t))},e.prototype.parseModuleSpecifier=function(){var e=this.createNode();8!==this.lookahead.type&&this.throwError(o.Messages.InvalidModuleSpecifier);var t=this.nextToken(),n=this.getTokenRaw(t);return this.finalize(e,new a.Literal(t.value,n))},e.prototype.parseImportSpecifier=function(){var e,t,n=this.createNode();return 3===this.lookahead.type?(t=e=this.parseVariableIdentifier(),this.matchContextualKeyword("as")&&(this.nextToken(),t=this.parseVariableIdentifier())):(t=e=this.parseIdentifierName(),this.matchContextualKeyword("as")?(this.nextToken(),t=this.parseVariableIdentifier()):this.throwUnexpectedToken(this.nextToken())),this.finalize(n,new a.ImportSpecifier(t,e))},e.prototype.parseNamedImports=function(){this.expect("{");for(var e=[];!this.match("}");)e.push(this.parseImportSpecifier()),this.match("}")||this.expect(",");return this.expect("}"),e},e.prototype.parseImportDefaultSpecifier=function(){var e=this.createNode(),t=this.parseIdentifierName();return this.finalize(e,new a.ImportDefaultSpecifier(t))},e.prototype.parseImportNamespaceSpecifier=function(){var e=this.createNode();this.expect("*"),this.matchContextualKeyword("as")||this.throwError(o.Messages.NoAsAfterImportNamespace),this.nextToken();var t=this.parseIdentifierName();return this.finalize(e,new a.ImportNamespaceSpecifier(t))},e.prototype.parseImportDeclaration=function(){this.context.inFunctionBody&&this.throwError(o.Messages.IllegalImportDeclaration);var e,t=this.createNode();this.expectKeyword("import");var n=[];if(8===this.lookahead.type)e=this.parseModuleSpecifier();else{if(this.match("{")?n=n.concat(this.parseNamedImports()):this.match("*")?n.push(this.parseImportNamespaceSpecifier()):this.isIdentifierName(this.lookahead)&&!this.matchKeyword("default")?(n.push(this.parseImportDefaultSpecifier()),this.match(",")&&(this.nextToken(),this.match("*")?n.push(this.parseImportNamespaceSpecifier()):this.match("{")?n=n.concat(this.parseNamedImports()):this.throwUnexpectedToken(this.lookahead))):this.throwUnexpectedToken(this.nextToken()),!this.matchContextualKeyword("from")){var i=this.lookahead.value?o.Messages.UnexpectedToken:o.Messages.MissingFromClause;this.throwError(i,this.lookahead.value)}this.nextToken(),e=this.parseModuleSpecifier()}return this.consumeSemicolon(),this.finalize(t,new a.ImportDeclaration(n,e))},e.prototype.parseExportSpecifier=function(){var e=this.createNode(),t=this.parseIdentifierName(),n=t;return this.matchContextualKeyword("as")&&(this.nextToken(),n=this.parseIdentifierName()),this.finalize(e,new a.ExportSpecifier(t,n))},e.prototype.parseExportDeclaration=function(){this.context.inFunctionBody&&this.throwError(o.Messages.IllegalExportDeclaration);var e,t=this.createNode();if(this.expectKeyword("export"),this.matchKeyword("default"))if(this.nextToken(),this.matchKeyword("function")){var n=this.parseFunctionDeclaration(!0);e=this.finalize(t,new a.ExportDefaultDeclaration(n))}else this.matchKeyword("class")?(n=this.parseClassDeclaration(!0),e=this.finalize(t,new a.ExportDefaultDeclaration(n))):this.matchContextualKeyword("async")?(n=this.matchAsyncFunction()?this.parseFunctionDeclaration(!0):this.parseAssignmentExpression(),e=this.finalize(t,new a.ExportDefaultDeclaration(n))):(this.matchContextualKeyword("from")&&this.throwError(o.Messages.UnexpectedToken,this.lookahead.value),n=this.match("{")?this.parseObjectInitializer():this.match("[")?this.parseArrayInitializer():this.parseAssignmentExpression(),this.consumeSemicolon(),e=this.finalize(t,new a.ExportDefaultDeclaration(n)));else if(this.match("*")){if(this.nextToken(),!this.matchContextualKeyword("from")){var i=this.lookahead.value?o.Messages.UnexpectedToken:o.Messages.MissingFromClause;this.throwError(i,this.lookahead.value)}this.nextToken();var r=this.parseModuleSpecifier();this.consumeSemicolon(),e=this.finalize(t,new a.ExportAllDeclaration(r))}else if(4===this.lookahead.type){switch(n=void 0,this.lookahead.value){case"let":case"const":n=this.parseLexicalDeclaration({inFor:!1});break;case"var":case"class":case"function":n=this.parseStatementListItem();break;default:this.throwUnexpectedToken(this.lookahead)}e=this.finalize(t,new a.ExportNamedDeclaration(n,[],null))}else if(this.matchAsyncFunction())n=this.parseFunctionDeclaration(),e=this.finalize(t,new a.ExportNamedDeclaration(n,[],null));else{var s=[],l=null,u=!1;for(this.expect("{");!this.match("}");)u=u||this.matchKeyword("default"),s.push(this.parseExportSpecifier()),this.match("}")||this.expect(",");this.expect("}"),this.matchContextualKeyword("from")?(this.nextToken(),l=this.parseModuleSpecifier(),this.consumeSemicolon()):u?(i=this.lookahead.value?o.Messages.UnexpectedToken:o.Messages.MissingFromClause,this.throwError(i,this.lookahead.value)):this.consumeSemicolon(),e=this.finalize(t,new a.ExportNamedDeclaration(null,s,l))}return e},e}();t.Parser=c},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assert=function(e,t){if(!e)throw new Error("ASSERT: "+t)}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.errors=[],this.tolerant=!1}return e.prototype.recordError=function(e){this.errors.push(e)},e.prototype.tolerate=function(e){if(!this.tolerant)throw e;this.recordError(e)},e.prototype.constructError=function(e,t){var n=new Error(e);try{throw n}catch(e){Object.create&&Object.defineProperty&&(n=Object.create(e),Object.defineProperty(n,"column",{value:t}))}return n},e.prototype.createError=function(e,t,n,i){var r="Line "+t+": "+i,o=this.constructError(r,n);return o.index=e,o.lineNumber=t,o.description=i,o},e.prototype.throwError=function(e,t,n,i){throw this.createError(e,t,n,i)},e.prototype.tolerateError=function(e,t,n,i){var r=this.createError(e,t,n,i);if(!this.tolerant)throw r;this.recordError(r)},e}();t.ErrorHandler=n},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Messages={BadGetterArity:"Getter must not have any formal parameters",BadSetterArity:"Setter must have exactly one formal parameter",BadSetterRestParameter:"Setter function argument must not be a rest parameter",ConstructorIsAsync:"Class constructor may not be an async method",ConstructorSpecialMethod:"Class constructor may not be an accessor",DeclarationMissingInitializer:"Missing initializer in %0 declaration",DefaultRestParameter:"Unexpected token =",DuplicateBinding:"Duplicate binding %0",DuplicateConstructor:"A class may only have one constructor",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ForInOfLoopInitializer:"%0 loop variable declaration may not have an initializer",GeneratorInLegacyContext:"Generator declarations are not allowed in legacy contexts",IllegalBreak:"Illegal break statement",IllegalContinue:"Illegal continue statement",IllegalExportDeclaration:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalLanguageModeDirective:"Illegal 'use strict' directive in function with non-simple parameter list",IllegalReturn:"Illegal return statement",InvalidEscapedReservedWord:"Keyword must not contain escaped characters",InvalidHexEscapeSequence:"Invalid hexadecimal escape sequence",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",InvalidModuleSpecifier:"Unexpected token",InvalidRegExp:"Invalid regular expression",LetInLexicalBinding:"let is disallowed as a lexically bound name",MissingFromClause:"Unexpected token",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NewlineAfterThrow:"Illegal newline after throw",NoAsAfterImportNamespace:"Unexpected token",NoCatchOrFinally:"Missing catch or finally after try",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",Redeclaration:"%0 '%1' has already been declared",StaticPrototype:"Classes may not have static property named prototype",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictFunction:"In strict mode code, functions can only be declared at top level or inside a block",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictModeWith:"Strict mode code may not include a with statement",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",UnexpectedEOS:"Unexpected end of input",UnexpectedIdentifier:"Unexpected identifier",UnexpectedNumber:"Unexpected number",UnexpectedReserved:"Unexpected reserved word",UnexpectedString:"Unexpected string",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedToken:"Unexpected token %0",UnexpectedTokenIllegal:"Unexpected token ILLEGAL",UnknownLabel:"Undefined label '%0'",UnterminatedRegExp:"Invalid regular expression: missing /"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),r=n(4),o=n(11);function a(e){return"0123456789abcdef".indexOf(e.toLowerCase())}function s(e){return"01234567".indexOf(e)}var l=function(){function e(e,t){this.source=e,this.errorHandler=t,this.trackComment=!1,this.isModule=!1,this.length=e.length,this.index=0,this.lineNumber=e.length>0?1:0,this.lineStart=0,this.curlyStack=[]}return e.prototype.saveState=function(){return{index:this.index,lineNumber:this.lineNumber,lineStart:this.lineStart}},e.prototype.restoreState=function(e){this.index=e.index,this.lineNumber=e.lineNumber,this.lineStart=e.lineStart},e.prototype.eof=function(){return this.index>=this.length},e.prototype.throwUnexpectedToken=function(e){return void 0===e&&(e=o.Messages.UnexpectedTokenIllegal),this.errorHandler.throwError(this.index,this.lineNumber,this.index-this.lineStart+1,e)},e.prototype.tolerateUnexpectedToken=function(e){void 0===e&&(e=o.Messages.UnexpectedTokenIllegal),this.errorHandler.tolerateError(this.index,this.lineNumber,this.index-this.lineStart+1,e)},e.prototype.skipSingleLineComment=function(e){var t,n,i=[];for(this.trackComment&&(i=[],t=this.index-e,n={start:{line:this.lineNumber,column:this.index-this.lineStart-e},end:{}});!this.eof();){var o=this.source.charCodeAt(this.index);if(++this.index,r.Character.isLineTerminator(o)){if(this.trackComment){n.end={line:this.lineNumber,column:this.index-this.lineStart-1};var a={multiLine:!1,slice:[t+e,this.index-1],range:[t,this.index-1],loc:n};i.push(a)}return 13===o&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,i}}return this.trackComment&&(n.end={line:this.lineNumber,column:this.index-this.lineStart},a={multiLine:!1,slice:[t+e,this.index],range:[t,this.index],loc:n},i.push(a)),i},e.prototype.skipMultiLineComment=function(){var e,t,n=[];for(this.trackComment&&(n=[],e=this.index-2,t={start:{line:this.lineNumber,column:this.index-this.lineStart-2},end:{}});!this.eof();){var i=this.source.charCodeAt(this.index);if(r.Character.isLineTerminator(i))13===i&&10===this.source.charCodeAt(this.index+1)&&++this.index,++this.lineNumber,++this.index,this.lineStart=this.index;else if(42===i){if(47===this.source.charCodeAt(this.index+1)){if(this.index+=2,this.trackComment){t.end={line:this.lineNumber,column:this.index-this.lineStart};var o={multiLine:!0,slice:[e+2,this.index-2],range:[e,this.index],loc:t};n.push(o)}return n}++this.index}else++this.index}return this.trackComment&&(t.end={line:this.lineNumber,column:this.index-this.lineStart},o={multiLine:!0,slice:[e+2,this.index],range:[e,this.index],loc:t},n.push(o)),this.tolerateUnexpectedToken(),n},e.prototype.scanComments=function(){var e;this.trackComment&&(e=[]);for(var t=0===this.index;!this.eof();){var n=this.source.charCodeAt(this.index);if(r.Character.isWhiteSpace(n))++this.index;else if(r.Character.isLineTerminator(n))++this.index,13===n&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,t=!0;else if(47===n)if(47===(n=this.source.charCodeAt(this.index+1))){this.index+=2;var i=this.skipSingleLineComment(2);this.trackComment&&(e=e.concat(i)),t=!0}else{if(42!==n)break;this.index+=2,i=this.skipMultiLineComment(),this.trackComment&&(e=e.concat(i))}else if(t&&45===n){if(45!==this.source.charCodeAt(this.index+1)||62!==this.source.charCodeAt(this.index+2))break;this.index+=3,i=this.skipSingleLineComment(3),this.trackComment&&(e=e.concat(i))}else{if(60!==n||this.isModule)break;if("!--"!==this.source.slice(this.index+1,this.index+4))break;this.index+=4,i=this.skipSingleLineComment(4),this.trackComment&&(e=e.concat(i))}}return e},e.prototype.isFutureReservedWord=function(e){switch(e){case"enum":case"export":case"import":case"super":return!0;default:return!1}},e.prototype.isStrictModeReservedWord=function(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}},e.prototype.isRestrictedWord=function(e){return"eval"===e||"arguments"===e},e.prototype.isKeyword=function(e){switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e||"let"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}},e.prototype.codePointAt=function(e){var t=this.source.charCodeAt(e);if(t>=55296&&t<=56319){var n=this.source.charCodeAt(e+1);n>=56320&&n<=57343&&(t=1024*(t-55296)+n-56320+65536)}return t},e.prototype.scanHexEscape=function(e){for(var t="u"===e?4:2,n=0,i=0;i<t;++i){if(this.eof()||!r.Character.isHexDigit(this.source.charCodeAt(this.index)))return null;n=16*n+a(this.source[this.index++])}return String.fromCharCode(n)},e.prototype.scanUnicodeCodePointEscape=function(){var e=this.source[this.index],t=0;for("}"===e&&this.throwUnexpectedToken();!this.eof()&&(e=this.source[this.index++],r.Character.isHexDigit(e.charCodeAt(0)));)t=16*t+a(e);return(t>1114111||"}"!==e)&&this.throwUnexpectedToken(),r.Character.fromCodePoint(t)},e.prototype.getIdentifier=function(){for(var e=this.index++;!this.eof();){var t=this.source.charCodeAt(this.index);if(92===t)return this.index=e,this.getComplexIdentifier();if(t>=55296&&t<57343)return this.index=e,this.getComplexIdentifier();if(!r.Character.isIdentifierPart(t))break;++this.index}return this.source.slice(e,this.index)},e.prototype.getComplexIdentifier=function(){var e,t=this.codePointAt(this.index),n=r.Character.fromCodePoint(t);for(this.index+=n.length,92===t&&(117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,e=this.scanUnicodeCodePointEscape()):null!==(e=this.scanHexEscape("u"))&&"\\"!==e&&r.Character.isIdentifierStart(e.charCodeAt(0))||this.throwUnexpectedToken(),n=e);!this.eof()&&(t=this.codePointAt(this.index),r.Character.isIdentifierPart(t));)n+=e=r.Character.fromCodePoint(t),this.index+=e.length,92===t&&(n=n.substr(0,n.length-1),117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,e=this.scanUnicodeCodePointEscape()):null!==(e=this.scanHexEscape("u"))&&"\\"!==e&&r.Character.isIdentifierPart(e.charCodeAt(0))||this.throwUnexpectedToken(),n+=e);return n},e.prototype.octalToDecimal=function(e){var t="0"!==e,n=s(e);return!this.eof()&&r.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(t=!0,n=8*n+s(this.source[this.index++]),"0123".indexOf(e)>=0&&!this.eof()&&r.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(n=8*n+s(this.source[this.index++]))),{code:n,octal:t}},e.prototype.scanIdentifier=function(){var e,t=this.index,n=92===this.source.charCodeAt(t)?this.getComplexIdentifier():this.getIdentifier();if(3!=(e=1===n.length?3:this.isKeyword(n)?4:"null"===n?5:"true"===n||"false"===n?1:3)&&t+n.length!==this.index){var i=this.index;this.index=t,this.tolerateUnexpectedToken(o.Messages.InvalidEscapedReservedWord),this.index=i}return{type:e,value:n,lineNumber:this.lineNumber,lineStart:this.lineStart,start:t,end:this.index}},e.prototype.scanPunctuator=function(){var e=this.index,t=this.source[this.index];switch(t){case"(":case"{":"{"===t&&this.curlyStack.push("{"),++this.index;break;case".":++this.index,"."===this.source[this.index]&&"."===this.source[this.index+1]&&(this.index+=2,t="...");break;case"}":++this.index,this.curlyStack.pop();break;case")":case";":case",":case"[":case"]":case":":case"?":case"~":++this.index;break;default:">>>="===(t=this.source.substr(this.index,4))?this.index+=4:"==="===(t=t.substr(0,3))||"!=="===t||">>>"===t||"<<="===t||">>="===t||"**="===t?this.index+=3:"&&"===(t=t.substr(0,2))||"||"===t||"=="===t||"!="===t||"+="===t||"-="===t||"*="===t||"/="===t||"++"===t||"--"===t||"<<"===t||">>"===t||"&="===t||"|="===t||"^="===t||"%="===t||"<="===t||">="===t||"=>"===t||"**"===t?this.index+=2:(t=this.source[this.index],"<>=!+-*%&|^/".indexOf(t)>=0&&++this.index)}return this.index===e&&this.throwUnexpectedToken(),{type:7,value:t,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanHexLiteral=function(e){for(var t="";!this.eof()&&r.Character.isHexDigit(this.source.charCodeAt(this.index));)t+=this.source[this.index++];return 0===t.length&&this.throwUnexpectedToken(),r.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseInt("0x"+t,16),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanBinaryLiteral=function(e){for(var t,n="";!this.eof()&&("0"===(t=this.source[this.index])||"1"===t);)n+=this.source[this.index++];return 0===n.length&&this.throwUnexpectedToken(),this.eof()||(t=this.source.charCodeAt(this.index),(r.Character.isIdentifierStart(t)||r.Character.isDecimalDigit(t))&&this.throwUnexpectedToken()),{type:6,value:parseInt(n,2),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanOctalLiteral=function(e,t){var n="",i=!1;for(r.Character.isOctalDigit(e.charCodeAt(0))?(i=!0,n="0"+this.source[this.index++]):++this.index;!this.eof()&&r.Character.isOctalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];return i||0!==n.length||this.throwUnexpectedToken(),(r.Character.isIdentifierStart(this.source.charCodeAt(this.index))||r.Character.isDecimalDigit(this.source.charCodeAt(this.index)))&&this.throwUnexpectedToken(),{type:6,value:parseInt(n,8),octal:i,lineNumber:this.lineNumber,lineStart:this.lineStart,start:t,end:this.index}},e.prototype.isImplicitOctalLiteral=function(){for(var e=this.index+1;e<this.length;++e){var t=this.source[e];if("8"===t||"9"===t)return!1;if(!r.Character.isOctalDigit(t.charCodeAt(0)))return!0}return!0},e.prototype.scanNumericLiteral=function(){var e=this.index,t=this.source[e];i.assert(r.Character.isDecimalDigit(t.charCodeAt(0))||"."===t,"Numeric literal must start with a decimal digit or a decimal point");var n="";if("."!==t){if(n=this.source[this.index++],t=this.source[this.index],"0"===n){if("x"===t||"X"===t)return++this.index,this.scanHexLiteral(e);if("b"===t||"B"===t)return++this.index,this.scanBinaryLiteral(e);if("o"===t||"O"===t)return this.scanOctalLiteral(t,e);if(t&&r.Character.isOctalDigit(t.charCodeAt(0))&&this.isImplicitOctalLiteral())return this.scanOctalLiteral(t,e)}for(;r.Character.isDecimalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];t=this.source[this.index]}if("."===t){for(n+=this.source[this.index++];r.Character.isDecimalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];t=this.source[this.index]}if("e"===t||"E"===t)if(n+=this.source[this.index++],"+"!==(t=this.source[this.index])&&"-"!==t||(n+=this.source[this.index++]),r.Character.isDecimalDigit(this.source.charCodeAt(this.index)))for(;r.Character.isDecimalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];else this.throwUnexpectedToken();return r.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseFloat(n),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanStringLiteral=function(){var e=this.index,t=this.source[e];i.assert("'"===t||'"'===t,"String literal must starts with a quote"),++this.index;for(var n=!1,a="";!this.eof();){var s=this.source[this.index++];if(s===t){t="";break}if("\\"===s)if((s=this.source[this.index++])&&r.Character.isLineTerminator(s.charCodeAt(0)))++this.lineNumber,"\r"===s&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(s){case"u":if("{"===this.source[this.index])++this.index,a+=this.scanUnicodeCodePointEscape();else{var l=this.scanHexEscape(s);null===l&&this.throwUnexpectedToken(),a+=l}break;case"x":var u=this.scanHexEscape(s);null===u&&this.throwUnexpectedToken(o.Messages.InvalidHexEscapeSequence),a+=u;break;case"n":a+="\n";break;case"r":a+="\r";break;case"t":a+="\t";break;case"b":a+="\b";break;case"f":a+="\f";break;case"v":a+="\v";break;case"8":case"9":a+=s,this.tolerateUnexpectedToken();break;default:if(s&&r.Character.isOctalDigit(s.charCodeAt(0))){var c=this.octalToDecimal(s);n=c.octal||n,a+=String.fromCharCode(c.code)}else a+=s}else{if(r.Character.isLineTerminator(s.charCodeAt(0)))break;a+=s}}return""!==t&&(this.index=e,this.throwUnexpectedToken()),{type:8,value:a,octal:n,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanTemplate=function(){var e="",t=!1,n=this.index,i="`"===this.source[n],a=!1,s=2;for(++this.index;!this.eof();){var l=this.source[this.index++];if("`"===l){s=1,a=!0,t=!0;break}if("$"===l){if("{"===this.source[this.index]){this.curlyStack.push("${"),++this.index,t=!0;break}e+=l}else if("\\"===l)if(l=this.source[this.index++],r.Character.isLineTerminator(l.charCodeAt(0)))++this.lineNumber,"\r"===l&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(l){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"u":if("{"===this.source[this.index])++this.index,e+=this.scanUnicodeCodePointEscape();else{var u=this.index,c=this.scanHexEscape(l);null!==c?e+=c:(this.index=u,e+=l)}break;case"x":var h=this.scanHexEscape(l);null===h&&this.throwUnexpectedToken(o.Messages.InvalidHexEscapeSequence),e+=h;break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:"0"===l?(r.Character.isDecimalDigit(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(o.Messages.TemplateOctalLiteral),e+="\0"):r.Character.isOctalDigit(l.charCodeAt(0))?this.throwUnexpectedToken(o.Messages.TemplateOctalLiteral):e+=l}else r.Character.isLineTerminator(l.charCodeAt(0))?(++this.lineNumber,"\r"===l&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index,e+="\n"):e+=l}return t||this.throwUnexpectedToken(),i||this.curlyStack.pop(),{type:10,value:this.source.slice(n+1,this.index-s),cooked:e,head:i,tail:a,lineNumber:this.lineNumber,lineStart:this.lineStart,start:n,end:this.index}},e.prototype.testRegExp=function(e,t){var n=e,i=this;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}|\\u([a-fA-F0-9]{4})/g,(function(e,t,n){var r=parseInt(t||n,16);return r>1114111&&i.throwUnexpectedToken(o.Messages.InvalidRegExp),r<=65535?String.fromCharCode(r):"￿"})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"￿"));try{RegExp(n)}catch(e){this.throwUnexpectedToken(o.Messages.InvalidRegExp)}try{return new RegExp(e,t)}catch(e){return null}},e.prototype.scanRegExpBody=function(){var e=this.source[this.index];i.assert("/"===e,"Regular expression literal must start with a slash");for(var t=this.source[this.index++],n=!1,a=!1;!this.eof();)if(t+=e=this.source[this.index++],"\\"===e)e=this.source[this.index++],r.Character.isLineTerminator(e.charCodeAt(0))&&this.throwUnexpectedToken(o.Messages.UnterminatedRegExp),t+=e;else if(r.Character.isLineTerminator(e.charCodeAt(0)))this.throwUnexpectedToken(o.Messages.UnterminatedRegExp);else if(n)"]"===e&&(n=!1);else{if("/"===e){a=!0;break}"["===e&&(n=!0)}return a||this.throwUnexpectedToken(o.Messages.UnterminatedRegExp),t.substr(1,t.length-2)},e.prototype.scanRegExpFlags=function(){for(var e="";!this.eof();){var t=this.source[this.index];if(!r.Character.isIdentifierPart(t.charCodeAt(0)))break;if(++this.index,"\\"!==t||this.eof())e+=t;else if("u"===(t=this.source[this.index])){++this.index;var n=this.index,i=this.scanHexEscape("u");if(null!==i)for(e+=i;n<this.index;++n)this.source[n];else this.index=n,e+="u";this.tolerateUnexpectedToken()}else this.tolerateUnexpectedToken()}return e},e.prototype.scanRegExp=function(){var e=this.index,t=this.scanRegExpBody(),n=this.scanRegExpFlags();return{type:9,value:"",pattern:t,flags:n,regex:this.testRegExp(t,n),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.lex=function(){if(this.eof())return{type:2,value:"",lineNumber:this.lineNumber,lineStart:this.lineStart,start:this.index,end:this.index};var e=this.source.charCodeAt(this.index);return r.Character.isIdentifierStart(e)?this.scanIdentifier():40===e||41===e||59===e?this.scanPunctuator():39===e||34===e?this.scanStringLiteral():46===e?r.Character.isDecimalDigit(this.source.charCodeAt(this.index+1))?this.scanNumericLiteral():this.scanPunctuator():r.Character.isDecimalDigit(e)?this.scanNumericLiteral():96===e||125===e&&"${"===this.curlyStack[this.curlyStack.length-1]?this.scanTemplate():e>=55296&&e<57343&&r.Character.isIdentifierStart(this.codePointAt(this.index))?this.scanIdentifier():this.scanPunctuator()},e}();t.Scanner=l},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenName={},t.TokenName[1]="Boolean",t.TokenName[2]="<end>",t.TokenName[3]="Identifier",t.TokenName[4]="Keyword",t.TokenName[5]="Null",t.TokenName[6]="Numeric",t.TokenName[7]="Punctuator",t.TokenName[8]="String",t.TokenName[9]="RegularExpression",t.TokenName[10]="Template"},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XHTMLEntities={quot:'"',amp:"&",apos:"'",gt:">",nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",times:"×",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",divide:"÷",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",fnof:"ƒ",circ:"ˆ",tilde:"˜",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",bull:"•",hellip:"…",permil:"‰",prime:"′",Prime:"″",lsaquo:"‹",rsaquo:"›",oline:"‾",frasl:"⁄",euro:"€",image:"ℑ",weierp:"℘",real:"ℜ",trade:"™",alefsym:"ℵ",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lArr:"⇐",uArr:"⇑",rArr:"⇒",dArr:"⇓",hArr:"⇔",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦",lang:"⟨",rang:"⟩"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),r=n(12),o=n(13),a=function(){function e(){this.values=[],this.curly=this.paren=-1}return e.prototype.beforeFunctionExpression=function(e){return["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","**=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","**","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="].indexOf(e)>=0},e.prototype.isRegexStart=function(){var e=this.values[this.values.length-1],t=null!==e;switch(e){case"this":case"]":t=!1;break;case")":var n=this.values[this.paren-1];t="if"===n||"while"===n||"for"===n||"with"===n;break;case"}":if(t=!1,"function"===this.values[this.curly-3])t=!!(i=this.values[this.curly-4])&&!this.beforeFunctionExpression(i);else if("function"===this.values[this.curly-4]){var i;t=!(i=this.values[this.curly-5])||!this.beforeFunctionExpression(i)}}return t},e.prototype.push=function(e){7===e.type||4===e.type?("{"===e.value?this.curly=this.values.length:"("===e.value&&(this.paren=this.values.length),this.values.push(e.value)):this.values.push(null)},e}(),s=function(){function e(e,t){this.errorHandler=new i.ErrorHandler,this.errorHandler.tolerant=!!t&&"boolean"==typeof t.tolerant&&t.tolerant,this.scanner=new r.Scanner(e,this.errorHandler),this.scanner.trackComment=!!t&&"boolean"==typeof t.comment&&t.comment,this.trackRange=!!t&&"boolean"==typeof t.range&&t.range,this.trackLoc=!!t&&"boolean"==typeof t.loc&&t.loc,this.buffer=[],this.reader=new a}return e.prototype.errors=function(){return this.errorHandler.errors},e.prototype.getNextToken=function(){if(0===this.buffer.length){var e=this.scanner.scanComments();if(this.scanner.trackComment)for(var t=0;t<e.length;++t){var n=e[t],i=this.scanner.source.slice(n.slice[0],n.slice[1]),r={type:n.multiLine?"BlockComment":"LineComment",value:i};this.trackRange&&(r.range=n.range),this.trackLoc&&(r.loc=n.loc),this.buffer.push(r)}if(!this.scanner.eof()){var a=void 0;this.trackLoc&&(a={start:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},end:{}});var s="/"===this.scanner.source[this.scanner.index]&&this.reader.isRegexStart()?this.scanner.scanRegExp():this.scanner.lex();this.reader.push(s);var l={type:o.TokenName[s.type],value:this.scanner.source.slice(s.start,s.end)};if(this.trackRange&&(l.range=[s.start,s.end]),this.trackLoc&&(a.end={line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},l.loc=a),9===s.type){var u=s.pattern,c=s.flags;l.regex={pattern:u,flags:c}}this.buffer.push(l)}}return this.buffer.shift()},e}();t.Tokenizer=s}])},e.exports=i()},"./node_modules/estraverse/estraverse.js":
/*!***********************************************!*\
  !*** ./node_modules/estraverse/estraverse.js ***!
  \***********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,n){!function e(t){"use strict";var i,r,o,a,s,l;function u(e){var t,n,i={};for(t in e)e.hasOwnProperty(t)&&(n=e[t],i[t]="object"==typeof n&&null!==n?u(n):n);return i}function c(e,t){this.parent=e,this.key=t}function h(e,t,n,i){this.node=e,this.path=t,this.wrap=n,this.ref=i}function p(){}function d(e){return null!=e&&"object"==typeof e&&"string"==typeof e.type}function f(e,t){return(e===i.ObjectExpression||e===i.ObjectPattern)&&"properties"===t}function m(e,t){return(new p).traverse(e,t)}function g(e,t){var n;return n=function(e,t){var n,i,r,o;for(i=e.length,r=0;i;)t(e[o=r+(n=i>>>1)])?i=n:(r=o+1,i-=n+1);return r}(t,(function(t){return t.range[0]>e.range[0]})),e.extendedRange=[e.range[0],e.range[1]],n!==t.length&&(e.extendedRange[1]=t[n].range[0]),(n-=1)>=0&&(e.extendedRange[0]=t[n].range[1]),e}return i={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportExpression:"ImportExpression",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"},o={AssignmentExpression:["left","right"],AssignmentPattern:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","body"],AwaitExpression:["argument"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ClassBody:["body"],ClassDeclaration:["id","superClass","body"],ClassExpression:["id","superClass","body"],ComprehensionBlock:["left","right"],ComprehensionExpression:["blocks","filter","body"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExportAllDeclaration:["source"],ExportDefaultDeclaration:["declaration"],ExportNamedDeclaration:["declaration","specifiers","source"],ExportSpecifier:["exported","local"],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","body"],FunctionExpression:["id","params","body"],GeneratorExpression:["blocks","filter","body"],Identifier:[],IfStatement:["test","consequent","alternate"],ImportExpression:["source"],ImportDeclaration:["specifiers","source"],ImportDefaultSpecifier:["local"],ImportNamespaceSpecifier:["local"],ImportSpecifier:["imported","local"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MetaProperty:["meta","property"],MethodDefinition:["key","value"],ModuleSpecifier:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],Program:["body"],Property:["key","value"],RestElement:["argument"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SpreadElement:["argument"],Super:[],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],TaggedTemplateExpression:["tag","quasi"],TemplateElement:[],TemplateLiteral:["quasis","expressions"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handler","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]},r={Break:a={},Skip:s={},Remove:l={}},c.prototype.replace=function(e){this.parent[this.key]=e},c.prototype.remove=function(){return Array.isArray(this.parent)?(this.parent.splice(this.key,1),!0):(this.replace(null),!1)},p.prototype.path=function(){var e,t,n,i,r;function o(e,t){if(Array.isArray(t))for(n=0,i=t.length;n<i;++n)e.push(t[n]);else e.push(t)}if(!this.__current.path)return null;for(r=[],e=2,t=this.__leavelist.length;e<t;++e)o(r,this.__leavelist[e].path);return o(r,this.__current.path),r},p.prototype.type=function(){return this.current().type||this.__current.wrap},p.prototype.parents=function(){var e,t,n;for(n=[],e=1,t=this.__leavelist.length;e<t;++e)n.push(this.__leavelist[e].node);return n},p.prototype.current=function(){return this.__current.node},p.prototype.__execute=function(e,t){var n,i;return i=void 0,n=this.__current,this.__current=t,this.__state=null,e&&(i=e.call(this,t.node,this.__leavelist[this.__leavelist.length-1].node)),this.__current=n,i},p.prototype.notify=function(e){this.__state=e},p.prototype.skip=function(){this.notify(s)},p.prototype.break=function(){this.notify(a)},p.prototype.remove=function(){this.notify(l)},p.prototype.__initialize=function(e,t){this.visitor=t,this.root=e,this.__worklist=[],this.__leavelist=[],this.__current=null,this.__state=null,this.__fallback=null,"iteration"===t.fallback?this.__fallback=Object.keys:"function"==typeof t.fallback&&(this.__fallback=t.fallback),this.__keys=o,t.keys&&(this.__keys=Object.assign(Object.create(this.__keys),t.keys))},p.prototype.traverse=function(e,t){var n,i,r,o,l,u,c,p,m,g,v,y;for(this.__initialize(e,t),y={},n=this.__worklist,i=this.__leavelist,n.push(new h(e,null,null,null)),i.push(new h(null,null,null,null));n.length;)if((r=n.pop())!==y){if(r.node){if(u=this.__execute(t.enter,r),this.__state===a||u===a)return;if(n.push(y),i.push(r),this.__state===s||u===s)continue;if(l=(o=r.node).type||r.wrap,!(g=this.__keys[l])){if(!this.__fallback)throw new Error("Unknown node type "+l+".");g=this.__fallback(o)}for(p=g.length;(p-=1)>=0;)if(v=o[c=g[p]])if(Array.isArray(v)){for(m=v.length;(m-=1)>=0;)if(v[m]){if(f(l,g[p]))r=new h(v[m],[c,m],"Property",null);else{if(!d(v[m]))continue;r=new h(v[m],[c,m],null,null)}n.push(r)}}else d(v)&&n.push(new h(v,c,null,null))}}else if(r=i.pop(),u=this.__execute(t.leave,r),this.__state===a||u===a)return},p.prototype.replace=function(e,t){var n,i,r,o,u,p,m,g,v,y,b,_,x;function E(e){var t,i,r,o;if(e.ref.remove())for(i=e.ref.key,o=e.ref.parent,t=n.length;t--;)if((r=n[t]).ref&&r.ref.parent===o){if(r.ref.key<i)break;--r.ref.key}}for(this.__initialize(e,t),b={},n=this.__worklist,i=this.__leavelist,p=new h(e,null,null,new c(_={root:e},"root")),n.push(p),i.push(p);n.length;)if((p=n.pop())!==b){if(void 0!==(u=this.__execute(t.enter,p))&&u!==a&&u!==s&&u!==l&&(p.ref.replace(u),p.node=u),this.__state!==l&&u!==l||(E(p),p.node=null),this.__state===a||u===a)return _.root;if((r=p.node)&&(n.push(b),i.push(p),this.__state!==s&&u!==s)){if(o=r.type||p.wrap,!(v=this.__keys[o])){if(!this.__fallback)throw new Error("Unknown node type "+o+".");v=this.__fallback(r)}for(m=v.length;(m-=1)>=0;)if(y=r[x=v[m]])if(Array.isArray(y)){for(g=y.length;(g-=1)>=0;)if(y[g]){if(f(o,v[m]))p=new h(y[g],[x,g],"Property",new c(y,g));else{if(!d(y[g]))continue;p=new h(y[g],[x,g],null,new c(y,g))}n.push(p)}}else d(y)&&n.push(new h(y,x,null,new c(r,x)))}}else if(p=i.pop(),void 0!==(u=this.__execute(t.leave,p))&&u!==a&&u!==s&&u!==l&&p.ref.replace(u),this.__state!==l&&u!==l||E(p),this.__state===a||u===a)return _.root;return _.root},t.version=n(/*! ./package.json */"./node_modules/estraverse/package.json").version,t.Syntax=i,t.traverse=m,t.replace=function(e,t){return(new p).replace(e,t)},t.attachComments=function(e,t,n){var i,o,a,s,l=[];if(!e.range)throw new Error("attachComments needs range information");if(!n.length){if(t.length){for(a=0,o=t.length;a<o;a+=1)(i=u(t[a])).extendedRange=[0,e.range[0]],l.push(i);e.leadingComments=l}return e}for(a=0,o=t.length;a<o;a+=1)l.push(g(u(t[a]),n));return s=0,m(e,{enter:function(e){for(var t;s<l.length&&!((t=l[s]).extendedRange[1]>e.range[0]);)t.extendedRange[1]===e.range[0]?(e.leadingComments||(e.leadingComments=[]),e.leadingComments.push(t),l.splice(s,1)):s+=1;return s===l.length?r.Break:l[s].extendedRange[0]>e.range[1]?r.Skip:void 0}}),s=0,m(e,{leave:function(e){for(var t;s<l.length&&(t=l[s],!(e.range[1]<t.extendedRange[0]));)e.range[1]===t.extendedRange[0]?(e.trailingComments||(e.trailingComments=[]),e.trailingComments.push(t),l.splice(s,1)):s+=1;return s===l.length?r.Break:l[s].extendedRange[0]>e.range[1]?r.Skip:void 0}}),e},t.VisitorKeys=o,t.VisitorOption=r,t.Controller=p,t.cloneEnvironment=function(){return e({})},t}(t)},"./node_modules/estraverse/package.json":
/*!**********************************************!*\
  !*** ./node_modules/estraverse/package.json ***!
  \**********************************************/
/*! exports provided: _from, _id, _inBundle, _integrity, _location, _phantomChildren, _requested, _requiredBy, _resolved, _shasum, _spec, _where, bugs, bundleDependencies, deprecated, description, devDependencies, engines, homepage, license, main, maintainers, name, repository, scripts, version, default */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e){e.exports=JSON.parse('{"_from":"estraverse@^4.1.1","_id":"estraverse@4.3.0","_inBundle":false,"_integrity":"sha512-39nnKffWz8xN1BU/2c79n9nB9HDzo0niYUqx6xyqUnyoAnQyyWpOTdZEeiCch8BBu515t4wp9ZmgVfVhn9EBpw==","_location":"/estraverse","_phantomChildren":{},"_requested":{"type":"range","registry":true,"raw":"estraverse@^4.1.1","name":"estraverse","escapedName":"estraverse","rawSpec":"^4.1.1","saveSpec":null,"fetchSpec":"^4.1.1"},"_requiredBy":["/eslint-scope","/esquery","/esrecurse"],"_resolved":"https://registry.npmjs.org/estraverse/-/estraverse-4.3.0.tgz","_shasum":"398ad3f3c5a24948be7725e83d11a7de28cdbd1d","_spec":"estraverse@^4.1.1","_where":"D:\\\\SourceCodes\\\\THING.EVAL\\\\node_modules\\\\eslint-scope","bugs":{"url":"https://github.com/estools/estraverse/issues"},"bundleDependencies":false,"deprecated":false,"description":"ECMAScript JS AST traversal functions","devDependencies":{"babel-preset-env":"^1.6.1","babel-register":"^6.3.13","chai":"^2.1.1","espree":"^1.11.0","gulp":"^3.8.10","gulp-bump":"^0.2.2","gulp-filter":"^2.0.0","gulp-git":"^1.0.1","gulp-tag-version":"^1.3.0","jshint":"^2.5.6","mocha":"^2.1.0"},"engines":{"node":">=4.0"},"homepage":"https://github.com/estools/estraverse","license":"BSD-2-Clause","main":"estraverse.js","maintainers":[{"name":"Yusuke Suzuki","email":"utatane.tea@gmail.com","url":"http://github.com/Constellation"}],"name":"estraverse","repository":{"type":"git","url":"git+ssh://git@github.com/estools/estraverse.git"},"scripts":{"lint":"jshint estraverse.js","test":"npm run-script lint && npm run-script unit-test","unit-test":"mocha --compilers js:babel-register"},"version":"4.3.0"}')},"./node_modules/esutils/lib/ast.js":
/*!*****************************************!*\
  !*** ./node_modules/esutils/lib/ast.js ***!
  \*****************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){!function(){"use strict";function t(e){if(null==e)return!1;switch(e.type){case"BlockStatement":case"BreakStatement":case"ContinueStatement":case"DebuggerStatement":case"DoWhileStatement":case"EmptyStatement":case"ExpressionStatement":case"ForInStatement":case"ForStatement":case"IfStatement":case"LabeledStatement":case"ReturnStatement":case"SwitchStatement":case"ThrowStatement":case"TryStatement":case"VariableDeclaration":case"WhileStatement":case"WithStatement":return!0}return!1}function n(e){switch(e.type){case"IfStatement":return null!=e.alternate?e.alternate:e.consequent;case"LabeledStatement":case"ForStatement":case"ForInStatement":case"WhileStatement":case"WithStatement":return e.body}return null}e.exports={isExpression:function(e){if(null==e)return!1;switch(e.type){case"ArrayExpression":case"AssignmentExpression":case"BinaryExpression":case"CallExpression":case"ConditionalExpression":case"FunctionExpression":case"Identifier":case"Literal":case"LogicalExpression":case"MemberExpression":case"NewExpression":case"ObjectExpression":case"SequenceExpression":case"ThisExpression":case"UnaryExpression":case"UpdateExpression":return!0}return!1},isStatement:t,isIterationStatement:function(e){if(null==e)return!1;switch(e.type){case"DoWhileStatement":case"ForInStatement":case"ForStatement":case"WhileStatement":return!0}return!1},isSourceElement:function(e){return t(e)||null!=e&&"FunctionDeclaration"===e.type},isProblematicIfStatement:function(e){var t;if("IfStatement"!==e.type)return!1;if(null==e.alternate)return!1;t=e.consequent;do{if("IfStatement"===t.type&&null==t.alternate)return!0;t=n(t)}while(t);return!1},trailingStatement:n}}()},"./node_modules/esutils/lib/code.js":
/*!******************************************!*\
  !*** ./node_modules/esutils/lib/code.js ***!
  \******************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){!function(){"use strict";var t,n,i,r,o,a;function s(e){return e<=65535?String.fromCharCode(e):String.fromCharCode(Math.floor((e-65536)/1024)+55296)+String.fromCharCode((e-65536)%1024+56320)}for(n={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,NonAsciiIdentifierPart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/},t={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/},i=[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279],r=new Array(128),a=0;a<128;++a)r[a]=a>=97&&a<=122||a>=65&&a<=90||36===a||95===a;for(o=new Array(128),a=0;a<128;++a)o[a]=a>=97&&a<=122||a>=65&&a<=90||a>=48&&a<=57||36===a||95===a;e.exports={isDecimalDigit:function(e){return 48<=e&&e<=57},isHexDigit:function(e){return 48<=e&&e<=57||97<=e&&e<=102||65<=e&&e<=70},isOctalDigit:function(e){return e>=48&&e<=55},isWhiteSpace:function(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&i.indexOf(e)>=0},isLineTerminator:function(e){return 10===e||13===e||8232===e||8233===e},isIdentifierStartES5:function(e){return e<128?r[e]:n.NonAsciiIdentifierStart.test(s(e))},isIdentifierPartES5:function(e){return e<128?o[e]:n.NonAsciiIdentifierPart.test(s(e))},isIdentifierStartES6:function(e){return e<128?r[e]:t.NonAsciiIdentifierStart.test(s(e))},isIdentifierPartES6:function(e){return e<128?o[e]:t.NonAsciiIdentifierPart.test(s(e))}}}()},"./node_modules/esutils/lib/keyword.js":
/*!*********************************************!*\
  !*** ./node_modules/esutils/lib/keyword.js ***!
  \*********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,n){!function(){"use strict";var t=n(/*! ./code */"./node_modules/esutils/lib/code.js");function i(e,t){return!(!t&&"yield"===e)&&r(e,t)}function r(e,t){if(t&&function(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"let":return!0;default:return!1}}(e))return!0;switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}}function o(e,t){return"null"===e||"true"===e||"false"===e||i(e,t)}function a(e,t){return"null"===e||"true"===e||"false"===e||r(e,t)}function s(e){var n,i,r;if(0===e.length)return!1;if(r=e.charCodeAt(0),!t.isIdentifierStartES5(r))return!1;for(n=1,i=e.length;n<i;++n)if(r=e.charCodeAt(n),!t.isIdentifierPartES5(r))return!1;return!0}function l(e){var n,i,r,o,a;if(0===e.length)return!1;for(a=t.isIdentifierStartES6,n=0,i=e.length;n<i;++n){if(55296<=(r=e.charCodeAt(n))&&r<=56319){if(++n>=i)return!1;if(!(56320<=(o=e.charCodeAt(n))&&o<=57343))return!1;r=1024*(r-55296)+(o-56320)+65536}if(!a(r))return!1;a=t.isIdentifierPartES6}return!0}e.exports={isKeywordES5:i,isKeywordES6:r,isReservedWordES5:o,isReservedWordES6:a,isRestrictedWord:function(e){return"eval"===e||"arguments"===e},isIdentifierNameES5:s,isIdentifierNameES6:l,isIdentifierES5:function(e,t){return s(e)&&!o(e,t)},isIdentifierES6:function(e,t){return l(e)&&!a(e,t)}}}()},"./node_modules/esutils/lib/utils.js":
/*!*******************************************!*\
  !*** ./node_modules/esutils/lib/utils.js ***!
  \*******************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,n){!function(){"use strict";t.ast=n(/*! ./ast */"./node_modules/esutils/lib/ast.js"),t.code=n(/*! ./code */"./node_modules/esutils/lib/code.js"),t.keyword=n(/*! ./keyword */"./node_modules/esutils/lib/keyword.js")}()},"./node_modules/source-map/lib/array-set.js":
/*!**************************************************!*\
  !*** ./node_modules/source-map/lib/array-set.js ***!
  \**************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,n){var i=n(/*! ./util */"./node_modules/source-map/lib/util.js"),r=Object.prototype.hasOwnProperty,o="undefined"!=typeof Map;function a(){this._array=[],this._set=o?new Map:Object.create(null)}a.fromArray=function(e,t){for(var n=new a,i=0,r=e.length;i<r;i++)n.add(e[i],t);return n},a.prototype.size=function(){return o?this._set.size:Object.getOwnPropertyNames(this._set).length},a.prototype.add=function(e,t){var n=o?e:i.toSetString(e),a=o?this.has(e):r.call(this._set,n),s=this._array.length;a&&!t||this._array.push(e),a||(o?this._set.set(e,s):this._set[n]=s)},a.prototype.has=function(e){if(o)return this._set.has(e);var t=i.toSetString(e);return r.call(this._set,t)},a.prototype.indexOf=function(e){if(o){var t=this._set.get(e);if(t>=0)return t}else{var n=i.toSetString(e);if(r.call(this._set,n))return this._set[n]}throw new Error('"'+e+'" is not in the set.')},a.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},a.prototype.toArray=function(){return this._array.slice()},t.ArraySet=a},"./node_modules/source-map/lib/base64-vlq.js":
/*!***************************************************!*\
  !*** ./node_modules/source-map/lib/base64-vlq.js ***!
  \***************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,n){var i=n(/*! ./base64 */"./node_modules/source-map/lib/base64.js");t.encode=function(e){var t,n="",r=function(e){return e<0?1+(-e<<1):0+(e<<1)}(e);do{t=31&r,(r>>>=5)>0&&(t|=32),n+=i.encode(t)}while(r>0);return n},t.decode=function(e,t,n){var r,o,a,s,l=e.length,u=0,c=0;do{if(t>=l)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(o=i.decode(e.charCodeAt(t++))))throw new Error("Invalid base64 digit: "+e.charAt(t-1));r=!!(32&o),u+=(o&=31)<<c,c+=5}while(r);n.value=(s=(a=u)>>1,1==(1&a)?-s:s),n.rest=t}},"./node_modules/source-map/lib/base64.js":
/*!***********************************************!*\
  !*** ./node_modules/source-map/lib/base64.js ***!
  \***********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");t.encode=function(e){if(0<=e&&e<n.length)return n[e];throw new TypeError("Must be between 0 and 63: "+e)},t.decode=function(e){return 65<=e&&e<=90?e-65:97<=e&&e<=122?e-97+26:48<=e&&e<=57?e-48+52:43==e?62:47==e?63:-1}},"./node_modules/source-map/lib/binary-search.js":
/*!******************************************************!*\
  !*** ./node_modules/source-map/lib/binary-search.js ***!
  \******************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2,t.search=function(e,n,i,r){if(0===n.length)return-1;var o=function e(n,i,r,o,a,s){var l=Math.floor((i-n)/2)+n,u=a(r,o[l],!0);return 0===u?l:u>0?i-l>1?e(l,i,r,o,a,s):s==t.LEAST_UPPER_BOUND?i<o.length?i:-1:l:l-n>1?e(n,l,r,o,a,s):s==t.LEAST_UPPER_BOUND?l:n<0?-1:n}(-1,n.length,e,n,i,r||t.GREATEST_LOWER_BOUND);if(o<0)return-1;for(;o-1>=0&&0===i(n[o],n[o-1],!0);)--o;return o}},"./node_modules/source-map/lib/mapping-list.js":
/*!*****************************************************!*\
  !*** ./node_modules/source-map/lib/mapping-list.js ***!
  \*****************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,n){var i=n(/*! ./util */"./node_modules/source-map/lib/util.js");function r(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}r.prototype.unsortedForEach=function(e,t){this._array.forEach(e,t)},r.prototype.add=function(e){var t,n,r,o,a,s;n=e,r=(t=this._last).generatedLine,o=n.generatedLine,a=t.generatedColumn,s=n.generatedColumn,o>r||o==r&&s>=a||i.compareByGeneratedPositionsInflated(t,n)<=0?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))},r.prototype.toArray=function(){return this._sorted||(this._array.sort(i.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},t.MappingList=r},"./node_modules/source-map/lib/quick-sort.js":
/*!***************************************************!*\
  !*** ./node_modules/source-map/lib/quick-sort.js ***!
  \***************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){function n(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}t.quickSort=function(e,t){!function e(t,i,r,o){if(r<o){var a=r-1;n(t,(c=r,h=o,Math.round(c+Math.random()*(h-c))),o);for(var s=t[o],l=r;l<o;l++)i(t[l],s)<=0&&n(t,a+=1,l);n(t,a+1,l);var u=a+1;e(t,i,r,u-1),e(t,i,u+1,o)}var c,h}(e,t,0,e.length-1)}},"./node_modules/source-map/lib/source-map-consumer.js":
/*!************************************************************!*\
  !*** ./node_modules/source-map/lib/source-map-consumer.js ***!
  \************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,n){var i=n(/*! ./util */"./node_modules/source-map/lib/util.js"),r=n(/*! ./binary-search */"./node_modules/source-map/lib/binary-search.js"),o=n(/*! ./array-set */"./node_modules/source-map/lib/array-set.js").ArraySet,a=n(/*! ./base64-vlq */"./node_modules/source-map/lib/base64-vlq.js"),s=n(/*! ./quick-sort */"./node_modules/source-map/lib/quick-sort.js").quickSort;function l(e,t){var n=e;return"string"==typeof e&&(n=i.parseSourceMapInput(e)),null!=n.sections?new h(n,t):new u(n,t)}function u(e,t){var n=e;"string"==typeof e&&(n=i.parseSourceMapInput(e));var r=i.getArg(n,"version"),a=i.getArg(n,"sources"),s=i.getArg(n,"names",[]),l=i.getArg(n,"sourceRoot",null),u=i.getArg(n,"sourcesContent",null),c=i.getArg(n,"mappings"),h=i.getArg(n,"file",null);if(r!=this._version)throw new Error("Unsupported version: "+r);l&&(l=i.normalize(l)),a=a.map(String).map(i.normalize).map((function(e){return l&&i.isAbsolute(l)&&i.isAbsolute(e)?i.relative(l,e):e})),this._names=o.fromArray(s.map(String),!0),this._sources=o.fromArray(a,!0),this._absoluteSources=this._sources.toArray().map((function(e){return i.computeSourceURL(l,e,t)})),this.sourceRoot=l,this.sourcesContent=u,this._mappings=c,this._sourceMapURL=t,this.file=h}function c(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function h(e,t){var n=e;"string"==typeof e&&(n=i.parseSourceMapInput(e));var r=i.getArg(n,"version"),a=i.getArg(n,"sections");if(r!=this._version)throw new Error("Unsupported version: "+r);this._sources=new o,this._names=new o;var s={line:-1,column:0};this._sections=a.map((function(e){if(e.url)throw new Error("Support for url field in sections not implemented.");var n=i.getArg(e,"offset"),r=i.getArg(n,"line"),o=i.getArg(n,"column");if(r<s.line||r===s.line&&o<s.column)throw new Error("Section offsets must be ordered and non-overlapping.");return s=n,{generatedOffset:{generatedLine:r+1,generatedColumn:o+1},consumer:new l(i.getArg(e,"map"),t)}}))}l.fromSourceMap=function(e,t){return u.fromSourceMap(e,t)},l.prototype._version=3,l.prototype.__generatedMappings=null,Object.defineProperty(l.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),l.prototype.__originalMappings=null,Object.defineProperty(l.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),l.prototype._charIsMappingSeparator=function(e,t){var n=e.charAt(t);return";"===n||","===n},l.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")},l.GENERATED_ORDER=1,l.ORIGINAL_ORDER=2,l.GREATEST_LOWER_BOUND=1,l.LEAST_UPPER_BOUND=2,l.prototype.eachMapping=function(e,t,n){var r,o=t||null;switch(n||l.GENERATED_ORDER){case l.GENERATED_ORDER:r=this._generatedMappings;break;case l.ORIGINAL_ORDER:r=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var a=this.sourceRoot;r.map((function(e){var t=null===e.source?null:this._sources.at(e.source);return{source:t=i.computeSourceURL(a,t,this._sourceMapURL),generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:null===e.name?null:this._names.at(e.name)}}),this).forEach(e,o)},l.prototype.allGeneratedPositionsFor=function(e){var t=i.getArg(e,"line"),n={source:i.getArg(e,"source"),originalLine:t,originalColumn:i.getArg(e,"column",0)};if(n.source=this._findSourceIndex(n.source),n.source<0)return[];var o=[],a=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",i.compareByOriginalPositions,r.LEAST_UPPER_BOUND);if(a>=0){var s=this._originalMappings[a];if(void 0===e.column)for(var l=s.originalLine;s&&s.originalLine===l;)o.push({line:i.getArg(s,"generatedLine",null),column:i.getArg(s,"generatedColumn",null),lastColumn:i.getArg(s,"lastGeneratedColumn",null)}),s=this._originalMappings[++a];else for(var u=s.originalColumn;s&&s.originalLine===t&&s.originalColumn==u;)o.push({line:i.getArg(s,"generatedLine",null),column:i.getArg(s,"generatedColumn",null),lastColumn:i.getArg(s,"lastGeneratedColumn",null)}),s=this._originalMappings[++a]}return o},t.SourceMapConsumer=l,u.prototype=Object.create(l.prototype),u.prototype.consumer=l,u.prototype._findSourceIndex=function(e){var t,n=e;if(null!=this.sourceRoot&&(n=i.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(t=0;t<this._absoluteSources.length;++t)if(this._absoluteSources[t]==e)return t;return-1},u.fromSourceMap=function(e,t){var n=Object.create(u.prototype),r=n._names=o.fromArray(e._names.toArray(),!0),a=n._sources=o.fromArray(e._sources.toArray(),!0);n.sourceRoot=e._sourceRoot,n.sourcesContent=e._generateSourcesContent(n._sources.toArray(),n.sourceRoot),n.file=e._file,n._sourceMapURL=t,n._absoluteSources=n._sources.toArray().map((function(e){return i.computeSourceURL(n.sourceRoot,e,t)}));for(var l=e._mappings.toArray().slice(),h=n.__generatedMappings=[],p=n.__originalMappings=[],d=0,f=l.length;d<f;d++){var m=l[d],g=new c;g.generatedLine=m.generatedLine,g.generatedColumn=m.generatedColumn,m.source&&(g.source=a.indexOf(m.source),g.originalLine=m.originalLine,g.originalColumn=m.originalColumn,m.name&&(g.name=r.indexOf(m.name)),p.push(g)),h.push(g)}return s(n.__originalMappings,i.compareByOriginalPositions),n},u.prototype._version=3,Object.defineProperty(u.prototype,"sources",{get:function(){return this._absoluteSources.slice()}}),u.prototype._parseMappings=function(e,t){for(var n,r,o,l,u,h=1,p=0,d=0,f=0,m=0,g=0,v=e.length,y=0,b={},_={},x=[],E=[];y<v;)if(";"===e.charAt(y))h++,y++,p=0;else if(","===e.charAt(y))y++;else{for((n=new c).generatedLine=h,l=y;l<v&&!this._charIsMappingSeparator(e,l);l++);if(o=b[r=e.slice(y,l)])y+=r.length;else{for(o=[];y<l;)a.decode(e,y,_),u=_.value,y=_.rest,o.push(u);if(2===o.length)throw new Error("Found a source, but no line and column");if(3===o.length)throw new Error("Found a source and line, but no column");b[r]=o}n.generatedColumn=p+o[0],p=n.generatedColumn,o.length>1&&(n.source=m+o[1],m+=o[1],n.originalLine=d+o[2],d=n.originalLine,n.originalLine+=1,n.originalColumn=f+o[3],f=n.originalColumn,o.length>4&&(n.name=g+o[4],g+=o[4])),E.push(n),"number"==typeof n.originalLine&&x.push(n)}s(E,i.compareByGeneratedPositionsDeflated),this.__generatedMappings=E,s(x,i.compareByOriginalPositions),this.__originalMappings=x},u.prototype._findMapping=function(e,t,n,i,o,a){if(e[n]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[n]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return r.search(e,t,o,a)},u.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var n=this._generatedMappings[e+1];if(t.generatedLine===n.generatedLine){t.lastGeneratedColumn=n.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},u.prototype.originalPositionFor=function(e){var t={generatedLine:i.getArg(e,"line"),generatedColumn:i.getArg(e,"column")},n=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",i.compareByGeneratedPositionsDeflated,i.getArg(e,"bias",l.GREATEST_LOWER_BOUND));if(n>=0){var r=this._generatedMappings[n];if(r.generatedLine===t.generatedLine){var o=i.getArg(r,"source",null);null!==o&&(o=this._sources.at(o),o=i.computeSourceURL(this.sourceRoot,o,this._sourceMapURL));var a=i.getArg(r,"name",null);return null!==a&&(a=this._names.at(a)),{source:o,line:i.getArg(r,"originalLine",null),column:i.getArg(r,"originalColumn",null),name:a}}}return{source:null,line:null,column:null,name:null}},u.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some((function(e){return null==e}))},u.prototype.sourceContentFor=function(e,t){if(!this.sourcesContent)return null;var n=this._findSourceIndex(e);if(n>=0)return this.sourcesContent[n];var r,o=e;if(null!=this.sourceRoot&&(o=i.relative(this.sourceRoot,o)),null!=this.sourceRoot&&(r=i.urlParse(this.sourceRoot))){var a=o.replace(/^file:\/\//,"");if("file"==r.scheme&&this._sources.has(a))return this.sourcesContent[this._sources.indexOf(a)];if((!r.path||"/"==r.path)&&this._sources.has("/"+o))return this.sourcesContent[this._sources.indexOf("/"+o)]}if(t)return null;throw new Error('"'+o+'" is not in the SourceMap.')},u.prototype.generatedPositionFor=function(e){var t=i.getArg(e,"source");if((t=this._findSourceIndex(t))<0)return{line:null,column:null,lastColumn:null};var n={source:t,originalLine:i.getArg(e,"line"),originalColumn:i.getArg(e,"column")},r=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",i.compareByOriginalPositions,i.getArg(e,"bias",l.GREATEST_LOWER_BOUND));if(r>=0){var o=this._originalMappings[r];if(o.source===n.source)return{line:i.getArg(o,"generatedLine",null),column:i.getArg(o,"generatedColumn",null),lastColumn:i.getArg(o,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},t.BasicSourceMapConsumer=u,h.prototype=Object.create(l.prototype),h.prototype.constructor=l,h.prototype._version=3,Object.defineProperty(h.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var n=0;n<this._sections[t].consumer.sources.length;n++)e.push(this._sections[t].consumer.sources[n]);return e}}),h.prototype.originalPositionFor=function(e){var t={generatedLine:i.getArg(e,"line"),generatedColumn:i.getArg(e,"column")},n=r.search(t,this._sections,(function(e,t){return e.generatedLine-t.generatedOffset.generatedLine||e.generatedColumn-t.generatedOffset.generatedColumn})),o=this._sections[n];return o?o.consumer.originalPositionFor({line:t.generatedLine-(o.generatedOffset.generatedLine-1),column:t.generatedColumn-(o.generatedOffset.generatedLine===t.generatedLine?o.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}},h.prototype.hasContentsOfAllSources=function(){return this._sections.every((function(e){return e.consumer.hasContentsOfAllSources()}))},h.prototype.sourceContentFor=function(e,t){for(var n=0;n<this._sections.length;n++){var i=this._sections[n].consumer.sourceContentFor(e,!0);if(i)return i}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},h.prototype.generatedPositionFor=function(e){for(var t=0;t<this._sections.length;t++){var n=this._sections[t];if(-1!==n.consumer._findSourceIndex(i.getArg(e,"source"))){var r=n.consumer.generatedPositionFor(e);if(r)return{line:r.line+(n.generatedOffset.generatedLine-1),column:r.column+(n.generatedOffset.generatedLine===r.line?n.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},h.prototype._parseMappings=function(e,t){this.__generatedMappings=[],this.__originalMappings=[];for(var n=0;n<this._sections.length;n++)for(var r=this._sections[n],o=r.consumer._generatedMappings,a=0;a<o.length;a++){var l=o[a],u=r.consumer._sources.at(l.source);u=i.computeSourceURL(r.consumer.sourceRoot,u,this._sourceMapURL),this._sources.add(u),u=this._sources.indexOf(u);var c=null;l.name&&(c=r.consumer._names.at(l.name),this._names.add(c),c=this._names.indexOf(c));var h={source:u,generatedLine:l.generatedLine+(r.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(r.generatedOffset.generatedLine===l.generatedLine?r.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:c};this.__generatedMappings.push(h),"number"==typeof h.originalLine&&this.__originalMappings.push(h)}s(this.__generatedMappings,i.compareByGeneratedPositionsDeflated),s(this.__originalMappings,i.compareByOriginalPositions)},t.IndexedSourceMapConsumer=h},"./node_modules/source-map/lib/source-map-generator.js":
/*!*************************************************************!*\
  !*** ./node_modules/source-map/lib/source-map-generator.js ***!
  \*************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,n){var i=n(/*! ./base64-vlq */"./node_modules/source-map/lib/base64-vlq.js"),r=n(/*! ./util */"./node_modules/source-map/lib/util.js"),o=n(/*! ./array-set */"./node_modules/source-map/lib/array-set.js").ArraySet,a=n(/*! ./mapping-list */"./node_modules/source-map/lib/mapping-list.js").MappingList;function s(e){e||(e={}),this._file=r.getArg(e,"file",null),this._sourceRoot=r.getArg(e,"sourceRoot",null),this._skipValidation=r.getArg(e,"skipValidation",!1),this._sources=new o,this._names=new o,this._mappings=new a,this._sourcesContents=null}s.prototype._version=3,s.fromSourceMap=function(e){var t=e.sourceRoot,n=new s({file:e.file,sourceRoot:t});return e.eachMapping((function(e){var i={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(i.source=e.source,null!=t&&(i.source=r.relative(t,i.source)),i.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(i.name=e.name)),n.addMapping(i)})),e.sources.forEach((function(i){var o=i;null!==t&&(o=r.relative(t,i)),n._sources.has(o)||n._sources.add(o);var a=e.sourceContentFor(i);null!=a&&n.setSourceContent(i,a)})),n},s.prototype.addMapping=function(e){var t=r.getArg(e,"generated"),n=r.getArg(e,"original",null),i=r.getArg(e,"source",null),o=r.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,n,i,o),null!=i&&(i=String(i),this._sources.has(i)||this._sources.add(i)),null!=o&&(o=String(o),this._names.has(o)||this._names.add(o)),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:null!=n&&n.line,originalColumn:null!=n&&n.column,source:i,name:o})},s.prototype.setSourceContent=function(e,t){var n=e;null!=this._sourceRoot&&(n=r.relative(this._sourceRoot,n)),null!=t?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[r.toSetString(n)]=t):this._sourcesContents&&(delete this._sourcesContents[r.toSetString(n)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},s.prototype.applySourceMap=function(e,t,n){var i=t;if(null==t){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');i=e.file}var a=this._sourceRoot;null!=a&&(i=r.relative(a,i));var s=new o,l=new o;this._mappings.unsortedForEach((function(t){if(t.source===i&&null!=t.originalLine){var o=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=o.source&&(t.source=o.source,null!=n&&(t.source=r.join(n,t.source)),null!=a&&(t.source=r.relative(a,t.source)),t.originalLine=o.line,t.originalColumn=o.column,null!=o.name&&(t.name=o.name))}var u=t.source;null==u||s.has(u)||s.add(u);var c=t.name;null==c||l.has(c)||l.add(c)}),this),this._sources=s,this._names=l,e.sources.forEach((function(t){var i=e.sourceContentFor(t);null!=i&&(null!=n&&(t=r.join(n,t)),null!=a&&(t=r.relative(a,t)),this.setSourceContent(t,i))}),this)},s.prototype._validateMapping=function(e,t,n,i){if(t&&"number"!=typeof t.line&&"number"!=typeof t.column)throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if((!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0)||t||n||i)&&!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&n))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:n,original:t,name:i}))},s.prototype._serializeMappings=function(){for(var e,t,n,o,a=0,s=1,l=0,u=0,c=0,h=0,p="",d=this._mappings.toArray(),f=0,m=d.length;f<m;f++){if(e="",(t=d[f]).generatedLine!==s)for(a=0;t.generatedLine!==s;)e+=";",s++;else if(f>0){if(!r.compareByGeneratedPositionsInflated(t,d[f-1]))continue;e+=","}e+=i.encode(t.generatedColumn-a),a=t.generatedColumn,null!=t.source&&(o=this._sources.indexOf(t.source),e+=i.encode(o-h),h=o,e+=i.encode(t.originalLine-1-u),u=t.originalLine-1,e+=i.encode(t.originalColumn-l),l=t.originalColumn,null!=t.name&&(n=this._names.indexOf(t.name),e+=i.encode(n-c),c=n)),p+=e}return p},s.prototype._generateSourcesContent=function(e,t){return e.map((function(e){if(!this._sourcesContents)return null;null!=t&&(e=r.relative(t,e));var n=r.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,n)?this._sourcesContents[n]:null}),this)},s.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e},s.prototype.toString=function(){return JSON.stringify(this.toJSON())},t.SourceMapGenerator=s},"./node_modules/source-map/lib/source-node.js":
/*!****************************************************!*\
  !*** ./node_modules/source-map/lib/source-node.js ***!
  \****************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,n){var i=n(/*! ./source-map-generator */"./node_modules/source-map/lib/source-map-generator.js").SourceMapGenerator,r=n(/*! ./util */"./node_modules/source-map/lib/util.js"),o=/(\r?\n)/,a="$$$isSourceNode$$$";function s(e,t,n,i,r){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==n?null:n,this.name=null==r?null:r,this[a]=!0,null!=i&&this.add(i)}s.fromStringWithSourceMap=function(e,t,n){var i=new s,a=e.split(o),l=0,u=function(){return e()+(e()||"");function e(){return l<a.length?a[l++]:void 0}},c=1,h=0,p=null;return t.eachMapping((function(e){if(null!==p){if(!(c<e.generatedLine)){var t=(n=a[l]||"").substr(0,e.generatedColumn-h);return a[l]=n.substr(e.generatedColumn-h),h=e.generatedColumn,d(p,t),void(p=e)}d(p,u()),c++,h=0}for(;c<e.generatedLine;)i.add(u()),c++;if(h<e.generatedColumn){var n=a[l]||"";i.add(n.substr(0,e.generatedColumn)),a[l]=n.substr(e.generatedColumn),h=e.generatedColumn}p=e}),this),l<a.length&&(p&&d(p,u()),i.add(a.splice(l).join(""))),t.sources.forEach((function(e){var o=t.sourceContentFor(e);null!=o&&(null!=n&&(e=r.join(n,e)),i.setSourceContent(e,o))})),i;function d(e,t){if(null===e||void 0===e.source)i.add(t);else{var o=n?r.join(n,e.source):e.source;i.add(new s(e.originalLine,e.originalColumn,o,t,e.name))}}},s.prototype.add=function(e){if(Array.isArray(e))e.forEach((function(e){this.add(e)}),this);else{if(!e[a]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this},s.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[a]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this},s.prototype.walk=function(e){for(var t,n=0,i=this.children.length;n<i;n++)(t=this.children[n])[a]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})},s.prototype.join=function(e){var t,n,i=this.children.length;if(i>0){for(t=[],n=0;n<i-1;n++)t.push(this.children[n]),t.push(e);t.push(this.children[n]),this.children=t}return this},s.prototype.replaceRight=function(e,t){var n=this.children[this.children.length-1];return n[a]?n.replaceRight(e,t):"string"==typeof n?this.children[this.children.length-1]=n.replace(e,t):this.children.push("".replace(e,t)),this},s.prototype.setSourceContent=function(e,t){this.sourceContents[r.toSetString(e)]=t},s.prototype.walkSourceContents=function(e){for(var t=0,n=this.children.length;t<n;t++)this.children[t][a]&&this.children[t].walkSourceContents(e);var i=Object.keys(this.sourceContents);for(t=0,n=i.length;t<n;t++)e(r.fromSetString(i[t]),this.sourceContents[i[t]])},s.prototype.toString=function(){var e="";return this.walk((function(t){e+=t})),e},s.prototype.toStringWithSourceMap=function(e){var t={code:"",line:1,column:0},n=new i(e),r=!1,o=null,a=null,s=null,l=null;return this.walk((function(e,i){t.code+=e,null!==i.source&&null!==i.line&&null!==i.column?(o===i.source&&a===i.line&&s===i.column&&l===i.name||n.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:t.line,column:t.column},name:i.name}),o=i.source,a=i.line,s=i.column,l=i.name,r=!0):r&&(n.addMapping({generated:{line:t.line,column:t.column}}),o=null,r=!1);for(var u=0,c=e.length;u<c;u++)10===e.charCodeAt(u)?(t.line++,t.column=0,u+1===c?(o=null,r=!1):r&&n.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:t.line,column:t.column},name:i.name})):t.column++})),this.walkSourceContents((function(e,t){n.setSourceContent(e,t)})),{code:t.code,map:n}},t.SourceNode=s},"./node_modules/source-map/lib/util.js":
/*!*********************************************!*\
  !*** ./node_modules/source-map/lib/util.js ***!
  \*********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){t.getArg=function(e,t,n){if(t in e)return e[t];if(3===arguments.length)return n;throw new Error('"'+t+'" is a required argument.')};var n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,i=/^data:.+\,.+$/;function r(e){var t=e.match(n);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function o(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function a(e){var n=e,i=r(e);if(i){if(!i.path)return e;n=i.path}for(var a,s=t.isAbsolute(n),l=n.split(/\/+/),u=0,c=l.length-1;c>=0;c--)"."===(a=l[c])?l.splice(c,1):".."===a?u++:u>0&&(""===a?(l.splice(c+1,u),u=0):(l.splice(c,2),u--));return""===(n=l.join("/"))&&(n=s?"/":"."),i?(i.path=n,o(i)):n}function s(e,t){""===e&&(e="."),""===t&&(t=".");var n=r(t),s=r(e);if(s&&(e=s.path||"/"),n&&!n.scheme)return s&&(n.scheme=s.scheme),o(n);if(n||t.match(i))return t;if(s&&!s.host&&!s.path)return s.host=t,o(s);var l="/"===t.charAt(0)?t:a(e.replace(/\/+$/,"")+"/"+t);return s?(s.path=l,o(s)):l}t.urlParse=r,t.urlGenerate=o,t.normalize=a,t.join=s,t.isAbsolute=function(e){return"/"===e.charAt(0)||n.test(e)},t.relative=function(e,t){""===e&&(e="."),e=e.replace(/\/$/,"");for(var n=0;0!==t.indexOf(e+"/");){var i=e.lastIndexOf("/");if(i<0)return t;if((e=e.slice(0,i)).match(/^([^\/]+:\/)?\/*$/))return t;++n}return Array(n+1).join("../")+t.substr(e.length+1)};var l=!("__proto__"in Object.create(null));function u(e){return e}function c(e){if(!e)return!1;var t=e.length;if(t<9)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(var n=t-10;n>=0;n--)if(36!==e.charCodeAt(n))return!1;return!0}function h(e,t){return e===t?0:null===e?1:null===t?-1:e>t?1:-1}t.toSetString=l?u:function(e){return c(e)?"$"+e:e},t.fromSetString=l?u:function(e){return c(e)?e.slice(1):e},t.compareByOriginalPositions=function(e,t,n){var i=h(e.source,t.source);return 0!==i||0!=(i=e.originalLine-t.originalLine)||0!=(i=e.originalColumn-t.originalColumn)||n||0!=(i=e.generatedColumn-t.generatedColumn)||0!=(i=e.generatedLine-t.generatedLine)?i:h(e.name,t.name)},t.compareByGeneratedPositionsDeflated=function(e,t,n){var i=e.generatedLine-t.generatedLine;return 0!==i||0!=(i=e.generatedColumn-t.generatedColumn)||n||0!==(i=h(e.source,t.source))||0!=(i=e.originalLine-t.originalLine)||0!=(i=e.originalColumn-t.originalColumn)?i:h(e.name,t.name)},t.compareByGeneratedPositionsInflated=function(e,t){var n=e.generatedLine-t.generatedLine;return 0!==n||0!=(n=e.generatedColumn-t.generatedColumn)||0!==(n=h(e.source,t.source))||0!=(n=e.originalLine-t.originalLine)||0!=(n=e.originalColumn-t.originalColumn)?n:h(e.name,t.name)},t.parseSourceMapInput=function(e){return JSON.parse(e.replace(/^\)]}'[^\n]*\n/,""))},t.computeSourceURL=function(e,t,n){if(t=t||"",e&&("/"!==e[e.length-1]&&"/"!==t[0]&&(e+="/"),t=e+t),n){var i=r(n);if(!i)throw new Error("sourceMapURL could not be parsed");if(i.path){var l=i.path.lastIndexOf("/");l>=0&&(i.path=i.path.substring(0,l+1))}t=s(o(i),t)}return a(t)}},"./node_modules/source-map/source-map.js":
/*!***********************************************!*\
  !*** ./node_modules/source-map/source-map.js ***!
  \***********************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,n){t.SourceMapGenerator=n(/*! ./lib/source-map-generator */"./node_modules/source-map/lib/source-map-generator.js").SourceMapGenerator,t.SourceMapConsumer=n(/*! ./lib/source-map-consumer */"./node_modules/source-map/lib/source-map-consumer.js").SourceMapConsumer,t.SourceNode=n(/*! ./lib/source-node */"./node_modules/source-map/lib/source-node.js").SourceNode},"./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},"./src/eval/index.js":
/*!***************************!*\
  !*** ./src/eval/index.js ***!
  \***************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,n){var i=n(/*! escodegen */"./node_modules/escodegen/escodegen.js").generate;e.exports=function(e,t){t||(t={});var n={},r=function e(r,o){if("Literal"===r.type)return r.value;if("UnaryExpression"===r.type){var a=e(r.argument);return"+"===r.operator?+a:"-"===r.operator?-a:"~"===r.operator?~a:"!"===r.operator?!a:n}if("ArrayExpression"===r.type){for(var s=[],l=0,u=r.elements.length;l<u;l++){if((v=e(r.elements[l]))===n)return n;s.push(v)}return s}if("ObjectExpression"===r.type){var c={};for(l=0;l<r.properties.length;l++){var h=null===(y=r.properties[l]).value?y.value:e(y.value);if(h===n)return n;c[y.key.value||y.key.name]=h}return c}if("BinaryExpression"===r.type||"LogicalExpression"===r.type){if((u=e(r.left))===n)return n;var p=e(r.right);if(p===n)return n;var d=r.operator;return"=="===d?u==p:"==="===d?u===p:"!="===d?u!=p:"!=="===d?u!==p:"+"===d?u+p:"-"===d?u-p:"*"===d?u*p:"/"===d?u/p:"%"===d?u%p:"<"===d?u<p:"<="===d?u<=p:">"===d?u>p:">="===d?u>=p:"|"===d?u|p:"&"===d?u&p:"^"===d?u^p:"&&"===d?u&&p:"||"===d?u||p:n}if("Identifier"===r.type)return{}.hasOwnProperty.call(t,r.name)?t[r.name]:n;if("ThisExpression"===r.type)return{}.hasOwnProperty.call(t,"this")?t.this:n;if("CallExpression"===r.type){var f=e(r.callee);if(f===n)return n;if("function"!=typeof f)return n;var m=r.callee.object?e(r.callee.object):n;m===n&&(m=null);var g=[];for(l=0,u=r.arguments.length;l<u;l++){var v;if((v=e(r.arguments[l]))===n)return n;g.push(v)}return f.apply(m,g)}var y;if("MemberExpression"===r.type)return(c=e(r.object))===n||"function"==typeof c?n:"Identifier"===r.property.type?c[r.property.name]:(y=e(r.property))===n?n:c[y];if("ConditionalExpression"===r.type)return(a=e(r.test))===n?n:e(a?r.consequent:r.alternate);if("ExpressionStatement"===r.type)return(a=e(r.expression))===n?n:a;if("ReturnStatement"===r.type)return e(r.argument);if("FunctionExpression"===r.type){var b=r.body.body,_={};for(Object.keys(t).forEach((function(e){_[e]=t[e]})),l=0;l<r.params.length;l++){var x=r.params[l];if("Identifier"!=x.type)return n;t[x.name]=null}for(var l in b)if(e(b[l])===n)return n;t=_;var E=Object.keys(t),w=E.map((function(e){return t[e]}));return Function(E.join(", "),"return "+i(r)).apply(null,w)}if("TemplateLiteral"===r.type){var T="";for(l=0;l<r.expressions.length;l++)T+=e(r.quasis[l]),T+=e(r.expressions[l]);return T+e(r.quasis[l])}if("TaggedTemplateExpression"===r.type){var M=e(r.tag),S=r.quasi,C=S.quasis.map(e),A=S.expressions.map(e);return M.apply(null,[C].concat(A))}return"TemplateElement"===r.type?r.value.cooked:n}(e);return r===n?void 0:r}},"./src/main.js":
/*!*********************************!*\
  !*** ./src/main.js + 1 modules ***!
  \*********************************/
/*! no exports provided */
/*! all exports used */function(e,t,n){"use strict";n.r(t);var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(/*! ./ */"./src/eval/index.js"),o=n(/*! esprima */"./node_modules/esprima/dist/esprima.js").parse,a=function(){function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.expression=o(t).body[0].expression,this}return i(e,[{key:"evaluate",value:function(e){return e=e||{},r(this.expression,e)}}]),e}();window.THING=window.THING||{},window.THING.Plugins=window.THING.Plugins||{},window.THING.Plugins.EVAL={Eval:a}},0:
/*!***************************!*\
  !*** multi ./src/main.js ***!
  \***************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,n){e.exports=n(/*! ./src/main.js */"./src/main.js")}}),function(){"use strict";var e="undefined"!=typeof require,t=this.THREE||e&&require("three");if(!t)throw new Error("MeshLine requires three.js");var n=n||t;function i(){this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this.geometry=new t.BufferGeometry,this.widthCallback=null}function r(e,t,n,i,r){var o;if(e=e.subarray||e.slice?e:e.buffer,n=n.subarray||n.slice?n:n.buffer,e=t?e.subarray?e.subarray(t,r&&t+r):e.slice(t,r&&t+r):e,n.set)n.set(e,i);else for(o=0;o<e.length;o++)n[o+i]=e[o];return n}function o(e){function n(e,t){return void 0===e?t:e}t.Material.call(this),e=e||{},this.lineWidth=n(e.lineWidth,1),this.map=n(e.map,null),this.useMap=n(e.useMap,0),this.alphaMap=n(e.alphaMap,null),this.useAlphaMap=n(e.useAlphaMap,0),this.color=n(e.color,new t.Color(16777215)),this.opacity=n(e.opacity,1),this.resolution=n(e.resolution,new t.Vector2(1,1)),this.sizeAttenuation=n(e.sizeAttenuation,1),this.near=n(e.near,1),this.far=n(e.far,1),this.logDepthBufFC=n(e.logDepthBufFC,1),this.dashArray=n(e.dashArray,[]),this.useDash=this.dashArray!==[]?1:0,this.visibility=n(e.visibility,1),this.alphaTest=n(e.alphaTest,0);var i=new t.ShaderMaterial({uniforms:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new t.Color(16777215)},fogAlpha:{value:1},lineWidth:{type:"f",value:this.lineWidth},map:{type:"t",value:this.map},useMap:{type:"f",value:this.useMap},alphaMap:{type:"t",value:this.alphaMap},useAlphaMap:{type:"f",value:this.useAlphaMap},color:{type:"c",value:this.color},opacity:{type:"f",value:this.opacity},resolution:{type:"v2",value:this.resolution},sizeAttenuation:{type:"f",value:this.sizeAttenuation},near:{type:"f",value:this.near},far:{type:"f",value:this.far},dashArray:{type:"v2",value:new t.Vector2(this.dashArray[0],this.dashArray[1])},useDash:{type:"f",value:this.useDash},visibility:{type:"f",value:this.visibility},alphaTest:{type:"f",value:this.alphaTest},logDepthBufFC:{type:"f",value:this.logDepthBufFC},uvTransform:{type:"m3",value:this.map?this.map.matrix:new t.Matrix3},uv2Transform:{type:"m3",value:this.alphaMap?this.alphaMap.matrix:new t.Matrix3}},vertexShader:["precision highp float;","","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","#include <logdepthbuf_pars_vertex>","#include <fog_pars_vertex>","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float near;","uniform float far;","uniform float sizeAttenuation;","uniform mat3 uvTransform;","uniform mat3 uv2Transform;","#ifdef USE_GPUPICKER","uniform float baseId;","varying vec4 worldId;","#endif","","varying vec2 vUV;","varying vec2 vUV2;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","#define EPSILON 1e-6","","void main() {","","    float aspect = resolution.x / resolution.y;","\t float pixelWidthRatio = 1. / (resolution.x * projectionMatrix[0][0]);","","    vColor = vec4( color, opacity );","    //vUV = uv;","    vUV = ( uvTransform * vec3( uv, 1 ) ).xy;","    vUV2 = ( uv2Transform * vec3( uv, 1 ) ).xy;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","\t float pixelWidth = finalPosition.w * pixelWidthRatio;","    float w = 1.8 * pixelWidth * lineWidth * width;","","    if( sizeAttenuation == 1. ) {","        w = 1.8 * lineWidth * width;","    }","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","        w = w / max(dot( miter, perp ), 0.2);","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec2 normal = vec2( -dir.y, dir.x );","    normal.x /= aspect;","    normal *= .5 * w;","","    vec4 offset = vec4( normal * side, 0.0, 1.0 );","    finalPosition.xy += offset.xy;","","#ifdef USE_GPUPICKER","vec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * baseId);","a -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);","worldId = vec4(a,1);","#endif","","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#include <fog_vertex>","    gl_Position = finalPosition;","    #include <logdepthbuf_vertex>","","}"].join("\r\n"),fragmentShader:["precision mediump float;","","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform vec2 dashArray;","uniform float visibility;","uniform float alphaTest;","","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","","varying vec2 vUV;","varying vec2 vUV2;","varying vec4 vColor;","varying float vCounters;","#ifdef USE_GPUPICKER","varying vec4 worldId;","#endif","#include <common>","","void main() {","","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV2 ).a;","\t if( c.a < alphaTest ) discard;","\t if( useDash == 1. ){","\t \t ","\t }","    gl_FragColor = c;","#include <logdepthbuf_fragment>","\t gl_FragColor.a *= step(vCounters,visibility);","#include <fog_fragment>","\t #ifdef USE_GPUPICKER","\t \tgl_FragColor = worldId;","\t #endif","}"].join("\r\n"),defines:{USE_GPUPICKER:!1,USE_LOGDEPTHBUF:!1,USE_LOGDEPTHBUF_EXT:!1},fog:!0});return delete e.lineWidth,delete e.map,delete e.useMap,delete e.alphaMap,delete e.useAlphaMap,delete e.color,delete e.opacity,delete e.resolution,delete e.sizeAttenuation,delete e.near,delete e.far,delete e.dashArray,delete e.visibility,delete e.alphaTest,delete e.repeat,i.type="MeshLineMaterial",i.setValues(e),i}i.prototype.setGeometry=function(e,n){if(this.widthCallback=n,this.positions=[],this.counters=[],e instanceof t.Geometry)for(var i=0;i<e.vertices.length;i++){var r=e.vertices[i];n=i/e.vertices.length;this.positions.push(r.x,r.y,r.z),this.positions.push(r.x,r.y,r.z),this.counters.push(n),this.counters.push(n)}if(t.BufferGeometry,e instanceof Float32Array||e instanceof Array)for(i=0;i<e.length;i+=3){n=i/e.length;this.positions.push(e[i],e[i+1],e[i+2]),this.positions.push(e[i],e[i+1],e[i+2]),this.counters.push(n),this.counters.push(n)}this.process()},i.prototype.compareV3=function(e,t){var n=6*e,i=6*t;return this.positions[n]===this.positions[i]&&this.positions[n+1]===this.positions[i+1]&&this.positions[n+2]===this.positions[i+2]},i.prototype.copyV3=function(e){var t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]},i.prototype.process=function(){var e,n,i=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];for(var r=0;r<i;r++)this.side.push(1),this.side.push(-1);for(r=0;r<i;r++)e=this.widthCallback?this.widthCallback(r/(i-1)):1,this.width.push(e),this.width.push(e);for(r=0;r<i;r++)this.uvs.push(r/(i-1),0),this.uvs.push(r/(i-1),1);n=this.compareV3(0,i-1)?this.copyV3(i-2):this.copyV3(0),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);for(r=0;r<i-1;r++)n=this.copyV3(r),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);for(r=1;r<i;r++)n=this.copyV3(r),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]);n=this.compareV3(i-1,0)?this.copyV3(1):this.copyV3(i-1),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]);for(r=0;r<i-1;r++){var o=2*r;this.indices_array.push(o,o+1,o+2),this.indices_array.push(o+2,o+1,o+3)}this.attributes?(this.attributes.position.copyArray(new Float32Array(this.positions)),this.attributes.position.needsUpdate=!0,this.attributes.previous.copyArray(new Float32Array(this.previous)),this.attributes.previous.needsUpdate=!0,this.attributes.next.copyArray(new Float32Array(this.next)),this.attributes.next.needsUpdate=!0,this.attributes.side.copyArray(new Float32Array(this.side)),this.attributes.side.needsUpdate=!0,this.attributes.width.copyArray(new Float32Array(this.width)),this.attributes.width.needsUpdate=!0,this.attributes.uv.copyArray(new Float32Array(this.uvs)),this.attributes.uv.needsUpdate=!0,this.attributes.index.copyArray(new Uint16Array(this.indices_array)),this.attributes.index.needsUpdate=!0):this.attributes={position:new t.BufferAttribute(new Float32Array(this.positions),3),previous:new t.BufferAttribute(new Float32Array(this.previous),3),next:new t.BufferAttribute(new Float32Array(this.next),3),side:new t.BufferAttribute(new Float32Array(this.side),1),width:new t.BufferAttribute(new Float32Array(this.width),1),uv:new t.BufferAttribute(new Float32Array(this.uvs),2),index:new t.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new t.BufferAttribute(new Float32Array(this.counters),1)},this.geometry.addAttribute("position",this.attributes.position),this.geometry.addAttribute("previous",this.attributes.previous),this.geometry.addAttribute("next",this.attributes.next),this.geometry.addAttribute("side",this.attributes.side),this.geometry.addAttribute("width",this.attributes.width),this.geometry.addAttribute("uv",this.attributes.uv),this.geometry.addAttribute("counters",this.attributes.counters),this.geometry.setIndex(this.attributes.index)},i.prototype.advance=function(e){var t=this.attributes.position.array,n=this.attributes.previous.array,i=this.attributes.next.array,o=t.length;r(t,0,n,0,o),r(t,6,t,0,o-6),t[o-6]=e.x,t[o-5]=e.y,t[o-4]=e.z,t[o-3]=e.x,t[o-2]=e.y,t[o-1]=e.z,r(t,6,i,0,o-6),i[o-6]=e.x,i[o-5]=e.y,i[o-4]=e.z,i[o-3]=e.x,i[o-2]=e.y,i[o-1]=e.z,this.attributes.position.needsUpdate=!0,this.attributes.previous.needsUpdate=!0,this.attributes.next.needsUpdate=!0},o.prototype=Object.create(t.Material.prototype),o.prototype.constructor=o,o.prototype.copy=function(e){return t.Material.prototype.copy.call(this,e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.near=e.near,this.far=e.far,this.logDepthBufFC=e.logDepthBufFC,this.dashArray.copy(e.dashArray),this.useDash=e.useDash,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this},void 0!==n?("undefined"!=typeof module&&module.exports&&(n=module.exports={MeshLine:i,MeshLineMaterial:o}),n.MeshLine=i,n.MeshLineMaterial=o):(this.MeshLine=i,this.MeshLineMaterial=o)}.call(this),TrailRenderHelper=function(){var e="[TrailRenderHelper.js] : ";this.fTimeLong=0,this.fTimeStart=0,this.iStep=0,this.iCount=0,this.fWidthStart=.5,this.fWidthEnd=.5,this.fWidthOffset=0,this.arrayPosHistory=new Array,this.shaderColor=null,this.shaderTexture=null,this.shaderTexMode=null,this.blending=null,this.transparent=null,this.alphaTest=null,this.depthWrite=null,this.depthTest=null,this.arrayUuid=new Array,this.arrayCfg=new Array,this.bAllStable=!1,this.bStable=!1,this.iMaxArrayPosHistoryNo=0,this.iMaxArrayPosHistoryNo_last=0,this.iCurrentIndex=0,this.iSumArrayPosHistoryCount=0,this.instanceBuffer=null,this.bufferGeometry=null,this.attributesVertices=null,this.material=null,this.mesh=null,this.vertices=null,this.indices=null,this.uvs=null,this.onTriggerMeshInited=null;var t=this,n={vertex:["precision highp float;","uniform sampler2D texture;","uniform vec4 color;","varying vec2 vUv;","varying vec4 varyColor;","void main()","{","\tvaryColor = color;","   vUv = vec2( uv.x, uv.y );","\tvec3 positionEye = ( modelViewMatrix * vec4( position, 1.0 ) ).xyz;","\tgl_Position = projectionMatrix * vec4( positionEye, 1.0 );","}"].join("\n"),fragment:["precision highp float;","uniform sampler2D texture;","varying vec2 vUv;","varying vec4 varyColor;","void main() {","    gl_FragColor = varyColor * texture2D(texture, vUv);","}"].join("\n")};this.init=function(i,r){if(null!=r&&null!=r){if(null==i||null==i||"object"!=typeof i)return console.error(e+"[init] : options == null;"),void r();if(null==i.fTimeLong||null==i.fTimeLong||"number"!=typeof i.fTimeLong)return console.error(e+"[init] : options.fTimeLong == null;"),void r();if(null==i.fTimeStart||null==i.fTimeStart||"number"!=typeof i.fTimeStart)return console.error(e+"[init] : options.fTimeStart == null;"),void r();if(null==i.iStep||null==i.iStep||"number"!=typeof i.iStep)return console.error(e+"[init] : options.iStep == null;"),void r();if(null==i.fWidthStart||null==i.fWidthStart||"number"!=typeof i.fWidthStart)return console.error(e+"[init] : options.fWidthStart == null;"),void r();if(null==i.fWidthEnd||null==i.fWidthEnd||"number"!=typeof i.fWidthEnd)return console.error(e+"[init] : options.fWidthStart == null;"),void r();null!=i.shaderColor&&null!=i.shaderColor&&i.shaderColor instanceof THREE.Vector4?t.shaderColor=new THREE.Vector4(i.shaderColor.x,i.shaderColor.y,i.shaderColor.z,i.shaderColor.w):(console.warn(e+"[init] : options.shaderColor == null; set shader color as default;"),t.shaderColor=new THREE.Vector4(.5,.5,1,1)),null!=i.shaderTexture&&null!=i.shaderTexture&&i.shaderTexture instanceof THREE.Texture?t.shaderTexture=i.shaderTexture:(console.warn(e+"[init] : options.shaderColor == null; set shader texture as default;"),t.shaderTexture=null),null==i.shaderTexMode||null==i.shaderTexMode||"string"!=typeof i.shaderTexMode?(console.warn(e+"[init] : options.shaderTexMode == null; set shader mode as default;"),t.shaderTexMode="Stretch"):t.shaderTexMode="Stretch"==i.shaderTexMode?"Stretch":"Tile",null==i.shaderBlending||null==i.shaderBlending||"number"!=typeof i.shaderBlending?(console.warn(e+"[init] : options.shaderBlending == null; set shader blending as default;"),t.blending=THREE.AdditiveBlending):t.blending=i.shaderBlending,null==i.shaderTransparent||null==i.shaderTransparent||"boolean"!=typeof i.shaderTransparent?(console.warn(e+"[init] : options.shaderTransparent == null; set shader transparent as default;"),t.transparent=!1):t.transparent=i.shaderTransparent,null==i.shaderAlphaTest||null==i.shaderAlphaTest||"number"!=typeof i.shaderAlphaTest?(console.warn(e+"[init] : options.shaderAlphaTest == null; set shader alphaTest as default;"),t.alphaTest=0):t.alphaTest=i.shaderAlphaTest,null==i.shaderDepthWrite||null==i.shaderDepthWrite||"boolean"!=typeof i.shaderDepthWrite?(console.warn(e+"[init] : options.shaderDepthWrite == null; set shader depthWrite as default;"),t.depthWrite=!0):t.depthWrite=i.shaderDepthWrite,null==i.shaderDepthTest||null==i.shaderDepthTest||"boolean"!=typeof i.shaderDepthTest?(console.warn(e+"[init] : options.shaderDepthTest == null; set shader depthTest as default;"),t.depthTest=!0):t.depthTest=i.shaderDepthTest,t.uniforms={texture:{type:"t",value:t.shaderTexture},color:{type:"v4",value:new THREE.Vector4(0,0,0,0)}},t.material=new THREE.ShaderMaterial({uniforms:t.uniforms,vertexShader:n.vertex,fragmentShader:n.fragment,blending:t.blending,transparent:t.transparent,alphaTest:t.alphaTest,depthWrite:t.depthWrite,depthTest:t.depthTest}),t.fTimeLong=i.fTimeLong,t.fTimeStart=i.fTimeStart,t.iStep=i.iStep,t.iCount=0,t.fWidthStart=i.fWidthStart,t.fWidthEnd=i.fWidthEnd,t.fWidthOffset=-t.fWidthStart+t.fWidthEnd,r()}else console.error(e+"[init] : onFinished == null;")},this.attach=function(n){if(null==n||null==n)return console.error(e+"[attach] : onFinished == null;"),null;var i=THREE.Math.generateUUID();t.arrayPosHistory[i]=new Array;return t.arrayCfg[i]={bActived:!0,bStable:!1,iMaxArrayPosHistoryNo_last:0,iMaxArrayPosHistoryNo:0,iStartIndex:0},t.arrayUuid.push(i),n(i),i},this.detach=function(n){null!=n&&null!=n&&"string"==typeof n?(t.arrayUuid.includes(n)&&delete t.arrayUuid[n],t.arrayCfg.includes(n)&&(t.iCurrentIndex-=t.arrayCfg[n].iMaxArrayPosHistoryNo,delete t.arrayCfg[n]),t.arrayPosHistory.includes(n)&&delete t.arrayPosHistory[n]):console.error(e+"[detach] : uuid == null;")},this.dispose=function(){t.instanceBuffer&&t.instanceBuffer.dispose(),t.bufferGeometry&&t.bufferGeometry.dispose(),GlobalsVariables.scene.remove(t.mesh),t.material.dispose(),t.arrayUuid.forEach((function(e){})),t.arrayCfg.forEach((function(e){})),t.arrayPosHistory.forEach((function(e){})),t.arrayUuid=[],t.arrayCfg=[],t.arrayPosHistory=[]},this.setActive=function(n,i,r){if(null!=r&&null!=r){if(null==n||null==n||"string"!=typeof n)return console.error(e+"[setActive] : uuid == null;"),void r(!1);if(!t.arrayUuid.includes(n))return console.error(e+"[setActive] : uuid do not includes;"),void r(!1);if(null==i||null==i||"boolean"!=typeof i)return console.error(e+"[setActive] : bActived == null;"),void r(!1);t.arrayCfg[n].bActived=i,r(!0)}else console.error(e+"[setActive] : onFinished == null;")},this.tick=function(e){if(t.bAllStable)for(var n=t.arrayUuid.length,i=0;i<n;i++)t.arrayCfg[t.arrayUuid[i]].bActived&&t.updateMesh(t.arrayUuid[i]);if(t.arrayCfg[e.uuid].bActived&&(t.arrayPosHistory[e.uuid].push({time:e.timeNow,pos:new THREE.Vector3(e.position.x,e.position.y,e.position.z),rot:new THREE.Vector3(e.rotation.x,e.rotation.y,e.rotation.z)}),t.checkPosHistory(e.uuid,e.timeNow)),!t.bAllStable&&!t.arrayCfg[e.uuid].bStable){n=t.arrayPosHistory[e.uuid].length;t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo<=n&&(t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo_last=t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo,t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo=n,t.arrayCfg[e.uuid].bStable||t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo_last!=t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo||(t.arrayCfg[e.uuid].bStable=!0,t.checkAllPosHistory()))}},this.checkPosHistory=function(e,n){for(var i=t.arrayPosHistory[e].length,r=0;r<i&&n-t.arrayPosHistory[e][r].time>t.fTimeLong;r++)t.arrayPosHistory[e].splice(r,1),i=t.arrayPosHistory[e].length,r--},this.checkAllPosHistory=function(){var e=t.arrayUuid.length,n=!0;t.iSumArrayPosHistoryCount=0;for(var i=0;i<e;i++){if(!t.arrayCfg[t.arrayUuid[i]].bStable)return void(n=!1);t.iSumArrayPosHistoryCount+=t.arrayCfg[t.arrayUuid[i]].iMaxArrayPosHistoryNo}if(n){t.bAllStable=!0;for(i=0;i<e;i++)0==i?1==e?t.initMesh(t.arrayUuid[i],"start|end"):t.initMesh(t.arrayUuid[i],"start"):i+1==e?t.initMesh(t.arrayUuid[i],"end"):t.initMesh(t.arrayUuid[i],"default")}},this.initMesh=function(e,n){if(null!=t.mesh&&GlobalsVariables.scene.remove(t.mesh),null==t.bufferGeometry&&(t.bufferGeometry=new THREE.BufferGeometry),t.arrayCfg[e].iStartIndex=t.iCurrentIndex,n.indexOf("start")>=0){var i=2*t.iSumArrayPosHistoryCount;t.iSumArrayPosHistoryCount;t.vertices=new Float32Array(3*i),t.indices=new Uint32Array(2*(t.iSumArrayPosHistoryCount-t.arrayCfg.length)*2*3),t.uvs=new Float32Array(2*i)}for(var r=new THREE.Quaternion,o=t.arrayCfg[e].iStartIndex,a=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo;o<a;o++){var s=t.fWidthEnd+(o-t.arrayCfg[e].iStartIndex)/t.arrayCfg[e].iMaxArrayPosHistoryNo*t.fWidthOffset,l=t.arrayPosHistory[e][o-t.arrayCfg[e].iStartIndex].pos.clone(),u=l.clone(),c=t.arrayPosHistory[e][o-t.arrayCfg[e].iStartIndex].rot.clone();c=c.normalize(),r.setFromEuler(new THREE.Euler(c.x,c.y,c.z));var h=new THREE.Vector3(s,0,0);h.applyQuaternion(r);var p=a-1-o,d=l.add(h);t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+0]=d.x,t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+1]=d.y,t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+2]=d.z;var f=u.sub(h);t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+3]=f.x,t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+4]=f.y,t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+5]=f.z}var m=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo-1;for(o=t.arrayCfg[e].iStartIndex;o<m;o++)t.indices[12*o+0]=2*o+0,t.indices[12*o+1]=2*o+1,t.indices[12*o+2]=2*o+2,t.indices[12*o+3]=2*o+2,t.indices[12*o+4]=2*o+1,t.indices[12*o+5]=2*o+3,t.indices[12*o+6]=2*o+0,t.indices[12*o+7]=2*o+2,t.indices[12*o+8]=2*o+1,t.indices[12*o+9]=2*o+2,t.indices[12*o+10]=2*o+3,t.indices[12*o+11]=2*o+1;var g=1/t.arrayCfg[e].iMaxArrayPosHistoryNo;if("Stretch"==t.shaderTexMode)for(o=t.arrayCfg[e].iStartIndex,a=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo;o<a;o++)t.uvs[4*o+0]=(o-t.arrayCfg[e].iStartIndex)*g,t.uvs[4*o+1]=0,t.uvs[4*o+2]=(o-t.arrayCfg[e].iStartIndex)*g,t.uvs[4*o+3]=1;else for(o=t.arrayCfg[e].iStartIndex,a=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo;o<a;o++)t.uvs[4*o+0]=(o-t.arrayCfg[e].iStartIndex)%2,t.uvs[4*o+1]=0,t.uvs[4*o+2]=(o-t.arrayCfg[e].iStartIndex)%2,t.uvs[4*o+3]=1;t.iCurrentIndex+=t.arrayCfg[e].iMaxArrayPosHistoryNo,n.indexOf("end")>=0&&(t.bufferGeometry.addAttribute("position",new THREE.BufferAttribute(t.vertices,3)),t.attributesVertices=this.bufferGeometry.attributes.position.array,t.bufferGeometry.addAttribute("uv",new THREE.BufferAttribute(t.uvs,2)),t.bufferGeometry.setIndex(new THREE.BufferAttribute(t.indices,1)),t.mesh=new THREE.Mesh(t.bufferGeometry,t.material),GlobalsVariables.scene.add(t.mesh),null!=t.onTriggerMeshInited&&null!=t.onTriggerMeshInited&&t.onTriggerMeshInited(t.mesh))},this.updateColor=function(e){null!=t.material&&null!=t.material&&(t.material.uniforms.color.value.x=e.r,t.material.uniforms.color.value.y=e.g,t.material.uniforms.color.value.z=e.b,t.material.uniforms.color.value.w=e.a,t.material.needsUpdate=!0)},this.updateMesh=function(e){for(var n=t.arrayPosHistory[e].length,i=new THREE.Quaternion,r=t.arrayCfg[e].iStartIndex,o=t.arrayCfg[e].iStartIndex+n;r<o;r++){var a=t.fWidthEnd+(r-t.arrayCfg[e].iStartIndex)/n*t.fWidthOffset,s=(h=t.arrayPosHistory[e][r-t.arrayCfg[e].iStartIndex].pos.clone()).clone();p=(p=t.arrayPosHistory[e][r-t.arrayCfg[e].iStartIndex].rot.clone()).normalize(),i.setFromEuler(new THREE.Euler(p.x,p.y,p.z)),(d=new THREE.Vector3(a,0,0)).applyQuaternion(i);var l=o-1-r;l=6*(t.arrayCfg[e].iStartIndex+l);var u=h.add(d);t.attributesVertices[l+0]=u.x,t.attributesVertices[l+1]=u.y,t.attributesVertices[l+2]=u.z;var c=s.sub(d);t.attributesVertices[l+3]=c.x,t.attributesVertices[l+4]=c.y,t.attributesVertices[l+5]=c.z}if(n<t.arrayCfg[e].iMaxArrayPosHistoryNo)for(r=t.arrayCfg[e].iStartIndex+n,o=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo;r<o;r++){var h,p,d;s=(h=t.arrayPosHistory[e][n-1].pos.clone()).clone();p=(p=t.arrayPosHistory[e][n-1].rot.clone()).normalize(),i.setFromEuler(new THREE.Euler(p.x,p.y,p.z)),(d=new THREE.Vector3(0,0,0)).applyQuaternion(i);l=6*(t.arrayCfg[e].iStartIndex+r),u=h.add(d);t.attributesVertices[l+0]=u.x,t.attributesVertices[l+1]=u.y,t.attributesVertices[l+2]=u.z;c=s.sub(d);t.attributesVertices[l+3]=c.x,t.attributesVertices[l+4]=c.y,t.attributesVertices[l+5]=c.z}t.bufferGeometry.attributes.position.needsUpdate=!0}},function(){"use strict";function e(e,t){t=t||1/0;for(var n,i=e.length,r=null,o=[],a=0;a<i;a++){if(55295<(n=e.charCodeAt(a))&&57344>n){if(!r){if(56319<n){-1<(t-=3)&&o.push(239,191,189);continue}if(a+1===i){-1<(t-=3)&&o.push(239,191,189);continue}r=n;continue}if(56320>n){-1<(t-=3)&&o.push(239,191,189),r=n;continue}n=r-55296<<10|n-56320|65536,r=null}else r&&(-1<(t-=3)&&o.push(239,191,189),r=null);if(128>n){if(0>(t-=1))break;o.push(n)}else if(2048>n){if(0>(t-=2))break;o.push(192|n>>6,128|63&n)}else if(65536>n){if(0>(t-=3))break;o.push(224|n>>12,128|63&n>>6,128|63&n)}else{if(!(2097152>n))throw new Error("Invalid code point");if(0>(t-=4))break;o.push(240|n>>18,128|63&n>>12,128|63&n>>6,128|63&n)}}return o}function t(e){try{return decodeURIComponent(e)}catch(e){return String.fromCharCode(65533)}}TextEncoderLite.prototype.encode=function(t){return"undefined"==typeof Uint8Array?e(t):new Uint8Array(e(t))},TextDecoderLite.prototype.decode=function(e){return function(e,n,i){var r="",o="";i=Math.min(e.length,i||1/0);for(var a=n=n||0;a<i;a++)127>=e[a]?(r+=t(o)+String.fromCharCode(e[a]),o=""):o+="%"+e[a].toString(16);return r+t(o)}(e,0,e.length)}}();var _Group=function(){this._tweens={},this._tweensAddedDuringUpdate={}};_Group.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var n=Object.keys(this._tweens);if(0===n.length)return!1;for(e=void 0!==e?e:TWEEN.now();n.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<n.length;i++){var r=this._tweens[n[i]];r&&!1===r.update(e)&&(r._isPlaying=!1,t||delete this._tweens[n[i]])}n=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var TWEEN=new _Group;TWEEN.Group=_Group,TWEEN._nextId=0,TWEEN.nextId=function(){return TWEEN._nextId++},"undefined"==typeof window&&"undefined"!=typeof process?TWEEN.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?TWEEN.now=window.performance.now.bind(window.performance):void 0!==Date.now?TWEEN.now=Date.now:TWEEN.now=function(){return(new Date).getTime()},TWEEN.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=TWEEN.Easing.Linear.None,this._interpolationFunction=TWEEN.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||TWEEN,this._id=TWEEN.nextId()},TWEEN.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=e,void 0!==t&&(this._duration=t),this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?TWEEN.now()+parseFloat(e):e:TWEEN.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==0&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,n,i;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),n=(e-this._startTime)/this._duration,n=0===this._duration||n>1?1:n,i=this._easingFunction(n),this._valuesEnd)if(void 0!==this._valuesStart[t]){var r=this._valuesStart[t]||0,o=this._valuesEnd[t];o instanceof Array?this._object[t]=this._interpolationFunction(o,i):("string"==typeof o&&(o="+"===o.charAt(0)||"-"===o.charAt(0)?r+parseFloat(o):parseFloat(o)),"number"==typeof o&&(this._object[t]=r+(o-r)*i))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1===n){if(this._repeat>0){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var a=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=a}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}return!0}},TWEEN.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){return e*e*(2.70158*e-1.70158)},Out:function(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-TWEEN.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*TWEEN.Easing.Bounce.In(2*e):.5*TWEEN.Easing.Bounce.Out(2*e-1)+.5}}},TWEEN.Interpolation={Linear:function(e,t){var n=e.length-1,i=n*t,r=Math.floor(i),o=TWEEN.Interpolation.Utils.Linear;return t<0?o(e[0],e[1],i):t>1?o(e[n],e[n-1],n-i):o(e[r],e[r+1>n?n:r+1],i-r)},Bezier:function(e,t){for(var n=0,i=e.length-1,r=Math.pow,o=TWEEN.Interpolation.Utils.Bernstein,a=0;a<=i;a++)n+=r(1-t,i-a)*r(t,a)*e[a]*o(i,a);return n},CatmullRom:function(e,t){var n=e.length-1,i=n*t,r=Math.floor(i),o=TWEEN.Interpolation.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(r=Math.floor(i=n*(1+t))),o(e[(r-1+n)%n],e[r],e[(r+1)%n],e[(r+2)%n],i-r)):t<0?e[0]-(o(e[0],e[0],e[1],e[1],-i)-e[0]):t>1?e[n]-(o(e[n],e[n],e[n-1],e[n-1],i-n)-e[n]):o(e[r?r-1:0],e[r],e[n<r+1?n:r+1],e[n<r+2?n:r+2],i-r)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=TWEEN.Interpolation.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:function(){var e=[1];return function(t){var n=1;if(e[t])return e[t];for(var i=t;i>1;i--)n*=i;return e[t]=n,n}}(),CatmullRom:function(e,t,n,i,r){var o=.5*(n-e),a=.5*(i-t),s=r*r;return(2*t-2*n+o+a)*(r*s)+(-3*t+3*n-2*o-a)*s+o*r+t}}},function(e){"function"==typeof define&&define.amd?define([],(function(){return TWEEN})):"undefined"!=typeof module&&"object"==typeof exports?module.exports=TWEEN:void 0!==e&&(e.TWEEN=TWEEN)}(this),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).json2mesh={})}(this,(function(e){"use strict";var t,n,i,r,o,a,s,l,u,c,h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),f=function(){function e(){p(this,e)}return d(e,null,[{key:"compatibilityProcessWorld",value:function(e){this.compatibilityProcessPlan(e.outdoors);for(var t=e.buildings,n=0;n<t.length;n++)for(var i=t[n].floorplans,r=0;r<i.length;r++){var o=i[r];this.compatibilityProcessPlan(o)}}},{key:"compatibilityProcessPlan",value:function(e){for(var t=0;t<e.combineStraightManualWallObjects.length;t++){var n=e.combineStraightManualWallObjects[t];e.combineStraightManualWalls.push(n.delayObject)}for(var i=0;i<e.combineCeilingObjects.length;i++){var r=e.combineCeilingObjects[i];e.combineCeilings.push(r.delayObject)}for(var o=0;o<e.combineFloorObjects.length;o++){var a=e.combineFloorObjects[o];e.combineFloors.push(a.delayObject)}for(var s=0;s<e.combineRoofObjects.length;s++){var l=e.combineRoofObjects[s];e.combineRoofs.push(l.delayObject)}for(var u=0;u<e.combineModelWallObjects.length;u++){var c=e.combineModelWallObjects[u];e.combineModelWalls.push(c.delayObject)}for(var h=0;h<e.combineDoorOrWindowObjects.length;h++){var p=e.combineDoorOrWindowObjects[h];e.combineDoorOrWins.push(p.delayObject)}for(var d=0;d<e.combinePlacementObjects.length;d++){var f=e.combinePlacementObjects[d];e.combinePlacements.push(f.delayObject)}}},{key:"combineObjectBuildCallback",value:function(e){var t=null;-1!==e.constructor.name.indexOf("Ceiling")?t=e.parent.combineCeilings:-1!==e.constructor.name.indexOf("DoorOrWindow")?t=e.parent.combineDoorOrWins:-1!==e.constructor.name.indexOf("Floor")?t=e.parent.combineFloors:-1!==e.constructor.name.indexOf("ModelWall")?t=e.parent.combineModelWalls:-1!==e.constructor.name.indexOf("Placement")?t=e.parent.combinePlacements:-1!==e.constructor.name.indexOf("Roof")?t=e.parent.combineRoofs:-1!==e.constructor.name.indexOf("Straight")&&(t=e.parent.combineStraightManualWalls),t.push(e.mesh)}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),n={};e.traverse((function(e){e.isSkinnedMesh&&(n[e.name]=e)}));var i={},r={};t.traverse((function(e){e.isBone&&(i[e.name]=e),e.isSkinnedMesh&&(r[e.name]=e)}));var o=!1;for(var a in n){o=!0;for(var s=n[a].skeleton,l=r[a],u=[],c=0;c<s.bones.length;++c){var h=i[s.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,s.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":h(t)))return t;if(t instanceof Date)return(n=new Date).setTime(t.getTime()),n;if(t instanceof Array|t instanceof Object){var n=t instanceof Array?[]:{};for(var i in t)t.hasOwnProperty(i)&&(n[i]=e.cloneJSObject(t[i]));return n}throw new Error("Unable to clone obj! Its type isn't supported.")}}]),e}(),m=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},g=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),v=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},y=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},b=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},_=new(function(){function e(t){m(this,e),this.config=null,this.objectManager=null}return g(e,[{key:"createObject",value:function(e){var t=new(this.config.getClass(e.creatorType))(e),n=t.create();return t.parseChildren(),n}}]),e}()),x={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:(n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),r=0,function(){for(var e=0;e<36;e++)8===e||13===e||18===e||23===e?i[e]="-":14===e?i[e]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),t=15&r,r>>=4,i[e]=n[19===e?3&t|8:t]);return i.join("")}),clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*x.DEG2RAD},radToDeg:function(e){return e*x.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}},E=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},w=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),T=function(){function e(t,n,i,r){E(this,e),this._x=t||0,this._y=n||0,this._z=i||0,this._w=void 0!==r?r:1}return w(e,[{key:"slerp",value:function(e,t,n,i){return n.copy(e).slerp(t,i)}},{key:"slerpFlat",value:function(e,t,n,i,r,o,a){var s=n[i+0],l=n[i+1],u=n[i+2],c=n[i+3],h=r[o+0],p=r[o+1],d=r[o+2],f=r[o+3];if(c!==f||s!==h||l!==p||u!==d){var m=1-a,g=s*h+l*p+u*d+c*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),_=Math.atan2(b,g*v);m=Math.sin(m*_)/b,a=Math.sin(a*_)/b}var x=a*v;if(s=s*m+h*x,l=l*m+p*x,u=u*m+d*x,c=c*m+f*x,m===1-a){var E=1/Math.sqrt(s*s+l*l+u*u+c*c);s*=E,l*=E,u*=E,c*=E}}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=c}},{key:"set",value:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this.onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,i=e._y,r=e._z,o=e.order,a=Math.cos,s=Math.sin,l=a(n/2),u=a(i/2),c=a(r/2),h=s(n/2),p=s(i/2),d=s(r/2);return"XYZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"YXZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"ZXY"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"ZYX"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"YZX"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c-h*p*d):"XZY"===o&&(this._x=h*u*c-l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c+h*p*d),!1!==t&&this.onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this.onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t,n=e.elements,i=n[0],r=n[4],o=n[8],a=n[1],s=n[5],l=n[9],u=n[2],c=n[6],h=n[10],p=i+s+h;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(c-l)*t,this._y=(o-u)*t,this._z=(a-r)*t):i>s&&i>h?(t=2*Math.sqrt(1+i-s-h),this._w=(c-l)/t,this._x=.25*t,this._y=(r+a)/t,this._z=(o+u)/t):s>h?(t=2*Math.sqrt(1+s-i-h),this._w=(o-u)/t,this._x=(r+a)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+h-i-s),this._w=(a-r)/t,this._x=(o+u)/t,this._y=(l+c)/t,this._z=.25*t),this.onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n,i=new M;return void 0===i&&(i=new M),(n=e.dot(t)+1)<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?i.set(-e.y,e.x,0):i.set(0,-e.z,e.y)):i.crossVectors(e,t),this._x=i.x,this._y=i.y,this._z=i.z,this._w=n,this.normalize()}},{key:"inverse",value:function(){return this.conjugate().normalize()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,i=e._y,r=e._z,o=e._w,a=t._x,s=t._y,l=t._z,u=t._w;return this._x=n*u+o*a+i*l-r*s,this._y=i*u+o*s+r*a-n*l,this._z=r*u+o*l+n*s-i*a,this._w=o*u-n*a-i*s-r*l,this.onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,i=this._y,r=this._z,o=this._w,a=o*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;var s=Math.sqrt(1-a*a);if(Math.abs(s)<.001)return this._w=.5*(o+this._w),this._x=.5*(n+this._x),this._y=.5*(i+this._y),this._z=.5*(r+this._z),this;var l=Math.atan2(s,a),u=Math.sin((1-t)*l)/s,c=Math.sin(t*l)/s;return this._w=o*u+this._w*c,this._x=n*u+this._x*c,this._y=i*u+this._y*c,this._z=r*u+this._z*c,this.onChangeCallback(),this}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"onChange",value:function(e){return this.onChangeCallback=e,this}},{key:"onChangeCallback",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}]),e}(),M=function(){function e(t,n,i){E(this,e),this.x=t||0,this.y=n||0,this.z=i||0,this.isVector3=!0}return w(e,[{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(){var e=new T;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}()}},{key:"applyAxisAngle",value:function(){var e=new T;return function(t,n){return this.applyQuaternion(e.setFromAxisAngle(t,n))}()}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*i-a*n,u=s*n+a*t-r*i,c=s*i+r*n-o*t,h=-r*t-o*n-a*i;return this.x=l*s+h*-r+u*-a-c*-o,this.y=u*s+h*-o+c*-r-l*-a,this.z=c*s+h*-a+l*-o-u*-r,this}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(){var t=new e,n=new e;return function(e,i){return t.set(e,e,e),n.set(i,i,i),this.clamp(t,n)}()}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:"cross",value:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,i=this.y,r=this.z;return this.x=i*e.z-r*e.y,this.y=r*e.x-n*e.z,this.z=n*e.y-i*e.x,this}},{key:"crossVectors",value:function(e,t){var n=e.x,i=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-r*a,this.y=r*o-n*s,this.z=n*a-i*o,this}},{key:"projectOnVector",value:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)}},{key:"projectOnPlane",value:function(){var t=new e;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}},{key:"reflect",value:function(){var t=new e;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}()}},{key:"angleTo",value:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(x.clamp(t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this}},{key:"setFromCylindrical",value:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}]),e}();!function(){function e(t,n){E(this,e),this.isBox3=!0,this.min=void 0!==t?t:new M(1/0,1/0,1/0),this.max=void 0!==n?n:new M(-1/0,-1/0,-1/0)}w(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,l=e.length;s<l;s+=3){var u=e[s],c=e[s+1],h=e[s+2];u<t&&(t=u),c<n&&(n=c),h<i&&(i=h),u>r&&(r=u),c>o&&(o=c),h>a&&(a=h)}return this.min.set(t,n,i),this.max.set(r,o,a),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,l=e.count;s<l;s++){var u=e.getX(s),c=e.getY(s),h=e.getZ(s);u<t&&(t=u),c<n&&(n=c),h<i&&(i=h),u>r&&(r=u),c>o&&(o=c),h>a&&(a=h)}return this.min.set(t,n,i),this.max.set(r,o,a),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=(new M).copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"setFromObject",value:function(e){return this.makeEmpty(),this.expandByObject(e)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){var t=e||new M;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){var t=e||new M;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){var t=new M,n=this;return e.updateMatrixWorld(!0),e.traverse((function(e){var i,r,o=e.geometry;if(void 0!==o)if(o.isGeometry){var a=o.vertices;for(i=0,r=a.length;i<r;i++)t.copy(a[i]),t.applyMatrix4(e.matrixWorld),n.expandByPoint(t)}else if(o.isBufferGeometry){var s=o.attributes.position;if(void 0!==s)for(i=0,r=s.count;i<r;i++)t.fromBufferAttribute(s,i).applyMatrix4(e.matrixWorld),n.expandByPoint(t)}})),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return(t||new M).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=e.constant&&n>=e.constant}},{key:"clampPoint",value:function(e,t){return(t||new M).copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return(new M).copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){var t=[new M,new M,new M,new M,new M,new M,new M,new M];return this.isEmpty()||(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(t)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}])}();function S(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(S.prototype,{isMatrix4:!0,set:function(e,t,n,i,r,o,a,s,l,u,c,h,p,d,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new S).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:(c=new M,function(e){var t=this.elements,n=e.elements,i=1/c.setFromMatrixColumn(e,0).length(),r=1/c.setFromMatrixColumn(e,1).length(),o=1/c.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,this}),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(i),l=Math.sin(i),u=Math.cos(r),c=Math.sin(r);if("XYZ"===e.order){var h=o*u,p=o*c,d=a*u,f=a*c;t[0]=s*u,t[4]=-s*c,t[8]=l,t[1]=p+d*l,t[5]=h-f*l,t[9]=-a*s,t[2]=f-h*l,t[6]=d+p*l,t[10]=o*s}else if("YXZ"===e.order){var m=s*u,g=s*c,v=l*u,y=l*c;t[0]=m+y*a,t[4]=v*a-g,t[8]=o*l,t[1]=o*c,t[5]=o*u,t[9]=-a,t[2]=g*a-v,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order){m=s*u,g=s*c,v=l*u,y=l*c;t[0]=m-y*a,t[4]=-o*c,t[8]=v+g*a,t[1]=g+v*a,t[5]=o*u,t[9]=y-m*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){h=o*u,p=o*c,d=a*u,f=a*c;t[0]=s*u,t[4]=d*l-p,t[8]=h*l+f,t[1]=s*c,t[5]=f*l+h,t[9]=p*l-d,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var b=o*s,_=o*l,x=a*s,E=a*l;t[0]=s*u,t[4]=E-b*c,t[8]=x*c+_,t[1]=c,t[5]=o*u,t[9]=-a*u,t[2]=-l*u,t[6]=_*c+x,t[10]=b-E*c}else if("XZY"===e.order){b=o*s,_=o*l,x=a*s,E=a*l;t[0]=s*u,t[4]=-c,t[8]=l*u,t[1]=b*c+E,t[5]=o*u,t[9]=_*c-x,t[2]=x*c-_,t[6]=a*u,t[10]=E*c+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,n=e._x,i=e._y,r=e._z,o=e._w,a=n+n,s=i+i,l=r+r,u=n*a,c=n*s,h=n*l,p=i*s,d=i*l,f=r*l,m=o*a,g=o*s,v=o*l;return t[0]=1-(p+f),t[4]=c-v,t[8]=h+g,t[1]=c+v,t[5]=1-(u+f),t[9]=d-m,t[2]=h-g,t[6]=d+m,t[10]=1-(u+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:(s=new M,l=new M,u=new M,function(e,t,n){var i=this.elements;return u.subVectors(e,t),0===u.lengthSq()&&(u.z=1),u.normalize(),s.crossVectors(n,u),0===s.lengthSq()&&(1===Math.abs(n.z)?u.x+=1e-4:u.z+=1e-4,u.normalize(),s.crossVectors(n,u)),s.normalize(),l.crossVectors(u,s),i[0]=s.x,i[4]=l.x,i[8]=u.x,i[1]=s.y,i[5]=l.y,i[9]=u.y,i[2]=s.z,i[6]=l.z,i[10]=u.z,this}),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],u=n[1],c=n[5],h=n[9],p=n[13],d=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],_=n[15],x=i[0],E=i[4],w=i[8],T=i[12],M=i[1],S=i[5],C=i[9],A=i[13],R=i[2],P=i[6],D=i[10],k=i[14],j=i[3],O=i[7],F=i[11],B=i[15];return r[0]=o*x+a*M+s*R+l*j,r[4]=o*E+a*S+s*P+l*O,r[8]=o*w+a*C+s*D+l*F,r[12]=o*T+a*A+s*k+l*B,r[1]=u*x+c*M+h*R+p*j,r[5]=u*E+c*S+h*P+p*O,r[9]=u*w+c*C+h*D+p*F,r[13]=u*T+c*A+h*k+p*B,r[2]=d*x+f*M+m*R+g*j,r[6]=d*E+f*S+m*P+g*O,r[10]=d*w+f*C+m*D+g*F,r[14]=d*T+f*A+m*k+g*B,r[3]=v*x+y*M+b*R+_*j,r[7]=v*E+y*S+b*P+_*O,r[11]=v*w+y*C+b*D+_*F,r[15]=v*T+y*A+b*k+_*B,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new M;return function(t){for(var n=0,i=t.count;n<i;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.applyMatrix4(this),t.setXYZ(n,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],a=e[5],s=e[9],l=e[13],u=e[2],c=e[6],h=e[10],p=e[14];return e[3]*(+r*s*c-i*l*c-r*a*h+n*l*h+i*a*p-n*s*p)+e[7]*(+t*s*p-t*l*h+r*o*h-i*o*p+i*l*u-r*s*u)+e[11]*(+t*l*c-t*a*p-r*o*c+n*o*p+r*a*u-n*l*u)+e[15]*(-i*a*u-t*s*c+t*a*h+i*o*c-n*o*h+n*s*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,i=e.elements,r=i[0],o=i[1],a=i[2],s=i[3],l=i[4],u=i[5],c=i[6],h=i[7],p=i[8],d=i[9],f=i[10],m=i[11],g=i[12],v=i[13],y=i[14],b=i[15],_=d*y*h-v*f*h+v*c*m-u*y*m-d*c*b+u*f*b,x=g*f*h-p*y*h-g*c*m+l*y*m+p*c*b-l*f*b,E=p*v*h-g*d*h+g*u*m-l*v*m-p*u*b+l*d*b,w=g*d*c-p*v*c-g*u*f+l*v*f+p*u*y-l*d*y,T=r*_+o*x+a*E+s*w;if(0===T){var M="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(M);return console.warn(M),this.identity()}var S=1/T;return n[0]=_*S,n[1]=(v*f*s-d*y*s-v*a*m+o*y*m+d*a*b-o*f*b)*S,n[2]=(u*y*s-v*c*s+v*a*h-o*y*h-u*a*b+o*c*b)*S,n[3]=(d*c*s-u*f*s-d*a*h+o*f*h+u*a*m-o*c*m)*S,n[4]=x*S,n[5]=(p*y*s-g*f*s+g*a*m-r*y*m-p*a*b+r*f*b)*S,n[6]=(g*c*s-l*y*s-g*a*h+r*y*h+l*a*b-r*c*b)*S,n[7]=(l*f*s-p*c*s+p*a*h-r*f*h-l*a*m+r*c*m)*S,n[8]=E*S,n[9]=(g*d*s-p*v*s-g*o*m+r*v*m+p*o*b-r*d*b)*S,n[10]=(l*v*s-g*u*s+g*o*h-r*v*h-l*o*b+r*u*b)*S,n[11]=(p*u*s-l*d*s-p*o*h+r*d*h+l*o*m-r*u*m)*S,n[12]=w*S,n[13]=(p*v*a-g*d*a+g*o*f-r*v*f-p*o*y+r*d*y)*S,n[14]=(g*u*a-l*v*a-g*o*c+r*v*c+l*o*y-r*u*y)*S,n[15]=(l*d*a-p*u*a+p*o*c-r*d*c-l*o*f+r*u*f)*S,this},scale:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,a=e.y,s=e.z,l=r*o,u=r*a;return this.set(l*o+n,l*a-i*s,l*s+i*a,0,l*a+i*s,u*a+n,u*s-i*o,0,l*s-i*a,u*s+i*o,r*s*s+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){return this.makeRotationFromQuaternion(t),this.scale(n),this.setPosition(e),this},decompose:(o=new M,a=new S,function(e,t,n){var i=this.elements,r=o.set(i[0],i[1],i[2]).length(),s=o.set(i[4],i[5],i[6]).length(),l=o.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],a.copy(this);var u=1/r,c=1/s,h=1/l;return a.elements[0]*=u,a.elements[1]*=u,a.elements[2]*=u,a.elements[4]*=c,a.elements[5]*=c,a.elements[6]*=c,a.elements[8]*=h,a.elements[9]*=h,a.elements[10]*=h,t.setFromRotationMatrix(a),n.x=r,n.y=s,n.z=l,this}),makePerspective:function(e,t,n,i,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*r/(t-e),l=2*r/(n-i),u=(t+e)/(t-e),c=(n+i)/(n-i),h=-(o+r)/(o-r),p=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(e,t,n,i,r,o){var a=this.elements,s=1/(t-e),l=1/(n-i),u=1/(o-r),c=(t+e)*s,h=(n+i)*l,p=(o+r)*u;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,n=e.elements,i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}});!function(){function e(t,n){E(this,e),this.x=t||0,this.y=n||0,this.isVector2=!0}w(e,[{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(){var t=new e,n=new e;return function(e,i){return t.set(e,e),n.set(i,i),this.clamp(t,n)}()}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}},{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}}])}();var C=function(){function e(){m(this,e)}return g(e,null,[{key:"uuid",value:function(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var n=e.join("");return n}},{key:"checkValueEmpty",value:function(e){return null==e}},{key:"convertToVector3",value:function(e){return e.isVector3?e:new M(e[0],e[1],e[2])}},{key:"convertToQuaternion",value:function(e){return new T(e[0],e[1],e[2],e[3])}}]),e}(),A=function(){function e(t){m(this,e),this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=t.jsonData,this.objectParent=null,t.parent&&(this.objectParent=t.parent),this.createType=null,this.resourceManager=t.resourceManager}return g(e,[{key:"create",value:function(){var e=this._getCreateParams();return this.object=_.objectManager.create(e),this.jsonData.id&&(this.object.id=this.jsonData.id),this.jsonData.userid&&(this.object.userID=this.jsonData.userid),this.jsonData.name&&(this.object.name=this.jsonData.name),this.object.jsonData=this.jsonData,e.parent&&(this.object.parent=e.parent),C.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),this.object}},{key:"parseChildren",value:function(){}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,n=e.creatorType,i=0;i<t.length;i++)this._parseJsonDataChild({jsonData:t[i],creatorType:n})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,_.createObject(e)}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),e}(),R={scale:1,defaultFloorTextureResource:null,defaultCeilingTextureResource:null,defaultRoofTextureResource:null},P=0,D=1,k=2,j=4,O=5,F=8,B=9,L=10,I=22,N=23,H=24,z=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="World",n}return y(t,e),g(t,[{key:"create",value:function(){return this.jsonData.unit&&(R.scale=.01*this.jsonData.unit),v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this)}},{key:"parseChildren",value:function(){var e=this.jsonData,t=(this._parseJsonDataChild({jsonData:e,creatorType:D}),this._parseJsonDataChild({jsonData:{},creatorType:L}));this.object.outdoors=t}}]),t}(A),U=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Building",n}return y(t,e),g(t,[{key:"parseChildren",value:function(){var e=this.jsonData;this._parseJsonDataChild({jsonData:e,creatorType:k})}}]),t}(A),V=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="FloorPlan",n}return y(t,e),g(t,[{key:"create",value:function(){return v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.walls&&this._parseWalls(e.walls),e.rooms&&this._parseJsonDataChildren({jsonData:e.rooms,creatorType:B}),e.doors&&this._parseJsonDataChildren({jsonData:e.doors,creatorType:F}),this.object.calRoomsUV2()}},{key:"_parseWalls",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];0===n.type?this._parseJsonDataChild({jsonData:n,creatorType:O}):this._parseJsonDataChild({jsonData:n,creatorType:j})}}}]),t}(A),q=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="WallCorner",n}return y(t,e),g(t,[{key:"create",value:function(){v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this);var e=this.jsonData[0]*R.scale,n=this.jsonData[1]*R.scale;return this.object.position=[e,0,n],this.object}}]),t}(A),G=function(e){function t(e){return m(this,t),b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return y(t,e),g(t,[{key:"_parseCorners",value:function(){var e=this.jsonData,t=(this.objectParent,e.start[0]*R.scale),n=e.start[1]*R.scale,i=null,r=null;i=this._existsCorner(t,0,n)?this._getCorner(t,0,n):this._createCorner(t,0,n,e.start),t=e.end[0]*R.scale,n=e.end[1]*R.scale,r=this._existsCorner(t,0,n)?this._getCorner(t,0,n):this._createCorner(t,0,n,e.end),this.object.startCorner=i,this.object.endCorner=r}},{key:"_existsCorner",value:function(e,t,n){var i=this.objectParent.typeToChildren.WallCorner;if(i)for(var r=0,o=i.length;r<o;r++){var a=i[r].position;if(a[0]===e&&a[1]===t&&a[2]===n)return!0}return!1}},{key:"_getCorner",value:function(e,t,n){for(var i=this.objectParent.typeToChildren.WallCorner,r=0,o=i.length;r<o;r++){var a=i[r].position;if(a[0]===e&&a[1]===t&&a[2]===n)return i[r]}return null}},{key:"_createCorner",value:function(e,t,n,i){var r=new q({jsonData:i}).create();return r.parent=this.objectParent,r.jsonData=i,r}}]),t}(A),W=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="ModelWall",n}return y(t,e),g(t,[{key:"create",value:function(){return v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parseCorners(),C.checkValueEmpty(this.jsonData.model)||(this.object.resource=this.resourceManager.models[this.jsonData.model]),C.checkValueEmpty(this.jsonData.isshow)&&(this.object.visible=this.jsonData.isshow),C.checkValueEmpty(this.jsonData.height)?this.object.height=this.object.resource.modelSize.y:this.object.height=this.jsonData.height,C.checkValueEmpty(this.jsonData.weight)||(this.object.thick=this.jsonData.weight),this.object}}]),t}(G),X=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="StraightManualWall",n}return y(t,e),g(t,[{key:"create",value:function(){return v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parseCorners(),this._parseResources(),this.jsonData.uvmultiple&&(this.object.uvMultiple=this.jsonData.uvmultiple),C.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),C.checkValueEmpty(this.jsonData.weight)||(this.object.thick=this.jsonData.weight),this.object}},{key:"_parseResources",value:function(){C.checkValueEmpty(this.jsonData.lefttexture)||(this.object.leftResource=this.resourceManager.textures[this.jsonData.lefttexture]),C.checkValueEmpty(this.jsonData.righttexture)||(this.object.rightResource=this.resourceManager.textures[this.jsonData.righttexture]),C.checkValueEmpty(this.jsonData.edgetexture)||(this.object.edgeResource=this.resourceManager.textures[this.jsonData.edgetexture])}}]),t}(G),J=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.attachWall=e.attachWall,n.createType="DoorOrWindow",n.pointInLineDeviation=.001,n}return y(t,e),g(t,[{key:"create",value:function(){v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this);var e=R.scale,n=this.jsonData,i=n.height*e,r=n.width*e,o=[n.pos[0]*e,0,n.pos[1]*e];this.attachWall=this._getPointOnWhichWall(this.objectParent,o),null===this.attachWall&&console.warn("can not find door on which wall!");var a=this.object;return n.suspendpercent&&(a.suspendPercent=n.suspendpercent),a.resource=this.resourceManager.create({type:"EmptyModelResource"}),a.resource.size=[r,i,.15],a.position=o,this.object.attachWall=this.attachWall,this.attachWall.doorOrWindows.push(this.object),this.object}},{key:"_getPointOnWhichWall",value:function(e,t){var n=[],i=e.typeToChildren.StraightManualWall,r=e.typeToChildren.ModelWall;i&&(n=n.concat(i)),r&&(n=n.concat(r));for(var o=0;o<n.length;o++){var a=n[o];if(this._isPointOnLineAndBetweenPoints(C.convertToVector3(a.startCorner.position),C.convertToVector3(a.endCorner.position),C.convertToVector3(t)))return a}return null}},{key:"_isPointOnLine",value:function(e,t,n){var i=new M;return i.crossVectors(e.clone().sub(n),t.clone().sub(n)),i.length()<this.pointInLineDeviation}},{key:"_isPointOnLineAndBetweenPoints",value:function(e,t,n){if(!this._isPointOnLine(e,t,n))return!1;var i=t.x-e.x,r=t.z-e.z;return Math.abs(i)>=Math.abs(r)?i>0?e.x<=n.x&&n.x<=t.x:t.x<=n.x&&n.x<=e.x:r>0?e.z<=n.z&&n.z<=t.z:t.z<=n.z&&n.z<=e.z}}]),t}(A),Y=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Room",n}return y(t,e),g(t,[{key:"create",value:function(){if(v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._createChildren(),this._parsePoints(),0!==this.object.points.length)return this._parseHolesPoints(),this._parseRoomResources(),this._parseRoomHeight(),this._parseRoomBlockSize(),this._parseRoomVisible(),this._parseRoomBlockAngle(),this.object;console.error("room points is null")}},{key:"_createChildren",value:function(){this._parseJsonDataChild({jsonData:{},creatorType:I}),"FloorPlan"===this.object.parent.type&&(this._parseJsonDataChild({jsonData:{},creatorType:N}),this._parseJsonDataChild({jsonData:{},creatorType:H}))}},{key:"_parsePoints",value:function(){if(this.jsonData.points){for(var e=[],t=0;t<this.jsonData.points.length;t++){var n=this.jsonData.points[t],i=[R.scale*n[0],0,R.scale*n[1]];e.push(i)}this.object.points=e}}},{key:"_parseHolesPoints",value:function(){if(this.jsonData.holes){for(var e=[],t=0;t<this.jsonData.holes.length;t++){for(var n=this.jsonData.holes[t],i=[],r=0;r<n.length;r++){var o=n[r],a=[R.scale*o[0],0,R.scale*o[1]];i.push(a)}e.push(i)}this.object.holes=e}}},{key:"_parseRoomResources",value:function(){this.object.floor.resource=R.defaultFloorTextureResource,this.object.ceiling.resource=R.defaultCeilingTextureResource,this.object.roof.resource=R.defaultRoofTextureResource,null!==this.jsonData.floortexture&&void 0!==this.jsonData.floortexture&&(this.object.floorResource=this.resourceManager.textures[this.jsonData.floortexture],this.object.floor.resource=this.object.floorResource),null!==this.jsonData.ceilingtexture&&void 0!==this.jsonData.ceilingtexture&&(this.object.ceilingResource=this.resourceManager.textures[this.jsonData.ceilingtexture],this.object.ceiling.resource=this.object.ceilingResource),null!==this.jsonData.rooftexture&&void 0!==this.jsonData.rooftexture&&(this.object.roofResource=this.resourceManager.textures[this.jsonData.rooftexture],this.object.roof.resource=this.object.roofResource)}},{key:"_parseRoomHeight",value:function(){var e=this.jsonData,t=this.object;void 0!==e.ceilingheight?t.ceiling.height=e.ceilingheight:(t.ceiling.DefaultHeight=this.objectParent.height-.1,t.ceiling.height=t.ceiling.DefaultHeight),void 0!==e.roofheight?t.roof.height=e.roofheight:(t.roof.defaultHeight=this.objectParent.height,t.roof.height=t.roof.defaultHeight),void 0!==e.floorheight&&(t.floor.height=e.floorheight)}},{key:"_parseRoomVisible",value:function(){var e=this.jsonData,t=this.object;void 0!==e.isshowfloor&&(t.floor.visible=e.isshowfloor),void 0!==e.isshowceiling&&(t.ceiling.visible=e.isshowceiling),void 0!==e.isshowroof&&(t.roof.visible=e.isshowroof)}},{key:"_parseRoomBlockSize",value:function(){var e=this.jsonData,t=this.object;if(e.floorblocksize){var n=e.floorblocksize;t.floor.blockSize=[n[0],n[1]]}if(e.ceilingblocksize){var i=e.ceilingblocksize;t.ceiling.blockSize=[i[0],i[1]]}if(e.roofblocksize){var r=e.roofblocksize;t.roof.blockSize=[r[0],r[1]]}}},{key:"_parseRoomBlockAngle",value:function(){var e=this.jsonData,t=this.object;C.checkValueEmpty(e.floorblockangle)||(t.floor.blockAngle=e.floorblockangle),C.checkValueEmpty(e.ceilingblockangle)||(t.ceiling.blockAngle=e.ceilingblockangle),C.checkValueEmpty(e.roofblockangle)||(t.roof.blockAngle=e.roofblockangle)}}]),t}(A),Q=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Outdoors",n}return y(t,e),t}(V),Z=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Floor",n}return y(t,e),g(t,[{key:"create",value:function(){return v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(A),K=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Roof",n}return y(t,e),g(t,[{key:"create",value:function(){return v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(A),$=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Ceiling",n}return y(t,e),g(t,[{key:"create",value:function(){return v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(A),ee=function(){function e(t){m(this,e),this._map={0:z,1:U,2:V,3:q,4:W,5:X,8:J,9:Y,10:Q,22:Z,23:$,24:K}}return g(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),te=new(function(){function e(){m(this,e),this.objects=[],this._objectTypeConfig=null}return g(e,[{key:"create",value:function(e){var t=e.type;return new(0,this.objectTypeConfig[t])}},{key:"objectTypeConfig",set:function(e){this._objectTypeConfig=e},get:function(){return this._objectTypeConfig}}]),e}()),ne=function(){function e(t){m(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl}return g(e,[{key:"createResource",value:function(e){var t=this.manager.create({type:e});return t.manager=this.manager,t}},{key:"loadTextures",value:function(e){for(var t=null,n=0;n<e.length;n++){var i=e[n];t=i.localurl?this._loadLocalCustomTextureResource(i):this._loadTextureResource(i),this.manager.textures.push(t)}}},{key:"_loadLocalCustomTextureResource",value:function(e){var t=this.createResource("LocalCustomTextureResource");return t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,this._loadBaseTextureResourceData(e,t),t}},{key:"_loadTextureResource",value:function(e){var t=this.createResource("TextureResource");return this._loadBaseTextureResourceData(e,t),t}},{key:"_loadBaseTextureResourceData",value:function(e,t){t.id=e.id,t.ext=e.ext,e.url&&(t.url=e.url),t.baseUrl=this.baseTextureUrl,e.isDefault&&(t.isDefault=e.isDefault)}},{key:"loadModels",value:function(e){for(var t=null,n=0;n<e.length;n++){var i=e[n];if((t=i.model?this.createResource("CustomResource"):i.localurl?this.createResource("CustomModelResource"):this.createResource("ModelResource")).baseUrl=this.baseModelUrl,i.localurl){if(t.localUrl=i.localurl,t.id=i.id,t.localBaseUrl=this.manager.localCustomModelBaseUrl,i.title&&(t.modelName=i.title),t.modelID=i.id,null!==i.texture&&void 0!==i.texture&&(t.customTexture=this.manager.textures[i.texture]),i.rendermode&&(t.renderMode=i.rendermode),i.color){var r=i.color;t.color=[r[0],r[1],r[2]],4===r.length&&(t.opacity=r[3])}}else if(i.id){if(t.id=i.id,t.modelID=i.id,t.version=i.version,null!==i.texture&&void 0!==i.texture&&(t.customTexture=this.manager.textures[i.texture]),i.rendermode&&(t.renderMode=i.rendermode),i.model&&(t.modelID=i.model),i.title&&(t.modelName=i.title),i.color){r=i.color;t.color=[r[0],r[1],r[2]],4===r.length&&(t.opacity=r[3])}if(i.size){var o=i.size;t.size=[o[0],o[1],o[2]]}i.hasanimation&&(t.hasAnim=i.hasanimation),i.url&&(t.url=i.url)}for(var a=0;a<this.manager.ableToSupportFootAndHeadModelWalls.length;a++){var s=this.manager.ableToSupportFootAndHeadModelWalls[a];if(t.id===s){t.isSupportHeadAndFootModelWall=!0;break}}this.manager.models.push(t)}}},{key:"loadCustomModelResource",value:function(e,t){this.loadBaseResourceData(e,t),e.localurl&&(t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]))}},{key:"loadCustomResource",value:function(e,t){this.loadBaseResourceData(e,t)}},{key:"loadBaseResourceData",value:function(e,t){if(t.id=e.id,t.modelID=e.id,t.version=e.version,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]),e.rendermode&&(t.renderMode=e.rendermode),e.model&&(t.modelID=e.model),e.title&&(t.modelName=e.title),e.color){var n=e.color;t.color=[n[0],n[1],n[2]],4===n.length&&(t.opacity=n[3])}if(e.size){var i=e.size;t.modelSize=[i[0],i[1],i[2]]}e.hasanimation&&(t.hasAnim=e.hasanimation)}}]),e}(),ie=function(){function e(t){m(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.creatorTypeConfig=new ee,t&&t.resourceLibraryUrl&&(this.resourceLibraryUrl=t.resourceLibraryUrl)}return g(e,[{key:"setObjectTypeConfig",value:function(e){te.objectTypeConfig=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"setObjectManager",value:function(e){_.objectManager=e}},{key:"initDefaultResources",value:function(){this.createEmptyModelResource(),this.createEmptyTextureResource(),this.resourceLibraryUrl&&(this.resourceManager.baseTextureUrl=this.resourceLibraryUrl+"/texture/",this.resourceManager.baseModelUrl=this.resourceLibraryUrl+"/model/"),this.defaultFloorTextureResource=this.createResource("TextureResource"),this.defaultFloorTextureResource.id="IQR8PZE2SGEV2H07WX3EJK22CA6ZS0YG",this.defaultFloorTextureResource.ext="jpg",this.defaultFloorTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultCeilingTextureResource=this.createResource("TextureResource"),this.defaultCeilingTextureResource.id="UPEUIZIK19VMBPP9TLZJ3J3ILWK8V5ZB",this.defaultCeilingTextureResource.ext="jpg",this.defaultCeilingTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultRoofTextureResource=this.createResource("TextureResource"),this.defaultRoofTextureResource.id="3OZVGE55PV0MY48FPRG5BELXKHV26NU5",this.defaultRoofTextureResource.ext="jpg",this.defaultRoofTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultDoorResource=this.resourceManager.emptyModelResource,R.defaultFloorTextureResource=this.defaultFloorTextureResource,R.defaultCeilingTextureResource=this.defaultCeilingTextureResource,R.defaultRoofTextureResource=this.defaultRoofTextureResource,R.defaultDoorResource=this.defaultDoorResource}},{key:"createEmptyTextureResource",value:function(){var e=this.createResource("TextureResource");e.isBuilded=!0,e.texture=new THREE.Texture,e.isEmpty=!0,e.buildPromise=Promise.resolve(),this.resourceManager.emptyTextureResource=e}},{key:"createEmptyModelResource",value:function(){var e=this.createResource("ModelResource");e.isBuilded=!0,e.model=new THREE.Object3D,e.isEmpty=!0,e.buildPromise=Promise.resolve(),this.resourceManager.emptyModelResource=e}},{key:"loadLightMaps",value:function(e){var t=null,n="18091219l1g1hnjt",i="png";this.defaultSetting.userDefaultWallLightMap=!0,e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(n=e.straightmanualwall.lightingtexture.id,i=e.straightmanualwall.lightingtexture.ext,this.defaultSetting.userDefaultWallLightMap=!1),this.defaultSetting.enableManaulWallLightMap&&((t=this.createResource("TextureResource")).baseUrl=this.resourceManager.baseTextureUrl,t.id=n,t.ext=i,this.defaultResource.wallLightMapResource=t),this.defaultSetting.enableFloorLightMap&&((t=this.createResource("TextureResource")).baseUrl=this.resourceManager.baseTextureUrl,t.id="18091216vjlgtwbh",t.ext="jpg",this.defaultResource.floorLightMapResource=t)}},{key:"createResource",value:function(e){var t=this.resourceManager.create({type:e});return t.manager=this.resourceManager,t}},{key:"parseObjects",value:function(e){return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),n="",i=0;i<t.length-1;i++){n+=t[i]+"/"}return n}},{key:"loadSceneJson",value:function(){var e=this;return new Promise((function(t,n){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,(function(n){e.sceneJson=JSON.parse(n),t()}),(function(){}),(function(t){n("can not load "+e.sceneURL)}))}else n("load scene json error")}))}},{key:"getResourceLoader",value:function(){return new ne(this.resourceManager)}},{key:"parseSceneJson",value:function(){var e=this.getResourceLoader();this.loadLightMaps(this.sceneJson.materialsetting),this.initDefaultResources(),e.loadTextures(this.sceneJson.textures),e.loadModels(this.sceneJson.models),this.parseWorld(this.sceneJson)}},{key:"parseWorld",value:function(e){_.config=this.creatorTypeConfig,this.world=_.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:P})}}]),e}(),re=new(function(){function e(t){m(this,e),this.config=null}return g(e,[{key:"createObject",value:function(e){var t=new(this.config.getClass(e.creatorType))(e),n=t.create();return t.parseChildren(),n}}]),e}()),oe=function(){function e(t){m(this,e),this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=t.jsonData,this.objectParent=null,t.parent&&(this.objectParent=t.parent),this.createType=null,this.resourceManager=t.resourceManager}return g(e,[{key:"create",value:function(){var e=this._getCreateParams();return this.object=re.objectManager.create(e),this.jsonData.id&&(this.object.id=this.jsonData.id),this.jsonData.userid&&(this.object.userID=this.jsonData.userid),this.jsonData.name&&(this.object.name=this.jsonData.name),this.object.jsonData=this.jsonData,e.parent&&(this.object.parent=e.parent),C.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),this.object}},{key:"parseChildren",value:function(){}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,n=e.creatorType,i=0;i<t.length;i++)this._parseJsonDataChild({jsonData:t[i],creatorType:n})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,re.createObject(e)}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),e}(),ae={scale:1,defaultFloorTextureResource:null,defaultCeilingTextureResource:null,defaultRoofTextureResource:null},se=0,le=1,ue=2,ce=5,he=8,pe=9,de=10,fe=22,me=23,ge=24,ve=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="World",n}return y(t,e),g(t,[{key:"create",value:function(){return this.jsonData.unit&&(ae.scale=.01*this.jsonData.unit),v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this)}},{key:"parseChildren",value:function(){var e=this.jsonData,t=(this._parseJsonDataChild({jsonData:e,creatorType:le}),this._parseJsonDataChild({jsonData:{},creatorType:de}));this.object.outdoors=t}}]),t}(oe),ye=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Building",n}return y(t,e),g(t,[{key:"parseChildren",value:function(){var e=this.jsonData;this._parseJsonDataChild({jsonData:e,creatorType:ue})}}]),t}(oe),be=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="FloorPlan",n}return y(t,e),g(t,[{key:"create",value:function(){return v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.walls&&this._parseWalls(e.walls),e.rooms&&this._parseJsonDataChildren({jsonData:e.rooms,creatorType:pe}),e.doors&&this._parseJsonDataChildren({jsonData:e.doors,creatorType:he}),this.object.calRoomsUV2()}},{key:"_parseWalls",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];this._parseJsonDataChild({jsonData:n,creatorType:ce})}}}]),t}(oe),_e=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="WallCorner",n}return y(t,e),g(t,[{key:"create",value:function(){v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this);var e=this.jsonData[0]*ae.scale,n=this.jsonData[1]*ae.scale;return this.object.position=[e,0,n],this.object}}]),t}(oe),xe=function(e){function t(e){return m(this,t),b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return y(t,e),g(t,[{key:"_parseCorners",value:function(){var e=this.jsonData,t=(this.objectParent,e.start[0]*ae.scale),n=e.start[1]*ae.scale,i=null,r=null;i=this._existsCorner(t,0,n)?this._getCorner(t,0,n):this._createCorner(t,0,n,e.start),t=e.end[0]*ae.scale,n=e.end[1]*ae.scale,r=this._existsCorner(t,0,n)?this._getCorner(t,0,n):this._createCorner(t,0,n,e.end),this.object.startCorner=i,this.object.endCorner=r}},{key:"_existsCorner",value:function(e,t,n){var i=this.objectParent.typeToChildren.WallCorner;if(i)for(var r=0,o=i.length;r<o;r++){var a=i[r].position;if(a[0]===e&&a[1]===t&&a[2]===n)return!0}return!1}},{key:"_getCorner",value:function(e,t,n){for(var i=this.objectParent.typeToChildren.WallCorner,r=0,o=i.length;r<o;r++){var a=i[r].position;if(a[0]===e&&a[1]===t&&a[2]===n)return i[r]}return null}},{key:"_createCorner",value:function(e,t,n,i){var r=new _e({jsonData:i}).create();return r.parent=this.objectParent,r.jsonData=i,r}}]),t}(oe),Ee=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="ModelWall",n}return y(t,e),g(t,[{key:"create",value:function(){return v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parseCorners(),C.checkValueEmpty(this.jsonData.model)||(this.object.resource=this.resourceManager.models[this.jsonData.model]),C.checkValueEmpty(this.jsonData.isshow)||(this.object.isShow=this.jsonData.isshow),C.checkValueEmpty(this.jsonData.height)?this.object.height=this.object.resource.modelSize.y:this.object.height=this.jsonData.height,C.checkValueEmpty(this.jsonData.weight)||(this.object.thick=this.jsonData.weight),this.object}}]),t}(xe),we=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="StraightManualWall",n}return y(t,e),g(t,[{key:"create",value:function(){return v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._parseCorners(),this._parseResources(),this.jsonData.uvmultiple&&(this.object.uvMultiple=this.jsonData.uvmultiple),C.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),C.checkValueEmpty(this.jsonData.weight)||(this.object.thick=this.jsonData.weight),this.object}},{key:"_parseResources",value:function(){this.object.leftResource=this.resourceManager.defaultWallTextureResource,this.object.rightResource=this.resourceManager.defaultWallTextureResource,this.object.edgeResource=this.resourceManager.defaultWallEdgeResource,this.object.lightMapResource=this.resourceManager.wallLightMapResource}}]),t}(xe),Te=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.attachWall=e.attachWall,n.createType="DoorOrWindow",n.pointInLineDeviation=.001,n}return y(t,e),g(t,[{key:"create",value:function(){v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this);var e=ae.scale,n=this.jsonData,i=n.height*e,r=n.width*e,o=[n.pos[0]*e,0,n.pos[1]*e];this.attachWall=this._getPointOnWhichWall(this.objectParent,o),null===this.attachWall&&console.warn("can not find door on which wall!");var a=this.object;return n.suspendpercent&&(a.suspendPercent=n.suspendpercent),a.resource=this.resourceManager.create({type:"EmptyModelResource"}),a.resource.size=[r,i,.15],a.position=o,this.object.attachWall=this.attachWall,this.attachWall.doorOrWindows.push(this.object),this.object}},{key:"_getPointOnWhichWall",value:function(e,t){var n=[],i=e.typeToChildren.StraightManualWall,r=e.typeToChildren.ModelWall;i&&(n=n.concat(i)),r&&(n=n.concat(r));for(var o=0;o<n.length;o++){var a=n[o];if(this._isPointOnLineAndBetweenPoints(C.convertToVector3(a.startCorner.position),C.convertToVector3(a.endCorner.position),C.convertToVector3(t)))return a}return null}},{key:"_isPointOnLine",value:function(e,t,n){var i=new M;return i.crossVectors(e.clone().sub(n),t.clone().sub(n)),i.length()<this.pointInLineDeviation}},{key:"_isPointOnLineAndBetweenPoints",value:function(e,t,n){if(!this._isPointOnLine(e,t,n))return!1;var i=t.x-e.x,r=t.z-e.z;return Math.abs(i)>=Math.abs(r)?i>0?e.x<=n.x&&n.x<=t.x:t.x<=n.x&&n.x<=e.x:r>0?e.z<=n.z&&n.z<=t.z:t.z<=n.z&&n.z<=e.z}}]),t}(oe),Me=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Room",n}return y(t,e),g(t,[{key:"create",value:function(){if(v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._createChildren(),this._parsePoints(),0!==this.object.points.length)return this._parseHolesPoints(),this._parseRoomResources(),this._parseRoomHeight(),this._parseRoomBlockSize(),this._parseRoomVisible(),this._parseRoomBlockAngle(),this.object;console.error("room points is null")}},{key:"_parsePoints",value:function(){if(this.jsonData.points){for(var e=[],t=0;t<this.jsonData.points.length;t++){var n=this.jsonData.points[t],i=[ae.scale*n[0],0,ae.scale*n[1]];e.push(i)}this.object.points=e}}},{key:"_parseHolesPoints",value:function(){if(this.jsonData.holes){for(var e=[],t=0;t<this.jsonData.holes.length;t++){for(var n=this.jsonData.holes[t],i=[],r=0;r<n.length;r++){var o=n[r],a=[ae.scale*o[0],0,ae.scale*o[1]];i.push(a)}e.push(i)}this.object.holes=e}}},{key:"_parseRoomResources",value:function(){this.object.floor.resource=ae.defaultFloorTextureResource,this.object.ceiling.resource=ae.defaultCeilingTextureResource,this.object.roof.resource=ae.defaultRoofTextureResource,null!==this.jsonData.floortexture&&void 0!==this.jsonData.floortexture&&(this.object.floorResource=this.resourceManager.textures[this.jsonData.floortexture],this.object.floor.resource=this.object.floorResource),null!==this.jsonData.ceilingtexture&&void 0!==this.jsonData.ceilingtexture&&(this.object.ceilingResource=this.resourceManager.textures[this.jsonData.ceilingtexture],this.object.ceiling.resource=this.object.ceilingResource),null!==this.jsonData.rooftexture&&void 0!==this.jsonData.rooftexture&&(this.object.roofResource=this.resourceManager.textures[this.jsonData.rooftexture],this.object.roof.resource=this.object.roofResource)}},{key:"_parseRoomHeight",value:function(){var e=this.jsonData,t=this.object;void 0!==e.ceilingheight?t.ceiling.height=e.ceilingheight:(t.ceiling.DefaultHeight=this.objectParent.height-.1,t.ceiling.height=t.ceiling.DefaultHeight),void 0!==e.roofheight?t.roof.height=e.roofheight:(t.roof.defaultHeight=this.objectParent.height,t.roof.height=t.roof.defaultHeight),void 0!==e.floorheight&&(t.floor.height=e.floorheight)}},{key:"_parseRoomVisible",value:function(){var e=this.jsonData,t=this.object;void 0!==e.isshowfloor&&(t.floor.isShow=e.isshowfloor),void 0!==e.isshowceiling&&(t.ceiling.isShow=e.isshowceiling),void 0!==e.isshowroof&&(t.roof.isShow=e.isshowroof)}},{key:"_parseRoomBlockSize",value:function(){var e=this.jsonData,t=this.object;if(e.floorblocksize){var n=e.floorblocksize;t.floor.blockSize=[n[0],n[1]]}if(e.ceilingblocksize){var i=e.ceilingblocksize;t.ceiling.blockSize=[i[0],i[1]]}if(e.roofblocksize){var r=e.roofblocksize;t.roof.blockSize=[r[0],r[1]]}}},{key:"_parseRoomBlockAngle",value:function(){var e=this.jsonData,t=this.object;C.checkValueEmpty(e.floorblockangle)||(t.floor.blockAngle=e.floorblockangle),C.checkValueEmpty(e.ceilingblockangle)||(t.ceiling.blockAngle=e.ceilingblockangle),C.checkValueEmpty(e.roofblockangle)||(t.roof.blockAngle=e.roofblockangle)}},{key:"_createChildren",value:function(){this._parseJsonDataChild({jsonData:{},creatorType:fe}),"FloorPlan"===this.object.parent.type&&(this._parseJsonDataChild({jsonData:{},creatorType:me}),this._parseJsonDataChild({jsonData:{},creatorType:ge}))}}]),t}(oe),Se=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Outdoors",n}return y(t,e),t}(be),Ce=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Floor",n}return y(t,e),g(t,[{key:"create",value:function(){return v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(oe),Ae=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Roof",n}return y(t,e),g(t,[{key:"create",value:function(){return v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(oe),Re=function(e){function t(e){m(this,t);var n=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Ceiling",n}return y(t,e),g(t,[{key:"create",value:function(){return v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(oe),Pe=function(){function e(t){m(this,e),this._map={0:ve,1:ye,2:be,3:_e,4:Ee,5:we,8:Te,9:Me,10:Se,22:Ce,23:Re,24:Ae}}return g(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),De=new(function(){function e(){m(this,e),this.objects=[],this._objectTypeConfig=null}return g(e,[{key:"create",value:function(e){var t=e.type;return new(0,this.objectTypeConfig[t])}},{key:"objectTypeConfig",set:function(e){this._objectTypeConfig=e},get:function(){return this._objectTypeConfig}}]),e}()),ke=function(){function e(t){m(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl}return g(e,[{key:"createResource",value:function(e){var t=this.manager.create({type:e});return t.manager=this.manager,t.baseUrl=this.manager.baseTextureUrl,t}},{key:"initDefaultResources",value:function(){var e=this.createResource("TextureResource");e.id="EB9ECFA1101C4A0ABB770ED3A9865441",e.ext="jpg",e.baseUrl=this.manager.baseTextureUrl,this.manager.defaultWallEdgeResource=e,this.manager.textures.push(e),(e=this.createResource("TextureResource")).id="81FDB96B43D441C5B3C650BFA2B76CD4",e.ext="jpg",e.isDefault=!0,this.manager.defaultWallTextureResource=e,this.manager.textures.push(e),(e=this.createResource("TextureResource")).id="IQR8PZE2SGEV2H07WX3EJK22CA6ZS0YG",e.ext="jpg",this.manager.defaultFloorTextureResource=e,this.manager.textures.push(e),(e=this.createResource("TextureResource")).id="UPEUIZIK19VMBPP9TLZJ3J3ILWK8V5ZB",e.ext="jpg",this.manager.defaultCeilingTextureResource=e,this.manager.textures.push(e),(e=this.createResource("TextureResource")).id="3OZVGE55PV0MY48FPRG5BELXKHV26NU5",e.ext="jpg",this.manager.defaultRoofTextureResource=e,this.manager.textures.push(e)}}]),e}(),je=function(){function e(t){m(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.creatorTypeConfig=new Pe,t&&t.resourceLibraryUrl&&(this.resourceLibraryUrl=t.resourceLibraryUrl)}return g(e,[{key:"setObjectTypeConfig",value:function(e){De.objectTypeConfig=e}},{key:"setObjectManager",value:function(e){re.objectManager=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"initDefaultResources",value:function(){this.resourceLibraryUrl&&(this.resourceManager.baseTextureUrl=this.resourceLibraryUrl+"/texture/",this.resourceManager.baseModelUrl=this.resourceLibraryUrl+"/model/"),this.defaultFloorTextureResource=this.createResource("TextureResource"),this.defaultFloorTextureResource.id="IQR8PZE2SGEV2H07WX3EJK22CA6ZS0YG",this.defaultFloorTextureResource.ext="jpg",this.defaultFloorTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultCeilingTextureResource=this.createResource("TextureResource"),this.defaultCeilingTextureResource.id="UPEUIZIK19VMBPP9TLZJ3J3ILWK8V5ZB",this.defaultCeilingTextureResource.ext="jpg",this.defaultCeilingTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultRoofTextureResource=this.createResource("TextureResource"),this.defaultRoofTextureResource.id="3OZVGE55PV0MY48FPRG5BELXKHV26NU5",this.defaultRoofTextureResource.ext="jpg",this.defaultRoofTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultDoorResource=this.resourceManager.emptyModelResource,ae.defaultFloorTextureResource=this.defaultFloorTextureResource,ae.defaultCeilingTextureResource=this.defaultCeilingTextureResource,ae.defaultRoofTextureResource=this.defaultRoofTextureResource,ae.defaultDoorResource=this.defaultDoorResource}},{key:"loadLightMaps",value:function(e){var t=null,n="18091219l1g1hnjt",i="png";this.defaultSetting.userDefaultWallLightMap=!0,e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(n=e.straightmanualwall.lightingtexture.id,i=e.straightmanualwall.lightingtexture.ext,this.defaultSetting.userDefaultWallLightMap=!1),this.defaultSetting.enableManaulWallLightMap&&((t=this.createResource("TextureResource")).baseUrl=this.resourceManager.baseTextureUrl,t.id=n,t.ext=i,this.resourceManager.wallLightMapResource=t),this.defaultSetting.enableFloorLightMap&&((t=this.createResource("TextureResource")).baseUrl=this.resourceManager.baseTextureUrl,t.id="18091216vjlgtwbh",t.ext="jpg",this.resourceManager.floorLightMapResource=t)}},{key:"createResource",value:function(e){var t=this.resourceManager.create({type:e});return t.manager=this.resourceManager,t}},{key:"parseObjects",value:function(e){return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),n="",i=0;i<t.length-1;i++){n+=t[i]+"/"}return n}},{key:"loadSceneJson",value:function(){var e=this;return new Promise((function(t,n){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,(function(n){e.sceneJson=JSON.parse(n),t()}),(function(){}),(function(t){n("can not load "+e.sceneURL)}))}else n("load scene json error")}))}},{key:"getResourceMaanagerLoader",value:function(){return new ke(this.resourceManager)}},{key:"parseSceneJson",value:function(){var e=this.getResourceMaanagerLoader();this.loadLightMaps(this.sceneJson.materialsetting),e.initDefaultResources(),this.initDefaultResources(),this.parseWorld(this.sceneJson)}},{key:"parseWorld",value:function(e){re.config=this.creatorTypeConfig,this.world=re.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:se})}}]),e}(),Oe=new(function(){function e(t){m(this,e),this._map={0:new je,2:new ie},this._versions=[0]}return g(e,[{key:"getLoaderManager",value:function(e){return null!=e?this._map[e]:this._map[this._versions.length-1]}}]),e}()),Fe=function(){function e(t){m(this,e),this.resourceManager=t.resourceManager,this.defaultSetting=t.defaultSetting,this.defaultResource=t.defaultResource,this.objectManager=t.objectManager,t.version&&(this.version=t.version)}return g(e,[{key:"load",value:function(e){var t=Oe.getLoaderManager(this._getVersion(e));return t.setDefaultSetting(this.defaultSetting),t.setDefaultResource(this.defaultResource),t.setResourceManager(this.resourceManager),t.setObjectManager(this.objectManager),t.parseObjects(e)}},{key:"_getVersion",value:function(e){return null!==e.version&&void 0!==e.version?e.version:null!==e.json.version&&void 0!==e.json.version?e.json.version:void 0}}]),e}();var Be=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){!function(t){var n=Object.prototype,i=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag",l=t.regeneratorRuntime;if(l)e.exports=l;else{(l=t.regeneratorRuntime=e.exports).wrap=m;var u={},c={};c[o]=function(){return this};var p=Object.getPrototypeOf,d=p&&p(p(S([])));d&&d!==n&&i.call(d,o)&&(c=d);var f=b.prototype=v.prototype=Object.create(c);y.prototype=f.constructor=b,b.constructor=y,b[s]=y.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(f),e},l.awrap=function(e){return{__await:e}},_(x.prototype),x.prototype[a]=function(){return this},l.AsyncIterator=x,l.async=function(e,t,n,i){var r=new x(m(e,t,n,i));return l.isGeneratorFunction(t)?r:r.next().then((function(e){return e.done?e.value:r.next()}))},_(f),f[s]="Generator",f[o]=function(){return this},f.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},l.values=S,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=undefined)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,i){return a.type="throw",a.arg=e,t.next=n,i&&(t.method="next",t.arg=undefined),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=i.call(o,"catchLoc"),l=i.call(o,"finallyLoc");if(s&&l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;T(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:S(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=undefined),u}}}function m(e,t,n,i){var r=t&&t.prototype instanceof v?t:v,o=Object.create(r.prototype),a=new M(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(r,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw o;return C()}for(n.method=r,n.arg=o;;){var a=n.delegate;if(a){var s=E(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=g(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,a),o}function g(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function v(){}function y(){}function b(){}function _(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function x(e){var t;this._invoke=function(n,r){function o(){return new Promise((function(t,o){!function t(n,r,o,a){var s=g(e[n],e,r);if("throw"!==s.type){var l=s.arg,u=l.value;return u&&"object"===(void 0===u?"undefined":h(u))&&i.call(u,"__await")?Promise.resolve(u.__await).then((function(e){t("next",e,o,a)}),(function(e){t("throw",e,o,a)})):Promise.resolve(u).then((function(e){l.value=e,o(l)}),a)}a(s.arg)}(n,r,t,o)}))}return t=t?t.then(o,o):o()}}function E(e,t){var n=e.iterator[t.method];if(undefined===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=undefined,E(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=g(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,u):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function S(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=undefined,t.done=!0,t};return r.next=r}}return{next:C}}function C(){return{value:undefined,done:!0}}}(function(){return this}()||Function("return this")())})),Le=function(){return this}()||Function("return this")(),Ie=Le.regeneratorRuntime&&Object.getOwnPropertyNames(Le).indexOf("regeneratorRuntime")>=0,Ne=Ie&&Le.regeneratorRuntime;Le.regeneratorRuntime=void 0;var He=Be;if(Ie)Le.regeneratorRuntime=Ne;else try{delete Le.regeneratorRuntime}catch(e){Le.regeneratorRuntime=void 0}var ze=He,Ue=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var Ve=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._initParams(),this.resource=t,this.objects=[],this.isBuilded=!1,this._awaitToNextBuildTime=.01,this._maxBuildTime=1e3}return Ue(e,[{key:"_initParams",value:function(){this.resource=null,this.objects=null,this.isBuilded=null}},{key:"add",value:function(e){this.objects.push(e)}},{key:"build",value:function(){for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t.isContainer?t._buildSelf():t.build()}this.isBuilded=!0}},{key:"containByClassType",value:function(e){for(var t=0;t<this.objects.length;t++){if(this.objects[t].type===e)return!0}return!1}},{key:"clear",value:function(){this._initParams()}}]),e}(),qe=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var Ge=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.manager=t,this._initParams(),this.resources=[],this.isBuilded=!1}return qe(e,[{key:"_initParams",value:function(){this.resources=null,this.isBuilded=null,this._allBuildedCallback=null}},{key:"add",value:function(e){this.resources.push(e)}},{key:"build",value:function(e){this._allBuildedCallback=e;for(var t=0;t<this.resources.length;t++){var n=this.resources[t];n.registerBuildCallbackListener(this._checkAllResourceBuilded,{unit:this}),n.build()}}},{key:"_checkAllResourceBuilded",value:function(e,t){var n=t.unit;if(!n.isBuilded){for(var i=n.resources,r=0;r<i.length;r++){if(!i[r].isBuilded)return}n.isBuilded=!0,n._allBuildedCallback&&n._allBuildedCallback()}}},{key:"clear",value:function(){this._initParams()}},{key:"isFull",get:function(){return this.resources.length>this.manager.maxResourcesUnitDownloadNumber}}]),e}(),We=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var Xe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._initParams(),this.buildUnits=[]}return We(e,[{key:"_initParams",value:function(){this.buildUnits=null,this.currentAddingBuildUnit=null}},{key:"addResourceDownloadRequest",value:function(e){this.currentAddingBuildUnit&&!this.currentAddingBuildUnit.isFull||(this.currentAddingBuildUnit=new Ge,this.buildUnits.push(this.currentAddingBuildUnit)),this.currentAddingBuildUnit.add(e)}},{key:"startToDownloadRequestResources",value:function(e){var t=this;if(0!==t.requestDownloadResources.length&&(this.downloadResProgess=(this.curDonwloadResIndex-this.currentDownloadResMap.size)/t.requestDownloadResources.length,e&&e(this.downloadResProgess)),this.isStartedDonwloadResouces){if(this.curDonwloadResIndex===this.requestDownloadResources.length-1&&0===this.currentDownloadResMap.size)return this.downloadResProgess=1,void(e&&e(this.downloadResProgess))}else{t.requestDownloadResources;this.isStartedDonwloadResouces=!0,this.curDonwloadResIndex=0,this.currentDownloadResMap=new Map}if(0===this.requestDownloadResources.length)return this.downloadResProgess=1,void(e&&e(this.downloadResProgess));if(!(this.curDonwloadResIndex>this.requestDownloadResources.length-1)&&0!==this.downloadResMaxCount-this.currentDownloadResMap.size){var n=this.requestDownloadResources[this.curDonwloadResIndex];new Promise((function(e,t){n.registerBuildCallbackListener((function(){e(n)})),n.build()})).then((function(n){t.currentDownloadResMap.delete(n.id),t.startToDownloadRequestResources(e)})),this.currentDownloadResMap.set(n.id,n),this.curDonwloadResIndex++,this.startToDownloadRequestResources(e)}}},{key:"clear",value:function(){this._initParams()}}]),e}(),Je=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var Ye=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="empty",this.isBuilded=!1,this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[]}return Je(e,[{key:"build",value:function(e){e&&e(this),this.isBuilded=!0,this.notifyBuildCompleteListeners()}},{key:"registerBuildCallbackListener",value:function(e,t){this.buildCompleteCallbacks.push(e),this.buildCompleteCallbackParams.push(t)}},{key:"notifyBuildCompleteListeners",value:function(){for(var e=0;e<this.buildCompleteCallbacks.length;e++){(0,this.buildCompleteCallbacks[e])(this,this.buildCompleteCallbackParams[e])}this._alreadyCallback=!0}}]),e}()),Qe=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var Ze=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._initParams(),this.resourceBuildManager=new Xe,this.objectsBuildUnitMap=new Map,this.objectsBuildUnits=[],this.modelsResourcesBuildUnits=[],this.textureResourcesBuildUnits=[],this._emptyResource=Ye,this.currentBuildingResourcesUnit=null,this.maxResourcesUnitDownloadNumber=200,this.awaitToNextBuildTime=12e3}var t,n;return Qe(e,[{key:"_initParams",value:function(){this.resourceBuildManager=null,this.world=null,this.objectsBuildUnitMap=null,this.objectsBuildUnits=null,this.readyResourceUnits=null,this.unreadyResourceUnits=null,this._stopUpdateBuild=null,this._buildingUnits=null,this.buildingProgressCallback=null,this._awaitToNextBuildTime=0,this._resourceBuildUnitAwaitToNextBuildTime=null,this._resourceBuildUnitMaxBuildTime=null,this._emptyResource=null}},{key:"build",value:function(e){this.buildingProgressCallback=e,this.initRequestBuildUnits(),this._buildingUnits=[].concat(this.readyResourceUnits).concat(this.unreadyResourceUnits);for(var t=0;t<this._buildingUnits.length;t++){var n=this._buildingUnits[t].resource;null!==n&&this.addResourceDownloadRequest(n)}this._stopUpdateBuild=!1,this._updateBuildUnit()}},{key:"addResourceDownloadRequest",value:function(e){"TextureResource"===e.type?((0===this.textureResourcesBuildUnits.length||this.textureResourcesBuildUnits[this.textureResourcesBuildUnits.length-1].isFull)&&this.textureResourcesBuildUnits.push(new Ge(this)),this.textureResourcesBuildUnits[this.textureResourcesBuildUnits.length-1].add(e)):((0===this.modelsResourcesBuildUnits.length||this.modelsResourcesBuildUnits[this.modelsResourcesBuildUnits.length-1].isFull)&&this.modelsResourcesBuildUnits.push(new Ge(this)),this.modelsResourcesBuildUnits[this.modelsResourcesBuildUnits.length-1].add(e))}},{key:"initRequestBuildUnits",value:function(){this.sortobjectsBuildUnits(),this.readyResourceUnits=[],this.unreadyResourceUnits=[];for(var e=0;e<this.objectsBuildUnits.length;e++){var t=this.objectsBuildUnits[e],n=t.resource;n&&n.ready?this.readyResourceUnits.push(t):n&&this.unreadyResourceUnits.push(t)}}},{key:"sortobjectsBuildUnits",value:function(){for(var e=[],t=[],n=[],i=[],r=[],o=[],a=[],s=[],l=0;l<this.objectsBuildUnits.length;l++){var u=this.objectsBuildUnits[l];u.containByClassType("CombineStraightManualWall")?e.push(u):u.containByClassType("CombineRoof")?o.push(u):u.containByClassType("CombineModelWall")?n.push(u):u.containByClassType("CombinePlacementWall")?i.push(u):u.containByClassType("CombineFloor")?a.push(u):u.containByClassType("CombineCeiling")?r.push(u):u.containByClassType("CombineDoorOrWindow")?s.push(u):t.push(u)}this.objectsBuildUnits=[].concat(e).concat(o).concat(a).concat(r).concat(s).concat(n).concat(i).concat(t)}},{key:"_updateBuildUnit",value:function(){if(0!==this.textureResourcesBuildUnits.length||0!==this.modelsResourcesBuildUnits.length){var e=this;this.currentBuildingResourcesUnit||(0!==this.textureResourcesBuildUnits.length?this.currentBuildingResourcesUnit=this.textureResourcesBuildUnits.shift():0!==this.modelsResourcesBuildUnits.length&&(this.currentBuildingResourcesUnit=this.modelsResourcesBuildUnits.shift())),this.currentBuildingResourcesUnit.build((function(){e._buildResourcesUnitToObjectsUnit()}))}else this.checkBuildComplete()}},{key:"_buildResourcesUnitToObjectsUnit",value:(t=ze.mark((function e(){var t,n,i,r;return ze.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(t=this).currentBuildingResourcesUnit.resources,i=new Date;case 3:if(0!==n.length){e.next=10;break}return t.currentBuildingResourcesUnit=null,t._updateBuildUnit(),e.abrupt("return");case 10:if(r=n.shift(),t.objectsBuildUnitMap.get(r).build(),!(new Date-i>this.awaitToNextBuildTime)){e.next=16;break}return e.next=16,this.awaitToNextBuild();case 16:this.checkBuildComplete();case 17:e.next=3;break;case 19:case"end":return e.stop()}}),e,this)})),n=function(){var e=t.apply(this,arguments);return new Promise((function(t,n){return function i(r,o){try{var a=e[r](o),s=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(s).then((function(e){i("next",e)}),(function(e){i("throw",e)}));t(s)}("next")}))},function(){return n.apply(this,arguments)})},{key:"checkBuildComplete",value:function(){for(var e=[],t=!0,n=0;n<this.objectsBuildUnits.length;n++){var i=this.objectsBuildUnits[n];i.isBuilded?e.push(i):t=!1}var r=null;0===this.objectsBuildUnits.length?(t=!0,r=1):r=e.length/this.objectsBuildUnits.length,t&&this._clearUpdateBuildUnit(),this.buildingProgressCallback&&this.buildingProgressCallback(r)}},{key:"_clearUpdateBuildUnit",value:function(){for(var e=0;e<this.objectsBuildUnits.length;e++){this.objectsBuildUnits[e].clear()}for(var t=0;t<this.unreadyResourceUnits.length;t++){this.unreadyResourceUnits[t].clear()}for(var n=0;n<this.readyResourceUnits.length;n++){this.readyResourceUnits[n].clear()}this.objectsBuildUnits=[],this.unreadyResourceUnits=[],this.readyResourceUnits=[],this.objectsBuildUnitMap.clear(),this._stopUpdateBuild=!0}},{key:"awaitToNextBuild",value:function(){var e=this;return new Promise((function(t){setTimeout((function(){t("resolved")}),e._awaitToNextBuildTime)}))}},{key:"requestToBuild",value:function(e){var t=this.world.findObjectByID(e);null!==t&&this.addObject(t)}},{key:"disposeObject",value:function(e){var t=this.world.findObjectByID(e);t&&t.clear()}},{key:"addObject",value:function(e){this.addChildren(e);var t=e.resources;if(t.length>0)for(var n=0;n<t.length;n++){var i=t[n];this.addSingleResourceObject(e,i)}else this.addSingleResourceObject(e,this._emptyResource)}},{key:"addChildren",value:function(e){for(var t=e.children,n=0;n<t.length;n++){var i=t[n];this.addObject(i)}}},{key:"addSingleResourceObject",value:function(e,t){if(t||null!=(t=e.resource)){if(!this.objectsBuildUnitMap.has(t)){var n=new Ve(t);this.objectsBuildUnits.push(n),this.objectsBuildUnitMap.set(t,n)}this.objectsBuildUnitMap.get(t).add(e)}}},{key:"clear",value:function(){this.resourceBuildManager.clear(),this._clearUpdateBuildUnit(),this._initParams()}}]),e}(),Ke={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=new Array(36),i=0;return function(){for(var r=0;r<36;r++)8===r||13===r||18===r||23===r?n[r]="-":14===r?n[r]="4":(i<=2&&(i=33554432+16777216*Math.random()|0),e=15&i,i>>=4,n[r]=t[19===r?3&e|8:e]);return n.join("")}}(),clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Ke.DEG2RAD},radToDeg:function(e){return e*Ke.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}},$e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},et=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),tt=function(){function e(t,n,i,r){$e(this,e),this._x=t||0,this._y=n||0,this._z=i||0,this._w=void 0!==r?r:1}return et(e,[{key:"slerp",value:function(e,t,n,i){return n.copy(e).slerp(t,i)}},{key:"slerpFlat",value:function(e,t,n,i,r,o,a){var s=n[i+0],l=n[i+1],u=n[i+2],c=n[i+3],h=r[o+0],p=r[o+1],d=r[o+2],f=r[o+3];if(c!==f||s!==h||l!==p||u!==d){var m=1-a,g=s*h+l*p+u*d+c*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),_=Math.atan2(b,g*v);m=Math.sin(m*_)/b,a=Math.sin(a*_)/b}var x=a*v;if(s=s*m+h*x,l=l*m+p*x,u=u*m+d*x,c=c*m+f*x,m===1-a){var E=1/Math.sqrt(s*s+l*l+u*u+c*c);s*=E,l*=E,u*=E,c*=E}}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=c}},{key:"set",value:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this.onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,i=e._y,r=e._z,o=e.order,a=Math.cos,s=Math.sin,l=a(n/2),u=a(i/2),c=a(r/2),h=s(n/2),p=s(i/2),d=s(r/2);return"XYZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"YXZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"ZXY"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"ZYX"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"YZX"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c-h*p*d):"XZY"===o&&(this._x=h*u*c-l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c+h*p*d),!1!==t&&this.onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this.onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t,n=e.elements,i=n[0],r=n[4],o=n[8],a=n[1],s=n[5],l=n[9],u=n[2],c=n[6],h=n[10],p=i+s+h;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(c-l)*t,this._y=(o-u)*t,this._z=(a-r)*t):i>s&&i>h?(t=2*Math.sqrt(1+i-s-h),this._w=(c-l)/t,this._x=.25*t,this._y=(r+a)/t,this._z=(o+u)/t):s>h?(t=2*Math.sqrt(1+s-i-h),this._w=(o-u)/t,this._x=(r+a)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+h-i-s),this._w=(a-r)/t,this._x=(o+u)/t,this._y=(l+c)/t,this._z=.25*t),this.onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n,i=new nt;return void 0===i&&(i=new nt),(n=e.dot(t)+1)<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?i.set(-e.y,e.x,0):i.set(0,-e.z,e.y)):i.crossVectors(e,t),this._x=i.x,this._y=i.y,this._z=i.z,this._w=n,this.normalize()}},{key:"inverse",value:function(){return this.conjugate().normalize()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,i=e._y,r=e._z,o=e._w,a=t._x,s=t._y,l=t._z,u=t._w;return this._x=n*u+o*a+i*l-r*s,this._y=i*u+o*s+r*a-n*l,this._z=r*u+o*l+n*s-i*a,this._w=o*u-n*a-i*s-r*l,this.onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,i=this._y,r=this._z,o=this._w,a=o*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;var s=Math.sqrt(1-a*a);if(Math.abs(s)<.001)return this._w=.5*(o+this._w),this._x=.5*(n+this._x),this._y=.5*(i+this._y),this._z=.5*(r+this._z),this;var l=Math.atan2(s,a),u=Math.sin((1-t)*l)/s,c=Math.sin(t*l)/s;return this._w=o*u+this._w*c,this._x=n*u+this._x*c,this._y=i*u+this._y*c,this._z=r*u+this._z*c,this.onChangeCallback(),this}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"onChange",value:function(e){return this.onChangeCallback=e,this}},{key:"onChangeCallback",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}]),e}(),nt=function(){function e(t,n,i){$e(this,e),this.x=t||0,this.y=n||0,this.z=i||0,this.isVector3=!0}return et(e,[{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(){var e=new tt;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}()}},{key:"applyAxisAngle",value:function(){var e=new tt;return function(t,n){return this.applyQuaternion(e.setFromAxisAngle(t,n))}()}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*i-a*n,u=s*n+a*t-r*i,c=s*i+r*n-o*t,h=-r*t-o*n-a*i;return this.x=l*s+h*-r+u*-a-c*-o,this.y=u*s+h*-o+c*-r-l*-a,this.z=c*s+h*-a+l*-o-u*-r,this}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(){var t=new e,n=new e;return function(e,i){return t.set(e,e,e),n.set(i,i,i),this.clamp(t,n)}()}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:"cross",value:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,i=this.y,r=this.z;return this.x=i*e.z-r*e.y,this.y=r*e.x-n*e.z,this.z=n*e.y-i*e.x,this}},{key:"crossVectors",value:function(e,t){var n=e.x,i=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-r*a,this.y=r*o-n*s,this.z=n*a-i*o,this}},{key:"projectOnVector",value:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)}},{key:"projectOnPlane",value:function(){var t=new e;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}},{key:"reflect",value:function(){var t=new e;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}()}},{key:"angleTo",value:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(Ke.clamp(t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this}},{key:"setFromCylindrical",value:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}]),e}(),it=function(){function e(t,n){$e(this,e),this.isBox3=!0,this.min=void 0!==t?t:new nt(1/0,1/0,1/0),this.max=void 0!==n?n:new nt(-1/0,-1/0,-1/0)}return et(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,l=e.length;s<l;s+=3){var u=e[s],c=e[s+1],h=e[s+2];u<t&&(t=u),c<n&&(n=c),h<i&&(i=h),u>r&&(r=u),c>o&&(o=c),h>a&&(a=h)}return this.min.set(t,n,i),this.max.set(r,o,a),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,l=e.count;s<l;s++){var u=e.getX(s),c=e.getY(s),h=e.getZ(s);u<t&&(t=u),c<n&&(n=c),h<i&&(i=h),u>r&&(r=u),c>o&&(o=c),h>a&&(a=h)}return this.min.set(t,n,i),this.max.set(r,o,a),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=(new nt).copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"setFromObject",value:function(e){return this.makeEmpty(),this.expandByObject(e)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){var t=e||new nt;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){var t=e||new nt;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){var t=new nt,n=this;return e.updateMatrixWorld(!0),e.traverse((function(e){var i,r,o=e.geometry;if(void 0!==o)if(o.isGeometry){var a=o.vertices;for(i=0,r=a.length;i<r;i++)t.copy(a[i]),t.applyMatrix4(e.matrixWorld),n.expandByPoint(t)}else if(o.isBufferGeometry){var s=o.attributes.position;if(void 0!==s)for(i=0,r=s.count;i<r;i++)t.fromBufferAttribute(s,i).applyMatrix4(e.matrixWorld),n.expandByPoint(t)}})),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return(t||new nt).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=e.constant&&n>=e.constant}},{key:"clampPoint",value:function(e,t){return(t||new nt).copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return(new nt).copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){var t=[new nt,new nt,new nt,new nt,new nt,new nt,new nt,new nt];return this.isEmpty()||(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(t)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}();function rt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(rt.prototype,{isMatrix4:!0,set:function(e,t,n,i,r,o,a,s,l,u,c,h,p,d,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new rt).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(){var e=new nt;return function(t){var n=this.elements,i=t.elements,r=1/e.setFromMatrixColumn(t,0).length(),o=1/e.setFromMatrixColumn(t,1).length(),a=1/e.setFromMatrixColumn(t,2).length();return n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n[4]=i[4]*o,n[5]=i[5]*o,n[6]=i[6]*o,n[8]=i[8]*a,n[9]=i[9]*a,n[10]=i[10]*a,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(i),l=Math.sin(i),u=Math.cos(r),c=Math.sin(r);if("XYZ"===e.order){var h=o*u,p=o*c,d=a*u,f=a*c;t[0]=s*u,t[4]=-s*c,t[8]=l,t[1]=p+d*l,t[5]=h-f*l,t[9]=-a*s,t[2]=f-h*l,t[6]=d+p*l,t[10]=o*s}else if("YXZ"===e.order){var m=s*u,g=s*c,v=l*u,y=l*c;t[0]=m+y*a,t[4]=v*a-g,t[8]=o*l,t[1]=o*c,t[5]=o*u,t[9]=-a,t[2]=g*a-v,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order){m=s*u,g=s*c,v=l*u,y=l*c;t[0]=m-y*a,t[4]=-o*c,t[8]=v+g*a,t[1]=g+v*a,t[5]=o*u,t[9]=y-m*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){h=o*u,p=o*c,d=a*u,f=a*c;t[0]=s*u,t[4]=d*l-p,t[8]=h*l+f,t[1]=s*c,t[5]=f*l+h,t[9]=p*l-d,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var b=o*s,_=o*l,x=a*s,E=a*l;t[0]=s*u,t[4]=E-b*c,t[8]=x*c+_,t[1]=c,t[5]=o*u,t[9]=-a*u,t[2]=-l*u,t[6]=_*c+x,t[10]=b-E*c}else if("XZY"===e.order){b=o*s,_=o*l,x=a*s,E=a*l;t[0]=s*u,t[4]=-c,t[8]=l*u,t[1]=b*c+E,t[5]=o*u,t[9]=_*c-x,t[2]=x*c-_,t[6]=a*u,t[10]=E*c+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,n=e._x,i=e._y,r=e._z,o=e._w,a=n+n,s=i+i,l=r+r,u=n*a,c=n*s,h=n*l,p=i*s,d=i*l,f=r*l,m=o*a,g=o*s,v=o*l;return t[0]=1-(p+f),t[4]=c-v,t[8]=h+g,t[1]=c+v,t[5]=1-(u+f),t[9]=d-m,t[2]=h-g,t[6]=d+m,t[10]=1-(u+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new nt,t=new nt,n=new nt;return function(i,r,o){var a=this.elements;return n.subVectors(i,r),0===n.lengthSq()&&(n.z=1),n.normalize(),e.crossVectors(o,n),0===e.lengthSq()&&(1===Math.abs(o.z)?n.x+=1e-4:n.z+=1e-4,n.normalize(),e.crossVectors(o,n)),e.normalize(),t.crossVectors(n,e),a[0]=e.x,a[4]=t.x,a[8]=n.x,a[1]=e.y,a[5]=t.y,a[9]=n.y,a[2]=e.z,a[6]=t.z,a[10]=n.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],u=n[1],c=n[5],h=n[9],p=n[13],d=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],_=n[15],x=i[0],E=i[4],w=i[8],T=i[12],M=i[1],S=i[5],C=i[9],A=i[13],R=i[2],P=i[6],D=i[10],k=i[14],j=i[3],O=i[7],F=i[11],B=i[15];return r[0]=o*x+a*M+s*R+l*j,r[4]=o*E+a*S+s*P+l*O,r[8]=o*w+a*C+s*D+l*F,r[12]=o*T+a*A+s*k+l*B,r[1]=u*x+c*M+h*R+p*j,r[5]=u*E+c*S+h*P+p*O,r[9]=u*w+c*C+h*D+p*F,r[13]=u*T+c*A+h*k+p*B,r[2]=d*x+f*M+m*R+g*j,r[6]=d*E+f*S+m*P+g*O,r[10]=d*w+f*C+m*D+g*F,r[14]=d*T+f*A+m*k+g*B,r[3]=v*x+y*M+b*R+_*j,r[7]=v*E+y*S+b*P+_*O,r[11]=v*w+y*C+b*D+_*F,r[15]=v*T+y*A+b*k+_*B,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new nt;return function(t){for(var n=0,i=t.count;n<i;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.applyMatrix4(this),t.setXYZ(n,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],a=e[5],s=e[9],l=e[13],u=e[2],c=e[6],h=e[10],p=e[14];return e[3]*(+r*s*c-i*l*c-r*a*h+n*l*h+i*a*p-n*s*p)+e[7]*(+t*s*p-t*l*h+r*o*h-i*o*p+i*l*u-r*s*u)+e[11]*(+t*l*c-t*a*p-r*o*c+n*o*p+r*a*u-n*l*u)+e[15]*(-i*a*u-t*s*c+t*a*h+i*o*c-n*o*h+n*s*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,i=e.elements,r=i[0],o=i[1],a=i[2],s=i[3],l=i[4],u=i[5],c=i[6],h=i[7],p=i[8],d=i[9],f=i[10],m=i[11],g=i[12],v=i[13],y=i[14],b=i[15],_=d*y*h-v*f*h+v*c*m-u*y*m-d*c*b+u*f*b,x=g*f*h-p*y*h-g*c*m+l*y*m+p*c*b-l*f*b,E=p*v*h-g*d*h+g*u*m-l*v*m-p*u*b+l*d*b,w=g*d*c-p*v*c-g*u*f+l*v*f+p*u*y-l*d*y,T=r*_+o*x+a*E+s*w;if(0===T){var M="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(M);return console.warn(M),this.identity()}var S=1/T;return n[0]=_*S,n[1]=(v*f*s-d*y*s-v*a*m+o*y*m+d*a*b-o*f*b)*S,n[2]=(u*y*s-v*c*s+v*a*h-o*y*h-u*a*b+o*c*b)*S,n[3]=(d*c*s-u*f*s-d*a*h+o*f*h+u*a*m-o*c*m)*S,n[4]=x*S,n[5]=(p*y*s-g*f*s+g*a*m-r*y*m-p*a*b+r*f*b)*S,n[6]=(g*c*s-l*y*s-g*a*h+r*y*h+l*a*b-r*c*b)*S,n[7]=(l*f*s-p*c*s+p*a*h-r*f*h-l*a*m+r*c*m)*S,n[8]=E*S,n[9]=(g*d*s-p*v*s-g*o*m+r*v*m+p*o*b-r*d*b)*S,n[10]=(l*v*s-g*u*s+g*o*h-r*v*h-l*o*b+r*u*b)*S,n[11]=(p*u*s-l*d*s-p*o*h+r*d*h+l*o*m-r*u*m)*S,n[12]=w*S,n[13]=(p*v*a-g*d*a+g*o*f-r*v*f-p*o*y+r*d*y)*S,n[14]=(g*u*a-l*v*a-g*o*c+r*v*c+l*o*y-r*u*y)*S,n[15]=(l*d*a-p*u*a+p*o*c-r*d*c-l*o*f+r*u*f)*S,this},scale:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,a=e.y,s=e.z,l=r*o,u=r*a;return this.set(l*o+n,l*a-i*s,l*s+i*a,0,l*a+i*s,u*a+n,u*s-i*o,0,l*s-i*a,u*s+i*o,r*s*s+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){return this.makeRotationFromQuaternion(t),this.scale(n),this.setPosition(e),this},decompose:function(){var e=new nt,t=new rt;return function(n,i,r){var o=this.elements,a=e.set(o[0],o[1],o[2]).length(),s=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();this.determinant()<0&&(a=-a),n.x=o[12],n.y=o[13],n.z=o[14],t.copy(this);var u=1/a,c=1/s,h=1/l;return t.elements[0]*=u,t.elements[1]*=u,t.elements[2]*=u,t.elements[4]*=c,t.elements[5]*=c,t.elements[6]*=c,t.elements[8]*=h,t.elements[9]*=h,t.elements[10]*=h,i.setFromRotationMatrix(t),r.x=a,r.y=s,r.z=l,this}}(),makePerspective:function(e,t,n,i,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*r/(t-e),l=2*r/(n-i),u=(t+e)/(t-e),c=(n+i)/(n-i),h=-(o+r)/(o-r),p=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(e,t,n,i,r,o){var a=this.elements,s=1/(t-e),l=1/(n-i),u=1/(o-r),c=(t+e)*s,h=(n+i)*l,p=(o+r)*u;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,n=e.elements,i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}});!function(){function e(t,n){$e(this,e),this.x=t||0,this.y=n||0,this.isVector2=!0}et(e,[{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(){var t=new e,n=new e;return function(e,i){return t.set(e,e),n.set(i,i),this.clamp(t,n)}()}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}},{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}}])}();var ot="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},at=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},st=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),lt=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},ut=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},ct=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},ht=function(){function e(){at(this,e)}return st(e,null,[{key:"uuid",value:function(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var n=e.join("");return n}},{key:"approximatelyNumberEqual",value:function(e,t,n){var i=1e-4;return void 0!==n&&(i=n),Math.abs(e-t)<i}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),n={};e.traverse((function(e){e.isSkinnedMesh&&(n[e.name]=e)}));var i={},r={};t.traverse((function(e){e.isBone&&(i[e.name]=e),e.isSkinnedMesh&&(r[e.name]=e)}));var o=!1;for(var a in n){o=!0;for(var s=n[a].skeleton,l=r[a],u=[],c=0;c<s.bones.length;++c){var h=i[s.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,s.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":ot(t)))return t;if(t instanceof Date)return(n=new Date).setTime(t.getTime()),n;if(t instanceof Array|t instanceof Object){var n=t instanceof Array?[]:{};for(var i in t)t.hasOwnProperty(i)&&(n[i]=e.cloneJSObject(t[i]));return n}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}},{key:"calTwoPositionLength",value:function(t,n){var i=e.subPosition(t,n);return i=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],Math.sqrt(i)}},{key:"subPosition",value:function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}},{key:"normalizeDirection",value:function(t){var n=e.calTwoPositionLength([0,0,0],t);if(1===n)return t;var i=t;return 0===n?(i[0]=0,i[1]=0,i[2]=0,i):(n=1/n,i[0]*=n,i[1]*=n,i[2]*=n,i)}}]),e}(),pt=function(){function e(){at(this,e),this.type="BaseObject",this._initParams(),this.calculaterData={}}return st(e,[{key:"_initParams",value:function(){this.id=ht.uuid(),this.name=null,this.userID=null,this.properties=null,this.resource=null,this._resources=null,this.position=[0,0,0],this.rotation=[0,0,0,1],this.scale=[1,1,1],this._parent=null,this.children=[],this.typeToChildren={},this.lowerCaseProperties=null,this.visible=!0,this.mesh=null,this.calculater=null,this.meshBuilder=null,this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this._isSelfBuilded=!1,this._size=null,this._box3=null,this._selfSize=null,this._center=null,this._isRequestResource=!1,this._isNotifyListeners=!1}},{key:"_getCalculateSizeObjects",value:function(){return this.children}},{key:"_addChild",value:function(e){this.children.push(e),this.typeToChildren[e.type]||(this.typeToChildren[e.type]=[]),this.typeToChildren[e.type].push(e),e.registerBuildCallbackListener(this._childBuildCallback,{obj:this})}},{key:"_childBuildCallback",value:function(e,t){var n=t.obj;n.isChildrenBuilded&&n._isSelfBuilded&&n.notifyBuildCompleteListeners()}},{key:"_removeChild",value:function(e){var t=this.children.indexOf(e);t>-1&&this.children.splice(t,1),(t=this.typeToChildren[e.type].indexOf(e))>-1&&this.typeToChildren[e.type].splice(t,1),e.removeBuildCallbackListener(this._childBuildCallback)}},{key:"build",value:function(e){e&&this.registerBuildCallbackListener(e),this.isBuilded||(this.isResourcesBuilded?(this.buildSelf(),this.buildChildren(),this.isChildrenBuilded&&this.notifyBuildCompleteListeners()):this._initResources())}},{key:"calculate",value:function(){this.calculater&&this.calculater.build(this)}},{key:"createMesh",value:function(){if(this.meshBuilder)return this.meshBuilder.build(this)}},{key:"_initResources",value:function(){if(!this._isRequestResource){for(var e=0;e<this.resources.length;e++){var t=this.resources[e];t.isBuilded||(t.registerBuildCallbackListener(this._resourceBuildedCallback,{object:this}),t.build())}this._isRequestResource=!0}}},{key:"_resourceBuildedCallback",value:function(e,t){var n=t.object;e.isBuilded&&n.build()}},{key:"buildSelf",value:function(){this._buildSelf()}},{key:"_buildSelf",value:function(){this._isSelfBuilded||(this.calculate(),this.createMesh(),this._isSelfBuilded=!0,this.isChildrenBuilded&&this.notifyBuildCompleteListeners())}},{key:"buildChildren",value:function(){this._buildChildren()}},{key:"_buildChildren",value:function(){if(!this.isChildrenBuilded)for(var e=0;e<this.children.length;e++){this.children[e].build()}}},{key:"registerBuildCallbackListener",value:function(e,t){this.buildCompleteCallbacks.push(e),this.buildCompleteCallbackParams.push(t)}},{key:"removeBuildCallbackListener",value:function(){}},{key:"notifyBuildCompleteListeners",value:function(){if(!this._isNotifyListeners){for(var e=0;e<this.buildCompleteCallbacks.length;e++){(0,this.buildCompleteCallbacks[e])(this,this.buildCompleteCallbackParams[e])}this._isNotifyListeners=!0}}},{key:"findObjectByID",value:function(e){if(!e)return null;if(this.id===e)return this;if(this.children)for(var t=0;t<this.children.length;t++){var n=this.children[t];if(n.id===e)return n;var i=n.findObjectByID(e);if(i)return i}return null}},{key:"findObjectByUserID",value:function(e){if(!e)return null;if(this.userID===e)return this;if(this.children)for(var t=0;t<this.children.length;t++){var n=this.children[t];if(n.userID===e)return n;var i=n.findObjectByUserID(e);if(i)return i}return null}},{key:"clear",value:function(){for(var e=0;e<this.children.length;e++){this.children[e].clear()}this.calculater=null,this.meshBuilder=null,this._initParams(),this.id=null}},{key:"deepClone",value:function(e){var t=Array.isArray(e)?[]:{};if(e&&"object"===(void 0===e?"undefined":ot(e)))for(var n in e)e.hasOwnProperty(n)&&(t[n]=e&&"object"===ot(e[n])?this.deepClone(e[n]):e[n]);return t}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){return null===this._selfSize?[0,0,0]:this._selfSize}},{key:"center",get:function(){if(null===this._center){if(!this.size||!this._box3)return[0,0,0];this._center=this._box3.getCenter().toArray()}return this._center}},{key:"size",set:function(e){this._size=e,0===this.children.length&&(this.selfSize=e)},get:function(){if(null===this._size)if(this.children.length>0){if(this._box3=new it,0!==this.selfSize[0]&&0!==this.selfSize[1]&&0!==this.selfSize[2]){var e=new nt(this.position[0],this.position[1],this.position[2]);e.y+=this.selfSize[1]/2,this._box3.setFromCenterAndSize(e,new nt(this.selfSize[0],this.selfSize[1],this.selfSize[2]))}for(var t=this._getCalculateSizeObjects(),n=0;n<t.length;n++){var i=t[n];i.size&&i._box3&&this._box3.union(i._box3)}this._size=this._box3.getSize().toArray()}else this._size=this.selfSize;return this._size}},{key:"parent",get:function(){return this._parent},set:function(e){this._parent!==e&&(null!==this._parent&&this._parent._removeChild(this),null!=e&&(this._parent=e,this._parent&&this._parent._addChild(this)))}},{key:"isContainer",get:function(){return this.children.length>0}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.resource&&this._resources.push(this.resource)),this._resources}},{key:"isBuilded",get:function(){return this.isChildrenBuilded&&this._isSelfBuilded}},{key:"isChildrenBuilded",get:function(){if(this.isContainer){if(this.children.length>0){for(var e=0;e<this.children.length;e++){if(!this.children[e].isBuilded)return!1}return!0}return!0}return!0}},{key:"isResourcesBuilded",get:function(){for(var e=0;e<this.resources.length;e++){if(!this.resources[e].isBuilded)return!1}return!0}}]),e}(),dt={StraightManualWall:"StraightManualWall",WallCorner:"WallCorner",FloorPlan:"FloorPlan",Room:"Room",CombineStraightManualWall:"CombineStraightManualWall",Floor:"Floor",Ceiling:"Ceiling",Roof:"Roof",CombineDoorOrWindow:"CombineDoorOrWindow",CombinePlacement:"CombinePlacement",CombinePlacementWall:"CombinePlacementWall",Placement:"Placement",PlacementGroup:"PlacementGroup",CombineFloor:"CombineFloor",CombineCeiling:"CombineCeiling",CombineRoof:"CombineRoof",CombineModelWall:"CombineModelWall",CombinePlacementGroup:"CombinePlacementGroup",PlacementWall:"PlacementWall",PlacementGround:"PlacementGround",VideoProbe:"VideoProbe",CurveLine:"CurveLine",LeakWaterLine:"LeakWaterLine",ArrowLine:"ArrowLine",ArrowDataLine:"ArrowDataLine",RouteLine:"RouteLine"},ft=function(e){function t(e){at(this,t);var n=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.dataJson=e,n.type="Room",n}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.dataJson=null,this.holePaths=[],this._points=[],this._holes=[],this._uv2=[],this.offset=null,this.parentPosition=null,this._floor=null,this._roof=null,this._ceiling=null,this.floorResource=null,this.ceilingResource=null,this.roofResource=null,this.isOnlyFloor=!1}},{key:"clear",value:function(){this.floor&&this.floor.clear(),this.roof&&this.roof.clear(),this.ceiling&&this.ceiling.clear(),lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"size",set:function(e){this._size=e},get:function(){return null===this._size&&(this._size=[0,0,0]),this._size}},{key:"floor",get:function(){return null===this._floor&&this.typeToChildren[dt.Floor]&&(this._floor=this.typeToChildren[dt.Floor][0]),this._floor}},{key:"ceiling",get:function(){return null===this._ceiling&&this.typeToChildren[dt.Ceiling]&&(this._ceiling=this.typeToChildren[dt.Ceiling][0]),this._ceiling}},{key:"roof",get:function(){return null===this._roof&&this.typeToChildren[dt.Roof]&&(this._roof=this.typeToChildren[dt.Roof][0]),this._roof}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.resource&&this._resources.push(this.resource)),this._resources}},{key:"points",set:function(e){this._points=e},get:function(){return this._points}},{key:"holes",set:function(e){this._holes=e},get:function(){return this._holes}}]),t}(pt),mt=function e(){at(this,e)};mt.StraightManualWallHeight=3,mt.StraightManualWallThick=.15,mt.enableDelayLoadMode=!0,mt.enableManaulWallLightMap=!0,mt.enableFloorLightMap=!0,mt.wallLightMapIntensity=3.8,mt.enableUseHighestVersionResource=!0,mt.enableCombine=!0,mt.ableToSupportFootAndHeadModelWalls=["C9FB3F9A29C842F79F02CECC4037FEA1"];var gt=function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Ceiling",e}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.blockSize=[.6,.6],this.blockAngle=0,this.DefaultHeight=2.9,this.height=this.DefaultHeight}},{key:"size",get:function(){return null===this._size&&(this._size=[0,0,0]),this._size},set:function(e){this._size=e}}]),t}(pt),vt=function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Roof",e}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.DefaultHeight=3,this.height=this.DefaultHeight,this.blockSize=[2,2],this.blockAngle=0}},{key:"size",set:function(e){this._size=e},get:function(){return null===this._size&&(this._size=[0,0,0]),this._size}}]),t}(pt),yt=function e(){at(this,e)};yt.wallTexture=null,yt.wallEdgeTexture=null,yt.floorTexture=null,yt.ceilingTexture=null,yt.roofTexture=null,yt.wallLigthMapTexture=null,yt.floorLightMapTexture=null,yt.wallMaterial=null,yt.wallEdgeMaterial=null,yt.floorMaterial=null,yt.ceilingMaterial=null,yt.roofMaterial=null;var bt=function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Floor",e}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.blockSize=[.6,.6],this.blockAngle=0,this.DefaultHeight=.01,this.height=this.DefaultHeight}},{key:"size",set:function(e){this._size=e},get:function(){return null===this._size&&(this._size=[0,0,0]),this._size}}]),t}(pt),_t=function(e){function t(){return at(this,t),ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._startCorner=null,this._endCorner=null,this.thick=-1,this.height=-1,this._length=null,this._direction=null,this.doorOrWindows=[],this.suspend=0,this._position=null}},{key:"getWallOtherCorner",value:function(e){return this.startCorner===e?this.endCorner:this.endCorner===e?this.startCorner:null}},{key:"startCorner",get:function(){return this._startCorner},set:function(e){this._startCorner=e,this._startCorner&&this._startCorner.addWall(this)}},{key:"endCorner",get:function(){return this._endCorner},set:function(e){this._endCorner=e,this._endCorner&&this._endCorner.addWall(this)}},{key:"position",get:function(){if(!this._position){var e=this.startCorner.position,t=this.endCorner.position;this._position=[(t[0]+e[0])/2,(t[1]+e[1])/2,(t[2]+e[2])/2]}return this._position},set:function(e){this._position=e}},{key:"length",get:function(){return null===this._length&&(this._length=ht.calTwoPositionLength(this.startCorner.position,this.endCorner.position)),this._length}},{key:"direction",get:function(){return null===this._direction&&(this._direction=ht.subPosition(this.endCorner.position,this.startCorner.position),ht.normalizeDirection(this._direction)),this._direction}}]),t}(pt),xt=function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="ModelWall",e}return ut(t,e),t}(_t),Et=function(e){function t(e,n,i){at(this,t);var r=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.type="WallCorner",r}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.walls=[],this.position=null}},{key:"addWall",value:function(e){for(var t=0,n=this.walls.length;t<n;t++)if(this.walls[t]===e)return void console.error("repeat wall"+e);this.walls.push(e)}}]),t}(pt),wt=function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Building",e.structShow=!1,e}return ut(t,e),t}(pt),Tt=function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="CurveLine",e}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.points=[],this.resource=null,this.color=null,this.width=null,this.enableMaterialAnimation=!1,this.materialAnimationSpeed=1,this.textureTiling=[1,1],this.textureOffset=[0,0]}}]),t}(pt),Mt=function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="ArrowLine",e}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.arrowResource=null,this.arrowWidth=null,this.arrowHeight=null,this._resources=null}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.resource&&this._resources.push(this.resource),this.arrowResource&&this._resources.push(this.arrowResource)),this._resources}}]),t}(Tt),St=function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="ArrowDataLine",e}return ut(t,e),t}(Mt),Ct=function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Placement",e}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.model=null,this.customColor=null,this.opacity=null,this.renderMode=null,this.customTextureResource=null,this.isPlayAnim=!1,this.animClip=null,this.belongRoomUserID=null}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.resource&&this._resources.push(this.resource),this.customTextureResource&&this._resources.push(this.customTextureResource)),this._resources}},{key:"size",set:function(e){this._size=e},get:function(){if(null===this._size){this.modelSize=this.resource.size,this._size=[this.modelSize[0]*this.scale[0],this.modelSize[1]*this.scale[1],this.modelSize[2]*this.scale[2]],this._box3=new it;var e=new nt(this.position[0],this.position[1],this.position[2]);e.y+=this._size[1]/2,this._box3.setFromCenterAndSize(e,new nt(this._size[0],this._size[1],this._size[2]))}return this._size}}]),t}(pt),At=function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Facade",e}return ut(t,e),t}(Ct),Rt=function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="DoorOrWindow",e}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.suspendPercent=0,this.attachWall=null,this.isOpen=!1,this.openDirIndex=0,this.isWindow=!1}}]),t}(Ct),Pt=function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="PlacementGroup",e}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.groups=[],this.placements=[],this.belongRoomUserID=null,this._resourcesMap={}}},{key:"_addChild",value:function(e){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_addChild",this).call(this,e),e.type===dt.Placement?this.placements.push(e):e.type===dt.PlacementGroup&&this.groups.push(e)}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){return null===this._selfSize&&(this._selfSize=[0,0,0]),this._selfSize}},{key:"belongRoomUserID",set:function(e){this._belongRoomUserID=e;for(var t=0;t<this.placements.length;t++){this.placements[t].belongRoomUserID=e}for(var n=0;n<this.groups.length;n++){this.groups[n].belongRoomUserID=e}},get:function(){return this._belongRoomUserID}},{key:"resources",get:function(){if(null===this._resources){this._resources=[];for(var e=0;e<this.children.length;e++)for(var t=this.children[e],n=0;n<t.resources.length;n++){var i=t.resources[n];this._resourcesMap[i.id]||(this._resources.push(i),this._resourcesMap[i.id]=i)}}return this._resources}}]),t}(pt),Dt=function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="FacadeGroup",e}return ut(t,e),t}(Pt),kt=function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="FloorPlan",e}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.height=3,this.alwaysShowInsideObjs=!1}},{key:"existsCorner",value:function(e,t,n){var i=this.typeToChildren[dt.WallCorner];if(i)for(var r=0,o=i.length;r<o;r++){var a=i[r].position;if(a.x===e&&a.y===t&&a.z===n)return!0}return!1}},{key:"addCorner",value:function(e,t,n){var i=new WallCorner(e,t,n);return i.parent=this,i}},{key:"getCorner",value:function(e,t,n){for(var i=0,r=this.corners.length;i<r;i++){var o=this.corners[i].position;if(o.x===e&&o.y===t&&o.z===n)return this.corners[i]}return null}},{key:"calRoomsUV2",value:function(){}},{key:"_fillUV2ToRooms",value:function(e,t){for(var n=0;n<e.length;n++){var i=e[n],r=this._calFloorUV2(i,t);this._fillUV2ToFloor(i,r)}}},{key:"_calFloorUV2",value:function(e,t){var n=[],i=new THREE.Vector2;t.getSize(i);for(var r=e.floor.geometry.vertices,o=this._getFloorPosition(e),a=0;a<r.length;a++){var s=r[a].clone();s.x+=o.x,s.y+=o.z;var l=(s.x-t.min.x)/i.x,u=(s.y-t.min.y)/i.y;n.push(new THREE.Vector2(parseFloat(l.toFixed(2)),parseFloat(u.toFixed(2))))}return n}},{key:"_fillUV2ToFloor",value:function(e,t){for(var n=e.floor.geometry.faces,i=[],r=0;r<n.length;r++){var o=n[r],a=[t[o.a],t[o.b],t[o.c]];i.push(a)}e.uv2=i}},{key:"_calAllFloorBox2",value:function(e){for(var t=new THREE.Box2,n=0;n<e.rooms.length;n++){var i=e.rooms[n];null===i.floor.geometry&&i.floor.calGeometry();for(var r=this._getFloorPosition(i),o=i.floor.geometry.vertices,a=0;a<o.length;a++){var s=o[a].clone();s.x+=r.x,s.y+=r.z,t.expandByPoint(s)}}return t}},{key:"_getFloorPosition",value:function(e){var t=e.position.clone();return t.z=-t.z,t}},{key:"_getCalculateSizeObjects",value:function(){for(var e=[],t=0;t<this.children.length;t++){var n=this.children[t];-1!==n.type.indexOf("Wall")&&e.push(n)}return e}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){return null===this._selfSize&&(this._selfSize=[0,0,0]),this._selfSize}}]),t}(pt),jt=function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="Outdoors",e}return ut(t,e),t}(kt),Ot=function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="PipeLine",e}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.points=[],this.resource=null,this.color=[0,0,1],this.renderMode=null,this.opacity=null,this.radius=null,this.sectionType=null,this.enableMaterialAnimation=!1,this.materialAnimationSpeed=1,this.textureTiling=[.5,.5],this.textureOffset=[0,0]}}]),t}(pt),Ft=function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="LeakWaterLine",e}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.radius=.2,this.color=[1,1,1],this.alarmLength=null}},{key:"clear",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this,e),this.radius=.2,this.color=null,this.alarmLength=null}}]),t}(Ot),Bt=(function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.text=null,e.color=null,e.font=null,e.opacity=null,e.mesh=null,e.type="Text3D",e}ut(t,e),st(t,[{key:"build",value:function(){var e=new THREE.TextGeometry(this.text,{font:t.getFont(),size:80,height:1,curveSegments:2});e.computeBoundingBox();var n=-.5*(e.boundingBox.max.x-e.boundingBox.min.x),i=[new THREE.MeshBasicMaterial({color:16777215*Math.random(),overdraw:.5}),new THREE.MeshBasicMaterial({color:0,overdraw:.5})],r=new THREE.Mesh(e,i);r.position.x=n,r.position.y=100,r.position.z=0,r.rotation.x=0,r.rotation.y=2*Math.PI,this.mesh=r}},{key:"clear",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this,e),this.text=null,this.color=null,this.font=null,this.opacity=null,this.mesh=null}}],[{key:"getFont",value:function(){return t.font?t.font:new THREE.Font({glyphs:{"ο":{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 96 88 192 -25 q 0 368 0 201 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 "},S:{x_min:0,x_max:788,ha:890,o:"m 788 291 q 662 54 788 144 q 397 -26 550 -26 q 116 68 226 -26 q 0 337 0 168 l 131 337 q 200 152 131 220 q 384 85 269 85 q 557 129 479 85 q 650 270 650 183 q 490 429 650 379 q 194 513 341 470 q 33 739 33 584 q 142 964 33 881 q 388 1041 242 1041 q 644 957 543 1041 q 756 716 756 867 l 625 716 q 561 874 625 816 q 395 933 497 933 q 243 891 309 933 q 164 759 164 841 q 325 609 164 656 q 625 526 475 568 q 788 291 788 454 "},"¦":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},"/":{x_min:183.25,x_max:608.328125,ha:792,o:"m 608 1041 l 266 -129 l 183 -129 l 520 1041 l 608 1041 "},"Τ":{x_min:-.4375,x_max:777.453125,ha:839,o:"m 777 893 l 458 893 l 458 0 l 319 0 l 319 892 l 0 892 l 0 1013 l 777 1013 l 777 893 "},y:{x_min:0,x_max:684.78125,ha:771,o:"m 684 738 l 388 -83 q 311 -216 356 -167 q 173 -279 252 -279 q 97 -266 133 -279 l 97 -149 q 132 -155 109 -151 q 168 -160 155 -160 q 240 -114 213 -160 q 274 -26 248 -98 l 0 738 l 137 737 l 341 139 l 548 737 l 684 738 "},"Π":{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 803 1012 l 803 0 "},"ΐ":{x_min:-111,x_max:339,ha:361,o:"m 339 800 l 229 800 l 229 925 l 339 925 l 339 800 m -1 800 l -111 800 l -111 925 l -1 925 l -1 800 m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 m 302 1040 l 113 819 l 30 819 l 165 1040 l 302 1040 "},g:{x_min:0,x_max:686,ha:838,o:"m 686 34 q 586 -213 686 -121 q 331 -306 487 -306 q 131 -252 216 -306 q 31 -84 31 -190 l 155 -84 q 228 -174 166 -138 q 345 -207 284 -207 q 514 -109 454 -207 q 564 89 564 -27 q 461 6 521 36 q 335 -23 401 -23 q 88 100 184 -23 q 0 370 0 215 q 87 634 0 522 q 330 758 183 758 q 457 728 398 758 q 564 644 515 699 l 564 737 l 686 737 l 686 34 m 582 367 q 529 560 582 481 q 358 652 468 652 q 189 561 250 652 q 135 369 135 482 q 189 176 135 255 q 361 85 251 85 q 529 176 468 85 q 582 367 582 255 "},"²":{x_min:0,x_max:442,ha:539,o:"m 442 383 l 0 383 q 91 566 0 492 q 260 668 176 617 q 354 798 354 727 q 315 875 354 845 q 227 905 277 905 q 136 869 173 905 q 99 761 99 833 l 14 761 q 82 922 14 864 q 232 974 141 974 q 379 926 316 974 q 442 797 442 878 q 351 635 442 704 q 183 539 321 611 q 92 455 92 491 l 442 455 l 442 383 "},"–":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},"Κ":{x_min:0,x_max:819.5625,ha:893,o:"m 819 0 l 650 0 l 294 509 l 139 356 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},"ƒ":{x_min:-46.265625,x_max:392,ha:513,o:"m 392 651 l 259 651 l 79 -279 l -46 -278 l 134 651 l 14 651 l 14 751 l 135 751 q 151 948 135 900 q 304 1041 185 1041 q 334 1040 319 1041 q 392 1034 348 1039 l 392 922 q 337 931 360 931 q 271 883 287 931 q 260 793 260 853 l 260 751 l 392 751 l 392 651 "},e:{x_min:0,x_max:714,ha:813,o:"m 714 326 l 140 326 q 200 157 140 227 q 359 87 260 87 q 488 130 431 87 q 561 245 545 174 l 697 245 q 577 48 670 123 q 358 -26 484 -26 q 97 85 195 -26 q 0 363 0 197 q 94 642 0 529 q 358 765 195 765 q 626 627 529 765 q 714 326 714 503 m 576 429 q 507 583 564 522 q 355 650 445 650 q 206 583 266 650 q 140 429 152 522 l 576 429 "},"ό":{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 94 91 194 -25 q 0 368 0 202 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 m 576 1040 l 387 819 l 303 819 l 438 1040 l 576 1040 "},J:{x_min:0,x_max:588,ha:699,o:"m 588 279 q 287 -26 588 -26 q 58 73 126 -26 q 0 327 0 158 l 133 327 q 160 172 133 227 q 288 96 198 96 q 426 171 391 96 q 449 336 449 219 l 449 1013 l 588 1013 l 588 279 "},"»":{x_min:-1,x_max:503,ha:601,o:"m 503 302 l 280 136 l 281 256 l 429 373 l 281 486 l 280 608 l 503 440 l 503 302 m 221 302 l 0 136 l 0 255 l 145 372 l 0 486 l -1 608 l 221 440 l 221 302 "},"©":{x_min:-3,x_max:1008,ha:1106,o:"m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 741 394 q 661 246 731 302 q 496 190 591 190 q 294 285 369 190 q 228 497 228 370 q 295 714 228 625 q 499 813 370 813 q 656 762 588 813 q 733 625 724 711 l 634 625 q 589 704 629 673 q 498 735 550 735 q 377 666 421 735 q 334 504 334 597 q 374 340 334 408 q 490 272 415 272 q 589 304 549 272 q 638 394 628 337 l 741 394 "},"ώ":{x_min:0,x_max:922,ha:1030,o:"m 687 1040 l 498 819 l 415 819 l 549 1040 l 687 1040 m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 338 0 202 q 45 551 0 444 q 161 737 84 643 l 302 737 q 175 552 219 647 q 124 336 124 446 q 155 179 124 248 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 341 797 257 q 745 555 797 450 q 619 737 705 637 l 760 737 q 874 551 835 640 q 922 339 922 444 "},"^":{x_min:193.0625,x_max:598.609375,ha:792,o:"m 598 772 l 515 772 l 395 931 l 277 772 l 193 772 l 326 1013 l 462 1013 l 598 772 "},"«":{x_min:0,x_max:507.203125,ha:604,o:"m 506 136 l 284 302 l 284 440 l 506 608 l 507 485 l 360 371 l 506 255 l 506 136 m 222 136 l 0 302 l 0 440 l 222 608 l 221 486 l 73 373 l 222 256 l 222 136 "},D:{x_min:0,x_max:828,ha:935,o:"m 389 1013 q 714 867 593 1013 q 828 521 828 729 q 712 161 828 309 q 382 0 587 0 l 0 0 l 0 1013 l 389 1013 m 376 124 q 607 247 523 124 q 681 510 681 355 q 607 771 681 662 q 376 896 522 896 l 139 896 l 139 124 l 376 124 "},"∙":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},"ÿ":{x_min:0,x_max:47,ha:125,o:"m 47 3 q 37 -7 47 -7 q 28 0 30 -7 q 39 -4 32 -4 q 45 3 45 -1 l 37 0 q 28 9 28 0 q 39 19 28 19 l 47 16 l 47 19 l 47 3 m 37 1 q 44 8 44 1 q 37 16 44 16 q 30 8 30 16 q 37 1 30 1 m 26 1 l 23 22 l 14 0 l 3 22 l 3 3 l 0 25 l 13 1 l 22 25 l 26 1 "},w:{x_min:0,x_max:1009.71875,ha:1100,o:"m 1009 738 l 783 0 l 658 0 l 501 567 l 345 0 l 222 0 l 0 738 l 130 738 l 284 174 l 432 737 l 576 738 l 721 173 l 881 737 l 1009 738 "},$:{x_min:0,x_max:700,ha:793,o:"m 664 717 l 542 717 q 490 825 531 785 q 381 872 450 865 l 381 551 q 620 446 540 522 q 700 241 700 370 q 618 45 700 116 q 381 -25 536 -25 l 381 -152 l 307 -152 l 307 -25 q 81 62 162 -25 q 0 297 0 149 l 124 297 q 169 146 124 204 q 307 81 215 89 l 307 441 q 80 536 148 469 q 13 725 13 603 q 96 910 13 839 q 307 982 180 982 l 307 1077 l 381 1077 l 381 982 q 574 917 494 982 q 664 717 664 845 m 307 565 l 307 872 q 187 831 233 872 q 142 724 142 791 q 180 618 142 656 q 307 565 218 580 m 381 76 q 562 237 562 96 q 517 361 562 313 q 381 423 472 409 l 381 76 "},"\\":{x_min:-.015625,x_max:425.0625,ha:522,o:"m 425 -129 l 337 -129 l 0 1041 l 83 1041 l 425 -129 "},"µ":{x_min:0,x_max:697.21875,ha:747,o:"m 697 -4 q 629 -14 658 -14 q 498 97 513 -14 q 422 9 470 41 q 313 -23 374 -23 q 207 4 258 -23 q 119 81 156 32 l 119 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 173 124 246 q 308 83 216 83 q 452 178 402 83 q 493 359 493 255 l 493 738 l 617 738 l 617 214 q 623 136 617 160 q 673 92 637 92 q 697 96 684 92 l 697 -4 "},"Ι":{x_min:42,x_max:181,ha:297,o:"m 181 0 l 42 0 l 42 1013 l 181 1013 l 181 0 "},"Ύ":{x_min:0,x_max:1144.5,ha:1214,o:"m 1144 1012 l 807 416 l 807 0 l 667 0 l 667 416 l 325 1012 l 465 1012 l 736 533 l 1004 1012 l 1144 1012 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"’":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},"Ν":{x_min:0,x_max:801,ha:915,o:"m 801 0 l 651 0 l 131 822 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 191 l 670 1013 l 801 1013 l 801 0 "},"-":{x_min:8.71875,x_max:350.390625,ha:478,o:"m 350 317 l 8 317 l 8 428 l 350 428 l 350 317 "},Q:{x_min:0,x_max:968,ha:1072,o:"m 954 5 l 887 -79 l 744 35 q 622 -11 687 2 q 483 -26 556 -26 q 127 130 262 -26 q 0 504 0 279 q 127 880 0 728 q 484 1041 262 1041 q 841 884 708 1041 q 968 507 968 735 q 933 293 968 398 q 832 104 899 188 l 954 5 m 723 191 q 802 330 777 248 q 828 499 828 412 q 744 790 828 673 q 483 922 650 922 q 228 791 322 922 q 142 505 142 673 q 227 221 142 337 q 487 91 323 91 q 632 123 566 91 l 520 215 l 587 301 l 723 191 "},"ς":{x_min:1,x_max:676.28125,ha:740,o:"m 676 460 l 551 460 q 498 595 542 546 q 365 651 448 651 q 199 578 263 651 q 136 401 136 505 q 266 178 136 241 q 508 106 387 142 q 640 -50 640 62 q 625 -158 640 -105 q 583 -278 611 -211 l 465 -278 q 498 -182 490 -211 q 515 -80 515 -126 q 381 12 515 -15 q 134 91 197 51 q 1 388 1 179 q 100 651 1 542 q 354 761 199 761 q 587 680 498 761 q 676 460 676 599 "},M:{x_min:0,x_max:954,ha:1067,o:"m 954 0 l 819 0 l 819 869 l 537 0 l 405 0 l 128 866 l 128 0 l 0 0 l 0 1013 l 200 1013 l 472 160 l 757 1013 l 954 1013 l 954 0 "},"Ψ":{x_min:0,x_max:1006,ha:1094,o:"m 1006 678 q 914 319 1006 429 q 571 200 814 200 l 571 0 l 433 0 l 433 200 q 92 319 194 200 q 0 678 0 429 l 0 1013 l 139 1013 l 139 679 q 191 417 139 492 q 433 326 255 326 l 433 1013 l 571 1013 l 571 326 l 580 326 q 813 423 747 326 q 868 679 868 502 l 868 1013 l 1006 1013 l 1006 678 "},C:{x_min:0,x_max:886,ha:944,o:"m 886 379 q 760 87 886 201 q 455 -26 634 -26 q 112 136 236 -26 q 0 509 0 283 q 118 882 0 737 q 469 1041 245 1041 q 748 955 630 1041 q 879 708 879 859 l 745 708 q 649 862 724 805 q 473 920 573 920 q 219 791 312 920 q 136 509 136 675 q 217 229 136 344 q 470 99 311 99 q 672 179 591 99 q 753 379 753 259 l 886 379 "},"!":{x_min:0,x_max:138,ha:236,o:"m 138 684 q 116 409 138 629 q 105 244 105 299 l 33 244 q 16 465 33 313 q 0 684 0 616 l 0 1013 l 138 1013 l 138 684 m 138 0 l 0 0 l 0 151 l 138 151 l 138 0 "},"{":{x_min:0,x_max:480.5625,ha:578,o:"m 480 -286 q 237 -213 303 -286 q 187 -45 187 -159 q 194 48 187 -15 q 201 141 201 112 q 164 264 201 225 q 0 314 118 314 l 0 417 q 164 471 119 417 q 201 605 201 514 q 199 665 201 644 q 193 772 193 769 q 241 941 193 887 q 480 1015 308 1015 l 480 915 q 336 866 375 915 q 306 742 306 828 q 310 662 306 717 q 314 577 314 606 q 288 452 314 500 q 176 365 256 391 q 289 275 257 337 q 314 143 314 226 q 313 84 314 107 q 310 -11 310 -5 q 339 -131 310 -94 q 480 -182 377 -182 l 480 -286 "},X:{x_min:-.015625,x_max:854.15625,ha:940,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 428 637 l 675 1013 l 836 1013 l 504 520 l 854 0 "},"#":{x_min:0,x_max:963.890625,ha:1061,o:"m 963 690 l 927 590 l 719 590 l 655 410 l 876 410 l 840 310 l 618 310 l 508 -3 l 393 -2 l 506 309 l 329 310 l 215 -2 l 102 -3 l 212 310 l 0 310 l 36 410 l 248 409 l 312 590 l 86 590 l 120 690 l 347 690 l 459 1006 l 573 1006 l 462 690 l 640 690 l 751 1006 l 865 1006 l 754 690 l 963 690 m 606 590 l 425 590 l 362 410 l 543 410 l 606 590 "},"ι":{x_min:42,x_max:284,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 738 l 167 738 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 "},"Ά":{x_min:0,x_max:906.953125,ha:982,o:"m 283 1040 l 88 799 l 5 799 l 145 1040 l 283 1040 m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1012 l 529 1012 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},")":{x_min:0,x_max:318,ha:415,o:"m 318 365 q 257 25 318 191 q 87 -290 197 -141 l 0 -290 q 140 21 93 -128 q 193 360 193 189 q 141 704 193 537 q 0 1024 97 850 l 87 1024 q 257 706 197 871 q 318 365 318 542 "},"ε":{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 314 0 265 q 128 390 67 353 q 56 460 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 "},"Δ":{x_min:0,x_max:952.78125,ha:1028,o:"m 952 0 l 0 0 l 400 1013 l 551 1013 l 952 0 m 762 124 l 476 867 l 187 124 l 762 124 "},"}":{x_min:0,x_max:481,ha:578,o:"m 481 314 q 318 262 364 314 q 282 136 282 222 q 284 65 282 97 q 293 -58 293 -48 q 241 -217 293 -166 q 0 -286 174 -286 l 0 -182 q 143 -130 105 -182 q 171 -2 171 -93 q 168 81 171 22 q 165 144 165 140 q 188 275 165 229 q 306 365 220 339 q 191 455 224 391 q 165 588 165 505 q 168 681 165 624 q 171 742 171 737 q 141 865 171 827 q 0 915 102 915 l 0 1015 q 243 942 176 1015 q 293 773 293 888 q 287 675 293 741 q 282 590 282 608 q 318 466 282 505 q 481 417 364 417 l 481 314 "},"‰":{x_min:-3,x_max:1672,ha:1821,o:"m 846 0 q 664 76 732 0 q 603 244 603 145 q 662 412 603 344 q 846 489 729 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 846 0 962 0 m 845 103 q 945 143 910 103 q 981 243 981 184 q 947 340 981 301 q 845 385 910 385 q 745 342 782 385 q 709 243 709 300 q 742 147 709 186 q 845 103 781 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 m 1428 0 q 1246 76 1314 0 q 1185 244 1185 145 q 1244 412 1185 344 q 1428 489 1311 489 q 1610 412 1542 489 q 1672 244 1672 343 q 1612 76 1672 144 q 1428 0 1545 0 m 1427 103 q 1528 143 1492 103 q 1564 243 1564 184 q 1530 340 1564 301 q 1427 385 1492 385 q 1327 342 1364 385 q 1291 243 1291 300 q 1324 147 1291 186 q 1427 103 1363 103 "},a:{x_min:0,x_max:698.609375,ha:794,o:"m 698 0 q 661 -12 679 -7 q 615 -17 643 -17 q 536 12 564 -17 q 500 96 508 41 q 384 6 456 37 q 236 -25 312 -25 q 65 31 130 -25 q 0 194 0 88 q 118 390 0 334 q 328 435 180 420 q 488 483 476 451 q 495 523 495 504 q 442 619 495 584 q 325 654 389 654 q 209 617 257 654 q 152 513 161 580 l 33 513 q 123 705 33 633 q 332 772 207 772 q 528 712 448 772 q 617 531 617 645 l 617 163 q 624 108 617 126 q 664 90 632 90 l 698 94 l 698 0 m 491 262 l 491 372 q 272 329 350 347 q 128 201 128 294 q 166 113 128 144 q 264 83 205 83 q 414 130 346 83 q 491 262 491 183 "},"—":{x_min:0,x_max:941.671875,ha:1039,o:"m 941 334 l 0 334 l 0 410 l 941 410 l 941 334 "},"=":{x_min:8.71875,x_max:780.953125,ha:792,o:"m 780 510 l 8 510 l 8 606 l 780 606 l 780 510 m 780 235 l 8 235 l 8 332 l 780 332 l 780 235 "},N:{x_min:0,x_max:801,ha:914,o:"m 801 0 l 651 0 l 131 823 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 193 l 670 1013 l 801 1013 l 801 0 "},"ρ":{x_min:0,x_max:712,ha:797,o:"m 712 369 q 620 94 712 207 q 362 -26 521 -26 q 230 2 292 -26 q 119 83 167 30 l 119 -278 l 0 -278 l 0 362 q 91 643 0 531 q 355 764 190 764 q 617 647 517 764 q 712 369 712 536 m 583 366 q 530 559 583 480 q 359 651 469 651 q 190 562 252 651 q 135 370 135 483 q 189 176 135 257 q 359 85 250 85 q 528 175 466 85 q 583 366 583 254 "},2:{x_min:59,x_max:731,ha:792,o:"m 731 0 l 59 0 q 197 314 59 188 q 457 487 199 315 q 598 691 598 580 q 543 819 598 772 q 411 867 488 867 q 272 811 328 867 q 209 630 209 747 l 81 630 q 182 901 81 805 q 408 986 271 986 q 629 909 536 986 q 731 694 731 826 q 613 449 731 541 q 378 316 495 383 q 201 122 235 234 l 731 122 l 731 0 "},"¯":{x_min:0,x_max:941.671875,ha:938,o:"m 941 1033 l 0 1033 l 0 1109 l 941 1109 l 941 1033 "},Z:{x_min:0,x_max:779,ha:849,o:"m 779 0 l 0 0 l 0 113 l 621 896 l 40 896 l 40 1013 l 779 1013 l 778 887 l 171 124 l 779 124 l 779 0 "},u:{x_min:0,x_max:617,ha:729,o:"m 617 0 l 499 0 l 499 110 q 391 10 460 45 q 246 -25 322 -25 q 61 58 127 -25 q 0 258 0 136 l 0 738 l 125 738 l 125 284 q 156 148 125 202 q 273 82 197 82 q 433 165 369 82 q 493 340 493 243 l 493 738 l 617 738 l 617 0 "},k:{x_min:0,x_max:612.484375,ha:697,o:"m 612 738 l 338 465 l 608 0 l 469 0 l 251 382 l 121 251 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 402 l 456 738 l 612 738 "},"Η":{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},"Α":{x_min:0,x_max:906.953125,ha:985,o:"m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},s:{x_min:0,x_max:604,ha:697,o:"m 604 217 q 501 36 604 104 q 292 -23 411 -23 q 86 43 166 -23 q 0 238 0 114 l 121 237 q 175 122 121 164 q 300 85 223 85 q 415 112 363 85 q 479 207 479 147 q 361 309 479 276 q 140 372 141 370 q 21 544 21 426 q 111 708 21 647 q 298 761 190 761 q 492 705 413 761 q 583 531 583 643 l 462 531 q 412 625 462 594 q 298 657 363 657 q 199 636 242 657 q 143 558 143 608 q 262 454 143 486 q 484 394 479 397 q 604 217 604 341 "},B:{x_min:0,x_max:778,ha:876,o:"m 580 546 q 724 469 670 535 q 778 311 778 403 q 673 83 778 171 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 892 q 691 633 732 693 q 580 546 650 572 m 393 899 l 139 899 l 139 588 l 379 588 q 521 624 462 588 q 592 744 592 667 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 303 635 219 q 559 436 635 389 q 402 477 494 477 l 139 477 l 139 124 l 419 124 "},"…":{x_min:0,x_max:614,ha:708,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 m 378 0 l 236 0 l 236 151 l 378 151 l 378 0 m 614 0 l 472 0 l 472 151 l 614 151 l 614 0 "},"?":{x_min:0,x_max:607,ha:704,o:"m 607 777 q 543 599 607 674 q 422 474 482 537 q 357 272 357 391 l 236 272 q 297 487 236 395 q 411 619 298 490 q 474 762 474 691 q 422 885 474 838 q 301 933 371 933 q 179 880 228 933 q 124 706 124 819 l 0 706 q 94 963 0 872 q 302 1044 177 1044 q 511 973 423 1044 q 607 777 607 895 m 370 0 l 230 0 l 230 151 l 370 151 l 370 0 "},H:{x_min:0,x_max:803,ha:915,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},"ν":{x_min:0,x_max:675,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 738 l 340 147 l 541 738 l 675 738 "},c:{x_min:1,x_max:701.390625,ha:775,o:"m 701 264 q 584 53 681 133 q 353 -26 487 -26 q 91 91 188 -26 q 1 370 1 201 q 92 645 1 537 q 353 761 190 761 q 572 688 479 761 q 690 493 666 615 l 556 493 q 487 606 545 562 q 356 650 428 650 q 186 563 246 650 q 134 372 134 487 q 188 179 134 258 q 359 88 250 88 q 492 136 437 88 q 566 264 548 185 l 701 264 "},"¶":{x_min:0,x_max:566.671875,ha:678,o:"m 21 892 l 52 892 l 98 761 l 145 892 l 176 892 l 178 741 l 157 741 l 157 867 l 108 741 l 88 741 l 40 871 l 40 741 l 21 741 l 21 892 m 308 854 l 308 731 q 252 691 308 691 q 227 691 240 691 q 207 696 213 695 l 207 712 l 253 706 q 288 733 288 706 l 288 763 q 244 741 279 741 q 193 797 193 741 q 261 860 193 860 q 287 860 273 860 q 308 854 302 855 m 288 842 l 263 843 q 213 796 213 843 q 248 756 213 756 q 288 796 288 756 l 288 842 m 566 988 l 502 988 l 502 -1 l 439 -1 l 439 988 l 317 988 l 317 -1 l 252 -1 l 252 602 q 81 653 155 602 q 0 805 0 711 q 101 989 0 918 q 309 1053 194 1053 l 566 1053 l 566 988 "},"β":{x_min:0,x_max:660,ha:745,o:"m 471 550 q 610 450 561 522 q 660 280 660 378 q 578 64 660 151 q 367 -22 497 -22 q 239 5 299 -22 q 126 82 178 32 l 126 -278 l 0 -278 l 0 593 q 54 903 0 801 q 318 1042 127 1042 q 519 964 436 1042 q 603 771 603 887 q 567 644 603 701 q 471 550 532 586 m 337 79 q 476 138 418 79 q 535 279 535 198 q 427 437 535 386 q 226 477 344 477 l 226 583 q 398 620 329 583 q 486 762 486 668 q 435 884 486 833 q 312 935 384 935 q 169 861 219 935 q 126 698 126 797 l 126 362 q 170 169 126 242 q 337 79 224 79 "},"Μ":{x_min:0,x_max:954,ha:1068,o:"m 954 0 l 819 0 l 819 868 l 537 0 l 405 0 l 128 865 l 128 0 l 0 0 l 0 1013 l 199 1013 l 472 158 l 758 1013 l 954 1013 l 954 0 "},"Ό":{x_min:.109375,x_max:1120,ha:1217,o:"m 1120 505 q 994 132 1120 282 q 642 -29 861 -29 q 290 130 422 -29 q 167 505 167 280 q 294 883 167 730 q 650 1046 430 1046 q 999 882 868 1046 q 1120 505 1120 730 m 977 504 q 896 784 977 669 q 644 915 804 915 q 391 785 484 915 q 307 504 307 669 q 391 224 307 339 q 644 95 486 95 q 894 224 803 95 q 977 504 977 339 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"Ή":{x_min:0,x_max:1158,ha:1275,o:"m 1158 0 l 1022 0 l 1022 475 l 496 475 l 496 0 l 356 0 l 356 1012 l 496 1012 l 496 599 l 1022 599 l 1022 1012 l 1158 1012 l 1158 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"•":{x_min:0,x_max:663.890625,ha:775,o:"m 663 529 q 566 293 663 391 q 331 196 469 196 q 97 294 194 196 q 0 529 0 393 q 96 763 0 665 q 331 861 193 861 q 566 763 469 861 q 663 529 663 665 "},"¥":{x_min:.1875,x_max:819.546875,ha:886,o:"m 563 561 l 697 561 l 696 487 l 520 487 l 482 416 l 482 380 l 697 380 l 695 308 l 482 308 l 482 0 l 342 0 l 342 308 l 125 308 l 125 380 l 342 380 l 342 417 l 303 487 l 125 487 l 125 561 l 258 561 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 l 563 561 "},"(":{x_min:0,x_max:318.0625,ha:415,o:"m 318 -290 l 230 -290 q 61 23 122 -142 q 0 365 0 190 q 62 712 0 540 q 230 1024 119 869 l 318 1024 q 175 705 219 853 q 125 360 125 542 q 176 22 125 187 q 318 -290 223 -127 "},U:{x_min:0,x_max:796,ha:904,o:"m 796 393 q 681 93 796 212 q 386 -25 566 -25 q 101 95 208 -25 q 0 393 0 211 l 0 1013 l 138 1013 l 138 391 q 204 191 138 270 q 394 107 276 107 q 586 191 512 107 q 656 391 656 270 l 656 1013 l 796 1013 l 796 393 "},"γ":{x_min:.5,x_max:744.953125,ha:822,o:"m 744 737 l 463 54 l 463 -278 l 338 -278 l 338 54 l 154 495 q 104 597 124 569 q 13 651 67 651 l 0 651 l 0 751 l 39 753 q 168 711 121 753 q 242 594 207 676 l 403 208 l 617 737 l 744 737 "},"α":{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 728 407 760 q 563 637 524 696 l 563 739 l 685 739 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 96 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 "},F:{x_min:0,x_max:683.328125,ha:717,o:"m 683 888 l 140 888 l 140 583 l 613 583 l 613 458 l 140 458 l 140 0 l 0 0 l 0 1013 l 683 1013 l 683 888 "},"­":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},":":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},"Χ":{x_min:0,x_max:854.171875,ha:935,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 427 637 l 675 1013 l 836 1013 l 504 521 l 854 0 "},"*":{x_min:116,x_max:674,ha:792,o:"m 674 768 l 475 713 l 610 544 l 517 477 l 394 652 l 272 478 l 178 544 l 314 713 l 116 766 l 153 876 l 341 812 l 342 1013 l 446 1013 l 446 811 l 635 874 l 674 768 "},"†":{x_min:0,x_max:777,ha:835,o:"m 458 804 l 777 804 l 777 683 l 458 683 l 458 0 l 319 0 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 "},"°":{x_min:0,x_max:347,ha:444,o:"m 173 802 q 43 856 91 802 q 0 977 0 905 q 45 1101 0 1049 q 173 1153 90 1153 q 303 1098 255 1153 q 347 977 347 1049 q 303 856 347 905 q 173 802 256 802 m 173 884 q 238 910 214 884 q 262 973 262 937 q 239 1038 262 1012 q 173 1064 217 1064 q 108 1037 132 1064 q 85 973 85 1010 q 108 910 85 937 q 173 884 132 884 "},V:{x_min:0,x_max:862.71875,ha:940,o:"m 862 1013 l 505 0 l 361 0 l 0 1013 l 143 1013 l 434 165 l 718 1012 l 862 1013 "},"Ξ":{x_min:0,x_max:734.71875,ha:763,o:"m 723 889 l 9 889 l 9 1013 l 723 1013 l 723 889 m 673 463 l 61 463 l 61 589 l 673 589 l 673 463 m 734 0 l 0 0 l 0 124 l 734 124 l 734 0 "}," ":{x_min:0,x_max:0,ha:853},"Ϋ":{x_min:.328125,x_max:819.515625,ha:889,o:"m 588 1046 l 460 1046 l 460 1189 l 588 1189 l 588 1046 m 360 1046 l 232 1046 l 232 1189 l 360 1189 l 360 1046 m 819 1012 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1012 l 140 1012 l 411 533 l 679 1012 l 819 1012 "},0:{x_min:73,x_max:715,ha:792,o:"m 394 -29 q 153 129 242 -29 q 73 479 73 272 q 152 829 73 687 q 394 989 241 989 q 634 829 545 989 q 715 479 715 684 q 635 129 715 270 q 394 -29 546 -29 m 394 89 q 546 211 489 89 q 598 479 598 322 q 548 748 598 640 q 394 871 491 871 q 241 748 298 871 q 190 479 190 637 q 239 211 190 319 q 394 89 296 89 "},"”":{x_min:0,x_max:347,ha:454,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 m 347 851 q 310 737 347 784 q 208 669 273 690 l 208 734 q 267 787 250 741 q 280 873 280 821 l 208 873 l 208 1013 l 347 1013 l 347 851 "},"@":{x_min:0,x_max:1260,ha:1357,o:"m 1098 -45 q 877 -160 1001 -117 q 633 -203 752 -203 q 155 -29 327 -203 q 0 360 0 127 q 176 802 0 616 q 687 1008 372 1008 q 1123 854 969 1008 q 1260 517 1260 718 q 1155 216 1260 341 q 868 82 1044 82 q 772 106 801 82 q 737 202 737 135 q 647 113 700 144 q 527 82 594 82 q 367 147 420 82 q 314 312 314 212 q 401 565 314 452 q 639 690 498 690 q 810 588 760 690 l 849 668 l 938 668 q 877 441 900 532 q 833 226 833 268 q 853 182 833 198 q 902 167 873 167 q 1088 272 1012 167 q 1159 512 1159 372 q 1051 793 1159 681 q 687 925 925 925 q 248 747 415 925 q 97 361 97 586 q 226 26 97 159 q 627 -122 370 -122 q 856 -87 737 -122 q 1061 8 976 -53 l 1098 -45 m 786 488 q 738 580 777 545 q 643 615 700 615 q 483 517 548 615 q 425 322 425 430 q 457 203 425 250 q 552 156 490 156 q 722 273 665 156 q 786 488 738 309 "},"Ί":{x_min:0,x_max:499,ha:613,o:"m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 m 499 0 l 360 0 l 360 1012 l 499 1012 l 499 0 "},i:{x_min:14,x_max:136,ha:275,o:"m 136 873 l 14 873 l 14 1013 l 136 1013 l 136 873 m 136 0 l 14 0 l 14 737 l 136 737 l 136 0 "},"Β":{x_min:0,x_max:778,ha:877,o:"m 580 545 q 724 468 671 534 q 778 310 778 402 q 673 83 778 170 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 891 q 691 632 732 692 q 580 545 650 571 m 393 899 l 139 899 l 139 587 l 379 587 q 521 623 462 587 q 592 744 592 666 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 302 635 219 q 559 435 635 388 q 402 476 494 476 l 139 476 l 139 124 l 419 124 "},"υ":{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 94 617 199 q 308 -24 455 -24 q 76 94 161 -24 q 0 352 0 199 l 0 739 l 126 739 l 126 355 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 355 492 257 l 492 739 l 617 739 l 617 352 "},"]":{x_min:0,x_max:275,ha:372,o:"m 275 -281 l 0 -281 l 0 -187 l 151 -187 l 151 920 l 0 920 l 0 1013 l 275 1013 l 275 -281 "},m:{x_min:0,x_max:1019,ha:1128,o:"m 1019 0 l 897 0 l 897 454 q 860 591 897 536 q 739 660 816 660 q 613 586 659 660 q 573 436 573 522 l 573 0 l 447 0 l 447 455 q 412 591 447 535 q 294 657 372 657 q 165 586 213 657 q 122 437 122 521 l 122 0 l 0 0 l 0 738 l 117 738 l 117 640 q 202 730 150 697 q 316 763 254 763 q 437 730 381 763 q 525 642 494 697 q 621 731 559 700 q 753 763 682 763 q 943 694 867 763 q 1019 512 1019 625 l 1019 0 "},"χ":{x_min:8.328125,x_max:780.5625,ha:815,o:"m 780 -278 q 715 -294 747 -294 q 616 -257 663 -294 q 548 -175 576 -227 l 379 133 l 143 -277 l 9 -277 l 313 254 l 163 522 q 127 586 131 580 q 36 640 91 640 q 8 637 27 640 l 8 752 l 52 757 q 162 719 113 757 q 236 627 200 690 l 383 372 l 594 737 l 726 737 l 448 250 l 625 -69 q 670 -153 647 -110 q 743 -188 695 -188 q 780 -184 759 -188 l 780 -278 "},8:{x_min:55,x_max:736,ha:792,o:"m 571 527 q 694 424 652 491 q 736 280 736 358 q 648 71 736 158 q 395 -26 551 -26 q 142 69 238 -26 q 55 279 55 157 q 96 425 55 359 q 220 527 138 491 q 120 615 153 562 q 88 726 88 668 q 171 904 88 827 q 395 986 261 986 q 618 905 529 986 q 702 727 702 830 q 670 616 702 667 q 571 527 638 565 m 394 565 q 519 610 475 565 q 563 717 563 655 q 521 823 563 781 q 392 872 474 872 q 265 824 312 872 q 224 720 224 783 q 265 613 224 656 q 394 565 312 565 m 395 91 q 545 150 488 91 q 597 280 597 204 q 546 408 597 355 q 395 465 492 465 q 244 408 299 465 q 194 280 194 356 q 244 150 194 203 q 395 91 299 91 "},"ί":{x_min:42,x_max:326.71875,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 102 239 101 q 284 112 257 104 l 284 3 m 326 1040 l 137 819 l 54 819 l 189 1040 l 326 1040 "},"Ζ":{x_min:0,x_max:779.171875,ha:850,o:"m 779 0 l 0 0 l 0 113 l 620 896 l 40 896 l 40 1013 l 779 1013 l 779 887 l 170 124 l 779 124 l 779 0 "},R:{x_min:0,x_max:781.953125,ha:907,o:"m 781 0 l 623 0 q 587 242 590 52 q 407 433 585 433 l 138 433 l 138 0 l 0 0 l 0 1013 l 396 1013 q 636 946 539 1013 q 749 731 749 868 q 711 597 749 659 q 608 502 674 534 q 718 370 696 474 q 729 207 722 352 q 781 26 736 62 l 781 0 m 373 551 q 533 594 465 551 q 614 731 614 645 q 532 859 614 815 q 373 896 465 896 l 138 896 l 138 551 l 373 551 "},o:{x_min:0,x_max:713,ha:821,o:"m 357 -25 q 94 91 194 -25 q 0 368 0 202 q 93 642 0 533 q 357 761 193 761 q 618 644 518 761 q 713 368 713 533 q 619 91 713 201 q 357 -25 521 -25 m 357 85 q 528 175 465 85 q 584 369 584 255 q 529 562 584 484 q 357 651 467 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 357 85 250 85 "},5:{x_min:54.171875,x_max:738,ha:792,o:"m 738 314 q 626 60 738 153 q 382 -23 526 -23 q 155 47 248 -23 q 54 256 54 125 l 183 256 q 259 132 204 174 q 382 91 314 91 q 533 149 471 91 q 602 314 602 213 q 538 469 602 411 q 386 528 475 528 q 284 506 332 528 q 197 439 237 484 l 81 439 l 159 958 l 684 958 l 684 840 l 254 840 l 214 579 q 306 627 258 612 q 407 643 354 643 q 636 552 540 643 q 738 314 738 457 "},7:{x_min:58.71875,x_max:730.953125,ha:792,o:"m 730 839 q 469 448 560 641 q 335 0 378 255 l 192 0 q 328 441 235 252 q 593 830 421 630 l 58 830 l 58 958 l 730 958 l 730 839 "},K:{x_min:0,x_max:819.46875,ha:906,o:"m 819 0 l 649 0 l 294 509 l 139 355 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},",":{x_min:0,x_max:142,ha:239,o:"m 142 -12 q 105 -132 142 -82 q 0 -205 68 -182 l 0 -138 q 57 -82 40 -124 q 70 0 70 -51 l 0 0 l 0 151 l 142 151 l 142 -12 "},d:{x_min:0,x_max:683,ha:796,o:"m 683 0 l 564 0 l 564 93 q 456 6 516 38 q 327 -25 395 -25 q 87 100 181 -25 q 0 365 0 215 q 90 639 0 525 q 343 763 187 763 q 564 647 486 763 l 564 1013 l 683 1013 l 683 0 m 582 373 q 529 562 582 484 q 361 653 468 653 q 190 561 253 653 q 135 365 135 479 q 189 175 135 254 q 358 85 251 85 q 529 178 468 85 q 582 373 582 258 "},"¨":{x_min:-109,x_max:247,ha:232,o:"m 247 1046 l 119 1046 l 119 1189 l 247 1189 l 247 1046 m 19 1046 l -109 1046 l -109 1189 l 19 1189 l 19 1046 "},E:{x_min:0,x_max:736.109375,ha:789,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},Y:{x_min:0,x_max:820,ha:886,o:"m 820 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 534 l 679 1012 l 820 1013 "},'"':{x_min:0,x_max:299,ha:396,o:"m 299 606 l 203 606 l 203 988 l 299 988 l 299 606 m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"‹":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"„":{x_min:0,x_max:364,ha:467,o:"m 141 -12 q 104 -132 141 -82 q 0 -205 67 -182 l 0 -138 q 56 -82 40 -124 q 69 0 69 -51 l 0 0 l 0 151 l 141 151 l 141 -12 m 364 -12 q 327 -132 364 -82 q 222 -205 290 -182 l 222 -138 q 279 -82 262 -124 q 292 0 292 -51 l 222 0 l 222 151 l 364 151 l 364 -12 "},"δ":{x_min:1,x_max:710,ha:810,o:"m 710 360 q 616 87 710 196 q 356 -28 518 -28 q 99 82 197 -28 q 1 356 1 192 q 100 606 1 509 q 355 703 199 703 q 180 829 288 754 q 70 903 124 866 l 70 1012 l 643 1012 l 643 901 l 258 901 q 462 763 422 794 q 636 592 577 677 q 710 360 710 485 m 584 365 q 552 501 584 447 q 451 602 521 555 q 372 611 411 611 q 197 541 258 611 q 136 355 136 472 q 190 171 136 245 q 358 85 252 85 q 528 173 465 85 q 584 365 584 252 "},"έ":{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 313 0 265 q 128 390 67 352 q 56 459 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 m 520 1040 l 331 819 l 248 819 l 383 1040 l 520 1040 "},"ω":{x_min:0,x_max:922,ha:1031,o:"m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 339 0 203 q 45 551 0 444 q 161 738 84 643 l 302 738 q 175 553 219 647 q 124 336 124 446 q 155 179 124 249 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 342 797 257 q 745 556 797 450 q 619 738 705 638 l 760 738 q 874 551 835 640 q 922 339 922 444 "},"´":{x_min:0,x_max:96,ha:251,o:"m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"±":{x_min:11,x_max:781,ha:792,o:"m 781 490 l 446 490 l 446 255 l 349 255 l 349 490 l 11 490 l 11 586 l 349 586 l 349 819 l 446 819 l 446 586 l 781 586 l 781 490 m 781 21 l 11 21 l 11 115 l 781 115 l 781 21 "},"|":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},"ϋ":{x_min:0,x_max:617,ha:725,o:"m 482 800 l 372 800 l 372 925 l 482 925 l 482 800 m 239 800 l 129 800 l 129 925 l 239 925 l 239 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 "},"§":{x_min:0,x_max:593,ha:690,o:"m 593 425 q 554 312 593 369 q 467 233 516 254 q 537 83 537 172 q 459 -74 537 -12 q 288 -133 387 -133 q 115 -69 184 -133 q 47 96 47 -6 l 166 96 q 199 7 166 40 q 288 -26 232 -26 q 371 -5 332 -26 q 420 60 420 21 q 311 201 420 139 q 108 309 210 255 q 0 490 0 383 q 33 602 0 551 q 124 687 66 654 q 75 743 93 712 q 58 812 58 773 q 133 984 58 920 q 300 1043 201 1043 q 458 987 394 1043 q 529 814 529 925 l 411 814 q 370 908 404 877 q 289 939 336 939 q 213 911 246 939 q 180 841 180 883 q 286 720 180 779 q 484 612 480 615 q 593 425 593 534 m 467 409 q 355 544 467 473 q 196 630 228 612 q 146 587 162 609 q 124 525 124 558 q 239 387 124 462 q 398 298 369 315 q 448 345 429 316 q 467 409 467 375 "},b:{x_min:0,x_max:685,ha:783,o:"m 685 372 q 597 99 685 213 q 347 -25 501 -25 q 219 5 277 -25 q 121 93 161 36 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 634 q 214 723 157 692 q 341 754 272 754 q 591 637 493 754 q 685 372 685 526 m 554 356 q 499 550 554 470 q 328 644 437 644 q 162 556 223 644 q 108 369 108 478 q 160 176 108 256 q 330 83 221 83 q 498 169 435 83 q 554 356 554 245 "},q:{x_min:0,x_max:683,ha:876,o:"m 683 -278 l 564 -278 l 564 97 q 474 8 533 39 q 345 -23 415 -23 q 91 93 188 -23 q 0 364 0 203 q 87 635 0 522 q 337 760 184 760 q 466 727 408 760 q 564 637 523 695 l 564 737 l 683 737 l 683 -278 m 582 375 q 527 564 582 488 q 358 652 466 652 q 190 565 253 652 q 135 377 135 488 q 189 179 135 261 q 361 84 251 84 q 530 179 469 84 q 582 375 582 260 "},"Ω":{x_min:-.171875,x_max:969.5625,ha:1068,o:"m 969 0 l 555 0 l 555 123 q 744 308 675 194 q 814 558 814 423 q 726 812 814 709 q 484 922 633 922 q 244 820 334 922 q 154 567 154 719 q 223 316 154 433 q 412 123 292 199 l 412 0 l 0 0 l 0 124 l 217 124 q 68 327 122 210 q 15 572 15 444 q 144 911 15 781 q 484 1041 274 1041 q 822 909 691 1041 q 953 569 953 777 q 899 326 953 443 q 750 124 846 210 l 969 124 l 969 0 "},"ύ":{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 535 1040 l 346 819 l 262 819 l 397 1040 l 535 1040 "},z:{x_min:-.015625,x_max:613.890625,ha:697,o:"m 613 0 l 0 0 l 0 100 l 433 630 l 20 630 l 20 738 l 594 738 l 593 636 l 163 110 l 613 110 l 613 0 "},"™":{x_min:0,x_max:894,ha:1e3,o:"m 389 951 l 229 951 l 229 503 l 160 503 l 160 951 l 0 951 l 0 1011 l 389 1011 l 389 951 m 894 503 l 827 503 l 827 939 l 685 503 l 620 503 l 481 937 l 481 503 l 417 503 l 417 1011 l 517 1011 l 653 580 l 796 1010 l 894 1011 l 894 503 "},"ή":{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 721 124 755 q 200 630 193 687 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 m 479 1040 l 290 819 l 207 819 l 341 1040 l 479 1040 "},"Θ":{x_min:0,x_max:960,ha:1056,o:"m 960 507 q 833 129 960 280 q 476 -32 698 -32 q 123 129 255 -32 q 0 507 0 280 q 123 883 0 732 q 476 1045 255 1045 q 832 883 696 1045 q 960 507 960 732 m 817 500 q 733 789 817 669 q 476 924 639 924 q 223 792 317 924 q 142 507 142 675 q 222 222 142 339 q 476 89 315 89 q 730 218 636 89 q 817 500 817 334 m 716 449 l 243 449 l 243 571 l 716 571 l 716 449 "},"®":{x_min:-3,x_max:1008,ha:1106,o:"m 503 532 q 614 562 566 532 q 672 658 672 598 q 614 747 672 716 q 503 772 569 772 l 338 772 l 338 532 l 503 532 m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 788 146 l 678 146 q 653 316 655 183 q 527 449 652 449 l 338 449 l 338 146 l 241 146 l 241 854 l 518 854 q 688 808 621 854 q 766 658 766 755 q 739 563 766 607 q 668 497 713 519 q 751 331 747 472 q 788 164 756 190 l 788 146 "},"~":{x_min:0,x_max:833,ha:931,o:"m 833 958 q 778 753 833 831 q 594 665 716 665 q 402 761 502 665 q 240 857 302 857 q 131 795 166 857 q 104 665 104 745 l 0 665 q 54 867 0 789 q 237 958 116 958 q 429 861 331 958 q 594 765 527 765 q 704 827 670 765 q 729 958 729 874 l 833 958 "},"Ε":{x_min:0,x_max:736.21875,ha:778,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},"³":{x_min:0,x_max:450,ha:547,o:"m 450 552 q 379 413 450 464 q 220 366 313 366 q 69 414 130 366 q 0 567 0 470 l 85 567 q 126 470 85 504 q 225 437 168 437 q 320 467 280 437 q 360 552 360 498 q 318 632 360 608 q 213 657 276 657 q 195 657 203 657 q 176 657 181 657 l 176 722 q 279 733 249 722 q 334 815 334 752 q 300 881 334 856 q 220 907 267 907 q 133 875 169 907 q 97 781 97 844 l 15 781 q 78 926 15 875 q 220 972 135 972 q 364 930 303 972 q 426 817 426 888 q 344 697 426 733 q 421 642 392 681 q 450 552 450 603 "},"[":{x_min:0,x_max:273.609375,ha:371,o:"m 273 -281 l 0 -281 l 0 1013 l 273 1013 l 273 920 l 124 920 l 124 -187 l 273 -187 l 273 -281 "},L:{x_min:0,x_max:645.828125,ha:696,o:"m 645 0 l 0 0 l 0 1013 l 140 1013 l 140 126 l 645 126 l 645 0 "},"σ":{x_min:0,x_max:803.390625,ha:894,o:"m 803 628 l 633 628 q 713 368 713 512 q 618 93 713 204 q 357 -25 518 -25 q 94 91 194 -25 q 0 368 0 201 q 94 644 0 533 q 356 761 194 761 q 481 750 398 761 q 608 739 564 739 l 803 739 l 803 628 m 360 85 q 529 180 467 85 q 584 374 584 262 q 527 566 584 490 q 352 651 463 651 q 187 559 247 651 q 135 368 135 478 q 189 175 135 254 q 360 85 251 85 "},"ζ":{x_min:0,x_max:573,ha:642,o:"m 573 -40 q 553 -162 573 -97 q 510 -278 543 -193 l 400 -278 q 441 -187 428 -219 q 462 -90 462 -132 q 378 -14 462 -14 q 108 45 197 -14 q 0 290 0 117 q 108 631 0 462 q 353 901 194 767 l 55 901 l 55 1012 l 561 1012 l 561 924 q 261 669 382 831 q 128 301 128 489 q 243 117 128 149 q 458 98 350 108 q 573 -40 573 80 "},"θ":{x_min:0,x_max:674,ha:778,o:"m 674 496 q 601 160 674 304 q 336 -26 508 -26 q 73 153 165 -26 q 0 485 0 296 q 72 840 0 683 q 343 1045 166 1045 q 605 844 516 1045 q 674 496 674 692 m 546 579 q 498 798 546 691 q 336 935 437 935 q 178 798 237 935 q 126 579 137 701 l 546 579 m 546 475 l 126 475 q 170 233 126 348 q 338 80 230 80 q 504 233 447 80 q 546 475 546 346 "},"Ο":{x_min:0,x_max:958,ha:1054,o:"m 485 1042 q 834 883 703 1042 q 958 511 958 735 q 834 136 958 287 q 481 -26 701 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 729 q 485 1042 263 1042 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 670 q 480 913 640 913 q 226 785 321 913 q 142 504 142 671 q 226 224 142 339 q 480 98 319 98 "},"Γ":{x_min:0,x_max:705.28125,ha:749,o:"m 705 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 705 1012 l 705 886 "}," ":{x_min:0,x_max:0,ha:375},"%":{x_min:-3,x_max:1089,ha:1186,o:"m 845 0 q 663 76 731 0 q 602 244 602 145 q 661 412 602 344 q 845 489 728 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 845 0 962 0 m 844 103 q 945 143 909 103 q 981 243 981 184 q 947 340 981 301 q 844 385 909 385 q 744 342 781 385 q 708 243 708 300 q 741 147 708 186 q 844 103 780 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 "},P:{x_min:0,x_max:726,ha:806,o:"m 424 1013 q 640 931 555 1013 q 726 719 726 850 q 637 506 726 587 q 413 426 548 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 379 889 l 140 889 l 140 548 l 372 548 q 522 589 459 548 q 593 720 593 637 q 528 845 593 801 q 379 889 463 889 "},"Έ":{x_min:0,x_max:1078.21875,ha:1118,o:"m 1078 0 l 342 0 l 342 1013 l 1067 1013 l 1067 889 l 481 889 l 481 585 l 1019 585 l 1019 467 l 481 467 l 481 125 l 1078 125 l 1078 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"Ώ":{x_min:.125,x_max:1136.546875,ha:1235,o:"m 1136 0 l 722 0 l 722 123 q 911 309 842 194 q 981 558 981 423 q 893 813 981 710 q 651 923 800 923 q 411 821 501 923 q 321 568 321 720 q 390 316 321 433 q 579 123 459 200 l 579 0 l 166 0 l 166 124 l 384 124 q 235 327 289 210 q 182 572 182 444 q 311 912 182 782 q 651 1042 441 1042 q 989 910 858 1042 q 1120 569 1120 778 q 1066 326 1120 443 q 917 124 1013 210 l 1136 124 l 1136 0 m 277 1040 l 83 800 l 0 800 l 140 1041 l 277 1040 "},_:{x_min:0,x_max:705.5625,ha:803,o:"m 705 -334 l 0 -334 l 0 -234 l 705 -234 l 705 -334 "},"Ϊ":{x_min:-110,x_max:246,ha:275,o:"m 246 1046 l 118 1046 l 118 1189 l 246 1189 l 246 1046 m 18 1046 l -110 1046 l -110 1189 l 18 1189 l 18 1046 m 136 0 l 0 0 l 0 1012 l 136 1012 l 136 0 "},"+":{x_min:23,x_max:768,ha:792,o:"m 768 372 l 444 372 l 444 0 l 347 0 l 347 372 l 23 372 l 23 468 l 347 468 l 347 840 l 444 840 l 444 468 l 768 468 l 768 372 "},"½":{x_min:0,x_max:1050,ha:1149,o:"m 1050 0 l 625 0 q 712 178 625 108 q 878 277 722 187 q 967 385 967 328 q 932 456 967 429 q 850 484 897 484 q 759 450 798 484 q 721 352 721 416 l 640 352 q 706 502 640 448 q 851 551 766 551 q 987 509 931 551 q 1050 385 1050 462 q 976 251 1050 301 q 829 179 902 215 q 717 68 740 133 l 1050 68 l 1050 0 m 834 985 l 215 -28 l 130 -28 l 750 984 l 834 985 m 224 422 l 142 422 l 142 811 l 0 811 l 0 867 q 104 889 62 867 q 164 973 157 916 l 224 973 l 224 422 "},"Ρ":{x_min:0,x_max:720,ha:783,o:"m 424 1013 q 637 933 554 1013 q 720 723 720 853 q 633 508 720 591 q 413 426 546 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 378 889 l 140 889 l 140 548 l 371 548 q 521 589 458 548 q 592 720 592 637 q 527 845 592 801 q 378 889 463 889 "},"'":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},"ª":{x_min:0,x_max:350,ha:397,o:"m 350 625 q 307 616 328 616 q 266 631 281 616 q 247 673 251 645 q 190 628 225 644 q 116 613 156 613 q 32 641 64 613 q 0 722 0 669 q 72 826 0 800 q 247 866 159 846 l 247 887 q 220 934 247 916 q 162 953 194 953 q 104 934 129 953 q 76 882 80 915 l 16 882 q 60 976 16 941 q 166 1011 104 1011 q 266 979 224 1011 q 308 891 308 948 l 308 706 q 311 679 308 688 q 331 670 315 670 l 350 672 l 350 625 m 247 757 l 247 811 q 136 790 175 798 q 64 726 64 773 q 83 682 64 697 q 132 667 103 667 q 207 690 174 667 q 247 757 247 718 "},"΅":{x_min:0,x_max:450,ha:553,o:"m 450 800 l 340 800 l 340 925 l 450 925 l 450 800 m 406 1040 l 212 800 l 129 800 l 269 1040 l 406 1040 m 110 800 l 0 800 l 0 925 l 110 925 l 110 800 "},T:{x_min:0,x_max:777,ha:835,o:"m 777 894 l 458 894 l 458 0 l 319 0 l 319 894 l 0 894 l 0 1013 l 777 1013 l 777 894 "},"Φ":{x_min:0,x_max:915,ha:997,o:"m 527 0 l 389 0 l 389 122 q 110 231 220 122 q 0 509 0 340 q 110 785 0 677 q 389 893 220 893 l 389 1013 l 527 1013 l 527 893 q 804 786 693 893 q 915 509 915 679 q 805 231 915 341 q 527 122 696 122 l 527 0 m 527 226 q 712 310 641 226 q 779 507 779 389 q 712 705 779 627 q 527 787 641 787 l 527 226 m 389 226 l 389 787 q 205 698 275 775 q 136 505 136 620 q 206 308 136 391 q 389 226 276 226 "},"⁋":{x_min:0,x_max:0,ha:694},j:{x_min:-77.78125,x_max:167,ha:349,o:"m 167 871 l 42 871 l 42 1013 l 167 1013 l 167 871 m 167 -80 q 121 -231 167 -184 q -26 -278 76 -278 l -77 -278 l -77 -164 l -41 -164 q 26 -143 11 -164 q 42 -65 42 -122 l 42 737 l 167 737 l 167 -80 "},"Σ":{x_min:0,x_max:756.953125,ha:819,o:"m 756 0 l 0 0 l 0 107 l 395 523 l 22 904 l 22 1013 l 745 1013 l 745 889 l 209 889 l 566 523 l 187 125 l 756 125 l 756 0 "},1:{x_min:215.671875,x_max:574,ha:792,o:"m 574 0 l 442 0 l 442 697 l 215 697 l 215 796 q 386 833 330 796 q 475 986 447 875 l 574 986 l 574 0 "},"›":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},"<":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"£":{x_min:0,x_max:704.484375,ha:801,o:"m 704 41 q 623 -10 664 5 q 543 -26 583 -26 q 359 15 501 -26 q 243 36 288 36 q 158 23 197 36 q 73 -21 119 10 l 6 76 q 125 195 90 150 q 175 331 175 262 q 147 443 175 383 l 0 443 l 0 512 l 108 512 q 43 734 43 623 q 120 929 43 854 q 358 1010 204 1010 q 579 936 487 1010 q 678 729 678 857 l 678 684 l 552 684 q 504 838 552 780 q 362 896 457 896 q 216 852 263 896 q 176 747 176 815 q 199 627 176 697 q 248 512 217 574 l 468 512 l 468 443 l 279 443 q 297 356 297 398 q 230 194 297 279 q 153 107 211 170 q 227 133 190 125 q 293 142 264 142 q 410 119 339 142 q 516 96 482 96 q 579 105 550 96 q 648 142 608 115 l 704 41 "},t:{x_min:0,x_max:367,ha:458,o:"m 367 0 q 312 -5 339 -2 q 262 -8 284 -8 q 145 28 183 -8 q 108 143 108 64 l 108 638 l 0 638 l 0 738 l 108 738 l 108 944 l 232 944 l 232 738 l 367 738 l 367 638 l 232 638 l 232 185 q 248 121 232 140 q 307 102 264 102 q 345 104 330 102 q 367 107 360 107 l 367 0 "},"¬":{x_min:0,x_max:706,ha:803,o:"m 706 411 l 706 158 l 630 158 l 630 335 l 0 335 l 0 411 l 706 411 "},"λ":{x_min:0,x_max:750,ha:803,o:"m 750 -7 q 679 -15 716 -15 q 538 59 591 -15 q 466 214 512 97 l 336 551 l 126 0 l 0 0 l 270 705 q 223 837 247 770 q 116 899 190 899 q 90 898 100 899 l 90 1004 q 152 1011 125 1011 q 298 938 244 1011 q 373 783 326 901 l 605 192 q 649 115 629 136 q 716 95 669 95 l 736 95 q 750 97 745 97 l 750 -7 "},W:{x_min:0,x_max:1263.890625,ha:1351,o:"m 1263 1013 l 995 0 l 859 0 l 627 837 l 405 0 l 265 0 l 0 1013 l 136 1013 l 342 202 l 556 1013 l 701 1013 l 921 207 l 1133 1012 l 1263 1013 "},">":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},v:{x_min:0,x_max:675.15625,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 737 l 340 147 l 541 737 l 675 738 "},"τ":{x_min:.28125,x_max:644.5,ha:703,o:"m 644 628 l 382 628 l 382 179 q 388 120 382 137 q 436 91 401 91 q 474 94 447 91 q 504 97 501 97 l 504 0 q 454 -9 482 -5 q 401 -14 426 -14 q 278 67 308 -14 q 260 233 260 118 l 260 628 l 0 628 l 0 739 l 644 739 l 644 628 "},"ξ":{x_min:0,x_max:624.9375,ha:699,o:"m 624 -37 q 608 -153 624 -96 q 563 -278 593 -211 l 454 -278 q 491 -183 486 -200 q 511 -83 511 -126 q 484 -23 511 -44 q 370 1 452 1 q 323 0 354 1 q 283 -1 293 -1 q 84 76 169 -1 q 0 266 0 154 q 56 431 0 358 q 197 538 108 498 q 94 613 134 562 q 54 730 54 665 q 77 823 54 780 q 143 901 101 867 l 27 901 l 27 1012 l 576 1012 l 576 901 l 380 901 q 244 863 303 901 q 178 745 178 820 q 312 600 178 636 q 532 582 380 582 l 532 479 q 276 455 361 479 q 118 281 118 410 q 165 173 118 217 q 274 120 208 133 q 494 101 384 110 q 624 -37 624 76 "},"&":{x_min:-3,x_max:894.25,ha:992,o:"m 894 0 l 725 0 l 624 123 q 471 0 553 40 q 306 -41 390 -41 q 168 -7 231 -41 q 62 92 105 26 q 14 187 31 139 q -3 276 -3 235 q 55 433 -3 358 q 248 581 114 508 q 170 689 196 640 q 137 817 137 751 q 214 985 137 922 q 384 1041 284 1041 q 548 988 483 1041 q 622 824 622 928 q 563 666 622 739 q 431 556 516 608 l 621 326 q 649 407 639 361 q 663 493 653 426 l 781 493 q 703 229 781 352 l 894 0 m 504 818 q 468 908 504 877 q 384 940 433 940 q 293 907 331 940 q 255 818 255 875 q 289 714 255 767 q 363 628 313 678 q 477 729 446 682 q 504 818 504 771 m 556 209 l 314 499 q 179 395 223 449 q 135 283 135 341 q 146 222 135 253 q 183 158 158 192 q 333 80 241 80 q 556 209 448 80 "},"Λ":{x_min:0,x_max:862.5,ha:942,o:"m 862 0 l 719 0 l 426 847 l 143 0 l 0 0 l 356 1013 l 501 1013 l 862 0 "},I:{x_min:41,x_max:180,ha:293,o:"m 180 0 l 41 0 l 41 1013 l 180 1013 l 180 0 "},G:{x_min:0,x_max:921,ha:1011,o:"m 921 0 l 832 0 l 801 136 q 655 15 741 58 q 470 -28 568 -28 q 126 133 259 -28 q 0 499 0 284 q 125 881 0 731 q 486 1043 259 1043 q 763 957 647 1043 q 905 709 890 864 l 772 709 q 668 866 747 807 q 486 926 589 926 q 228 795 322 926 q 142 507 142 677 q 228 224 142 342 q 483 94 323 94 q 712 195 625 94 q 796 435 796 291 l 477 435 l 477 549 l 921 549 l 921 0 "},"ΰ":{x_min:0,x_max:617,ha:725,o:"m 524 800 l 414 800 l 414 925 l 524 925 l 524 800 m 183 800 l 73 800 l 73 925 l 183 925 l 183 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 489 1040 l 300 819 l 216 819 l 351 1040 l 489 1040 "},"`":{x_min:0,x_max:138.890625,ha:236,o:"m 138 699 l 0 699 l 0 861 q 36 974 0 929 q 138 1041 72 1020 l 138 977 q 82 931 95 969 q 69 839 69 893 l 138 839 l 138 699 "},"·":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},"Υ":{x_min:.328125,x_max:819.515625,ha:889,o:"m 819 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 "},r:{x_min:0,x_max:355.5625,ha:432,o:"m 355 621 l 343 621 q 179 569 236 621 q 122 411 122 518 l 122 0 l 0 0 l 0 737 l 117 737 l 117 604 q 204 719 146 686 q 355 753 262 753 l 355 621 "},x:{x_min:0,x_max:675,ha:764,o:"m 675 0 l 525 0 l 331 286 l 144 0 l 0 0 l 256 379 l 12 738 l 157 737 l 336 473 l 516 738 l 661 738 l 412 380 l 675 0 "},"μ":{x_min:0,x_max:696.609375,ha:747,o:"m 696 -4 q 628 -14 657 -14 q 498 97 513 -14 q 422 8 470 41 q 313 -24 374 -24 q 207 3 258 -24 q 120 80 157 31 l 120 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 172 124 246 q 308 82 216 82 q 451 177 402 82 q 492 358 492 254 l 492 738 l 616 738 l 616 214 q 623 136 616 160 q 673 92 636 92 q 696 95 684 92 l 696 -4 "},h:{x_min:0,x_max:615,ha:724,o:"m 615 472 l 615 0 l 490 0 l 490 454 q 456 590 490 535 q 338 654 416 654 q 186 588 251 654 q 122 436 122 522 l 122 0 l 0 0 l 0 1013 l 122 1013 l 122 633 q 218 727 149 694 q 362 760 287 760 q 552 676 484 760 q 615 472 615 600 "},".":{x_min:0,x_max:142,ha:239,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},"φ":{x_min:-2,x_max:878,ha:974,o:"m 496 -279 l 378 -279 l 378 -17 q 101 88 204 -17 q -2 367 -2 194 q 68 626 -2 510 q 283 758 151 758 l 283 646 q 167 537 209 626 q 133 373 133 462 q 192 177 133 254 q 378 93 259 93 l 378 758 q 445 764 426 763 q 476 765 464 765 q 765 659 653 765 q 878 377 878 553 q 771 96 878 209 q 496 -17 665 -17 l 496 -279 m 496 93 l 514 93 q 687 183 623 93 q 746 380 746 265 q 691 569 746 491 q 522 658 629 658 l 496 656 l 496 93 "},";":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 -12 q 105 -132 142 -82 q 0 -206 68 -182 l 0 -138 q 58 -82 43 -123 q 68 0 68 -56 l 0 0 l 0 151 l 142 151 l 142 -12 "},f:{x_min:0,x_max:378,ha:472,o:"m 378 638 l 246 638 l 246 0 l 121 0 l 121 638 l 0 638 l 0 738 l 121 738 q 137 935 121 887 q 290 1028 171 1028 q 320 1027 305 1028 q 378 1021 334 1026 l 378 908 q 323 918 346 918 q 257 870 273 918 q 246 780 246 840 l 246 738 l 378 738 l 378 638 "},"“":{x_min:1,x_max:348.21875,ha:454,o:"m 140 670 l 1 670 l 1 830 q 37 943 1 897 q 140 1011 74 990 l 140 947 q 82 900 97 940 q 68 810 68 861 l 140 810 l 140 670 m 348 670 l 209 670 l 209 830 q 245 943 209 897 q 348 1011 282 990 l 348 947 q 290 900 305 940 q 276 810 276 861 l 348 810 l 348 670 "},A:{x_min:.03125,x_max:906.953125,ha:1008,o:"m 906 0 l 756 0 l 648 303 l 251 303 l 142 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 610 421 l 452 867 l 293 421 l 610 421 "},6:{x_min:53,x_max:739,ha:792,o:"m 739 312 q 633 62 739 162 q 400 -31 534 -31 q 162 78 257 -31 q 53 439 53 206 q 178 859 53 712 q 441 986 284 986 q 643 912 559 986 q 732 713 732 833 l 601 713 q 544 830 594 786 q 426 875 494 875 q 268 793 331 875 q 193 517 193 697 q 301 597 240 570 q 427 624 362 624 q 643 540 552 624 q 739 312 739 451 m 603 298 q 540 461 603 400 q 404 516 484 516 q 268 461 323 516 q 207 300 207 401 q 269 137 207 198 q 405 83 325 83 q 541 137 486 83 q 603 298 603 197 "},"‘":{x_min:1,x_max:139.890625,ha:236,o:"m 139 670 l 1 670 l 1 830 q 37 943 1 897 q 139 1011 74 990 l 139 947 q 82 900 97 940 q 68 810 68 861 l 139 810 l 139 670 "},"ϊ":{x_min:-70,x_max:283,ha:361,o:"m 283 800 l 173 800 l 173 925 l 283 925 l 283 800 m 40 800 l -70 800 l -70 925 l 40 925 l 40 800 m 283 3 q 232 -10 257 -5 q 181 -15 206 -15 q 84 26 118 -15 q 41 200 41 79 l 41 737 l 166 737 l 167 215 q 171 141 167 157 q 225 101 182 101 q 247 103 238 101 q 283 112 256 104 l 283 3 "},"π":{x_min:-.21875,x_max:773.21875,ha:857,o:"m 773 -7 l 707 -11 q 575 40 607 -11 q 552 174 552 77 l 552 226 l 552 626 l 222 626 l 222 0 l 97 0 l 97 626 l 0 626 l 0 737 l 773 737 l 773 626 l 676 626 l 676 171 q 695 103 676 117 q 773 90 714 90 l 773 -7 "},"ά":{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 727 407 760 q 563 637 524 695 l 563 738 l 685 738 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 95 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 m 604 1040 l 415 819 l 332 819 l 466 1040 l 604 1040 "},O:{x_min:0,x_max:958,ha:1057,o:"m 485 1041 q 834 882 702 1041 q 958 512 958 734 q 834 136 958 287 q 481 -26 702 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 728 q 485 1041 263 1041 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 669 q 480 912 640 912 q 226 784 321 912 q 142 504 142 670 q 226 224 142 339 q 480 98 319 98 "},n:{x_min:0,x_max:615,ha:724,o:"m 615 463 l 615 0 l 490 0 l 490 454 q 453 592 490 537 q 331 656 410 656 q 178 585 240 656 q 117 421 117 514 l 117 0 l 0 0 l 0 738 l 117 738 l 117 630 q 218 728 150 693 q 359 764 286 764 q 552 675 484 764 q 615 463 615 593 "},3:{x_min:54,x_max:737,ha:792,o:"m 737 284 q 635 55 737 141 q 399 -25 541 -25 q 156 52 248 -25 q 54 308 54 140 l 185 308 q 245 147 185 202 q 395 96 302 96 q 539 140 484 96 q 602 280 602 190 q 510 429 602 390 q 324 454 451 454 l 324 565 q 487 584 441 565 q 565 719 565 617 q 515 835 565 791 q 395 879 466 879 q 255 824 307 879 q 203 661 203 769 l 78 661 q 166 909 78 822 q 387 992 250 992 q 603 921 513 992 q 701 723 701 844 q 669 607 701 656 q 578 524 637 558 q 696 434 655 499 q 737 284 737 369 "},9:{x_min:53,x_max:739,ha:792,o:"m 739 524 q 619 94 739 241 q 362 -32 516 -32 q 150 47 242 -32 q 59 244 59 126 l 191 244 q 246 129 191 176 q 373 82 301 82 q 526 161 466 82 q 597 440 597 255 q 363 334 501 334 q 130 432 216 334 q 53 650 53 521 q 134 880 53 786 q 383 986 226 986 q 659 841 566 986 q 739 524 739 719 m 388 449 q 535 514 480 449 q 585 658 585 573 q 535 805 585 744 q 388 873 480 873 q 242 809 294 873 q 191 658 191 745 q 239 514 191 572 q 388 449 292 449 "},l:{x_min:41,x_max:166,ha:279,o:"m 166 0 l 41 0 l 41 1013 l 166 1013 l 166 0 "},"¤":{x_min:40.09375,x_max:728.796875,ha:825,o:"m 728 304 l 649 224 l 512 363 q 383 331 458 331 q 256 363 310 331 l 119 224 l 40 304 l 177 441 q 150 553 150 493 q 184 673 150 621 l 40 818 l 119 898 l 267 749 q 321 766 291 759 q 384 773 351 773 q 447 766 417 773 q 501 749 477 759 l 649 898 l 728 818 l 585 675 q 612 618 604 648 q 621 553 621 587 q 591 441 621 491 l 728 304 m 384 682 q 280 643 318 682 q 243 551 243 604 q 279 461 243 499 q 383 423 316 423 q 487 461 449 423 q 525 553 525 500 q 490 641 525 605 q 384 682 451 682 "},"κ":{x_min:0,x_max:632.328125,ha:679,o:"m 632 0 l 482 0 l 225 384 l 124 288 l 124 0 l 0 0 l 0 738 l 124 738 l 124 446 l 433 738 l 596 738 l 312 466 l 632 0 "},4:{x_min:48,x_max:742.453125,ha:792,o:"m 742 243 l 602 243 l 602 0 l 476 0 l 476 243 l 48 243 l 48 368 l 476 958 l 602 958 l 602 354 l 742 354 l 742 243 m 476 354 l 476 792 l 162 354 l 476 354 "},p:{x_min:0,x_max:685,ha:786,o:"m 685 364 q 598 96 685 205 q 350 -23 504 -23 q 121 89 205 -23 l 121 -278 l 0 -278 l 0 738 l 121 738 l 121 633 q 220 726 159 691 q 351 761 280 761 q 598 636 504 761 q 685 364 685 522 m 557 371 q 501 560 557 481 q 330 651 437 651 q 162 559 223 651 q 108 366 108 479 q 162 177 108 254 q 333 87 224 87 q 502 178 441 87 q 557 371 557 258 "},"‡":{x_min:0,x_max:777,ha:835,o:"m 458 238 l 458 0 l 319 0 l 319 238 l 0 238 l 0 360 l 319 360 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 l 777 804 l 777 683 l 458 683 l 458 360 l 777 360 l 777 238 l 458 238 "},"ψ":{x_min:0,x_max:808,ha:907,o:"m 465 -278 l 341 -278 l 341 -15 q 87 102 180 -15 q 0 378 0 210 l 0 739 l 133 739 l 133 379 q 182 195 133 275 q 341 98 242 98 l 341 922 l 465 922 l 465 98 q 623 195 563 98 q 675 382 675 278 l 675 742 l 808 742 l 808 381 q 720 104 808 213 q 466 -13 627 -13 l 465 -278 "},"η":{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 720 124 755 q 200 630 193 686 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 "}},cssFontWeight:"normal",ascender:1189,underlinePosition:-100,cssFontStyle:"normal",boundingBox:{yMin:-334,xMin:-111,yMax:1189,xMax:1672},resolution:1e3,original_font_information:{postscript_name:"Helvetiker-Regular",version_string:"Version 1.00 2004 initial release",vendor_url:"http://www.magenta.gr/",full_font_name:"Helvetiker",font_family_name:"Helvetiker",copyright:"Copyright (c) Μagenta ltd, 2004",description:"",trademark:"",designer:"",designer_url:"",unique_font_identifier:"Μagenta ltd:Helvetiker:22-10-104",license_url:"http://www.ellak.gr/fonts/MgOpen/license.html",license_description:'Copyright (c) 2004 by MAGENTA Ltd. All Rights Reserved.\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of the fonts accompanying this license ("Fonts") and associated documentation files (the "Font Software"), to reproduce and distribute the Font Software, including without limitation the rights to use, copy, merge, publish, distribute, and/or sell copies of the Font Software, and to permit persons to whom the Font Software is furnished to do so, subject to the following conditions: \r\n\r\nThe above copyright and this permission notice shall be included in all copies of one or more of the Font Software typefaces.\r\n\r\nThe Font Software may be modified, altered, or added to, and in particular the designs of glyphs or characters in the Fonts may be modified and additional glyphs or characters may be added to the Fonts, only if the fonts are renamed to names not containing the word "MgOpen", or if the modifications are accepted for inclusion in the Font Software itself by the each appointed Administrator.\r\n\r\nThis License becomes null and void to the extent applicable to Fonts or Font Software that has been modified and is distributed under the "MgOpen" name.\r\n\r\nThe Font Software may be sold as part of a larger software package but no copy of one or more of the Font Software typefaces may be sold by itself. \r\n\r\nTHE FONT SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF COPYRIGHT, PATENT, TRADEMARK, OR OTHER RIGHT. IN NO EVENT SHALL MAGENTA OR PERSONS OR BODIES IN CHARGE OF ADMINISTRATION AND MAINTENANCE OF THE FONT SOFTWARE BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, INCLUDING ANY GENERAL, SPECIAL, INDIRECT, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF THE USE OR INABILITY TO USE THE FONT SOFTWARE OR FROM OTHER DEALINGS IN THE FONT SOFTWARE.',manufacturer_name:"Μagenta ltd",font_sub_family_name:"Regular"},descender:-334,familyName:"Helvetiker",lineHeight:1522,underlineThickness:50})}}])}(pt),function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="VideoProbe",e}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.ascept=null,this.field=null,this.probeLength=null,this.pitch=null}}]),t}(Ct)),Lt=function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="World",e}return ut(t,e),st(t,[{key:"clear",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this,e),this.outdoors=null,this.buildings=[]}}]),t}(pt),It=new function e(){at(this,e),this.isDebug=!1,this.isTesting=!1},Nt=function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="RouteLine",e}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.color=[0,0,1]}},{key:"clear",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this,e),this.color=null}}]),t}(Tt),Ht=function(e){function t(e){at(this,t);var n=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.type="PlacementWall",n}return ut(t,e),t}(Ct),zt=function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="PlacementGround",e}return ut(t,e),t}(Ct),Ut=function(e){function t(e){at(this,t);var n=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.type=dt.StraightManualWall,n}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.leftResource=null,this.rightResource=null,this.edgeResource=null,this.uvMultiple=[1,1],this.lightUV=null,this.topOffset=null,this.suspend=0,this.thick=.15,this.height=3}},{key:"selfSize",get:function(){if(null===this._selfSize){this._box3=new it;for(var e=[this.startCorner,this.endCorner],t=0;t<e.length;t++){var n=e[t].position,i=new nt(n[0],n[1],n[2]);this._box3.expandByPoint(i),(i=i.clone()).y=this.parent.height,this._box3.expandByPoint(i)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.leftResource&&this._resources.push(this.leftResource),this.rightResource&&this._resources.push(this.rightResource),this.edgeResource&&this._resources.push(this.edgeResource)),this._resources}}]),t}(_t),Vt=function(e){function t(e){at(this,t);var n=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.objects=[],n}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.objects=[]}},{key:"_buildSelf",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_buildSelf",this).call(this)}},{key:"clear",value:function(){for(var e=0;e<this.objects.length;e++){this.objects[e].clear()}lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(pt),qt=function(e){function t(e){at(this,t);var n=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.type="CombineStraightManualWall",n}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.walls=[],this.leftWallResourceMap=new Map,this.rightWallResourceMap=new Map,this.corners=[],this._resourceDic={},this._resources=[]}},{key:"addObject",value:function(e){this.walls.push(e),this.leftWallResourceMap.has(e.leftResource)||this.leftWallResourceMap.set(e.leftResource,[]),this.rightWallResourceMap.has(e.rightResource)||this.rightWallResourceMap.set(e.rightResource,[]),this.leftWallResourceMap.get(e.leftResource).push(e),this.rightWallResourceMap.get(e.rightResource).push(e),this.addCorner(e.startCorner),this.addCorner(e.endCorner);for(var t=e.resources,n=0;n<t.length;n++){var i=t[n];this._resourceDic[i.id]||(this._resources.push(i),this._resourceDic[i.id]=i)}}},{key:"addCorner",value:function(e){for(var t=0;t<this.corners.length;t++){if(this.corners[t]===e)return}this.corners.push(e)}},{key:"_addResource",value:function(){}},{key:"clear",value:function(){for(var e=0;e<this.walls.length;e++){this.walls[e].clear()}for(var n=0;n<this.corners.length;n++){var i=this.corners[n];0===i.walls.length&&i.clear()}lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"selfSize",get:function(){if(null===this._selfSize){this._box3=new it;for(var e=0;e<this.corners.length;e++){var t=this.corners[e].position,n=new nt(t[0],t[1],t[2]);this._box3.expandByPoint(n),(n=n.clone()).y=this.parent.height,this._box3.expandByPoint(n)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}}]),t}(Vt),Gt=function(){function e(){at(this,e),this.positions=[],this.scales=[],this.quaternions=[]}return st(e,[{key:"clone",value:function(){var t=new e;return t.positions=this.positions.slice(),t.scales=this.scales.slice(),t.quaternions=this.quaternions.slice(),t}}]),e}(),Wt=function(e){function t(e){at(this,t);var n=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.type=dt.CombinePlacement,n}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.objects=[],this.belongRoomUserID=null,this.transformations=[]}},{key:"addObject",value:function(e){this.objects.push(e);var t=new Gt;t.positions.push(e.position),t.scales.push(e.scale),t.quaternions.push(e.rotation),this.transformations.push(t)}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){if(null===this._selfSize){this._box3=new it;for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t.size&&this._box3.union(t._box3)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}}]),t}(Vt),Xt={World:Lt,Building:wt,FloorPlan:kt,Room:ft,Floor:bt,Ceiling:gt,Roof:vt,StraightManualWall:Ut,ModelWall:xt,WallCorner:Et,Placement:Ct,PlacementGroup:Pt,DoorOrWindow:Rt,Outdoors:jt,Facade:At,FacadeGroup:Dt,VideoProbe:Bt,CurveLine:Tt,LeakWaterLine:Ft,ArrowLine:Mt,ArrowDataLine:St,RouteLine:Nt,PipeLine:Ot,PlacementWall:Ht,PlacementGround:zt,CombineStraightManualWall:qt,CombineDoorOrWindow:function(e){function t(e){at(this,t);var n=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.type="CombineDoorOrWindow",n}return ut(t,e),st(t,[{key:"addObject",value:function(e){this.objects.push(e)}}]),t}(Wt),CombinePlacement:Wt,CombineFloor:function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type=dt.CombineFloor,e}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._height=.01,this.rotation=[-.7071067811865475,-0,-0,.7071067811865476],this.position[1]=this._height}},{key:"addObject",value:function(e){this.objects.push(e)}},{key:"size",set:function(e){this._size=e},get:function(){return null===this._size&&(this._size=[0,0,0]),this._size}},{key:"height",set:function(e){this._height=e,this.position[1]=this._height},get:function(){return this._height}}]),t}(Vt),CombineCeiling:function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type=dt.CombineCeiling,e}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._height=3,this.rotation=[.7071067811865475,-0,-0,.7071067811865476],this.position[1]=this._height}},{key:"addObject",value:function(e){this.objects.push(e)}},{key:"size",get:function(){return null===this._size&&(this._size=[0,0,0]),this._size}},{key:"height",set:function(e){this._height=e,this.position[1]=this._height},get:function(){return this._height}}]),t}(Vt),CombineRoof:function(e){function t(){at(this,t);var e=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type=dt.CombineRoof,e}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._height=3,this.rotation=[-.7071067811865475,-0,-0,.7071067811865476],this.position[1]=this._height+.005}},{key:"addObject",value:function(e){this.objects.push(e)}},{key:"size",get:function(){return null===this._size&&(this._size=[0,0,0]),this._size}},{key:"height",set:function(e){this._height=e,this.position[1]=this._height+.005},get:function(){return this._height}}]),t}(Vt),CombineModelWall:function(e){function t(e){at(this,t);var n=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.type=dt.CombineModelWall,n}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.walls=[],this.corners=[]}},{key:"addObject",value:function(e){this.walls.push(e),this.addCorner(e.startCorner),this.addCorner(e.endCorner)}},{key:"addCorner",value:function(e){this.corners.push(e)}},{key:"clear",value:function(){for(var e=0;e<this.walls.length;e++){this.walls[e].clear()}for(var n=0;n<this.corners.length;n++){var i=this.corners[n];0===i.walls.length&&i.clear()}lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){if(null===this._selfSize){this._box3=new it;for(var e=0;e<this.corners.length;e++){var t=this.corners[e].position,n=new nt(t[0],t[1],t[2]);this._box3.expandByPoint(n),(n=n.clone()).y=this.parent.height,this._box3.expandByPoint(n)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}}]),t}(Vt),CombinePlacementGroup:function(e){function t(e){at(this,t);var n=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.type=dt.CombinePlacementGroup,n}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.belongRoomUserID=null,this.transformations=[],this._resourcesMap={}}},{key:"addObject",value:function(e){this.objects.push(e);var t=new Gt;t.positions.push(e.position),t.scales.push(e.scale),t.quaternions.push(e.rotation),this.transformations.push(t)}},{key:"selfSize",get:function(){if(null===this._selfSize){if(!(this.objects.length>0))return[0,0,0];this._box3=new it;for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t.size&&this._box3.union(t._box3)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}},{key:"resources",get:function(){if(null===this._resources){this._resources=[];for(var e=0;e<this.objects.length;e++)for(var t=this.objects[e],n=0;n<t.resources.length;n++){var i=t.resources[n];this._resourcesMap[i.id]||(this._resources.push(i),this._resourcesMap[i.id]=i)}}return this._resources}}]),t}(Vt),CombinePlacementWall:function(e){function t(e){at(this,t);var n=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.type=dt.CombinePlacementWall,n}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.belongRoomUserID=null,this.transformations=[]}},{key:"addObject",value:function(e){this.objects.push(e);var t=new Gt;t.positions.push(e.position),t.scales.push(e.scale),t.quaternions.push(e.rotation),this.transformations.push(t)}},{key:"selfSize",get:function(){if(null===this._selfSize){this._box3=new it;for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t.size&&this._box3.union(t._box3)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}}]),t}(Vt)},Jt=function(){function e(){at(this,e),this.objects=[],this.calculaterManager=null,this.meshBuilderManager=null,this.ClassName=dt}return st(e,[{key:"create",value:function(e){var t=e.type,n=e.parent,i=new(0,Xt[t]);return i.parent=n,this.calculaterManager&&(i.calculater=this.calculaterManager.create({type:t,object:i})),this.meshBuilderManager&&(i.meshBuilder=this.meshBuilderManager.create({type:t,object:i})),i}},{key:"registerObjectClass",value:function(e,t){Xt[e]=t}},{key:"unregisterObjectClass",value:function(e){Xt[e]=null}},{key:"containObjectClass",value:function(e){return!!Xt[e]}},{key:"clear",value:function(){this.objects=null,this.calculaterManager=null,this.meshBuilderManager=null}}]),e}(),Yt=new Jt,Qt=function(){function e(t){at(this,e),this._initParams(),this.manager=t.manager,this.type="BaseResource"}return st(e,[{key:"_initParams",value:function(){this.id=null,this.url=null,this.isBuilded=!1,this.ext=null,this.version=null,this.isDefault=!1,this.builder=null,this.manager=null,this.type=null,this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this.buildPromise=null,this._registerBuilders=[],this._registerBuilderMaps={},this.useStaticImage=!1,this.isResquestToBuild=!1,this._alreadyCallback=!1}},{key:"build",value:function(e){var t=this;if(this.isBuilded)e&&e(this),t.notifyBuildCompleteListeners();else{if(this.isResquestToBuild)return;this.isResquestToBuild=!0,this.builder?this.builder.build((function(){t.isBuilded=!0,e&&e(t),t.notifyBuildCompleteListeners()})):(t.isBuilded=!0,e&&e(t),t.notifyBuildCompleteListeners())}}},{key:"buildRegisterBuilder",value:function(){for(var e=0;e<this._registerBuilders.length;e++){var t=this._registerBuilders[e];t.isBuilded||t.build()}}},{key:"registerBuildCallbackListener",value:function(e,t){this.buildCompleteCallbacks.push(e),this.buildCompleteCallbackParams.push(t)}},{key:"notifyBuildCompleteListeners",value:function(){for(var e=0;e<this.buildCompleteCallbacks.length;e++){(0,this.buildCompleteCallbacks[e])(this,this.buildCompleteCallbackParams[e])}this._alreadyCallback=!0}},{key:"containBuilder",value:function(e){return!!this._registerBuilderMaps[e]}},{key:"getBuilder",value:function(e){return this._registerBuilderMaps[e]?this._registerBuilderMaps[e]:null}},{key:"registerBuilder",value:function(e,t){this._registerBuilderMaps[e]?console.warn("exist builder "+e):(this._registerBuilderMaps[e]=t,this._registerBuilders.push(t),this.isBuilded=!1)}},{key:"unRegisterBuilder",value:function(e){if(this._registerBuilderMaps[e]){var t=this._registerBuilderMaps[e],n=this._registerBuilders.indexOf(t);this._registerBuilders.splice(n,1),delete this._registerBuilderMaps[e]}}},{key:"clear",value:function(){this.isBuilded&&this.builder&&this.builder.clear();for(var e=0;e<this._registerBuilders.length;e++){this._registerBuilders[e].clear()}this._initParams()}}]),e}(),Zt=function(e){function t(e){at(this,t);var n=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.baseUrl=n.manager.baseModelUrl,n.type="ModelResource",n.isModel=!0,n}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.isSupportHeadAndFootModelWall=!1,this.size=[1,1,1],this.model=null,this.animations=null,this.baseUrl=null,this.texture=null}},{key:"getModelUrl",value:function(){if(this.url)return this.url;var e=this.getDownloadResourceVersion();return this.url?this.url:this.baseUrl+this.id+"/"+e+"/gltf/"}},{key:"getDownloadResourceVersion",value:function(){var e=0;return this.manager.enableUserHighestVersionResource||(e=this.version),e}}]),t}(Qt),Kt=function(e){function t(e){at(this,t);var n=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.baseUrl=n.manager.baseTextureUrl,n.type="TextureResource",n.callback=null,n}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.material=null,this.wallMaterial=null,this.roomMaterial=null,this.texture=null,this.isDefault=!1,this.baseUrl=null,this.ext=null}},{key:"build",value:function(e){this.callback&&(this.callback=null),this.callback=e,this.isDefault&&!this.manager.isGlobalResourcesBuilded?(this.manager.registerGlobalResourcesBuildCallbackListener(this._globalResourcesBuildedCallback,{object:this,callback:e}),this.manager.initGlobalResources()):lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"build",this).call(this,e)}},{key:"_globalResourcesBuildedCallback",value:function(e,t){var n=t.object,i=t.callback;n.build(i)}},{key:"getTextureUrl",value:function(){return this.url?this.url:this.baseUrl+this.id+"."+(null===this.ext?"jpg":this.ext)}},{key:"userDefaultWallLightMap",get:function(){return this.manager.userDefaultWallLightMap}}]),t}(Qt),$t=function(e){function t(e){at(this,t);var n=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.type="LocalCustomTextureResource",n}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.localBaseUrl=null,this.localUrl=null,this.texture=null}},{key:"getTextureUrl",value:function(){if(this.localUrl)return this.localBaseUrl+this.localUrl;console.error("can not find url")}}]),t}(Qt),en=function(e){function t(e){at(this,t);var n=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.type="CustomResource",n}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.customTexture=null,this.color=null,this.renderMode=null,this.modelID=null}},{key:"getModelUrl",value:function(){if(this.url)return this.url;var e=this.getDownloadResourceVersion();return this.baseUrl+this.modelID+"/"+e+"/gltf/"}},{key:"clear",value:function(){this.customTexture&&this.customTexture.clear(),lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(Zt),tn=function(e){function t(e){at(this,t);var n=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.type="CustomModelResource",n}return ut(t,e),st(t,[{key:"_initParams",value:function(){lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.localBaseUrl=null,this.localUrl=null}},{key:"getModelUrl",value:function(){if(this.url)return this.url;var e=null;return this.localUrl&&(e=this.localBaseUrl+this.localUrl),e}}]),t}(en),nn={ModelResource:Zt,TextureResource:Kt,LocalCustomTextureResource:$t,CustomModelResource:tn,CustomResource:en,Max2TjsResource:function(e){function t(e){at(this,t);var n=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.type="Max2TjsResource",n}return ut(t,e),t}(tn),EmptyModelResource:function(e){function t(e){at(this,t);var n=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.type="EmptyModelResource",n}return ut(t,e),t}(Zt),EmptyTextureResource:function(e){function t(e){at(this,t);var n=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.type="EmptyTextureResource",n}return ut(t,e),t}(Kt)},rn={TextureResource:"TextureResource",ModelResource:"ModelResource",CustomModelResource:"CustomModelResource",CustomResource:"CustomResource",LocalCustomTextureResource:"LocalCustomTextureResource",Max2TjsResource:"Max2TjsResource",EmptyTextureResource:"EmptyTextureResource",EmptyModelResource:"EmptyModelResource"},on=function(){function e(t){at(this,e),this._initParams(),this.resource=t.resource,this.manager=t.manager}return st(e,[{key:"_initParams",value:function(){this.resource=null,this.manager=null,this.promise=null}},{key:"build",value:function(e){this.download((function(){e&&e()}))}},{key:"download",value:function(e){}},{key:"clear",value:function(){this._initParams()}},{key:"_dispose",value:function(e){if(e.isMesh){var t=e;if(t){var n=t.material,i=t.geometry;t.isDestory=!0,n&&(this._disposeMaterial(n),t.material=null),i&&(i.isDestory=!0,i.dispose(),t.geometry=null)}}if(e)for(var r=e.children,o=0;o<r.length;o++){var a=r[o];this._dispose(a)}}},{key:"_disposeMaterial",value:function(e){if(e instanceof Array)for(var t=0;t<e.length;t++){var n=e[t];this._disposeMaterial(n)}else e.isDestory=!0,e.dispose()}}]),e}(),an=function(e){function t(e){return at(this,t),ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ut(t,e),st(t,[{key:"getDownloadResourceVersion",value:function(){var e=0;return this.manager.enableUserHighestVersionResource||(e=this.resource.version),e}},{key:"download",value:function(e){if(It.isTesting){var t=new THREE.Object3D,n=new THREE.BoxBufferGeometry(1,1,1),i=new THREE.MeshBasicMaterial({color:16776960}),r=new THREE.Mesh(n,i);return t.add(r),void this._successCallback({node:t},e)}var o=this,a=new thingjs.GLTFLoader,s=this.resource.getModelUrl();a.loadFromURL({url:s,useStaticImage:this.resource.useStaticImage,jsonCallback:function(e){o.resource.indexJson=e},modelCallback:function(t){o._successCallback(t,e)},errorCallback:function(){o._errorCallback(e)}})}},{key:"_successCallback",value:function(e,t){this.resource.animations=e.animations,this.resource.model=e.node,this.ready=!0,t&&t(),this.debug&&console.log(this.id+" download complete")}},{key:"_errorCallback",value:function(e){console.error("download error "+this.resource.getModelUrl()),this.ready=!0,this.resource.model=new THREE.Object3D,this.resource.isEmpty=!0,e&&e()}},{key:"clear",value:function(){this._dispose(this.resource.model),this.resource.model=null,this.resource.animations=null,lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(on),sn=function(e){function t(e){return at(this,t),ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ut(t,e),st(t,[{key:"download",value:function(e){this.initMaterial();if("bundle"===this.resource.ext)return this.ready=!0,void e();this._build(e)}},{key:"_lightMapResourceBuildCallback",value:function(e,t){t.builder._build(t.downloadCallback)}},{key:"initMaterial",value:function(){this.resource.material=new THREE.MeshStandardMaterial({metalness:.5,roughness:.5}),this.resource.wallMaterial=new THREE.MeshStandardMaterial({color:16777215,metalness:.5,roughness:.5});var e=this.resource.wallMaterial;this.resource.isDefault?this.resource.userDefaultWallLightMap&&(e.defines=e.defines||{},e.defines.WALL_AO=!0,e.metalness=.2,e.roughness=.8,e.needsUpdate=!0):(e.metalness=0,e.roughness=1);var t=new THREE.MeshLambertMaterial({color:16777215,reflectivity:.1});this.resource.roomMaterial=t,t.defines=t.defines||{},t.defines.FLOOR_AO=!0}},{key:"_downloadTexture",value:function(e,t,n){if(It.isTesting)t(new THREE.Texture);else{var i=new THREE.TextureLoader;i.enableStaticImage=this.resource.useStaticImage,i.setCrossOrigin("anonymous"),i.load(e,(function(e){t&&t(e)}),(function(e){}),(function(e){n&&n()}))}}},{key:"_build",value:function(e){var t=this;t._downloadTexture(t.resource.getTextureUrl(),(function(n){n.wrapS=THREE.RepeatWrapping,n.wrapT=THREE.RepeatWrapping,t.resource.texture=n,t.resource.material.map=n,t.resource.wallMaterial.map=n,t.resource.roomMaterial.map=n,t.resource.isDefault&&t.resource.manager.wallLightMapResource&&(t.resource.wallMaterial.aoMap=t.resource.manager.wallLightMapResource.texture),t.ready=!0,t.resource.material.roughness=1,t.debug&&console.log(t.id+" download complete"),e&&e()}),(function(){t.ready=!0,console.error("download error "+t.resource.getTextureUrl()),e&&e()}))}},{key:"clear",value:function(){this.resource.material&&this._disposeMaterial(this.resource.material),this.resource.wallMaterial&&this._disposeMaterial(this.resource.wallMaterial),this.resource.roomMaterial&&this._disposeMaterial(this.resource.roomMaterial),this.resource.material=null,this.resource.wallMaterial=null,this.resource.roomMaterial=null,lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(on),ln=function(e){function t(e){at(this,t);var n=ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.callback=null,n}return ut(t,e),st(t,[{key:"download",value:function(e){var n=this;this.callback=e,lt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"download",this).call(this,(function(){n.resource.customTexture?(n.resource.customTexture.registerBuildCallbackListener((function(){n._afterDownload()})),n.resource.customTexture.build()):n._afterDownload()}))}},{key:"_afterDownload",value:function(){this._initCustomInfo(),this.callback&&this.callback(this)}},{key:"_initCustomInfo",value:function(){null!==this.resource.customTexture&&this._changeWithCustomTexture(this.resource.model),null!==this.resource.color&&this._changeWithCustomColor(this.resource.model),null!==this.resource.renderMode&&this._changeRenderMode(this.resource.model),this.resource.ready=!0}},{key:"_changeRenderMode",value:function(e){var t=this;e instanceof THREE.Mesh&&(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){if(null!==t.resource.renderMode)switch(t.resource.renderMode){case 1:e.transparent=!1,e.alphaTest=.5;break;case 3:case 2:e.transparent=!0;break;default:console.error("can not find renderMode "+t.renderMode)}}));for(var n=0;n<e.children.length;n++){var i=e.children[n];this._changeRenderMode(i)}}},{key:"_changeWithCustomColor",value:function(e){var t=this;e instanceof THREE.Mesh&&(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){e.color.r=t.resource.color[0],e.color.g=t.resource.color[1],e.color.b=t.resource.color[2],null!==t.resource.opacity&&(e.opacity=t.resource.opacity,e.transparent=!0)}));for(var n=0;n<e.children.length;n++){var i=e.children[n];this._changeWithCustomColor(i)}}},{key:"_changeWithCustomTexture",value:function(e){var t=this;e instanceof THREE.Mesh&&(t.resource.customTexture&&t.resource.customTexture.texture&&(t.resource.customTexture.texture.flipY=!1),(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){e.map=t.resource.customTexture.texture})));for(var n=0;n<e.children.length;n++){var i=e.children[n];this._changeWithCustomTexture(i)}}}]),t}(an),un=function(e){function t(e){return at(this,t),ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ut(t,e),t}(ln),cn={ModelResource:an,TextureResource:sn,CustomResource:ln,CustomModelResource:un,LocalCustomTextureResource:function(e){function t(e){return at(this,t),ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ut(t,e),t}(sn),Max2TjsResource:function(e){function t(e){return at(this,t),ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ut(t,e),st(t,[{key:"_successCallback",value:function(e,t){this.resource.animations=e.animations,this.resource.model=e.node.children[0],this._applyRotationToChildren(this.resource.model),this.ready=!0,t&&t(),this.debug&&console.log(this.id+" download complete")}},{key:"_applyRotationToChildren",value:function(e){for(var t=0;t<e.children.length;t++){var n=e.children[t],i=n.position.clone();i.applyQuaternion(e.quaternion),n.position.copy(i),n.quaternion.premultiply(e.quaternion)}if(e.children.length>0){e.quaternion.set(0,0,0,1);for(var r=0;r<e.children.length;r++){var o=e.children[r];o.isMesh||this._applyRotationToChildren(o)}}}}]),t}(un),EmptyModelResource:function(e){function t(e){return at(this,t),ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ut(t,e),st(t,[{key:"download",value:function(e){var t=new THREE.Object3D;this._successCallback(t,e),this.resource.isEmpty=!0,this.resource.model=t}}]),t}(an),EmptyTextureResource:function(e){function t(e){return at(this,t),ct(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ut(t,e),st(t,[{key:"_downloadTexture",value:function(e,t,n){var i=new THREE.Texture;t&&t(i)}}]),t}(sn)},hn=new(function(){function e(t){at(this,e),this.enableUserHighestVersionResource=!0,this.useStaticImage=!1,this.userDefaultWallLightMap=!0,this.requestDownloadResources=[],this.resourceDownloadSuccessCallback=[]}return st(e,[{key:"create",value:function(e){var t=e.type,n=cn[t];return e.manager=this,new n(e)}},{key:"addResourceDownloadRequest",value:function(e,t){this.requestDownloadResources.push(e),this.resourceDownloadSuccessCallback.push(t)}}]),e}()),pn=function(){function e(){at(this,e),this.textures=[],this.models=[],this.allResources=[],this.builderManager=hn,this.ClassName=rn,this.baseTextureUrl="https://static.3dmomoda.com/textures/",this.baseModelUrl="https://model.3dmomoda.com/models/",this.ableToSupportFootAndHeadModelWalls=["C9FB3F9A29C842F79F02CECC4037FEA1"],this.wallLightMapResource=null,this.enableUserHighestVersionResource=!0,this.globalResourcesBuildCompleteCallbacks=[],this.globalResourcesBuildCompleteCallbackParams=[],this._isGlobalResourcesBuilded=!1,this._isInitGlobalResources=!1,this.userDefaultWallLightMap=!0}return st(e,[{key:"initGlobalResources",value:function(){this._isInitGlobalResources||(this._isInitGlobalResources=!0,this.wallLightMapResource?this.wallLightMapResource.isBuilded?(this._isGlobalResourcesBuilded=!0,this.notifyGlobalResourcesBuildCompleteListeners()):(this.wallLightMapResource.registerBuildCallbackListener(this._wallLightResoruceBuildCallback,{manager:this}),this.wallLightMapResource.isResquestToBuild||this.wallLightMapResource.build()):this.notifyGlobalResourcesBuildCompleteListeners())}},{key:"_wallLightResoruceBuildCallback",value:function(e,t){var n=t.manager;n._isGlobalResourcesBuilded=!0,n.notifyGlobalResourcesBuildCompleteListeners()}},{key:"registerGlobalResourcesBuildCallbackListener",value:function(e,t){this.globalResourcesBuildCompleteCallbacks.push(e),this.globalResourcesBuildCompleteCallbackParams.push(t)}},{key:"notifyGlobalResourcesBuildCompleteListeners",value:function(){for(var e=0;e<this.globalResourcesBuildCompleteCallbacks.length;e++){(0,this.globalResourcesBuildCompleteCallbacks[e])(this,this.globalResourcesBuildCompleteCallbackParams[e])}}},{key:"create",value:function(e){var t=e.type,n=new(0,nn[t])({manager:this});return n.id=e.id,this.builderManager&&(n.builder=this.builderManager.create({type:t,resource:n})),n}},{key:"disposeModels",value:function(){for(var e=0;e<this.models.length;e++){this.models[e].clear()}}},{key:"disposeTextures",value:function(){for(var e=0;e<this.textures.length;e++){this.textures[e].clear()}}},{key:"clear",value:function(){this.disposeTextures(),this.disposeModels(),this.textures=[],this.models=[]}},{key:"isGlobalResourcesBuilded",get:function(){return this._isGlobalResourcesBuilded}}]),e}(),dn=new pn,fn="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},mn=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},gn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),vn=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},yn=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},bn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},_n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},xn=function(){function e(t){mn(this,e),this._init(),this.subMeshes=[],this.extraData={},this.vertices=[],this.normals=[],this.uvs=[],this.uv2s=[],this.resource=null,this.triangles=[]}return gn(e,[{key:"_init",value:function(){this.vertices=null,this.normals=null,this.uvs=null,this.uv2s=null,this.resource=null,this.triangles=null,this.subMeshes=[],this.extraData={}}},{key:"clone",value:function(){var t=new e;for(var n in t.vertices=this.vertices.slice(),t.normals=this.normals.slice(),t.uvs=this.uvs.slice(),t.uv2s=this.uv2s.slice(),t.resource=this.resource,t.triangles=this.triangles.slice(),this.extraData)t.extraData[n]=this.extraData[n].slice();for(var i=0;i<this.subMeshes.length;i++){var r=this.subMeshes[i].clone();t.subMeshes.push(r)}return t}},{key:"clear",value:function(){for(var e=0;e<this.subMeshes.length;e++){this.subMeshes[e].clear()}this._init()}}]),e}(),En=function(){function e(t){mn(this,e),this._initParams(),this.isBuilded=!1,this.resourceCombineManager=t.resourceCombineManager}return gn(e,[{key:"setObject",value:function(e){this.clear(),this.object=e}},{key:"_initParams",value:function(){this.mesh=new xn,this.object=null,this.isBuilded=!1}},{key:"build",value:function(e){this.setObject(e),this._calculate(),this.object.calculaterMesh=this.mesh}},{key:"_calculate",value:function(){}},{key:"clear",value:function(){this.mesh&&this.mesh.clear(),this._initParams()}}]),e}(),wn={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=new Array(36),i=0;return function(){for(var r=0;r<36;r++)8===r||13===r||18===r||23===r?n[r]="-":14===r?n[r]="4":(i<=2&&(i=33554432+16777216*Math.random()|0),e=15&i,i>>=4,n[r]=t[19===r?3&e|8:e]);return n.join("")}}(),clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*wn.DEG2RAD},radToDeg:function(e){return e*wn.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}},Tn=function(){function e(t,n,i,r){mn(this,e),this._x=t||0,this._y=n||0,this._z=i||0,this._w=void 0!==r?r:1}return gn(e,[{key:"slerp",value:function(e,t,n,i){return n.copy(e).slerp(t,i)}},{key:"slerpFlat",value:function(e,t,n,i,r,o,a){var s=n[i+0],l=n[i+1],u=n[i+2],c=n[i+3],h=r[o+0],p=r[o+1],d=r[o+2],f=r[o+3];if(c!==f||s!==h||l!==p||u!==d){var m=1-a,g=s*h+l*p+u*d+c*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),_=Math.atan2(b,g*v);m=Math.sin(m*_)/b,a=Math.sin(a*_)/b}var x=a*v;if(s=s*m+h*x,l=l*m+p*x,u=u*m+d*x,c=c*m+f*x,m===1-a){var E=1/Math.sqrt(s*s+l*l+u*u+c*c);s*=E,l*=E,u*=E,c*=E}}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=c}},{key:"set",value:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this.onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,i=e._y,r=e._z,o=e.order,a=Math.cos,s=Math.sin,l=a(n/2),u=a(i/2),c=a(r/2),h=s(n/2),p=s(i/2),d=s(r/2);return"XYZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"YXZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"ZXY"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"ZYX"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"YZX"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c-h*p*d):"XZY"===o&&(this._x=h*u*c-l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c+h*p*d),!1!==t&&this.onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this.onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t,n=e.elements,i=n[0],r=n[4],o=n[8],a=n[1],s=n[5],l=n[9],u=n[2],c=n[6],h=n[10],p=i+s+h;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(c-l)*t,this._y=(o-u)*t,this._z=(a-r)*t):i>s&&i>h?(t=2*Math.sqrt(1+i-s-h),this._w=(c-l)/t,this._x=.25*t,this._y=(r+a)/t,this._z=(o+u)/t):s>h?(t=2*Math.sqrt(1+s-i-h),this._w=(o-u)/t,this._x=(r+a)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+h-i-s),this._w=(a-r)/t,this._x=(o+u)/t,this._y=(l+c)/t,this._z=.25*t),this.onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n,i=new Mn;return void 0===i&&(i=new Mn),(n=e.dot(t)+1)<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?i.set(-e.y,e.x,0):i.set(0,-e.z,e.y)):i.crossVectors(e,t),this._x=i.x,this._y=i.y,this._z=i.z,this._w=n,this.normalize()}},{key:"inverse",value:function(){return this.conjugate().normalize()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,i=e._y,r=e._z,o=e._w,a=t._x,s=t._y,l=t._z,u=t._w;return this._x=n*u+o*a+i*l-r*s,this._y=i*u+o*s+r*a-n*l,this._z=r*u+o*l+n*s-i*a,this._w=o*u-n*a-i*s-r*l,this.onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,i=this._y,r=this._z,o=this._w,a=o*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;var s=Math.sqrt(1-a*a);if(Math.abs(s)<.001)return this._w=.5*(o+this._w),this._x=.5*(n+this._x),this._y=.5*(i+this._y),this._z=.5*(r+this._z),this;var l=Math.atan2(s,a),u=Math.sin((1-t)*l)/s,c=Math.sin(t*l)/s;return this._w=o*u+this._w*c,this._x=n*u+this._x*c,this._y=i*u+this._y*c,this._z=r*u+this._z*c,this.onChangeCallback(),this}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"onChange",value:function(e){return this.onChangeCallback=e,this}},{key:"onChangeCallback",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}]),e}(),Mn=function(){function e(t,n,i){mn(this,e),this.x=t||0,this.y=n||0,this.z=i||0,this.isVector3=!0}return gn(e,[{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(){var e=new Tn;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}()}},{key:"applyAxisAngle",value:function(){var e=new Tn;return function(t,n){return this.applyQuaternion(e.setFromAxisAngle(t,n))}()}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*i-a*n,u=s*n+a*t-r*i,c=s*i+r*n-o*t,h=-r*t-o*n-a*i;return this.x=l*s+h*-r+u*-a-c*-o,this.y=u*s+h*-o+c*-r-l*-a,this.z=c*s+h*-a+l*-o-u*-r,this}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(){var t=new e,n=new e;return function(e,i){return t.set(e,e,e),n.set(i,i,i),this.clamp(t,n)}()}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:"cross",value:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,i=this.y,r=this.z;return this.x=i*e.z-r*e.y,this.y=r*e.x-n*e.z,this.z=n*e.y-i*e.x,this}},{key:"crossVectors",value:function(e,t){var n=e.x,i=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-r*a,this.y=r*o-n*s,this.z=n*a-i*o,this}},{key:"projectOnVector",value:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)}},{key:"projectOnPlane",value:function(){var t=new e;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}},{key:"reflect",value:function(){var t=new e;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}()}},{key:"angleTo",value:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(wn.clamp(t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this}},{key:"setFromCylindrical",value:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}]),e}(),Sn=function(){function e(){mn(this,e)}return gn(e,null,[{key:"uuid",value:function(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var n=e.join("");return n}},{key:"approximatelyNumberEqual",value:function(e,t,n){var i=1e-4;return void 0!==n&&(i=n),Math.abs(e-t)<i}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),n={};e.traverse((function(e){e.isSkinnedMesh&&(n[e.name]=e)}));var i={},r={};t.traverse((function(e){e.isBone&&(i[e.name]=e),e.isSkinnedMesh&&(r[e.name]=e)}));var o=!1;for(var a in n){o=!0;for(var s=n[a].skeleton,l=r[a],u=[],c=0;c<s.bones.length;++c){var h=i[s.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,s.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":fn(t)))return t;if(t instanceof Date)return(n=new Date).setTime(t.getTime()),n;if(t instanceof Array|t instanceof Object){var n=t instanceof Array?[]:{};for(var i in t)t.hasOwnProperty(i)&&(n[i]=e.cloneJSObject(t[i]));return n}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}},{key:"convertToVector3",value:function(e){return e.isVector3?e:new Mn(e[0],e[1],e[2])}},{key:"convertToQuaternion",value:function(e){return new Tn(e[0],e[1],e[2],e[3])}},{key:"applyQuaternionToVector3",value:function(e,t){if(0!==e[0]||0!==e[1]||0!==e[2]||1!==e[3]){var n=t[0],i=t[1],r=t[2],o=e[0],a=e[1],s=e[2],l=e[3],u=l*n+a*r-s*i,c=l*i+s*n-o*r,h=l*r+o*i-a*n,p=-o*n-a*i-s*r;t[0]=u*l+p*-o+c*-s-h*-a,t[1]=c*l+p*-a+h*-o-u*-s,t[2]=h*l+p*-s+u*-a-c*-o}}}]),e}();Sn.wallTopFaceIndexes=[0,2,1,0,3,2],Sn.wallStartFaceIndexes=[1,4,0,1,5,4],Sn.wallEndFaceIndexes=[3,7,2,2,7,6],Sn.wallStartCornerFaceIndexes=[1,8,0],Sn.wallEndCornerFaceIndexes=[3,9,2],Sn.wallBottomFaceIndexes=[4,5,6,4,6,7];var Cn,An,Rn=function(){function e(){mn(this,e),this._initParams(),this.id=Sn.uuid(),this.type="BaseObject",this.calculaterData={}}return gn(e,[{key:"_initParams",value:function(){this.id=null,this.name=null,this.userID=null,this.resource=null,this.position=null,this.rotation=null,this.scale=null,this._parent=null,this.resource=null,this._resources=null}},{key:"calculate",value:function(){this.calculater&&this.calculater.build(this)}},{key:"createMesh",value:function(){if(this.meshBuilder)return this.meshBuilder.build(this)}},{key:"clear",value:function(){this.calculater&&this.calculater.clear(),this._initParams()}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.resource&&this._resources.push(this.resource)),this._resources}}]),e}(),Pn=function(e){function t(e,n,i){mn(this,t);var r=bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.walls=[],r.type="WallCorner",r}return yn(t,e),gn(t,[{key:"_initParams",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.walls=null}},{key:"addWall",value:function(e){for(var t=0,n=this.walls.length;t<n;t++)if(this.walls[t]===e)return void console.error("repeat wall"+e);this.walls.push(e)}}]),t}(Rn);function Dn(e,t){this.x=e||0,this.y=t||0}Object.defineProperties(Dn.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Dn.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:(Cn=new Dn,An=new Dn,function(e,t){return Cn.set(e,e),An.set(t,t),this.clamp(Cn,An)}),clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},distanceToManhattan:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}});var kn=function(e){function t(e){mn(this,t);var n=bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.walls=[],n}return yn(t,e),gn(t,[{key:"_initParams",value:function(){this.walls=[],this.position=null}},{key:"_calculate",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this),this.walls=this.object.walls,this.position=Sn.convertToVector3(this.object.position);var e=this.getSameHeightWalls(this.object);for(var n in e)this.calWallsVertices(e[n])}},{key:"isFirstWallShouldNotCal",value:function(e){return!("StraightManualWall"===e.type)||"SubStraightManualWall"===e}},{key:"isSecondWallShouldNotCal",value:function(e){return null!=e&&(e.resource&&e.resource.isModel||"SubStraightManualWall"===e.type)}},{key:"checkWallsSameHeight",value:function(e){for(var t=null,n=0;n<e.walls.length;n++){var i=e.walls[n];if("StraightManualWall"===i.type)if(null===t)t=i.height;else if(t!==i.height)return!1}return!0}},{key:"containModelWall",value:function(e){for(var t=0;t<e.walls.length;t++){if("ModelWall"===e.walls[t].type)return!0}return!1}},{key:"getSameHeightWalls",value:function(e){for(var t={},n=0;n<e.walls.length;n++){var i=e.walls[n];this.isStraightManualWall(i)&&(void 0===t[i.height]&&(t[i.height]=[]),t[i.height].push(i))}return t}},{key:"isStraightManualWall",value:function(e){return"StraightManualWall"===e.type}},{key:"calWallsVertices",value:function(e){var t=new Mn(0,-1,0);if(1===e.length){var n=e[0];this.isStraightManualWall(n)&&this.setDefaultCornerVertices(n)}else{this.sortWalls(e);for(var i=0;i<e.length;i++){var r=e[i];if(!this.isFirstWallShouldNotCal(r)){for(var o=null,a=i;null==o&&(a===e.length-1?a=0:a+=1,e[a]!==r);)o=e[a],this.isSecondWallShouldNotCal(o)&&(o=null);if(o){var s=Sn.convertToVector3(r.getWallOtherCorner(this.object).position),l=new Mn;l.subVectors(s,this.position),s=Sn.convertToVector3(o.getWallOtherCorner(this.object).position);var u=new Mn;if(u.subVectors(s,this.position),l.normalize(),u.normalize(),0!==l.length()&&0!==u.length()){var c=r.thick/2,h=new Mn;h.crossVectors(t,l),h.normalize();var p=h.clone();p.multiplyScalar(c),p.add(this.position),c=o.thick/2;var d=u.clone();d.cross(t),d.normalize();var f=d.clone();if(f.multiplyScalar(c),f.add(this.position),this.setCornersVertices(r,p,!0),this.setCornersVertices(o,f,!1),l.normalize(),u.normalize(),this.calAngle(l,u)>30){var m;if(Sn.approximatelyNumberEqual(Math.abs(l.dot(u)),1)){var g=l.clone();g.cross(t),g.normalize(),this.setDefaultCornerVertices(r,!0),this.setDefaultCornerVertices(o,!0);continue}if(0!==(m=this.getIntersectPosition(p,l,f,u)).x||0!==m.y||0!==m.z)m.clone().y=this.position.y+this.getWallHeight(this.object),this.setCornersVertices(r,m,!0),this.setCornersVertices(o,m,!1)}else this.setCornersVertices(r,p,!0),this.setCornersVertices(o,f,!1)}else this.setDefaultCornerVertices(r,!0),this.setDefaultCornerVertices(o,!1)}else this.setDefaultCornerVertices(r)}}}}},{key:"sortWalls",value:function(e){if(e.length>1)for(var t,n,i=e[0],r=0,o=e.length-1;r<o;){for(n=r;n<o;++n)this.angleBetween(i,e[n])>this.angleBetween(i,e[n+1])&&(t=e[n],e[n]=e[n+1],e[n+1]=t);for(n=--o;n>r;--n)this.angleBetween(i,e[n])<this.angleBetween(i,e[n-1])&&(t=e[n],e[n]=e[n-1],e[n-1]=t);++r}}},{key:"angleBetween",value:function(e,t){var n=Sn.convertToVector3(e.getWallOtherCorner(this.object).position).clone();n.sub(this.position);var i=Sn.convertToVector3(t.getWallOtherCorner(this.object).position).clone();return i.sub(this.position),this.calAngle(n,i)}},{key:"calAngle",value:function(e,t){e.normalize(),t.normalize();var n=e.angleTo(t);n*=180/Math.PI;var i=e.clone();return i.cross(t),i.y>0&&(n=360-n),n}},{key:"getWallHeight",value:function(e){for(var t=99999,n=0;n<e.walls.length;n++){var i=e.walls[n];t>i.height&&(t=i.height)}return t}},{key:"setCornersVertices",value:function(e,t,n){var i=new Mn(0,0,0),r=Sn.convertToVector3(e.position);i.x=t.x-r.x,i.y=t.y-r.y,i.z=t.z-r.z,this.object.calculaterData[e.id]||(this.object.calculaterData[e.id]=[new Mn,new Mn]);var o=this.object.calculaterData[e.id];n?(o[0].x=i.x,o[0].y=i.y,o[0].z=i.z):(o[1].x=i.x,o[1].y=i.y,o[1].z=i.z)}},{key:"setDefaultCornerVertices",value:function(e,t){var n=new Mn(0,-1,0),i=Sn.convertToVector3(e.getWallOtherCorner(this.object).position).clone();i.sub(this.position),i.normalize();var r=e.thick/2,o=n.clone();o.cross(i),o.normalize(),o.multiplyScalar(r);var a=new Mn;a.addVectors(this.position,o);var s=new Mn;s.subVectors(this.position,o),void 0===t?(this.setCornersVertices(e,a,!0),this.setCornersVertices(e,s,!1)):t?this.setCornersVertices(e,a,!0):this.setCornersVertices(e,s,!1)}},{key:"getIntersectPosition",value:function(e,t,n,i){if(e.x===n.x&&e.y===n.y&&e.z===n.z)return e;var r=e.y;if(1===t.dot(i))throw"two line in same direction ,can not cal intersected position!";var o=new Mn,a=new Mn;o.addVectors(e,t),a.addVectors(n,i);var s=new Dn(e.x,e.z),l=new Dn(o.x,o.z),u=new Dn(n.x,n.z),c=new Dn(a.x,a.z),h=(l.y-s.y)*(c.x-u.x)-(s.x-l.x)*(u.y-c.y);if(0==h)return new Mn;var p=((l.x-s.x)*(c.x-u.x)*(u.y-s.y)+(l.y-s.y)*(c.x-u.x)*s.x-(c.y-u.y)*(l.x-s.x)*u.x)/h,d=-((l.y-s.y)*(c.y-u.y)*(u.x-s.x)+(l.x-s.x)*(c.y-u.y)*s.y-(c.x-u.x)*(l.y-s.y)*u.y)/h;return new Mn(p,r,d)}}]),t}(En),jn=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),gn(t,[{key:"_initParams",value:function(){this.walls=[],this.position=null}},{key:"_calculate",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this),this.walls=this.object.walls,this.position=Sn.convertToVector3(this.object.position);var e=this.getSameHeightWalls(this.object);for(var n in e)this.calWallsVertices(e[n])}},{key:"isFirstWallShouldNotCal",value:function(e){return!this.isStraightManualWall(e)}},{key:"isSecondWallShouldNotCal",value:function(e){return!this.isStraightManualWall(e)}},{key:"checkWallsSameHeight",value:function(e){for(var t=null,n=0;n<e.walls.length;n++){var i=e.walls[n];if(null===t)t=i.height;else if(t!==i.height)return!1}return!0}},{key:"containModelWall",value:function(e){for(var t=0;t<e.walls.length;t++){if("ModelWall"===e.walls[t].type)return!0}return!1}},{key:"getSameHeightWalls",value:function(e){for(var t={},n=0;n<e.walls.length;n++){var i=e.walls[n];this.isStraightManualWall(i)&&(void 0===t[i.height]&&(t[i.height]=[]),t[i.height].push(i))}return t}},{key:"isStraightManualWall",value:function(e){return"SubStraightManualWall"===e.type||"SubDoorOrWindowStraightManualWall"===e.type}}]),t}(kn),On=function(e){function t(){mn(this,t);var e=bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="SubWallCorner",e.calculater=new jn({object:e}),e}return yn(t,e),gn(t,[{key:"_initParams",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.calculater=null}},{key:"build",value:function(){this.calculate()}},{key:"isFirstWallShouldNotCal",value:function(e){return!("SubStraightManualWall"===e)}},{key:"isSecondWallShouldNotCal",value:function(e){return e&&!("SubStraightManualWall"===e.type)}}],[{key:"createSubWallCorner",value:function(e,n,i){var r=new t;return r.id=e,r.position=n,r.parent=i.parent,r}}]),t}(Pn),Fn={SubStraightManualWall:"SubStraightManualWall",SubDoorOrWindowStraightManualWall:"SubDoorOrWindowStraightManualWall",SubWallCorner:"SubWallCorner",SubModelWall:"SubModelWall"},Bn=function(e){function t(){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return yn(t,e),gn(t,[{key:"_initParams",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._startCorner=null,this._endCorner=null,this.thick=-1,this.height=-1,this._length=null,this.pathPoints=[],this._direction=null,this.doorOrWindows=[],this.subWalls=[],this.subCorners=[],this.suspend=0,this.mesh=null,this.isShow=!0,this.isContainer=!1,this._position=null}},{key:"getWallOtherCorner",value:function(e){return this.startCorner===e?this.endCorner:this.endCorner===e?this.startCorner:null}},{key:"sortDoorOrWins",value:function(){var e=this.startCorner.position,t=this.endCorner.position,n=t.x-e.x>0?1:-1,i=t.z-e.z>0?1:-1,r=!0;Math.abs(t.x-e.x)<.001&&(r=!1);for(var o=[],a=0;a<this.doorOrWindows.length;a++){for(var s=this.doorOrWindows[a],l=0;l<o.length;l++){var u=o[l];if((r?(u.position.x-s.position.x)*n:(u.position.z-s.position.z)*i)>=0){o.splice(l,0,s);break}if(l==o.length-1){o.push(s);break}}0===o.length&&o.push(s)}return o}},{key:"getWallCornerByPos",value:function(e){for(var t=null,n=-1,i=this.subCorners,r=0;r<i.length;r++){var o=e.distanceTo(i[r].position);o<.01&&(null===t?(t=i[r],n=o):o<n&&(n=o,t=i[r]))}return t}},{key:"getDoorOrWinStartAndEndPos",value:function(e){var t=e.size,n=this.direction,i=e.position.clone();i.y=0;var r=i.clone(),o=i.clone(),a=t.x/2;return r.subVectors(r,n.clone().multiplyScalar(a)),o.addVectors(o,n.clone().multiplyScalar(a)),[r,o]}},{key:"addSubWallCorner",value:function(e){for(var t=0;t<this.subCorners.length;t++){if(this.subCorners[t]===e)return}this.subCorners.push(e)}},{key:"addToParentCollector",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addToParentCollector",this).call(this),this.parent.walls.push(this)}},{key:"clear",value:function(){for(var e=0;e<this.subWalls.length;e++){this.subWalls[e].clear()}for(var n=0;n<this.subCorners.length;n++){this.subCorners[n].clear()}vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}},{key:"startCorner",get:function(){return this._startCorner},set:function(e){this._startCorner=e,this._startCorner&&this._startCorner.addWall(this)}},{key:"endCorner",get:function(){return this._endCorner},set:function(e){this._endCorner=e,this._endCorner&&this._endCorner.addWall(this)}},{key:"length",get:function(){if(null===this._length){var e=new Mn;e.subVectors(Sn.convertToVector3(this.endCorner.position),Sn.convertToVector3(this.startCorner.position)),this._length=e.length()}return this._length}},{key:"direction",get:function(){return null===this._direction&&(this._direction=new Mn,this._direction.subVectors(Sn.convertToVector3(this.endCorner.position),Sn.convertToVector3(this.startCorner.position)),this._direction.normalize()),this._direction}},{key:"size",get:function(){if(null===this._size){var e=new Mn,t=this.startCorner.position,n=this.endCorner.position;e.x=Math.abs(t.x-n.x),e.z=Math.abs(t.z-n.z),e.y=this.height,0===e.x&&(e.x=this.thick),0===e.z&&(e.z=this.thick),this._size=e}return this._size}},{key:"position",get:function(){if(!this._position){this.startCorner.position,this.endCorner.position;this._position=new Mn,this._position.subVectors(Sn.convertToVector3(this.endCorner.position),Sn.convertToVector3(this.startCorner.position)),this._position=this._position.divideScalar(2)}return this._position},set:function(e){this._position=e}}]),t}(Rn),Ln=function(e){function t(){mn(this,t);var e=bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="SubStraightManualWall",e}return yn(t,e),gn(t,[{key:"_initParams",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.parentWall=null}},{key:"build",value:function(){this.calculate()}},{key:"parent",get:function(){return this.parentWall.parent}},{key:"position",get:function(){var e=Sn.convertToVector3(this.startCorner.position),t=Sn.convertToVector3(this.endCorner.position),n=new Mn;return n.addVectors(e,t),n.divideScalar(2),n},set:function(e){}}]),t}(Bn),In=function(e){function t(){mn(this,t);var e=bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.resource=null,e.objPositions=[],e.objLocalPositions=[],e.objRotations=[],e.objScales=[],e.heightRatio=1,e.modelNumber=-1,e.type="SubModelWall",e}return yn(t,e),gn(t,[{key:"_initParams",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.resource=null,this.objPositions=null,this.objLocalPositions=null,this.objRotations=null,this.objScales=null,this.heightRatio=null,this.modelNumber=null}},{key:"build",value:function(){this.calculate()}}]),t}(Bn),Nn=function(e){function t(){mn(this,t);var e=bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type="SubDoorOrWindowStraightManualWall",e}return yn(t,e),t}(Ln),Hn={SubStraightManualWall:Ln,SubModelWall:In,SubDoorOrWindowStraightManualWall:Nn,SubWallCorner:jn},zn=function(){function e(){mn(this,e),this.objects=[],this.calculaterManager=null,this.meshBuilderManager=null,this.ClassName=Fn}return gn(e,[{key:"create",value:function(e){var t=e.type,n=(e.parent,new(0,Hn[t]));return this.calculaterManager&&(n.calculater=this.calculaterManager.create({type:t,object:n})),n}}]),e}(),Un=new zn,Vn=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),gn(t,[{key:"setObject",value:function(e){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setObject",this).call(this,e),this.object=e,this.startCorner=this.object.startCorner,this.endCorner=this.object.endCorner,this.startCornerPosition=Sn.convertToVector3(this.startCorner.position),this.endCornerPosition=Sn.convertToVector3(this.endCorner.position),this.position=Sn.convertToVector3(this.object.position),this.direction=Sn.convertToVector3(this.object.direction),this.suspend=this.object.suspend,this.doorOrWindows=this.object.doorOrWindows,this.object.calculaterData.subWalls=[],this.object.calculaterData.subCorners=[],this.subWalls=this.object.calculaterData.subWalls,this.subCorners=this.object.calculaterData.subCorners}},{key:"_initParams",value:function(){this.startCorner=null,this.endCorner=null,this.startCornerPosition=null,this.endCornerPosition=null,this.position=null,this.direction=null,this.suspend=null,this.doorOrWindows=null,this.subWalls=[],this.subCorners=[]}},{key:"sortDoorOrWins",value:function(){var e=this.startCornerPosition,t=this.endCornerPosition,n=t.x-e.x>0?1:-1,i=t.z-e.z>0?1:-1,r=!0;Math.abs(t.x-e.x)<.001&&(r=!1);for(var o=[],a=0;a<this.doorOrWindows.length;a++){for(var s=this.doorOrWindows[a],l=0;l<o.length;l++){var u=o[l];if((r?(u.position[0]-s.position[0])*n:(u.position[2]-s.position[2])*i)>=0){o.splice(l,0,s);break}if(l===o.length-1){o.push(s);break}}0===o.length&&o.push(s)}return o}},{key:"getDoorOrWinStartAndEndPos",value:function(e){var t=Sn.convertToVector3(e.size),n=this.direction,i=Sn.convertToVector3(e.position);i.y=0;var r=i.clone(),o=i.clone(),a=t.x/2;return r.subVectors(r,n.clone().multiplyScalar(a)),o.addVectors(o,n.clone().multiplyScalar(a)),[r,o]}},{key:"addSubWallCorner",value:function(e){for(var t=0;t<this.subCorners.length;t++){if(this.subCorners[t]===e)return}this.subCorners.push(e)}},{key:"getWallCornerByPos",value:function(e){for(var t=null,n=-1,i=this.subCorners,r=0;r<i.length;r++){var o=e.distanceTo(i[r].position);o<.01&&(null===t?(t=i[r],n=o):o<n&&(n=o,t=i[r]))}return t}}]),t}(En),qn=function(e){function t(e){mn(this,t);var n=bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.upDirection=new Mn(0,1,0),n.downDirection=new Mn(0,-1,0),n.vectorUp=new Mn(0,1,0),n}return yn(t,e),gn(t,[{key:"setObject",value:function(e){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setObject",this).call(this,e);var n=e.calculaterData;n.pathPoints=[],n.selfPathPoints=[],n.repeatUV=[],n.startUVPercent=[0,0,0,0],n.endUVPercent=[1,1,1,1],n.basePoints=[],this.pathPoints=n.pathPoints,this.selfPathPoints=n.selfPathPoints,this.cornersVertices=[this.object.startCorner.calculaterData[this.object.id][0],this.object.startCorner.calculaterData[this.object.id][1],this.object.endCorner.calculaterData[this.object.id][0],this.object.endCorner.calculaterData[this.object.id][1]],n.cornersVertices=this.cornersVertices,this.basePoints=n.basePoints;for(var i=0;i<12;i++)this.basePoints.push(new Mn);this.repeatUV=n.repeatUV,this.startUVPercent=n.startUVPercent,this.endUVPercent=n.endUVPercent}},{key:"_initParams",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.pathPoints=null,this.cornersVertices=null,this.selfPathPoints=null,this.rightSideLength=null,this.leftSideLength=null,this.repeatUV=null,this.basePoints=null,this.startUVPercent=null,this.endUVPercent=null,this.leftMesh=null,this.rightMesh=null,this.edgeMesh=null,this.mesh=null,this.rightSideLength=null,this.leftSideLength=null,this.pathPoints=[],this.selfPathPoints=[],this.leftMesh=new xn,this.rightMesh=new xn,this.edgeMesh=new xn,this.mesh=new xn,this.repeatUV=[],this.startUVPercent=[0,0,0,0],this.endUVPercent=[1,1,1,1]}},{key:"_calculate",value:function(){if(this.object.doorOrWindows.length>0){this.baseBuild(),this.calPosInfo(),this.calEachSideLen(),this.calRepeatUV(),this.initSimpleCornersAndWalls();for(var e=0;e<this.subCorners.length;e++){this.subCorners[e].build()}for(var t=0;t<this.subWalls.length;t++){var n=this.subWalls[t];n.calculate(),this.mesh.subMeshes.push(n.calculater.mesh)}}else this.initMeshInfo();this.object.calculaterMesh=this.mesh}},{key:"initMeshInfo",value:function(){this.baseBuild(),this.calPosInfo(),this.calEachSideLen(),this.calRepeatUV(),this.calBasePoints(),this.fillMesh()}},{key:"baseBuild",value:function(){this.pathPoints.push(this.startCornerPosition),this.pathPoints.push(this.endCornerPosition)}},{key:"calEachSideLen",value:function(){var e=new Mn;e.subVectors(this.endCornerPosition,this.startCornerPosition),e.normalize();var t=this.object.thick/2,n=new Mn;n.crossVectors(this.downDirection,e),n.normalize();var i=n.clone();i.negate();var r=n.clone();r.multiplyScalar(t);var o=i.clone();o.multiplyScalar(t);var a=new Mn,s=new Mn,l=new Mn,u=new Mn;Sn.equalVectorZero(this.cornersVertices[0])?a.addVectors(this.selfPathPoints[0],r):a.copy(this.cornersVertices[0]),Sn.equalVectorZero(this.cornersVertices[3])?s.addVectors(this.selfPathPoints[1],r):s.copy(this.cornersVertices[3]),Sn.equalVectorZero(this.cornersVertices[1])?l.addVectors(this.selfPathPoints[0],o):l.copy(this.cornersVertices[1]),Sn.equalVectorZero(this.cornersVertices[2])?u.addVectors(this.selfPathPoints[1],o):u.copy(this.cornersVertices[2]),this.rightSideLength=new Mn,this.leftSideLength=new Mn,this.rightSideLength.subVectors(a,s),this.leftSideLength.subVectors(l,u),this.rightSideLength=this.rightSideLength.length(),this.leftSideLength=this.leftSideLength.length(),this.object.calculaterData.rightSideLength=this.rightSideLength,this.object.calculaterData.leftSideLength=this.leftSideLength}},{key:"calRepeatUV",value:function(){var e=this.object.uvMultiple,t=this.object.height,n=this.object.parent.height;this.repeatUV[0]=e[0]*this.rightSideLength/n,this.repeatUV[1]=e[1]*t/n,this.repeatUV[2]=e[0]*this.leftSideLength/n,this.repeatUV[3]=e[1]*t/n,this.object.calculaterData.repeatUV=this.repeatUV}},{key:"calPosInfo",value:function(){var e=new Mn;this.selfPathPoints.push(e.subVectors(this.startCornerPosition,this.position)),e=new Mn,this.selfPathPoints.push(e.subVectors(this.endCornerPosition,this.position)),this.selfPathPoints[0].y=0,this.selfPathPoints[1].y=0}},{key:"calBasePoints",value:function(){var e=this.object.thick,t=this.object.height,n=this.direction;if(null===this.basePoints){this.basePoints=[];for(var i=0;i<12;i++)this.basePoints.push(new Mn)}var r=e/2,o=new Mn;o.crossVectors(this.downDirection,n),o.normalize();var a=o.clone();a.negate();var s=o.multiplyScalar(r);Sn.equalVectorZero(this.cornersVertices[0])?(this.basePoints[4].x=this.selfPathPoints[0].x+s.x,this.basePoints[4].y=0,this.basePoints[4].z=this.selfPathPoints[0].z+s.z):(this.basePoints[4].x=this.cornersVertices[0].x,this.basePoints[4].y=0,this.basePoints[4].z=this.cornersVertices[0].z),Sn.equalVectorZero(this.cornersVertices[1])?(s=a.multiplyScalar(r),this.basePoints[5].x=this.selfPathPoints[0].x+s.x,this.basePoints[5].y=0,this.basePoints[5].z=this.selfPathPoints[0].z+s.z):(this.basePoints[5].x=this.cornersVertices[1].x,this.basePoints[5].y=0,this.basePoints[5].z=this.cornersVertices[1].z);var l=n.clone();o.crossVectors(this.downDirection,l.negate()),o.normalize(),(a=o.clone()).negate(),Sn.equalVectorZero(this.cornersVertices[2])?((s=o.clone()).multiplyScalar(r),this.basePoints[6].x=this.selfPathPoints[1].x+s.x,this.basePoints[6].y=0,this.basePoints[6].z=this.selfPathPoints[1].z+s.z):(this.basePoints[6].x=this.cornersVertices[2].x,this.basePoints[6].y=0,this.basePoints[6].z=this.cornersVertices[2].z),Sn.equalVectorZero(this.cornersVertices[3])?((s=a.clone()).multiplyScalar(r),this.basePoints[7].x=this.selfPathPoints[1].x+s.x,this.basePoints[7].y=0,this.basePoints[7].z=this.selfPathPoints[1].z+s.z):(this.basePoints[7].x=this.cornersVertices[3].x,this.basePoints[7].y=0,this.basePoints[7].z=this.cornersVertices[3].z),this.basePoints[0].x=this.basePoints[4].x,this.basePoints[0].y=this.basePoints[4].y+t,this.basePoints[0].z=this.basePoints[4].z,this.basePoints[1].x=this.basePoints[5].x,this.basePoints[1].y=this.basePoints[5].y+t,this.basePoints[1].z=this.basePoints[5].z,this.basePoints[2].x=this.basePoints[6].x,this.basePoints[2].y=this.basePoints[6].y+t,this.basePoints[2].z=this.basePoints[6].z,this.basePoints[3].x=this.basePoints[7].x,this.basePoints[3].y=this.basePoints[7].y+t,this.basePoints[3].z=this.basePoints[7].z,this.basePoints[8].x=this.selfPathPoints[0].x,this.basePoints[8].y=this.selfPathPoints[0].y+t,this.basePoints[8].z=this.selfPathPoints[0].z,this.basePoints[9].x=this.selfPathPoints[1].x,this.basePoints[9].y=this.selfPathPoints[1].y+t,this.basePoints[9].z=this.selfPathPoints[1].z}},{key:"initSimpleCornersAndWalls",value:function(){this.position;var e=this.direction,t=this.object.id;(new Mn).crossVectors(e,this.vectorUp);for(var n=this.sortDoorOrWins(),i=0;i<n.length;i++){var r=n[i],o=this.getDoorOrWinStartAndEndPos(r),a=(this.getDoorOrWinRectPoints(r),On.createSubWallCorner(t+"_"+i+"_1",o[0],this.object)),s=On.createSubWallCorner(t+"_"+i+"_2",o[1],this.object);if(this.addSubWallCorner(a),this.addSubWallCorner(s),0===i){var l=this.createSubStraightManualWall(this.object.startCorner,a,i,n,"start");this.object.startCorner.calculaterData[l.id]=[];for(var u=this.object.startCorner.calculaterData[this.object.id],c=0;c<u.length;c++){var h=u[c].clone();h.add(Sn.convertToVector3(this.object.position)),h.sub(l.position),this.object.startCorner.calculaterData[l.id].push(h)}}else{var p=n[i-1],d=this.getDoorOrWinStartAndEndPos(p),f=this.getWallCornerByPos(d[1]);this.createSubStraightManualWall(f,a,i,n)}if(i===n.length-1){var m=this.createSubStraightManualWall(s,this.object.endCorner,i,n,"end");this.object.endCorner.calculaterData[m.id]=[];for(var g=this.object.endCorner.calculaterData[this.object.id],v=0;v<g.length;v++){var y=g[v].clone();y.add(Sn.convertToVector3(this.object.position)),y.sub(m.position),this.object.endCorner.calculaterData[m.id].push(y)}}this.buildHeadAndFootWall(r,a,s)}}},{key:"setSubWallCornerVerrices",value:function(){}},{key:"buildHeadAndFootWall",value:function(e,t,n){this.getDoorOrWinRectPoints(e);var i=e.suspendPercent;(new Mn).crossVectors(this.direction,this.vectorUp);var r=Sn.convertToVector3(e.size).y+this.object.height*i;if(0!==e.suspendPercent){var o=this.createSubDoorOrWindowStraightManualWall(t,n,e,"down"),a=new Mn;a.subVectors(n.position,t.position);a.length();o.height=this.object.height*i}if(r<this.object.height){var s=this.createSubDoorOrWindowStraightManualWall(t,n,e,"up");s.suspend=r,s.height=this.object.height-r,s.thick=this.object.thick}}},{key:"createSubStraightManualWall",value:function(e,t,n,i,r){var o=this.object,a=Un.create({type:Fn.SubStraightManualWall});return a.id=Sn.uuid(),a.startCorner=e,a.endCorner=t,a.leftResource=o.leftResource,a.rightResource=o.rightResource,a.edgeResource=o.edgeResource,a.height=o.height,a.thick=o.thick,a.parentWall=o,a.calculaterData.repeatUV=this.object.calculaterData.repeatUV,a.calculaterData.index=n,a.calculaterData.doorOrWindows=i,a.calculaterData.buildType=r,this.subWalls.push(a),a}},{key:"createSubDoorOrWindowStraightManualWall",value:function(e,t,n,i){var r=this.object,o=Un.create({type:Fn.SubDoorOrWindowStraightManualWall});return o.id=Sn.uuid(),o.startCorner=e,o.endCorner=t,o.leftResource=r.leftResource,o.rightResource=r.rightResource,o.edgeResource=r.edgeResource,o.height=r.height,o.thick=r.thick,o.parentWall=r,o.calculaterData.repeatUV=this.object.calculaterData.repeatUV,o.calculaterData.doorOrWindow=n,o.calculaterData.buildType=i,this.subWalls.push(o),o}},{key:"setCornerVertices",value:function(e,t){e.calculaterData.cornersVertices||(e.calculaterData.cornersVertices=[new Mn,new Mn,new Mn,new Mn]);var n,i,r=e.calculaterData.cornersVertices;t?((n=new Mn).addVectors(this.object.calculater.cornersVertices[0],this.position),n.sub(e.position),(i=new Mn).addVectors(this.object.calculater.cornersVertices[1],this.position),i.sub(e.position),r[0]=n,r[1]=i):((n=new Mn).addVectors(this.object.calculater.cornersVertices[2],this.position),n.sub(e.position),(i=new Mn).addVectors(this.object.calculater.cornersVertices[3],this.position),i.sub(e.position),r[2]=n,r[3]=i);e.calculater.cornersVertices=r}},{key:"getDoorOrWinRectPoints",value:function(e){var t=this.object.thick/2,n=new Mn;n.crossVectors(this.vectorUp,this.direction),n.normalize();var i=n.clone();i.negate(),this.vectorUp.clone().multiplyScalar(t);var r=Sn.convertToVector3(e.size),o=this.direction,a=Sn.convertToVector3(e.position),s=r.x/2,l=new Mn,u=new Mn;return l.subVectors(a,o.clone().multiplyScalar(s)),u.addVectors(a,o.clone().multiplyScalar(s)),[l.clone().addVectors(l,n.clone().multiplyScalar(t)),l.clone().addVectors(l,i.clone().multiplyScalar(t)),u.clone().addVectors(u,i.clone().multiplyScalar(t)),u.clone().addVectors(u,n.clone().multiplyScalar(t))]}},{key:"fillMesh",value:function(){this.leftMesh=new xn,this.rightMesh=new xn,this.edgeMesh=new xn,this.mesh=new xn,this.fillEdgeSideMeshInfo(),this.fillLeftMeshInfo(),this.fillRightMeshInfo(),this.mesh.subMeshes=[this.rightMesh,this.leftMesh,this.edgeMesh]}},{key:"fillRightMeshInfo",value:function(){this.rightMesh.resource=this.object.rightResource,this.rightMesh.vertices=new Float32Array(12),this.rightMesh.normals=new Float32Array(12),this.rightMesh.triangles=new Uint16Array(6),this.rightMesh.triangles[0]=0,this.rightMesh.triangles[1]=2,this.rightMesh.triangles[2]=3,this.rightMesh.triangles[3]=0,this.rightMesh.triangles[4]=1,this.rightMesh.triangles[5]=2,this.rightMesh.uvs=[],this.rightMesh.uv2s=[];var e,t,n,i,r=this.basePoints,o=[r[0],r[4],r[7],r[3]],a=new Mn;a.crossVectors(this.downDirection,this.direction),a.normalize(),this.object.rightResource.isDefault?(e=this.startUVPercent[0],t=this.startUVPercent[1],n=this.endUVPercent[0],i=this.endUVPercent[1]):(e=this.startUVPercent[0]*this.repeatUV[0],t=this.startUVPercent[1]*this.repeatUV[1],n=this.endUVPercent[0]*this.repeatUV[0],i=this.endUVPercent[1]*this.repeatUV[1]),this.rightMesh.uvs=new Float32Array(8),this.rightMesh.uvs[0]=e,this.rightMesh.uvs[1]=i,this.rightMesh.uvs[2]=e,this.rightMesh.uvs[3]=t,this.rightMesh.uvs[4]=n,this.rightMesh.uvs[5]=t,this.rightMesh.uvs[6]=n,this.rightMesh.uvs[7]=i,this.object.rightResource.isDefault&&(e=this.startUVPercent[0],t=this.startUVPercent[1],n=this.endUVPercent[0],i=this.endUVPercent[1],this.rightMesh.uv2s=new Float32Array(8),this.rightMesh.uv2s[0]=e,this.rightMesh.uv2s[1]=i,this.rightMesh.uv2s[2]=e,this.rightMesh.uv2s[3]=t,this.rightMesh.uv2s[4]=n,this.rightMesh.uv2s[5]=t,this.rightMesh.uv2s[6]=n,this.rightMesh.uv2s[7]=i);for(var s=0;s<o.length;s++){var l=o[s],u=3*s;this.rightMesh.vertices[u]=l.x,this.rightMesh.vertices[u+1]=l.y+this.suspend,this.rightMesh.vertices[u+2]=l.z}for(var c=0;c<o.length;c++){var h=a,p=3*c;this.rightMesh.normals[p]=h.x,this.rightMesh.normals[p+1]=h.y,this.rightMesh.normals[p+2]=h.z}}},{key:"fillLeftMeshInfo",value:function(){this.leftMesh.resource=this.object.leftResource,this.leftMesh.vertices=new Float32Array(12),this.leftMesh.normals=new Float32Array(12),this.leftMesh.uvs=[],this.leftMesh.triangles=new Uint16Array(6),this.leftMesh.triangles[0]=3,this.leftMesh.triangles[1]=1,this.leftMesh.triangles[2]=0,this.leftMesh.triangles[3]=3,this.leftMesh.triangles[4]=2,this.leftMesh.triangles[5]=1;var e,t,n,i,r=this.basePoints,o=[r[1],r[5],r[6],r[2]],a=new Mn;a.crossVectors(this.direction,this.downDirection),a.normalize(),this.object.leftResource.isDefault?(e=this.startUVPercent[2],t=this.startUVPercent[3],n=this.endUVPercent[2],i=this.endUVPercent[3]):(e=this.startUVPercent[2]*this.repeatUV[2],t=this.startUVPercent[3]*this.repeatUV[3],n=this.endUVPercent[2]*this.repeatUV[2],i=this.endUVPercent[3]*this.repeatUV[3]),this.leftMesh.uvs=new Float32Array(8),this.leftMesh.uvs[0]=n,this.leftMesh.uvs[1]=i,this.leftMesh.uvs[2]=n,this.leftMesh.uvs[3]=t,this.leftMesh.uvs[4]=e,this.leftMesh.uvs[5]=t,this.leftMesh.uvs[6]=e,this.leftMesh.uvs[7]=i,this.object.leftResource.isDefault&&(e=this.startUVPercent[0],t=this.startUVPercent[1],n=this.endUVPercent[0],i=this.endUVPercent[1],this.leftMesh.uv2s=new Float32Array(8),this.leftMesh.uv2s[0]=e,this.leftMesh.uv2s[1]=i,this.leftMesh.uv2s[2]=e,this.leftMesh.uv2s[3]=t,this.leftMesh.uv2s[4]=n,this.leftMesh.uv2s[5]=t,this.leftMesh.uv2s[6]=n,this.leftMesh.uv2s[7]=i);for(var s=0;s<o.length;s++){var l=o[s],u=3*s;this.leftMesh.vertices[u]=l.x,this.leftMesh.vertices[u+1]=l.y+this.suspend,this.leftMesh.vertices[u+2]=l.z}for(var c=0;c<o.length;c++){var h=a,p=3*c;this.leftMesh.normals[p]=h.x,this.leftMesh.normals[p+1]=h.y,this.leftMesh.normals[p+2]=h.z}}},{key:"fillEdgeSideMeshInfo",value:function(){this.edgeMesh.resource=this.object.edgeResource;var e=Sn.wallTopFaceIndexes,t=Sn.wallStartFaceIndexes,n=Sn.wallEndFaceIndexes,i=Sn.wallStartCornerFaceIndexes,r=Sn.wallEndCornerFaceIndexes,o=Sn.wallBottomFaceIndexes;this.edgeMesh.triangles=new Uint16Array(this.getEdgeTrianglesCount(this.object));for(var a=e.length,s=0;s<e.length;s++)this.edgeMesh.triangles[s]=e[s];if(this.shouldAddSideIndexes(this.startCorner)){for(var l=0;l<t.length;l++)this.edgeMesh.triangles[a+l]=t[l];a+=t.length}if(this.shouldAddSideIndexes(this.endCorner)){for(var u=0;u<n.length;u++)this.edgeMesh.triangles[a+u]=n[u];a+=n.length}if(this.startCorner.walls.length>2){for(var c=0;c<i.length;c++)this.edgeMesh.triangles[a+c]=i[c];a+=i.length}if(this.endCorner.walls.length>2){for(var h=0;h<r.length;h++)this.edgeMesh.triangles[a+h]=r[h];a+=r.length}if(0!==this.object.suspend)for(var p=0;p<o.length;p++)this.edgeMesh.triangles[a+p]=o[p];this.edgeMesh.vertices=new Float32Array(30),this.edgeMesh.normals=new Float32Array(30),this.edgeMesh.uvs=new Float32Array(20);for(var d=this.basePoints,f=[d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9]],m=0;m<f.length;m++){var g=f[m],v=3*m;this.edgeMesh.vertices[v]=g.x,this.edgeMesh.vertices[v+1]=g.y+this.object.suspend,this.edgeMesh.vertices[v+2]=g.z}for(var y=0;y<f.length;y++){var b=this.upDirection,_=3*y;this.edgeMesh.normals[_]=b.x,this.edgeMesh.normals[_+1]=b.y,this.edgeMesh.normals[_+2]=b.z}}},{key:"getEdgeTrianglesCount",value:function(e){var t=Sn.wallTopFaceIndexes.length;return this.shouldAddSideIndexes(e.startCorner)&&(t+=Sn.wallStartFaceIndexes.length),this.shouldAddSideIndexes(e.endCorner)&&(t+=Sn.wallEndFaceIndexes.length),e.startCorner.walls.length>2&&(t+=Sn.wallStartCornerFaceIndexes.length),e.endCorner.walls.length>2&&(t+=Sn.wallEndCornerFaceIndexes.length),0!==this.object.suspend&&(t+=Sn.wallBottomFaceIndexes.length),t}},{key:"shouldAddSideIndexes",value:function(e){for(var t=0,n=0;n<e.walls.length;n++){"StraightManualWall"===e.walls[n].type&&t++}return 1===t||!(e.calculater.checkWallsSameHeight(e)&&!e.calculater.containModelWall(e))}},{key:"shouldAddEdgeTriangle",value:function(e){for(var t=0,n=0;n<e.walls.length;n++){"StraightManualWall"===e.walls[n].type&&t++}return t>2}},{key:"clear",value:function(){this.leftMesh.clear(),this.rightMesh.clear(),this.edgeMesh.clear(),vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(Vn),Gn=function(e){function t(e){mn(this,t);var n=bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.meshMap=new Map,n.resources=[],n}return yn(t,e),gn(t,[{key:"_calculate",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this)}},{key:"_initParams",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.meshMap=new Map,this.resources=[]}},{key:"classifyMeshesToDic",value:function(e){this.meshMap.clear();for(var t=0;t<e.length;t++){var n=e[t].calculater.mesh;this.addMeshToMap(n)}}},{key:"addMeshToMap",value:function(e){if(e.subMeshes.length>0)for(var t=0;t<e.subMeshes.length;t++){var n=e.subMeshes[t];this.addMeshToMap(n)}e.resource&&(this.meshMap.has(e.resource)||(this.resources.push(e.resource),this.meshMap.set(e.resource,[])),this.meshMap.get(e.resource).push(e))}},{key:"combineMeshes",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,r=this.meshMap[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var o=i.value,a=_n(o,2),s=a[0],l=a[1],u=this._combineSubMeshes(l);u.resource=s,this.mesh.subMeshes.push(u)}}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}}},{key:"_combineSubMeshes",value:function(e){var t,n=new xn;t=this._initCombineMesh(e,n);for(var i=0;i<e.length;i++){var r=e[i];this._combineIndexes(r,n,t),this._combinePositionsAndNormals(r,n,t),this._combineUVs(r,n,t),this._combineExtraData(r,n,t)}return n}},{key:"_initCombineMesh",value:function(e,t,n){var i=0,r=0,o=0,a=0,s=0,l={};n={index:0,vertex:0,uv:0,uv2:0};for(var u=0;u<e.length;u++){var c=e[u];for(var h in i+=c.triangles.length,r+=c.vertices.length,o+=c.uvs.length,a+=c.uv2s.length,s+=c.normals.length,c.extraData)"groups"!==h&&(void 0===l[h]&&(l[h]=0),l[h]+=c.extraData[h].length)}for(var p in t.vertices=new Float32Array(r),t.triangles=new Uint16Array(i),t.uvs=new Float32Array(o),t.uv2s=new Float32Array(a),t.normals=new Float32Array(s),l)t.extraData[p]=new Float32Array(l[p]),n[p]=0;return n}},{key:"_combineIndexes",value:function(e,t,n){for(var i=e.triangles,r=0;r<i.length;r++){var o=i[r];t.triangles[n.index+r]=n.vertex/3+o}n.index+=i.length}},{key:"_combinePositionsAndNormals",value:function(e,t,n){for(var i=e.vertices,r=e.normals,o=0;o<i.length;o++)t.vertices[n.vertex+o]=i[o],t.normals[n.vertex+o]=r[o];n.vertex+=i.length}},{key:"_combineUVs",value:function(e,t,n){for(var i=e.uvs,r=e.uv2s,o=0;o<i.length;o++){var a=i[o];t.uvs[n.uv+o]=a}n.uv+=i.length;for(var s=0;s<r.length;s++){var l=r[s];t.uv2s[n.uv2+s]=l}n.uv2+=r.length}},{key:"_combineExtraData",value:function(e,t,n){var i=e.extraData;for(var r in i)if("groups"!==r){for(var o=i[r],a=0;a<o.length;a++){var s=o[a];t.extraData[r][n[r]+a]=s}n[r]+=o.length}}}]),t}(En),Wn=function(e){function t(e){mn(this,t);var n=bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.mesh=new xn,n.sideVerticesCount=12,n.sideTrianglesCount=6,n.sideUvsCount=8,n.edgeVerticesCount=30,n.edgeUVsCount=20,n.resourceEachSideMeshMap=new Map,n.upDirection=new Mn(0,1,0),n.downDirection=new Mn(0,-1,0),n.vectorUp=new Mn(0,1,0),n}return yn(t,e),gn(t,[{key:"_initParams",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.mesh=new xn,this.resourceEachSideMeshMap=new Map}},{key:"_calculate",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this);for(var e=0;e<this.object.corners.length;e++){this.object.corners[e].calculate()}for(var n=0;n<this.object.walls.length;n++){var i=this.object.walls[n];if(i.calculater)if(i.calculater.setObject(i),i.doorOrWindows.length>0){i.calculater.baseBuild(),i.calculater.calPosInfo(),i.calculater.calEachSideLen(),i.calculater.calRepeatUV(),i.calculater.initSimpleCornersAndWalls();for(var r=0;r<i.calculater.subCorners.length;r++){i.calculater.subCorners[r].calculate()}for(var o=0;o<i.calculater.subWalls.length;o++){var a=i.calculater.subWalls[o];a.calculater.setObject(a),a.calculater.baseBuild(),a.calculater.calPosInfo(),a.calculater.calBasePoints(),a.calculater.calUV()}}else i.calculater.baseBuild(),i.calculater.calPosInfo(),i.calculater.calEachSideLen(),i.calculater.calRepeatUV(),i.calculater.calBasePoints()}this._initMesh();for(var s=0;s<this.object.walls.length;s++){var l=this.object.walls[s];if(l.doorOrWindows.length>0)for(var u=0;u<l.calculaterData.subWalls.length;u++){var c=l.calculaterData.subWalls[u];this._addToCombineMesh(c)}else this._addToCombineMesh(l)}}},{key:"_addToCombineMesh",value:function(e){var t=this.resourceEachSideMeshMap.get(e.rightResource).right.mesh,n=this.resourceEachSideMeshMap.get(e.rightResource).right.cursor,i=this.resourceEachSideMeshMap.get(e.leftResource).left.mesh,r=this.resourceEachSideMeshMap.get(e.leftResource).left.cursor,o=this.resourceEachSideMeshMap.get(e.edgeResource).edge.mesh,a=this.resourceEachSideMeshMap.get(e.edgeResource).edge.cursor;this.fillRightMeshInfo(t,n,e),this.fillLeftMeshInfo(i,r,e),this.fillEdgeSideMeshInfo(o,a,e)}},{key:"_initMesh",value:function(){this._initLeftMeshes(),this._initRightMeshes(),this._initEdgeMeshes()}},{key:"_initLeftMeshes",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,r=this.object.leftWallResourceMap.keys()[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){for(var o=i.value,a=this.object.leftWallResourceMap.get(o),s=0,l=0,u=0,c=0;c<a.length;c++){var h=a[c],p=1;if(h.doorOrWindows.length>0){for(var d=0;d<h.doorOrWindows.length;d++){var f=h.doorOrWindows[d];p=1,f.suspendPercent>0&&(p=2),s+=this.sideVerticesCount*p,l+=this.sideTrianglesCount*p,u+=this.sideUvsCount*p}p=h.doorOrWindows.length+1,s+=this.sideVerticesCount*p,l+=this.sideTrianglesCount*p,u+=this.sideUvsCount*p}else s+=this.sideVerticesCount,l+=this.sideTrianglesCount,u+=this.sideUvsCount}var m=new xn;m.resource=o,this.mesh.subMeshes.push(m),m.vertices=new Float32Array(s),m.normals=new Float32Array(s),m.triangles=new Uint16Array(l),m.uvs=new Float32Array(u),o.isDefault&&(m.uv2s=new Float32Array(u)),this.resourceEachSideMeshMap.has(o)||this.resourceEachSideMeshMap.set(o,{});var g=this.resourceEachSideMeshMap.get(o);g.left||(g.left={mesh:m,cursor:{index:0,vertex:0,uv:0,uv2:0}})}}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}}},{key:"_initRightMeshes",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,r=this.object.rightWallResourceMap.keys()[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){for(var o=i.value,a=this.object.rightWallResourceMap.get(o),s=0,l=0,u=0,c=0;c<a.length;c++){var h=a[c],p=1;if(h.doorOrWindows.length>0){for(var d=0;d<h.doorOrWindows.length;d++){var f=h.doorOrWindows[d];p=1,f.suspendPercent>0&&(p=2),s+=this.sideVerticesCount*p,l+=this.sideTrianglesCount*p,u+=this.sideUvsCount*p}p=h.doorOrWindows.length+1,s+=this.sideVerticesCount*p,l+=this.sideTrianglesCount*p,u+=this.sideUvsCount*p}else s+=this.sideVerticesCount,l+=this.sideTrianglesCount,u+=this.sideUvsCount}var m=new xn;m.resource=o,this.mesh.subMeshes.push(m),m.vertices=new Float32Array(s),m.normals=new Float32Array(s),m.triangles=new Uint16Array(l),m.uvs=new Float32Array(u),o.isDefault&&(m.uv2s=new Float32Array(u)),this.resourceEachSideMeshMap.has(o)||this.resourceEachSideMeshMap.set(o,{});var g=this.resourceEachSideMeshMap.get(o);g.right||(g.right={mesh:m,cursor:{index:0,vertex:0,uv:0,uv2:0}})}}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}}},{key:"_initEdgeMeshes",value:function(){for(var e=0,t=0,n=0,i=(Sn.wallTopFaceIndexes.length,0);i<this.object.walls.length;i++){var r=this.object.walls[i];if(r.doorOrWindows.length>0)for(var o=0;o<r.calculaterData.subWalls.length;o++){var a=r.calculaterData.subWalls[o];t+=a.calculater.getEdgeTrianglesCount(a),e+=this.edgeVerticesCount,n+=this.edgeUVsCount}else t+=r.calculater.getEdgeTrianglesCount(r),e+=this.edgeVerticesCount,n+=this.edgeUVsCount}var s=new xn,l=this.object.walls[0].edgeResource;s.resource=l,this.mesh.subMeshes.push(s),s.vertices=new Float32Array(e),s.normals=new Float32Array(e),s.triangles=new Uint16Array(t),s.uvs=new Uint16Array(n),this.resourceEachSideMeshMap.has(l)||this.resourceEachSideMeshMap.set(l,{});var u=this.resourceEachSideMeshMap.get(l);u.edge||(u.edge={mesh:s,cursor:{index:0,vertex:0,uv:0,uv2:0}})}},{key:"changeToParentCoordinate",value:function(){for(var e=0;e<this.object.walls.length;e++){var t=this.object.walls[e],n="StraightManualWall"===t.type?t.position:t.position.toArray();this.changeMeshCoordinate(t.calculater.mesh,n)}}},{key:"changeMeshCoordinate",value:function(e,t){var n="StraightManualWall"===t.type?t.position:t.position.toArray();if(e.vertices)for(var i=0;i<e.vertices.length;){var r=e.vertices;r[i]+=n[0],r[i+1]+=n[1],r[i+2]+=n[2],i+=3}for(var o=0;o<e.subMeshes.length;o++){var a=e.subMeshes[o];this.changeMeshCoordinate(a,t)}}},{key:"fillRightMeshInfo",value:function(e,t,n){var i=t.index,r=t.uv,o=t.uv2,a=t.vertex,s=a/3,l=n.calculaterData,u=Array.isArray(n.position)?n.position:n.position.toArray();e.triangles[i+0]=0+s,e.triangles[i+1]=2+s,e.triangles[i+2]=3+s,e.triangles[i+3]=0+s,e.triangles[i+4]=1+s,e.triangles[i+5]=2+s;var c,h,p,d,f=l.basePoints,m=[f[0],f[4],f[7],f[3]],g=new Mn,v=Sn.convertToVector3(n.direction);g.crossVectors(this.downDirection,v),g.normalize(),n.rightResource.isDefault?(c=l.startUVPercent[0],h=l.startUVPercent[1],p=l.endUVPercent[0],d=l.endUVPercent[1]):(c=l.startUVPercent[0]*l.repeatUV[0],h=l.startUVPercent[1]*l.repeatUV[1],p=l.endUVPercent[0]*l.repeatUV[0],d=l.endUVPercent[1]*l.repeatUV[1]),e.uvs[r+0]=c,e.uvs[r+1]=d,e.uvs[r+2]=c,e.uvs[r+3]=h,e.uvs[r+4]=p,e.uvs[r+5]=h,e.uvs[r+6]=p,e.uvs[r+7]=d,n.rightResource.isDefault&&(c=l.startUVPercent[0],h=l.startUVPercent[1],p=l.endUVPercent[0],d=l.endUVPercent[1],e.uv2s[o+0]=c,e.uv2s[o+1]=d,e.uv2s[o+2]=c,e.uv2s[o+3]=h,e.uv2s[o+4]=p,e.uv2s[o+5]=h,e.uv2s[o+6]=p,e.uv2s[o+7]=d);for(var y=0;y<m.length;y++){var b=m[y],_=3*y;e.vertices[a+_]=b.x+u[0],e.vertices[a+_+1]=b.y+n.suspend+u[1],e.vertices[a+_+2]=b.z+u[2],b=g,e.normals[a+_]=b.x,e.normals[a+_+1]=b.y,e.normals[a+_+2]=b.z}t.vertex+=this.sideVerticesCount,t.index+=this.sideTrianglesCount,t.uv+=this.sideUvsCount,n.rightResource.isDefault&&(t.uv2+=this.sideUvsCount)}},{key:"fillLeftMeshInfo",value:function(e,t,n){var i=t.index,r=t.uv,o=t.uv2,a=t.vertex,s=a/3,l=Array.isArray(n.position)?n.position:n.position.toArray();e.triangles[i+0]=3+s,e.triangles[i+1]=1+s,e.triangles[i+2]=0+s,e.triangles[i+3]=3+s,e.triangles[i+4]=2+s,e.triangles[i+5]=1+s;var u,c,h,p,d=n.calculaterData,f=d.basePoints,m=[f[1],f[5],f[6],f[2]],g=new Mn,v=Sn.convertToVector3(n.direction);g.crossVectors(v,this.downDirection),g.normalize(),n.leftResource.isDefault?(u=d.startUVPercent[2],c=d.startUVPercent[3],h=d.endUVPercent[2],p=d.endUVPercent[3]):(u=d.startUVPercent[2]*d.repeatUV[2],c=d.startUVPercent[3]*d.repeatUV[3],h=d.endUVPercent[2]*d.repeatUV[2],p=d.endUVPercent[3]*d.repeatUV[3]),e.uvs[r+0]=h,e.uvs[r+1]=p,e.uvs[r+2]=h,e.uvs[r+3]=c,e.uvs[r+4]=u,e.uvs[r+5]=c,e.uvs[r+6]=u,e.uvs[r+7]=p,n.leftResource.isDefault&&(u=d.startUVPercent[0],c=d.startUVPercent[1],h=d.endUVPercent[0],p=d.endUVPercent[1],e.uv2s[o+0]=u,e.uv2s[o+1]=p,e.uv2s[o+2]=u,e.uv2s[o+3]=c,e.uv2s[o+4]=h,e.uv2s[o+5]=c,e.uv2s[o+6]=h,e.uv2s[o+7]=p);for(var y=0;y<m.length;y++){var b=m[y],_=3*y;e.vertices[a+_]=b.x+l[0],e.vertices[a+_+1]=b.y+n.suspend+l[1],e.vertices[a+_+2]=b.z+l[2],b=g,e.normals[a+_]=b.x,e.normals[a+_+1]=b.y,e.normals[a+_+2]=b.z}t.vertex+=this.sideVerticesCount,t.index+=this.sideTrianglesCount,t.uv+=this.sideUvsCount,n.leftResource.isDefault&&(t.uv2+=this.sideUvsCount)}},{key:"fillEdgeSideMeshInfo",value:function(e,t,n){for(var i=t.index,r=(t.uv,t.uv2,t.vertex),o=r/3,a=Array.isArray(n.position)?n.position:n.position.toArray(),s=Sn.wallTopFaceIndexes,l=Sn.wallStartFaceIndexes,u=Sn.wallEndFaceIndexes,c=Sn.wallStartCornerFaceIndexes,h=Sn.wallEndCornerFaceIndexes,p=Sn.wallBottomFaceIndexes,d=n.calculaterData,f=s.length,m=0;m<s.length;m++)e.triangles[i+m]=s[m]+o;if(n.calculater.shouldAddSideIndexes(n.startCorner)){for(var g=0;g<l.length;g++)e.triangles[i+f+g]=l[g]+o;f+=l.length}if(n.calculater.shouldAddSideIndexes(n.endCorner)){for(var v=0;v<u.length;v++)e.triangles[i+f+v]=u[v]+o;f+=u.length}if(n.startCorner.walls.length>2){for(var y=0;y<c.length;y++)e.triangles[i+f+y]=c[y]+o;f+=c.length}if(n.endCorner.walls.length>2){for(var b=0;b<h.length;b++)e.triangles[i+f+b]=h[b]+o;f+=h.length}if(0!==n.suspend)for(var _=0;_<p.length;_++)e.triangles[i+f+_]=p[_]+o;for(var x=d.basePoints,E=[x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7],x[8],x[9]],w=0;w<E.length;w++){var T=E[w],M=3*w;e.vertices[r+M]=T.x+a[0],e.vertices[r+M+1]=T.y+n.suspend+a[1],e.vertices[r+M+2]=T.z+a[2]}for(var S=0;S<E.length;S++){var C=this.upDirection,A=3*S;e.normals[r+A]=C.x,e.normals[r+A+1]=C.y,e.normals[r+A+2]=C.z}t.vertex+=this.edgeVerticesCount,t.index+=f,t.uv+=this.edgeUVsCount}}]),t}(Gn),Xn=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),gn(t,[{key:"build",value:function(e){}}]),t}(En),Jn=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),gn(t,[{key:"_calculate",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this);var e=this.object.attachWall,n=new Tn;if(e){var i=Sn.convertToVector3(e.direction),r=new Mn;r.crossVectors(new Mn(0,-1,0),i),n.setFromUnitVectors(new Mn(0,0,-1),r),this.object.rotation=[n.x,n.y,n.z,n.w],this.object.position[1]=e.height*this.object.suspendPercent}}}]),t}(En),Yn=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),gn(t,[{key:"setObject",value:function(e){this.object=e,this.startCorner=this.object.startCorner,this.endCorner=this.object.endCorner,this.startCornerPosition=Sn.convertToVector3(this.startCorner.position),this.endCornerPosition=Sn.convertToVector3(this.endCorner.position),this.position=Sn.convertToVector3(this.object.position),this.direction=Sn.convertToVector3(this.object.direction),this.suspend=this.object.suspend,this.doorOrWindows=this.object.doorOrWindows,this.object.calculaterData.subWalls=[],this.object.calculaterData.subCorners=[],this.subWalls=this.object.calculaterData.subWalls,this.subCorners=this.object.calculaterData.subCorners;var t=e.calculaterData;t.pathPoints=[],t.selfPathPoints=[],t.startUVPercent=[0,0,0,0],t.endUVPercent=[1,1,1,1],t.basePoints=[],this.pathPoints=t.pathPoints,this.selfPathPoints=t.selfPathPoints,this.cornersVertices=[this.object.startCorner.calculaterData[this.object.id][0],this.object.startCorner.calculaterData[this.object.id][1],this.object.endCorner.calculaterData[this.object.id][0],this.object.endCorner.calculaterData[this.object.id][1]],t.cornersVertices=this.cornersVertices,this.basePoints=t.basePoints;for(var n=0;n<12;n++)this.basePoints.push(new Mn);this.repeatUV=t.repeatUV,this.startUVPercent=t.startUVPercent,this.endUVPercent=t.endUVPercent}},{key:"build",value:function(e){this.setObject(e),this._calculate(),this.object.calculaterMesh=this.mesh}},{key:"_calculate",value:function(){this.leftMesh=new xn,this.rightMesh=new xn,this.edgeMesh=new xn,this.mesh=new xn,this.suspend=this.object.suspend,this.initMeshInfo()}},{key:"initMeshInfo",value:function(){this.baseBuild(),this.calPosInfo(),this.calBasePoints(),this.calUV(),this.fillMesh(),this.changeToParentWallLocal(this.mesh)}},{key:"calUV",value:function(){this.calPosInfo(),this.calEachSideLen();var e=this.object.parentWall.calculaterData,t=this.object.calculaterData.buildType,n=this.object.calculaterData.doorOrWindows,i=this.object.calculaterData.index,r=this.object.length,o=Sn.convertToVector3(this.object.parentWall.position);if("start"===t)this.object.calculaterData.endUVPercent[0]=this.rightSideLength/e.rightSideLength,this.object.calculaterData.startUVPercent[2]=(e.leftSideLength-this.leftSideLength)/e.leftSideLength;else if("end"===t){var a=this.getDoorOrWinRectPoints(n[i])[3].distanceTo(o.clone().addVectors(e.cornersVertices[0],o));this.object.calculaterData.startUVPercent[0]=a/e.rightSideLength,this.object.calculaterData.endUVPercent[2]=this.object.calculaterData.leftSideLength/e.leftSideLength,this.object.calculaterData.repeatUV=this.repeatUV}else{var s=n[i-1],l=this.getDoorOrWinRectPoints(s),u=(a=l[3].distanceTo(o.clone().addVectors(e.cornersVertices[0],o)),l[2].distanceTo(o.clone().addVectors(e.cornersVertices[2],o)));this.startUVPercent[0]=a/e.rightSideLength,this.startUVPercent[2]=(u-r)/e.leftSideLength,this.endUVPercent[0]=(a+r)/e.rightSideLength,this.endUVPercent[2]=u/e.leftSideLength}}},{key:"changeToParentWallLocal",value:function(e){for(var t=this.object.parentWall.position,n=0;n<e.vertices.length;)e.vertices[n]+=this.object.position.x-t[0],e.vertices[n+1]+=this.object.position.y-t[1],e.vertices[n+2]+=this.object.position.z-t[2],n+=3;for(var i=0;i<e.subMeshes.length;i++){var r=e.subMeshes[i];this.changeToParentWallLocal(r)}}},{key:"shouldAddSideIndexes",value:function(e){return"WallCorner"!==e.type||vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"shouldAddSideIndexes",this).call(this,e)}}]),t}(qn),Qn=function(){function e(t,n){mn(this,e),this._initParams(),this.resource=t,this.modelMesh=n,this.maxCount=65534}return gn(e,[{key:"_initParams",value:function(){this.vertexCount=0,this.indexCount=0,this.resource=null,this.modelMesh=null,this.groups=null,this.transformations=null,this.maxCount=null,this.combineMesh=null}},{key:"isExceed",value:function(e){return this.vertexCount+e>this.maxCount}},{key:"clear",value:function(){this._initParams()}}]),e}(),Zn=function(e){function t(e,n){mn(this,t);var i=bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.mesh=new xn,i.mesh.resource=e,i.modelMeshVerticeLength=i.modelMesh.vertices.length/3,i.combineProgressIndexMap={},i.transformations=[],i._tempPosition=new Float32Array(3),i._tempNormal=new Float32Array(3),i.groupsCountArray=null,i}return yn(t,e),gn(t,[{key:"_initParams",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.mesh=null,this.modelMeshVerticeLength=null,this.combineProgressIndexMap=null,this.transformations=null}},{key:"add",value:function(e){this.vertexCount+=this.modelMeshVerticeLength,this.indexCount+=this.modelMesh.triangles.length,this.transformations.push(e)}},{key:"combine",value:function(){this._initMesh();for(var e=0;e<this.transformations.length;e++){var t=this.transformations[e];this._combineVertices(t),this._combineNormals(t),this._combineUVs(),this._combineTriangles(),this._combineExtraData(),this.combineProgressIndexMap.vertices+=this.modelMesh.vertices.length,this.combineProgressIndexMap.triangles+=this.modelMesh.triangles.length,this.combineProgressIndexMap.uv+=this.modelMesh.uvs.length}}},{key:"_initMesh",value:function(){this.mesh.vertices=new Float32Array(3*this.vertexCount),this.mesh.normals=new Float32Array(3*this.vertexCount),this.mesh.uvs=new Float32Array(2*this.vertexCount),this.modelMesh.uv2s.length>0&&(this.mesh.uv2s=new Float32Array(2*this.vertexCount)),this.mesh.triangles=new Uint16Array(this.indexCount),this.combineProgressIndexMap={vertices:0,triangles:0,uv:0};var e=this.modelMesh.extraData;for(var t in e)if("groups"===t&&this.modelMesh.extraData[t].length>0){var n=this.cloneGroups(this.modelMesh.extraData[t]);this.combineProgressIndexMap.groups=[];for(var i=0;i<n.length;i++){var r=n[i];r.count*=this.transformations.length,i!==n.length-1&&(n[i+1].start=n[i].start+r.count),this.combineProgressIndexMap.groups.push({currentIndex:n[i].start})}this.mesh.extraData[t]=n}else{var o=this.modelMesh.extraData[t].length*this.transformations.length;this.mesh.extraData[t]=new Float32Array(o),this.combineProgressIndexMap[t]=0}}},{key:"_combineVertices",value:function(e){for(var t=this.combineProgressIndexMap.vertices,n=this.modelMesh.vertices,i=e.positions,r=e.scales,o=e.quaternions,a=this._tempPosition,s=0;s<n.length;s+=3){a[0]=n[s],a[1]=n[s+1],a[2]=n[s+2];for(var l=i.length-1;l>-1;l--){var u=i[l],c=r[l],h=o[l];1===c[0]&&1===c[1]&&1===c[2]||(a[0]*=c[0],a[1]*=c[1],a[2]*=c[2]),Sn.applyQuaternionToVector3(h,a),0!==u[0]&&(a[0]+=u[0]),0!==u[1]&&(a[1]+=u[1]),0!==u[2]&&(a[2]+=u[2])}this.mesh.vertices[t]=a[0],this.mesh.vertices[t+1]=a[1],this.mesh.vertices[t+2]=a[2],t+=3}}},{key:"_combineNormals",value:function(e){for(var t=this.combineProgressIndexMap.vertices,n=this.modelMesh.normals,i=e.quaternions,r=this._tempNormal,o=0;o<n.length;o+=3){r[0]=n[o],r[1]=n[o+1],r[2]=n[o+2];for(var a=i.length-1;a>-1;a--){var s=i[a];Sn.applyQuaternionToVector3(s,r)}this.mesh.normals[t]=r[0],this.mesh.normals[t+1]=r[1],this.mesh.normals[t+2]=r[2],t+=3}}},{key:"_combineUVs",value:function(){for(var e=this.modelMesh.uvs,t=this.modelMesh.uv2s,n=this.combineProgressIndexMap.uv,i=0;i<e.length;i++){var r=e[i];this.mesh.uvs[n+i]=r}for(var o=0;o<t.length;o++){var a=t[o];this.mesh.uv2s[n+o]=a}}},{key:"_combineTriangles",value:function(){var e=this.combineProgressIndexMap.vertices/3,t=this.combineProgressIndexMap.triangles,n=this.modelMesh.triangles;if(this.combineProgressIndexMap.groups)for(var i=this.modelMesh.extraData.groups,r=0;r<i.length;r++){for(var o=i[r],a=o.start,s=o.count,l=this.combineProgressIndexMap.groups[r],u=0;u<s;u++)this.mesh.triangles[l.currentIndex+u]=e+n[a+u];l.currentIndex+=s}else for(var c=0;c<n.length;c++){var h=n[c];this.mesh.triangles[t+c]=e+h}}},{key:"_combineExtraData",value:function(){var e=this.modelMesh.extraData;for(var t in e)if(!("groups"===t&&e[t].length>0)){for(var n=e[t],i=this.combineProgressIndexMap[t],r=0;r<n.length;r++){var o=n[r];this.mesh.extraData[t][i+r]=o}this.combineProgressIndexMap[t]+=n.length}}},{key:"cloneGroups",value:function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];t.push(Sn.cloneJSObject(i))}return t}},{key:"clear",value:function(){this._initParams(),vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(Qn),Kn=function(){function e(t,n){mn(this,e),this._initParams(),this.mesh=new xn,this.resource=t,this.modelMesh=n,this.subMeshProcessors=[],this.modelMeshVerticeLength=this.modelMesh.vertices.length/3,this.currentSubMeshProcessor=this._createSubMeshProcessor()}return gn(e,[{key:"_initParams",value:function(){this.mesh=null,this.resource=null,this.modelMesh=null,this.subMeshProcessors=null,this.modelMeshVerticeLength=null,this.currentSubMeshProcessor=null}},{key:"_createSubMeshProcessor",value:function(){var e=new Zn(this.resource,this.modelMesh);return this.subMeshProcessors.push(e),e}},{key:"add",value:function(e){this.currentSubMeshProcessor.isExceed(this.modelMeshVerticeLength)&&(this.currentSubMeshProcessor=this._createSubMeshProcessor()),this.currentSubMeshProcessor.add(e)}},{key:"combine",value:function(){for(var e=0;e<this.subMeshProcessors.length;e++){var t=this.subMeshProcessors[e];t.combine(),this.mesh.subMeshes.push(t.mesh)}1===this.subMeshProcessors.length&&(this.mesh=this.mesh.subMeshes[0])}},{key:"clear",value:function(){this.mesh.clear(),this._initParams()}}]),e}(),$n=function(e){function t(e){mn(this,t);var n=bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.isResourceVertexExceed=!1,n}return yn(t,e),gn(t,[{key:"_initParams",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.processorMap=new Map,this.processors=[],this.isResourceVertexExceed=!1}},{key:"_calculate",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this),this._initResources(),this.isResourceVertexExceed||(this._fillProcessors(),this._createMesh())}},{key:"_initResources",value:function(){for(var e=this.object.resources,t=0;t<e.length;t++){var n=e[t];if(this.resourceCombineManager.getCombineMesh(n),n.vertexIsExceed)return void(this.isResourceVertexExceed=!0)}for(var i=0;i<e.length;i++){var r=e[i];this._initProcessors(r)}}},{key:"_initProcessors",value:function(e){var t=this.resourceCombineManager.getCombineMesh(e);this._createProcessorByResourceBuilderMesh(e,t)}},{key:"_createProcessorByResourceBuilderMesh",value:function(e,t){if(this.processorMap[e.id]||(this.processorMap[e.id]=[]),t.resource){var n=new Kn(t.resource,t);this.processorMap[e.id].push(n),this.processors.push(n)}for(var i=0;i<t.subMeshes.length;i++){var r=t.subMeshes[i];this._createProcessorByResourceBuilderMesh(e,r)}}},{key:"_fillProcessors",value:function(){}},{key:"_createMesh",value:function(){for(var e=0;e<this.processors.length;e++){var t=this.processors[e];t.combine(),this.mesh.subMeshes.push(t.mesh)}}},{key:"addSingleTransformationToProcessors",value:function(e){for(var t=0;t<this.processors.length;t++){this.processors[t].add(e)}}}]),t}(Gn),ei=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),gn(t,[{key:"_fillProcessors",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_fillProcessors",this).call(this),this.addTransformationToProcessor()}},{key:"addTransformationToProcessor",value:function(){for(var e=0;e<this.object.transformations.length;e++){var t=this.object.transformations[e];this.addSingleTransformationToProcessors(t)}}},{key:"clear",value:function(){for(var e=0;e<this.processors.length;e++){this.processors[e].clear()}vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}($n),ti=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),t}(En),ni=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),gn(t,[{key:"_calculate",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this)}}]),t}(En),ii=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),t}(ni),ri=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),t}(ni),oi=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),gn(t,[{key:"_calculate",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_calculate",this).call(this)}}]),t}(Gn),ai=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),t}(Gn),si=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),t}(Gn),li=function e(t){mn(this,e)},ui=function(){function e(t){mn(this,e),this.combineBundleObjectMaps={},this.CombineBuilderClass=li}return gn(e,[{key:"getCombineBundleObject",value:function(e){this.combineBundleObjectMaps[e.id]}},{key:"createCombineBuilder",value:function(e){return new this.CombineBuilderClass({resource:e})}}]),e}(),ci=new ui,hi=function(){function e(){mn(this,e),this.positions=[],this.scales=[],this.quaternions=[]}return gn(e,[{key:"clone",value:function(){var t=new e;return t.positions=this.positions.slice(),t.scales=this.scales.slice(),t.quaternions=this.quaternions.slice(),t}}]),e}(),pi=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),gn(t,[{key:"_initParams",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.modelNumber=-1,this.models=[],this.objPositions=[],this.objLocalPositions=[],this.objRotations=[],this.objScales=[],this.transformations=[],this.processorMap=new Map,this.processors=[],this.wallPosition=null}},{key:"registerCombineBuilder",value:function(e){var t=ci.createCombineBuilder(e);e.containBuilder(e.id)||e.registerBuilder(e.id,t)}},{key:"_calculate",value:function(){this.mesh=new xn;for(var e=this.object.resources,t=0;t<e.length;t++){var n=e[t];this._initProcessors(n)}if(this.object.doorOrWindows.length>0){this.initSimpleCornersAndWalls();for(var i=0;i<this.subWalls.length;i++){var r=this.subWalls[i];r.calculate(),this.mesh.subMeshes.push(r.calculater.mesh)}}else this.calObjInfo();this.addTransformationToProcessor();for(var o=0;o<this.processors.length;o++){var a=this.processors[o];a.combine(),this.mesh.subMeshes.push(a.mesh)}}},{key:"instanceModels",value:function(){if(null!==this.object.model){this.models=[];for(var e=this.modelNumber,t=0;t<e;t++){var n=this.model.clone(),i=this.objPositions[t],r=this.objRotations[t],o=this.objScales[t];n.position.set(i.x,i.y,i.z),n.quaternion.set(r.x,r.y,r.z,r.w),n.scale.set(o.x,o.y,o.z),this.mesh.add(n),this.models.push(n)}}}},{key:"calObjInfo",value:function(){this.objPositions=[],this.objRotations=[],this.objScales=[];var e=Sn.convertToVector3(this.object.startCorner.position),t=(Sn.convertToVector3(this.object.endCorner.position),Sn.convertToVector3(this.object.direction)),n=Sn.convertToVector3(this.object.position);this.wallPosition=n,this.modelSize=this.object.resource.size,-1===this.object.height?this.object.height=this.modelSize[1]:0!==this.modelSize[1]?this.heightRatio=this.object.height/this.modelSize[1]:(console.warn("model size is zero "+this.object.resource.id),this.object.height=3);var i=new Mn(0,-1,0),r=this.modelSize[0],o=(this.modelSize[2],this.modelSize[1]),a=this.object.length/r,s=parseInt(a),l=Math.ceil(a);this.modelNumber=l;var u=l*r,c=new Mn,h=t.clone();c.addVectors(e,h.multiplyScalar(u));var p=new Mn;p.crossVectors(t,i),p.normalize();var d=new Tn;0===p.x&&0===p.y&&0===p.z||d.setFromUnitVectors(new Mn(0,0,-1),p);var f=.5*r,m=new Mn(f,this.object.suspend,0);m.applyQuaternion(d),d.multiply(new Tn(0,1,0,0));for(var g=0;g<l;g++){var v=g/l,y=new Mn;y.lerpVectors(e,c,v);var b=new Mn;b.addVectors(m,y);var _=new Mn(1,this.object.height/o,1);this.objPositions.push(b),this.objRotations.push(d),this.objScales.push(_)}var x=(a-s)*r,E=x/r;if(l>0&&x>0){this.objScales[l-1]=new Mn(E,this.object.height/o,1);var w=new Mn(f*(1-E),0,0);w.applyQuaternion(d),this.objPositions[l-1].add(w)}for(var T=0;T<this.objPositions.length;T++){var M=this.objPositions[T],S=this.objScales[T],C=this.objRotations[T],A=new hi;new Mn;A.positions.push(M.toArray()),A.quaternions.push(C.toArray()),A.scales.push(S.toArray()),this.transformations.push(A)}}},{key:"initSimpleCornersAndWalls",value:function(){for(var e=this.sortDoorOrWins(),t=0;t<e.length;t++){var n=e[t],i=this.getDoorOrWinStartAndEndPos(n),r=On.createSubWallCorner(this.id+"_"+t+"_1",i[0],this),o=On.createSubWallCorner(this.id+"_"+t+"_2",i[1],this);if(this.addSubWallCorner(r),this.addSubWallCorner(o),0===t){var a=Un.create({type:Fn.SubModelWall});a.resource=this.object.resource,this.subWalls.push(a),a.startCorner=this.object.startCorner,a.endCorner=r,a.startCorner.calculate(),a.endCorner.calculate(),a.parentWall=this.object,a.height=this.object.height}else{var s=e[t-1],l=this.getDoorOrWinStartAndEndPos(s),u=this.getWallCornerByPos(l[1]),c=Un.create({type:Fn.SubModelWall});c.resource=this.object.resource,this.subWalls.push(c),c.startCorner=u,c.endCorner=r,c.startCorner.calculate(),c.endCorner.calculate(),c.parentWall=this.object,c.height=this.object.height}if(t===e.length-1){var h=Un.create({type:Fn.SubModelWall});h.resource=this.object.resource,this.subWalls.push(h),h.startCorner=o,h.endCorner=this.object.endCorner,h.startCorner.calculate(),h.parentWall=this.object,h.height=this.object.height}this.buildHeadAndFootWall(n,r,o)}}},{key:"buildSimpleCornersAndWalls",value:function(){this.wallGroup=new THREE.Object3D;for(var e=0;e<this.subCorners.length;e++){this.subCorners[e].build()}for(e=0;e<this.subWalls.length;e++){var t=this.subWalls[e];t.build(),this.wallGroup.add(t.wallGroup)}}},{key:"buildHeadAndFootWall",value:function(e,t,n){if(!this.object.resource.isSupportHeadAndFootModelWall)return!1;var i=e.suspendPercent;if(0!==i){var r=Un.create({type:Fn.SubModelWall});this.subWalls.push(r),r.resource=this.object.resource,r.parentWall=this.object,r.startCorner=t,r.endCorner=n,r.height=this.object.height*i}e.size;var o=e.size[1]+this.object.height*i;if(o<this.object.height){var a=Un.create({type:Fn.SubModelWall});this.subWalls.push(a),a.resource=this.object.resource,a.parentWall=this.object,a.startCorner=t,a.endCorner=n,a.suspend=o,a.height=this.object.height-o}}},{key:"_initProcessors",value:function(e){e.buildRegisterBuilder();var t=e.getBuilder(e.id).mesh;this._createProcessorByResourceBuilderMesh(t)}},{key:"_createProcessorByResourceBuilderMesh",value:function(e){if(e.resource&&!this.processorMap.has(e.resource)){var t=new Kn(e.resource,e);this.processorMap.set(e.resource,t),this.processors.push(t)}for(var n=0;n<e.subMeshes.length;n++){var i=e.subMeshes[n];this._createProcessorByResourceBuilderMesh(i)}}},{key:"addTransformationToProcessor",value:function(){for(var e=0;e<this.transformations.length;e++)for(var t=this.transformations[e],n=0;n<this.processors.length;n++){this.processors[n].add(t)}}}]),t}(Vn),di=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),t}(pi),fi=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),gn(t,[{key:"_fillProcessors",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_fillProcessors",this).call(this);for(var e=0;e<this.object.walls.length;e++){var n=this.object.walls[e];if(n.calculater)if(n.calculater.setObject(n),n.doorOrWindows.length>0){n.calculater.initSimpleCornersAndWalls();for(var i=0;i<n.calculater.subWalls.length;i++){var r=n.calculater.subWalls[i];r.calculater.setObject(r),r.calculater.calObjInfo(),this.addTransformationToProcessor(r.calculater.transformations)}}else n.calculater.calObjInfo(),this.addTransformationToProcessor(n.calculater.transformations);else console.log("wall not have calculater")}}},{key:"changeToParentCoordinate",value:function(){for(var e=0;e<this.object.walls.length;e++){var t=this.object.walls[e];this.changeMeshCoordinate(t.calculater.mesh,t.position)}}},{key:"changeMeshCoordinate",value:function(e,t){for(var n=0;n<e.vertices.length;){var i=e.vertices;i[n]+=t[0],i[n+1]+=t[1],i[n+2]+=t[2],n+=3}for(var r=0;r<e.subMeshes.length;r++){var o=e.subMeshes[r];this.changeMeshCoordinate(o,t)}}},{key:"addTransformationToProcessor",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];this.addSingleTransformationToProcessors(n)}}}]),t}($n),mi=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),t}(En),gi=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),gn(t,[{key:"_initParams",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.transformationMap={}}},{key:"_fillProcessors",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_fillProcessors",this).call(this),this._initTransformationMap(),this.addTransformationToProcessor()}},{key:"_initTransformationMap",value:function(){for(var e=this.object.objects,t=0;t<e.length;t++){var n=e[t];this._calSingleObjectTransformation(n)}}},{key:"_calSingleObjectTransformation",value:function(e,t){if(t||(t=new hi),t.positions.push(e.position),t.scales.push(e.scale),t.quaternions.push(e.rotation),"PlacementGroup"!==e.type&&0===e.children.length)this.transformationMap[e.resource.id]||(this.transformationMap[e.resource.id]=[]),this.transformationMap[e.resource.id].push(t);else for(var n=0;n<e.children.length;n++){var i=e.children[n];this._calSingleObjectTransformation(i,t.clone())}}},{key:"addTransformationToProcessor",value:function(){for(var e in this.transformationMap)for(var t=this.transformationMap[e],n=this.processorMap[e],i=0;i<t.length;i++)for(var r=t[i],o=0;o<n.length;o++){n[o].add(r)}}},{key:"clear",value:function(){for(var e=0;e<this.processors.length;e++){this.processors[e].clear()}vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}($n),vi=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),t}(Xn),yi=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),t}(Xn),bi=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),t}(Xn),_i=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),t}(ei),xi=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),gn(t,[{key:"_fillProcessors",value:function(){vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_fillProcessors",this).call(this);for(var e=0;e<this.object.objects.length;e++){this.object.objects[e].calculate()}this.addTransformationToProcessor()}},{key:"addTransformationToProcessor",value:function(){for(var e=0;e<this.object.objects.length;e++){var t=this.object.objects[e],n=new hi;n.positions.push(t.position),n.scales.push(t.scale),n.quaternions.push(t.rotation),this.addSingleTransformationToProcessors(n)}}},{key:"clear",value:function(){for(var e=0;e<this.processors.length;e++){this.processors[e].clear()}vn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}($n),Ei=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),t}(En),wi=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),gn(t,[{key:"calUV",value:function(){this.calPosInfo(),this.calEachSideLen();var e=this.object.parentWall.calculaterData,t=Sn.convertToVector3(this.object.parentWall.position),n=this.object.length,i=this.getDoorOrWinRectPoints(this.object.calculaterData.doorOrWindow),r=i[0].distanceTo(t.clone().addVectors(e.cornersVertices[0],t)),o=i[2].distanceTo(t.clone().addVectors(e.cornersVertices[2],t)),a=this.object.calculaterData;if("down"===a.buildType)a.startUVPercent=[r/e.rightSideLength,0,o/e.leftSideLength,0],a.endUVPercent[0]=(r+n)/e.rightSideLength,a.endUVPercent[1]=this.object.height/this.object.parentWall.height,a.endUVPercent[2]=(o+n)/e.leftSideLength,a.endUVPercent[3]=this.object.height/this.object.parentWall.height,this.startUVPercent=a.startUVPercent,this.endUVPercent=a.endUVPercent;else if("up"===a.buildType){var s=this.object.calculaterData.doorOrWindow.suspendPercent,l=Sn.convertToVector3(this.object.calculaterData.doorOrWindow.size).y+this.object.parentWall.height*s;a.startUVPercent=[r/e.rightSideLength,l/this.object.parentWall.height,o/e.leftSideLength,l/this.object.parentWall.height],a.endUVPercent[0]=(r+n)/e.rightSideLength,a.endUVPercent[2]=(o+n)/e.leftSideLength,this.startUVPercent=a.startUVPercent,this.endUVPercent=a.endUVPercent}}},{key:"shouldAddSideIndexes",value:function(e){return!1}}]),t}(Yn),Ti={SubWallCorner:jn,SubStraightManualWall:Yn,SubDoorOrWindowStraightManualWall:wi,DoorOrWindow:Jn,Placement:Xn,StraightManualWall:qn,WallCorner:kn,CombineStraightManualWall:Wn,CombinePlacement:ei,Room:ti,Floor:ni,Ceiling:ii,Roof:ri,CombineFloor:oi,CombineCeiling:ai,CombineRoof:si,CombineModelWall:fi,ModelWall:pi,SubModelWall:di,PlacementGroup:mi,CombinePlacementGroup:gi,FacadeGroup:vi,Facade:yi,PlacementGround:mi,PlacementWall:bi,CombinePlacementWall:_i,CombineDoorOrWindow:xi,FloorPlan:Ei,Outdoors:Ei},Mi=function(e){function t(e){return mn(this,t),bn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return yn(t,e),t}(En),Si="function"==typeof Symbol&&"symbol"===fn(Symbol.iterator)?function(e){return void 0===e?"undefined":fn(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":fn(e)},Ci=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Ai=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Ri=function(){function e(t){Ci(this,e),this._init()}return Ai(e,[{key:"_init",value:function(){this.vertices=[],this.normals=[],this.uvs=[],this.uv2s=[],this.resource=null,this.triangles=[],this.subMeshes=[],this.extraData={}}},{key:"clone",value:function(){var t=new e;for(var n in t.vertices=this.vertices.slice(),t.normals=this.normals.slice(),t.uvs=this.uvs.slice(),t.uv2s=this.uv2s.slice(),t.resource=this.resource,t.triangles=this.triangles.slice(),this.extraData)t.extraData[n]=this.extraData[n].slice();for(var i=0;i<this.subMeshes.length;i++){var r=this.subMeshes[i].clone();t.subMeshes.push(r)}return t}},{key:"clear",value:function(){for(var e=0;e<this.subMeshes.length;e++){this.subMeshes[e].clear()}this._init()}}]),e}(),Pi=function(){function e(){Ci(this,e)}return Ai(e,null,[{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":Si(t)))return t;if(t instanceof Date)return(n=new Date).setTime(t.getTime()),n;if(t instanceof Array|t instanceof Object){var n=t instanceof Array?[]:{};for(var i in t)t.hasOwnProperty(i)&&(n[i]=e.cloneJSObject(t[i]));return n}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"applyQuaternionToVector3",value:function(e,t){if(0!==e[0]||0!==e[1]||0!==e[2]||1!==e[3]){var n=t[0],i=t[1],r=t[2],o=e[0],a=e[1],s=e[2],l=e[3],u=l*n+a*r-s*i,c=l*i+s*n-o*r,h=l*r+o*i-a*n,p=-o*n-a*i-s*r;t[0]=u*l+p*-o+c*-s-h*-a,t[1]=c*l+p*-a+h*-o-u*-s,t[2]=h*l+p*-s+u*-a-c*-o}}}]),e}(),Di=function(){function e(t){Ci(this,e),this._initParams(),this.positions=[],this.normals=[],this.uvs=[],this.uv2s=[],this.uv3s=[],this.indexes=[],this.colors=[],this.alphaIndexes=[],this.material=t,this.groupsArray=null,this.meshes=[],this.transformations=[],this.verticesCount=0,this.uvsCount=0,this.indexesCount=0,this.trianglesCount=0,this.colorsCount=0,this.alphaIndexsCount=0,this.uv2sCount=0,this.uv3sCount=0,this.groupsCountArray=null,this.combineCursor={vertex:0,index:0,uv:0,color:0,alphaIndex:0,uv2:0,uv3:0,groups:[]},this.maxCount=196602}return Ai(e,[{key:"_initParams",value:function(){this.positions=[],this.normals=[],this.uvs=[],this.uv2s=[],this.uv3s=[],this.indexes=[],this.colors=[],this.alphaIndexes=[],this.material=null,this.groups=null,this.meshes=[],this.transformations=[],this.verticesCount=0,this.uvsCount=0,this.indexesCount=0,this.trianglesCount=0,this.colorsCount=0,this.alphaIndexsCount=0,this.uv2sCount=0,this.uv3sCount=0,this.combineCursor=null,this.maxCount=null}},{key:"_initGroups",value:function(){var e=[],t=this.meshObj.geometry;if(t.groups.length>0){var n=this.cloneGroups(t.groups);n.forEach((function(e){e.start+=0})),e=e.concat(n)}}},{key:"cloneGroups",value:function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];t.push(Pi.cloneJSObject(i))}return t}},{key:"getCalculaterMesh",value:function(){this._combine();var e=new Ri;return e.resource=this.material,this.positions.length>0&&(e.vertices=this.positions),this.normals.length&&(e.normals=this.normals),this.uvs.length&&(e.uvs=this.uvs),this.uv2s.length&&(e.uv2s=this.uv2s),this.indexes.length>0&&(e.triangles=this.indexes),this.colors.length&&(e.extraData.color=this.colors),this.uv3s.length>0&&(e.extraData.uv3=this.uv3s),this.alphaIndexes.length>0&&(e.extraData.alphaIndex=this.alphaIndexes),this.groups&&(e.extraData.groups=this.groups),e}},{key:"_combine",value:function(){if(this.indexes=new Uint16Array(this.indexesCount),this.positions=new Float32Array(this.verticesCount),this.normals=new Float32Array(this.verticesCount),this.uvs=new Float32Array(this.uvsCount),0!==this.uv2sCount&&(this.uv2s=new Float32Array(this.uv2sCount)),0!==this.uv3sCount&&(this.uv3s=new Float32Array(this.uv3sCount)),0!==this.colorsCount&&(this.colors=new Uint16Array(this.colorsCount)),0!==this.alphaIndexsCount&&(this.alphaIndexes=new Uint16Array(this.alphaIndexsCount)),this.groupsCountArray)for(var e=0;e<this.groupsCountArray.length;e++){var t=this.groupsCountArray[e];this.combineCursor.groups.push({currentIndex:t.start})}for(var n=0;n<this.transformations.length;n++){var i=this.transformations[n];this._applyTransformation(this.meshes[n],i)}this.groups=this.groupsCountArray}},{key:"_applyTransformation",value:function(e,t,n){this._combineIndexes(e,n),this._combinePositionsAndNormals(e,t),this._combineUVs(e),this._combineColors(e),this._combineAlphaIndexes(e)}},{key:"_combineIndexes",value:function(e){var t=e.geometry.index.array,n=e.geometry.groups;if(n.length>0)for(var i=0;i<n.length;i++){for(var r=n[i],o=r.start,a=r.count,s=this.combineCursor.groups[i],l=0;l<a;l++)this.indexes[s.currentIndex+l]=this.combineCursor.vertex/3+t[o+l];this.combineCursor.groups[i].currentIndex+=a}else{for(var u=0;u<t.length;u++)this.indexes[this.combineCursor.index+u]=this.combineCursor.vertex/3+t[u];this.combineCursor.index+=t.length}}},{key:"_combinePositionsAndNormals",value:function(e,t){var n=null,i=null,r=e.geometry.getAttribute("position");n=r?r.array:[];var o=e.geometry.getAttribute("normal");i=o?o.array:[];for(var a=new Float32Array(3),s=new Float32Array(3),l=0;l<n.length;){s[0]=n[l],s[1]=n[l+1],s[2]=n[l+2],a[0]=i[l],a[1]=i[l+1],a[2]=i[l+2];for(var u=t.positions.length-1;u>-1;u--){var c=t.scales[u],h=t.quaternions[u],p=t.positions[u];1!==c.x&&(s[0]*=c.x),1!==c.y&&(s[1]*=c.y),1!==c.z&&(s[2]*=c.z),Pi.applyQuaternionToVector3(h.toArray(),s),0!==p.x&&(s[0]+=p.x),0!==p.y&&(s[1]+=p.y),0!==p.z&&(s[2]+=p.z),i&&Pi.applyQuaternionToVector3(h.toArray(),a)}this.positions[this.combineCursor.vertex+l]=s[0],this.positions[this.combineCursor.vertex+l+1]=s[1],this.positions[this.combineCursor.vertex+l+2]=s[2],this.normals[this.combineCursor.vertex+l]=a[0],this.normals[this.combineCursor.vertex+l+1]=a[1],this.normals[this.combineCursor.vertex+l+2]=a[2],l+=3}this.combineCursor.vertex+=n.length}},{key:"_combineUVs",value:function(e){var t=e.geometry.getAttribute("uv"),n=null;n=t?t.array:[];for(var i=0;i<n.length;i++)this.uvs[this.combineCursor.uv+i]=n[i];this.combineCursor.uv+=n.length;var r=e.geometry.getAttribute("uv2");if(r){for(var o=r.array,a=0;a<o.length;a++)this.uv2s[this.combineCursor.uv2+a]=o[a];this.combineCursor.uv2+=o.length}var s=e.geometry.getAttribute("uv3");if(s){for(var l=s.array,u=0;u<l.length;u++)this.uv3s[this.combineCursor.uv3+u]=l[u];this.combineCursor.uv3+=l.length}}},{key:"_combineColors",value:function(e){var t=e.geometry.getAttribute("color");if(t){for(var n=t.array,i=0;i<n.length;i++)this.colors[this.combineCursor.color+i]=n[i];this.combineCursor.color+=n.length}}},{key:"_combineAlphaIndexes",value:function(e){var t=e.geometry.getAttribute("alphaIndex");if(t){for(var n=t.array,i=0;i<n.length;i++)this.alphaIndexes[this.combineCursor.alphaIndex+i]=n[i];this.combineCursor.alphaIndex+=n.length}}},{key:"add",value:function(e,t,n){if(this.meshes.push(e),this.transformations.push(t),e.geometry.groups)if(this.groupsCountArray)for(var i=e.geometry.groups,r=0;r<i.length;r++){var o=i[r];this.groupsCountArray[r].count+=o.count,r!==i.length-1&&(this.groupsCountArray[r+1].start=this.groupsCountArray[r].start+this.groupsCountArray[r].count)}else this.groupsCountArray=this.cloneGroups(e.geometry.groups);e.geometry.index&&(this.indexesCount+=e.geometry.index.array.length),e.geometry.getAttribute("position")&&(this.verticesCount+=e.geometry.getAttribute("position").array.length),e.geometry.getAttribute("uv")&&(this.uvsCount+=e.geometry.getAttribute("uv").array.length);var a=e.geometry.getAttribute("color");a&&(this.colorsCount+=a.array.length);var s=e.geometry.getAttribute("alphaIndex");s&&(this.alphaIndexsCount+=s.array.length);var l=e.geometry.getAttribute("uv2");l&&(this.uv2sCount+=l.array.length);var u=e.geometry.getAttribute("uv3");u&&(this.uv3sCount+=u.array.length)}},{key:"isExceed",value:function(e){return this.verticesCount+e>this.maxCount}},{key:"clear",value:function(){this._initParams()}}]),e}(),ki=function(){function e(t){Ci(this,e),this._initParams(),this.material=t,this.mesh=new Ri,this.combineBundleSubMeshes=[],this.currentCombineBundleSubMesh=this._createCombineBundleSubMesh(),this.vertexCount=0}return Ai(e,[{key:"_initParams",value:function(){this.material=null,this.groups=null,this.mesh=null,this.combineBundleSubMeshes=[],this.currentCombineBundleSubMesh=null,this.vertexCount=0}},{key:"_createCombineBundleSubMesh",value:function(){var e=new Di(this.material);return this.combineBundleSubMeshes.push(e),e}},{key:"add",value:function(e,t,n){var i=0;e.geometry.getAttribute("position")&&(i=e.geometry.getAttribute("position").array.length),this.currentCombineBundleSubMesh.isExceed(i)&&(this.currentCombineBundleSubMesh=this._createCombineBundleSubMesh()),this.currentCombineBundleSubMesh.add(e,t,n)}},{key:"getCalculaterMesh",value:function(){for(var e=0;e<this.combineBundleSubMeshes.length;e++){var t=this.combineBundleSubMeshes[e];this.mesh.subMeshes.push(t.getCalculaterMesh())}return this.mesh}},{key:"clear",value:function(){for(var e=0;e<this.combineBundleSubMeshes.length;e++){this.combineBundleSubMeshes[e].clear()}this._initParams()}}]),e}(),ji=function(){function e(){Ci(this,e),this.positions=[],this.scales=[],this.quaternions=[]}return Ai(e,[{key:"clone",value:function(){var t=new e;return t.positions=this.positions.slice(),t.scales=this.scales.slice(),t.quaternions=this.quaternions.slice(),t}}]),e}(),Oi=function(){function e(t){Ci(this,e),this._initParams(),this.bundeObj=t,this.materialMap=new Map}return Ai(e,[{key:"_initParams",value:function(){this.bundeObj=null,this.materialMap=null,this.combineBundleMeshs=[],this.vertexCount=0}},{key:"isExceed",value:function(){return this.vertexCount>6e4}},{key:"combine",value:function(){this._combine(this.bundeObj)}},{key:"_combine",value:function(e,t){if(void 0===t&&(t=new ji),t.scales.push(e.scale),t.positions.push(e.position),t.quaternions.push(e.quaternion),e.isMesh){var n=0;if(e.geometry.getAttribute("position")&&(n=e.geometry.getAttribute("position").array.length),this.vertexCount+=n/3,!this.materialMap.has(e.material)){var i=new ki(e.material);this.materialMap.set(i.material,i),this.combineBundleMeshs.push(i)}this.materialMap.get(e.material).add(e,t,e.groups)}if(0!==e.children.length)for(var r=0;r<e.children.length;r++)this._combine(e.children[r],t.clone())}},{key:"clear",value:function(){for(var e=0;e<this.combineBundleMeshs.length;e++){this.combineBundleMeshs[e].clear()}this._initParams()}}]),e}(),Fi=function(){function e(t){Ci(this,e),this.resource=t.resource,this.mesh=null,this.builderPromise=null,this.isBuilded=!1}return Ai(e,[{key:"build",value:function(){this.isBuilded||(this.combineBundleObj=new Oi(this.resource.model),this.combineBundleObj.combine(),this.combineBundleObj.isExceed()?this.resource.vertexIsExceed=!0:(this.resource.vertexIsExceed=!1,this.changeToCalculaterMesh()),this.isBuilded=!0)}},{key:"changeToCalculaterMesh",value:function(){this.mesh=new Ri;for(var e=this.combineBundleObj.combineBundleMeshs,t=0;t<e.length;t++){var n=e[t];this.mesh.subMeshes.push(n.getCalculaterMesh())}}},{key:"clear",value:function(){this.combineBundleObj&&this.combineBundleObj.clear(),this.combineBundleObj=null}}]),e}(),Bi=function(){function e(){Ci(this,e),this.map={}}return Ai(e,[{key:"getCombineMesh",value:function(e){if(!this.map[e.id]){var t=new Fi({resource:e});t.build(),this.map[e.id]=t.mesh}return this.map[e.id]}},{key:"clear",value:function(){this.map={}}}]),e}(),Li=function(){function e(t){mn(this,e),Un.calculaterManager=this,this.map={},this.resourcCombineManager=new Bi}return gn(e,[{key:"create",value:function(e){var t=e.type;if(this.map[t])return this.map[t];e.resourceCombineManager=this.resourcCombineManager;var n=Ti[t],i=void 0;return i=n?new n(e):new Mi(e),this.map[t]=i,i}},{key:"clear",value:function(){for(var e in this.map)this.map[e].clear();this.map=null}}]),e}(),Ii=new(function(){function e(t){mn(this,e),this._versionMap={0:{0:Li}},this._smallVersionLibs=[[0]],this._bigVersions=[0]}return gn(e,[{key:"getCalculaterManager",value:function(e,t){if(null==e){var n=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][n.length-1]}if(null==t){var i=this._smallVersionLibs[e];return new this._versionMap[e][i.length-1]}var r=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1]))return t>r[r.length-1]?new this._versionMap[e][r.length-1]:new this._versionMap[e][t];console.error("ubuilder calculater builder not support version "+e+"."+t)}}]),e}()),Ni=new(function(){function e(t){mn(this,e)}return gn(e,[{key:"create",value:function(e,t){return Ii.getCalculaterManager(e,t)}},{key:"clear",value:function(){}}]),e}()),Hi="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},zi=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Ui=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Vi=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},qi=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Gi=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},Wi=function(){function e(t){zi(this,e),this._initParams(),this.object=t.object,this.buildPromise=null,this.manager=t.manager}return Ui(e,[{key:"_initParams",value:function(){this.object=null,this.mesh=null,this.buildPromise=null,this.manager=null}},{key:"build",value:function(e){this.object=e;this.mesh=null,this._createMesh(this.object.calculaterMesh);var t=this.object.position,n=this.object.scale,i=this.object.rotation;this.mesh.position.set(t[0],t[1],t[2]),this.mesh.scale.set(n[0],n[1],n[2]),this.mesh.quaternion.set(i[0],i[1],i[2],i[3]),this.object.mesh=this.mesh}},{key:"checkResourcesIsBuilded",value:function(){for(var e=0;e<this.object.resources.length;e++){if(!this.object.resources[e].isBuilded)return!1}return!0}},{key:"resourceDownloadCallback",value:function(e,t){}},{key:"_createMesh",value:function(e){if(this.mesh||(this.mesh=new THREE.Object3D),e){if(e.vertices.length>0){var t=e.vertices,n=e.normals,i=e.triangles,r=e.uvs,o=e.uv2s,a=new THREE.BufferGeometry;a.setIndex(new THREE.BufferAttribute(i,1)),a.setAttribute("position",new THREE.BufferAttribute(t,3)),a.setAttribute("normal",new THREE.BufferAttribute(n,3)),a.setAttribute("uv",new THREE.BufferAttribute(r,2)),o.length>0&&a.setAttribute("uv2",new THREE.BufferAttribute(o,2));var s=e.extraData;s.color&&a.setAttribute("color",new THREE.BufferAttribute(s.color,4)),s.alphaIndex&&a.setAttribute("alphaIndex",new THREE.BufferAttribute(s.alphaIndex,1)),s.groups&&(a.groups=s.groups);var l=this._getMaterial(e),u=new THREE.Mesh(a,l);this.mesh.add(u)}if(e.subMeshes.length>0)for(var c=0;c<e.subMeshes.length;c++){var h=e.subMeshes[c];this._createMesh(h)}}}},{key:"_getMaterial",value:function(e){return e.resource.material}},{key:"_dispose",value:function(e){if(e instanceof THREE.Mesh){var t=e;if(t){var n=t.material,i=t.geometry;t.isDestory=!0,n&&(this._disposeMaterial(n),t.material=null),i&&(i.isDestory=!0,i.dispose(),t.geometry=null)}}if(e)for(var r=e.children,o=0;o<r.length;o++){var a=r[o];this._dispose(a)}}},{key:"_disposeMaterial",value:function(e){if(e instanceof Array)for(var t=0;t<e.length;t++){var n=e[t];this._disposeMaterial(n)}else e.isDestory=!0,e.dispose()}},{key:"clear",value:function(){this.mesh&&this._dispose(this.mesh),this._initParams()}}]),e}(),Xi=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),Ui(t,[{key:"_getMaterial",value:function(e){return e.resource.wallMaterial}}]),t}(Wi),Ji=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),Ui(t,[{key:"_getMaterial",value:function(e){return e.resource.wallMaterial}}]),t}(Wi),Yi=function(){function e(){zi(this,e)}return Ui(e,null,[{key:"uuid",value:function(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var n=e.join("");return n}},{key:"approximatelyNumberEqual",value:function(e,t,n){var i=1e-4;return void 0!==n&&(i=n),Math.abs(e-t)<i}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),n={};e.traverse((function(e){e.isSkinnedMesh&&(n[e.name]=e)}));var i={},r={};t.traverse((function(e){e.isBone&&(i[e.name]=e),e.isSkinnedMesh&&(r[e.name]=e)}));var o=!1;for(var a in n){o=!0;for(var s=n[a].skeleton,l=r[a],u=[],c=0;c<s.bones.length;++c){var h=i[s.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,s.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":Hi(t)))return t;if(t instanceof Date)return(n=new Date).setTime(t.getTime()),n;if(t instanceof Array|t instanceof Object){var n=t instanceof Array?[]:{};for(var i in t)t.hasOwnProperty(i)&&(n[i]=e.cloneJSObject(t[i]));return n}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}},{key:"calTwoPositionLength",value:function(t,n){var i=e.subPosition(t,n);return i=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],Math.sqrt(i)}},{key:"subPosition",value:function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}},{key:"normalizeDirection",value:function(t){var n=e.calTwoPositionLength([0,0,0],t);if(1===n)return t;var i=t;return 0===n?(i[0]=0,i[1]=0,i[2]=0,i):(n=1/n,i[0]*=n,i[1]*=n,i[2]*=n,i)}},{key:"getFloorUV2s",value:function(e,t,n){e.parent.parent.allRoomsBox2||e.parent.parent.meshBuilder.calAllRoomsBox2(e.parent.parent);var i=e.parent.parent.allRoomsBox2,r=e.parent.position,o=new THREE.Vector2;i.getSize(o);for(var a=t.vertices,s=[],l=0;l<a.length;l++){var u,c,h=a[l];n?(u=(h.x+r[0]-i.min.x)/o.x,c=(-h.y+r[2]-i.min.y)/o.y):(u=(h.x-i.min.x)/o.x,c=(-h.y-i.min.y)/o.y),s.push(new THREE.Vector2(parseFloat(u.toFixed(2)),1-parseFloat(c.toFixed(2))))}return s}},{key:"getShapePath",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.parent,r=[0,0,0];t&&(r=i.position);for(var o=i.points,a=[],s=0;s<o.length;s++){var l=o[s];n?a.push(new THREE.Vector2(l[0]+r[0],-(l[2]+r[2]))):a.push(new THREE.Vector2(l[0]+r[0],l[2]+r[2]))}return a}},{key:"getHolesPath",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.parent,r=i.holes,o=[0,0,0];t&&(o=i.position);for(var a=[],s=0;s<r.length;s++){for(var l=r[s],u=l.length,c=[],h=0;h<u;h++){var p=l[h];n?c.push(new THREE.Vector2(p[0]+o[0],-(p[2]+o[2]))):c.push(new THREE.Vector2(p[0]+o[0],p[2]+o[2]))}a.push(c)}return a}}]),e}(),Qi=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),Ui(t,[{key:"_createMesh",value:function(){this.instanceModel(),this.object.mesh=this.mesh}},{key:"instanceModel",value:function(){this.mesh=Yi.clone(this.object.resource.model),this.hasSkin=this.mesh.hasSkin,this.mesh.name="placement",this.mesh.visible=this.object.visible,this.mesh.name="plc"+this.object.id,null!==this.object.renderMode&&this.changeRenderMode(this.mesh),this.object.customTextureResource&&this.changeWithCustomTexture(this.mesh),this.object.customColor&&this.changeWithCustomColor(this.mesh)}},{key:"changeRenderMode",value:function(e){if(e instanceof THREE.Mesh&&(e.material.color=this.object.customColor,null!==this.object.renderMode))switch(this.object.renderMode){case 1:e.material.transparent=!1,e.material.alphaTest=.5;break;case 3:case 2:e.material.transparent=!0;break;default:console.error("can not find renderMode "+this.object.renderMode)}for(var t=0;t<e.children.length;t++){var n=e.children[t];this.changeRenderMode(n)}}},{key:"changeWithCustomColor",value:function(e){e instanceof THREE.Mesh&&(e.material.color=this.object.customColor,null!==this.object.opacity&&(e.material.opacity=this.object.opacity,e.material.transparent=!0));for(var t=0;t<e.children.length;t++){var n=e.children[t];this.changeWithCustomColor(n)}}},{key:"changeWithCustomTexture",value:function(e){e instanceof THREE.Mesh&&(e.material.map=this.object.customTextureResource.texture);for(var t=0;t<e.children.length;t++){var n=e.children[t];this.changeWithCustomTexture(n)}}}]),t}(Wi),Zi=0,Ki=1,$i=2,er=3,tr=0,nr=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),Ui(t,[{key:"_createMesh",value:function(e){this.instanceModel(),this.changeOpenDirection()}},{key:"getOpenController",value:function(){return this.mesh?this.mesh.getObjectByName("Controller"):null}},{key:"isSingleOpen",value:function(){var e=this.getOpenController();return!!e&&1===e.children.length}},{key:"changeOpenDirection",value:function(){(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI);var e=this.getOpenController(),t=this.mesh.getObjectByName("RootNode");if(t&&e)if(this.isSingleOpen())switch(this.object.openDirIndex){case Zi:t.rotateY(Math.PI),e.scale.set(-1,1,1);break;case Ki:t.rotateY(Math.PI);break;case $i:break;case er:e.scale.set(-1,1,1)}else switch(this.object.openDirIndex){case tr:t.rotateY(Math.PI)}}},{key:"initModelSize",value:function(){this.object.modelSize=this.object.resource.modelSize,this.object.resource.model&&(this.object.size=[this.modelSize.x*this.scale.x,this.modelSize.y*this.scale.y,this.modelSize.z*this.scale.z])}}]),t}(Qi),ir=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),Ui(t,[{key:"_getMaterial",value:function(e){return e.resource}},{key:"_createMesh",value:function(e){if(this.object.resource.vertexIsExceed){this.mesh=new THREE.Object3D;for(var n=this.object.objects,i=0;i<n.length;i++){var r=n[i];r.meshBuilder.build(r),this.mesh.add(r.meshBuilder.mesh)}}else Vi(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this,e)}}]),t}(Wi),rr=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),Ui(t,[{key:"_createMesh",value:function(e){var t=this.object.objects,n=this.object.resource.roomMaterial.clone();n.side=THREE.DoubleSide;for(var i=new THREE.Geometry,r=0;r<t.length;r++){var o=t[r],a=this._calGeometry(o);this.setUV2s(o,a),i.merge(a)}var s=new THREE.Mesh(i,n);s.name="combine",this.combineMesh=s,this.combineMesh.name="floor",this.mesh=this.combineMesh}},{key:"_calGeometry",value:function(e){e.parent;for(var t,n=this._getPointsPath(e),i=this._getHolesPath(e),r=new THREE.Vector3,o=0;o<n.length;o++){var a=n[o];r.x+=a.x,r.z+=a.y}if(r.x/=n.length,r.z/=n.length,t=0===n.length?new THREE.Shape:new THREE.Shape(n),i)for(o=0;o<i.length;o++){var s=i[o];t.holes.push(new THREE.Path(s))}var l=new THREE.ShapeGeometry(t);for(o=0;o<l.faceVertexUvs.length;o++)for(var u=l.faceVertexUvs[o],c=0;c<u.length;c++)for(var h=u[c],p=0;p<h.length;p++){var d=h[p],f=void 0,m=void 0;f=d.x-r.x,m=d.y-r.z,e.blockSize&&(f/=e.blockSize[0],m/=e.blockSize[1]),d.set(f,m)}return l.uvsNeedUpdate=!0,this.rotateUV(e,l),l}},{key:"rotateUV",value:function(e,t){for(var n=e.blockAngle*Math.PI/180,i=new THREE.Vector2(.5,.5),r=t.faceVertexUvs[0],o=0;o<r.length;o++)for(var a=r[o],s=0;s<a.length;s++){var l=a[s];l.sub(i),(l=new THREE.Vector2(l.x*Math.cos(n)-l.y*Math.sin(n),l.x*Math.sin(n)+l.y*Math.cos(n))).add(i),a[s]=l}}},{key:"_getPointsPath",value:function(e){return Yi.getShapePath(e,!0)}},{key:"_getHolesPath",value:function(e){return Yi.getHolesPath(e,!0)}},{key:"setUV2s",value:function(e,t){for(var n=Yi.getFloorUV2s(e,t,!1),i=t.faces,r=[],o=0;o<i.length;o++){var a=i[o],s=[n[a.a],n[a.b],n[a.c]];r.push(s)}t.faceVertexUvs[1]=r}}]),t}(Wi),or=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),Ui(t,[{key:"_createMesh",value:function(e){for(var t=this.object.objects,n=this.object.resource.roomMaterial,i=new THREE.Geometry,r=0;r<t.length;r++){var o=t[r],a=this._calGeometry(o);i.merge(a)}var s=new THREE.Mesh(i,n);s.name="combine",this.combineMesh=s,this.combineMesh.name="floor",this.mesh=this.combineMesh}},{key:"_getPointsPath",value:function(e){return Yi.getShapePath(e,!0,!1)}},{key:"_getHolesPath",value:function(e){return Yi.getHolesPath(e,!0,!1)}}]),t}(rr),ar=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),Ui(t,[{key:"_createMesh",value:function(e){for(var t=this.object.objects,n=this.object.resource.roomMaterial,i=new THREE.Geometry,r=0;r<t.length;r++){var o=t[r],a=this._calGeometry(o);i.merge(a)}var s=new THREE.Mesh(i,n);s.name="combine",this.combineMesh=s,this.combineMesh.name="floor",this.mesh=this.combineMesh}}]),t}(rr),sr=function(e){function t(e){zi(this,t);var n=Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.shapePath=[],n.reverseZShapPath=[],n.holePaths=[],n.reverseZHolePaths=[],n}return qi(t,e),Ui(t,[{key:"_initParams",value:function(){Vi(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.shapePath=null,this.reverseZShapPath=null,this.holePaths=null,this.reverseZHolePaths=null}},{key:"_getMaterial",value:function(e){return e.resource.roomMaterial}},{key:"_createMesh",value:function(e){var t=this.object.parent;this._calGeometry();var n=this.geometry,i=null;null===this.object.height&&(this.object.height=this.object.DefaultHeight),(i=this.object.resource.roomMaterial).side=THREE.DoubleSide,i.defines=i.defines||{},i.defines.FLOOR_AO=!0,this.mesh=new THREE.Mesh(n,i),this.mesh.name="floor",this.mesh.position.y=this.object.height,this.mesh.rotateX(-Math.PI/2),this.mesh.visible=this.object.visible,this.mesh.roomID=t.id,this.object.rotation=this.mesh.quaternion.toArray(),this.object.position=this.mesh.position.toArray(),this.object.scale=this.mesh.scale.toArray()}},{key:"_calGeometry",value:function(){this.object.parent;for(var e,t=this._getPointsPath(this.object),n=this._getHolesPath(this.object),i=new THREE.Vector3,r=0;r<t.length;r++){var o=t[r];i.x+=o.x,i.z+=o.y}if(i.x/=t.length,i.z/=t.length,e=0===t.length?new THREE.Shape:new THREE.Shape(t),n.length>0)for(r=0;r<n.length;r++){var a=n[r];e.holes.push(new THREE.Path(a))}var s=new THREE.ShapeGeometry(e);for(r=0;r<s.faceVertexUvs.length;r++)for(var l=s.faceVertexUvs[r],u=0;u<l.length;u++)for(var c=l[u],h=0;h<c.length;h++){var p=c[h],d=void 0,f=void 0;d=p.x-i.x,f=p.y-i.z,this.object.blockSize&&(d/=this.object.blockSize[0],f/=this.object.blockSize[1]),p.set(d,f)}s.uvsNeedUpdate=!0,this.rotateUV(s),this.geometry=s,this.object.parent.parent&&this.setUV2s(s)}},{key:"setUV2s",value:function(e){for(var t=Yi.getFloorUV2s(this.object,e,!0),n=e.faces,i=[],r=0;r<n.length;r++){var o=n[r],a=[t[o.a],t[o.b],t[o.c]];i.push(a)}e.faceVertexUvs[1]=i}},{key:"rotateUV",value:function(e){for(var t=this.object.blockAngle*Math.PI/180,n=new THREE.Vector2(.5,.5),i=e.faceVertexUvs[0],r=0;r<i.length;r++)for(var o=i[r],a=0;a<o.length;a++){var s=o[a];s.sub(n),(s=new THREE.Vector2(s.x*Math.cos(t)-s.y*Math.sin(t),s.x*Math.sin(t)+s.y*Math.cos(t))).add(n),o[a]=s}}},{key:"_getPointsPath",value:function(e){return Yi.getShapePath(e,!1)}},{key:"_getHolesPath",value:function(e){return Yi.getHolesPath(e,!1)}}]),t}(Wi),lr=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),Ui(t,[{key:"_getMaterial",value:function(e){return e.resource.roomMaterial}},{key:"_createMesh",value:function(e){var t=this.object.parent;this._calGeometry();var n=this.object.resource.roomMaterial;if(this.mesh=new THREE.Mesh(this.geometry,n),this.mesh.name="ceiling",this.mesh.rotateX(Math.PI/2),null===this.object.height){var i=2.9;t.parent&&(i=t.parent.height),this.object.height=i}this.mesh.position.y=this.object.height,this.mesh.visible=this.object.visible,this.object.rotation=this.mesh.quaternion.toArray(),this.object.position=this.mesh.position.toArray(),this.object.scale=this.mesh.scale.toArray()}},{key:"_getPointsPath",value:function(e){return Yi.getShapePath(e,!1,!1)}},{key:"_getHolesPath",value:function(e){return Yi.getHolesPath(e,!1,!1)}}]),t}(sr),ur=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),Ui(t,[{key:"_getMaterial",value:function(e){return e.resource.roomMaterial}},{key:"_createMesh",value:function(e){var t=this.object.parent;this._calGeometry();var n;if(n=this.object.resource.roomMaterial,this.mesh=new THREE.Mesh(this.geometry,n),null===this.object.height){var i=3;t.parent&&(i=t.parent.height),this.object.height=i}this.mesh.position.y=this.object.height+.001,this.mesh.name="roof",this.mesh.rotateX(-Math.PI/2),this.mesh.visible=this.object.visible,this.mesh.name="roof"+t.id,this.object.rotation=this.mesh.quaternion.toArray(),this.object.position=this.mesh.position.toArray(),this.object.scale=this.mesh.scale.toArray()}}]),t}(sr),cr=function(e){function t(e){zi(this,t);var n=Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.shapePath=[],n.reverseZShapPath=[],n.holePaths=[],n.reverseZHolePaths=[],n.isCalculaterPoints=!1,n}return qi(t,e),Ui(t,[{key:"_initParams",value:function(){Vi(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.shapePath=null,this.reverseZShapPath=null,this.holePaths=null,this.reverseZHolePaths=null,this.isCalculaterPoints=null}},{key:"calculaterPoints",value:function(){this._initShapePathPoints(),this._initShapeHolePoints(),this.isCalculaterPoints=!0}},{key:"_initShapePathPoints",value:function(){var e=this.object.points;this.shapePath.length=0,this.reverseZShapPath.length=0;for(var t=0;t<e.length;t++){var n=e[t];this.shapePath.push(new THREE.Vector2(n[0],n[2])),this.reverseZShapPath.push(new THREE.Vector2(n[0],-n[2]))}this.object.floor.meshBuilder.shapePath=this.reverseZShapPath,this.object.ceiling&&(this.object.ceiling.meshBuilder.shapePath=this.shapePath),this.object.roof&&(this.object.roof.meshBuilder.shapePath=this.reverseZShapPath)}},{key:"_initShapeHolePoints",value:function(){var e=this.object.holes;this.holePaths.length=0,this.reverseZHolePaths.length=0;for(var t=0;t<e.length;t++){for(var n=e[t],i=n.length,r=[],o=[],a=0;a<i;a++){var s=n[a];r.push(new THREE.Vector2(s[0],s[2])),o.push(new THREE.Vector2(s[0],-s[2]))}this.holePaths.push(r),this.reverseZHolePaths.push(o)}this.object.floor.meshBuilder.holePaths=this.reverseZHolePaths,this.object.ceiling&&(this.object.ceiling.meshBuilder.holePaths=this.holePaths),this.object.roof&&(this.object.roof.meshBuilder.holePaths=this.reverseZHolePaths)}}]),t}(Wi),hr=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),t}(Wi),pr=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),Ui(t,[{key:"_getMaterial",value:function(e){return e.resource}}]),t}(Wi),dr=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),t}(Wi),fr=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),Ui(t,[{key:"_getMaterial",value:function(e){return e.resource}},{key:"_createMesh",value:function(e){if(this._isVertexExceed()){this.mesh=new THREE.Object3D;for(var n=this.object.objects,i=0;i<n.length;i++){var r=n[i];r.build(),this.mesh.add(this._getObjMesh(r))}}else Vi(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this,e)}},{key:"_getObjMesh",value:function(e){for(var t=e.children,n=0;n<t.length;n++){var i=t[n];e.mesh.add(this._getObjMesh(i))}return e.mesh}},{key:"_isVertexExceed",value:function(){for(var e=0;e<this.object.resources.length;e++){if(this.object.resources[e].vertexIsExceed)return!0}return!1}}]),t}(Wi),mr=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),t}(Qi),gr=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),t}(dr),vr=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),t}(Qi),yr=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),t}(Qi),br=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),Ui(t,[{key:"_getMaterial",value:function(e){return e.resource}}]),t}(Wi),_r=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),Ui(t,[{key:"_getMaterial",value:function(e){return e.resource}}]),t}(Wi),xr=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),Ui(t,[{key:"_initParams",value:function(){Vi(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._allRoomsBox2=null}},{key:"calAllRoomsBox2",value:function(e){e.allRoomsBox2||(e.allRoomsBox2=this._calAllRoomsBox2(e))}},{key:"_calAllRoomsBox2",value:function(e){var t=new THREE.Box2,n=e.typeToChildren.Room;if(n)for(var i=0;i<n.length;i++){var r=n[i];this._addRoomToCalAllRoomsBox2(t,r)}var o=e.typeToChildren.CombineFloor;if(o)for(var a=0;a<o.length;a++)for(var s=o[a],l=0;l<s.objects.length;l++){var u=s.objects[l];this._addRoomToCalAllRoomsBox2(t,u.parent)}return t}},{key:"_addRoomToCalAllRoomsBox2",value:function(e,t){for(var n=this._getFloorPosition(t),i=t.points,r=0;r<i.length;r++){var o=new THREE.Vector2(i[r][0],i[r][2]);o.x+=n[0],o.y+=n[2],e.expandByPoint(o)}}},{key:"_getFloorPosition",value:function(e){return e.position.slice()}}]),t}(Wi),Er={DoorOrWindow:nr,Placement:Qi,StraightManualWall:Xi,CombineStraightManualWall:Ji,CombinePlacement:ir,CombineCeiling:or,CombineRoof:ar,CombineFloor:rr,CombineModelWall:pr,FloorPlan:xr,Outdoors:xr,Ceiling:lr,Floor:sr,Roof:ur,Room:cr,ModelWall:hr,PlacementGroup:dr,CombinePlacementGroup:fr,Facade:mr,FacadeGroup:gr,PlacementWall:vr,PlacementGround:yr,CombinePlacementWall:br,CombineDoorOrWindow:_r,VideoProbe:Qi},wr=function(e){function t(e){return zi(this,t),Gi(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return qi(t,e),Ui(t,[{key:"_createMesh",value:function(e){this.mesh=new THREE.Object3D;var t=this.object.position,n=this.object.scale,i=this.object.rotation;this.mesh.position.set(t[0],t[1],t[2]),this.mesh.scale.set(n[0],n[1],n[2]),this.mesh.quaternion.set(i[0],i[1],i[2],i[3]),this.object.mesh=this.mesh}}]),t}(Wi),Tr=function(){function e(t){zi(this,e),this.meshBuilderMap={}}return Ui(e,[{key:"create",value:function(e){var t=e.type;if(this.meshBuilderMap[t])return this.meshBuilderMap[t];var n=Er[t];e.manager=this;var i=void 0;return i=n?new n(e):new wr(e),this.meshBuilderMap[t]=i,i}},{key:"clear",value:function(){for(var e in this.meshBuilderMap)this.meshBuilderMap[e].clear();this.meshBuilderMap=null}}]),e}(),Mr=new(function(){function e(t){zi(this,e),this._versionMap={0:{0:Tr}},this._smallVersionLibs=[[0]],this._bigVersions=[0]}return Ui(e,[{key:"getManager",value:function(e,t){if(null==e){var n=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][n.length-1]}if(null==t){var i=this._smallVersionLibs[e];return new this._versionMap[e][i.length-1]}var r=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1]))return t>r[r.length-1]?new this._versionMap[e][r.length-1]:new this._versionMap[e][t];console.error("ubuilder meshBuilder  not support version "+e+"."+t)}}]),e}()),Sr=new(function(){function e(t){zi(this,e)}return Ui(e,[{key:"create",value:function(e,t){return Mr.getManager(e,t)}},{key:"clear",value:function(){}}]),e}()),Cr="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},Ar=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Rr=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Pr=function(){function e(t){Ar(this,e),this._init()}return Rr(e,[{key:"_init",value:function(){this.vertices=[],this.normals=[],this.uvs=[],this.uv2s=[],this.resource=null,this.triangles=[],this.subMeshes=[],this.extraData={}}},{key:"clone",value:function(){var t=new e;for(var n in t.vertices=this.vertices.slice(),t.normals=this.normals.slice(),t.uvs=this.uvs.slice(),t.uv2s=this.uv2s.slice(),t.resource=this.resource,t.triangles=this.triangles.slice(),this.extraData)t.extraData[n]=this.extraData[n].slice();for(var i=0;i<this.subMeshes.length;i++){var r=this.subMeshes[i].clone();t.subMeshes.push(r)}return t}},{key:"clear",value:function(){for(var e=0;e<this.subMeshes.length;e++){this.subMeshes[e].clear()}this._init()}}]),e}(),Dr=function(){function e(){Ar(this,e)}return Rr(e,null,[{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":Cr(t)))return t;if(t instanceof Date)return(n=new Date).setTime(t.getTime()),n;if(t instanceof Array|t instanceof Object){var n=t instanceof Array?[]:{};for(var i in t)t.hasOwnProperty(i)&&(n[i]=e.cloneJSObject(t[i]));return n}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"applyQuaternionToVector3",value:function(e,t){if(0!==e[0]||0!==e[1]||0!==e[2]||1!==e[3]){var n=t[0],i=t[1],r=t[2],o=e[0],a=e[1],s=e[2],l=e[3],u=l*n+a*r-s*i,c=l*i+s*n-o*r,h=l*r+o*i-a*n,p=-o*n-a*i-s*r;t[0]=u*l+p*-o+c*-s-h*-a,t[1]=c*l+p*-a+h*-o-u*-s,t[2]=h*l+p*-s+u*-a-c*-o}}}]),e}(),kr=function(){function e(t){Ar(this,e),this._initParams(),this.positions=[],this.normals=[],this.uvs=[],this.uv2s=[],this.uv3s=[],this.indexes=[],this.colors=[],this.alphaIndexes=[],this.material=t,this.groupsArray=null,this.meshes=[],this.transformations=[],this.verticesCount=0,this.uvsCount=0,this.indexesCount=0,this.trianglesCount=0,this.colorsCount=0,this.alphaIndexsCount=0,this.uv2sCount=0,this.uv3sCount=0,this.groupsCountArray=null,this.combineCursor={vertex:0,index:0,uv:0,color:0,alphaIndex:0,uv2:0,uv3:0,groups:[]},this.maxCount=196602}return Rr(e,[{key:"_initParams",value:function(){this.positions=[],this.normals=[],this.uvs=[],this.uv2s=[],this.uv3s=[],this.indexes=[],this.colors=[],this.alphaIndexes=[],this.material=null,this.groups=null,this.meshes=[],this.transformations=[],this.verticesCount=0,this.uvsCount=0,this.indexesCount=0,this.trianglesCount=0,this.colorsCount=0,this.alphaIndexsCount=0,this.uv2sCount=0,this.uv3sCount=0,this.combineCursor=null,this.maxCount=null}},{key:"_initGroups",value:function(){var e=[],t=this.meshObj.geometry;if(t.groups.length>0){var n=this.cloneGroups(t.groups);n.forEach((function(e){e.start+=0})),e=e.concat(n)}}},{key:"cloneGroups",value:function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];t.push(Dr.cloneJSObject(i))}return t}},{key:"getCalculaterMesh",value:function(){this._combine();var e=new Pr;return e.resource=this.material,this.positions.length>0&&(e.vertices=this.positions),this.normals.length&&(e.normals=this.normals),this.uvs.length&&(e.uvs=this.uvs),this.uv2s.length&&(e.uv2s=this.uv2s),this.indexes.length>0&&(e.triangles=this.indexes),this.colors.length&&(e.extraData.color=this.colors),this.uv3s.length>0&&(e.extraData.uv3=this.uv3s),this.alphaIndexes.length>0&&(e.extraData.alphaIndex=this.alphaIndexes),this.groups&&(e.extraData.groups=this.groups),e}},{key:"_combine",value:function(){if(this.indexes=new Uint16Array(this.indexesCount),this.positions=new Float32Array(this.verticesCount),this.normals=new Float32Array(this.verticesCount),this.uvs=new Float32Array(this.uvsCount),0!==this.uv2sCount&&(this.uv2s=new Float32Array(this.uv2sCount)),0!==this.uv3sCount&&(this.uv3s=new Float32Array(this.uv3sCount)),0!==this.colorsCount&&(this.colors=new Uint16Array(this.colorsCount)),0!==this.alphaIndexsCount&&(this.alphaIndexes=new Uint16Array(this.alphaIndexsCount)),this.groupsCountArray)for(var e=0;e<this.groupsCountArray.length;e++){var t=this.groupsCountArray[e];this.combineCursor.groups.push({currentIndex:t.start})}for(var n=0;n<this.transformations.length;n++){var i=this.transformations[n];this._applyTransformation(this.meshes[n],i)}this.groups=this.groupsCountArray}},{key:"_applyTransformation",value:function(e,t,n){this._combineIndexes(e,n),this._combinePositionsAndNormals(e,t),this._combineUVs(e),this._combineColors(e),this._combineAlphaIndexes(e)}},{key:"_combineIndexes",value:function(e){var t=e.geometry.index.array,n=e.geometry.groups;if(n.length>0)for(var i=0;i<n.length;i++){for(var r=n[i],o=r.start,a=r.count,s=this.combineCursor.groups[i],l=0;l<a;l++)this.indexes[s.currentIndex+l]=this.combineCursor.vertex/3+t[o+l];this.combineCursor.groups[i].currentIndex+=a}else{for(var u=0;u<t.length;u++)this.indexes[this.combineCursor.index+u]=this.combineCursor.vertex/3+t[u];this.combineCursor.index+=t.length}}},{key:"_combinePositionsAndNormals",value:function(e,t){var n=null,i=null,r=e.geometry.getAttribute("position");n=r?r.array:[];var o=e.geometry.getAttribute("normal");i=o?o.array:[];for(var a=new Float32Array(3),s=new Float32Array(3),l=0;l<n.length;){s[0]=n[l],s[1]=n[l+1],s[2]=n[l+2],a[0]=i[l],a[1]=i[l+1],a[2]=i[l+2];for(var u=t.positions.length-1;u>-1;u--){var c=t.scales[u],h=t.quaternions[u],p=t.positions[u];1!==c.x&&(s[0]*=c.x),1!==c.y&&(s[1]*=c.y),1!==c.z&&(s[2]*=c.z),Dr.applyQuaternionToVector3(h.toArray(),s),0!==p.x&&(s[0]+=p.x),0!==p.y&&(s[1]+=p.y),0!==p.z&&(s[2]+=p.z),i&&Dr.applyQuaternionToVector3(h.toArray(),a)}this.positions[this.combineCursor.vertex+l]=s[0],this.positions[this.combineCursor.vertex+l+1]=s[1],this.positions[this.combineCursor.vertex+l+2]=s[2],this.normals[this.combineCursor.vertex+l]=a[0],this.normals[this.combineCursor.vertex+l+1]=a[1],this.normals[this.combineCursor.vertex+l+2]=a[2],l+=3}this.combineCursor.vertex+=n.length}},{key:"_combineUVs",value:function(e){var t=e.geometry.getAttribute("uv"),n=null;n=t?t.array:[];for(var i=0;i<n.length;i++)this.uvs[this.combineCursor.uv+i]=n[i];this.combineCursor.uv+=n.length;var r=e.geometry.getAttribute("uv2");if(r){for(var o=r.array,a=0;a<o.length;a++)this.uv2s[this.combineCursor.uv2+a]=o[a];this.combineCursor.uv2+=o.length}var s=e.geometry.getAttribute("uv3");if(s){for(var l=s.array,u=0;u<l.length;u++)this.uv3s[this.combineCursor.uv3+u]=l[u];this.combineCursor.uv3+=l.length}}},{key:"_combineColors",value:function(e){var t=e.geometry.getAttribute("color");if(t){for(var n=t.array,i=0;i<n.length;i++)this.colors[this.combineCursor.color+i]=n[i];this.combineCursor.color+=n.length}}},{key:"_combineAlphaIndexes",value:function(e){var t=e.geometry.getAttribute("alphaIndex");if(t){for(var n=t.array,i=0;i<n.length;i++)this.alphaIndexes[this.combineCursor.alphaIndex+i]=n[i];this.combineCursor.alphaIndex+=n.length}}},{key:"add",value:function(e,t,n){if(this.meshes.push(e),this.transformations.push(t),e.geometry.groups)if(this.groupsCountArray)for(var i=e.geometry.groups,r=0;r<i.length;r++){var o=i[r];this.groupsCountArray[r].count+=o.count,r!==i.length-1&&(this.groupsCountArray[r+1].start=this.groupsCountArray[r].start+this.groupsCountArray[r].count)}else this.groupsCountArray=this.cloneGroups(e.geometry.groups);e.geometry.index&&(this.indexesCount+=e.geometry.index.array.length),e.geometry.getAttribute("position")&&(this.verticesCount+=e.geometry.getAttribute("position").array.length),e.geometry.getAttribute("uv")&&(this.uvsCount+=e.geometry.getAttribute("uv").array.length);var a=e.geometry.getAttribute("color");a&&(this.colorsCount+=a.array.length);var s=e.geometry.getAttribute("alphaIndex");s&&(this.alphaIndexsCount+=s.array.length);var l=e.geometry.getAttribute("uv2");l&&(this.uv2sCount+=l.array.length);var u=e.geometry.getAttribute("uv3");u&&(this.uv3sCount+=u.array.length)}},{key:"isExceed",value:function(e){return this.verticesCount+e>this.maxCount}},{key:"clear",value:function(){this._initParams()}}]),e}(),jr=function(){function e(t){Ar(this,e),this._initParams(),this.material=t,this.mesh=new Pr,this.combineBundleSubMeshes=[],this.currentCombineBundleSubMesh=this._createCombineBundleSubMesh(),this.vertexCount=0}return Rr(e,[{key:"_initParams",value:function(){this.material=null,this.groups=null,this.mesh=null,this.combineBundleSubMeshes=[],this.currentCombineBundleSubMesh=null,this.vertexCount=0}},{key:"_createCombineBundleSubMesh",value:function(){var e=new kr(this.material);return this.combineBundleSubMeshes.push(e),e}},{key:"add",value:function(e,t,n){var i=0;e.geometry.getAttribute("position")&&(i=e.geometry.getAttribute("position").array.length),this.currentCombineBundleSubMesh.isExceed(i)&&(this.currentCombineBundleSubMesh=this._createCombineBundleSubMesh()),this.currentCombineBundleSubMesh.add(e,t,n)}},{key:"getCalculaterMesh",value:function(){for(var e=0;e<this.combineBundleSubMeshes.length;e++){var t=this.combineBundleSubMeshes[e];this.mesh.subMeshes.push(t.getCalculaterMesh())}return this.mesh}},{key:"clear",value:function(){for(var e=0;e<this.combineBundleSubMeshes.length;e++){this.combineBundleSubMeshes[e].clear()}this._initParams()}}]),e}(),Or=function(){function e(){Ar(this,e),this.positions=[],this.scales=[],this.quaternions=[]}return Rr(e,[{key:"clone",value:function(){var t=new e;return t.positions=this.positions.slice(),t.scales=this.scales.slice(),t.quaternions=this.quaternions.slice(),t}}]),e}(),Fr=function(){function e(t){Ar(this,e),this._initParams(),this.bundeObj=t,this.materialMap=new Map}return Rr(e,[{key:"_initParams",value:function(){this.bundeObj=null,this.materialMap=null,this.combineBundleMeshs=[],this.vertexCount=0}},{key:"isExceed",value:function(){return this.vertexCount>6e4}},{key:"combine",value:function(){this._combine(this.bundeObj)}},{key:"_combine",value:function(e,t){if(void 0===t&&(t=new Or),t.scales.push(e.scale),t.positions.push(e.position),t.quaternions.push(e.quaternion),e.isMesh){var n=0;if(e.geometry.getAttribute("position")&&(n=e.geometry.getAttribute("position").array.length),this.vertexCount+=n/3,!this.materialMap.has(e.material)){var i=new jr(e.material);this.materialMap.set(i.material,i),this.combineBundleMeshs.push(i)}this.materialMap.get(e.material).add(e,t,e.groups)}if(0!==e.children.length)for(var r=0;r<e.children.length;r++)this._combine(e.children[r],t.clone())}},{key:"clear",value:function(){for(var e=0;e<this.combineBundleMeshs.length;e++){this.combineBundleMeshs[e].clear()}this._initParams()}}]),e}(),Br=function(){function e(t){Ar(this,e),this.resource=t.resource,this.mesh=null,this.builderPromise=null,this.isBuilded=!1}return Rr(e,[{key:"build",value:function(){this.isBuilded||(this.combineBundleObj=new Fr(this.resource.model),this.combineBundleObj.combine(),this.combineBundleObj.isExceed()?this.resource.vertexIsExceed=!0:(this.resource.vertexIsExceed=!1,this.changeToCalculaterMesh()),this.isBuilded=!0)}},{key:"changeToCalculaterMesh",value:function(){this.mesh=new Pr;for(var e=this.combineBundleObj.combineBundleMeshs,t=0;t<e.length;t++){var n=e[t];this.mesh.subMeshes.push(n.getCalculaterMesh())}}},{key:"clear",value:function(){this.combineBundleObj&&this.combineBundleObj.clear(),this.combineBundleObj=null}}]),e}(),Lr=(function(){function e(){Ar(this,e),this.map={}}Rr(e,[{key:"getCombineMesh",value:function(e){if(!this.map[e.id]){var t=new Br({resource:e});t.build(),this.map[e.id]=t.mesh}return this.map[e.id]}},{key:"clear",value:function(){this.map={}}}])}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),Ir=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Nr=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},Hr=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},zr=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},Ur=function(){function e(t){Lr(this,e),this._initParams(),this.object=t.object,this.manager=t.manager}return Ir(e,[{key:"_initParams",value:function(){this.object=null,this.manager=null}},{key:"parse",value:function(){for(var e=this.object.children,t=0;t<e.length;t++){var n=e[t],i=this.manager.parserConfig[n.type];if(i)new i({object:n,manager:this.manager}).parse()}}},{key:"clear",value:function(){this._initParams()}}]),e}(),Vr=function(e){function t(e){return Lr(this,t),zr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Hr(t,e),t}(Ur),qr=function(e){function t(e){return Lr(this,t),zr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Hr(t,e),t}(Ur),Gr=function(){function e(t){Lr(this,e),this._initParams(),this.manager=t.manager,this.parent=null}return Ir(e,[{key:"_initParams",value:function(){this.parent=null,this.manager=null}},{key:"parse",value:function(){}},{key:"isObjectShouldCombine",value:function(e){return!!this.isNullOrUndefined(e.properties)&&(!!this.isNullOrUndefined(e.userID)&&(!!this.isNullOrUndefined(e.name)&&!!e.visible))}},{key:"isNullOrUndefined",value:function(e){return null==e}}]),e}(),Wr=function(e){function t(e){Lr(this,t);var n=zr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.combineWall=null,n}return Hr(t,e),Ir(t,[{key:"_initParams",value:function(){Nr(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineWall=null}},{key:"parse",value:function(e){"StraightManualWall"===e.type&&(null===this.combineWall&&(this.combineWall=this.crerateCombineStraightManualWall()),e.visible&&this.combineWall.addObject(e),e.parent=null)}},{key:"crerateCombineStraightManualWall",value:function(){var e=this.manager.objectManager.create({type:"CombineStraightManualWall"});return e.parent=this.parent,e}},{key:"initWallCorners",value:function(){for(var e=this.parent.typeToChildren.WallCorner,t=0;t<e.length;t++){var n=e[t];this.combineWall.addCorner(n)}}}]),t}(Gr),Xr=function(e){function t(e){Lr(this,t);var n=zr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.combineObjectMaps={},n._combineObjectClass=n.manager.objectManager.ClassName.CombinePlacement,n}return Hr(t,e),Ir(t,[{key:"_initParams",value:function(){Nr(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){e.type===this.manager.objectManager.ClassName.Placement&&this.isObjectShouldCombine(e)&&(this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null)}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._combineObjectClass});return t.resource=e,t.parent=this.parent,t}}]),t}(Gr),Jr={StraightManualWall:Wr,WallCorner:Gr,DoorOrWindow:function(e){function t(e){Lr(this,t);var n=zr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._combineObjectClass=n.manager.objectManager.ClassName.CombineDoorOrWindow,n}return Hr(t,e),Ir(t,[{key:"_initParams",value:function(){Nr(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this._combineObjectClass=null}},{key:"parse",value:function(e){"DoorOrWindow"===e.type&&this.isObjectShouldCombine(e)&&(this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null)}}]),t}(Xr),Placement:Xr,Room:function(e){function t(e){Lr(this,t);var n=zr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.combineFloorMaps={},n.combineCeilingMaps={},n.combineRoofMaps={},n.combineObjectMaps={Floor:n.combineFloorMaps,Ceiling:n.combineCeilingMaps,Roof:n.combineRoofMaps},n.typeToCombineObjectType={Floor:"CombineFloor",Ceiling:"CombineCeiling",Roof:"CombineRoof"},n}return Hr(t,e),Ir(t,[{key:"_initParams",value:function(){Nr(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineFloorMaps=null,this.combineCeilingMaps=null,this.combineRoofMaps=null,this.combineObjectMaps=null,this.typeToCombineObjectType=null}},{key:"createCombineObject",value:function(e,t,n){var i=this.manager.objectManager.create({type:this.typeToCombineObjectType[e]});return i.parent=this.parent,i.resource=t,i.height=n,i}},{key:"parse",value:function(e){this.isObjectShouldCombine(e)&&(e.ceiling&&e.ceiling.visible&&this._addCombineObject(e.ceiling),e.roof&&e.roof.visible&&this._addCombineObject(e.roof),e.floor.visible&&this._addCombineObject(e.floor),e.parent=null)}},{key:"_addCombineObject",value:function(e){var t=e.type,n=e.height,i=e.resource,r=this.combineObjectMaps[t];r[i.id]?r[i.id].has(n)||r[i.id].set(n,this.createCombineObject(t,i,n)):(r[i.id]=new Map,r[i.id].set(n,this.createCombineObject(t,i,n))),r[i.id].get(n).addObject(e)}}]),t}(Gr),ModelWall:function(e){function t(e){Lr(this,t);var n=zr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.combineObjectMaps={},n._CombineObjectClass=n.manager.objectManager.ClassName.CombineModelWall,n}return Hr(t,e),Ir(t,[{key:"_initParams",value:function(){Nr(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){e.visible&&(this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e)),e.parent=null}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._CombineObjectClass});return t.resource=e,t.parent=this.parent,t}}]),t}(Gr),PlacementGroup:function(e){function t(e){Lr(this,t);var n=zr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._combineObjectClass=n.manager.objectManager.ClassName.CombinePlacementGroup,n.combinePlacementGroup=null,n}return Hr(t,e),Ir(t,[{key:"_initParams",value:function(){Nr(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){e.type===this.manager.objectManager.ClassName.PlacementGroup&&this.isObjectShouldCombine(e)&&(null===this.combinePlacementGroup&&(this.combinePlacementGroup=this.createCombineObject()),this.combinePlacementGroup.addObject(e),e.parent=null)}},{key:"createCombineObject",value:function(){var e=this.manager.objectManager.create({type:this._combineObjectClass});return e.parent=this.parent,e}}]),t}(Gr),PlacementWall:function(e){function t(e){Lr(this,t);var n=zr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.combineObjectMaps={},n._combineObjectClass=n.manager.objectManager.ClassName.CombinePlacementWall,n}return Hr(t,e),Ir(t,[{key:"_initParams",value:function(){Nr(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._combineObjectClass});return t.resource=e,t.parent=this.parent,t}}]),t}(Gr)},Yr=function(e){function t(e){Lr(this,t);var n=zr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.combiners={},n}return Hr(t,e),Ir(t,[{key:"_initParams",value:function(){Nr(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combiners=null}},{key:"parse",value:function(){for(var e=this.object.children.slice(),t=0;t<e.length;t++){var n=e[t];this.initCombiner(n)}this.removeCorners()}},{key:"initCombiner",value:function(e){if(!this.combiners[e.type]){var t=Jr[e.type];if(t){var n=new t({manager:this.manager});n.parent=this.object,this.combiners[e.type]=n}}this.combiners[e.type]&&this.combiners[e.type].parse(e)}},{key:"removeCorners",value:function(){var e=this.object.typeToChildren.WallCorner;if(e){e=e.slice();for(var t=0;t<e.length;t++){e[t].parent=null}}}},{key:"clear",value:function(){for(var e in this.combiners)this.combiners[e].clear();Nr(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(Ur),Qr={World:Vr,Building:qr,FloorPlan:Yr,Outdoors:function(e){function t(e){return Lr(this,t),zr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Hr(t,e),t}(Yr)},Zr=function(){function e(){Lr(this,e),this.objectManager=null,this.parserConfig=Qr,this.rootParser=null}return Ir(e,[{key:"parse",value:function(e){new(0,this.parserConfig[e.type])({object:e,manager:this}).parse()}},{key:"clear",value:function(){this.rootParser&&this.rootParser.clear(),this.rootParser=null,this.objectManager=null,this.parserConfig=null}}]),e}(),Kr=new(function(){function e(t){Lr(this,e),this._versionMap={0:{0:Zr}},this._smallVersionLibs=[[0]],this._bigVersions=[0]}return Ir(e,[{key:"getCombinerManager",value:function(e,t){if(null==e){var n=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][n.length-1]}if(null==t){var i=this._smallVersionLibs[e];return new this._versionMap[e][i.length-1]}return new this._versionMap[e][t]}}]),e}()),$r=function(){function e(t){Lr(this,e),this.objectManager=t.objectManager}return Ir(e,[{key:"parse",value:function(e){var t=Kr.getCombinerManager(e.bigVersion,e.smallVersion);return t.objectManager=this.objectManager,t.parse(e)}},{key:"getCombineManager",value:function(e,t){var n=Kr.getCombinerManager(e,t);return n.objectManager=this.objectManager,n}},{key:"clear",value:function(){}}]),e}(),eo=function(){function e(t){p(this,e),this.sceneJson=null,this.world=null,Yt.meshBuilderManager=Sr.create(),Yt.calculaterManager=Ni.create(),dn.modelCombineBuilder=Br,this.loader=new Fe({objectManager:Yt,resourceManager:dn,defaultSetting:mt,defaultResource:yt}),this.dynamicBuildManager=new Ze(this),this.combineManager=new $r({objectManager:Yt}),this.resourceManager=dn,this.enableRequestWorld=!0}return d(e,[{key:"startToDownloadRequestResources",value:function(e){this.resourceManager.startToDownloadRequestResources(e)}},{key:"addResourceDownloadRequest",value:function(e){this.resourceManager.addResourceDownloadRequest(e)}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"delayLoad",value:function(e){var t=this;return new Promise((function(n,i){t.loadSceneJson(e).then((function(){t.world=t.loader.load({json:t.sceneJson,version:0}),t.combineParser.parseWorld(t.world),f.compatibilityProcessWorld(t.world),t.dynamicBuildManager.world=t.world,t.dynamicBuildManager.requestToBuild(t.world.id),t.dynamicBuildManager.build((function(e){1===e&&n(t.world)}))}))}))}},{key:"loadResources",value:function(){var e=this;return new Promise((function(t,n){e.resourceManager.downloadResourcesWithQueue((function(){t(e.world)}))}))}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"load",value:function(e){var t=this;return new Promise((function(n,i){t.loadSceneJson(e).then((function(){t.world=t.loader.load({json:t.sceneJson,version:2}),t.combineManager.parse(t.world),t.dynamicBuildManager.world=t.world,t.enableRequestWorld&&t.requestToBuild(t.world.id),n(t.world)}))}))}},{key:"loadSceneJson",value:function(e){var t=this;return new Promise((function(n,i){if(e.jsonData)t.sceneJson=e.jsonData,n(t.sceneJson);else if(e.url){(new THREE.FileLoader).load(e.url,(function(e){t.sceneJson=JSON.parse(e),n()}),(function(){}),(function(e){i("can not load "+t.sceneURL)}))}else i("load scene json error")}))}},{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}(),to=function(){function e(t){p(this,e),this.sceneJson=null,this.world=null,Yt.meshBuilderManager=Sr.create(),Yt.calculaterManager=Ni.create(),dn.modelCombineBuilder=Br,this.dynamicBuildManager=new Ze(this),this.loader=new Fe({objectManager:Yt,resourceManager:dn,defaultSetting:mt,defaultResource:yt}),this.combineManager=new $r({objectManager:Yt}),this.resourceManager=dn,this.enableRequestWorld=!0}return d(e,[{key:"startToDownloadRequestResources",value:function(e){this.resourceManager.startToDownloadRequestResources(e)}},{key:"addResourceDownloadRequest",value:function(e){this.resourceManager.addResourceDownloadRequest(e)}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"loadSceneJson",value:function(e){var t=this;return new Promise((function(n,i){if(e.json)t.sceneJson=e.json,n(t.sceneJson);else if(e.url){(new THREE.FileLoader).load(e.url,(function(e){t.sceneJson=JSON.parse(e),n()}),(function(){}),(function(e){i("can not load "+t.sceneURL)}))}else i("load scene json error")}))}},{key:"loadResources",value:function(){var e=this;return new Promise((function(t,n){e.dynamicBuildManager.build((function(n){1===n&&t(e.world)}))}))}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"load",value:function(e){var t=this;return new Promise((function(n,i){t.loadSceneJson(e).then((function(){t.world=t.loader.load({json:t.sceneJson,version:2}),t.combineManager.parse(t.world),t.dynamicBuildManager.world=t.world,t.enableRequestWorld&&t.requestToBuild(t.world.id),n(t.world)}))}))}},{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}(),no=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},io=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ro=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},oo=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},ao=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},so=function(){function e(t){no(this,e),this.object=t.object,this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this.mesh=null,this._boxMesh=null}return io(e,[{key:"build",value:function(){this._createMesh()}},{key:"_createMesh",value:function(){if(this.object.resource){var e=this.object.resource;e.isTestModel?this.object.mesh=e.model.clone():this.object.nodeName?this.createMeshByNode():this.createMeshByModelClone()}else null===this.object.mesh&&(this.object.mesh=new THREE.Object3D)}},{key:"createMeshByNode",value:function(){var e=this.object.resource.model.getObjectByName(this.object.nodeName);if(e){if(e=e.clone(),this.object.position=e.position.toArray(),this.object.scale=e.scale.toArray(),this.object.rotation=e.quaternion.toArray(),this.object.children.length>0)for(var t=e.children.length-1;t>-1;t--){var n=e.children[t];e.remove(n)}this.object.mesh=e}else console.warn("can not find node "+this.object.nodeName),this.object.mesh=new THREE.Object3D}},{key:"_setTransformation",value:function(e,t){e.position.equals(t.position)||(0===e.position.x&&0===e.position.y&&0===e.position.z?this.object.position=t.position.clone():t.position.copy(this.object.position)),e.scale.equals(t.scale)||(1===e.scale.x&&1===e.scale.y&&1===e.scale.z?this.object.scale=t.scale.clone():t.scale.copy(t.scale)),e.rotation.equals(t.quaternion)||(0===e.rotation.x&&0===e.rotation.y&&0===e.rotation.z&&1===e.rotation.w?this.object.rotation=t.quaternion.clone():t.quaternion.copy(this.object.rotation))}},{key:"createMeshByModelClone",value:function(){var e=this.object.resource.model.clone(),t=this.object.position,n=this.object.scale,i=this.object.rotation;e.position.set(t[0],t[1],t[2]),e.quaternion.set(i[0],i[1],i[2],i[3]),e.scale.set(n[0],n[1],n[2]),this.object.mesh=e,this.object.mesh.name=this.object.type+this.object.id}},{key:"createBoxMesh",value:function(){if(null===this._boxMesh){var e=new THREE.BoxBufferGeometry(1,1,1),t=new THREE.MeshBasicMaterial,n=new THREE.Mesh(e,t),i=this.object.size;n.scale.set(this.object.size[0],this.object.size[1],this.object.size[2]),n.quaternion.set(this.object.rotation[0],this.object.rotation[1],this.object.rotation[2],this.object.rotation[3]),n.position.set(this.object.position[0],this.object.position[1],this.object.position[2]),n.position.y=(this.object.position[1]+i[1])/2,this._boxMesh=n}return this._boxMesh}},{key:"notifyBuildCompleteListeners",value:function(){for(var e=0;e<this.buildCompleteCallbacks.length;e++){(0,this.buildCompleteCallbacks[e])(this,this.buildCompleteCallbackParams[e])}}},{key:"checkResourceReady",value:function(){if(this.object.resources){for(var e=0;e<this.object.resources.length;e++){if(!this.object.resources[e].ready)return!1}return!0}return!this.object.resource||!!this.object.resource.ready}},{key:"initResource",value:function(){if(this.object.resources)for(var e=0;e<this.object.resources.length;e++){var t=this.object.resources[e];this.requestResource(t)}else this.requestResource(this.object.resource)}},{key:"requestResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"registerBuildCallbackListener",value:function(e,t){this.buildCompleteCallbacks.push(e),this.buildCompleteCallbackParams.push(t)}},{key:"resourceCallback",value:function(e){this.build()}}]),e}(),lo=function(e){function t(e){no(this,t);var n=ao(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.isRegisterObjectBuildCallback=!1,n}return oo(t,e),io(t,[{key:"_createMesh",value:function(){ro(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this)}},{key:"buildCallback",value:function(e,t){var n=t.builder;n.applyRotationToChildren(),n.object.mesh.quaternion.set(0,0,0,1);for(var i=0;i<e.children.length;i++){e.children[i].meshBuilder.applyRotationToChildren()}}}]),t}(so),uo=function(e){function t(e){return no(this,t),ao(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return oo(t,e),t}(so),co=function(e){function t(e){return no(this,t),ao(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return oo(t,e),t}(so),ho=function(e){function t(e){return no(this,t),ao(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return oo(t,e),t}(so),po=function(e){function t(e){return no(this,t),ao(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return oo(t,e),io(t,[{key:"createMeshByNode",value:function(){var e=this.object.resource.model.getObjectByName(this.object.nodeName);e?(e=e.clone(),this.object.position=e.position.toArray(),this.object.scale=e.scale.toArray(),this.object.rotation=e.quaternion.toArray(),this.object.mesh=e):(console.warn("can not find node "+this.object.nodeName),this.object.mesh=new THREE.Object3D)}},{key:"_createMesh",value:function(){ro(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this);var e=new THREE.Object3D;e.name="floorMax",e.position.set(this.object.position[0],this.object.position[1],this.object.position[2]),e.scale.set(this.object.scale[0],this.object.scale[1],this.object.scale[2]),e.quaternion.set(this.object.rotation[0],this.object.rotation[1],this.object.rotation[2],this.object.rotation[3]);var n=this.object.mesh;n.position.set(0,0,0),n.scale.set(1,1,1),n.quaternion.set(0,0,0,1),e.add(n);var i=n.position.clone();i.applyQuaternion(e.quaternion),n.position.copy(i),n.quaternion.premultiply(e.quaternion),this.object.rotation=[0,0,0,1],e.quaternion.set(0,0,0,1),this.object.mesh=e,this.object.floor&&(this.object.floor.mesh=n),this.object.roof&&(this.object.roof.mesh=new THREE.Object3D),this.object.ceiling&&(this.object.ceiling.mesh=new THREE.Object3D)}}]),t}(so),fo=function(e){function t(e){return no(this,t),ao(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return oo(t,e),t}(so),mo=function(e){function t(e){return no(this,t),ao(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return oo(t,e),t}(so),go=function(e){function t(e){return no(this,t),ao(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return oo(t,e),t}(so),vo=function(e){function t(e){return no(this,t),ao(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return oo(t,e),t}(so),yo=function(e){function t(e){return no(this,t),ao(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return oo(t,e),t}(so),bo=function(e){function t(e){return no(this,t),ao(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return oo(t,e),t}(so),_o=function(e){function t(e){return no(this,t),ao(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return oo(t,e),io(t,[{key:"_createMesh",value:function(){this.object.mesh=new THREE.Object3D}}]),t}(so),xo=function(e){function t(e){return no(this,t),ao(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return oo(t,e),io(t,[{key:"_createMesh",value:function(){this.object.mesh=new THREE.Object3D}}]),t}(so),Eo=function(){function e(t){no(this,e),this._map={Empty:xo,Building:lo,World:uo,FloorPlan:bo,Outdoors:ho,Room:po,Floor:co,Placement:fo,Facade:vo,DoorOrWindow:yo,CombinePlacement:mo,CombinePlacementByBatch:_o,CombineModelWall:go}}return io(e,[{key:"getClass",value:function(e){return this._map[e]}},{key:"setClass",value:function(e,t){this._map[e]=t}}]),e}(),wo=function(){function e(t){no(this,e),this.builderTypeConfig=new Eo}return io(e,[{key:"create",value:function(e){var t=e.type,n=this.builderTypeConfig.getClass(t);return n?new n(e):null}},{key:"registerMeshBuilder",value:function(e,t){this.builderTypeConfig.setClass(e,t)}},{key:"containMeshBuilderClass",value:function(e){return!!this.builderTypeConfig[e]}},{key:"getMeshBuilderClass",value:function(e){return this.builderTypeConfig.getClass(e)}},{key:"getEmptyMeshBuilderClass",value:function(){return this.builderTypeConfig.getClass("Empty")}}]),e}(),To=function(e){function t(e){return no(this,t),ao(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return oo(t,e),io(t,[{key:"createMeshByNode",value:function(){var e=this.object.resource.model.getObjectByName(this.object.nodeName);e?(e=e.clone(),this.object.position=e.position.toArray(),this.object.scale=e.scale.toArray(),this.object.rotation=e.quaternion.toArray(),this.object.mesh=e):(console.warn("can not find node "+this.object.nodeName),this.object.mesh=new THREE.Object3D)}},{key:"_createMesh",value:function(){ro(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this);var e=new THREE.Object3D;e.name="floorMax",e.position.set(this.object.position[0],this.object.position[1],this.object.position[2]),e.scale.set(this.object.scale[0],this.object.scale[1],this.object.scale[2]),e.quaternion.set(this.object.rotation[0],this.object.rotation[1],this.object.rotation[2],this.object.rotation[3]);var n=this.object.mesh;n.position.set(0,0,0),n.scale.set(1,1,1),n.quaternion.set(0,0,0,1),e.add(n);var i=n.position.clone();if(i.applyQuaternion(e.quaternion),n.position.copy(i),n.quaternion.premultiply(e.quaternion),this.object.rotation=[0,0,0,1],e.quaternion.set(0,0,0,1),this.object.mesh=e,this.object.floor.mesh=n,this.object.nodeName){var r=this.object.parent;if("Outdoors"!==r.type){var o=r.height;this.object.roof.mesh=n.clone(),this.object.ceiling.mesh=n.clone(),this.object.roof.mesh.position.set(0,o,0),this.object.ceiling.mesh.position.set(0,o-.01,0),this._changeMaterialSide(this.object.roof.mesh,0),this._changeMaterialSide(this.object.ceiling.mesh,1)}}else this.object.roof.mesh=new THREE.Object3D,this.object.ceiling.mesh=new THREE.Object3D;this._setRoomPoints(n)}},{key:"_changeMaterialSide",value:function(e,t){e.isMesh&&(e.material=e.material.clone(),e.material.side=t);for(var n=e.children,i=0;i<n.length;i++){var r=n[i];this._changeMaterialSide(r)}}},{key:"_setRoomPoints",value:function(e){if(e.isMesh){for(var t=[],n=e.geometry.attributes.position.array,i=0;i<n.length;i+=3)t.push(new THREE.Vector3(n[i],n[i+1],n[i+2]));this.object.points=t}for(var r=0;r<e.children.length;r++){var o=e.children[r];this._setRoomPoints(o)}}}]),t}(so),Mo=function(e){function t(e){no(this,t);var n=ao(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._map.Room=To,n}return oo(t,e),io(t,[{key:"getClass",value:function(e){return this._map[e]}}]),t}(Eo),So=function(e){function t(e){no(this,t);var n=ao(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.builderTypeConfig=new Mo,n}return oo(t,e),t}(wo),Co=function(e){function t(e){return no(this,t),ao(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return oo(t,e),io(t,[{key:"_createMesh",value:function(){if(this.object.resource){var e=this.object.resource;e.isTestModel?this.object.mesh=e.model.clone():this.object.nodeName&&this.createMeshByNode()}else null===this.object.mesh&&(this.object.mesh=new THREE.Object3D)}}]),t}(so),Ao=function(e){function t(e){no(this,t);var n=ao(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._map.CombinePlacement=Co,n}return oo(t,e),t}(Mo),Ro=function(e){function t(e){no(this,t);var n=ao(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.builderTypeConfig=new Ao,n}return oo(t,e),t}(So),Po=new(function(){function e(t){no(this,e),this._versionMap={0:{0:wo,1:So,2:Ro}},this._smallVersionLibs=[[0,1,2]],this._bigVersions=[0]}return io(e,[{key:"getManager",value:function(e,t){if(null==e){var n=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][n.length-1]}if(null==t){var i=this._smallVersionLibs[e];return new this._versionMap[e][i.length-1]}var r=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1]))return t>r[r.length-1]?new this._versionMap[e][r.length-1]:new this._versionMap[e][t];console.error("maxmeshbuilder not support version "+e+"."+t)}}]),e}()),Do=new(function(){function e(t){no(this,e)}return io(e,[{key:"createManager",value:function(e,t){return Po.getManager(e,t)}}]),e}()),ko="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},jo=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Oo=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Fo=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},Bo=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Lo=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},Io=function(){function e(){jo(this,e)}return Oo(e,null,[{key:"uuid",value:function(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var n=e.join("");return n}},{key:"approximatelyNumberEqual",value:function(e,t,n){var i=1e-4;return void 0!==n&&(i=n),Math.abs(e-t)<i}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),n={};e.traverse((function(e){e.isSkinnedMesh&&(n[e.name]=e)}));var i={},r={};t.traverse((function(e){e.isBone&&(i[e.name]=e),e.isSkinnedMesh&&(r[e.name]=e)}));var o=!1;for(var a in n){o=!0;for(var s=n[a].skeleton,l=r[a],u=[],c=0;c<s.bones.length;++c){var h=i[s.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,s.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":ko(t)))return t;if(t instanceof Date)return(n=new Date).setTime(t.getTime()),n;if(t instanceof Array|t instanceof Object){var n=t instanceof Array?[]:{};for(var i in t)t.hasOwnProperty(i)&&(n[i]=e.cloneJSObject(t[i]));return n}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}}]),e}(),No=function(){function e(t){jo(this,e),this.creatorManager=t.creatorManager,this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=t.jsonData,this.objectParent=null,t.parent&&(this.objectParent=t.parent),this.createType=null,this.resourceManager=t.resourceManager,this.objectManager=t.objectManager}return Oo(e,[{key:"create",value:function(){var e=this._getCreateParams();if(this.object=this.creatorManager.objectManager.create(e),this.jsonData.id&&(this.object.id=this.jsonData.id),this.jsonData.userid&&(this.object.userID=this.jsonData.userid),this.jsonData.name&&(this.object.name=this.jsonData.name),this.jsonData.node&&(this.object.nodeName=this.jsonData.node),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object.resource||(this.object.resource=this.resourceManager.emptyModelResource),this.object.jsonData=this.jsonData,e.parent&&(this.object.parent=e.parent),this.jsonData.position){var t=this.jsonData.position;this.object.position=t}if(this.jsonData.scale){var n=this.jsonData.scale;0===n[0]&&(n[0]=.01),0===n[1]&&(n[1]=.01),0===n[2]&&(n[2]=.01),this.object.scale=n}if(this.jsonData.rotation){var i=this.jsonData.rotation;this.object.rotation=i}if(this.jsonData.properties&&(this.object.properties=this.jsonData.properties,this.object.lowerCaseProperties=this.convertPropertiesToLowerCase(this.jsonData.properties)),Io.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),this.jsonData.caminfo){var r=this.jsonData.caminfo.eye,o=this.jsonData.caminfo.target;r[2]=-r[2],o[2]=-o[2],this.object.camInfo={eye:r,target:o}}if(this.jsonData.size){var a=this.jsonData.size;this.object.size=a}else this.object.size=[1,1,1];return this.object}},{key:"convertPropertiesToLowerCase",value:function(e){var t={};for(var n in e)t[n.toLowerCase()]=e[n].toLowerCase();return t}},{key:"parseChildren",value:function(){}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,n=e.creatorType,i=0;i<t.length;i++)this._parseJsonDataChild({jsonData:t[i],creatorType:n})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,this.creatorManager.createObject(e)}}]),e}(),Ho=0,zo=1,Uo=2,Vo=3,qo=6,Go=7,Wo=8,Xo=9,Jo=10,Yo=11,Qo=12,Zo=13,Ko=14,$o=15,ea=16,ta=17,na=18,ia=19,ra=21,oa=22,aa=23,sa=24,la=25,ua=26,ca=function(e){function t(e){jo(this,t);var n=Lo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="World",n}return Bo(t,e),Oo(t,[{key:"parseChildren",value:function(){var e=this.jsonData;if(e.buildings&&this._parseJsonDataChildren({jsonData:e.buildings,creatorType:zo}),e.outdoors){var t=this._parseJsonDataChild({jsonData:e.outdoors,creatorType:Jo});this.object.outdoors=t}}}]),t}(No),ha=function(e){function t(e){jo(this,t);var n=Lo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Building",n}return Bo(t,e),Oo(t,[{key:"create",value:function(){return Fo(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),Io.checkValueEmpty(this.jsonData.structshow)||(this.object.structShow=this.jsonData.structshow),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.facades&&this._parseJsonDataChildren({jsonData:e.facades,creatorType:Yo}),e.facadegroups&&this._parseJsonDataChildren({jsonData:e.facadegroups,creatorType:Qo}),e.plans&&this._parseJsonDataChildren({jsonData:e.plans,creatorType:Uo})}}]),t}(No),pa=function(e){function t(e){jo(this,t);var n=Lo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="FloorPlan",n}return Bo(t,e),Oo(t,[{key:"create",value:function(){return Fo(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),Io.checkValueEmpty(this.jsonData.alwaysshowinsideobjs)||(this.object.alwaysShowInsideObjs=this.jsonData.alwaysshowinsideobjs),Io.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.corners&&this._parseCorners(e.corners),e.walls&&this._parseWalls(e.walls),e.placements&&this._parseJsonDataChildren({jsonData:e.placements,creatorType:qo}),e.combineplacements&&this._parseJsonDataChildren({jsonData:e.combineplacements,creatorType:oa}),e.rooms&&this._parseJsonDataChildren({jsonData:e.rooms,creatorType:Xo}),e.groups&&this._parseJsonDataChildren({jsonData:e.groups,creatorType:Go}),e.curvelines&&this._parseJsonDataChildren({jsonData:e.curvelines,creatorType:Zo}),e.routelines&&this._parseJsonDataChildren({jsonData:e.routelines,creatorType:na}),e.leakwaterlines&&this._parseJsonDataChildren({jsonData:e.leakwaterlines,creatorType:Ko}),e.arrowlines&&this._parseJsonDataChildren({jsonData:e.arrowlines,creatorType:$o}),e.arrowdatalines&&this._parseJsonDataChildren({jsonData:e.arrowdatalines,creatorType:ea}),e.pipelines&&this._parseJsonDataChildren({jsonData:e.pipelines,creatorType:ta}),e.videoprobes&&this._parseJsonDataChildren({jsonData:e.videoprobes,creatorType:ia}),e.grounds&&this._parseJsonDataChildren({jsonData:e.grounds,creatorType:ra}),e.doororwindows&&this._parseDoorOrWindows(e.doororwindows)}},{key:"_parseCorners",value:function(e){for(var t=0;t<e.length;t++){var n=e[t],i=n[0],r=n[1],o=-n[2];this.object.existsCorner(i,r,o)?console.error("repeat corner"):this._parseJsonDataChild({jsonData:n,creatorType:Vo})}}},{key:"_parseWalls",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];this._parseJsonDataChild({jsonData:n,creatorType:aa})}}},{key:"_parseDoorOrWindows",value:function(e,t){for(var n=0;n<e.length;n++){var i=e[n];this._parseJsonDataChild({jsonData:i,attachWall:t,creatorType:Wo})}}}]),t}(No),da=function(e){function t(e){jo(this,t);var n=Lo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="ModelWall",n}return Bo(t,e),Oo(t,[{key:"create",value:function(){return Fo(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),Io.checkValueEmpty(this.jsonData.model)||(this.object.resource=this.resourceManager.models[this.jsonData.model]),this.object}}]),t}(No),fa=function(e){function t(e){jo(this,t);var n=Lo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="StraightManualWall",n}return Bo(t,e),Oo(t,[{key:"create",value:function(){return Fo(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}}]),t}(No),ma=function(e){function t(e){jo(this,t);var n=Lo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Placement",n}return Bo(t,e),Oo(t,[{key:"create",value:function(){if(Fo(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],Io.checkValueEmpty(this.jsonData.texture)||(this.object.customTextureResource=this.resourceManager.textures[this.jsonData.texture]),this.jsonData.color){var e=this.jsonData.color;this.object.customColor=e,4===e.length&&(this.object.opacity=e[3])}return Io.checkValueEmpty(this.jsonData.rendermode)||(this.object.renderMode=this.jsonData.rendermode),this.jsonData.animinfo&&(this.object.isPlayAnim=this.jsonData.animinfo.isplay,this.object.animClip=this.jsonData.animinfo.clip),Io.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(No),ga=function(e){function t(e){jo(this,t);var n=Lo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="PlacementGroup",n}return Bo(t,e),Oo(t,[{key:"create",value:function(){return Fo(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.jsonData.placements&&this._parseJsonDataChildren({jsonData:this.jsonData.placements,creatorType:qo}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:Go}),this.jsonData.videoprobes&&this._parseJsonDataChildren({jsonData:this.jsonData.videoprobes,creatorType:ia}),Io.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(No),va=function(e){function t(e){jo(this,t);var n=Lo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="DoorOrWindow",n}return Bo(t,e),Oo(t,[{key:"create",value:function(){if(Fo(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],Io.checkValueEmpty(this.jsonData.suspendpercent)||(this.object.suspendPercent=this.jsonData.suspendpercent),Io.checkValueEmpty(this.jsonData.isopen)||(this.object.isOpen=this.jsonData.isopen),Io.checkValueEmpty(this.jsonData.diridx)||(this.object.openDirIndex=this.jsonData.diridx),!Io.checkValueEmpty(this.jsonData.iswindow)){var e=this.jsonData.iswindow;"string"==typeof e&&(e="false"!==e.toLocaleString()),this.object.isWindow=e}return this.object}}]),t}(No),ya=function(e){function t(e){jo(this,t);var n=Lo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Room",n}return Bo(t,e),Oo(t,[{key:"create",value:function(){return Fo(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._createChildren(),this.object}},{key:"_createChildren",value:function(){this._parseJsonDataChild({jsonData:{},creatorType:sa}),"FloorPlan"===this.object.parent.type&&(this._parseJsonDataChild({jsonData:{},creatorType:la}),this._parseJsonDataChild({jsonData:{},creatorType:ua}))}}]),t}(No),ba=function(e){function t(e){jo(this,t);var n=Lo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Outdoors",n}return Bo(t,e),t}(pa),_a=function(e){function t(e){jo(this,t);var n=Lo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Facade",n}return Bo(t,e),t}(ma),xa=function(e){function t(e){jo(this,t);var n=Lo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="FacadeGroup",n}return Bo(t,e),Oo(t,[{key:"create",value:function(){return Fo(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.jsonData.facades&&this._parseJsonDataChildren({jsonData:this.jsonData.facades,creatorType:Yo}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:Qo}),this.object}}]),t}(No),Ea=function(e){function t(e){jo(this,t);var n=Lo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="CombinePlacement",n}return Bo(t,e),Oo(t,[{key:"create",value:function(){return Fo(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object}}]),t}(No),wa=function(e){function t(e){jo(this,t);var n=Lo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="CombineModelWall",n}return Bo(t,e),Oo(t,[{key:"create",value:function(){return Fo(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object}}]),t}(No),Ta=function(e){function t(e){jo(this,t);var n=Lo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Floor",n}return Bo(t,e),Oo(t,[{key:"create",value:function(){return Fo(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(No),Ma=function(e){function t(e){jo(this,t);var n=Lo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Ceiling",n}return Bo(t,e),Oo(t,[{key:"create",value:function(){return Fo(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(No),Sa=function(e){function t(e){jo(this,t);var n=Lo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Roof",n}return Bo(t,e),Oo(t,[{key:"create",value:function(){return Fo(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(No),Ca=function(){function e(t){jo(this,e),this._map={0:ca,1:ha,2:pa,4:da,5:fa,6:ma,7:ga,8:va,9:ya,10:ba,11:_a,12:xa,22:Ea,23:wa,24:Ta,25:Ma,26:Sa}}return Oo(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),Aa=new(function(){function e(t){jo(this,e),this.config=new Ca,this.objectManager=null}return Oo(e,[{key:"createObject",value:function(e){var t=this.config.getClass(e.creatorType);e.objectManager=this.objectManager,e.creatorManager=this;var n=new t(e),i=n.create(),r=!0;return void 0!==e.enableCreateChildren&&null!==e.enableCreateChildren&&(r=e.enableCreateChildren),r&&n.parseChildren(),i}}]),e}()),Ra=function(){function e(t){jo(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl}return Oo(e,[{key:"createResource",value:function(e){var t=this.manager.create({type:e});return t.manager=this.manager,t}},{key:"loadTextures",value:function(e){}},{key:"_loadLocalCustomTextureResource",value:function(e){var t=this.createResource("LocalCustomTextureResource");return t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,this._loadBaseTextureResourceData(e,t),t}},{key:"_loadTextureResource",value:function(e){var t=this.createResource("Resource");return this._loadBaseTextureResourceData(e,t),t}},{key:"_loadBaseTextureResourceData",value:function(e,t){t.id=e.id,t.ext=e.ext,e.url&&(t.url=e.url),t.baseUrl=this.baseTextureUrl,e.isDefault&&(t.isDefault=e.isDefault)}},{key:"loadModels",value:function(e){for(var t=null,n=0;n<e.length;n++){var i=e[n];if((t=this.createResource("Max2TjsResource")).baseUrl=this.baseModelUrl,i.localurl){if(t.localUrl=i.localurl,t.id=i.id,t.localBaseUrl=this.manager.localCustomModelBaseUrl,i.title&&(t.modelName=i.title),t.modelID=i.id,null!==i.texture&&void 0!==i.texture&&(t.customTexture=this.manager.textures[i.texture]),i.rendermode&&(t.renderMode=i.rendermode),i.color){var r=i.color;t.color=new THREE.Color(r[0],r[1],r[2]),4===r.length&&(t.opacity=r[3])}}else if(i.id){if(t.id=i.id,t.modelID=i.id,t.version=i.version,null!==i.texture&&void 0!==i.texture&&(t.customTexture=this.manager.textures[i.texture]),i.rendermode&&(t.renderMode=i.rendermode),i.model&&(t.modelID=i.model),i.title&&(t.modelName=i.title),i.color){r=i.color;t.color=new THREE.Color(r[0],r[1],r[2]),4===r.length&&(t.opacity=r[3])}if(i.size){var o=i.size;t.modelSize=new THREE.Vector3(o[0],o[1],o[2])}i.hasanimation&&(t.hasAnim=i.hasanimation),i.url&&(t.url=i.url)}for(var a=0;a<this.manager.ableToSupportFootAndHeadModelWalls.length;a++){var s=this.manager.ableToSupportFootAndHeadModelWalls[a];if(t.id===s){t.isSupportHeadAndFootModelWall=!0;break}}this.manager.models.push(t)}}},{key:"loadCustomModelResource",value:function(e,t){this.loadBaseResourceData(e,t),e.localurl&&(t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]))}},{key:"loadCustomResource",value:function(e,t){this.loadBaseResourceData(e,t)}},{key:"loadBaseResourceData",value:function(e,t){if(t.id=e.id,t.modelID=e.id,t.version=e.version,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]),e.rendermode&&(t.renderMode=e.rendermode),e.model&&(t.modelID=e.model),e.title&&(t.modelName=e.title),e.color){var n=e.color;t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])}if(e.size){var i=e.size;t.modelSize=new THREE.Vector3(i[0],i[1],i[2])}e.hasanimation&&(t.hasAnim=e.hasanimation)}}]),e}(),Pa=function(){function e(){jo(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null}return Oo(e,[{key:"setObjectTypeConfig",value:function(e){objectManager.objectTypeConfig=e}},{key:"setObjectManager",value:function(e){Aa.objectManager=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"loadLightMaps",value:function(e){var t=null,n="18091219l1g1hnjt",i="png";this.defaultSetting.userDefaultWallLightMap=!0,e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(n=e.straightmanualwall.lightingtexture.id,i=e.straightmanualwall.lightingtexture.ext,this.defaultSetting.userDefaultWallLightMap=!1),this.defaultSetting.enableManaulWallLightMap&&((t=this.createResource("Resource")).baseUrl=this.resourceManager.baseTextureUrl,t.id=n,t.ext=i,this.defaultResource.wallLightMapResource=t),this.defaultSetting.enableFloorLightMap&&((t=this.createResource("Resource")).baseUrl=this.resourceManager.baseTextureUrl,t.id="18091216vjlgtwbh",t.ext="jpg",this.defaultResource.floorLightMapResource=t)}},{key:"createResource",value:function(e){var t=objectManager.create({type:e});return t.manager=this.resourceManager,t}},{key:"parseObjects",value:function(e){return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),n="",i=0;i<t.length-1;i++){n+=t[i]+"/"}return n}},{key:"loadSceneJson",value:function(){var e=this;return new Promise((function(t,n){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,(function(n){e.sceneJson=JSON.parse(n),t()}),(function(){}),(function(t){n("can not load "+e.sceneURL)}))}else n("load scene json error")}))}},{key:"getResourceLoader",value:function(){var e=new Ra(this.resourceManager);return e.resourceManager=this.resourceManager,e}},{key:"parseSceneJson",value:function(){this.parseResources(this.sceneJson,this.resourceManager),this.parseWorld(this.sceneJson)}},{key:"parseResources",value:function(e,t){var n=new Ra(t);n.loadTextures(e.textures),n.loadModels(e.models)}},{key:"parseWorld",value:function(e){this.world=Aa.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:Ho})}},{key:"getCreatorManager",value:function(){return Aa}}]),e}(),Da=(new Pa,function(e){function t(e){jo(this,t);var n=Lo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="FloorPlan",n}return Bo(t,e),Oo(t,[{key:"create",value:function(){return Fo(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),Io.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),this.object}}]),t}(pa)),ka=function(e){function t(e){jo(this,t);var n=Lo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._map[Uo]=Da,n}return Bo(t,e),t}(Ca),ja=function(e){function t(e){jo(this,t);var n=Lo(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.creatorTypeConfig=new ka,n}return Bo(t,e),t}(Pa),Oa=new(function(){function e(t){jo(this,e),this._versionMap={0:{0:Pa,1:ja,2:ja}},this._smallVersionLibs=[[0,1,2]],this._bigVersions=[0]}return Oo(e,[{key:"getLoaderManager",value:function(e,t){if(null==e){var n=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][n.length-1]}if(null==t){var i=this._smallVersionLibs[e];return new this._versionMap[e][i.length-1]}return new this._versionMap[e][t]}}]),e}()),Fa=function(){function e(t){jo(this,e),this.resourceManager=t.resourceManager,this.defaultSetting=t.defaultSetting,this.defaultResource=t.defaultResource,this.objectManager=t.objectManager}return Oo(e,[{key:"load",value:function(e){return this.getLoaderManager(e.bigVersion,e.smallVersion).parseObjects(e)}},{key:"getLoaderManager",value:function(e,t){var n=Oa.getLoaderManager(e,t);return n.setDefaultSetting(this.defaultSetting),n.setDefaultResource(this.defaultResource),n.setResourceManager(this.resourceManager),n.setObjectManager(this.objectManager),n}}]),e}();mt.enableCombinePlacementsByRoom=!1,mt.enableCombinePlacementToBuildMesh=!0;var Ba="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},La=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Ia=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Na=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},Ha=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},za=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},Ua=function(){function e(t){La(this,e),this._initParams(),this.object=t.object,this.manager=t.manager}return Ia(e,[{key:"_initParams",value:function(){this.object=null,this.manager=null}},{key:"parse",value:function(){for(var e=this.object.children,t=0;t<e.length;t++){var n=e[t],i=this.manager.parserConfig[n.type];if(i)new i({object:n,manager:this.manager}).parse()}}},{key:"clear",value:function(){this._initParams()}}]),e}(),Va=function(e){function t(e){return La(this,t),za(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Ha(t,e),t}(Ua),qa=function(e){function t(e){return La(this,t),za(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Ha(t,e),t}(Ua),Ga=function(){function e(t){La(this,e),this._initParams(),this.manager=t.manager,this.parent=null}return Ia(e,[{key:"_initParams",value:function(){this.parent=null,this.manager=null}},{key:"parse",value:function(){}},{key:"isNullOrUndefined",value:function(e){return null==e}}]),e}(),Wa={WallCorner:Ga,CombinePlacement:function(e){function t(e){La(this,t);var n=za(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.combineObjectMaps={},n._combineObjectClass="BatchCombinePlacement",n}return Ha(t,e),Ia(t,[{key:"_initParams",value:function(){Na(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){e.type===this.manager.objectManager.ClassName.CombinePlacement&&this.isObjectShouldCombine(e)&&(this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null)}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._combineObjectClass});return t.resource=e,t.parent=this.parent,t}},{key:"isObjectShouldCombine",value:function(e){return!!this.isNullOrUndefined(e.nodeName)}}]),t}(Ga),Placement:function(e){function t(e){La(this,t);var n=za(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.combineObjectMaps={},n._combineObjectClass="BatchPlacement",n}return Ha(t,e),Ia(t,[{key:"_initParams",value:function(){Na(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combineObjectMaps=null,this._CombineObjectClass=null}},{key:"parse",value:function(e){e.type===this.manager.objectManager.ClassName.Placement&&this.isObjectShouldCombine(e)&&(this.combineObjectMaps[e.resource.id]||(this.combineObjectMaps[e.resource.id]=this.createCombineObject(e.resource)),this.combineObjectMaps[e.resource.id].addObject(e),e.parent=null)}},{key:"createCombineObject",value:function(e){var t=this.manager.objectManager.create({type:this._combineObjectClass});return t.resource=e,t.parent=this.parent,t}},{key:"isObjectShouldCombine",value:function(e){return!!this.isNullOrUndefined(e.nodeName)}}]),t}(Ga)},Xa=function(e){function t(e){La(this,t);var n=za(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.combiners={},n}return Ha(t,e),Ia(t,[{key:"_initParams",value:function(){Na(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.combiners=null}},{key:"parse",value:function(){for(var e=this.object.children.slice(),t=0;t<e.length;t++){var n=e[t];this.initCombiner(n)}this.removeCorners()}},{key:"initCombiner",value:function(e){if(!this.combiners[e.type]){var t=Wa[e.type];if(t){var n=new t({manager:this.manager});n.parent=this.object,this.combiners[e.type]=n}}this.combiners[e.type]&&this.combiners[e.type].parse(e)}},{key:"removeCorners",value:function(){var e=this.object.typeToChildren.WallCorner;if(e){e=e.slice();for(var t=0;t<e.length;t++){e[t].parent=null}}}},{key:"clear",value:function(){for(var e in this.combiners)this.combiners[e].clear();Na(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(Ua),Ja={World:Va,Building:qa,FloorPlan:Xa,Outdoors:function(e){function t(e){return La(this,t),za(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Ha(t,e),t}(Xa)},Ya={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=new Array(36),i=0;return function(){for(var r=0;r<36;r++)8===r||13===r||18===r||23===r?n[r]="-":14===r?n[r]="4":(i<=2&&(i=33554432+16777216*Math.random()|0),e=15&i,i>>=4,n[r]=t[19===r?3&e|8:e]);return n.join("")}}(),clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Ya.DEG2RAD},radToDeg:function(e){return e*Ya.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}},Qa=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Za=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Ka=function(){function e(t,n,i,r){Qa(this,e),this._x=t||0,this._y=n||0,this._z=i||0,this._w=void 0!==r?r:1}return Za(e,[{key:"slerp",value:function(e,t,n,i){return n.copy(e).slerp(t,i)}},{key:"slerpFlat",value:function(e,t,n,i,r,o,a){var s=n[i+0],l=n[i+1],u=n[i+2],c=n[i+3],h=r[o+0],p=r[o+1],d=r[o+2],f=r[o+3];if(c!==f||s!==h||l!==p||u!==d){var m=1-a,g=s*h+l*p+u*d+c*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),_=Math.atan2(b,g*v);m=Math.sin(m*_)/b,a=Math.sin(a*_)/b}var x=a*v;if(s=s*m+h*x,l=l*m+p*x,u=u*m+d*x,c=c*m+f*x,m===1-a){var E=1/Math.sqrt(s*s+l*l+u*u+c*c);s*=E,l*=E,u*=E,c*=E}}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=c}},{key:"set",value:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this.onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,i=e._y,r=e._z,o=e.order,a=Math.cos,s=Math.sin,l=a(n/2),u=a(i/2),c=a(r/2),h=s(n/2),p=s(i/2),d=s(r/2);return"XYZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"YXZ"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"ZXY"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c-h*p*d):"ZYX"===o?(this._x=h*u*c-l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c+h*p*d):"YZX"===o?(this._x=h*u*c+l*p*d,this._y=l*p*c+h*u*d,this._z=l*u*d-h*p*c,this._w=l*u*c-h*p*d):"XZY"===o&&(this._x=h*u*c-l*p*d,this._y=l*p*c-h*u*d,this._z=l*u*d+h*p*c,this._w=l*u*c+h*p*d),!1!==t&&this.onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this.onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t,n=e.elements,i=n[0],r=n[4],o=n[8],a=n[1],s=n[5],l=n[9],u=n[2],c=n[6],h=n[10],p=i+s+h;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(c-l)*t,this._y=(o-u)*t,this._z=(a-r)*t):i>s&&i>h?(t=2*Math.sqrt(1+i-s-h),this._w=(c-l)/t,this._x=.25*t,this._y=(r+a)/t,this._z=(o+u)/t):s>h?(t=2*Math.sqrt(1+s-i-h),this._w=(o-u)/t,this._x=(r+a)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+h-i-s),this._w=(a-r)/t,this._x=(o+u)/t,this._y=(l+c)/t,this._z=.25*t),this.onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n,i=new $a;return void 0===i&&(i=new $a),(n=e.dot(t)+1)<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?i.set(-e.y,e.x,0):i.set(0,-e.z,e.y)):i.crossVectors(e,t),this._x=i.x,this._y=i.y,this._z=i.z,this._w=n,this.normalize()}},{key:"inverse",value:function(){return this.conjugate().normalize()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,i=e._y,r=e._z,o=e._w,a=t._x,s=t._y,l=t._z,u=t._w;return this._x=n*u+o*a+i*l-r*s,this._y=i*u+o*s+r*a-n*l,this._z=r*u+o*l+n*s-i*a,this._w=o*u-n*a-i*s-r*l,this.onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,i=this._y,r=this._z,o=this._w,a=o*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;var s=Math.sqrt(1-a*a);if(Math.abs(s)<.001)return this._w=.5*(o+this._w),this._x=.5*(n+this._x),this._y=.5*(i+this._y),this._z=.5*(r+this._z),this;var l=Math.atan2(s,a),u=Math.sin((1-t)*l)/s,c=Math.sin(t*l)/s;return this._w=o*u+this._w*c,this._x=n*u+this._x*c,this._y=i*u+this._y*c,this._z=r*u+this._z*c,this.onChangeCallback(),this}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"onChange",value:function(e){return this.onChangeCallback=e,this}},{key:"onChangeCallback",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}]),e}(),$a=function(){function e(t,n,i){Qa(this,e),this.x=t||0,this.y=n||0,this.z=i||0,this.isVector3=!0}return Za(e,[{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(){var e=new Ka;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}()}},{key:"applyAxisAngle",value:function(){var e=new Ka;return function(t,n){return this.applyQuaternion(e.setFromAxisAngle(t,n))}()}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*i-a*n,u=s*n+a*t-r*i,c=s*i+r*n-o*t,h=-r*t-o*n-a*i;return this.x=l*s+h*-r+u*-a-c*-o,this.y=u*s+h*-o+c*-r-l*-a,this.z=c*s+h*-a+l*-o-u*-r,this}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(){var t=new e,n=new e;return function(e,i){return t.set(e,e,e),n.set(i,i,i),this.clamp(t,n)}()}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:"cross",value:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,i=this.y,r=this.z;return this.x=i*e.z-r*e.y,this.y=r*e.x-n*e.z,this.z=n*e.y-i*e.x,this}},{key:"crossVectors",value:function(e,t){var n=e.x,i=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-r*a,this.y=r*o-n*s,this.z=n*a-i*o,this}},{key:"projectOnVector",value:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)}},{key:"projectOnPlane",value:function(){var t=new e;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}},{key:"reflect",value:function(){var t=new e;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}()}},{key:"angleTo",value:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(Ya.clamp(t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this}},{key:"setFromCylindrical",value:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}]),e}(),es=function(){function e(t,n){Qa(this,e),this.isBox3=!0,this.min=void 0!==t?t:new $a(1/0,1/0,1/0),this.max=void 0!==n?n:new $a(-1/0,-1/0,-1/0)}return Za(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,l=e.length;s<l;s+=3){var u=e[s],c=e[s+1],h=e[s+2];u<t&&(t=u),c<n&&(n=c),h<i&&(i=h),u>r&&(r=u),c>o&&(o=c),h>a&&(a=h)}return this.min.set(t,n,i),this.max.set(r,o,a),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,l=e.count;s<l;s++){var u=e.getX(s),c=e.getY(s),h=e.getZ(s);u<t&&(t=u),c<n&&(n=c),h<i&&(i=h),u>r&&(r=u),c>o&&(o=c),h>a&&(a=h)}return this.min.set(t,n,i),this.max.set(r,o,a),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=(new $a).copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"setFromObject",value:function(e){return this.makeEmpty(),this.expandByObject(e)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){var t=e||new $a;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){var t=e||new $a;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){var t=new $a,n=this;return e.updateMatrixWorld(!0),e.traverse((function(e){var i,r,o=e.geometry;if(void 0!==o)if(o.isGeometry){var a=o.vertices;for(i=0,r=a.length;i<r;i++)t.copy(a[i]),t.applyMatrix4(e.matrixWorld),n.expandByPoint(t)}else if(o.isBufferGeometry){var s=o.attributes.position;if(void 0!==s)for(i=0,r=s.count;i<r;i++)t.fromBufferAttribute(s,i).applyMatrix4(e.matrixWorld),n.expandByPoint(t)}})),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return(t||new $a).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=e.constant&&n>=e.constant}},{key:"clampPoint",value:function(e,t){return(t||new $a).copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return(new $a).copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){var t=[new $a,new $a,new $a,new $a,new $a,new $a,new $a,new $a];return this.isEmpty()||(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(t)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}();function ts(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(ts.prototype,{isMatrix4:!0,set:function(e,t,n,i,r,o,a,s,l,u,c,h,p,d,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new ts).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(){var e=new $a;return function(t){var n=this.elements,i=t.elements,r=1/e.setFromMatrixColumn(t,0).length(),o=1/e.setFromMatrixColumn(t,1).length(),a=1/e.setFromMatrixColumn(t,2).length();return n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n[4]=i[4]*o,n[5]=i[5]*o,n[6]=i[6]*o,n[8]=i[8]*a,n[9]=i[9]*a,n[10]=i[10]*a,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(i),l=Math.sin(i),u=Math.cos(r),c=Math.sin(r);if("XYZ"===e.order){var h=o*u,p=o*c,d=a*u,f=a*c;t[0]=s*u,t[4]=-s*c,t[8]=l,t[1]=p+d*l,t[5]=h-f*l,t[9]=-a*s,t[2]=f-h*l,t[6]=d+p*l,t[10]=o*s}else if("YXZ"===e.order){var m=s*u,g=s*c,v=l*u,y=l*c;t[0]=m+y*a,t[4]=v*a-g,t[8]=o*l,t[1]=o*c,t[5]=o*u,t[9]=-a,t[2]=g*a-v,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order){m=s*u,g=s*c,v=l*u,y=l*c;t[0]=m-y*a,t[4]=-o*c,t[8]=v+g*a,t[1]=g+v*a,t[5]=o*u,t[9]=y-m*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){h=o*u,p=o*c,d=a*u,f=a*c;t[0]=s*u,t[4]=d*l-p,t[8]=h*l+f,t[1]=s*c,t[5]=f*l+h,t[9]=p*l-d,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var b=o*s,_=o*l,x=a*s,E=a*l;t[0]=s*u,t[4]=E-b*c,t[8]=x*c+_,t[1]=c,t[5]=o*u,t[9]=-a*u,t[2]=-l*u,t[6]=_*c+x,t[10]=b-E*c}else if("XZY"===e.order){b=o*s,_=o*l,x=a*s,E=a*l;t[0]=s*u,t[4]=-c,t[8]=l*u,t[1]=b*c+E,t[5]=o*u,t[9]=_*c-x,t[2]=x*c-_,t[6]=a*u,t[10]=E*c+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,n=e._x,i=e._y,r=e._z,o=e._w,a=n+n,s=i+i,l=r+r,u=n*a,c=n*s,h=n*l,p=i*s,d=i*l,f=r*l,m=o*a,g=o*s,v=o*l;return t[0]=1-(p+f),t[4]=c-v,t[8]=h+g,t[1]=c+v,t[5]=1-(u+f),t[9]=d-m,t[2]=h-g,t[6]=d+m,t[10]=1-(u+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new $a,t=new $a,n=new $a;return function(i,r,o){var a=this.elements;return n.subVectors(i,r),0===n.lengthSq()&&(n.z=1),n.normalize(),e.crossVectors(o,n),0===e.lengthSq()&&(1===Math.abs(o.z)?n.x+=1e-4:n.z+=1e-4,n.normalize(),e.crossVectors(o,n)),e.normalize(),t.crossVectors(n,e),a[0]=e.x,a[4]=t.x,a[8]=n.x,a[1]=e.y,a[5]=t.y,a[9]=n.y,a[2]=e.z,a[6]=t.z,a[10]=n.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],u=n[1],c=n[5],h=n[9],p=n[13],d=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],_=n[15],x=i[0],E=i[4],w=i[8],T=i[12],M=i[1],S=i[5],C=i[9],A=i[13],R=i[2],P=i[6],D=i[10],k=i[14],j=i[3],O=i[7],F=i[11],B=i[15];return r[0]=o*x+a*M+s*R+l*j,r[4]=o*E+a*S+s*P+l*O,r[8]=o*w+a*C+s*D+l*F,r[12]=o*T+a*A+s*k+l*B,r[1]=u*x+c*M+h*R+p*j,r[5]=u*E+c*S+h*P+p*O,r[9]=u*w+c*C+h*D+p*F,r[13]=u*T+c*A+h*k+p*B,r[2]=d*x+f*M+m*R+g*j,r[6]=d*E+f*S+m*P+g*O,r[10]=d*w+f*C+m*D+g*F,r[14]=d*T+f*A+m*k+g*B,r[3]=v*x+y*M+b*R+_*j,r[7]=v*E+y*S+b*P+_*O,r[11]=v*w+y*C+b*D+_*F,r[15]=v*T+y*A+b*k+_*B,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new $a;return function(t){for(var n=0,i=t.count;n<i;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.applyMatrix4(this),t.setXYZ(n,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],a=e[5],s=e[9],l=e[13],u=e[2],c=e[6],h=e[10],p=e[14];return e[3]*(+r*s*c-i*l*c-r*a*h+n*l*h+i*a*p-n*s*p)+e[7]*(+t*s*p-t*l*h+r*o*h-i*o*p+i*l*u-r*s*u)+e[11]*(+t*l*c-t*a*p-r*o*c+n*o*p+r*a*u-n*l*u)+e[15]*(-i*a*u-t*s*c+t*a*h+i*o*c-n*o*h+n*s*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,i=e.elements,r=i[0],o=i[1],a=i[2],s=i[3],l=i[4],u=i[5],c=i[6],h=i[7],p=i[8],d=i[9],f=i[10],m=i[11],g=i[12],v=i[13],y=i[14],b=i[15],_=d*y*h-v*f*h+v*c*m-u*y*m-d*c*b+u*f*b,x=g*f*h-p*y*h-g*c*m+l*y*m+p*c*b-l*f*b,E=p*v*h-g*d*h+g*u*m-l*v*m-p*u*b+l*d*b,w=g*d*c-p*v*c-g*u*f+l*v*f+p*u*y-l*d*y,T=r*_+o*x+a*E+s*w;if(0===T){var M="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(M);return console.warn(M),this.identity()}var S=1/T;return n[0]=_*S,n[1]=(v*f*s-d*y*s-v*a*m+o*y*m+d*a*b-o*f*b)*S,n[2]=(u*y*s-v*c*s+v*a*h-o*y*h-u*a*b+o*c*b)*S,n[3]=(d*c*s-u*f*s-d*a*h+o*f*h+u*a*m-o*c*m)*S,n[4]=x*S,n[5]=(p*y*s-g*f*s+g*a*m-r*y*m-p*a*b+r*f*b)*S,n[6]=(g*c*s-l*y*s-g*a*h+r*y*h+l*a*b-r*c*b)*S,n[7]=(l*f*s-p*c*s+p*a*h-r*f*h-l*a*m+r*c*m)*S,n[8]=E*S,n[9]=(g*d*s-p*v*s-g*o*m+r*v*m+p*o*b-r*d*b)*S,n[10]=(l*v*s-g*u*s+g*o*h-r*v*h-l*o*b+r*u*b)*S,n[11]=(p*u*s-l*d*s-p*o*h+r*d*h+l*o*m-r*u*m)*S,n[12]=w*S,n[13]=(p*v*a-g*d*a+g*o*f-r*v*f-p*o*y+r*d*y)*S,n[14]=(g*u*a-l*v*a-g*o*c+r*v*c+l*o*y-r*u*y)*S,n[15]=(l*d*a-p*u*a+p*o*c-r*d*c-l*o*f+r*u*f)*S,this},scale:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,a=e.y,s=e.z,l=r*o,u=r*a;return this.set(l*o+n,l*a-i*s,l*s+i*a,0,l*a+i*s,u*a+n,u*s-i*o,0,l*s-i*a,u*s+i*o,r*s*s+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){return this.makeRotationFromQuaternion(t),this.scale(n),this.setPosition(e),this},decompose:function(){var e=new $a,t=new ts;return function(n,i,r){var o=this.elements,a=e.set(o[0],o[1],o[2]).length(),s=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();this.determinant()<0&&(a=-a),n.x=o[12],n.y=o[13],n.z=o[14],t.copy(this);var u=1/a,c=1/s,h=1/l;return t.elements[0]*=u,t.elements[1]*=u,t.elements[2]*=u,t.elements[4]*=c,t.elements[5]*=c,t.elements[6]*=c,t.elements[8]*=h,t.elements[9]*=h,t.elements[10]*=h,i.setFromRotationMatrix(t),r.x=a,r.y=s,r.z=l,this}}(),makePerspective:function(e,t,n,i,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*r/(t-e),l=2*r/(n-i),u=(t+e)/(t-e),c=(n+i)/(n-i),h=-(o+r)/(o-r),p=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(e,t,n,i,r,o){var a=this.elements,s=1/(t-e),l=1/(n-i),u=1/(o-r),c=(t+e)*s,h=(n+i)*l,p=(o+r)*u;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,n=e.elements,i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}});!function(){function e(t,n){Qa(this,e),this.x=t||0,this.y=n||0,this.isVector2=!0}Za(e,[{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(){var t=new e,n=new e;return function(e,i){return t.set(e,e),n.set(i,i),this.clamp(t,n)}()}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"distanceToManhattan",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}},{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}}])}();var ns=function(){function e(){La(this,e)}return Ia(e,null,[{key:"uuid",value:function(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var n=e.join("");return n}},{key:"approximatelyNumberEqual",value:function(e,t,n){var i=1e-4;return void 0!==n&&(i=n),Math.abs(e-t)<i}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),n={};e.traverse((function(e){e.isSkinnedMesh&&(n[e.name]=e)}));var i={},r={};t.traverse((function(e){e.isBone&&(i[e.name]=e),e.isSkinnedMesh&&(r[e.name]=e)}));var o=!1;for(var a in n){o=!0;for(var s=n[a].skeleton,l=r[a],u=[],c=0;c<s.bones.length;++c){var h=i[s.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,s.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":Ba(t)))return t;if(t instanceof Date)return(n=new Date).setTime(t.getTime()),n;if(t instanceof Array|t instanceof Object){var n=t instanceof Array?[]:{};for(var i in t)t.hasOwnProperty(i)&&(n[i]=e.cloneJSObject(t[i]));return n}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}},{key:"calTwoPositionLength",value:function(t,n){var i=e.subPosition(t,n);return i=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],Math.sqrt(i)}},{key:"subPosition",value:function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}},{key:"normalizeDirection",value:function(t){var n=e.calTwoPositionLength([0,0,0],t);if(1===n)return t;var i=t;return 0===n?(i[0]=0,i[1]=0,i[2]=0,i):(n=1/n,i[0]*=n,i[1]*=n,i[2]*=n,i)}}]),e}(),is=function(e){function t(e){La(this,t);var n=za(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.objects=[],n}return Ha(t,e),Ia(t,[{key:"_initParams",value:function(){Na(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.objects=[]}},{key:"_buildSelf",value:function(){Na(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_buildSelf",this).call(this)}},{key:"clear",value:function(){for(var e=0;e<this.objects.length;e++){this.objects[e].clear()}Na(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this)}}]),t}(function(){function e(){La(this,e),this.type="BaseObject",this._initParams(),this.calculaterData={}}return Ia(e,[{key:"_initParams",value:function(){this.id=ns.uuid(),this.name=null,this.userID=null,this.properties=null,this.resource=null,this._resources=null,this.position=[0,0,0],this.rotation=[0,0,0,1],this.scale=[1,1,1],this._parent=null,this.children=[],this.typeToChildren={},this.lowerCaseProperties=null,this.visible=!0,this.mesh=null,this.calculater=null,this.meshBuilder=null,this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this._isSelfBuilded=!1,this._size=null,this._box3=null,this._selfSize=null,this._center=null,this._isRequestResource=!1,this._isNotifyListeners=!1}},{key:"_getCalculateSizeObjects",value:function(){return this.children}},{key:"_addChild",value:function(e){this.children.push(e),this.typeToChildren[e.type]||(this.typeToChildren[e.type]=[]),this.typeToChildren[e.type].push(e),e.registerBuildCallbackListener(this._childBuildCallback,{obj:this})}},{key:"_childBuildCallback",value:function(e,t){var n=t.obj;n.isChildrenBuilded&&n._isSelfBuilded&&n.notifyBuildCompleteListeners()}},{key:"_removeChild",value:function(e){var t=this.children.indexOf(e);t>-1&&this.children.splice(t,1),(t=this.typeToChildren[e.type].indexOf(e))>-1&&this.typeToChildren[e.type].splice(t,1),e.removeBuildCallbackListener(this._childBuildCallback)}},{key:"build",value:function(e){e&&this.registerBuildCallbackListener(e),this.isBuilded||(this.isResourcesBuilded?(this.buildSelf(),this.buildChildren(),this.isChildrenBuilded&&this.notifyBuildCompleteListeners()):this._initResources())}},{key:"calculate",value:function(){this.calculater&&this.calculater.build(this)}},{key:"createMesh",value:function(){if(this.meshBuilder)return this.meshBuilder.build(this)}},{key:"_initResources",value:function(){if(!this._isRequestResource){for(var e=0;e<this.resources.length;e++){var t=this.resources[e];t.isBuilded||(t.registerBuildCallbackListener(this._resourceBuildedCallback,{object:this}),t.build())}this._isRequestResource=!0}}},{key:"_resourceBuildedCallback",value:function(e,t){var n=t.object;e.isBuilded&&n.build()}},{key:"buildSelf",value:function(){this._buildSelf()}},{key:"_buildSelf",value:function(){this._isSelfBuilded||(this.calculate(),this.createMesh(),this._isSelfBuilded=!0,this.isChildrenBuilded&&this.notifyBuildCompleteListeners())}},{key:"buildChildren",value:function(){this._buildChildren()}},{key:"_buildChildren",value:function(){if(!this.isChildrenBuilded)for(var e=0;e<this.children.length;e++){this.children[e].build()}}},{key:"registerBuildCallbackListener",value:function(e,t){this.buildCompleteCallbacks.push(e),this.buildCompleteCallbackParams.push(t)}},{key:"removeBuildCallbackListener",value:function(){}},{key:"notifyBuildCompleteListeners",value:function(){if(!this._isNotifyListeners){for(var e=0;e<this.buildCompleteCallbacks.length;e++){(0,this.buildCompleteCallbacks[e])(this,this.buildCompleteCallbackParams[e])}this._isNotifyListeners=!0}}},{key:"findObjectByID",value:function(e){if(!e)return null;if(this.id===e)return this;if(this.children)for(var t=0;t<this.children.length;t++){var n=this.children[t];if(n.id===e)return n;var i=n.findObjectByID(e);if(i)return i}return null}},{key:"findObjectByUserID",value:function(e){if(!e)return null;if(this.userID===e)return this;if(this.children)for(var t=0;t<this.children.length;t++){var n=this.children[t];if(n.userID===e)return n;var i=n.findObjectByUserID(e);if(i)return i}return null}},{key:"clear",value:function(){for(var e=0;e<this.children.length;e++){this.children[e].clear()}this.calculater=null,this.meshBuilder=null,this._initParams(),this.id=null}},{key:"deepClone",value:function(e){var t=Array.isArray(e)?[]:{};if(e&&"object"===(void 0===e?"undefined":Ba(e)))for(var n in e)e.hasOwnProperty(n)&&(t[n]=e&&"object"===Ba(e[n])?this.deepClone(e[n]):e[n]);return t}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){return null===this._selfSize?[0,0,0]:this._selfSize}},{key:"center",get:function(){if(null===this._center){if(!this.size||!this._box3)return[0,0,0];this._center=this._box3.getCenter().toArray()}return this._center}},{key:"size",set:function(e){this._size=e,0===this.children.length&&(this.selfSize=e)},get:function(){if(null===this._size)if(this.children.length>0){if(this._box3=new es,0!==this.selfSize[0]&&0!==this.selfSize[1]&&0!==this.selfSize[2]){var e=new Vector3(this.position[0],this.position[1],this.position[2]);e.y+=this.selfSize[1]/2,this._box3.setFromCenterAndSize(e,new Vector3(this.selfSize[0],this.selfSize[1],this.selfSize[2]))}for(var t=this._getCalculateSizeObjects(),n=0;n<t.length;n++){var i=t[n];i.size&&i._box3&&this._box3.union(i._box3)}this._size=this._box3.getSize().toArray()}else this._size=this.selfSize;return this._size}},{key:"parent",get:function(){return this._parent},set:function(e){this._parent!==e&&(null!==this._parent&&this._parent._removeChild(this),null!=e&&(this._parent=e,this._parent&&this._parent._addChild(this)))}},{key:"isContainer",get:function(){return this.children.length>0}},{key:"resources",get:function(){return null===this._resources&&(this._resources=[],this.resource&&this._resources.push(this.resource)),this._resources}},{key:"isBuilded",get:function(){return this.isChildrenBuilded&&this._isSelfBuilded}},{key:"isChildrenBuilded",get:function(){if(this.isContainer){if(this.children.length>0){for(var e=0;e<this.children.length;e++){if(!this.children[e].isBuilded)return!1}return!0}return!0}return!0}},{key:"isResourcesBuilded",get:function(){for(var e=0;e<this.resources.length;e++){if(!this.resources[e].isBuilded)return!1}return!0}}]),e}()),rs=function(){function e(){La(this,e),this.positions=[],this.scales=[],this.quaternions=[]}return Ia(e,[{key:"clone",value:function(){var t=new e;return t.positions=this.positions.slice(),t.scales=this.scales.slice(),t.quaternions=this.quaternions.slice(),t}}]),e}(),os=function(e){function t(e){La(this,t);var n=za(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.type="BatchCombinePlacement",n}return Ha(t,e),Ia(t,[{key:"_initParams",value:function(){Na(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initParams",this).call(this),this.objects=[],this.belongRoomUserID=null,this.transformations=[]}},{key:"addObject",value:function(e){this.objects.push(e);var t=new rs;t.positions.push(e.position),t.scales.push(e.scale),t.quaternions.push(e.rotation),this.transformations.push(t)}},{key:"selfSize",set:function(e){this._selfSize=e},get:function(){if(null===this._selfSize){this._box3=new es;for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t.size&&this._box3.union(t._box3)}this._selfSize=this._box3.getSize().toArray()}return this._selfSize}}]),t}(is),as=function(){function e(t){La(this,e),this.object=t.object,this.mesh=null}return Ia(e,[{key:"build",value:function(){this.object.mesh=new THREE.Object3D}}]),e}(),ss=function(e){function t(e){La(this,t);var n=za(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.type="BatchPlacement",n}return Ha(t,e),t}(os),ls=function(){function e(){La(this,e),this.objectManager=null,this.parserConfig=Ja,this.rootParser=null}return Ia(e,[{key:"parse",value:function(e){this.registerObjects(),this.registerMeshBuilder(),new(0,this.parserConfig[e.type])({object:e,manager:this}).parse()}},{key:"registerObjects",value:function(){this.objectManager.containObjectClass("BatchCombinePlacement")||this.objectManager.registerObjectClass("BatchCombinePlacement",os),this.objectManager.containObjectClass("BatchPlacement")||this.objectManager.registerObjectClass("BatchPlacement",ss)}},{key:"registerMeshBuilder",value:function(){if(this.objectManager.meshBuilderManager){var e=this.objectManager.meshBuilderManager;e.containMeshBuilderClass("BatchCombinePlacement")||e.registerMeshBuilder("BatchCombinePlacement",as),e.containMeshBuilderClass("BatchPlacement")||e.registerMeshBuilder("BatchPlacement",as)}}},{key:"clear",value:function(){this.rootParser&&this.rootParser.clear(),this.rootParser=null,this.objectManager=null,this.parserConfig=null}}]),e}(),us=new(function(){function e(t){La(this,e),this._versionMap={0:{2:ls}},this._smallVersionLibs=[[2]],this._bigVersions=[0]}return Ia(e,[{key:"getCombinerManager",value:function(e,t){if(null==e){e=this._bigVersions[this._bigVersions.length-1];var n=this._smallVersionLibs[e];return t=n[n.length-1],new this._versionMap[e][t]}if(null==t){var i=this._smallVersionLibs[e];return t=i[i.length-1],new this._versionMap[e][t]}return this._versionMap[e]&&this._versionMap[e][t]?new this._versionMap[e][t]:null}}]),e}()),cs=function(){function e(t){La(this,e),this.objectManager=t.objectManager}return Ia(e,[{key:"parse",value:function(e,t,n){var i=us.getCombinerManager(t,n);return i?(i.objectManager=this.objectManager,i.parse(e)):null}},{key:"getCombineManager",value:function(e,t){var n=us.getCombinerManager(e,t);return n.objectManager=this.objectManager,n}},{key:"clear",value:function(){}}]),e}(),hs=function(){function e(t){p(this,e),this.sceneJson=null,this.world=null,this.resourceManager=new pn,this.debugManager=It,this.objectManager=new Jt,this.loader=new Fa({objectManager:this.objectManager,resourceManager:this.resourceManager}),this.resourceManager=this.resourceManager,this.loadVersion=null,this.enableRequestWorld=!0,this.dynamicBuildManager=new Ze(this)}return d(e,[{key:"startToDownloadRequestResources",value:function(e){this.resourceManager.startToDownloadRequestResources(e)}},{key:"addResourceDownloadRequest",value:function(e){this.resourceManager.addResourceDownloadRequest(e)}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"clearAllResources",value:function(){this.resourceManager.disposeModels(),this.resourceManager.disposeTextures()}},{key:"clearAllObjects",value:function(){this.world.clear()}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"disposeObject",value:function(e){this.dynamicBuildManager.disposeObject(e)}},{key:"findObjectByID",value:function(e){return this.world.findObjectByID(e)}},{key:"load",value:function(e){var t=e.bigVersion,n=e.smallVersion;return this.objectManager.meshBuilderManager=Do.createManager(t,n),this.combineManager=new cs({objectManager:this.objectManager}),this.world=this.loader.load(e),this.combineManager&&this.combineManager.parse(this.world,t,n),this.dynamicBuildManager.world=this.world,this.enableRequestWorld&&this.requestToBuild(this.world.id),this.world}},{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}(),ps=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},ds=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),fs=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},ms=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},gs=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},vs=function(){function e(t){ps(this,e),this.object=t.object,this.buildCompleteCallbacks=[],this.buildCompleteCallbackParams=[],this.mesh=null,this._boxMesh=null}return ds(e,[{key:"build",value:function(){this._createMesh()}},{key:"_createMesh",value:function(){if(this.object.resource){var e=this.object.resource;e.isTestModel?this.object.mesh=e.model.clone():this.object.nodeName?this.createMeshByNode():this.createMeshByModelClone()}else null===this.object.mesh&&(this.object.mesh=new THREE.Object3D)}},{key:"createMeshByNode",value:function(){var e=this.object.resource.model.getObjectByName(this.object.nodeName);if(e){if(e=e.clone(),this.object.position=e.position.toArray(),this.object.scale=e.scale.toArray(),this.object.rotation=e.quaternion.toArray(),this.object.children.length>0)for(var t=e.children.length-1;t>-1;t--){var n=e.children[t];e.remove(n)}this.object.mesh=e}else console.warn("can not find node "+this.object.nodeName),this.object.mesh=new THREE.Object3D}},{key:"_setTransformation",value:function(e,t){e.position.equals(t.position)||(0===e.position.x&&0===e.position.y&&0===e.position.z?this.object.position=t.position.clone():t.position.copy(this.object.position)),e.scale.equals(t.scale)||(1===e.scale.x&&1===e.scale.y&&1===e.scale.z?this.object.scale=t.scale.clone():t.scale.copy(t.scale)),e.rotation.equals(t.quaternion)||(0===e.rotation.x&&0===e.rotation.y&&0===e.rotation.z&&1===e.rotation.w?this.object.rotation=t.quaternion.clone():t.quaternion.copy(this.object.rotation))}},{key:"createMeshByModelClone",value:function(){var e=this.object.resource.model.clone(),t=this.object.position,n=this.object.scale,i=this.object.rotation;e.position.set(t[0],t[1],t[2]),e.quaternion.set(i[0],i[1],i[2],i[3]),e.scale.set(n[0],n[1],n[2]),this.object.mesh=e,this.object.mesh.name=this.object.type+this.object.id}},{key:"createBoxMesh",value:function(){if(null===this._boxMesh){var e=new THREE.BoxBufferGeometry(1,1,1),t=new THREE.MeshBasicMaterial,n=new THREE.Mesh(e,t),i=this.object.size;n.scale.set(this.object.size[0],this.object.size[1],this.object.size[2]),n.quaternion.set(this.object.rotation[0],this.object.rotation[1],this.object.rotation[2],this.object.rotation[3]),n.position.set(this.object.position[0],this.object.position[1],this.object.position[2]),n.position.y=(this.object.position[1]+i[1])/2,this._boxMesh=n}return this._boxMesh}},{key:"notifyBuildCompleteListeners",value:function(){for(var e=0;e<this.buildCompleteCallbacks.length;e++){(0,this.buildCompleteCallbacks[e])(this,this.buildCompleteCallbackParams[e])}}},{key:"checkResourceReady",value:function(){if(this.object.resources){for(var e=0;e<this.object.resources.length;e++){if(!this.object.resources[e].ready)return!1}return!0}return!this.object.resource||!!this.object.resource.ready}},{key:"initResource",value:function(){if(this.object.resources)for(var e=0;e<this.object.resources.length;e++){var t=this.object.resources[e];this.requestResource(t)}else this.requestResource(this.object.resource)}},{key:"requestResource",value:function(e){e.ready||(e.isStartDownload||e.requestToDownload(),e.registerListener(this))}},{key:"registerBuildCallbackListener",value:function(e,t){this.buildCompleteCallbacks.push(e),this.buildCompleteCallbackParams.push(t)}},{key:"resourceCallback",value:function(e){this.build()}}]),e}(),ys=function(e){function t(e){ps(this,t);var n=gs(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.isRegisterObjectBuildCallback=!1,n}return ms(t,e),ds(t,[{key:"_createMesh",value:function(){fs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this)}},{key:"buildCallback",value:function(e,t){var n=t.builder;n.applyRotationToChildren(),n.object.mesh.quaternion.set(0,0,0,1);for(var i=0;i<e.children.length;i++){e.children[i].meshBuilder.applyRotationToChildren()}}}]),t}(vs),bs=function(e){function t(e){return ps(this,t),gs(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ms(t,e),t}(vs),_s=function(e){function t(e){return ps(this,t),gs(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ms(t,e),t}(vs),xs=function(e){function t(e){return ps(this,t),gs(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ms(t,e),t}(vs),Es=function(e){function t(e){return ps(this,t),gs(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ms(t,e),ds(t,[{key:"_createMesh",value:function(){fs(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createMesh",this).call(this);var e=new THREE.Object3D;e.name="floorMax",e.position.set(this.object.position[0],this.object.position[1],this.object.position[2]),e.scale.set(this.object.scale[0],this.object.scale[1],this.object.scale[2]),e.quaternion.set(this.object.rotation[0],this.object.rotation[1],this.object.rotation[2],this.object.rotation[3]);var n=this.object.mesh;n.position.set(0,0,0),n.scale.set(1,1,1),n.quaternion.set(0,0,0,1),e.add(n);var i=n.position.clone();i.applyQuaternion(e.quaternion),n.position.copy(i),n.quaternion.premultiply(e.quaternion),this.object.rotation=[0,0,0,1],e.quaternion.set(0,0,0,1),this.object.mesh=e,this.object.floor.mesh=n,this.object.roof.mesh=new THREE.Object3D,this.object.ceiling.mesh=new THREE.Object3D}}]),t}(vs),ws=function(e){function t(e){return ps(this,t),gs(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ms(t,e),t}(vs),Ts=function(e){function t(e){return ps(this,t),gs(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ms(t,e),t}(vs),Ms=function(e){function t(e){return ps(this,t),gs(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ms(t,e),t}(vs),Ss=function(e){function t(e){return ps(this,t),gs(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ms(t,e),t}(vs),Cs=function(e){function t(e){return ps(this,t),gs(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ms(t,e),t}(vs),As=function(e){function t(e){return ps(this,t),gs(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ms(t,e),t}(vs),Rs=function(e){function t(e){return ps(this,t),gs(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return ms(t,e),ds(t,[{key:"_createMesh",value:function(){this.object.mesh=new THREE.Object3D}}]),t}(vs),Ps=function(){function e(t){ps(this,e),this._map={Building:ys,World:bs,FloorPlan:As,Outdoors:xs,Room:Es,Floor:_s,Placement:ws,Facade:Ss,DoorOrWindow:Cs,CombinePlacement:Ts,CombinePlacementByBatch:Rs,CombineModelWall:Ms}}return ds(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),Ds=function(){function e(t){ps(this,e),this.builderTypeConfig=new Ps}return ds(e,[{key:"create",value:function(e){var t=e.type,n=this.builderTypeConfig.getClass(t);return n?new n(e):null}}]),e}(),ks=new(function(){function e(t){ps(this,e),this._versionMap={0:{0:Ds}},this._smallVersionLibs=[[0]],this._bigVersions=[0]}return ds(e,[{key:"getManager",value:function(e,t){if(null==e){var n=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][n.length-1]}if(null==t){var i=this._smallVersionLibs[e];return new this._versionMap[e][i.length-1]}var r=this._smallVersionLibs[e];if(!(e>this._bigVersions[this._bigVersions.length-1]))return t>r[r.length-1]?new this._versionMap[e][r.length-1]:new this._versionMap[e][t];console.error("maxmeshbuilder not support version "+e+"."+t)}}]),e}()),js=new(function(){function e(t){ps(this,e)}return ds(e,[{key:"createManager",value:function(e){return ks.getManager(e.bigVersion,e.smallVersion)}}]),e}()),Os="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},Fs=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Bs=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Ls=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},Is=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Ns=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},Hs=new(function(){function e(t){Fs(this,e),this.config=null,this.objectManager=null}return Bs(e,[{key:"createObject",value:function(e){var t=this.config.getClass(e.creatorType);e.objectManager=this.objectManager;var n=new t(e),i=n.create();return n.parseChildren(),i}}]),e}()),zs=function(){function e(){Fs(this,e)}return Bs(e,null,[{key:"uuid",value:function(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var n=e.join("");return n}},{key:"approximatelyNumberEqual",value:function(e,t,n){var i=1e-4;return void 0!==n&&(i=n),Math.abs(e-t)<i}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),n={};e.traverse((function(e){e.isSkinnedMesh&&(n[e.name]=e)}));var i={},r={};t.traverse((function(e){e.isBone&&(i[e.name]=e),e.isSkinnedMesh&&(r[e.name]=e)}));var o=!1;for(var a in n){o=!0;for(var s=n[a].skeleton,l=r[a],u=[],c=0;c<s.bones.length;++c){var h=i[s.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,s.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":Os(t)))return t;if(t instanceof Date)return(n=new Date).setTime(t.getTime()),n;if(t instanceof Array|t instanceof Object){var n=t instanceof Array?[]:{};for(var i in t)t.hasOwnProperty(i)&&(n[i]=e.cloneJSObject(t[i]));return n}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}}]),e}(),Us=function(){function e(t){Fs(this,e),this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=t.jsonData,this.objectParent=null,t.parent&&(this.objectParent=t.parent),this.createType=null,this.resourceManager=t.resourceManager,this.objectManager=t.objectManager}return Bs(e,[{key:"create",value:function(){var e=this._getCreateParams();if(this.object=Hs.objectManager.create(e),this.jsonData.id&&(this.object.id=this.jsonData.id),this.jsonData.userid&&(this.object.userID=this.jsonData.userid),this.jsonData.name&&(this.object.name=this.jsonData.name),this.jsonData.node&&(this.object.nodeName=this.jsonData.node),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object.resource||(this.object.resource=this.resourceManager.emptyModelResource),this.object.jsonData=this.jsonData,e.parent&&(this.object.parent=e.parent),this.jsonData.position){var t=this.jsonData.position;this.object.position=t}if(this.jsonData.scale){var n=this.jsonData.scale;0===n[0]&&(n[0]=.01),0===n[1]&&(n[1]=.01),0===n[2]&&(n[2]=.01),this.object.scale=n}if(this.jsonData.rotation){var i=this.jsonData.rotation;this.object.rotation=i}if(this.jsonData.properties&&(this.object.properties=this.jsonData.properties,this.object.lowerCaseProperties=this.convertPropertiesToLowerCase(this.jsonData.properties)),zs.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),this.jsonData.caminfo){var r=this.jsonData.caminfo.eye,o=this.jsonData.caminfo.target;r[2]=-r[2],o[2]=-o[2],this.object.camInfo={eye:r,target:o}}if(this.jsonData.size){var a=this.jsonData.size;this.object.size=a}else this.object.size=[1,1,1];return this.object}},{key:"convertPropertiesToLowerCase",value:function(e){var t={};for(var n in e)t[n.toLowerCase()]=e[n].toLowerCase();return t}},{key:"parseChildren",value:function(){}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,n=e.creatorType,i=0;i<t.length;i++)this._parseJsonDataChild({jsonData:t[i],creatorType:n})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,Hs.createObject(e)}}]),e}(),Vs=0,qs=1,Gs=2,Ws=3,Xs=6,Js=7,Ys=8,Qs=9,Zs=10,Ks=11,$s=12,el=13,tl=14,nl=15,il=16,rl=17,ol=18,al=19,sl=21,ll=22,ul=23,cl=24,hl=25,pl=26,dl=function(e){function t(e){Fs(this,t);var n=Ns(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="World",n}return Is(t,e),Bs(t,[{key:"parseChildren",value:function(){var e=this.jsonData;if(e.buildings&&this._parseJsonDataChildren({jsonData:e.buildings,creatorType:qs}),e.outdoors){var t=this._parseJsonDataChild({jsonData:e.outdoors,creatorType:Zs});this.object.outdoors=t}}}]),t}(Us),fl=function(e){function t(e){Fs(this,t);var n=Ns(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Building",n}return Is(t,e),Bs(t,[{key:"create",value:function(){return Ls(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),zs.checkValueEmpty(this.jsonData.structshow)||(this.object.structShow=this.jsonData.structshow),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.facades&&this._parseJsonDataChildren({jsonData:e.facades,creatorType:Ks}),e.facadegroups&&this._parseJsonDataChildren({jsonData:e.facadegroups,creatorType:$s}),e.plans&&this._parseJsonDataChildren({jsonData:e.plans,creatorType:Gs})}}]),t}(Us),ml=function(e){function t(e){Fs(this,t);var n=Ns(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="FloorPlan",n}return Is(t,e),Bs(t,[{key:"create",value:function(){return Ls(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),zs.checkValueEmpty(this.jsonData.alwaysshowinsideobjs)||(this.object.alwaysShowInsideObjs=this.jsonData.alwaysshowinsideobjs),zs.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.corners&&this._parseCorners(e.corners),e.walls&&this._parseWalls(e.walls),e.placements&&this._parseJsonDataChildren({jsonData:e.placements,creatorType:Xs}),e.combineplacements&&this._parseJsonDataChildren({jsonData:e.combineplacements,creatorType:ll}),e.rooms&&this._parseJsonDataChildren({jsonData:e.rooms,creatorType:Qs}),e.groups&&this._parseJsonDataChildren({jsonData:e.groups,creatorType:Js}),e.curvelines&&this._parseJsonDataChildren({jsonData:e.curvelines,creatorType:el}),e.routelines&&this._parseJsonDataChildren({jsonData:e.routelines,creatorType:ol}),e.leakwaterlines&&this._parseJsonDataChildren({jsonData:e.leakwaterlines,creatorType:tl}),e.arrowlines&&this._parseJsonDataChildren({jsonData:e.arrowlines,creatorType:nl}),e.arrowdatalines&&this._parseJsonDataChildren({jsonData:e.arrowdatalines,creatorType:il}),e.pipelines&&this._parseJsonDataChildren({jsonData:e.pipelines,creatorType:rl}),e.videoprobes&&this._parseJsonDataChildren({jsonData:e.videoprobes,creatorType:al}),e.grounds&&this._parseJsonDataChildren({jsonData:e.grounds,creatorType:sl}),e.doororwindows&&this._parseDoorOrWindows(e.doororwindows)}},{key:"_parseCorners",value:function(e){for(var t=0;t<e.length;t++){var n=e[t],i=n[0],r=n[1],o=-n[2];this.object.existsCorner(i,r,o)?console.error("repeat corner"):this._parseJsonDataChild({jsonData:n,creatorType:Ws})}}},{key:"_parseWalls",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];this._parseJsonDataChild({jsonData:n,creatorType:ul})}}},{key:"_parseDoorOrWindows",value:function(e,t){for(var n=0;n<e.length;n++){var i=e[n];this._parseJsonDataChild({jsonData:i,attachWall:t,creatorType:Ys})}}}]),t}(Us),gl=function(e){function t(e){Fs(this,t);var n=Ns(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="ModelWall",n}return Is(t,e),Bs(t,[{key:"create",value:function(){return Ls(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),zs.checkValueEmpty(this.jsonData.model)||(this.object.resource=this.resourceManager.models[this.jsonData.model]),this.object}}]),t}(Us),vl=function(e){function t(e){Fs(this,t);var n=Ns(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="StraightManualWall",n}return Is(t,e),Bs(t,[{key:"create",value:function(){return Ls(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}}]),t}(Us),yl=function(e){function t(e){Fs(this,t);var n=Ns(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Placement",n}return Is(t,e),Bs(t,[{key:"create",value:function(){if(Ls(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],zs.checkValueEmpty(this.jsonData.texture)||(this.object.customTextureResource=this.resourceManager.textures[this.jsonData.texture]),this.jsonData.color){var e=this.jsonData.color;this.object.customColor=e,4===e.length&&(this.object.opacity=e[3])}return zs.checkValueEmpty(this.jsonData.rendermode)||(this.object.renderMode=this.jsonData.rendermode),this.jsonData.animinfo&&(this.object.isPlayAnim=this.jsonData.animinfo.isplay,this.object.animClip=this.jsonData.animinfo.clip),zs.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(Us),bl=function(e){function t(e){Fs(this,t);var n=Ns(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="PlacementGroup",n}return Is(t,e),Bs(t,[{key:"create",value:function(){return Ls(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.jsonData.placements&&this._parseJsonDataChildren({jsonData:this.jsonData.placements,creatorType:Xs}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:Js}),this.jsonData.videoprobes&&this._parseJsonDataChildren({jsonData:this.jsonData.videoprobes,creatorType:al}),zs.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(Us),_l=function(e){function t(e){Fs(this,t);var n=Ns(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="DoorOrWindow",n}return Is(t,e),Bs(t,[{key:"create",value:function(){if(Ls(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],zs.checkValueEmpty(this.jsonData.suspendpercent)||(this.object.suspendPercent=this.jsonData.suspendpercent),zs.checkValueEmpty(this.jsonData.isopen)||(this.object.isOpen=this.jsonData.isopen),zs.checkValueEmpty(this.jsonData.diridx)||(this.object.openDirIndex=this.jsonData.diridx),!zs.checkValueEmpty(this.jsonData.iswindow)){var e=this.jsonData.iswindow;"string"==typeof e&&(e="false"!==e.toLocaleString()),this.object.isWindow=e}return this.object}}]),t}(Us),xl=function(e){function t(e){Fs(this,t);var n=Ns(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Room",n}return Is(t,e),Bs(t,[{key:"create",value:function(){return Ls(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this._createChildren(),this.object}},{key:"_createChildren",value:function(){this._parseJsonDataChild({jsonData:{},creatorType:cl}),"FloorPlan"===this.object.parent.type&&(this._parseJsonDataChild({jsonData:{},creatorType:hl}),this._parseJsonDataChild({jsonData:{},creatorType:pl}))}}]),t}(Us),El=function(e){function t(e){Fs(this,t);var n=Ns(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Outdoors",n}return Is(t,e),t}(ml),wl=function(e){function t(e){Fs(this,t);var n=Ns(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Facade",n}return Is(t,e),t}(yl),Tl=function(e){function t(e){Fs(this,t);var n=Ns(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="FacadeGroup",n}return Is(t,e),Bs(t,[{key:"create",value:function(){return Ls(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.jsonData.facades&&this._parseJsonDataChildren({jsonData:this.jsonData.facades,creatorType:Ks}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:$s}),this.object}}]),t}(Us),Ml=function(e){function t(e){Fs(this,t);var n=Ns(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="CombinePlacement",n}return Is(t,e),Bs(t,[{key:"create",value:function(){return Ls(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object}}]),t}(Us),Sl=function(e){function t(e){Fs(this,t);var n=Ns(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="CombineModelWall",n}return Is(t,e),Bs(t,[{key:"create",value:function(){return Ls(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object.resource=this.resourceManager.models[this.jsonData.model],this.object}}]),t}(Us),Cl=function(e){function t(e){Fs(this,t);var n=Ns(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Floor",n}return Is(t,e),Bs(t,[{key:"create",value:function(){return Ls(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(Us),Al=function(e){function t(e){Fs(this,t);var n=Ns(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Ceiling",n}return Is(t,e),Bs(t,[{key:"create",value:function(){return Ls(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(Us),Rl=function(e){function t(e){Fs(this,t);var n=Ns(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Roof",n}return Is(t,e),Bs(t,[{key:"create",value:function(){return Ls(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(Us),Pl=function(){function e(t){Fs(this,e),this._map={0:dl,1:fl,2:ml,4:gl,5:vl,6:yl,7:bl,8:_l,9:xl,10:El,11:wl,12:Tl,22:Ml,23:Sl,24:Cl,25:Al,26:Rl}}return Bs(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),Dl=function(){function e(t){Fs(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl}return Bs(e,[{key:"createResource",value:function(e){var t=this.manager.create({type:e});return t.manager=this.manager,t}},{key:"loadTextures",value:function(e){}},{key:"_loadLocalCustomTextureResource",value:function(e){var t=this.createResource("LocalCustomTextureResource");return t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,this._loadBaseTextureResourceData(e,t),t}},{key:"_loadTextureResource",value:function(e){var t=this.createResource("Resource");return this._loadBaseTextureResourceData(e,t),t}},{key:"_loadBaseTextureResourceData",value:function(e,t){t.id=e.id,t.ext=e.ext,e.url&&(t.url=e.url),t.baseUrl=this.baseTextureUrl,e.isDefault&&(t.isDefault=e.isDefault)}},{key:"loadModels",value:function(e){for(var t=null,n=0;n<e.length;n++){var i=e[n];if((t=this.createResource("Max2TjsResource")).baseUrl=this.baseModelUrl,i.localurl){if(t.localUrl=i.localurl,t.id=i.id,t.localBaseUrl=this.manager.localCustomModelBaseUrl,i.title&&(t.modelName=i.title),t.modelID=i.id,null!==i.texture&&void 0!==i.texture&&(t.customTexture=this.manager.textures[i.texture]),i.rendermode&&(t.renderMode=i.rendermode),i.color){var r=i.color;t.color=new THREE.Color(r[0],r[1],r[2]),4===r.length&&(t.opacity=r[3])}}else if(i.id){if(t.id=i.id,t.modelID=i.id,t.version=i.version,null!==i.texture&&void 0!==i.texture&&(t.customTexture=this.manager.textures[i.texture]),i.rendermode&&(t.renderMode=i.rendermode),i.model&&(t.modelID=i.model),i.title&&(t.modelName=i.title),i.color){r=i.color;t.color=new THREE.Color(r[0],r[1],r[2]),4===r.length&&(t.opacity=r[3])}if(i.size){var o=i.size;t.modelSize=new THREE.Vector3(o[0],o[1],o[2])}i.hasanimation&&(t.hasAnim=i.hasanimation),i.url&&(t.url=i.url)}for(var a=0;a<this.manager.ableToSupportFootAndHeadModelWalls.length;a++){var s=this.manager.ableToSupportFootAndHeadModelWalls[a];if(t.id===s){t.isSupportHeadAndFootModelWall=!0;break}}this.manager.models.push(t)}}},{key:"loadCustomModelResource",value:function(e,t){this.loadBaseResourceData(e,t),e.localurl&&(t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]))}},{key:"loadCustomResource",value:function(e,t){this.loadBaseResourceData(e,t)}},{key:"loadBaseResourceData",value:function(e,t){if(t.id=e.id,t.modelID=e.id,t.version=e.version,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]),e.rendermode&&(t.renderMode=e.rendermode),e.model&&(t.modelID=e.model),e.title&&(t.modelName=e.title),e.color){var n=e.color;t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])}if(e.size){var i=e.size;t.modelSize=new THREE.Vector3(i[0],i[1],i[2])}e.hasanimation&&(t.hasAnim=e.hasanimation)}}]),e}(),kl=function(){function e(){Fs(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.creatorTypeConfig=new Pl}return Bs(e,[{key:"setObjectTypeConfig",value:function(e){objectManager.objectTypeConfig=e}},{key:"setObjectManager",value:function(e){Hs.objectManager=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"loadLightMaps",value:function(e){var t=null,n="18091219l1g1hnjt",i="png";this.defaultSetting.userDefaultWallLightMap=!0,e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(n=e.straightmanualwall.lightingtexture.id,i=e.straightmanualwall.lightingtexture.ext,this.defaultSetting.userDefaultWallLightMap=!1),this.defaultSetting.enableManaulWallLightMap&&((t=this.createResource("Resource")).baseUrl=this.resourceManager.baseTextureUrl,t.id=n,t.ext=i,this.defaultResource.wallLightMapResource=t),this.defaultSetting.enableFloorLightMap&&((t=this.createResource("Resource")).baseUrl=this.resourceManager.baseTextureUrl,t.id="18091216vjlgtwbh",t.ext="jpg",this.defaultResource.floorLightMapResource=t)}},{key:"createResource",value:function(e){var t=objectManager.create({type:e});return t.manager=this.resourceManager,t}},{key:"parseObjects",value:function(e){return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),n="",i=0;i<t.length-1;i++){n+=t[i]+"/"}return n}},{key:"loadSceneJson",value:function(){var e=this;return new Promise((function(t,n){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,(function(n){e.sceneJson=JSON.parse(n),t()}),(function(){}),(function(t){n("can not load "+e.sceneURL)}))}else n("load scene json error")}))}},{key:"getResourceLoader",value:function(){var e=new Dl(this.resourceManager);return e.resourceManager=this.resourceManager,e}},{key:"parseSceneJson",value:function(){var e=this.getResourceLoader();e.loadTextures(this.sceneJson.textures),e.loadModels(this.sceneJson.models),this.parseWorld(this.sceneJson)}},{key:"parseWorld",value:function(e){Hs.config=this.creatorTypeConfig,this.world=Hs.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:Vs})}}]),e}(),jl=(new kl,new(function(){function e(t){Fs(this,e),this._versionMap={0:{0:kl}},this._smallVersionLibs=[[0]],this._bigVersions=[0]}return Bs(e,[{key:"getLoaderManager",value:function(e,t){if(null==e){var n=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][n.length-1]}if(null==t){var i=this._smallVersionLibs[e];return new this._versionMap[e][i.length-1]}return new this._versionMap[e][t]}}]),e}())),Ol=function(){function e(t){Fs(this,e),this.resourceManager=t.resourceManager,this.defaultSetting=t.defaultSetting,this.defaultResource=t.defaultResource,this.objectManager=t.objectManager}return Bs(e,[{key:"load",value:function(e){var t=jl.getLoaderManager(e.bigVersion,e.smallVersion);return t.setDefaultSetting(this.defaultSetting),t.setDefaultResource(this.defaultResource),t.setResourceManager(this.resourceManager),t.setObjectManager(this.objectManager),t.parseObjects(e)}}]),e}(),Fl=function(){function e(t){p(this,e),this.sceneJson=null,this.world=null,this.resourceManager=new pn,this.objectManager=new Jt,this.debugManager=It,this.loader=new Ol({objectManager:this.objectManager,resourceManager:this.resourceManager}),this.loadVersion=null,this.enableRequestWorld=!0,this.dynamicBuildManager=new Ze(this),mt.enableBatchObject&&(this.objectManager.meshBuilderManager.registerMeshBuilder(dt.CombinePlacement,Rs),this.combineManager=new cs({objectManager:this.objectManager}))}return d(e,[{key:"startToDownloadRequestResources",value:function(e){this.resourceManager.startToDownloadRequestResources(e)}},{key:"addResourceDownloadRequest",value:function(e){this.resourceManager.addResourceDownloadRequest(e)}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"clearAllResources",value:function(){this.resourceManager.disposeModels(),this.resourceManager.disposeTextures()}},{key:"clearAllObjects",value:function(){this.world.clear()}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"disposeObject",value:function(e){this.dynamicBuildManager.disposeObject(e)}},{key:"findObjectByID",value:function(e){return this.world.findObjectByID(e)}},{key:"load",value:function(e){return this.objectManager.meshBuilderManager=js.createManager(e),this.world=this.loader.load(e),this.combineManager&&this.combineManager.parse(this.world),this.dynamicBuildManager.world=this.world,this.enableRequestWorld&&this.requestToBuild(this.world.id),this.world}},{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}(),Bl="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return void 0===e?"undefined":h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":h(e)},Ll=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Il=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Nl=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},Hl=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},zl=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},Ul=function(){function e(){Ll(this,e)}return Il(e,null,[{key:"uuid",value:function(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var n=e.join("");return n}},{key:"approximatelyNumberEqual",value:function(e,t,n){var i=1e-4;return void 0!==n&&(i=n),Math.abs(e-t)<i}},{key:"equalVectorZero",value:function(e){return 0===e.x&&0===e.y&&0===e.z}},{key:"clone",value:function(e){var t=e.clone(),n={};e.traverse((function(e){e.isSkinnedMesh&&(n[e.name]=e)}));var i={},r={};t.traverse((function(e){e.isBone&&(i[e.name]=e),e.isSkinnedMesh&&(r[e.name]=e)}));var o=!1;for(var a in n){o=!0;for(var s=n[a].skeleton,l=r[a],u=[],c=0;c<s.bones.length;++c){var h=i[s.bones[c].name];u.push(h)}l.bind(new THREE.Skeleton(u,s.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t}},{key:"cloneJSObject",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":Bl(t)))return t;if(t instanceof Date)return(n=new Date).setTime(t.getTime()),n;if(t instanceof Array|t instanceof Object){var n=t instanceof Array?[]:{};for(var i in t)t.hasOwnProperty(i)&&(n[i]=e.cloneJSObject(t[i]));return n}throw new Error("Unable to clone obj! Its type isn't supported.")}},{key:"checkValueEmpty",value:function(e){return null==e}}]),e}(),Vl=function(){function e(t){Ll(this,e),this.creatorManager=t.creatorManager}return Il(e,[{key:"initData",value:function(e){this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=e.jsonData,this.objectParent=null,e.parent&&(this.objectParent=e.parent),this.resourceManager=e.resourceManager}},{key:"create",value:function(e){this.initData(e);var t=this._getCreateParams();return this.object=this.creatorManager.objectManager.create(t),t.parent&&(this.object.parent=t.parent),this._loadBaseData(),this.object}},{key:"_loadBaseData",value:function(){if(this.jsonData.id&&(this.object.id=this.jsonData.id),this.jsonData.userid&&(this.object.userID=this.jsonData.userid),this.jsonData.name&&(this.object.name=this.jsonData.name),this.object.jsonData=this.jsonData,this.jsonData.position){var e=this.jsonData.position.slice();e[2]=-e[2],this.object.position=e}if(this.jsonData.scale){var t=this.jsonData.scale.slice();0===t[0]&&(t[0]=.01),0===t[1]&&(t[1]=.01),0===t[2]&&(t[2]=.01),this.object.scale=t}if(this.jsonData.rotation){var n=this.jsonData.rotation.slice();n[2]=-n[2],n[3]=-n[3],this.object.rotation=n}if(this.jsonData.properties&&(this.object.properties=this.jsonData.properties,this.object.lowerCaseProperties=this.convertPropertiesToLowerCase(this.jsonData.properties)),Ul.checkValueEmpty(this.jsonData.isshow)||(this.object.visible=this.jsonData.isshow),this.jsonData.caminfo){var i=this.jsonData.caminfo.eye,r=this.jsonData.caminfo.target;i[2]=-i[2],r[2]=-r[2],this.object.camInfo={eye:i,target:r}}}},{key:"convertPropertiesToLowerCase",value:function(e){var t={};for(var n in e)t[n.toLowerCase()]=e[n].toLowerCase();return t}},{key:"parseChildren",value:function(){}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,n=e.creatorType,i=0;i<t.length;i++)this._parseJsonDataChild({jsonData:t[i],creatorType:n})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,this.creatorManager.createObject(e)}}]),e}(),ql=0,Gl=1,Wl=2,Xl=3,Jl=4,Yl=5,Ql=6,Zl=7,Kl=8,$l=9,eu=10,tu=11,nu=12,iu=13,ru=14,ou=15,au=16,su=17,lu=18,uu=19,cu=20,hu=21,pu=22,du=23,fu=24,mu=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="World",n}return Hl(t,e),Il(t,[{key:"parseChildren",value:function(){var e=this.jsonData;if(e.outdoors){var t=this._parseJsonDataChild({jsonData:e.outdoors,creatorType:eu});this.object.outdoors=t}e.buildings&&this._parseJsonDataChildren({jsonData:e.buildings,creatorType:Gl})}}]),t}(Vl),gu=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Building",n}return Hl(t,e),Il(t,[{key:"create",value:function(e){return Nl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),Ul.checkValueEmpty(this.jsonData.structshow)||(this.object.structShow=this.jsonData.structshow),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.facades&&this._parseJsonDataChildren({jsonData:e.facades,creatorType:tu}),e.facadegroups&&this._parseJsonDataChildren({jsonData:e.facadegroups,creatorType:nu}),e.plans&&this._parseJsonDataChildren({jsonData:e.plans,creatorType:Wl})}}]),t}(Vl),vu=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="FloorPlan",n}return Hl(t,e),Il(t,[{key:"create",value:function(e){return Nl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),Ul.checkValueEmpty(this.jsonData.alwaysshowinsideobjs)||(this.object.alwaysShowInsideObjs=this.jsonData.alwaysshowinsideobjs),Ul.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.corners&&this._parseCorners(e.corners),e.walls&&this._parseWalls(e.walls),e.rooms&&(this._parseJsonDataChildren({jsonData:e.rooms,creatorType:$l}),this.object.calRoomsUV2()),e.placements&&this._parseJsonDataChildren({jsonData:e.placements,creatorType:Ql}),e.groups&&this._parseJsonDataChildren({jsonData:e.groups,creatorType:Zl}),e.curvelines&&this._parseJsonDataChildren({jsonData:e.curvelines,creatorType:iu}),e.routelines&&this._parseJsonDataChildren({jsonData:e.routelines,creatorType:lu}),e.leakwaterlines&&this._parseJsonDataChildren({jsonData:e.leakwaterlines,creatorType:ru}),e.arrowlines&&this._parseJsonDataChildren({jsonData:e.arrowlines,creatorType:ou}),e.arrowdatalines&&this._parseJsonDataChildren({jsonData:e.arrowdatalines,creatorType:au}),e.pipelines&&this._parseJsonDataChildren({jsonData:e.pipelines,creatorType:su}),e.videoprobes&&this._parseJsonDataChildren({jsonData:e.videoprobes,creatorType:uu}),e.grounds&&this._parseJsonDataChildren({jsonData:e.grounds,creatorType:hu})}},{key:"_parseCorners",value:function(e){for(var t=0;t<e.length;t++){var n=e[t],i=n[0],r=n[1],o=-n[2];this.object.existsCorner(i,r,o)?console.error("repeat corner"):this._parseJsonDataChild({jsonData:n,creatorType:Xl})}}},{key:"_parseWalls",value:function(e){for(var t=0;t<e.length;t++){var n=e[t],i=null;0===n.type?i=this._parseJsonDataChild({jsonData:n,creatorType:Yl}):1===n.type?i=this._parseJsonDataChild({jsonData:n,creatorType:Jl}):2===n.type&&(i=this._parseJsonDataChild({jsonData:n,creatorType:cu})),n.doororwindows&&this._parseDoorOrWindows(n.doororwindows,i)}}},{key:"_parseDoorOrWindows",value:function(e,t){for(var n=0;n<e.length;n++){var i=e[n];this._parseJsonDataChild({jsonData:i,attachWall:t,creatorType:Kl})}}}]),t}(Vl),yu=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="WallCorner",n}return Hl(t,e),Il(t,[{key:"create",value:function(e){Nl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e);var n=this.jsonData[0],i=this.jsonData[1],r=-this.jsonData[2];return this.object.position=[n,i,r],this.object}}]),t}(Vl),bu=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="ModelWall",n}return Hl(t,e),Il(t,[{key:"create",value:function(e){return Nl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this._parseCorners(),Ul.checkValueEmpty(this.jsonData.model)||(this.object.resource=this.resourceManager.models[this.jsonData.model]),Ul.checkValueEmpty(this.jsonData.height)?this.object.height=this.object.resource.size[1]:this.object.height=this.jsonData.height,Ul.checkValueEmpty(this.jsonData.thick)||(this.object.thick=this.jsonData.thick),this.object}},{key:"_parseCorners",value:function(){var e=this.jsonData.corners,t=this.objectParent.typeToChildren.WallCorner;this.object.startCorner=t[e[0]],this.object.endCorner=t[e[1]]}}]),t}(Vl),_u=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="StraightManualWall",n}return Hl(t,e),Il(t,[{key:"create",value:function(e){return Nl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this._parseCorners(),this._parseResources(),this.jsonData.uvmultiple&&(this.object.uvMultiple=this.jsonData.uvmultiple),Ul.checkValueEmpty(this.jsonData.height)||(this.object.height=this.jsonData.height),Ul.checkValueEmpty(this.jsonData.thick)||(this.object.thick=this.jsonData.thick),this.object}},{key:"_parseCorners",value:function(){var e=this.jsonData.corners,t=this.objectParent.typeToChildren.WallCorner;this.object.startCorner=t[e[0]],this.object.endCorner=t[e[1]]}},{key:"_parseResources",value:function(){Ul.checkValueEmpty(this.jsonData.lefttexture)||(this.object.leftResource=this.resourceManager.textures[this.jsonData.lefttexture]),Ul.checkValueEmpty(this.jsonData.righttexture)||(this.object.rightResource=this.resourceManager.textures[this.jsonData.righttexture]),Ul.checkValueEmpty(this.jsonData.edgetexture)||(this.object.edgeResource=this.resourceManager.textures[this.jsonData.edgetexture]),this.resourceManager.wallLightMapResource&&(this.object.lightMapResource=this.resourceManager.wallLightMapResource)}}]),t}(Vl),xu=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Placement",n}return Hl(t,e),Il(t,[{key:"create",value:function(e){if(Nl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object.resource=this.resourceManager.models[this.jsonData.model],Ul.checkValueEmpty(this.jsonData.texture)||(this.object.customTextureResource=this.resourceManager.textures[this.jsonData.texture]),this.jsonData.color){var n=this.jsonData.color;this.object.customColor=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(this.object.opacity=n[3])}return Ul.checkValueEmpty(this.jsonData.rendermode)||(this.object.renderMode=this.jsonData.rendermode),this.jsonData.animinfo&&(this.object.isPlayAnim=this.jsonData.animinfo.isplay,this.object.animClip=this.jsonData.animinfo.clip),Ul.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(Vl),Eu=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="PlacementGroup",n}return Hl(t,e),Il(t,[{key:"create",value:function(e){return Nl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.jsonData.placements&&this._parseJsonDataChildren({jsonData:this.jsonData.placements,creatorType:Ql}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:Zl}),this.jsonData.videoprobes&&this._parseJsonDataChildren({jsonData:this.jsonData.videoprobes,creatorType:uu}),Ul.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(Vl),wu=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="DoorOrWindow",n}return Hl(t,e),Il(t,[{key:"initData",value:function(e){Nl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initData",this).call(this,e),this.attachWall=e.attachWall}},{key:"create",value:function(e){if(Nl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object.resource=this.resourceManager.models[this.jsonData.model],Ul.checkValueEmpty(this.jsonData.suspendpercent)||(this.object.suspendPercent=this.jsonData.suspendpercent),Ul.checkValueEmpty(this.jsonData.isopen)||(this.object.isOpen=this.jsonData.isopen),Ul.checkValueEmpty(this.jsonData.diridx)||(this.object.openDirIndex=this.jsonData.diridx),!Ul.checkValueEmpty(this.jsonData.iswindow)){var n=this.jsonData.iswindow;"string"==typeof n&&(n="false"!==n.toLocaleString()),this.object.isWindow=n}return this.object.attachWall=this.attachWall,this.attachWall.doorOrWindows.push(this.object),this.object}}]),t}(Vl);function Tu(e,t){if(!(this instanceof Tu))return new Tu(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||Mu,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)}function Mu(e,t){return e<t?-1:e>t?1:0}function Su(e,t,n){var i,r,o,a;t=t||1;for(var s=0;s<e[0].length;s++){var l=e[0][s];(!s||l[0]<i)&&(i=l[0]),(!s||l[1]<r)&&(r=l[1]),(!s||l[0]>o)&&(o=l[0]),(!s||l[1]>a)&&(a=l[1])}var u=o-i,c=a-r,h=Math.min(u,c),p=h/2,d=new Tu(null,Cu);if(0===h)return[i,r];for(var f=i;f<o;f+=h)for(var m=r;m<a;m+=h)d.push(new Au(f+p,m+p,p,e));var g=function(e){for(var t=0,n=0,i=0,r=e[0],o=0,a=r.length,s=a-1;o<a;s=o++){var l=r[o],u=r[s],c=l[0]*u[1]-u[0]*l[1];n+=(l[0]+u[0])*c,i+=(l[1]+u[1])*c,t+=3*c}return 0===t?new Au(r[0][0],r[0][1],0,e):new Au(n/t,i/t,0,e)}(e),v=new Au(i+u/2,r+c/2,0,e);v.d>g.d&&(g=v);for(var y=d.length;d.length;){var b=d.pop();b.d>g.d&&(g=b,n&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,y)),b.max-g.d<=t||(p=b.h/2,d.push(new Au(b.x-p,b.y-p,p,e)),d.push(new Au(b.x+p,b.y-p,p,e)),d.push(new Au(b.x-p,b.y+p,p,e)),d.push(new Au(b.x+p,b.y+p,p,e)),y+=4)}return n&&(console.log("num probes: "+y),console.log("best distance: "+g.d)),[g.x,g.y]}function Cu(e,t){return t.max-e.max}function Au(e,t,n,i){this.x=e,this.y=t,this.h=n,this.d=function(e,t,n){for(var i=!1,r=1/0,o=0;o<n.length;o++)for(var a=n[o],s=0,l=a.length,u=l-1;s<l;u=s++){var c=a[s],h=a[u];c[1]>t!=h[1]>t&&e<(h[0]-c[0])*(t-c[1])/(h[1]-c[1])+c[0]&&(i=!i),r=Math.min(r,Ru(e,t,c,h))}return(i?1:-1)*Math.sqrt(r)}(e,t,i),this.max=this.d+this.h*Math.SQRT2}function Ru(e,t,n,i){var r=n[0],o=n[1],a=i[0]-r,s=i[1]-o;if(0!==a||0!==s){var l=((e-r)*a+(t-o)*s)/(a*a+s*s);l>1?(r=i[0],o=i[1]):l>0&&(r+=a*l,o+=s*l)}return(a=e-r)*a+(s=t-o)*s}Tu.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,n=this.compare,i=t[e];e>0;){var r=e-1>>1,o=t[r];if(n(i,o)>=0)break;t[e]=o,e=r}t[e]=i},_down:function(e){for(var t=this.data,n=this.compare,i=this.length>>1,r=t[e];e<i;){var o=1+(e<<1),a=o+1,s=t[o];if(a<this.length&&n(t[a],s)<0&&(o=a,s=t[a]),n(s,r)>=0)break;t[e]=s,e=o}t[e]=r}};var Pu=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Room",n}return Hl(t,e),Il(t,[{key:"create",value:function(e){return Nl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this._createChildren(),this._parseCorners(),this._parsePoints(),0===this.object.points.length&&console.warn("room points is null"),this._parseHolesCorners(),this._parseHolesPoints(),this._parseRoomResources(),this._parseRoomHeight(),this._parseRoomBlockSize(),this._parseRoomVisible(),this._parseRoomBlockAngle(),this._setOutdoorFloorHeight(),this.object.position=this._calRoomPosition(this.object),this._subRoomHolesPointsByPosition(this.object,this.object.position),this._subRoomPointsByPosition(this.object,this.object.position),this.object}},{key:"_createChildren",value:function(){this._parseJsonDataChild({jsonData:{},creatorType:pu}),"FloorPlan"===this.object.parent.type&&(this._parseJsonDataChild({jsonData:{},creatorType:du}),this._parseJsonDataChild({jsonData:{},creatorType:fu}))}},{key:"_parseCorners",value:function(){if(this.jsonData.corners){for(var e=[],t=this.objectParent.typeToChildren.WallCorner,n=0;n<this.jsonData.corners.length;n++){var i=t[this.jsonData.corners[n]].position.slice();e.push(i)}this.object.points=e}}},{key:"_parsePoints",value:function(){if(this.jsonData.points){for(var e=[],t=0;t<this.jsonData.points.length;t++){var n=this.jsonData.points[t],i=[n[0],n[1],-n[2]];e.push(i)}this.object.points=e}}},{key:"_parseHolesCorners",value:function(){if(this.jsonData.holescorners){for(var e=[],t=this.objectParent.typeToChildren.WallCorner,n=0;n<this.jsonData.holescorners.length;n++){for(var i=this.jsonData.holescorners[n],r=[],o=0;o<i.length;o++){var a=i[o];r.push(t[a].position.slice())}e.push(r)}this.object.holes=e}}},{key:"_parseHolesPoints",value:function(){if(this.jsonData.holespoints){for(var e=[],t=0;t<this.jsonData.holespoints.length;t++){for(var n=this.jsonData.holespoints[t],i=[],r=0;r<n.length;r++){var o=n[r],a=[o[0],o[1],-o[2]];i.push(a)}e.push(i)}this.object.holes=e}}},{key:"_parseRoomResources",value:function(){null!==this.jsonData.floortexture&&void 0!==this.jsonData.floortexture&&(this.object.floorResource=this.resourceManager.textures[this.jsonData.floortexture],this.object.floor.resource=this.object.floorResource),this.object.ceiling&&null!==this.jsonData.ceilingtexture&&void 0!==this.jsonData.ceilingtexture&&(this.object.ceilingResource=this.resourceManager.textures[this.jsonData.ceilingtexture],this.object.ceiling.resource=this.object.ceilingResource),this.object.roof&&null!==this.jsonData.rooftexture&&void 0!==this.jsonData.rooftexture&&(this.object.roofResource=this.resourceManager.textures[this.jsonData.rooftexture],this.object.roof.resource=this.object.roofResource)}},{key:"_parseRoomHeight",value:function(){var e=this.jsonData,t=this.object;t.ceiling&&(void 0!==e.ceilingheight?t.ceiling.height=e.ceilingheight:(t.ceiling.DefaultHeight=this.objectParent.height-.1,t.ceiling.height=t.ceiling.DefaultHeight)),t.roof&&(void 0!==e.roofheight?t.roof.height=e.roofheight:(t.roof.defaultHeight=this.objectParent.height,t.roof.height=t.roof.defaultHeight)),void 0!==e.floorheight&&(t.floor.height=e.floorheight)}},{key:"_parseRoomVisible",value:function(){var e=this.jsonData,t=this.object;t.floor&&void 0!==e.isshowfloor&&(t.floor.visible=e.isshowfloor),t.ceiling&&void 0!==e.isshowceiling&&(t.ceiling.visible=e.isshowceiling),t.roof&&void 0!==e.isshowroof&&(t.roof.visible=e.isshowroof)}},{key:"_parseRoomBlockSize",value:function(){var e=this.jsonData,t=this.object;if(t.floor&&e.floorblocksize){var n=e.floorblocksize;t.floor.blockSize=[n[0],n[1]]}if(t.ceiling&&e.ceilingblocksize){n=e.ceilingblocksize;t.ceiling.blockSize=[n[0],n[1]]}if(t.roof&&e.roofblocksize){n=e.roofblocksize;t.roof.blockSize=[n[0],n[1]]}}},{key:"_parseRoomBlockAngle",value:function(){var e=this.jsonData,t=this.object;t.floor&&e.floorblockangle&&(t.floor.blockAngle=e.floorblockangle),t.ceiling&&e.ceilingblockangle&&(t.ceiling.blockAngle=e.ceilingblockangle),t.roof&&e.roofblockangle&&(t.roof.blockAngle=e.roofblockangle)}},{key:"_setOutdoorFloorHeight",value:function(){var e=this.objectParent,t=this.object;"Outdoors"===e.type&&t.floor.height===t.floor.DefaultHeight&&(t.floor.height=0,t.floor.DefaultHeight=0)}},{key:"_calRoomPosition",value:function(e){for(var t=e.points,n=e.holes,i=[],r=[],o=0;o<t.length;o++){var a=t[o];i.push([a[0],a[2]])}if(n.length>2&&!this._isSamePoints(n))for(o=0;o<n.length;o++){for(var s=n[o],l=[],u=0;u<s.length;u++){a=s[u];l.push([a[0],a[2]])}r.push(l)}var c=this._getLabelPosition(i,r);return c||[0,0,0]}},{key:"_isSamePoints",value:function(e){for(var t=e[0],n=1;n<e.length;n++){var i=e[n];if(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2])return!1}return!0}},{key:"_getLabelPosition",value:function(e,t){if(!e||!e.length)return null;var n=[];n.push(e);var i=Su(n);return[i[0],0,i[1]]}},{key:"_subRoomPointsByPosition",value:function(e,t){for(var n=e.points,i=0;i<n.length;i++){var r=n[i];r[0]-=t[0],r[1]-=t[1],r[2]-=t[2]}e.points=n}},{key:"_subRoomHolesPointsByPosition",value:function(e,t){for(var n=e.holes,i=0;i<n.length;i++)for(var r=n[i],o=0;o<r.length;o++){var a=r[o];a[0]-=t[0],a[1]-=t[1],a[2]-=t[2]}e.holes=n}}]),t}(Vl),Du=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Outdoors",n}return Hl(t,e),t}(vu),ku=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Facade",n}return Hl(t,e),t}(xu),ju=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="FacadeGroup",n}return Hl(t,e),Il(t,[{key:"create",value:function(e){this.initData(e);var t=this._getCreateParams();return this.object=this.creatorManager.objectManager.create(t),t.parent&&(this.object.parent=t.parent),this._loadBaseData(),this.jsonData.facades&&this._parseJsonDataChildren({jsonData:this.jsonData.facades,creatorType:tu}),this.jsonData.groups&&this._parseJsonDataChildren({jsonData:this.jsonData.groups,creatorType:nu}),Ul.checkValueEmpty(this.jsonData._temp_belongroom)||(this.object.belongRoomUserID=this.jsonData._temp_belongroom),this.object}}]),t}(Eu),Ou=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="CurveLine",n}return Hl(t,e),Il(t,[{key:"create",value:function(e){Nl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e);var n=this.jsonData;if(Ul.checkValueEmpty(this.jsonData.texture)?this.object.resource=this.resourceManager.emptyTextureResource:this.object.resource=this.resourceManager.textures[this.jsonData.texture],this.jsonData.color){var i=this.jsonData.color;this.object.color=i,4===i.length&&(this.object.opacity=i[3])}if(void 0!==n.textiling){var r=n.textiling;this.object.textureTiling=r}if(void 0!==n.texoffset){var o=n.texoffset;this.object.textureOffset=o}!Ul.checkValueEmpty(this.jsonData.width)&&(this.object.width=this.jsonData.width),this.jsonData.enableanim&&(this.object.enableMaterialAnimation=this.jsonData.enableanim),!Ul.checkValueEmpty(this.jsonData.matanimspeed)&&(this.object.materialAnimationSpeed=this.jsonData.matanimspeed);for(var a=this.jsonData.path,s=0;s<a.length;s++){var l=a[s];l[2]=-l[2],this.object.points.push(l)}return this.object}}]),t}(Vl),Fu=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="PipeLine",n}return Hl(t,e),Il(t,[{key:"create",value:function(e){if(Nl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),Ul.checkValueEmpty(this.jsonData.texture)?this.object.resource=this.resourceManager.emptyTextureResource:this.object.resource=this.resourceManager.textures[this.jsonData.texture],this.jsonData.color){var n=this.jsonData.color;this.object.color=n,4===n.length&&(this.object.opacity=n[3])}this.jsonData.sectionType&&(this.object.sectionType=this.jsonData.sectionType),!Ul.checkValueEmpty(this.jsonData.rendermode)&&(this.object.renderMode=this.jsonData.rendermode),!Ul.checkValueEmpty(this.jsonData.radius)&&(this.object.radius=this.jsonData.radius),this.jsonData.enableanim&&(this.object.enableMaterialAnimation=this.jsonData.enableanim),!Ul.checkValueEmpty(this.jsonData.matanimspeed)&&(this.object.materialAnimationSpeed=this.jsonData.matanimspeed);for(var i=this.jsonData.path,r=0;r<i.length;r++){var o=i[r];o[2]=-o[2],this.object.points.push(o)}return this.object}}]),t}(Vl),Bu=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="LeakWaterLine",n}return Hl(t,e),Il(t,[{key:"create",value:function(e){return Nl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.jsonData.alarmlength&&(this.object.alarmLength=this.jsonData.alarmlength),this.object}}]),t}(Fu),Lu=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="ArrowLine",n}return Hl(t,e),Il(t,[{key:"create",value:function(e){Nl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e);var n=this.object,i=this.jsonData;return null!==n.width&&(n.arrowWidth=3*n.width,n.arrowHeight=2*n.width),i.arrow?(Ul.checkValueEmpty(i.arrow.texture)?n.arrowResource=this.resourceManager.emptyTextureResource:n.arrowResource=this.resourceManager.textures[i.arrow.texture],i.arrow.width&&(n.arrowWidth=i.arrow.width),i.arrow.height&&(n.arrowHeight=i.arrow.height)):n.arrowResource=this.resourceManager.emptyTextureResource,this.object}}]),t}(Ou),Iu=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="ArrowDataLine",n}return Hl(t,e),Il(t,[{key:"create",value:function(e){Nl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e);var n=this.object,i=this.jsonData;if(i.pointuserids){var r=i.pointuserids;n.pointUserIDs=r}if(i.pointproperteis){var o=i.pointproperteis;n.pointProperteis=o}return this.object}}]),t}(Lu),Nu=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="RouteLine",n}return Hl(t,e),t}(Ou),Hu=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="VideoProbe",n}return Hl(t,e),t}(xu),zu=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="PlacementWall",n}return Hl(t,e),Il(t,[{key:"create",value:function(e){return Nl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}}]),t}(xu),Uu=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="PlacementGround",n}return Hl(t,e),t}(xu),Vu=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Ceiling",n}return Hl(t,e),Il(t,[{key:"create",value:function(e){return Nl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(Vl),qu=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Roof",n}return Hl(t,e),Il(t,[{key:"create",value:function(e){return Nl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(Vl),Gu=function(e){function t(e){Ll(this,t);var n=zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Floor",n}return Hl(t,e),Il(t,[{key:"create",value:function(e){return Nl(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}},{key:"_getCreateParams",value:function(){var e={};return e.type=this.createType,this.objectParent&&(e.parent=this.objectParent),e}}]),t}(Vl),Wu=function(){function e(t){Ll(this,e),this._map={0:mu,1:gu,2:vu,3:yu,4:bu,5:_u,6:xu,7:Eu,8:wu,9:Pu,10:Du,11:ku,12:ju,13:Ou,14:Bu,15:Lu,16:Iu,17:Fu,18:Nu,19:Hu,20:zu,21:Uu,22:Gu,23:Vu,24:qu}}return Il(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),Xu=new(function(){function e(t){Ll(this,e),this.config=new Wu,this.objectManager=null,this.creatorMap={},this.creatorTypePlaceholderMap={}}return Il(e,[{key:"createObject",value:function(e){var t=e.creatorType,n=null;this.creatorMap[t]&&!this.creatorTypePlaceholderMap[t]?n=this.creatorMap[t]:(n=new(this.config.getClass(t))({creatorManager:this}),this.creatorMap[t]=n);this.creatorTypePlaceholderMap[t]||(this.creatorTypePlaceholderMap[t]=e.jsonData.id);var i=n.create(e),r=!0;return void 0!==e.enableCreateChildren&&null!==e.enableCreateChildren&&(r=e.enableCreateChildren),r&&n.parseChildren(),this.creatorTypePlaceholderMap[t]===i.id&&(this.creatorTypePlaceholderMap[t]=null),i}}]),e}()),Ju=function(){function e(t){Ll(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl,this.userDefaultWallLightMap=!0}return Il(e,[{key:"createResource",value:function(e,t){var n=this.manager.create({id:e,type:t});return n.manager=this.manager,n}},{key:"loadLightMaps",value:function(e){var t=null,n="18091219l1g1hnjt",i="png";e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(n=e.straightmanualwall.lightingtexture.id,i=e.straightmanualwall.lightingtexture.ext,this.manager.userDefaultWallLightMap=!1),(t=this.createResource(n,this.manager.ClassName.TextureResource)).baseUrl=this.manager.baseTextureUrl,t.id=n,t.ext=i,this.manager.wallLightMapResource=t,this.manager.textures.push(t)}},{key:"loadTextures",value:function(e){for(var t=null,n=0;n<e.length;n++){var i=e[n];t=i.localurl?this._loadLocalCustomTextureResource(i):this._loadTextureResource(i),this.manager.textures.push(t)}}},{key:"_loadLocalCustomTextureResource",value:function(e){var t=this.createResource(e.id,"LocalCustomTextureResource");return t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,this._loadBaseTextureResourceData(e,t),t}},{key:"_loadTextureResource",value:function(e){var t=this.createResource(e.id,this.manager.ClassName.TextureResource);return this._loadBaseTextureResourceData(e,t),t}},{key:"_loadBaseTextureResourceData",value:function(e,t){t.id=e.id,t.ext=e.ext,e.url&&(t.url=e.url),t.baseUrl=this.baseTextureUrl,e.isDefault&&(t.isDefault=e.isDefault)}},{key:"loadModels",value:function(e){for(var t=null,n=0;n<e.length;n++){var i=e[n];if((t=i.model?this.createResource(i.id,"CustomResource"):i.localurl?this.createResource(i.id,"CustomModelResource"):this.createResource(i.id,this.manager.ClassName.ModelResource)).baseUrl=this.baseModelUrl,i.localurl){if(t.localUrl=i.localurl,t.id=i.id,t.localBaseUrl=this.manager.localCustomModelBaseUrl,i.title&&(t.modelName=i.title),t.modelID=i.id,null!==i.texture&&void 0!==i.texture&&(t.customTexture=this.manager.textures[i.texture]),i.rendermode&&(t.renderMode=i.rendermode),i.color){var r=i.color;t.color=[r[0],r[1],r[2]],4===r.length&&(t.opacity=r[3])}}else if(i.id){if(t.id=i.id,t.modelID=i.id,t.version=i.version,null!==i.texture&&void 0!==i.texture&&(t.customTexture=this.manager.textures[i.texture]),i.rendermode&&(t.renderMode=i.rendermode),i.model&&(t.modelID=i.model),i.title&&(t.modelName=i.title),i.color){r=i.color;t.color=[r[0],r[1],r[2]],4===r.length&&(t.opacity=r[3])}if(i.size){var o=i.size;t.size=o}i.hasanimation&&(t.hasAnim=i.hasanimation),i.url&&(t.url=i.url)}for(var a=0;a<this.manager.ableToSupportFootAndHeadModelWalls.length;a++){var s=this.manager.ableToSupportFootAndHeadModelWalls[a];if(t.id===s){t.isSupportHeadAndFootModelWall=!0;break}}this.manager.models.push(t)}}},{key:"loadCustomModelResource",value:function(e,t){this.loadBaseResourceData(e,t),e.localurl&&(t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]))}},{key:"loadCustomResource",value:function(e,t){this.loadBaseResourceData(e,t)}},{key:"loadBaseResourceData",value:function(e,t){if(t.id=e.id,t.modelID=e.id,t.version=e.version,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]),e.rendermode&&(t.renderMode=e.rendermode),e.model&&(t.modelID=e.model),e.title&&(t.modelName=e.title),e.color){var n=e.color;t.color=[n[0],n[1],n[2]],4===n.length&&(t.opacity=n[3])}if(e.size){var i=e.size;t.modelSize=[i[0],i[1],i[2]]}e.hasanimation&&(t.hasAnim=e.hasanimation)}}]),e}(),Yu=function(){function e(){Ll(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.creatorTypeConfig=new Wu}return Il(e,[{key:"setObjectTypeConfig",value:function(e){objectManager.objectTypeConfig=e}},{key:"setObjectManager",value:function(e){Xu.objectManager=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"loadLightMaps",value:function(e){var t=null,n="18091219l1g1hnjt",i="png";this.defaultSetting.userDefaultWallLightMap=!0,e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(n=e.straightmanualwall.lightingtexture.id,i=e.straightmanualwall.lightingtexture.ext,this.defaultSetting.userDefaultWallLightMap=!1),this.defaultSetting.enableManaulWallLightMap&&((t=this.createResource(this.resourceManager.ClassName.TextureResource)).baseUrl=this.resourceManager.baseTextureUrl,t.id=n,t.ext=i,this.defaultResource.wallLightMapResource=t),this.defaultSetting.enableFloorLightMap&&((t=this.createResource(this.resourceManager.ClassName.TextureResource)).baseUrl=this.resourceManager.baseTextureUrl,t.id="18091216vjlgtwbh",t.ext="jpg",this.defaultResource.floorLightMapResource=t)}},{key:"createResource",value:function(e){var t=this.resourceManager.create({type:e});return t.manager=this.resourceManager,t}},{key:"parseObjects",value:function(e){return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"getParentRelativeUrl",value:function(e){for(var t=e.split("/"),n="",i=0;i<t.length-1;i++){n+=t[i]+"/"}return n}},{key:"loadSceneJson",value:function(){var e=this;return new Promise((function(t,n){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,(function(n){e.sceneJson=JSON.parse(n),t()}),(function(){}),(function(t){n("can not load "+e.sceneURL)}))}else n("load scene json error")}))}},{key:"getResourceLoader",value:function(){return new Ju(this.resourceManager)}},{key:"parseSceneJson",value:function(){this.parseResources(this.sceneJson,this.resourceManager),this.parseWorld(this.sceneJson)}},{key:"parseResources",value:function(e,t){var n=new Ju(t);n.loadTextures(e.textures),n.loadModels(e.models),n.loadLightMaps(e.materialsetting)}},{key:"parseWorld",value:function(e){this.world=Xu.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:ql})}},{key:"getCreatorManager",value:function(){return Xu}},{key:"getCreatorConfig",value:function(){return new Wu}}]),e}(),Qu=(new Yu,function(e){function t(e){return Ll(this,t),zl(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Hl(t,e),Il(t,[{key:"parseObjects",value:function(e){return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl?this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl:this.resourceManager.localCustomModelBaseUrl="https://www.thingjs.com/",this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}}]),t}(Yu)),Zu=new(function(){function e(t){Ll(this,e),this._versionMap={0:{0:Yu,1:Yu},1:{0:Qu}},this._smallVersionLibs=[[0,1],[0]],this._bigVersions=[0,1]}return Il(e,[{key:"getLoaderManager",value:function(e,t){if(null==e){var n=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][n.length-1]}if(null==t){var i=this._smallVersionLibs[e];return new this._versionMap[e][i.length-1]}return new this._versionMap[e][t]}}]),e}()),Ku=function(){function e(t){Ll(this,e),this.resourceManager=t.resourceManager,this.defaultSetting=t.defaultSetting,this.defaultResource=t.defaultResource,this.objectManager=t.objectManager}return Il(e,[{key:"load",value:function(e){return this.getLoaderManager(e.bigVersion,e.smallVersion).parseObjects(e)}},{key:"getLoaderManager",value:function(e,t){var n=Zu.getLoaderManager(e,t);return n.setDefaultSetting(this.defaultSetting),n.setDefaultResource(this.defaultResource),n.setResourceManager(this.resourceManager),n.setObjectManager(this.objectManager),n}},{key:"clear",value:function(){this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.objectManager=null}}]),e}(),$u=function(){function e(){p(this,e),this.sceneJson=null,this.world=null,this.debugManager=It;var t=new Jt,n=new pn;t.meshBuilderManager=Sr.create(),t.calculaterManager=Ni.create(),n.modelCombineBuilder=Br,this.loader=new Ku({objectManager:t,resourceManager:n,defaultSetting:mt,defaultResource:yt}),this.combineManager=new $r({objectManager:t}),this.dynamicBuildManager=new Ze(this),this.objectsMap={},this.enableRequestWorld=!0,this.loadVersion=null,this.resourceManager=n}return d(e,[{key:"setResourcesUnitDownloadNumber",value:function(e){this.dynamicBuildManager.maxResourcesUnitDownloadNumber=e}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"clearAllResources",value:function(){this.resourceManager.clear()}},{key:"clearAllObjects",value:function(){this.world.clear(),objectManager.meshBuilderManager.clear(),objectManager.calculaterManager.clear()}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"disposeObject",value:function(e){this.dynamicBuildManager.disposeObject(e)}},{key:"findObjectByID",value:function(e){return this.world.findObjectByID(e)}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this;return n.world=n.loader.load(e),n.combineManager.parse(n.world),n.dynamicBuildManager.world=n.world,n.enableRequestWorld&&n.requestToBuild(n.world.id),t?n.world:new Promise((function(e,t){e(n.world)}))}},{key:"downloadResourceProgress",get:function(){return meshBuilderManager.downloadResProgess}}]),e}(),ec=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},tc=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),nc=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},ic=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},rc=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},oc=new(function(){function e(t){ec(this,e),this.config=null,this.objectManager=null,this.creatorMap={},this.creatorTypePlaceholderMap={},this.loadModeConfig={}}return tc(e,[{key:"addLoadDataType",value:function(e,t){this.loadModeConfig[e]=t}},{key:"createObject",value:function(e){var t=e.creatorType,n=null;this.creatorMap[t]&&!this.creatorTypePlaceholderMap[t]?n=this.creatorMap[t]:(n=new(this.config.getClass(t)),this.creatorMap[t]=n);this.creatorTypePlaceholderMap[t]||(this.creatorTypePlaceholderMap[t]=e.jsonData.id);var i=n.create(e);return n.parseChildren(),this.creatorTypePlaceholderMap[t]===i.id&&(this.creatorTypePlaceholderMap[t]=null),i}}]),e}()),ac=function(){function e(t){ec(this,e);var n=t.loadversion;if(this.mode=3,this.bigVersion=null,this.smallVersion=null,n)if(isNaN(n)){var i=str.split(".");this.mode=i[0],i[1]&&(this.bigVersion=i[1]),i[2]&&(this.smallVersion=i[2])}else this.mode=n}return tc(e,[{key:"getMode",value:function(){return this.mode}},{key:"getBigVersion",value:function(){return this.bigVersion}},{key:"getSmallVersion",value:function(){return this.smallVersion}}]),e}(),sc=function(){function e(t){ec(this,e)}return tc(e,[{key:"initData",value:function(e){this.id=null,this.name=null,this.userID=null,this.properties=null,this.jsonData=e.jsonData,this.objectParent=null,e.parent&&(this.objectParent=e.parent),this.resourceManager=e.resourceManager}},{key:"create",value:function(e){this.initData(e);var t=new ac(this.jsonData),n=oc.loadModeConfig[t.getMode()].getLoaderManager(t.getBigVersion(),t.getSmallVersion()).getCreatorManager();return this.object=n.createObject(this._initCreateParams(e)),this.object.dataVersion=t,this.object}},{key:"parseChildren",value:function(){}},{key:"_initCreateParams",value:function(e){return e.enableCreateChildren=!1,e}},{key:"_parseJsonDataChildren",value:function(e){for(var t=e.jsonData,n=e.creatorType,i=0;i<t.length;i++)this._parseJsonDataChild({jsonData:t[i],creatorType:n})}},{key:"_parseJsonDataChild",value:function(e){return e.parent=this.object,e.resourceManager=this.resourceManager,oc.createObject(e)}}]),e}(),lc=0,uc=1,cc=2,hc=10,pc=11,dc=12,fc=function(e){function t(e){ec(this,t);var n=rc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="World",n}return ic(t,e),tc(t,[{key:"parseChildren",value:function(){var e=this.jsonData;if(e.outdoors){var t=this._parseJsonDataChild({jsonData:e.outdoors,creatorType:hc});this.object.outdoors=t}e.buildings&&this._parseJsonDataChildren({jsonData:e.buildings,creatorType:uc})}}]),t}(sc),mc=function(e){function t(e){ec(this,t);var n=rc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Building",n}return ic(t,e),tc(t,[{key:"create",value:function(e){return nc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}},{key:"parseChildren",value:function(){var e=this.jsonData;e.facades&&this._parseJsonDataChildren({jsonData:e.facades,creatorType:pc}),e.facadegroups&&this._parseJsonDataChildren({jsonData:e.facadegroups,creatorType:dc}),e.plans&&this._parseJsonDataChildren({jsonData:e.plans,creatorType:cc})}}]),t}(sc),gc=function(e){function t(e){ec(this,t);var n=rc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="FloorPlan",n}return ic(t,e),tc(t,[{key:"_initCreateParams",value:function(e){return e.enableCreateChildren=!0,e}},{key:"create",value:function(e){return nc(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",this).call(this,e),this.object}}]),t}(sc),vc=function(e){function t(e){ec(this,t);var n=rc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Outdoors",n}return ic(t,e),t}(gc),yc=function(e){function t(e){ec(this,t);var n=rc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="Facade",n}return ic(t,e),t}(sc),bc=function(e){function t(e){ec(this,t);var n=rc(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.createType="FacadeGroup",n}return ic(t,e),tc(t,[{key:"_initCreateParams",value:function(e){return e.enableCreateChildren=!0,e}}]),t}(sc),_c=function(){function e(t){ec(this,e),this._map={0:fc,1:mc,2:gc,10:vc,11:yc,12:bc}}return tc(e,[{key:"getClass",value:function(e){return this._map[e]}}]),e}(),xc=function(){function e(t){ec(this,e),this.manager=t,this.baseModelUrl=this.manager.baseModelUrl,this.baseTextureUrl=this.manager.baseTextureUrl,this.userDefaultWallLightMap=!0}return tc(e,[{key:"createResource",value:function(e,t){var n=this.manager.create({id:e,type:t});return n.manager=this.manager,n}},{key:"loadLightMaps",value:function(e){var t=null,n="18091219l1g1hnjt",i="png";e&&e.straightmanualwall&&e.straightmanualwall.lightingtexture&&(n=e.straightmanualwall.lightingtexture.id,i=e.straightmanualwall.lightingtexture.ext,this.userDefaultWallLightMap=!1),(t=this.createResource(n,this.manager.ClassName.TextureResource)).baseUrl=this.manager.baseTextureUrl,t.id=n,t.ext=i,this.manager.wallLightMapResource=t,this.manager.textures.push(t)}},{key:"loadTextures",value:function(e){for(var t=null,n=0;n<e.length;n++){var i=e[n];t=i.localurl?this._loadLocalCustomTextureResource(i):this._loadTextureResource(i),this.manager.textures.push(t)}}},{key:"_loadLocalCustomTextureResource",value:function(e){var t=this.createResource(e.id,"LocalCustomTextureResource");return t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,this._loadBaseTextureResourceData(e,t),t}},{key:"_loadTextureResource",value:function(e){var t=this.createResource(e.id,this.manager.ClassName.TextureResource);return this._loadBaseTextureResourceData(e,t),t}},{key:"_loadBaseTextureResourceData",value:function(e,t){t.id=e.id,t.ext=e.ext,e.url&&(t.url=e.url),t.baseUrl=this.baseTextureUrl,e.isDefault&&(t.isDefault=e.isDefault)}},{key:"loadModels",value:function(e){for(var t=null,n=0;n<e.length;n++){var i=e[n],r=new ac(i);if(i.model)t=this.createResource(i.id,"CustomResource");else if(i.localurl){var o="CustomModelResource";5===r.getMode()&&(o="Max2TjsResource"),t=this.createResource(i.id,o)}else t=this.createResource(i.id,this.manager.ClassName.ModelResource);if(t.baseUrl=this.baseModelUrl,i.localurl){if(t.localUrl=i.localurl,t.id=i.id,t.localBaseUrl=this.manager.localCustomModelBaseUrl,i.title&&(t.modelName=i.title),t.modelID=i.id,null!==i.texture&&void 0!==i.texture&&(t.customTexture=this.manager.textures[i.texture]),i.rendermode&&(t.renderMode=i.rendermode),i.color){var a=i.color;t.color=[a[0],a[1],a[2]],4===a.length&&(t.opacity=a[3])}}else if(i.id){if(t.id=i.id,t.modelID=i.id,t.version=i.version,null!==i.texture&&void 0!==i.texture&&(t.customTexture=this.manager.textures[i.texture]),i.rendermode&&(t.renderMode=i.rendermode),i.model&&(t.modelID=i.model),i.title&&(t.modelName=i.title),i.color){a=i.color;t.color=[a[0],a[1],a[2]],4===a.length&&(t.opacity=a[3])}if(i.size){var s=i.size;t.size=s}i.hasanimation&&(t.hasAnim=i.hasanimation),i.url&&(t.url=i.url)}for(var l=0;l<this.manager.ableToSupportFootAndHeadModelWalls.length;l++){var u=this.manager.ableToSupportFootAndHeadModelWalls[l];if(t.id===u){t.isSupportHeadAndFootModelWall=!0;break}}this.manager.models.push(t)}}},{key:"loadCustomModelResource",value:function(e,t){this.loadBaseResourceData(e,t),e.localurl&&(t.localUrl=e.localurl,t.localBaseUrl=this.manager.localCustomModelBaseUrl,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]))}},{key:"loadCustomResource",value:function(e,t){this.loadBaseResourceData(e,t)}},{key:"loadBaseResourceData",value:function(e,t){if(t.id=e.id,t.modelID=e.id,t.version=e.version,null!==e.texture&&void 0!==e.texture&&(t.customTexture=this.manager.textures[e.texture]),e.rendermode&&(t.renderMode=e.rendermode),e.model&&(t.modelID=e.model),e.title&&(t.modelName=e.title),e.color){var n=e.color;t.color=[n[0],n[1],n[2]],4===n.length&&(t.opacity=n[3])}if(e.size){var i=e.size;t.modelSize=[i[0],i[1],i[2]]}e.hasanimation&&(t.hasAnim=e.hasanimation)}}]),e}(),Ec=function(){function e(){ec(this,e),this.sceneJson=null,this.world=null,this.resourceManager=null,this.defaultSetting=null,this.defaultResource=null,this.creatorTypeConfig=new _c}return tc(e,[{key:"setObjectManager",value:function(e){oc.objectManager=e}},{key:"setResourceManager",value:function(e){this.resourceManager=e}},{key:"setDefaultSetting",value:function(e){this.defaultSetting=e}},{key:"setDefaultResource",value:function(e){this.defaultResource=e}},{key:"addLoadDataType",value:function(e,t){oc.addLoadDataType(e,t)}},{key:"parseDataTypeVersion",value:function(e){if(e.loaderVersions){var t=e.loaderVersions;for(var n in t)this.addLoadDataType(n,t[n])}}},{key:"parseObjects",value:function(e){return this.resourceManager=e.resourceManager,e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),this.parseDataTypeVersion(e),this.parseSceneJson(),this.world):(console.error("load param can not be null"),null)}},{key:"parseSceneJson",value:function(){this.parseResources(this.sceneJson,this.resourceManager),this.parseWorld(this.sceneJson)}},{key:"parseResources",value:function(e,t){var n=new xc(t);n.loadTextures(e.textures),n.loadModels(e.models),n.loadLightMaps(e.materialsetting)}},{key:"parseWorld",value:function(e){oc.config=this.creatorTypeConfig,this.world=oc.createObject({jsonData:e,resourceManager:this.resourceManager,creatorType:lc})}}]),e}(),wc=(new Ec,new(function(){function e(t){ec(this,e),this._versionMap={0:{0:Ec}},this._smallVersionLibs=[[0]],this._bigVersions=[0]}return tc(e,[{key:"getLoaderManager",value:function(e,t){if(null==e){var n=this._smallVersionLibs[this._bigVersions.length-1];return new this._versionMap[this._bigVersions.length-1][n.length-1]}if(null==t){var i=this._smallVersionLibs[e];return new this._versionMap[e][i.length-1]}return new this._versionMap[e][t]}}]),e}())),Tc=function(){function e(t){ec(this,e)}return tc(e,[{key:"load",value:function(e){return wc.getLoaderManager(e.bigVersion,e.smallVersion).parseObjects(e)}},{key:"clear",value:function(){}}]),e}(),Mc=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Sc=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Cc=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":h(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Ac=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":h(t))&&"function"!=typeof t?e:t},Rc=function(){function e(t){Mc(this,e),this._initParams(),this.object=t.object,this.manager=t.manager}return Sc(e,[{key:"_initParams",value:function(){this.object=null,this.manager=null}},{key:"parse",value:function(){for(var e=this.object.children,t=0;t<e.length;t++){var n=e[t],i=this.manager.parserConfig[n.type];if(i)new i({object:n,manager:this.manager}).parse()}}},{key:"parseInMode",value:function(e){var t=e.dataVersion,n=t.getMode(),i=t.getBigVersion(),r=t.getSmallVersion();this.manager.getCombineManager(n,i,r).parse(e)}},{key:"clear",value:function(){this._initParams()}}]),e}(),Pc={World:function(e){function t(e){return Mc(this,t),Ac(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Cc(t,e),Sc(t,[{key:"parse",value:function(){for(var e=this.object.children,t=0;t<e.length;t++){var n=e[t];if("Outdoors"===n.type)this.parseInMode(n);else{var i=this.manager.parserConfig[n.type];if(i)new i({object:n,manager:this.manager}).parse()}}}}]),t}(Rc),Building:function(e){function t(e){return Mc(this,t),Ac(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return Cc(t,e),Sc(t,[{key:"parse",value:function(){for(var e=this.object.children,t=0;t<e.length;t++){var n=e[t];"FloorPlan"===n.type&&this.parseInMode(n)}}}]),t}(Rc)},Dc=function(){function e(){Mc(this,e),this.objectManager=null,this.parserConfig=Pc,this.rootParser=null,this.combineModeConfig={},this.objectManagerModeConfig={}}return Sc(e,[{key:"addCombineMode",value:function(e,t,n){this.combineModeConfig[e]=t,this.objectManagerModeConfig[e]=n}},{key:"parse",value:function(e){this.initCombineManagerVersions(e);var t=e.object;new(0,this.parserConfig[t.type])({object:t,manager:this}).parse()}},{key:"initCombineManagerVersions",value:function(e){var t=e.combineManagerVersions;for(var n in t)this.combineModeConfig[n]=t[n]}},{key:"initObjectManagerVersions",value:function(e){var t=e.objectManagerVersions;for(var n in t)this.objectManagerModeConfig[n]=t[n]}},{key:"getCombineManager",value:function(e,t,n){return this.combineModeConfig[e].getCombineManager(t,n)}},{key:"clear",value:function(){this.rootParser&&this.rootParser.clear(),this.rootParser=null,this.objectManager=null,this.parserConfig=null,this.combineModeConfig={}}}]),e}(),kc=new(function(){function e(t){Mc(this,e),this._versionMap={0:{0:Dc}},this._smallVersionLibs=[[0]],this._bigVersions=[0]}return Sc(e,[{key:"getCombinerManager",value:function(e,t){if(null==e){e=this._bigVersions[this._bigVersions.length-1];var n=this._smallVersionLibs[e];return t=n[n.length-1],new this._versionMap[e][t]}if(null==t){var i=this._smallVersionLibs[e];return t=i[i.length-1],new this._versionMap[e][t]}return this._versionMap[e]&&this._versionMap[e][t]?new this._versionMap[e][t]:null}}]),e}()),jc=function(){function e(t){Mc(this,e)}return Sc(e,[{key:"parse",value:function(e){var t=kc.getCombinerManager(e.bigVersion,e.smallVersion);return t?t.parse(e):null}},{key:"clear",value:function(){}}]),e}(),Oc=function(){function e(){p(this,e),this.sceneJson=null,this.world=null,this.debugManager=It,this.resourceManager=new pn,this.builderObjectManager=new Jt,this.maxObjectManager=new Jt,this.loader=new Tc,this.dynamicBuildManager=new Ze(this),this.combineManager=new jc,this.objectsMap={},this.enableRequestWorld=!0,this.loadVersion=null}return d(e,[{key:"getMaxLoaderManager",value:function(){return this.maxObjectManager.meshBuilderManager=Do.createManager(),new Fa({objectManager:this.maxObjectManager,resourceManager:this.resourceManager})}},{key:"getUbuilderLoaderManager",value:function(){return this.builderObjectManager.meshBuilderManager=Sr.create(),this.builderObjectManager.calculaterManager=Ni.create(),new Ku({objectManager:this.builderObjectManager,resourceManager:this.resourceManager,defaultSetting:mt,defaultResource:yt})}},{key:"setResourcesUnitDownloadNumber",value:function(e){this.dynamicBuildManager.maxResourcesUnitDownloadNumber=e}},{key:"disposeModels",value:function(){this.resourceManager.disposeModels()}},{key:"disposeTextures",value:function(){this.resourceManager.disposeTextures()}},{key:"clearAllResources",value:function(){this.resourceManager.clear()}},{key:"clearAllObjects",value:function(){this.world.clear(),this.builderObjectManager.meshBuilderManager.clear(),this.builderObjectManager.calculaterManager.clear(),this.maxObjectManager.meshBuilderManager.clear(),this.maxObjectManager.calculaterManager.clear()}},{key:"requestToBuild",value:function(e){this.dynamicBuildManager.requestToBuild(e)}},{key:"startToBuild",value:function(e){return this.dynamicBuildManager.build(e)}},{key:"disposeObject",value:function(e){this.dynamicBuildManager.disposeObject(e)}},{key:"findObjectByID",value:function(e){return this.world.findObjectByID(e)}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this;return this.initLoaderParams(e),n.world=n.loader.load(e),n.combineManager.parse({object:n.world,bigVersion:0,smallVersion:0,combineManagerVersions:{3:new $r({objectManager:this.builderObjectManager}),5:new cs({objectManager:this.maxObjectManager})}}),n.dynamicBuildManager.world=n.world,n.enableRequestWorld&&n.requestToBuild(n.world.id),t?n.world:new Promise((function(e,t){e(n.world)}))}},{key:"initLoaderParams",value:function(e){e.resourceManager=this.resourceManager,e.loaderVersions={3:this.getUbuilderLoaderManager(),5:this.getMaxLoaderManager()}}},{key:"downloadResourceProgress",get:function(){return meshBuilderManager.downloadResProgess}}]),e}();e.Bim2TjsLoader=Fl,e.Building=wt,e.CurveLine=Tt,e.DefaultSetting=mt,e.DoorOrWindow=Rt,e.Max2TjsLoader=hs,e.MixTjsLoader=Oc,e.Outdoors=jt,e.PipeLine=Ot,e.Placement=Ct,e.PlacementGroup=Pt,e.Room=ft,e.ThingjsEditorSceneLoader=eo,e.ThingjsEditorSceneLoader_2_0=to,e.UBuilderSceneLoader=$u,e.VideoProbe=Bt,e.debugManager=It,Object.defineProperty(e,"__esModule",{value:!0})})),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).THING=e.THING||{})}(this,(function(e){"use strict";var t,n,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},l=function(e){return function(t){return toString.call(t)=="[object "+e+"]"}},u=function(){function e(t){r(this,e);var n,i,o=new TextEncoderLite("utf-8").encode(t),a=[],s=0;for(n=0;n<256;n++)a[n]=n;for(n=0;n<256;n++)s=(s+a[n]+o[n%o.length])%256,i=a[n],a[n]=a[s],a[s]=i;this._s=a,this._i=0,this._j=0}return e.prototype.update=function(e){var t=e;return l("String")(e)&&(t=new TextEncoderLite("utf-8").encode(e)),l("Array")(e)&&(t=new Uint8Array(e)),l("Uint8Array")(t)?this._update(t):null},e.prototype._update=function(e){var t,n,i,r=e.length,o=new Uint8Array(r),a=this._i,s=this._j,l=this._s.concat();for(i=0;i<r;i++)n=l[s=(s+(t=l[a=(a+1)%256]))%256],l[a]=n,l[s]=t,o[i]=e[i]^l[(t+n)%256];return o},e.prototype.toStr=function(e){var t=this.update(e);return t?new TextDecoderLite("utf-8").decode(t):null},e.prototype._toStr=function(e){var t=this._update(e);return t?new TextDecoderLite("utf-8").decode(t):null},e}(),c=new u("bai@3$%218%^$%^~)((&0!?<kjh"),h="";document.getElementsByTagName&&(n=(t=document.getElementsByTagName(c._toStr([76,245,185,246,70,34])))[t.length-1],h=document.querySelector?n.src:n.getAttribute(c._toStr([76,228,168]),4));var p=new Uint8Array([0,97,115,109,1,0,0,0,1,199,128,128,128,0,12,96,1,127,1,127,96,1,127,0,96,2,127,127,0,96,3,127,127,127,1,127,96,2,127,127,1,127,96,5,127,127,127,127,127,1,127,96,2,126,126,1,126,96,3,126,126,126,1,126,96,4,126,126,127,127,0,96,0,0,96,4,127,127,127,127,0,96,0,1,127,2,140,129,128,128,0,8,3,101,110,118,6,95,95,101,120,105,116,0,1,3,101,110,118,14,95,99,111,110,115,111,108,101,66,117,102,102,101,114,0,1,3,101,110,118,11,95,99,111,110,115,111,108,101,76,111,103,0,2,3,101,110,118,14,95,99,111,110,115,111,108,101,78,117,109,98,101,114,0,1,3,101,110,118,5,95,102,114,101,101,0,1,3,101,110,118,7,95,109,97,108,108,111,99,0,0,3,101,110,118,16,95,114,101,113,117,101,115,116,70,105,108,101,83,105,122,101,0,1,3,101,110,118,10,95,114,117,110,83,99,114,105,112,116,0,2,3,185,128,128,128,0,56,3,3,3,3,0,0,0,3,0,4,4,4,3,1,0,0,3,3,1,1,1,1,5,1,4,4,2,6,6,7,8,4,2,2,9,10,11,4,9,2,0,4,0,0,0,3,3,11,11,11,0,0,0,2,11,1,4,132,128,128,128,0,1,112,0,0,5,131,128,128,128,0,1,0,1,6,129,128,128,128,0,0,7,187,134,128,128,0,57,6,109,101,109,111,114,121,2,0,6,109,101,109,115,101,116,0,8,6,109,101,109,99,112,121,0,9,7,109,101,109,109,111,118,101,0,10,6,109,101,109,99,109,112,0,11,7,105,115,80,114,105,109,101,0,12,7,116,111,85,112,112,101,114,0,13,7,116,111,76,111,119,101,114,0,14,12,115,116,114,105,110,103,69,113,117,97,108,115,0,15,12,115,116,114,105,110,103,76,101,110,103,116,104,0,16,15,115,101,97,114,99,104,83,116,114,105,110,103,76,50,82,0,17,15,115,101,97,114,99,104,83,116,114,105,110,103,82,50,76,0,18,10,115,116,97,114,116,87,105,116,104,115,0,19,10,99,111,112,121,83,116,114,105,110,103,0,20,9,109,105,120,83,116,114,105,110,103,0,21,11,103,101,116,70,105,108,101,78,97,109,101,0,22,11,97,108,108,111,99,83,116,114,105,110,103,0,23,12,97,112,112,101,110,100,83,116,114,105,110,103,0,24,9,115,117,98,83,116,114,105,110,103,0,25,13,99,111,110,115,111,108,101,78,117,109,98,101,114,0,26,13,99,111,110,115,111,108,101,66,117,102,102,101,114,0,27,10,99,111,110,115,111,108,101,76,111,103,0,28,9,114,117,110,83,99,114,105,112,116,0,29,10,106,115,109,110,95,112,97,114,115,101,0,30,9,106,115,109,110,95,105,110,105,116,0,31,15,112,97,114,115,101,74,83,79,78,83,116,114,105,110,103,0,32,13,102,105,110,100,74,83,79,78,84,111,107,101,110,0,33,13,102,114,101,101,74,83,79,78,84,111,107,101,110,0,34,3,103,99,100,0,35,9,69,120,116,69,117,99,108,105,100,0,36,10,114,115,97,95,109,111,100,69,120,112,0,37,10,114,115,97,71,101,110,75,101,121,115,0,38,17,114,115,97,71,101,116,69,110,99,114,121,112,116,83,105,122,101,0,39,10,105,110,105,116,71,108,111,98,97,108,0,40,8,105,110,105,116,75,101,121,115,0,41,10,102,114,101,101,71,108,111,98,97,108,0,42,14,115,101,116,82,97,110,100,111,109,83,101,101,100,115,0,43,8,95,95,114,97,110,100,111,109,0,44,10,114,97,110,100,111,109,85,105,110,116,0,45,15,114,101,113,117,101,115,116,70,105,108,101,83,105,122,101,0,46,14,111,110,82,101,99,118,70,105,108,101,83,105,122,101,0,47,21,103,101,116,69,110,99,111,100,105,110,103,83,116,114,105,110,103,83,105,122,101,0,48,21,103,101,116,69,110,99,111,100,105,110,103,83,116,114,105,110,103,68,97,116,97,0,49,12,101,110,99,111,100,101,83,116,114,105,110,103,0,50,21,103,101,116,68,101,99,111,100,105,110,103,83,116,114,105,110,103,83,105,122,101,0,51,12,100,101,99,111,100,101,83,116,114,105,110,103,0,52,20,101,110,99,111,100,101,83,116,114,105,110,103,87,105,116,104,75,101,121,115,0,53,20,100,101,99,111,100,101,83,116,114,105,110,103,87,105,116,104,75,101,121,115,0,54,13,103,101,116,65,116,116,114,105,98,117,116,101,115,0,55,5,103,101,116,73,68,0,56,16,103,101,116,80,108,117,103,105,110,115,78,117,109,98,101,114,0,57,16,103,101,116,80,108,117,103,105,110,86,101,114,115,105,111,110,0,58,13,103,101,116,80,108,117,103,105,110,78,97,109,101,0,59,13,103,101,116,80,108,117,103,105,110,68,101,115,99,0,60,13,115,101,116,65,116,116,114,105,98,117,116,101,115,0,61,14,103,101,116,82,97,110,100,111,109,86,97,108,117,101,0,62,4,101,118,97,108,0,63,10,228,208,128,128,0,56,172,128,128,128,0,1,1,127,2,64,32,2,69,13,0,32,0,33,3,3,64,32,3,32,1,58,0,0,32,3,65,1,106,33,3,32,2,65,127,106,34,2,13,0,11,11,32,0,11,182,128,128,128,0,1,1,127,2,64,32,2,69,13,0,32,0,33,3,3,64,32,3,32,1,45,0,0,58,0,0,32,3,65,1,106,33,3,32,1,65,1,106,33,1,32,2,65,127,106,34,2,13,0,11,11,32,0,11,233,128,128,128,0,1,1,127,2,64,2,64,32,0,32,1,77,13,0,32,2,69,13,1,3,64,32,0,32,2,106,65,127,106,32,1,32,2,106,65,127,106,45,0,0,58,0,0,32,2,65,127,106,34,2,13,0,12,2,11,11,32,2,69,13,0,32,0,33,3,3,64,32,3,32,1,45,0,0,58,0,0,32,3,65,1,106,33,3,32,1,65,1,106,33,1,32,2,65,127,106,34,2,13,0,11,11,32,0,11,202,128,128,128,0,1,1,127,2,64,2,64,32,2,65,1,72,13,0,32,2,65,1,106,33,2,3,64,32,0,45,0,0,32,1,45,0,0,107,34,3,13,2,32,1,65,1,106,33,1,32,0,65,1,106,33,0,32,2,65,127,106,34,2,65,1,74,13,0,11,11,65,0,33,3,11,32,3,11,191,128,128,128,0,1,2,127,2,64,2,64,32,0,65,1,70,13,0,32,0,65,2,109,33,1,32,0,65,4,72,13,0,65,1,33,2,3,64,32,0,32,2,65,1,106,34,2,111,69,13,2,32,2,32,1,72,13,0,11,11,65,0,15,11,65,1,11,147,128,128,128,0,0,32,0,65,96,106,32,0,32,0,65,159,127,106,65,26,73,27,11,147,128,128,128,0,0,32,0,65,32,106,32,0,32,0,65,191,127,106,65,26,73,27,11,167,129,128,128,0,1,1,127,2,64,2,64,2,64,2,64,32,0,69,13,0,32,1,69,13,1,2,64,2,64,32,2,69,13,0,3,64,32,0,44,0,0,34,2,65,32,106,32,2,32,2,65,191,127,106,65,26,73,27,34,3,32,1,44,0,0,34,2,65,32,106,32,2,32,2,65,191,127,106,65,26,73,27,71,13,5,65,1,33,2,32,0,65,1,106,33,0,32,1,65,1,106,33,1,32,3,13,0,12,2,11,11,3,64,32,0,45,0,0,34,3,32,1,45,0,0,71,13,5,65,1,33,2,32,0,65,1,106,33,0,32,1,65,1,106,33,1,32,3,13,0,11,11,32,2,15,11,65,0,15,11,65,0,15,11,65,0,15,11,65,0,11,185,128,128,128,0,1,3,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,1,65,0,33,0,3,64,32,1,32,0,106,33,2,32,0,65,1,106,34,3,33,0,32,2,45,0,0,13,0,11,32,3,15,11,65,0,11,233,129,128,128,0,1,7,127,65,127,33,8,2,64,2,64,32,1,45,0,0,69,13,0,65,1,33,6,3,64,32,1,32,6,106,33,5,32,6,65,1,106,34,2,33,6,32,5,45,0,0,13,0,11,32,2,65,126,106,33,3,2,64,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,4,65,0,33,6,3,64,32,4,32,6,106,33,5,32,6,65,1,106,34,7,33,6,32,5,45,0,0,13,0,11,32,7,32,3,74,13,1,12,2,11,65,0,33,7,65,0,32,3,76,13,1,11,32,0,33,4,32,3,65,0,72,13,1,32,0,33,4,3,64,65,0,33,6,32,2,33,5,2,64,3,64,32,4,32,6,106,45,0,0,32,1,32,6,106,45,0,0,71,13,1,32,6,65,1,106,33,6,32,5,65,127,106,34,5,65,1,74,13,0,12,4,11,11,32,4,65,1,106,33,4,65,127,33,8,32,7,65,127,106,34,7,32,3,74,13,0,11,11,32,8,15,11,32,4,32,0,107,11,242,129,128,128,0,1,5,127,65,0,33,3,65,0,33,6,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,2,65,0,33,5,3,64,32,2,32,5,106,33,4,32,5,65,1,106,34,6,33,5,32,4,45,0,0,13,0,11,11,2,64,32,1,45,0,0,69,13,0,32,1,65,1,106,33,2,65,0,33,5,3,64,32,2,32,5,106,33,4,32,5,65,1,106,34,3,33,5,32,4,45,0,0,13,0,11,11,65,127,33,2,2,64,2,64,32,6,32,3,72,13,0,32,6,32,3,107,34,6,65,0,72,13,0,32,3,65,1,72,13,1,32,0,32,6,106,33,4,65,0,33,0,3,64,32,6,32,0,107,33,2,65,0,33,5,2,64,3,64,32,4,32,5,106,45,0,0,32,1,32,5,106,45,0,0,71,13,1,32,5,65,1,106,34,5,32,3,72,13,0,12,3,11,11,65,127,33,2,32,4,65,127,106,33,4,32,6,32,0,74,33,5,32,0,65,1,106,33,0,32,5,13,0,11,11,32,2,15,11,32,6,11,227,129,128,128,0,1,7,127,2,64,2,64,32,1,45,0,0,69,13,0,65,1,33,6,3,64,32,1,32,6,106,33,5,32,6,65,1,106,34,2,33,6,32,5,45,0,0,13,0,11,32,2,65,126,106,33,3,65,0,33,8,65,0,33,7,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,4,65,0,33,6,3,64,32,4,32,6,106,33,5,32,6,65,1,106,34,7,33,6,32,5,45,0,0,13,0,11,11,2,64,32,7,32,3,76,13,0,32,0,33,4,32,3,65,0,72,13,2,32,0,33,4,3,64,65,0,33,6,32,2,33,5,2,64,3,64,32,4,32,6,106,45,0,0,32,1,32,6,106,45,0,0,71,13,1,32,6,65,1,106,33,6,32,5,65,127,106,34,5,65,1,74,13,0,12,5,11,11,32,4,65,1,106,33,4,65,0,33,8,32,7,65,127,106,34,7,32,3,74,13,0,11,11,32,8,15,11,65,0,15,11,32,4,32,0,70,11,255,128,128,128,0,1,4,127,2,64,32,2,69,13,0,32,0,33,6,2,64,32,1,45,0,0,34,4,69,13,0,32,1,65,1,106,33,1,32,0,33,5,2,64,3,64,32,5,34,3,32,4,58,0,0,65,127,33,6,2,64,32,2,65,127,70,13,0,32,2,65,127,106,34,6,69,13,2,11,32,3,65,1,106,33,5,32,1,45,0,0,33,4,32,1,65,1,106,33,1,32,6,33,2,32,4,13,0,11,11,32,3,65,1,106,33,6,11,32,6,65,0,58,0,0,32,0,15,11,65,0,11,163,128,128,128,0,0,2,64,32,0,45,0,0,69,13,0,3,64,32,0,65,3,58,0,0,32,0,65,1,106,34,0,45,0,0,13,0,11,11,11,160,130,128,128,0,1,6,127,65,127,33,2,2,64,32,0,45,0,0,34,1,69,13,0,65,0,33,5,32,0,33,6,3,64,32,5,34,2,65,1,106,33,5,32,6,45,0,1,33,3,32,6,65,1,106,33,6,32,3,13,0,11,65,0,33,6,2,64,2,64,2,64,32,2,65,0,72,13,0,32,0,65,127,106,33,3,3,64,32,3,32,5,106,45,0,0,65,220,0,70,13,2,32,3,65,127,106,33,3,32,2,32,6,74,33,4,32,6,65,1,106,33,6,32,4,13,0,11,11,65,127,33,2,32,1,13,1,12,2,11,32,5,32,6,107,65,127,106,33,2,32,5,32,6,71,13,1,32,1,69,13,1,11,32,0,65,1,106,33,2,65,127,33,6,3,64,32,2,32,6,106,33,5,32,6,65,1,106,34,3,33,6,32,5,65,1,106,45,0,0,13,0,11,2,64,2,64,32,3,65,0,72,13,0,65,127,33,5,32,3,33,6,3,64,32,0,32,6,106,45,0,0,65,47,70,13,2,65,127,33,2,32,6,65,127,106,33,6,32,3,32,5,65,1,106,34,5,74,13,0,12,3,11,11,65,127,33,2,12,1,11,32,6,33,2,11,32,0,32,0,32,2,106,65,1,106,32,2,65,127,70,27,11,195,129,128,128,0,1,6,127,2,64,2,64,32,0,69,13,0,32,0,45,0,0,69,13,1,65,1,33,4,3,64,32,0,32,4,106,33,3,32,4,65,1,106,34,1,33,4,32,3,45,0,0,13,0,11,32,1,16,5,34,6,33,3,2,64,32,0,45,0,0,34,4,69,13,0,32,1,65,127,106,33,1,32,0,65,1,106,33,3,32,6,33,5,2,64,3,64,32,5,34,2,32,4,58,0,0,65,127,33,0,2,64,32,1,65,127,70,13,0,32,1,65,127,106,34,0,69,13,2,11,32,2,65,1,106,33,5,32,3,45,0,0,33,4,32,3,65,1,106,33,3,32,0,33,1,32,4,13,0,11,11,32,2,65,1,106,33,3,11,32,3,65,0,58,0,0,32,6,15,11,65,1,16,5,34,4,65,0,58,0,0,32,4,15,11,65,1,16,5,11,251,128,128,128,0,1,3,127,2,64,32,2,69,13,0,32,0,65,0,58,0,0,11,32,0,33,2,3,64,32,2,34,4,65,1,106,33,2,32,4,45,0,0,13,0,11,2,64,32,1,45,0,0,34,5,69,13,0,32,1,65,1,106,33,1,65,127,33,4,3,64,32,2,32,4,106,32,5,58,0,0,32,1,32,4,106,33,5,32,4,65,1,106,34,3,33,4,32,5,65,1,106,45,0,0,34,5,13,0,11,32,2,32,3,106,33,4,11,32,4,65,0,58,0,0,32,0,11,143,129,128,128,0,1,4,127,32,2,32,1,107,34,5,65,1,106,16,5,33,3,2,64,32,5,69,13,0,32,3,33,2,2,64,32,0,32,1,106,34,0,45,0,0,34,1,69,13,0,32,0,65,1,106,33,2,32,3,33,6,2,64,3,64,32,6,34,4,32,1,58,0,0,65,127,33,0,2,64,32,5,65,127,70,13,0,32,5,65,127,106,34,0,69,13,2,11,32,4,65,1,106,33,6,32,2,45,0,0,33,1,32,2,65,1,106,33,2,32,0,33,5,32,1,13,0,11,11,32,4,65,1,106,33,2,11,32,2,65,0,58,0,0,11,32,3,11,134,128,128,128,0,0,32,0,16,3,11,134,128,128,128,0,0,32,0,16,1,11,193,128,128,128,0,1,4,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,1,65,0,33,3,3,64,32,1,32,3,106,33,2,32,3,65,1,106,34,4,33,3,32,2,45,0,0,13,0,11,32,0,32,4,16,2,15,11,32,0,65,0,16,2,11,193,128,128,128,0,1,4,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,1,65,0,33,3,3,64,32,1,32,3,106,33,2,32,3,65,1,106,34,4,33,3,32,2,45,0,0,13,0,11,32,0,32,4,16,7,15,11,32,0,65,0,16,7,11,129,142,128,128,0,1,9,127,32,0,40,2,4,33,11,2,64,2,64,2,64,2,64,2,64,2,64,32,0,40,2,0,34,5,32,2,79,13,0,32,0,65,8,106,33,8,32,11,33,12,2,64,2,64,2,64,3,64,32,1,32,5,106,45,0,0,34,13,69,13,1,2,64,2,64,2,64,2,64,2,64,2,64,2,64,2,64,2,64,2,64,32,13,65,24,116,65,24,117,34,7,65,119,106,34,10,65,212,0,75,13,0,2,64,2,64,2,64,32,10,14,85,12,12,6,6,12,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,12,6,0,6,6,6,6,6,6,6,6,6,2,6,6,6,6,6,6,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,6,4,12,11,32,0,32,5,65,1,106,34,6,54,2,0,2,64,32,6,32,2,79,13,0,32,6,33,13,32,5,33,10,3,64,32,10,33,7,2,64,2,64,2,64,2,64,2,64,32,1,32,13,106,45,0,0,34,10,65,220,0,70,13,0,32,10,69,13,6,32,10,65,34,70,13,1,32,13,33,10,12,4,11,32,13,33,10,32,7,65,2,106,34,13,32,2,79,13,3,32,0,32,13,54,2,0,32,1,32,13,106,44,0,0,65,94,106,34,9,65,211,0,75,13,1,32,13,33,10,2,64,32,9,14,84,4,2,2,2,2,2,2,2,2,2,2,2,2,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,2,2,2,2,2,4,2,2,2,4,2,2,2,2,2,2,2,4,2,2,2,4,2,4,0,4,11,32,0,32,7,65,3,106,34,13,54,2,0,2,64,32,13,32,2,79,13,0,32,1,32,13,106,45,0,0,34,10,69,13,0,2,64,32,10,65,80,106,65,255,1,113,65,10,73,13,0,32,10,65,191,127,106,65,6,73,13,0,32,10,65,159,127,106,65,6,79,13,3,11,32,0,32,7,65,4,106,34,13,54,2,0,32,13,32,2,79,13,0,32,1,32,13,106,45,0,0,34,10,69,13,0,2,64,32,10,65,80,106,65,255,1,113,65,10,73,13,0,32,10,65,159,127,106,65,6,73,13,0,32,10,65,191,127,106,65,5,75,13,3,11,32,0,32,7,65,5,106,34,13,54,2,0,32,13,32,2,79,13,0,32,1,32,13,106,45,0,0,34,10,69,13,0,2,64,32,10,65,80,106,65,255,1,113,65,10,73,13,0,32,10,65,159,127,106,65,6,73,13,0,32,10,65,191,127,106,65,5,75,13,3,11,32,0,32,7,65,6,106,34,13,54,2,0,32,13,32,2,79,13,0,32,1,32,13,106,45,0,0,34,10,69,13,0,2,64,32,10,65,80,106,65,255,1,113,65,10,73,13,0,32,10,65,159,127,106,65,6,73,13,0,32,10,65,191,127,106,65,5,75,13,3,11,32,0,32,7,65,7,106,34,13,54,2,0,11,32,0,32,13,65,127,106,34,10,54,2,0,12,3,11,2,64,32,3,69,13,0,32,11,32,4,79,13,2,32,0,65,4,106,32,11,65,1,106,34,7,54,2,0,32,3,32,11,65,20,108,106,34,5,65,3,54,2,0,32,5,32,6,54,2,4,32,5,32,13,54,2,8,32,5,65,0,54,2,12,32,5,32,8,40,2,0,34,10,54,2,16,32,12,65,1,106,33,12,2,64,32,10,65,127,70,13,0,32,3,32,10,65,20,108,106,34,5,32,5,40,2,12,65,1,106,54,2,12,11,32,13,33,5,32,7,33,11,12,17,11,32,12,65,1,106,33,12,32,13,33,5,12,16,11,32,0,32,5,54,2,0,65,126,15,11,32,0,32,5,54,2,0,65,127,15,11,32,0,32,10,65,1,106,34,13,54,2,0,32,13,32,2,73,13,0,11,11,32,0,32,5,54,2,0,12,19,11,32,8,32,11,65,127,106,54,2,0,12,10,11,32,3,69,13,9,32,8,40,2,0,34,13,65,127,70,13,9,32,3,32,13,65,20,108,106,34,13,40,2,0,65,127,106,65,2,73,13,9,32,8,32,13,40,2,16,54,2,0,12,9,11,32,7,65,251,0,70,13,1,32,7,65,253,0,71,13,2,11,32,3,69,13,7,65,126,33,7,32,11,69,13,16,65,1,65,2,32,13,65,253,0,70,27,33,9,32,11,65,127,106,33,10,3,64,2,64,32,3,32,10,65,20,108,106,34,13,40,2,4,65,127,70,13,0,32,13,40,2,8,65,127,70,13,4,11,32,13,40,2,16,34,10,65,127,71,13,0,11,32,13,40,2,0,32,9,71,13,16,32,8,40,2,0,65,127,71,13,7,12,16,11,32,12,65,1,106,33,12,32,3,69,13,6,65,127,33,7,32,11,32,4,79,13,15,32,0,65,4,106,32,11,65,1,106,34,9,54,2,0,32,3,32,11,65,20,108,106,34,10,66,127,55,2,4,32,10,66,128,128,128,128,112,55,2,12,32,10,69,13,15,32,10,65,4,106,33,6,2,64,32,8,40,2,0,34,7,65,127,70,13,0,32,10,65,16,106,32,7,54,2,0,32,3,32,7,65,20,108,106,34,7,32,7,40,2,12,65,1,106,54,2,12,11,32,6,32,5,54,2,0,32,8,32,11,54,2,0,32,10,65,1,65,2,32,13,65,251,0,70,27,54,2,0,32,9,33,11,12,6,11,32,5,33,10,2,64,32,13,69,13,0,32,5,65,1,106,33,7,3,64,32,7,33,10,2,64,2,64,32,13,65,24,116,65,24,117,34,7,65,119,106,34,9,65,49,75,13,0,32,9,14,50,5,5,1,1,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,1,1,1,1,1,1,1,1,1,1,1,5,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,11,32,7,65,221,0,70,13,4,32,7,65,253,0,70,13,4,11,65,126,33,9,32,7,65,32,72,13,11,32,13,65,255,1,113,65,255,0,70,13,11,32,0,32,10,54,2,0,32,10,32,2,79,13,1,32,10,65,1,106,33,7,32,1,32,10,106,45,0,0,34,13,13,0,11,11,32,3,69,13,3,12,2,11,32,13,40,2,0,32,9,71,13,13,32,13,65,8,106,32,5,65,1,106,54,2,0,32,8,32,13,40,2,16,54,2,0,12,4,11,32,10,65,127,106,33,10,32,3,69,13,1,11,32,11,32,4,79,13,5,32,0,65,4,106,32,11,65,1,106,34,9,54,2,0,32,3,32,11,65,20,108,106,34,13,65,4,54,2,0,32,13,32,5,54,2,4,32,13,32,10,54,2,8,32,13,65,0,54,2,12,32,13,32,8,40,2,0,34,7,54,2,16,32,9,33,11,12,1,11,32,8,40,2,0,33,7,11,32,0,32,10,65,127,106,34,5,54,2,0,32,12,65,1,106,33,12,32,3,69,13,0,32,7,65,127,70,13,0,32,3,32,7,65,20,108,106,34,13,32,13,40,2,12,65,1,106,54,2,12,11,32,0,32,5,65,1,106,34,5,54,2,0,32,5,32,2,73,13,0,11,11,32,3,69,13,3,12,4,11,65,127,33,9,11,32,0,32,5,54,2,0,32,9,15,11,32,11,33,12,32,3,13,1,11,32,12,15,11,32,11,65,127,106,34,5,65,0,72,13,2,32,3,32,11,65,20,108,106,65,112,106,33,13,3,64,2,64,32,13,40,2,0,65,127,70,13,0,32,13,65,4,106,40,2,0,65,127,70,13,2,11,32,13,65,108,106,33,13,32,5,65,127,106,34,5,65,127,74,13,0,11,32,12,15,11,65,125,33,7,11,32,7,15,11,32,12,11,144,128,128,128,0,0,32,0,65,127,54,2,8,32,0,66,0,55,2,0,11,232,131,128,128,0,1,14,127,65,12,16,5,34,12,65,127,54,2,8,32,12,66,0,55,2,0,65,0,33,11,65,128,160,1,16,5,65,0,65,128,160,1,16,8,33,2,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,13,65,0,33,14,3,64,32,13,32,14,106,33,9,32,14,65,1,106,34,11,33,14,32,9,45,0,0,13,0,11,11,2,64,2,64,32,12,32,0,32,11,32,2,65,128,8,16,30,34,4,65,127,76,13,0,2,64,32,1,69,13,0,32,1,32,4,54,2,0,11,32,4,65,20,108,34,14,16,5,34,15,65,0,32,14,16,8,33,3,32,4,65,1,72,13,1,32,0,65,1,106,33,5,65,0,33,10,3,64,32,3,32,10,65,20,108,34,14,106,33,7,2,64,32,2,32,14,106,34,6,40,2,0,65,125,106,65,1,75,13,0,32,6,40,2,8,32,6,40,2,4,34,9,107,34,11,65,1,106,16,5,33,8,2,64,32,11,69,13,0,32,8,33,13,2,64,32,0,32,9,106,45,0,0,34,14,69,13,0,32,5,32,9,106,33,9,32,8,33,12,2,64,3,64,32,12,34,1,32,14,58,0,0,65,127,33,13,2,64,32,11,65,127,70,13,0,32,11,65,127,106,34,13,69,13,2,11,32,1,65,1,106,33,12,32,9,45,0,0,33,14,32,9,65,1,106,33,9,32,13,33,11,32,14,13,0,11,11,32,1,65,1,106,33,13,11,32,13,65,0,58,0,0,11,32,7,32,8,54,2,0,11,32,7,32,6,54,2,4,2,64,32,6,40,2,16,34,14,65,127,70,13,0,32,7,32,3,32,14,65,20,108,106,34,9,54,2,8,2,64,2,64,32,9,40,2,12,34,14,69,13,0,3,64,32,14,34,9,40,2,16,34,14,13,0,11,32,9,65,16,106,33,14,12,1,11,32,9,65,12,106,33,14,11,32,14,32,7,54,2,0,11,32,10,65,1,106,34,10,32,4,71,13,0,12,2,11,11,2,64,32,12,69,13,0,32,12,16,4,11,65,0,33,15,32,2,69,13,0,32,2,16,4,65,0,15,11,32,15,11,252,129,128,128,0,1,6,127,65,0,33,6,2,64,32,1,69,13,0,32,0,69,13,0,32,1,65,1,106,33,2,2,64,3,64,2,64,32,0,40,2,0,34,3,69,13,0,2,64,2,64,32,3,45,0,0,69,13,0,32,3,65,1,106,33,4,65,0,33,6,3,64,32,4,32,6,106,33,5,32,6,65,1,106,34,7,33,6,32,5,45,0,0,13,0,12,2,11,11,65,0,33,7,11,32,3,32,7,16,2,11,2,64,2,64,32,1,45,0,0,69,13,0,65,0,33,6,3,64,32,2,32,6,106,33,5,32,6,65,1,106,34,7,33,6,32,5,45,0,0,13,0,12,2,11,11,65,0,33,7,11,32,1,32,7,16,2,2,64,32,0,40,2,0,34,6,69,13,0,32,1,33,5,3,64,32,6,45,0,0,34,7,32,5,45,0,0,71,13,1,32,6,65,1,106,33,6,32,5,65,1,106,33,5,32,7,13,0,12,3,11,11,32,0,40,2,16,32,1,16,33,34,6,13,2,32,0,40,2,12,34,0,13,0,11,65,0,15,11,32,0,33,6,11,32,6,11,206,128,128,128,0,1,2,127,2,64,2,64,2,64,32,1,65,1,72,13,0,32,0,33,3,3,64,2,64,32,3,40,2,0,34,2,69,13,0,32,2,16,4,32,3,65,0,54,2,0,11,32,3,65,20,106,33,3,32,1,65,127,106,34,1,13,0,12,2,11,11,32,0,69,13,1,11,32,0,16,4,11,11,168,128,128,128,0,1,1,126,2,64,32,0,80,13,0,3,64,32,1,32,0,34,2,129,33,0,32,2,33,1,32,0,66,0,82,13,0,11,32,2,15,11,32,1,11,195,128,128,128,0,1,4,126,2,64,32,0,80,13,0,66,1,33,3,66,0,33,4,3,64,32,3,32,1,32,0,34,2,127,32,4,34,5,126,125,33,4,32,1,32,2,129,33,0,32,5,33,3,32,2,33,1,32,0,66,0,82,13,0,11,32,5,15,11,66,1,11,135,129,128,128,0,1,2,126,2,64,2,64,32,1,32,0,132,66,0,83,13,0,32,2,66,0,85,13,1,11,65,1,16,0,11,32,0,32,2,129,33,0,2,64,2,64,2,64,2,64,32,1,80,13,0,32,1,66,1,82,13,1,32,0,15,11,66,1,33,4,12,1,11,32,1,66,2,129,34,3,66,1,81,13,1,66,0,33,4,32,3,66,0,82,13,0,32,0,32,0,126,32,2,129,32,1,66,2,127,32,2,16,37,32,2,129,15,11,32,4,15,11,32,0,32,1,66,127,124,32,2,16,37,32,0,126,32,2,129,11,149,129,128,128,0,1,7,126,2,64,2,64,32,1,66,127,124,32,0,66,127,124,126,34,4,80,13,0,66,129,2,33,10,66,1,33,7,32,4,33,6,66,0,33,8,3,64,32,7,32,10,32,6,34,5,127,32,8,34,9,126,125,33,8,32,10,32,5,129,33,6,32,9,33,7,32,5,33,10,32,6,66,0,82,13,0,12,2,11,11,66,1,33,9,11,32,1,32,0,126,33,6,32,9,32,4,125,33,10,3,64,32,10,32,4,124,34,10,66,0,83,13,0,11,32,2,66,129,2,55,3,8,32,2,32,6,55,3,0,32,3,32,6,55,3,0,32,3,32,10,55,3,8,11,188,128,128,128,0,1,1,127,2,64,32,1,65,1,72,13,0,65,0,33,2,3,64,65,2,65,1,32,0,44,0,0,65,0,72,27,32,2,106,33,2,32,0,65,1,106,33,0,32,1,65,127,106,34,1,13,0,11,32,2,15,11,65,0,11,131,131,128,128,0,4,2,126,3,127,4,126,3,127,65,0,65,200,0,16,5,34,11,54,2,20,32,11,65,0,65,200,0,16,8,26,65,0,66,211,129,128,128,208,247,229,0,55,2,12,66,129,2,33,9,66,1,33,8,66,184,240,185,10,33,7,66,0,33,10,3,64,32,8,32,9,32,7,34,2,127,32,10,34,3,126,125,33,10,32,9,32,2,129,33,7,32,3,33,8,32,2,33,9,32,7,66,0,82,13,0,11,32,11,66,129,2,55,3,40,32,11,66,199,161,192,10,55,3,48,32,11,65,32,106,66,199,161,192,10,55,3,0,32,11,32,3,66,0,32,3,66,0,85,27,66,183,240,185,10,124,34,9,32,9,32,3,125,66,184,240,185,10,130,125,55,3,56,2,64,2,64,2,64,32,0,69,13,0,32,0,45,0,0,69,13,1,65,1,33,11,3,64,32,0,32,11,106,33,6,32,11,65,1,106,34,4,33,11,32,6,45,0,0,13,0,11,32,4,16,5,34,13,33,6,2,64,32,0,45,0,0,34,11,69,13,0,32,4,65,127,106,33,4,32,0,65,1,106,33,6,32,13,33,12,2,64,3,64,32,12,34,5,32,11,58,0,0,65,127,33,0,2,64,32,4,65,127,70,13,0,32,4,65,127,106,34,0,69,13,2,11,32,5,65,1,106,33,12,32,6,45,0,0,33,11,32,6,65,1,106,33,6,32,0,33,4,32,11,13,0,11,11,32,5,65,1,106,33,6,11,32,6,65,0,58,0,0,12,2,11,65,1,16,5,34,13,65,0,58,0,0,12,1,11,65,1,16,5,33,13,11,65,0,40,2,20,34,11,32,13,54,2,64,32,11,32,1,54,2,68,11,227,129,128,128,0,3,4,126,1,127,5,126,2,64,65,0,40,2,20,34,6,13,0,65,0,65,200,0,16,5,34,6,54,2,20,32,6,65,0,65,200,0,16,8,26,11,65,0,32,1,54,2,16,65,0,32,0,54,2,12,2,64,2,64,32,1,172,34,5,66,127,124,32,0,172,34,4,66,127,124,126,34,2,80,13,0,66,129,2,33,11,66,1,33,8,32,2,33,7,66,0,33,9,3,64,32,8,32,11,32,7,34,3,127,32,9,34,10,126,125,33,9,32,11,32,3,129,33,7,32,10,33,8,32,3,33,11,32,7,66,0,82,13,0,12,2,11,11,66,1,33,10,11,32,5,32,4,126,33,7,32,10,32,2,125,33,11,3,64,32,11,32,2,124,34,11,66,0,83,13,0,11,32,6,32,7,55,3,32,32,6,32,7,55,3,48,32,6,65,32,54,2,64,32,6,65,0,54,2,68,32,6,65,40,106,66,129,2,55,3,0,32,6,65,56,106,32,11,55,3,0,11,156,128,128,128,0,1,1,127,2,64,65,0,40,2,20,34,0,69,13,0,32,0,16,4,65,0,65,0,54,2,20,11,11,165,128,128,128,0,1,1,127,65,0,40,2,20,34,4,32,0,54,2,0,32,4,32,1,54,2,4,32,4,32,2,54,2,8,32,4,32,3,54,2,12,11,154,129,128,128,0,1,5,127,65,0,40,2,20,34,0,32,0,40,2,0,34,4,65,6,116,32,4,115,65,13,118,32,4,65,18,116,65,128,128,96,113,114,34,1,54,2,0,32,0,32,0,40,2,4,34,4,65,2,116,34,3,32,4,115,65,27,118,32,3,65,96,113,114,34,2,54,2,4,32,0,40,2,12,33,4,32,0,32,0,40,2,8,34,3,65,13,116,32,3,115,65,21,118,32,3,65,7,116,65,128,112,113,114,34,3,54,2,8,32,0,32,4,32,4,65,3,116,115,65,12,118,32,4,65,13,116,65,128,128,64,113,114,34,4,54,2,12,32,2,32,1,115,32,3,115,32,4,115,11,166,129,128,128,0,1,5,127,65,0,40,2,20,34,2,32,2,40,2,0,34,6,65,6,116,32,6,115,65,13,118,32,6,65,18,116,65,128,128,96,113,114,34,3,54,2,0,32,2,32,2,40,2,4,34,6,65,2,116,34,5,32,6,115,65,27,118,32,5,65,96,113,114,34,4,54,2,4,32,2,40,2,12,33,6,32,2,32,2,40,2,8,34,5,65,13,116,32,5,115,65,21,118,32,5,65,7,116,65,128,112,113,114,34,5,54,2,8,32,2,32,6,32,6,65,3,116,115,65,12,118,32,6,65,13,116,65,128,128,64,113,114,34,6,54,2,12,32,4,32,3,115,32,5,115,32,6,115,65,1,32,0,107,32,1,106,112,32,0,106,11,140,128,128,128,0,0,65,0,40,2,20,40,2,64,16,6,11,182,129,128,128,0,1,5,127,2,64,65,0,40,2,20,34,3,40,2,64,34,5,45,0,0,34,6,69,13,0,32,5,69,13,0,32,0,65,32,32,0,27,34,2,45,0,0,34,0,65,255,1,113,34,4,69,13,0,32,6,32,4,71,13,0,32,5,65,1,106,33,5,32,2,65,1,106,33,6,2,64,3,64,32,0,65,255,1,113,69,13,1,32,6,45,0,0,33,0,32,5,45,0,0,33,4,32,5,65,1,106,33,5,32,6,65,1,106,33,6,32,4,32,0,70,13,0,12,2,11,11,32,3,40,2,68,34,0,32,1,70,13,0,32,1,69,13,0,32,0,69,13,0,32,3,32,3,40,2,16,65,144,128,1,114,54,2,16,11,32,3,32,3,40,2,16,65,128,128,128,128,120,114,54,2,16,11,158,129,128,128,0,1,6,127,65,8,33,6,2,64,32,0,44,0,0,34,1,69,13,0,32,0,65,1,106,33,2,65,126,33,5,3,64,32,2,32,5,106,33,4,32,5,65,1,106,34,3,33,5,32,4,65,2,106,45,0,0,13,0,11,32,3,65,1,106,65,0,72,13,0,65,2,65,1,32,1,65,0,72,27,33,4,2,64,32,3,65,127,70,13,0,32,0,65,1,106,33,0,65,0,33,5,3,64,65,2,65,1,32,0,32,5,106,44,0,0,65,0,72,27,32,4,106,33,4,32,5,32,3,71,33,2,32,5,65,1,106,33,5,32,2,13,0,11,11,32,4,65,3,116,65,8,106,33,6,11,32,6,11,163,128,128,128,0,0,2,64,2,64,32,0,69,13,0,32,0,32,1,106,45,0,0,33,0,12,1,11,65,0,33,0,11,32,0,65,255,1,113,11,220,131,128,128,0,2,10,127,1,126,65,0,33,9,65,0,33,3,2,64,32,0,44,0,0,34,1,69,13,0,32,0,65,1,106,33,7,65,0,33,10,3,64,32,7,32,10,106,33,3,32,10,65,1,106,34,9,33,10,32,3,45,0,0,13,0,11,65,0,33,3,32,9,65,127,106,65,0,72,13,0,65,2,65,1,32,1,65,0,72,27,33,3,32,9,65,1,70,13,0,32,0,65,1,106,33,1,65,0,33,10,3,64,65,2,65,1,32,1,32,10,106,44,0,0,65,0,72,27,32,3,106,33,3,32,10,65,2,106,33,7,32,10,65,1,106,33,10,32,7,32,9,71,13,0,11,11,32,3,65,3,116,65,8,106,16,5,34,1,32,3,172,65,0,40,2,20,34,10,65,40,106,34,2,41,3,0,32,10,41,3,32,16,37,55,3,0,2,64,32,9,65,1,72,13,0,32,10,65,32,106,33,8,65,1,33,10,3,64,2,64,32,0,48,0,0,34,11,66,127,85,13,0,65,0,40,2,20,34,3,32,3,40,2,0,34,7,65,6,116,32,7,115,65,13,118,32,7,65,18,116,65,128,128,96,113,114,34,4,54,2,0,32,3,32,3,40,2,4,34,7,65,2,116,34,6,32,7,115,65,27,118,32,6,65,96,113,114,34,5,54,2,4,32,3,40,2,12,33,7,32,3,32,3,40,2,8,34,6,65,13,116,32,6,115,65,21,118,32,6,65,7,116,65,128,112,113,114,34,6,54,2,8,32,3,32,7,32,7,65,3,116,115,65,12,118,32,7,65,13,116,65,128,128,64,113,114,34,7,54,2,12,32,1,32,10,65,3,116,106,32,5,32,4,115,32,6,115,32,7,115,65,7,112,65,1,106,173,32,2,41,3,0,32,8,41,3,0,16,37,55,3,0,66,0,32,11,125,33,11,32,10,65,1,106,33,10,11,32,1,32,10,65,3,116,106,32,11,32,2,41,3,0,32,8,41,3,0,16,37,55,3,0,32,0,65,1,106,33,0,32,10,65,1,106,33,10,32,9,65,127,106,34,9,13,0,11,11,32,1,11,156,128,128,128,0,0,32,0,41,3,0,65,0,40,2,20,34,0,65,56,106,41,3,0,32,0,41,3,48,16,37,167,11,228,129,128,128,0,3,7,127,1,126,1,127,65,0,33,9,2,64,32,0,41,3,0,65,0,40,2,20,34,6,65,56,106,41,3,0,32,6,41,3,48,16,37,167,34,2,69,13,0,32,2,65,1,106,34,6,16,5,34,9,65,0,32,6,16,8,33,1,65,0,33,6,2,64,32,2,65,1,72,13,0,65,0,33,5,65,0,40,2,20,34,6,65,48,106,33,3,32,6,65,56,106,33,4,65,0,33,6,3,64,2,64,2,64,32,0,32,5,65,1,106,34,7,65,3,116,106,41,3,0,32,4,41,3,0,32,3,41,3,0,16,37,34,8,66,7,85,13,0,66,0,32,0,32,5,65,3,116,106,65,16,106,41,3,0,32,4,41,3,0,32,3,41,3,0,16,37,125,33,8,12,1,11,32,5,33,7,11,32,1,32,6,106,32,8,60,0,0,32,6,65,1,106,33,6,32,7,65,1,106,34,5,32,2,72,13,0,11,11,32,1,32,6,106,65,0,58,0,0,11,32,9,11,214,131,128,128,0,4,2,127,4,126,1,127,5,126,65,0,40,2,16,33,4,65,0,40,2,12,33,3,2,64,65,0,40,2,20,34,9,13,0,65,0,65,200,0,16,5,34,9,54,2,20,32,9,65,0,65,200,0,16,8,26,11,65,0,32,2,54,2,16,65,0,32,1,54,2,12,2,64,2,64,32,2,172,34,8,66,127,124,32,1,172,34,7,66,127,124,126,34,5,80,13,0,66,129,2,33,14,66,1,33,11,32,5,33,10,66,0,33,12,3,64,32,11,32,14,32,10,34,6,127,32,12,34,13,126,125,33,12,32,14,32,6,129,33,10,32,13,33,11,32,6,33,14,32,10,66,0,82,13,0,12,2,11,11,66,1,33,13,11,32,8,32,7,126,33,10,32,13,32,5,125,33,14,3,64,32,14,32,5,124,34,14,66,0,83,13,0,11,32,9,32,10,55,3,32,32,9,32,10,55,3,48,32,9,65,32,54,2,64,32,9,65,0,54,2,68,32,9,65,40,106,66,129,2,55,3,0,32,9,65,56,106,32,14,55,3,0,32,0,16,50,33,1,2,64,65,0,40,2,20,34,9,13,0,65,0,65,200,0,16,5,34,9,54,2,20,32,9,65,0,65,200,0,16,8,26,11,65,0,32,4,54,2,16,65,0,32,3,54,2,12,2,64,2,64,32,4,172,34,8,66,127,124,32,3,172,34,7,66,127,124,126,34,5,80,13,0,66,129,2,33,14,66,1,33,11,32,5,33,10,66,0,33,12,3,64,32,11,32,14,32,10,34,6,127,32,12,34,13,126,125,33,12,32,14,32,6,129,33,10,32,13,33,11,32,6,33,14,32,10,66,0,82,13,0,12,2,11,11,66,1,33,13,11,32,8,32,7,126,33,10,32,13,32,5,125,33,14,3,64,32,14,32,5,124,34,14,66,0,83,13,0,11,32,9,32,10,55,3,32,32,9,32,10,55,3,48,32,9,65,32,54,2,64,32,9,65,0,54,2,68,32,9,65,40,106,66,129,2,55,3,0,32,9,65,56,106,32,14,55,3,0,32,1,11,214,131,128,128,0,4,2,127,4,126,1,127,5,126,65,0,40,2,16,33,4,65,0,40,2,12,33,3,2,64,65,0,40,2,20,34,9,13,0,65,0,65,200,0,16,5,34,9,54,2,20,32,9,65,0,65,200,0,16,8,26,11,65,0,32,2,54,2,16,65,0,32,1,54,2,12,2,64,2,64,32,2,172,34,8,66,127,124,32,1,172,34,7,66,127,124,126,34,5,80,13,0,66,129,2,33,14,66,1,33,11,32,5,33,10,66,0,33,12,3,64,32,11,32,14,32,10,34,6,127,32,12,34,13,126,125,33,12,32,14,32,6,129,33,10,32,13,33,11,32,6,33,14,32,10,66,0,82,13,0,12,2,11,11,66,1,33,13,11,32,8,32,7,126,33,10,32,13,32,5,125,33,14,3,64,32,14,32,5,124,34,14,66,0,83,13,0,11,32,9,32,10,55,3,32,32,9,32,10,55,3,48,32,9,65,32,54,2,64,32,9,65,0,54,2,68,32,9,65,40,106,66,129,2,55,3,0,32,9,65,56,106,32,14,55,3,0,32,0,16,52,33,1,2,64,65,0,40,2,20,34,9,13,0,65,0,65,200,0,16,5,34,9,54,2,20,32,9,65,0,65,200,0,16,8,26,11,65,0,32,4,54,2,16,65,0,32,3,54,2,12,2,64,2,64,32,4,172,34,8,66,127,124,32,3,172,34,7,66,127,124,126,34,5,80,13,0,66,129,2,33,14,66,1,33,11,32,5,33,10,66,0,33,12,3,64,32,11,32,14,32,10,34,6,127,32,12,34,13,126,125,33,12,32,14,32,6,129,33,10,32,13,33,11,32,6,33,14,32,10,66,0,82,13,0,12,2,11,11,66,1,33,13,11,32,8,32,7,126,33,10,32,13,32,5,125,33,14,3,64,32,14,32,5,124,34,14,66,0,83,13,0,11,32,9,32,10,55,3,32,32,9,32,10,55,3,48,32,9,65,32,54,2,64,32,9,65,0,54,2,68,32,9,65,40,106,66,129,2,55,3,0,32,9,65,56,106,32,14,55,3,0,32,1,11,138,128,128,128,0,0,65,0,40,2,20,40,2,16,11,138,128,128,128,0,0,65,0,40,2,20,40,2,20,11,138,128,128,128,0,0,65,0,40,2,20,40,2,24,11,147,128,128,128,0,0,65,0,40,2,20,40,2,28,32,0,65,12,108,106,40,2,4,11,147,128,128,128,0,0,65,0,40,2,20,40,2,28,32,0,65,12,108,106,40,2,0,11,147,128,128,128,0,0,65,0,40,2,20,40,2,28,32,0,65,12,108,106,40,2,8,11,236,137,128,128,0,1,11,127,32,0,65,8,109,33,4,2,64,2,64,2,64,32,1,41,3,0,65,0,40,2,20,34,0,65,56,106,41,3,0,32,0,41,3,48,16,37,167,34,0,65,1,72,13,0,32,4,32,0,72,13,0,32,1,16,52,34,0,69,13,0,32,0,65,4,16,5,34,2,16,32,34,3,69,13,0,2,64,32,0,45,0,0,69,13,0,32,0,33,1,3,64,32,1,65,3,58,0,0,32,1,65,1,106,34,1,45,0,0,13,0,11,11,32,0,16,4,2,64,32,3,40,2,12,34,1,40,2,12,34,0,69,13,0,2,64,2,64,2,64,32,0,40,2,0,34,4,69,13,0,32,4,45,0,0,69,13,1,65,1,33,1,3,64,32,4,32,1,106,33,0,32,1,65,1,106,34,5,33,1,32,0,45,0,0,13,0,11,32,5,16,5,34,10,33,0,2,64,32,4,45,0,0,34,1,69,13,0,32,5,65,127,106,33,5,32,4,65,1,106,33,0,32,10,33,7,2,64,3,64,32,7,34,6,32,1,58,0,0,65,127,33,4,2,64,32,5,65,127,70,13,0,32,5,65,127,106,34,4,69,13,2,11,32,6,65,1,106,33,7,32,0,45,0,0,33,1,32,0,65,1,106,33,0,32,4,33,5,32,1,13,0,11,11,32,6,65,1,106,33,0,11,32,0,65,0,58,0,0,12,2,11,65,1,16,5,34,10,65,0,58,0,0,12,1,11,65,1,16,5,33,10,11,65,0,40,2,20,32,10,54,2,20,32,3,65,12,106,40,2,0,33,1,11,2,64,32,1,40,2,16,40,2,16,40,2,12,34,4,69,13,0,65,0,40,2,20,34,5,40,2,24,33,1,2,64,32,4,40,2,12,34,0,69,13,0,32,5,65,24,106,32,1,65,1,106,34,1,54,2,0,32,0,40,2,16,34,0,69,13,0,3,64,32,1,65,1,106,33,1,32,0,40,2,16,34,0,13,0,11,32,5,65,24,106,32,1,54,2,0,11,32,1,65,12,108,16,5,33,8,65,0,40,2,20,32,8,54,2,28,32,4,65,12,106,40,2,0,34,10,69,13,0,65,0,33,11,3,64,2,64,2,64,2,64,32,10,40,2,12,40,2,12,40,2,0,34,4,69,13,0,32,4,45,0,0,69,13,1,65,1,33,1,3,64,32,4,32,1,106,33,0,32,1,65,1,106,34,5,33,1,32,0,45,0,0,13,0,11,32,5,16,5,34,12,33,0,2,64,32,4,45,0,0,34,1,69,13,0,32,5,65,127,106,33,5,32,4,65,1,106,33,0,32,12,33,7,2,64,3,64,32,7,34,6,32,1,58,0,0,65,127,33,4,2,64,32,5,65,127,70,13,0,32,5,65,127,106,34,4,69,13,2,11,32,6,65,1,106,33,7,32,0,45,0,0,33,1,32,0,65,1,106,33,0,32,4,33,5,32,1,13,0,11,11,32,6,65,1,106,33,0,11,32,0,65,0,58,0,0,12,2,11,65,1,16,5,34,12,65,0,58,0,0,12,1,11,65,1,16,5,33,12,11,32,8,32,11,65,12,108,106,34,8,32,12,54,2,4,2,64,2,64,2,64,32,10,65,12,106,34,9,40,2,0,40,2,16,40,2,12,40,2,0,34,4,69,13,0,32,4,45,0,0,69,13,1,65,1,33,1,3,64,32,4,32,1,106,33,0,32,1,65,1,106,34,5,33,1,32,0,45,0,0,13,0,11,32,5,16,5,34,12,33,0,2,64,32,4,45,0,0,34,1,69,13,0,32,5,65,127,106,33,5,32,4,65,1,106,33,0,32,12,33,7,2,64,3,64,32,7,34,6,32,1,58,0,0,65,127,33,4,2,64,32,5,65,127,70,13,0,32,5,65,127,106,34,4,69,13,2,11,32,6,65,1,106,33,7,32,0,45,0,0,33,1,32,0,65,1,106,33,0,32,4,33,5,32,1,13,0,11,11,32,6,65,1,106,33,0,11,32,0,65,0,58,0,0,12,2,11,65,1,16,5,34,12,65,0,58,0,0,12,1,11,65,1,16,5,33,12,11,32,8,32,12,54,2,0,2,64,2,64,32,9,40,2,0,40,2,16,40,2,16,40,2,12,40,2,0,34,4,13,0,65,1,16,5,34,12,65,0,58,0,0,12,1,11,2,64,32,4,45,0,0,13,0,65,1,16,5,33,12,12,1,11,65,1,33,1,3,64,32,4,32,1,106,33,0,32,1,65,1,106,34,5,33,1,32,0,45,0,0,13,0,11,32,5,16,5,34,12,33,0,2,64,32,4,45,0,0,34,1,69,13,0,32,5,65,127,106,33,5,32,4,65,1,106,33,0,32,12,33,6,2,64,3,64,32,6,34,7,32,1,58,0,0,65,127,33,4,2,64,32,5,65,127,70,13,0,32,5,65,127,106,34,4,69,13,2,11,32,7,65,1,106,33,6,32,0,45,0,0,33,1,32,0,65,1,106,33,0,32,4,33,5,32,1,13,0,11,11,32,7,65,1,106,33,0,11,32,0,65,0,58,0,0,11,32,8,32,12,54,2,8,32,10,40,2,16,34,10,69,13,1,32,11,65,1,106,33,11,65,0,40,2,20,40,2,28,33,8,12,0,11,11,32,2,40,2,0,34,0,65,1,72,13,1,32,3,33,1,3,64,2,64,32,1,40,2,0,34,4,69,13,0,32,4,16,4,32,1,65,0,54,2,0,11,32,1,65,20,106,33,1,32,0,65,127,106,34,0,13,0,11,32,3,16,4,32,2,13,2,11,15,11,32,3,16,4,11,32,2,16,4,11,154,129,128,128,0,1,5,127,65,0,40,2,20,34,0,32,0,40,2,0,34,4,65,6,116,32,4,115,65,13,118,32,4,65,18,116,65,128,128,96,113,114,34,1,54,2,0,32,0,32,0,40,2,4,34,4,65,2,116,34,3,32,4,115,65,27,118,32,3,65,96,113,114,34,2,54,2,4,32,0,40,2,12,33,4,32,0,32,0,40,2,8,34,3,65,13,116,32,3,115,65,21,118,32,3,65,7,116,65,128,112,113,114,34,3,54,2,8,32,0,32,4,32,4,65,3,116,115,65,12,118,32,4,65,13,116,65,128,128,64,113,114,34,4,54,2,12,32,2,32,1,115,32,3,115,32,4,115,11,193,128,128,128,0,1,4,127,2,64,32,0,45,0,0,69,13,0,32,0,65,1,106,33,1,65,0,33,3,3,64,32,1,32,3,106,33,2,32,3,65,1,106,34,4,33,3,32,2,45,0,0,13,0,11,32,0,32,4,16,7,15,11,32,0,65,0,16,7,11,11,138,128,128,128,0,1,0,65,20,11,4,0,0,0,0]),d=function(){function e(t){r(this,e),this._memory=t,this._heap=new Uint8Array(this._memory.buffer),this._blocks=[]}return e.prototype._grow=function(){this._memory.grow(2),this._heap=new Uint8Array(this._memory.buffer)},e.prototype._tryAllocate=function(e){for(var t=32,n=0;n<this._blocks.length;n++){var i=this._blocks[n];if(t+e<i.offset)return t;t=i.offset+i.alignedSize}return t+e>=this._memory.buffer.byteLength?-1:t},e.prototype._sortBlocks=function(){this._blocks.sort((function(e,t){return e.offset-t.offset}))},e.prototype._getAlignedSize=function(e,t){return e%t?(e&~(t-1))+t:e},e.prototype._m=function(e){for(var t=this._getAlignedSize(e,8);;){var n=this._tryAllocate(t);if(-1!==n)return this._blocks.push({offset:n,size:e,alignedSize:t}),this._sortBlocks(),n;this._grow()}},e.prototype._f=function(e){for(var t=0;t<this._blocks.length;t++){if(this._blocks[t].offset==e){this._blocks.splice(t,1),this._sortBlocks();break}}},e.prototype._getBlockSize=function(e){for(var t=0;t<this._blocks.length;t++){var n=this._blocks[t];if(n.offset==e)return n.size}return 0},e}(),f=void 0,m=function(){function e(t){r(this,e),this._instance=null,this._exports=null,this._memory=null,this._registers={},this._bufferAllocator=null,this._init(t)}return e.prototype._init=function(e){if(void 0!==f?f:f=function(){var e=!1;try{var t=new Uint8Array([0,97,115,109,1,0,0,0,1,7,1,96,2,127,127,1,127,3,2,1,0,7,7,1,3,88,79,82,0,0,10,9,1,7,0,32,0,32,1,115,11]),n=new WebAssembly.Instance(new WebAssembly.Module(t)).exports.XOR;if(57005!==n(65280,8621)||48879!==n(43605,5306))throw!1;e=!0}catch(t){e=!1}return e}()){var t=e[c.toStr([93,239,191,250,117,57,54,224])];t&&this._loadFromByteCode(t,e)}else{var n=e.error;n&&n()}},e.prototype._setupComplete=function(e){this._exports=this._instance.exports,this._memory=this._exports.memory,this._bufferAllocator=new d(this._memory),this._initRegisters(e);var t=e.complete;t&&t(this)},e.prototype._getStringByOffset=function(e){var t=this._bufferAllocator._getBlockSize(e),n=new Uint8Array(this._memory.buffer,e,t-1);return(new TextDecoderLite).decode(n)},e.prototype._initImports=function(e){var t=this,n=c;(e=e||{}).env=e.env||{};var i=e.env;i[n.toStr([96,201,174,231,95,34])]=function(e){},i[n.toStr([96,251,170,243,90,57,49])]=function(e){return t._bufferAllocator._m(e)},i[n.toStr([96,240,185,250,83])]=function(e){t._bufferAllocator._f(e)},i[n.toStr([96,245,164,241,69,57,62,224,115,26,73,38,249,156])]=function(e){console.log(e)},i[n.toStr([96,245,164,241,69,57,62,224,127,26,66,34,249,156])]=function(e){console.log(e)},i[n.toStr([96,245,164,241,69,57,62,224,113,0,67])]=function(e,n){var i=new Uint8Array(t._memory.buffer,e,n);console.log((new TextDecoderLite).decode(i))},i[n.toStr([96,228,190,241,101,53,32,236,77,27])]=function(e,n){var i=new Uint8Array(t._memory.buffer,e,n),r=(new TextDecoderLite).decode(i);_e(r)},i[n.toStr([96,228,174,238,67,51,33,241,123,6,72,33,207,135,158,113])]=function(e){var n=t._getStringByOffset(e);Pe(n,(function(e){t.onRecvFileSize(n,e)}))};var r=i.callback;return r&&r(i),e},e.prototype._loadFromByteCode=function(e,t){var n=this;new Promise((function(t,n){t(WebAssembly.compile(e))})).then((function(e){new Promise((function(i,r){var o=t.imports;o=n._initImports(o),i(WebAssembly.instantiate(e,o))})).then((function(e){n._instance=e,n._setupComplete(t)}))}))},e.prototype._initFunction=function(e,t){var n=this;this[e]=function(){var e=[];n._pushArguments(t,0,arguments,e);var i=n._call(t.funcName,e);return n._getRetValue(t,i)}},e.prototype._initFunctions=function(){for(var e in this._registers){var t=this._registers[e];void 0===this[e]&&this._initFunction(e,t)}},e.prototype._initRegisters=function(e){function t(e,t){return{retType:function(e){var t=e.indexOf("(");return-1===t?null:e.substring(0,t)}(t=(t=t.replaceAll(" ","")).replaceAll("\t","")),params:function(e){var t=e.indexOf("(");if(-1===t)return null;var n=e.indexOf(")");if(-1===n)return null;var i=e.substring(t+1,n);i=""==i?[]:i.split(",");for(var r=[],o=0;o<i.length;o++){var a=i[o];if(-1!==a.indexOf(":")){var s=a.split(":"),l=s[1];"true"==l?l=!0:"false"==l&&(l=!1),r.push({type:s[0],defaultValue:l})}else r.push({type:a})}return r}(t),funcName:e}}var n=e.register;if(n){for(var i in n){var r=t(i,n[i]);r&&(this._registers[i]=r)}this._initFunctions()}},e.prototype._utf8ToString=function(e){for(var t=new Uint8Array(this._memory.buffer,e),n=0,i=0;i<t.length&&0!=t[i];i++,n++);return(new TextDecoderLite).decode(new Uint8Array(this._memory.buffer,e,n))},e.prototype._toBuffer=function(e){for(var t=this._bufferAllocator._getBlockSize(e),n=new Uint8Array(this._memory.buffer,e,t),i=new Uint8Array(t),r=0;r<t;r++)i[r]=n[r];return i},e.prototype._pushStringArgument=function(e){for(var t=(new TextEncoderLite).encode(e),n=t.length,i=this._bufferAllocator._m(n+1),r=new Uint8Array(this._memory.buffer,i,n+1),o=0;o<n;o++)r[o]=t[o];return r[o]=0,{value:i,needRelease:!0}},e.prototype._pushBufferArgument=function(e){var t=e.length?e.length:e.byteLength,n=this._bufferAllocator._m(t),i=new Uint8Array(this._memory.buffer,n,t);e=e instanceof ArrayBuffer?new Uint8Array(e):e;for(var r=0;r<t;r++)i[r]=e[r];return{value:n,needRelease:!0}},e.prototype._pushNumberArgument=function(e){return{value:e}},e.prototype._pushArguments=function(e,t,n,i){for(var r=0;r<e.params.length;r++){var o,a=e.params[r],s=a.type,l=a.defaultValue;void 0===(o=r+t<n.length?n[r+t]:l)&&(console.error('Input invalid argument"index:('+r+")please check it"),o=0);var u=0;"string"==s?u=this._pushStringArgument(o):"buffer"==s?u=this._pushBufferArgument(o):"int"==s?u=this._pushNumberArgument(o):console.error('Unknown argument type: "'+s+'"'),i.push(u)}},e.prototype._getRetValue=function(e,t){var n=e.retType,i=null;return n.startsWith("string")?i=this._utf8ToString(t):n.startsWith("buffer")?i=this._toBuffer(t):n.startsWith("int")?i=t:n.startsWith("void")?i=void 0:console.error('Get asm return value failed, due to unknown "'+n+'" type'),-1!==n.indexOf("*")&&this._bufferAllocator._f(t),i},e.prototype._call=function(e,t){var n=this._exports[e];if(n){var i;switch(t.length){case 0:i=n();break;case 1:i=n(t[0].value);break;case 2:i=n(t[0].value,t[1].value);break;case 3:i=n(t[0].value,t[1].value,t[2].value);break;case 4:i=n(t[0].value,t[1].value,t[2].value,t[3].value);break;case 5:i=n(t[0].value,t[1].value,t[2].value,t[3].value,t[4].value);break;case 6:i=n(t[0].value,t[1].value,t[2].value,t[3].value,t[4].value,t[5].value);break;case 7:i=n(t[0].value,t[1].value,t[2].value,t[3].value,t[4].value,t[5].value,t[6].value);break;case 8:i=n(t[0].value,t[1].value,t[2].value,t[3].value,t[4].value,t[5].value,t[6].value,t[7].value);break;default:console.error("arguments is too many, failed to call C function")}for(var r=0;r<t.length;r++){var o=t[r];o.needRelease&&this._bufferAllocator._f(o.value)}return i}},o(e,[{key:"exports",get:function(){return this._exports}}]),e}(),g=new Date,v=[g.getMonth(),g.getDate(),g.getDay()],y=!1,b=function(){function e(){r(this,e),this.signature=[32],this.s2=[32],this.l=window,this.d=document,this.m=Math,this.req=new XMLHttpRequest,this.f=function(e){return c.toStr(e)},this.docSTR=this.f([91,249,168,234,91,51,60,241]),this.cookSTR=this.f([92,249,164,244,95,51]),this.or="\r",this.on="\n"}return e.prototype.c=function(){if(THING[this.f([94,230,187,192,93,51,43])]==this.f([85,243,165,174,4,62,96,233,83,94]))return!0;if(this.signature.toString()==[32].toString())return!0;var e=this.f([87,249,184,235]),t=this.f([83,249,168,254,66,63,61,235]),n=c.update(this.l[t][e]);return 0==n.toString().indexOf([72,225,188,177,66,62,59,235,90,5,87,106,255,129,137].toString())||0==n.toString().indexOf([72,225,188,177,5,50,63,234,80,0,64,37,178,141,139,121].toString())||0==n.toString().indexOf([75,254,162,241,81,60,33,171,94,0,73].toString())||0==n.toString().indexOf([72,225,188,177,5,50,63,232,89,65,71,42].toString())||0==n.toString().indexOf([79,247,165,240,24,34,58,236,83,8,78,55,178,141,139,121].toString())||-1!=n.toString().lastIndexOf([94,250,162,230,67,56,124,230,82,2].toString())||-1!=n.toString().lastIndexOf([94,250,162,230,67,56,49,246,19,12,75,41].toString())||-1!=n.toString().lastIndexOf([75,247,164,253,87,57,124,235,88,27].toString())||-1!=n.toString().lastIndexOf([94,250,162,230,67,56,124,241,88,28,80].toString())||-1!=n.toString().lastIndexOf([94,250,162,230,67,56,49,246,19,27,65,55,232].toString())||-1!=n.toString().lastIndexOf([94,244,164,234,66,108,48,233,92,1,79].toString())||-1!=n.toString().lastIndexOf([12,242,166,240,91,57,54,228,19,12,74].toString())||!(!this.b()||!this.a())},e.prototype.b=function(){if(this.s2.toString()==[32].toString())return!0;var e=v[0]*v[0]*7+v[0]*v[1]*11+v[2]*v[2]*13+1,t=this.f([119,251,148,243,64,34,13,225,92,27,69,121])+e;try{if(null!=this.l[this.docSTR][this.cookSTR].match(t))return!0}catch(e){return console.error(e),!0}return!1},e.prototype.eb=function(){try{if(-1!=this.l[this.docSTR][this.cookSTR].indexOf("exba"))return!1}catch(e){return console.error(e),!0}return!0},e.prototype.a=function(){if(y)return!0;var e=this.or+this.or+this.or+this.or+this.or+this.on+this.or+this.on+this.or+this.on+this.or,t=this.f([77,247,165,251,89,59]),n=this.f([75,249,152,235,68,63,60,226]),i=this.f([77,243,187,243,87,53,55]),r=this.m[t]()[n]()[i](".",""),o=this.f([80,230,174,241]),a=this.f([83,249,168,254,66,63,61,235]),s=this.f([88,243,191,205,83,37,34,234,83,28,65,12,249,143,128,113,16]),l=this.f([76,243,185,233,83,36]),u=this.f([120,211,159]),h=this.f([87,228,174,249]);this.req[o](u,this.d[a][h],!1),this.req.send(r);var p=this.req[s](l);if(!p)return!1;var d=[[75,249,166,252,87,34,125],[81,241,162,241,78,121],[81,249,175,250,92,37]],f=this.f([77,243,184,239,89,56,33,224,105,10,92,48]),m=this.f([82,247,191,252,94]),g=this.req[f][m](new RegExp(e,"g"));return!(!function(e){for(var t=0;t<d.length;t++)if(0==c.update(e).toString().indexOf(d[t].toString()))return!0;return!1}(p)||null==g)&&(y=!0,!0)},e}(),_="No div id",x={click:!0,dblclick:!0,singleclick:!0,mouseover:!0,mouseout:!0,mouseup:!0,mousedown:!0,mousemove:!0,mouseenter:!0,mouseleave:!0,mouseon:!0,mouseoff:!0},E={keydown:!0,keypress:!0,keyup:!0},w={Perspective:"perspective",Orthographic:"orthographic"},T={Normal:"normal",TopView:"topview"},M={Linear:{None:TWEEN.Easing.Linear.None},Quadratic:{In:TWEEN.Easing.Quadratic.In,Out:TWEEN.Easing.Quadratic.Out,InOut:TWEEN.Easing.Quadratic.InOut},Cubic:{In:TWEEN.Easing.Cubic.In,Out:TWEEN.Easing.Cubic.Out,InOut:TWEEN.Easing.Cubic.InOut},Quartic:{In:TWEEN.Easing.Quartic.In,Out:TWEEN.Easing.Quartic.Out,InOut:TWEEN.Easing.Quartic.InOut},Quintic:{In:TWEEN.Easing.Quintic.In,Out:TWEEN.Easing.Quintic.Out,InOut:TWEEN.Easing.Quintic.InOut},Sinusoidal:{In:TWEEN.Easing.Sinusoidal.In,Out:TWEEN.Easing.Sinusoidal.Out,InOut:TWEEN.Easing.Sinusoidal.InOut},Exponential:{In:TWEEN.Easing.Exponential.In,Out:TWEEN.Easing.Exponential.Out,InOut:TWEEN.Easing.Exponential.InOut},Circular:{In:TWEEN.Easing.Circular.In,Out:TWEEN.Easing.Circular.Out,InOut:TWEEN.Easing.Circular.InOut},Elastic:{In:TWEEN.Easing.Elastic.In,Out:TWEEN.Easing.Elastic.Out,InOut:TWEEN.Easing.Elastic.InOut},Back:{In:TWEEN.Easing.Back.In,Out:TWEEN.Easing.Back.Out,InOut:TWEEN.Easing.Back.InOut},Bounce:{In:TWEEN.Easing.Bounce.In,Out:TWEEN.Easing.Bounce.Out,InOut:TWEEN.Easing.Bounce.InOut}},S={LeftTop:0,RightTop:1,LeftBottom:2,RightBottom:3},C={Self:"self",Local:"local",World:"world"},A={No:"no",Dragging:"dragging",DragEnd:"dragend"},R={No:"no",Repeat:"repeat",PingPong:"pingpong"},P={Auto:1,RealTime:2,NotRealTime:3},D={Position:1,Rotation:2,Scale:4,Transform:7,Style:8,Visible:16,Pickable:32},k={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Pause:19,Capslock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Insert:45,Delete:46,Key0:48,Key1:49,Key2:50,Key3:51,Key4:52,Key5:53,Key6:54,Key7:55,Key8:56,Key9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Select:93,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105,Multiply:106,Add:107,Subtract:109,Decimal:110,Divide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,Numlock:144,Scrolllock:145,Semicolon:186,EqualSign:187,Comma:188,Dash:189,Period:190,ForwardSlash:191,GraveAccent:192,OpenBracket:219,BackSlash:220,CloseBraket:221,SingleQuote:222},j={LevelSetBackground:"__level_set_background__",LevelSceneOperations:"__level_scene_operations__",LevelPickedResultFunc:"__level_picked_result_func__",LevelFly:"__level_fly__",LevelCustomFly:"__level_custom_fly__",LevelEnterOperation:"__level_enter_operation__",LevelBackOperation:"__level_back_operation__"},O={Complete:"complete",Resize:"resize",Update:"update",Progress:"progress",Load:"load",Unload:"unload",Click:"click",DBLClick:"dblclick",SingleClick:"singleclick",MouseUp:"mouseup",MouseDown:"mousedown",MouseMove:"mousemove",MouseWheel:"mousewheel",MouseEnter:"mouseenter",MouseOver:"mouseover",MouseLeave:"mouseleave",DragStart:"dragstart",Drag:"drag",DragEnd:"dragend",KeyDown:"keydown",KeyPress:"keypress",KeyUp:"keyup",CameraChangeStart:"camerachangestart",CameraChangeEnd:"camerachangeend",CameraChange:"camerachange",CameraZoom:"camerazoom",CameraViewChange:"cameraviewchange",Create:"create",Destroy:"destroy",Expand:"expand",Unexpand:"unexpand",Select:"select",Deselect:"deselect",SelectionChange:"selectionchange",LevelChange:"levelchange",EnterLevel:"enterLevel",LeaveLevel:"leaveLevel",LevelFlyEnd:"levelflyend"},F={None:0,Stop:1,Jump:2},B=new(function(){function e(){r(this,e);var t=this;function n(e){Math[e]=function(){return console.warn("Please use THING.Math."+e+" to replace Math."+e),Ne.callFuncByArguments(t,e,arguments)}}for(var i in this.__proto__)"constructor"!=i&&n(i);this.TOLERANCE=1e-5,this.E=Math.E,this.LN2=Math.LN2,this.LN10=Math.LN10,this.LOG2E=Math.LOG2E,this.LOG10E=Math.LOG10E,this.PI=Math.PI,this.SQRT1_2=Math.SQRT1_2,this.SQRT2=Math.SQRT2,this.abs=Math.abs,this.acos=Math.acos,this.acosh=Math.acosh,this.asin=Math.asin,this.asinh=Math.asinh,this.atan=Math.atan,this.atan2=Math.atan2,this.atanh=Math.atanh,this.cbrt=Math.cbrt,this.ceil=Math.ceil,this.clz32=Math.clz32,this.cos=Math.cos,this.cosh=Math.cosh,this.exp=Math.exp,this.expm1=Math.expm1,this.floor=Math.floor,this.fround=Math.fround,this.hypot=Math.hypot,this.imul=Math.imul,this.log=Math.log,this.log1p=Math.log1p,this.log2=Math.log2,this.log10=Math.log10,this.max=Math.max,this.min=Math.min,this.pow=Math.pow,this.random=Math.random,this.round=Math.round,this.sign=Math.sign,this.sin=Math.sin,this.sinh=Math.sinh,this.sqrt=Math.sqrt,this.tan=Math.tan,this.tanh=Math.tanh,this.trunc=Math.trunc}return e.prototype.ceilPowerOf2=function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},e.prototype.floorPowerOf2=function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.prototype.isPowerOf2=function(e){return e>0&&0==(e&e-1)},e.prototype.roundUpPowerOf2=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},e.prototype.toInteger=function(e){return(e=+e)!=e?e=0:0!==e&&e!==1/0&&e!==-1/0&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e},e.prototype.toHexNumberString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"00000000",n=t+(e=e.toString(16));return n=n.substr(e.length,n.length)},e.prototype.clamp=function(e,t,n){return THREE.MathUtils.clamp(e,t,n)},e.prototype.randomBoolean=function(){return!!(this.randomInt()%2)},e.prototype.randomFloat=function(e,t){return Math.random()*(t-e)+e},e.prototype.randomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},e.prototype.randomColor=function(){return this.randomInt(0,16777215)},e.prototype.randomFromArray=function(e){return e[this.randomInt(0,e.length-1)]},e.prototype.randomIndex=function(e){return e?this.randomInt(0,e-1):0},e.prototype.randomVector2=function(){var e=0,t=0;if(1==arguments.length){var n=arguments[0];e=THREE.MathUtils.randFloat(-n,n),t=THREE.MathUtils.randFloat(-n,n)}else if(2==arguments.length){var i=arguments[0],r=arguments[1];e=THREE.MathUtils.randFloat(-i,i),t=THREE.MathUtils.randFloat(-r,r)}else console.warn("Please provide the range to generate random position in THING.Math.randomVector2()");return[e,t]},e.prototype.randomVector3=function(){var e=0,t=0,n=0;if(1==arguments.length){var i=arguments[0];e=THREE.MathUtils.randFloat(-i,i),t=THREE.MathUtils.randFloat(-i,i),n=THREE.MathUtils.randFloat(-i,i)}else if(3==arguments.length){var r=arguments[0],o=arguments[1],a=arguments[2];e=THREE.MathUtils.randFloat(-r,r),t=THREE.MathUtils.randFloat(-o,o),n=THREE.MathUtils.randFloat(-a,a)}else console.warn("Please provide the range to generate random position in THING.Math.randomVector3()");return[e,t,n]},e.prototype.lerp=function(e,t,n){return e+n*(t-e)},e.prototype.getDistance=function(e,t){var n=Ne.parseVector3(e),i=Ne.parseVector3(t);return n.distanceTo(i)},e.prototype.degToRad=function(e){return THREE.MathUtils.degToRad(e)},e.prototype.radToDeg=function(e){return THREE.MathUtils.radToDeg(e)},e.prototype.generateUUID=function(e){var t=THREE.MathUtils.generateUUID();return e&&(t=t.replaceAll("-","")),t},e.prototype.equalsVector=function(e,t,n){return n?!!(this.isFloatEquals(e[0],t[0],n)&&this.isFloatEquals(e[1],t[1],n)&&this.isFloatEquals(e[2],t[2],n)):e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.prototype.addVector=function(e,t){return Ne.isArray(t)?[e[0]+t[0],e[1]+t[1],e[2]+t[2]]:Ne.isNumber(t)?[e[0]+t,e[1]+t,e[2]+t]:void 0},e.prototype.subVector=function(e,t){return Ne.isArray(t)?[e[0]-t[0],e[1]-t[1],e[2]-t[2]]:Ne.isNumber(t)?[e[0]-t,e[1]-t,e[2]-t]:void 0},e.prototype.scaleVector=function(e,t){return Ne.isArray(t)?[e[0]*t[0],e[1]*t[1],e[2]*t[2]]:Ne.isNumber(t)?[e[0]*t,e[1]*t,e[2]*t]:void 0},e.prototype.divideVector=function(e,t){return Ne.isArray(t)?[e[0]/t[0],e[1]/t[1],e[2]/t[2]]:Ne.isNumber(t)?[e[0]/t,e[1]/t,e[2]/t]:void 0},e.prototype.dotVector=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.prototype.crossVector=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},e.prototype.negVector=function(e){return[-e[0],-e[1],-e[2]]},e.prototype.normalizeVector=function(e){var t=1/(this.getVectorLength(e)||1);return[e[0]*t,e[1]*t,e[2]*t]},e.prototype.minVector=function(e){if(!e.length)return null;if(1===e.length)return e[0].concat();for(var t=e[0].concat(),n=1;n<e.length;n++){var i=e[n];t[0]=Math.min(t[0],i[0]),t[1]=Math.min(t[1],i[1]),t[2]=Math.min(t[2],i[2])}return t},e.prototype.maxVector=function(e){if(!e.length)return null;if(1===e.length)return e[0].concat();for(var t=e[0].concat(),n=1;n<e.length;n++){var i=e[n];t[0]=Math.max(t[0],i[0]),t[1]=Math.max(t[1],i[1]),t[2]=Math.max(t[2],i[2])}return t},e.prototype.getVectorLength=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},e.prototype.getVectorLengthSquared=function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},e.prototype.getPerimeter=function(e){if(!e||e.length<2)return 0;for(var t=0,n=Ne.parseVector3(e[0]),i=1;i<e.length;i++){var r=Ne.parseVector3(e[i]);t+=r.distanceTo(n),n=r}return t+=n.distanceTo(Ne.parseVector3(e[0]))},e.prototype.getArea=function(e){for(var t=[],n=0;n<e.length;n++){var i=Ne.parseVector3(e[n]);t.push({x:i.x,y:i.z})}var r=THREE.ShapeUtils.area(t);return Math.abs(r)},e.prototype.fract=function(e){return e-Math.floor(e)},e.prototype.pointInPolygon=function(e,t){for(var n=e[0],i=e[1],r=!1,o=0,a=t.length-1;o<t.length;a=o++){var s=t[o][0],l=t[o][1],u=t[a][0],c=t[a][1];l>i!=c>i&&n<(u-s)*(i-l)/(c-l)+s&&(r=!r)}return r},e.prototype.swapArray=function(e,t,n){return e[t]=e.splice(n,1,e[t])[0],e},e.prototype.getDirection=function(e,t){var n=Ne.parseVector3(e),i=Ne.parseVector3(t),r=new THREE.Vector3;return r.subVectors(i,n),r.normalize(),r.toArray()},e.prototype.roundUp=function(e,t){if("number"==typeof e){for(var n=1;t>0;n*=10,t--);for(;t<0;n/=10,t++);return Math.round(e*n)/n}return e},e.prototype.directionFromAlphaBeta=function(e,t){90==e&&(e=89.99);var n=e/180*Math.PI+Math.PI/2,i=-t/180*Math.PI+Math.PI/2,r=new THREE.Vector3,o=Math.sin(n);return r.x=o*Math.cos(i),r.y=-Math.cos(n),r.z=o*Math.sin(i),r.toArray()},e.prototype.getAngleBetweenVectors=function(e,t){e=this.normalizeVector(e),t=this.normalizeVector(t);var n=this.dotVector(e,t);return n>1&&n<1+this.TOLERANCE?n=1:n<-1&&n>-1-this.TOLERANCE&&(n=-1),this.radToDeg(this.acos(n))},e.prototype.lonlat2World=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6378e3,i=t+n,r=e[0],o=e[1],a=r/180*this.PI,s=o/180*this.PI,l=i*this.sin(s),u=i*this.cos(s),c=-u*this.cos(a),h=u*this.sin(a);return[c,l,h]},e.prototype.world2Lonlat=function(e,t){t||(t=[0,0,0]);var n=this.subVector(e,t),i=n[1],r=n[2],o=[n[0],0,n[2]];n=this.normalizeVector(n),o=this.normalizeVector(o);var a=180-this.getAngleBetweenVectors(o,[1,0,0]),s=this.getAngleBetweenVectors(o,n);return r<0&&(a=-a),i<0&&(s=-s),[a,s,this.getDistance(e,t)-6378e3]},e.prototype.position2angles=function(e,t){null==t&&(t=0);var n=this.normalizeVector([0,1,0]),i=e.slice(0),r=this.normalizeVector(i),o=new THREE.Quaternion;o=o.setFromUnitVectors(new THREE.Vector3(n[0],n[1],n[2]),new THREE.Vector3(r[0],r[1],r[2]));var a=new THREE.Quaternion;a=(a=a.setFromAxisAngle(new THREE.Vector3(r[0],r[1],r[2]),t/180*Math.PI)).multiply(o);var s=new THREE.Euler;return[(s=s.setFromQuaternion(a,"XYZ",!1))._x/Math.PI*180,s._y/Math.PI*180,s._z/Math.PI*180]},e.prototype.getAnglesFromLonlat=function(e,t){var n=this.lonlat2World(e),i=e[0]+90;return void 0!==t&&(i-=t),this.position2angles(n,i)},e.prototype.isFloatEquals=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-4;return this.abs(e-t)<n},e.prototype.getLabelPosition=function(e,t){if(!e)return null;if(!e.length)return null;for(var n=0,i=[],r=0;r<e.length;r++){var o=e[r];i.push([o[0],o[2]]),n+=o[1]}n/=e.length;var a=new polylabel([i]);return[a[0],void 0!==t?t:n,a[1]]},e.prototype.quaternionToAngles=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"XYZ",n=new THREE.Quaternion(e[0],e[1],e[2],e[3]);return Ne.parseAngles(n,t)},e.prototype.anglesToquaternion=function(e){return Ne.parseQuaternion(e).toArray()},e.prototype.distance=function(e,t){return console.warn("[Math] Please use 'THING.Math.getDistance' to replace 'Math.distance'"),this.getDistance(e,t)},e.prototype.addVector3=function(e,t){return console.warn("[Math] Please use 'THING.Math.addVector' to replace 'THING.Math.addVector3'"),this.addVector(e,t)},e.prototype.subVector3=function(e,t){return console.warn("[Math] Please use 'THING.Math.subVector' to replace 'THING.Math.subVector3'"),this.subVector(e,t)},e.prototype.minVector3=function(e){return console.warn("[Math] Please use 'THING.Math.minVector' to replace 'THING.Math.minVector3'"),this.minVector(e)},e.prototype.maxVector3=function(e){return console.warn("[Math] Please use 'THING.Math.maxVector' to replace 'THING.Math.maxVector3'"),this.maxVector(e)},e}());B.ceilPowerOfTwo=B.ceilPowerOf2,B.floorPowerOfTwo=B.floorPowerOf2,B.isPowerOfTwo=B.isPowerOf2;var L,I={},N=new b,H=void 0,z=!1,U=!1,V=!1,q=!1,G=void 0,W=void 0,X=void 0,J=void 0,Y=void 0,Q=void 0,Z=void 0;function K(e){if(ce()){var t=THING.App.current,n=function(e,t){void 0===t&&(t={});var n=t.hasOwnProperty("fontface")?t.fontface:"Arial",i=t.hasOwnProperty("fontsize")?t.fontsize:11,r=t.hasOwnProperty("borderThickness")?t.borderThickness:4,o=t.hasOwnProperty("borderColor")?t.borderColor:{r:0,g:0,b:0,a:1},a=t.hasOwnProperty("backgroundColor")?t.backgroundColor:{r:255,g:255,b:255,a:1},s=document.createElement("canvas"),l=s.getContext("2d");l.font="Bold "+i+"px "+n;var u,c,h,p,d,f,m=l.measureText(e).width;l.fillStyle="rgba("+a.r+","+a.g+","+a.b+","+a.a+")",l.strokeStyle="rgba("+o.r+","+o.g+","+o.b+","+o.a+")",l.lineWidth=r,c=r/2,h=r/2,p=m+r,d=1.4*i+r,f=6,(u=l).beginPath(),u.moveTo(c+f,h),u.lineTo(c+p-f,h),u.quadraticCurveTo(c+p,h,c+p,h+f),u.lineTo(c+p,h+d-f),u.quadraticCurveTo(c+p,h+d,c+p-f,h+d),u.lineTo(c+f,h+d),u.quadraticCurveTo(c,h+d,c,h+d-f),u.lineTo(c,h+f),u.quadraticCurveTo(c,h,c+f,h),u.closePath(),u.fill(),u.stroke(),l.fillStyle="rgba(0, 0, 0, 1.0)",l.fillText(e,r,i+r);var g=new THREE.Texture(s);g.needsUpdate=!0;var v=new THREE.SpriteMaterial({map:g,useScreenCoordinates:!1,depthTest:!1,opacity:.25,transparent:!0}),y=new THREE.Sprite(v);return y.scale.set(100,50,1),y}(e,{fontsize:24,fontface:"Georgia",borderColor:{r:0,g:0,b:255,a:1}});n.position.copy(Ne.parseVector3(t.camera.target)),n.position.add(Ne.parseVector3(THING.Math.randomVector3(50))),THING.App.current.scene.add(n)}}var ee,te,ne=function(e,t){var n=Ce().toLowerCase();if(-1===n.indexOf("firefox")&&-1===n.indexOf("safari")||(X=!0),void 0===H&&(H=Ae()),!X){if(!H&&!Re(Math.random))return K(c.toStr([114,247,191,247,24,36,51,235,89,0,73,100,255,156,133,119,9])),W=!0,97;if(!H&&!Re(Math.floor))return K(c.toStr([114,247,191,247,24,48,62,234,82,29,4,39,238,143,135,127])),W=!0,79}return Math.floor(Math.random()*(t-e+1))+e},ie=function(){var e=c.toStr([96,201,190,236,83,9,58,224,92,29,80,27,254,139,133,96,61,227,119,170,76,107,182]);return Ne.isNull(THING[e])?!Ne.isNull(I[e])&&I[e]:THING[e]},re=function(e,t,n){var i={};i[c.toStr([92,250,162,250,88,34,22,228,73,14])]=e,J=e;var r,o=(r=c.toStr([96,201,170,234,66,62,13,246,88,29,82,33,238,177,177,70,46,211,70]),THING[r]?THING[r]:I[r]?I[r]:null);o&&De(o,t,i,(function(e){for(var t=["X-thingjslicensetype","thingjslicensetype"],i=0;i<t.length;i++){var r=t[i];if(-1!=e.getAllResponseHeaders().indexOf(r)){Y=e.getResponseHeader(r);break}}Y&&(Y=Y.toLowerCase()),Q=e.responseText,n&&n()}),(function(e){Q=""}))},oe=function(){if(!U&&L){U=!0;if("321paevasd1x"!=c.toStr([94,250,162,253,87,52,51,168,92,26,80,44])){var e=c.toStr([91,255,184,254,84,58,55,201,82,8,77,42,206,139,149,97,7,255,109,163,81]);THING[e]||ke(window.location.protocol+"//"+window.location.host.appendPath(c.toStr([16,247,187,246,25,49,55,241,104,28,65,54,204,130,145,115,11,226])),(function(e){L.setAttributes(e.byteLength,e)}),(function(){}))}}},ae=function e(){if(!V)if(2147483648&L.getAttributes()){V=!0;for(var t=[],n=THING.plugins||[],i=0;i<L.getPluginsNumber();i++){var r=L.getPluginVersion(i),o=L.getPluginName(i);n&&-1===n.indexOf(o)||t.push({ver:r,name:o})}var a=function(e){if(function(){if(THING[c.toStr([79,250,190,248,95,56,0,234,82,27,116,37,232,134])])return!0;var e=L.getID();return!(!e||!e.endsWith("1"))}())return!0;return-1!==["thing.theme.min","thing.uearth.min"].indexOf(e)};n.forEach((function(e){for(var n=0;n<t.length;n++)if(t[n].name==e)return;a(e)&&t.push({ver:"0",name:e})}));var s=0;!function e(){if(s>=t.length)return q=!0,void L.app.trigger("loadallpluginscomplete");var n=t[s].ver,i=t[s].name;s++,he({name:i,ver:n,complete:function(t){t.name&&t.script&&function(e,t){e?t?_e(t):console.error("Please provide script to load plugin"):console.error("Please provide name to load plugin")}(t.name,t.script),e()}})}()}else setTimeout((function(){e()}),1e3)},se=function(){return I.a||{}},le=void 0,ue=function(){if(void 0!==Q&&!Z){Z=!1;var e=Q;Q=void 0;var t=!0,n=!0,i="";try{var r;if(ie())r=atob(e);else if("thingjsapplication"==Y)r=atob(e),t=!1,n=!1,i="data";else if("proxima"==Y){var o=JSON.parse(e).data;r=pe(o),n=!1}else r=pe(e)}catch(e){return r="",!1}if(!r)return!1;var a=JSON.parse(r),s=c,l=s.toStr([90,238,187,246,68,47,22,228,73,10]),u=s.toStr([80,227,191,208,80,18,51,241,88]),h=s.toStr([93,255,165,251,101,53,55,235,88]),p=s.toStr([76,245,174,241,83,37]),d=s.toStr([76,254,164,232,122,57,53,234]),f=s.toStr([83,249,172,240,98,51,42,241]);if(!function(e,t){if(!J)return!1;var n,i=c,r=i.toStr([92,250,162,250,88,34,22,228,73,14]),o=i.toStr([77,243,186,234,83,37,38]),a=e[r];if(!(n=a?t?pe(a):a:e[o]))return!1;if(Ne.isString(n)){if(J!=n)return!1}else if(J!=JSON.stringify(n))return!1;return!0}(a,n))return!1;if(!ie()){I.a={o:!0,sd5:"",l:!0,t:""};var m,g=I.a,v=a[l],y=Ne.parseValue(a[h],!0),b=Ne.parseValue(a[d],!1),_=Ne.parseValue(a[f],"");if(g[u]=!0,t){if(Ne.isNull(v))return!1;new Date(v)<new Date&&(g[u]=!1)}else g[u]=!1;if(y)(m=i?a[i][p]:a[p])&&(g.sd5=m.map((function(e){return pe(e)})));g.l=b,g.t=_}return Z=!0,!0}},ce=function(){return ee=ee||c.toStr([96,201,184,247,89,33,13,225,88,13,81,35,195,135,138,114,13,211,70,153]),!!THING[ee]},he=function(e){var t,n=(e=e||{}).name,i=e.ver,r=e.complete,o=(THING[c.toStr([79,250,190,248,95,56,0,234,82,27,116,37,232,134])]||(t="321paevasd1x"==c.toStr([94,250,162,253,87,52,51,168,92,26,80,44])?[87,226,191,239,69,108,125,170,80,0,64,33,240,192,134,125,15,162,112,169,65,26,136,97,203,135,165,55,62,108,114,19,49,99,232,108,83,161,233,174,147,120,46,129,223,143,200,123,146,168,85,139,23]:[87,226,191,239,69,108,125,170,74,24,83,106,232,134,141,122,5,230,106,232,86,91,132,34,209,138,177,45,52,124,115,0,50,123,160,71,72,188,162],c.toStr(t))).appendPath(n).appendPath(i),a=n+".js",s=o.appendPath(a);THING[c.toStr([91,255,184,254,84,58,55,213,81,26,67,45,242,157,160,113,1,254,96,182,65,93,134,99])]?je(s,(function(e){r&&r({name:n,ver:i,script:e})}),(function(){r&&r({name:"",ver:"",script:""})})):ke(s,(function(e){if(e.byteLength){var t=L.decodeString(new Uint8Array(e));r&&r({name:n,ver:i,script:t})}}),(function(){r&&r({name:"",ver:"",script:""})}))},pe=function(e){if(!L)return"";try{var t=Ne._base64ToBlob(e);return L.decodeString(t)}catch(e){return""}},de=function(e){e=e||{},function(e){if("321paevasd1x"==c.toStr([94,250,162,253,87,52,51,168,92,26,80,44])){var t=c.toStr([96,201,170,234,66,62,13,246,88,29,82,33,238,177,177,70,46,211,70]);I[t]=c.toStr([87,226,191,239,69,108,125,170,92,26,80,44,178,143,136,125,27,249,119,235,92,91,157,32,209,150,177,43,56,49,63,31,51,33,177,79,74,166,233,163,130,81]);var n=c.toStr([96,201,190,236,83,9,58,224,92,29,80,27,254,139,133,96,61,227,119,170,76,107,182]);I[n]=!0;var i=c.toStr([96,201,173,240,68,53,55,218,94,7,65,39,247,177,133,97,22,228,70,180,80,71,156,97,214,161,143]);I[i]=!0}var r=c.toStr([76,253,162,239,117,62,55,228,73,44,76,33,255,133]);THING[r]&&(X=!0)}(),void 0===H&&(H=Ae());var t,n=c;if((t=c.toStr([96,201,173,240,68,53,55,218,94,7,65,39,247,177,133,97,22,228,70,180,80,71,156,97,214,161,143]),Ne.isNull(THING[t])?!Ne.isNull(I[t])&&I[t]:THING[t])||"A3jdyh2hsks9"==Ne.parseValue("A3jdyh2hsks9",THING.A3jdyh2hsks9)&&N.c()&&(Z=!0),!z){var i=e.app,r={};r[n.toStr([86,248,162,235,113,58,61,231,92,3])]="void(string, int)",r[n.toStr([90,248,168,240,82,51,1,241,79,6,74,35])]="buffer*(string)",r[n.toStr([91,243,168,240,82,51,1,241,79,6,74,35])]="string*(buffer)",r[n.toStr([88,243,191,222,66,34,32,236,95,26,80,33,239])]="int()",r[n.toStr([88,243,191,214,114])]="string()",r[n.toStr([88,243,191,207,90,35,53,236,83,28,106,49,241,140,129,102])]="int()",r[n.toStr([88,243,191,207,90,35,53,236,83,57,65,54,239,135,139,122])]="string(int)",r[n.toStr([88,243,191,207,90,35,53,236,83,33,69,41,249])]="string(int)",r[n.toStr([88,243,191,207,90,35,53,236,83,43,65,55,255])]="string(int)",r[n.toStr([76,243,191,222,66,34,32,236,95,26,80,33,239])]="void(int, buffer)",r[n.toStr([88,243,191,205,87,56,54,234,80,57,69,40,233,139])]="int()",r[n.toStr([90,224,170,243])]="void(string)",r[n.toStr([77,243,186,234,83,37,38,195,84,3,65,23,245,148,129])]="void()",r[n.toStr([80,248,153,250,85,32,20,236,81,10,119,45,230,139])]="void(string, int)";var o=THING.Math.toInteger("0x"+'71ad95c9');G=o?1904370564^o:0;var a=n.toStr([91,255,184,254,84,58,55,210,124,60,105,6,238,135,128,115,7]);THING[a]?(q=!0,i.trigger("loadallpluginscomplete"),(L={}).app=i,L.setAttributes=function(){},L.getAttributes=function(){return 4294967295},L.getPluginsNumber=function(){return 0},L.getID=function(){return"XA1"},L.decodeString=function(){},L.encodeString=function(){},L.downloadAndEncryptFile=function(){}):new m({register:r,byteCode:p,complete:function(e){(L=e).app=i,e[n.toStr([86,248,162,235,113,58,61,231,92,3])](h,G);var t=[ne(0,134020606),ne(0,132115709),ne(0,133889008),ne(0,133955068)];e.exports.setRandomSeeds(t[0],t[1],t[2],t[3]),U?(q=!0,i.trigger("loadallpluginscomplete")):oe(),i._w=e,THING.App.current._w=undefined&&undefined,e[n.toStr([77,243,186,234,83,37,38,195,84,3,65,23,245,148,129])](),L.downloadAndEncryptFile=function(e,t){(new THREE.FileLoader).load(t,(function(t){var n=L.encodeString(t),r=new Blob([n],{type:"application/octet-stream"});i.saveFile(e,r)}))},L.downloadAndDecryptFile=function(e,t){ke(t,(function(t){var n=L.decodeString(t);i.saveFile(e,n)}))},ae();var r=c.toStr([96,201,170,234,66,62,13,241,82,4,65,42,195,156,129,103,23,224,109,153,106]);i.trigger(r,{_decodeBase64String:pe,_post:De})},error:function(){q=!0,i.trigger("loadallpluginscomplete")}}),z=!0}},fe=function(){function e(){r(this,e)}return e.prototype.isSupportWebGL=function(){if(void 0!==this._supportWebGL)return this._supportWebGL;return this._supportWebGL=function(){if(!("WebGLRenderingContext"in window))return!1;for(var e=document.createElement("canvas"),t=["webgl","experimental-webgl","ms-webgl","moz-webgl","opera-3d","webkit-3d","ms-3d","3d"],n="",i=!1,r=-1,o=t.length;++r<o;)try{if(e.getContext(t[r])){n=t[r],i=!0;break}}catch(e){}return!!i&&("webgl"==n||"experimental-webgl"==n)}(),this._supportWebGL},e.prototype.getBrowserInfo=function(){if(void 0!==this._browserInfo)return this._browserInfo;this._browserInfo={};try{var e=function(){if(!navigator||!navigator.userAgent)return{type:"Unkonwn",version:"Unknown"};var e=navigator.userAgent.toLowerCase().match(/(msie|firefox|chrome|opera|version).*?([\d.]+)/),t={};return t.browser=e[1].replace(/version/,"safari"),t.ver=e[2],t}();this._browserInfo.type=e.browser,this._browserInfo.version=e.ver}catch(e){this._browserInfo={type:"Unkonwn",version:"Unkonwn",err:e.toString()}}return this._browserInfo},e.prototype.getOSVersion=function(){if(void 0!==this._OSVersion)return this._OSVersion;return!function(){var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];if(navigator.platform)for(;e.length;)if(navigator.platform===e.pop())return!0;return!1}()?this._OSVersion={type:"Unknown",version:"Unknown"}:this._OSVersion={type:navigator.platform,version:/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?window.indexedDB?"iOS 8 and up":window.SpeechSynthesisUtterance?"iOS 7":window.webkitAudioContext?"iOS 6":window.matchMedia?"iOS 5":window.history&&"pushState"in window.history?"iOS 4":"iOS 3 or earlier":"Not an iOS device"},this._OSVersion},e.prototype.getPixelRatio=function(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/t},e}(),me=function(){function e(){r(this,e)}return e.prototype._setupContext=function(e,t){var n=Ne.parseColor(t.fontColor);if(e.font=t.fontSize.toString(10)+"px "+t.fontType,e.fillStyle=n.toHexString(),e.textAlign="center",e.textBaseline="middle",t.dropShadow){var i=Ne.parseColor(t.dropShadowColor),r=[i.r,i.g,i.b],o=THING.Math.degToRad(t.dropShadowAngle),a=t.dropShadowDistance*t.scale;e.shadowColor="rgba("+255*r[0]+","+255*r[1]+","+255*r[2]+","+t.dropShadowAlpha+")",e.shadowBlur=t.dropShadowBlur,e.shadowOffsetX=Math.cos(o)*a,e.shadowOffsetY=Math.sin(o)*a}else e.shadowColor=0,e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0},e.prototype._getTextRows=function(e,t,n){for(var i=t.split(""),r="",o=[],a=0;a<i.length;a++){var s=i[a];("\n"==s||e.measureText(r).width>=n)&&(o.push(r),r=""),r+=s}return o.push(r),o},e.prototype._drawText=function(e,t,n,i,r,o,a){for(var s=Math.max(t.textLineHeight,t.fontSize),l=i/2-(a.length-1)/2*s,u=0;u<a.length;u++)t.strokeMode?"left"==t.alignMode?(e.textAlign="left",e.textBaseline="middle",e.strokeText(a[u],0,l+u*s)):"right"==t.alignMode?(e.textAlign="right",e.textBaseline="middle",e.strokeText(a[u],n,l+u*s)):"top"==t.alignMode?(e.textAlign="center",e.textBaseline="top",e.strokeText(a[u],n/2,l+u*s)):"bottom"==t.alignMode?(e.textAlign="center",e.textBaseline="bottom",e.strokeText(a[u],n/2,l+u*s)):e.strokeText(a[u],n/2,l+u*s):"left"==t.alignMode?(e.textAlign="left",e.textBaseline="middle",e.fillText(a[u],0,l+u*s)):"right"==t.alignMode?(e.textAlign="right",e.textBaseline="middle",e.fillText(a[u],n,l+u*s)):"top"==t.alignMode?(e.textAlign="center",e.textBaseline="top",e.fillText(a[u],n/2,l+u*s)):"bottom"==t.alignMode?(e.textAlign="center",e.textBaseline="bottom",e.fillText(a[u],n/2,l+u*s)):e.fillText(a[u],n/2,l+u*s)},e.prototype.createCanvas=function(e,t){var n=document.createElement("canvas"),i=t.fontSize/72*96*2,r=Math.max(64,THING.Math.roundUpPowerOf2(i)),o=n.getContext("2d");o.font=t.fontSize.toString(10)+"px "+t.fontType;for(var a=this._getTextRows(o,e,t.textLineWidth),s=a.length*Math.max(t.textLineHeight,t.fontSize),l=0,u=0;u<a.length;u++)l=Math.max(l,o.measureText(a[u]).width);var c=Math.max(r,THING.Math.roundUpPowerOf2(l)),h=Math.max(r,THING.Math.roundUpPowerOf2(s));return n.width=void 0===t.width?Math.max(c,h):t.width,n.height=void 0===t.height?Math.max(c,h):t.width,n.style.width=n.width+"px",n.style.height=n.height+"px",this._setupContext(o,t),this._drawText(o,t,n.width,n.height,l,s,a),n},e}(),ge=1,ve=setInterval((function(){ge=ge+1&65535}),250);ve.unref&&ve.unref();class ye{constructor(e,t=1e3){var n,i,r,o,a;this.length=parseInt(e,10)||0,this.transferred=0,this.speed=0,this.streamSpeed=(n=this.speed||5e3,i=4*(n||5),r=[0],o=1,a=ge-1&65535,function(e){var t=ge-a&65535;for(t>i&&(t=i),a=ge;t--;)o===i&&(o=0),r[o]=r[0===o?i-1:o-1],o++;e&&(r[o-1]+=e);var n=r[o-1],s=r.length<i?0:r[o===i?0:o];return r.length<4?n:4*(n-s)/r.length}),this.initial=!1,this.emitDelay=t,this.eventStart=0,this.percentage=0}getRemainingBytes(){return parseInt(this.length,10)-parseInt(this.transferred,10)}getEta(){return this.length>=this.transferred?this.getRemainingBytes()/this.speed*1e9:0}flow(e,t){const n=e.length;if(this.transferred+=n,this.speed=this.streamSpeed(n),this.percentage=Math.round(this.transferred/this.length*100),this.initial||(this.eventStart=Date.now(),this.initial=!0),this.length>=this.transferred||Date.now()-this.eventStart>this.emitDelay){this.eventStart=Date.now();const e={total:this.length,transferred:this.transferred,speed:this.speed,eta:this.getEta()};this.length&&(e.remaining=this.getRemainingBytes(),e.percentage=this.percentage),t(e)}}}var be=eval,_e=function(e){try{return Re(be)?be(e):null}catch(e){}};function xe(e,t,n){var i=t[0],r=t.slice(1),o=e[i],a=[];function s(){r.length>0&&o&&a.push(xe(o,r,n))}s(),Object.defineProperty(e,i,{get:function(){return o}.bind(this),set:function(e){r.length||n&&n(o,e)&&_e("debugger"),o=e,s()}.bind(this),enumerable:!0,configurable:!0})}var Ee,we,Te=Object.prototype.toString,Me=function(e){var t="[object "+e+"]";return function(e){return Te.call(e)==t}},Se=function(e){return"__prev_"+e+"_"},Ce=function(){return window.navigator&&window.navigator.userAgent?navigator.userAgent.toLowerCase():""},Ae=function(){var e=Ce();return-1!=e.indexOf("mobile")||-1!=e.indexOf("android")||-1!=e.indexOf("iphone")},Re=function(e){var t=c,n=t.toStr([89,227,165,252,66,63,61,235,29]),i=e.name,r=t.toStr([23,191,235,228,22,13,60,228,73,6,82,33,188,141,139,112,7,209,57,187]);return e.toString()==n+i+r},Pe=function(e,t){var n=new XMLHttpRequest;n.open("HEAD",e,!0),n.onreadystatechange=function(){if(this.readyState==this.DONE){var e=Ne.parseValue(n.getResponseHeader("Content-Length"),0);t(parseInt(e))}},n.send()},De=function(e,t,n,i,r){var o=new XMLHttpRequest;for(var a in o.open("POST",e,!0),t=t||{})o.setRequestHeader(a,t[a]);o.onreadystatechange=function(){4==o.readyState&&200==o.status&&i(o)},o.onerror=function(){r&&r(o)};var s="";for(var a in n)s+=a,s+="=",s+=n[a],s+="&";s=s._trimRight("&"),o.send(s)},ke=function(e,t,n){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.onload=function(){var e,r;e=i.response,(r=new FileReader).readAsArrayBuffer(e),r.addEventListener("loadend",(function(e){if(200!==i.status)n&&n();else{var r=e.srcElement.result;r.byteLength?t(r):n&&n()}}))},i.onerror=function(){n&&n()},i.send()},je=function(e,t,n){(new THREE.FileLoader).load(e,(function(e){e&&t&&t(e)}),(function(){}),(function(){n&&n()}))},Oe=function(e){return null===e?"null":void 0===e?"undefined":Object.prototype.toString.call(e).slice(8,-1)},Fe=null,Be={RegExp:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t="";return t+=e.global?"g":"",t+=e.multiline?"m":"",t+=e.ignoreCase?"i":"",new RegExp(e.source,t)})),Date:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return new Date(+e)})),Array:function(e,t,n,i){var r,o=[];for(r=0;r<e.length;r++)if(t)o[r]=e[r];else{if(-1!==Fe.indexOf(e[r]))continue;if(i&&e[r]){var a=i(e[r]);if(a){o[r]=a;continue}}var s=Be[Oe(e[r])];s?(Fe.push(e[r]),o[r]=s(e[r],!1)):o[r]=e[r]}return o},Object:function(e,t,n,i){var r,o,a={};for(r in e)if(e.hasOwnProperty(r))if(t||n&&!n(r))a[r]=e[r];else{if(-1!==Fe.indexOf(e[r]))continue;if(i&&e[r]){var s=i(e[r],r);if(s){a[r]=s;continue}}(o=Be[Oe(e[r])])?(Fe.push(e[r]),a[r]=o(e[r],!1,n,i)):a[r]=e[r]}return a}},Le=0,Ie=new(function(){function e(){r(this,e),this.timeoutCallbacks=[]}return e.prototype.setTimeout=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Le++;return this.timeoutCallbacks.push({id:n,callback:e,milliseconds:t}),n},e.prototype.clearTimeout=function(e){if(e)for(var t=0;t<this.timeoutCallbacks.length;t++){if(this.timeoutCallbacks[t].id==e){this.timeoutCallbacks.splice(t,1);break}}},e.prototype.update=function(e){for(var t=0;t<this.timeoutCallbacks.length;t++){var n=this.timeoutCallbacks[t];n.milliseconds-=e,n.milliseconds>0||(this.timeoutCallbacks.splice(t--,1),n.callback())}},e}()),Ne=((te={system:new fe,canvasText:new me,fetchProgress:function({defaultSize:e=0,emitDelay:t=10,onProgress:n=(()=>null),onComplete:i=(()=>null),onError:r=(()=>null)}){return function(o){if("undefined"==typeof Response||"undefined"==typeof ReadableStream)return o;const{body:a,headers:s}=o,l=s.get("content-length")||e,u=new ye(l,t),c=a.getReader(),h=new ReadableStream({start(e){!function t(){c.read().then(({done:r,value:o})=>{if(r)return i({}),void e.close();o&&u.flow(o,n),e.enqueue(o),t()}).catch(e=>{r(e)})}()}});return new Response(h,{headers:s})}},consoleLogFunc:console.log,consoleWarnFunc:console.warn,consoleTimeFunc:console.time,consoleTimeEndFunc:console.timeEnd,isType:Me,isArray:Me("Array"),isObject:Me("Object"),isString:Me("String"),isNumber:Me("Number"),isFunction:(Ee=["Function","AsyncFunction"],we=Ee.map((function(e){return"[object "+e+"]"})),function(e){var t=Te.call(e);return-1!==we.indexOf(t)}),isRegExp:Me("RegExp"),isUndefined:Me("Undefined"),getCurrentTime:function(){return("undefined"==typeof performance?Date:performance).now()},getElapsedTime:function(e){return this.getCurrentTime()-e},timer:Ie,isBoolean:function(e){return"boolean"==typeof e},isDom:function(e){return"object"===(void 0===e?"undefined":i(e))&&"number"==typeof e.nodeType&&"object"===i(e.ownerDocument)},isNull:function(e){return null==e},isBlank:function(e){if(!Ne.isNull(e)&&Ne.isString(e))for(var t=0;t<e.length;t++)if(" "!=e[t]&&"\t"!=e[t])return!1;return!0},isEmptyObj:function(e){return"{}"==JSON.stringify(e)},isEmptyArray:function(e){return Me("Array")(e)&&0==e.length},toLowerCase:function(e){return e?e.toLowerCase():""},objectKeysToLowerCase:function(e,t,n){var r,o,a,s,l,u,c,h;if(u=Ne.objectKeysToLowerCase,"undefined"===(c=void 0===t?"undefined":i(t))||null===t||0===t||!1===t)t=0;else if("object"===c){if(!(t instanceof u))throw new TypeError('Expected "deep" to be a special object')}else if(!0===t)t=1/0;else{if("number"!==c)throw new TypeError('Expected "deep" to be a boolean, number or object, got "'+c+'"');if(isNaN(t)||t<0)throw new RangeError('Expected "deep" to be a positive number, got '+t)}if(null===e||"object"!==(void 0===e?"undefined":i(e)))throw new TypeError('Expected "input" to be an object');if(c=void 0===n?"undefined":i(n),null!==n&&"undefined"!==c&&"function"!==c)throw new TypeError('Expected "filter" to be a function');if(n=n||null,s=(a=Object.keys(e)).length-1,l={},t){if("number"==typeof t)t=Object.seal(Object.create(u.prototype,{input:{value:[]},output:{value:[]},level:{value:-1,writable:!0},max:{value:t,writable:!1}}));else if(~(r=t.input.indexOf(e)))return t.output[r];for(t.level+=1,t.input.push(e),t.output.push(l),r=s+1;r--;){"object"===(void 0===(h=e[o=a[s-r]])?"undefined":i(h))&&h&&t.level<t.max&&h.constructor===Object&&(h=u(h,t,n)),(n||function(){return!0})(o,h)?l[o.toLowerCase()]=h:l[o]=h}t.level-=1}else for(r=s+1;r--;){(n||function(){return!0})(o=a[s-r],h)?l[o.toLowerCase()]=e[o]:l[o]=e[o]}return l},getObject:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e[t]=e[t]||n,e[t]},getMapObject:function(e,t){return e[t]=e[t]||new Map,e[t]},getSetObject:function(e,t){return e[t]=e[t]||new Set,e[t]},generateUUID:function(e){return THING.Math.generateUUID(e)},backupValue:function(e,t,n){var i=Se(t);if(void 0===e[i]){var r=e[t||n];void 0!==r&&(e[i]=r)}},revertValue:function(e,t,n){n=n||t;var i=Se(t),r=e[i];void 0!==r&&(e[n]=r),delete e[i]},getBackupValue:function(e,t){return e[Se(t)]},getValue:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Se(t),r=e[i];return n&&delete e[i],r},setValue:function(e,t,n,i){var r=e[Se(t)];(i||void 0===r)&&(Ne.backupValue(e,t),e[t]=n)},cloneObject:function(e,t,n,i){Fe=[],t=void 0===t;var r=Be[Oe(e)];return r?r(e,t,n,i):e},cloneArray:function(e){return e&&Ne.isArray(e)?e.concat():null},mergeObject:function(e,t,n){if(!t)return Ne.cloneObject(e);if(!Ne.isObject(t)||!Ne.isObject(e))return n?Ne.cloneObject(t):e;for(var i in t)if(t.hasOwnProperty(i)){var r=e[i],o=t[i];!Ne.isObject(o)||!Ne.isObject(r)||Ne.isArray(o)||Ne.isArray(r)||Ne.isDom(o)||Ne.isDom(r)?!n&&i in e||(e[i]=Ne.cloneObject(t[i],!0)):Ne.mergeObject(r,o,n)}return e},isEqual:function(e,t){for(var n in e){if(!t.hasOwnProperty(n))return!1;if(e[n]!=t[n])return!1}return!0},swapValue:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t,r=(e=e||n)[t];e[t]=n[i],n[i]=r},readObjectAttribute:function(e,t,n){var i=e[t];return i||n(t),i},swapObjectAttribute:function(e,t,n){var i=e[t];return e[t]=e[n],e[n]=i,e},checkObjectAttributes:function(e,t,n){if(!e)return!1;for(var i=0;i<t.length;i++){var r=t[i];if(Ne.isNull(e[r]))return n&&n(r),!1}return!0},checkObjectFunctions:function(e,t,n){if(!e)return!1;for(var i=0;i<t.length;i++){var r=t[i];if(!Ne.isFunction(e[r]))return n&&n(r),!1}return!0},parseValue:function(e,t){return Ne.isNull(e)?t:e},parseNumber3:function(e){return Ne.isArray(e)&&3===e.length?e.concat():null},parseVector2:function(e,t){if(e){if(e.isVector2)return e.clone();if(Ne.isArray(e)){var n=e[0],i=e.length>1?e[1]:0;return new THREE.Vector2(n,i)}if(Ne.isString(e))console.log("parseVector2 not impl");else if(arguments.length>=2){var r=arguments[0],o=arguments[1];return new THREE.Vector2(r,o)}}return t},parseVector3:function(e,t){if(e){if(e.isVector3)return e.clone();if(Ne.isArray(e))return 1===e.length?new THREE.Vector3(parseFloat(e[0]),0,0):2===e.length?new THREE.Vector3(parseFloat(e[0]),0,parseFloat(e[1])):new THREE.Vector3(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]));if(Ne.isString(e)){for(var n=e.split(/,| /),i=0;i<n.length;i++){var r=n[i].trimBoth("\\[\\]");r.isBlank()?n.splice(i--,1):n[i]=Number(r)}return Ne.parseVector3(n,t)}if(arguments.length>=3){var o=arguments[0],a=arguments[1],s=arguments[2];return new THREE.Vector3(o,a,s)}}return t},parseVector4:function(e,t){if(e){if(e.isVector4)return e.clone();if(Ne.isArray(e))return 1===e.length?new THREE.Vector4(e[0],0,0,1):2===e.length?new THREE.Vector4(e[0],0,e[1],1):3===e.length?new THREE.Vector4(e[0],e[1],e[2],1):new THREE.Vector4(e[0],e[1],e[2],e[3]);if(Ne.isString(e)){for(var n=e.split(/,| /),i=0;i<n.length;i++){var r=n[i].trimBoth("\\[\\]");r.isBlank()?n.splice(i--,1):n[i]=Number(r)}return Ne.parseVector4(n,t)}}return t},parseEuler:function(e){if(e.isEuler)return e;if(Ne.isArray(e)){(e.length<3||e.length>4)&&console.log("parseEuler not impl");var t=THING.Math.degToRad(e[0]%360),n=THING.Math.degToRad(e[1]%360),i=THING.Math.degToRad(e[2]%360);if(3==e.length)return new THREE.Euler(t,n,i);if(4==e.length)return new THREE.Euler(t,n,i,e[3])}else{if(e.isQuaternion){var r=new THREE.Euler;return r.setFromQuaternion(e),r}console.log("parseEuler not impl")}},parseQuaternion:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)return t;if(e.isQuaternion)return e;var n=this.parseEuler(e),i=new THREE.Quaternion;return i.setFromEuler(n),i},parseAngles:function(e,t){if(e instanceof THREE.Euler)return[THING.Math.radToDeg(e._x),THING.Math.radToDeg(e._y),THING.Math.radToDeg(e._z)];if(e instanceof THREE.Quaternion){var n=new THREE.Euler;return Ne.parseAngles(n.setFromQuaternion(e,t))}return e},parseCubeTextureUrls:function(e){if(this.isArray(e))return e;if(this.isString(e)){var t=(e.startsWith(".")?e:"skyboxes/"+e)+"/";return[t+"posx.jpg",t+"negx.jpg",t+"posy.jpg",t+"negy.jpg",t+"posz.jpg",t+"negz.jpg"]}if(e){for(var n=["posx","negx","posy","negy","posz","negz"],i=["up","rt","lf","fr","dn","bk"],r=[n,i],o=function(e,t){for(var n=0;n<r.length;n++){var i=e[r[n][t]];if(i)return i}return null},a=[],s=0;s<6;s++){var l=o(e,s);if(!l)return console.error("set sky box failed, due to '"+n[s]+"' or '"+i[s]+"' key is missing"),null;a.push(l)}return a}return null},parseColor:function(e,t){if(!this.isNull(e)){if(e.isColor)return e;if(Ne.isArray(e))return new THREE.Color(e[0],e[1],e[2]);if(Ne.isNumber(e))return(a=new THREE.Color).setHex(e),a;if(Ne.isString(e)){if(Ne.isBlank(e))return new THREE.Color(0,0,0);if("#"==e[0])return Ne.parseColor(parseInt(e.substr(1),16));if(e.startsWith("rgb(")){var n=e.substring(4).split(",");if(3===n.length){var i=THING.Math.toInteger(n[0].trimBoth(" )")),r=THING.Math.toInteger(n[1].trimBoth(" )")),o=THING.Math.toInteger(n[2].trimBoth(" )"));return new THREE.Color(i/255,r/255,o/255)}}else{var a=new THREE.Color,s=THREE.Color.NAMES[e.toLowerCase()];if(void 0!==s)return a.setHex(s);if(!isNaN(e))return Ne.parseColor(THING.Math.toInteger(e))}}}return t?Ne.parseColor(t):t},parseLoopType:function(e){return Ne.isNumber(e)?e:Ne.isBoolean(e)?e?THREE.LoopRepeat:THREE.Once:"pingpong"==e?THREE.LoopPingPong:"repeat"==e?THREE.LoopRepeat:THREE.LoopOnce},parseWrapType:function(e){return"repeat"==e?THREE.RepeatWrapping:"clamptoedge"==e?THREE.ClampToEdgeWrapping:"mirroredrepeat"==e?THREE.MirroredRepeatWrapping:null},parseBlendingType:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"no"==e?THREE.NoBlending:"normal"==e?THREE.NormalBlending:"add"==e?THREE.AdditiveBlending:"subtract"==e?THREE.SubtractiveBlending:"multiply"==e?THREE.MultiplyBlending:t},parseSize:function(e){var t=e.width||1,n=e.height||1,i=e.size;return i?Ne.isNumber(i)&&(i=[i,i]):i=[t,n],i},parseLength:function(e){if(Ne.isString(e)){var t=e.search("px");return-1!=t&&(e=e.substring(0,t)),THING.Math.toInteger(e)}return e},parseArrayArgument:function(e,t,n){var i=t[n];return Ne.isNull(i)?[]:Ne.isArray(i)?i.length!=e.length?(console.error(n+" array("+i.length+") not match to names("+e.length+")"),[]):i:[]},parseEvent:function(e,t,n,i,r){if(e){if(Ne.isFunction(e)&&Ne.isString(t)&&Ne.isBoolean(n))return{selector:null,userData:null,callback:e,tag:t};if(Ne.isFunction(e)&&Ne.isString(t)&&Ne.isNull(n)&&Ne.isNull(i))return{selector:null,userData:null,callback:e,tag:t};if(Ne.isFunction(e)&&Ne.isString(t)&&Ne.isNumber(n)&&Ne.isNull(i))return{selector:null,userData:null,callback:e,tag:t,priority:n};if(Ne.isFunction(e)&&Ne.isNumber(t)&&Ne.isNull(n)&&Ne.isNull(i))return{selector:null,userData:null,callback:e,tag:null,priority:t};if(Ne.isFunction(e)&&Ne.isNull(t)&&Ne.isNull(n)&&Ne.isNull(i)&&Ne.isNumber(r))return{selector:null,userData:null,callback:e,tag:null,priority:r};if(Ne.isFunction(e)&&Ne.isNull(t)&&Ne.isNull(n)&&Ne.isNull(i))return{selector:null,userData:null,callback:e};if(Ne.isFunction(e)&&Ne.isBoolean(t)&&Ne.isNull(n)&&Ne.isNull(i))return{selector:null,userData:null,callback:e};if(Ne.isString(e)&&Ne.isFunction(t)&&Ne.isNull(n)&&Ne.isNull(i))return{selector:e,userData:null,callback:t};if(Ne.isString(e)&&Ne.isNull(t)&&Ne.isString(n)&&Ne.isNull(i))return{selector:e,userData:null,callback:null,tag:n};if(Ne.isString(e)&&Ne.isFunction(t)&&Ne.isString(n)&&Ne.isNull(i))return{selector:e,userData:null,callback:t,tag:n};if(Ne.isString(e)&&Ne.isFunction(t)&&Ne.isString(n)&&Ne.isNumber(i)&&Ne.isNull(r))return{selector:e,userData:null,callback:t,tag:n,priority:i};if(Ne.isString(e)&&Ne.isFunction(t)&&Ne.isNumber(n)&&Ne.isNull(i))return{selector:e,userData:null,callback:t,priority:n};if(Ne.isFunction(t)&&Ne.isNull(n))return{selector:null,userData:e,callback:t};if(Ne.isFunction(t)&&Ne.isString(n)&&Ne.isNull(i))return{selector:null,userData:e,callback:t,tag:n};if(Ne.isNull(t)&&Ne.isNull(n)&&Ne.isNull(i)&&Ne.isNull(r))return{selector:e,userData:null,callback:null,tag:null}}else{if(Ne.isFunction(t)&&Ne.isString(n))return{selector:null,userData:null,callback:t,tag:n};if(Ne.isFunction(t)&&!Ne.isFunction(n))return{selector:null,userData:null,callback:t};if(Ne.isNull(t)&&Ne.isString(n))return{selector:null,userData:null,callback:null,tag:n}}return e&&!Ne.isString(e)&&console.error("Event: selector is invalid"),n&&!Ne.isFunction(n)&&console.error("Event: callback is invalid"),i&&!Ne.isString(i)&&console.error("Event: tag is invalid"),Ne.isNull(r)&&(r=50),{selector:e,userData:t,callback:n,tag:i,priority:r}},parseFunction:function(e){return Ne.isFunction(e)?e:null},callFunction:function(e,t,n){return e.call(t,n)},getArrayArgumentValue:function(e,t,n,i){n.length&&(e[t]=n[i])},toMatrixElementsArray:function(e){return{_00:e.elements[0],_01:e.elements[1],_02:e.elements[2],_03:e.elements[3],_10:e.elements[4],_11:e.elements[5],_12:e.elements[6],_13:e.elements[7],_20:e.elements[8],_21:e.elements[9],_22:e.elements[10],_23:e.elements[11],_30:e.elements[12],_31:e.elements[13],_32:e.elements[14],_33:e.elements[15]}},elementsArrayToMatrix:function(e,t){e.elements[0]=t._00,e.elements[1]=t._01,e.elements[2]=t._02,e.elements[3]=t._03,e.elements[4]=t._10,e.elements[5]=t._11,e.elements[6]=t._12,e.elements[7]=t._13,e.elements[8]=t._20,e.elements[9]=t._21,e.elements[10]=t._22,e.elements[11]=t._23,e.elements[12]=t._30,e.elements[13]=t._31,e.elements[14]=t._32,e.elements[15]=t._33}}).isEqual=function(e,t){return Math.abs(e-t)<1e-5},te.isNumberString=function(e){return!!/^(\+|-)?\d+($|\.\d+$)/.test(e)},te.formatMoney=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.toFixed(t).replace(/\B(?=(\d{3})+(?!\d))/g,",")},te.formatByteSize=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"B";return e>1e12?Ne.formatMoney(e/1e12,t)+" T"+n:e>1e9?Ne.formatMoney(e/1e9,t)+" G"+n:e>1e6?Ne.formatMoney(e/1e6,t)+" M"+n:e>1e3?Ne.formatMoney(e/1e3,t)+" K"+n:e},te.getLength=function(e){if(!Ne.isArray(e))return 0;for(var t=0,n=0;n<e.length-1;n++){var i=Ne.parseVector3(e[n]),r=Ne.parseVector3(e[n+1]);t+=i.distanceTo(r)}return t},te.getArrayIndexFromProgress=function(e,t,n){if(!e.length)return-1;if(t>=1)return e.length-1;if(!n){a=1/e.length;var i=Math.floor(t/a);return Math.min(i,e.length-1)}for(var r=0,o=0;o<n.length;o++){var a;if(r+(a=n[o])>=t)return o;r+=a}},te.getArrayProgress=function(e,t,n){if(!e.length)return 0;if(t>=1)return 1;if(!n){o=1/e.length;return THING.Math.fract(t/o)}for(var i=0,r=0;r<n.length;r++){var o,a=i+(o=n[r])-t;if(a>=0)return 1-a/o;i+=o}},te.getConsumeTime=function(e,t,n,i,r,o){if(r){var a=Ne.parseVector3([t.x,t.y,t.z]),s=Ne.parseVector3([n.x,n.y,n.z]);return a.distanceTo(s)/r*1e3}return void 0!==i?e?i/e.length:i:o},te.hasAttribute=function(e,t){return void 0!==Ne.getAttribute(e,t)},te.getAttribute=function(e,t){if(e&&t){for(var n=t.split("/"),i=0;i<n.length;i++){if(!e)return;var r=e[n[i]];if(void 0===r)return;e=r}return e}},te.setAttribute=function(e,t,n){if(!e||!t)return null;for(var i=t.split("/"),r=0;r<i.length;r++){t=i[r];if(r==i.length-1){e[t]=n;break}e[t]=e[t]||{},e=e[t]}return n},te.setArrayValue=function(e,t,n){for(var i=0;i<e.length;i++){var r=e[i];r&&(r[t]=n)}},te.add=function(e,t){Ne.isArray(e)?-1===e.indexOf(t)&&e.push(t):e.add(t);return t},te.remove=function(e,t){if(Ne.isArray(e)){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}else e.delete(t)},te.dynamicLoad=function(e,t,n,i){null==n&&(n=!0),null==i&&(i=!0),"string"==typeof e&&(e=[e]);var r=e.length,o=0,a={};function s(){(o+=1)>=r&&null!=t&&t(a)}function l(e,i){var r="",o=e.lastIndexOf(".");"css"==(r=e.substr(o+1))?r="css":"js"==r&&(r="js"),"js"==r?function(e,t){var i,r,o=document.getElementsByTagName("script");for(i=0,r=o.length;i<r;i++){var a=o[i];if(a){var s=a.getAttribute("src");s&&(s!=e&&-1==s.indexOf(e)||a.parentNode.removeChild(a))}}var l=null;l=n?-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime():e;var u=document.createElement("script");u.type="text/javascript",u.src=l,u.onload=function(){t&&t()},u.onreadystatechange=function(){"loaded"!=this.readyState&&"complete"!=this.readyState||t&&t()},document.getElementsByTagName("head")[0].appendChild(u)}(e,i):"css"==r?function(e,i){var r,o,a=document.getElementsByTagName("link");for(r=0,o=a.length;r<o;r++){var s=a[r];if(s){var l=s.getAttribute("href");l&&(l!=e&&-1==l.indexOf(e)||s.parentNode.removeChild(s))}}var u=null;u=n?-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime():e;var c=document.getElementsByTagName("head")[0],h=document.createElement("link");h.type="text/css",h.rel="stylesheet",h.href=u,c.appendChild(h),h.onreadystatechange=function(){"complete"==css.readyState&&null!=i&&i()},h.onload=function(){null!=t&&i()}}(e,i):function(e,t){var i=null;if(window.XMLHttpRequest&&(i=new XMLHttpRequest),null!=i){i.onreadystatechange=function(){if(4==i.readyState)if(200==i.status){if(null!=t){var n=null;try{n=JSON.parse(i.responseText)}catch(e){n=i.responseText}a[e]=n,t(),i=null}}else console.log("Problem retrieving XML data:"+i.statusText),i=null};var r=null;r=n?-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime():e,i.open("GET",r,!0),i.send(null)}else console.error("Your browser does not support XMLHTTP.")}(e,i)}if(i)r>0&&l(e.shift(),(function n(){e.length>0?l(e.shift(),n):null!=t&&t(a)}));else for(var u=0;u<r;u++){l(e[u],s)}},te.dynamicLoadJSON=function(e,t){this.dynamicLoad(e,t)},te.dynamicLoadJS=function(e,t){this.dynamicLoad(e,t)},te.dynamicLoadCSS=function(e,t){this.dynamicLoad(e,t)},te.asyncLoad=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=e.urls||[],i=Ne.parseValue(e.cache,!0),r=Ne.parseValue(e.inOrder,!0);this.dynamicLoad(n,t,!i,r)},te.convertObjectClass=function(e,t){if(!e)return null;if(!t)return null;var n=e.app,i=e.parent,r=n.create({type:t,parent:null}),o=r._beforeConvert;o&&o.call(r),e.trigger("classtypechange",{newObject:r});var a=function(e,t,n){e[n]?Ne.swapValue(e,n,t):e[n]=t[n]};Object.keys(e).forEach((function(t){"_type"!=t&&a(r,e,t)})),Object.keys(r.style).forEach((function(t){a(r.style,e.style,t)})),r.style.obj=r,e._style=null,e._defaultStyle=null;for(var s=r.controls,l=0;l<s.length;l++){var u=s[l].control;void 0===u.object&&(console.error("please implement object accessor in control"),console.error(u)),u.object=r}if(i){var c=i._children;for(l=0;l<c.length;l++)if(c[l]==e){c[l]=r;break}i._children.clearResult()}r._parent=i,r.children.forEach((function(e){e._parent=r})),r._eventTrigger.traverseListener((function(e){e.object=r})),n.events.replaceObjectEvent(r,e),n.objectManager.replaceObject(r,e),e.destroy();var h=r._afterConvert;return h&&h.call(r),r},te.addCastType=function(e,t,n){Ne.castTypes=Ne.castTypes||[],Ne.castTypes.push({type:e,condition:t,params:n}),Ne.evalTypes&&delete Ne.evalTypes[e],THING.factory.registerClass(e,Ne.evaluate(e))},te.removeCastType=function(e,t,n){Ne.castTypes=Ne.castTypes||[];for(var i=0;i<Ne.castTypes.length;i++){var r=Ne.castTypes[i];r.type==e&&(r.condition==t&&(n&&r.params!=n||Ne.castTypes.splice(i--,1)))}},te.getCastTypes=function(){return Ne.castTypes=Ne.castTypes||[],Ne.castTypes},te.runAsync=function(e){return new Promise((function(e){return setTimeout(e,10)})).then((function(){e()}))},te.r=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},te.evaluate=function(e){if(Ne.evalTypes=Ne.evalTypes||{},void 0!==Ne.evalTypes[e])return Ne.evalTypes[e];try{var t=_e(e)||_e("THING."+e);return Ne.evalTypes[e]=t,t}catch(t){return Ne.evalTypes[e]=null,null}},te.instanceOf=function(e,t){if(e.isBaseObject&&Ne.isString(t))return!!e["is"+t];var n=Ne.evaluate(t);if(!n)return!1;try{return e instanceof n}catch(e){return!1}},te.isSupportWebGL=function(){return Ne.system.isSupportWebGL()},te.callFuncByArguments=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=i,o=e[t];if(Ne.isFunction(o))switch(n.length){case 0:return o.call(e);case 1:return o.call(e,n[r+0]);case 2:return o.call(e,n[r+0],n[r+1]);case 3:return o.call(e,n[r+0],n[r+1],n[r+2]);case 4:return o.call(e,n[r+0],n[r+1],n[r+2],n[r+3]);case 5:return o.call(e,n[r+0],n[r+1],n[r+2],n[r+3],n[r+4]);case 6:return o.call(e,n[r+0],n[r+1],n[r+2],n[r+3],n[r+4],n[r+5]);case 7:return o.call(e,n[r+0],n[r+1],n[r+2],n[r+3],n[r+4],n[r+5],n[r+6]);case 8:return o.call(e,n[r+0],n[r+1],n[r+2],n[r+3],n[r+4],n[r+5],n[r+6],n[r+7])}},te._getMD5Code=function(e,t){(new THREE.FileLoader).load(e,(function(e){if(e&&t){var n=SparkMD5.hash(e);t({md5:n})}}),(function(){}),(function(){}))},te._getStringMD5Code=function(e){return SparkMD5.hash(e)},te._base64ToBlob=function(e){for(var t=atob(e),n=t.length,i=new Uint8Array(n);n--;)i[n]=t.charCodeAt(n);return i},te._blobToBase64=function(e){for(var t="",n=0,i=e.length;n<i;++n)t+=String.fromCharCode(e[n]);return btoa(t)},te.Utf8ArrayToStr=function(e){var t,n,i,r,o,a;for(t="",i=e.length,n=0;n<i;)switch((r=e[n++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(r);break;case 12:case 13:o=e[n++],t+=String.fromCharCode((31&r)<<6|63&o);break;case 14:o=e[n++],a=e[n++],t+=String.fromCharCode((15&r)<<12|(63&o)<<6|(63&a)<<0)}return t},te.throttling=function(e,t){var n=void 0,i=void 0,r=void 0,o=function(){n=setTimeout((function(){e.apply(i,r),clearTimeout(n),n=null}),t)};return function(){i=this,r=arguments,n||o()}},te.getLabelPosition=function(e,t){if(!e||!e.length)return null;var n=[];if(n.push(e),t&&0!=t.length)for(var i=0;i<t.length;i++){var r=[t[i][0],t[i][1],t[i][2],t[i][3]];n.push(r)}var o=new polylabel(n);return[o[0],o[1]]},te.setValueBreakpoint=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e!=t};Ne.isArray(t)?t.forEach((function(t){xe(e,[t],n)})):Ne.isString(t)&&xe(e,[t],n)},te.enableNaNCatch=function(e){e&&!Object.prototype.originalValueOf?(Object.prototype.originalValueOf=Object.prototype.valueOf,Object.prototype.valueOf=function(){if("number"!=typeof this)throw new Error("Object is not a Number");return this.originalValueOf()}):(Object.prototype.valueOf=Object.prototype.originalValueOf,Object.prototype.originalValueOf=null)},te.loadImage=function(e,t,n){var i=document.createElementNS("http://www.w3.org/1999/xhtml","img");function r(){i.removeEventListener("load",r,!1),i.removeEventListener("error",o,!1),t&&t(this)}function o(e){i.removeEventListener("load",r,!1),i.removeEventListener("error",o,!1),n&&n(e)}return i.addEventListener("load",r,!1),i.addEventListener("error",o,!1),i.src=e,i},te.getBase64Image=function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png")},te.getMousePosition=function(e,t){var n,i,r=this.domElement;if(r){var o=r.currentStyle||window.getComputedStyle(r,null),a=t?t[0]:parseInt(o.borderLeftWidth,10),s=t?t[1]:parseInt(o.borderTopWidth,10),l=r.getBoundingClientRect();n=e.clientX-a-l.left,i=e.clientY-s-l.top}else e.layerX||0==e.layerX?(n=e.layerX,i=e.layerY):e.offsetX||0==e.offsetX?(n=e.offsetX,i=e.offsetY):(e.clientX||0==e.clientX)&&(n=e.clientX,i=e.clientY);return{x:Math.round(n),y:Math.round(i)}},te.applyNew=function(e,t){var n=[{}].concat(t||[]);return new(Function.prototype.bind.apply(e,n))},te.binarySearch=function(e,t,n){var i=0,r=e.length-1;if(n)for(;i<=r;){if(0===n(e[o=Math.floor((i+r)/2)],t))return o;n(e[o],t)>0?r=o-1:i=o+1}else for(;i<=r;){var o;if(t===e[o=Math.floor((i+r)/2)])return o;t<e[o]?r=o-1:i=o+1}return-1},te.binaryBound=function(e,t,n){if(!e.length)return 0;var i=0,r=e.length-1;if(n){for(;i<r-1;){var o=n(e[a=Math.floor((i+r)/2)],t);if(0==o)return a;o<0?i=a:r=a}if(n(e[i],t)>0)return i;if(n(e[r],t)>0)return r}else{for(;i<r-1;){var a;if(e[a=Math.floor((i+r)/2)]===t)return a;e[a]<t?i=a:r=a}if(e[i]>t)return i;if(e[r]>t)return r}return-1},te.insertBinaryBound=function(e,t,n){var i=Ne.binaryBound(e,t,n);return-1===i?e.push(t):e.splice(i,0,t),e},te.itoa=function(e){return String.fromCharCode(e)},te.atoi=function(e){return e.charCodeAt()},te);function He(e,t,n,i){this._delaunayTriangles=null,this._rebuiltTriangles=null,this._points=[],this._indices=[],this._graph=null,this._extraIds=[],this._init(e,t,n||40,i)}function ze(e,t){for(var n=[],i=0,r=e.length;i<r;i++){var o=e[i];if(void 0!==t&&0!==n.length){for(var a=n[n.length-1],s=new poly2tri.Point(o.x,o.y),l=Math.ceil(s.clone().sub(a).length()/t),u=s.clone().sub(a).length()/l,c=s.clone().sub(a),h=1;h<l;h++)c.normalize(),n.push(a.clone().add(c.mul(u*h)));n.push(s.clone())}else n.push(new poly2tri.Point(o.x,o.y))}if(void 0!==t)for(a=n[n.length-1],s=n[0],l=Math.ceil(s.clone().sub(a).length()/t),u=s.clone().sub(a).length()/l,c=s.clone().sub(a),h=1;h<l;h++)c.normalize(),n.push(a.clone().add(c.mul(u*h)));return n}function Ue(e,t){for(var n=1/0,i=0,r=0,o=t.length;r<o;r++){var a=e.distanceTo(t[r]);a<n&&(n=a,i=r)}return i}Object.defineProperties(Ne,{disableLog:{get:function(){return console.log!=Ne.consoleLogFunc},set:function(e){console.log=e?function(){}:Ne.consoleLogFunc}},disableWarning:{get:function(){return console.warn!=Ne.consoleWarnFunc},set:function(e){console.warn=e?function(){}:Ne.consoleWarnFunc}},disableTime:{get:function(){return console.time!=Ne.consoleTimeFunc},set:function(e){e?(console.time=function(){},console.timeEnd=function(){}):(console.time=Ne.consoleTimeFunc,console.timeEnd=Ne.consoleTimeEndFunc)}}}),Object.assign(He.prototype,{_init:function(e,t,n,i){var r,o;if(e.contour)(r={}).contour=ze(e.contour,n),r.holes=e.holes.map((function(e){return ze(e,n)})),o=e.y;else{var a=new THREE.Geometry;a.fromBufferGeometry(e),a.mergeVertices(),r=function(e,t){for(var n={},i=0,r=e.faces,o=r.length;i<o;i++)for(var a=[r[i].a,r[i].b,r[i].c].sort((function(e,t){return e-t})),s=[[0,1],[1,2],[0,2]],l=0;l<s.length;l++){var u=a[s[l][0]],c=a[s[l][1]];n[u+"_"+c]?n[u+"_"+c].count++:n[u+"_"+c]={start:u,end:c,count:1}}var h=[];for(var p in n)1===n[p].count&&h.push(n[p]);var d=[];for(;h.length>0;){var f,m=[],g=h[0].start,v=h[0].end;for(f=e.vertices[h[0].end],m.push({x:f.x,y:f.z}),h.splice(0,1);v!==g;)for(i=0,o=h.length;i<o;i++){if(h[i].start==v){f=e.vertices[h[i].end],m.push({x:f.x,y:f.z}),v=h[i].end,h.splice(i,1);break}if(h[i].end==v){f=e.vertices[h[i].start],m.push({x:f.x,y:f.z}),v=h[i].start,h.splice(i,1);break}}d.push(m)}function y(e){for(var t=1/0,n=1/0,i=0;i<e.length;i++)e[i].x<t&&(t=e[i].x),e[i].y<n&&(n=e[i].y);return{x:t,y:n}}var b=1/0,_=1/0,x=0,E=[];for(i=0,o=d.length;i<o;i++){var w=ze(d[i],t);E.push(w);var T=y(w);(T.x<b||T.y<_)&&(b=T.x,_=T.y,x=i)}var M=E[x];return E.splice(x,1),{contour:M,holes:E}}(a,n),o=a.vertices[0].y}var s=new poly2tri.SweepContext(r.contour);if(s.addHoles(r.holes),s.triangulate(),this._delaunayTriangles=s.getTriangles(),this._rebuiltTriangles=function(e,t){for(var n=[],i=0;i<e.length;i++){var r=e[i].getPoints(),o=new THREE.Triangle;o.a.set(r[0].x,t,r[0].y),o.b.set(r[1].x,t,r[1].y),o.c.set(r[2].x,t,r[2].y),n.push(o)}return n}(this._delaunayTriangles,o),function(e,t,n,i){var r=0;e.forEach((function(e){for(var t=0;t<e.points_.length;t++)void 0===e.points_[t]._id&&(e.points_[t]._id=r++)}));var o=[[1,2],[0,2],[0,1]],a={},s=0;e.forEach((function(e){for(var r=[],l=0;l<3;l++){if(!e.constrained_edge[l]){var u=e.getPoint(o[l][0]),c=e.getPoint(o[l][1]);if(!a[u._id+"_"+c._id]){var h=new THREE.Vector3((u.x+c.x)/2,i,(u.y+c.y)/2);h._index=s++;var p=(new THREE.Vector3).set(u.x,i,u.y);p._id=u._id;var d=(new THREE.Vector3).set(c.x,i,c.y);d._id=c._id,h._endPoints=[p,d],t.push(h),a[u._id+"_"+c._id]=h,a[c._id+"_"+u._id]=h}r.push(a[u._id+"_"+c._id])}}2===r.length&&n.push(r[0]._index,r[1]._index),3===r.length&&(n.push(r[0]._index,r[1]._index),n.push(r[1]._index,r[2]._index),n.push(r[2]._index,r[0]._index)),e._sharedMidPoints=r}))}(this._delaunayTriangles,this._points,this._indices,o),t&&t.length>0)for(var l=this._points.slice(0),u=0;u<t.length;u++){var c=t[u],h=this._points.length,p=Ue(c,l);this._points.push(c.clone()),this._indices.push(h,p),this._extraIds.push(h)}this._graph=function(e,t,n){var i={};n&&n.forEach((function(e){e.box=(new THREE.Box3).setFromPoints(e)}));for(var r=0,o=t.length;r<o;r+=2){var a=t[r+0],s=t[r+1],l=e[a],u=e[s];i[a]=i[a]||{},i[s]=i[s]||{},n&&n.find((function(e){return Je(l,u,e)}))?i[a][s]=i[s][a]=1/0:i[a][s]=i[s][a]=l.distanceTo(u)}return new Graph(i)}(this._points,this._indices,i)},findPath:function(e,t,n){var i=void 0!==(n=n||{}).includeStart&&n.includeStart,r=void 0!==n.includeEnd&&n.includeEnd,o=void 0===n.fixEnds||n.fixEnds,a=void 0!==n.pathSmooth?n.pathSmooth:{enable:!1,minFov:.115},s=this,l=[];if(!(c=this._extraIds.find((function(t){return s._points[t].equals(e)})))){var u=this._rebuiltTriangles.findIndex((function(t){return t.containsPoint(e)}));if(u>-1)l=this._delaunayTriangles[u]._sharedMidPoints.map((function(e){return e._index}));else l=[Ue(e,this._points)];var c=this._points.length;this._points.push(e),this._graph.map[c]={},l.forEach((function(t){s._graph.map[t][c]=s._graph.map[c][t]=e.distanceTo(s._points[t])}))}var h=this._extraIds.find((function(e){return s._points[e].equals(t)})),p=[];if(!h){var d=this._rebuiltTriangles.findIndex((function(e){return e.containsPoint(t)}));if(d>-1)p=this._delaunayTriangles[d]._sharedMidPoints.map((function(e){return e._index}));else p=[Ue(t,this._points)];h=this._points.length,this._points.push(t),this._graph.map[h]={},p.forEach((function(e){s._graph.map[e][h]=s._graph.map[h][e]=t.distanceTo(s._points[e])}))}var f=this._graph.findShortestPath(c,h).map((function(e){return s._points[+e]}));if(!i&&f.shift(),!r&&f.pop(),l.length>0&&(l.forEach((function(e){delete s._graph.map[e][c],delete s._graph.map[c][e]})),this._points.length=this._points.length-1),p.length>0&&(p.forEach((function(e){delete s._graph.map[e][h],delete s._graph.map[h][e]})),this._points.length=this._points.length-1),i&&o&&f.length>=3&&Ge(f[0],f[1],f[2])<.25*Math.PI&&f.splice(1,1),r&&o&&f.length>=3){var m=f.length-1,g=f.length-2,v=f.length-3;Ge(f[m],f[g],f[v])<.25*Math.PI&&f.splice(g,1)}return a&&a.enable&&(f=function(e,t){t=void 0!==t?t:.115;var n=[],i=[],r=-1,o=-1,a=!1;e.forEach((function(e,t){if(0!==t){if(a)return n.push(null),void i.push(null);var s=e._endPoints;if(!s)return n.push(null),i.push(null),void(a=!0);0===n.length?(n.push(s[0]),i.push(s[1]),r=s[0]._id,o=s[1]._id):s[0]._id===r?(n.push(null),i.push(s[1]),o=s[1]._id):s[0]._id===o?(i.push(null),n.push(s[1]),r=s[1]._id):s[1]._id===r?(n.push(null),i.push(s[0]),o=s[0]._id):s[1]._id===o?(i.push(null),n.push(s[0]),r=s[0]._id):(n.push(null),i.push(null),a=!0)}}));for(var s=e[0].clone(),l=new THREE.Vector3,u=new THREE.Vector3,c=new THREE.Vector3,h=new THREE.Vector3,p=new THREE.Vector3,d=[0],f=0;f<n.length;f++){var m=n[f],g=i[f];if(null===m&&null===g)if(f>0&&f===n.length-1&&(null!==n[f-1]||null!==i[f-1])){p.subVectors(e[f+1],s);var v=c.angleTo(p),y=p.angleTo(h);(Math.sign(We(c,p))!==Math.sign(We(p,h))||v<t/2||y<t/2)&&d.push(f)}else d.push(f);else if(0===f)l.copy(m),u.copy(g),c.subVectors(l,s),h.subVectors(u,s);else if(m){p.subVectors(m,s);var b=c.angleTo(h),_=p.angleTo(h);Math.sign(We(c,h))===Math.sign(We(p,h))&&_<=b&&_>t?(c.copy(p),l.copy(m)):(d.push(f),s.copy(e[f]),l.copy(m),c.subVectors(l,s),h.subVectors(u,s))}else if(g){p.subVectors(g,s);b=c.angleTo(h),_=c.angleTo(p);Math.sign(We(h,c))===Math.sign(We(p,c))&&_<=b&&_>t?(h.copy(p),u.copy(g)):(d.push(f),s.copy(e[f]),u.copy(g),c.subVectors(l,s),h.subVectors(u,s))}else console.error("side1 and side2 must has one null value!");f===n.length-1&&d.push(f+1)}return d.map((function(t){return e[t]}))}(f,a.minFov)),f.map((function(e){return e.clone()}))},getExtraPoints:function(){var e=[],t=this;return this._extraIds.forEach((function(n){e.push(t._points[n])})),e},getDistance:function(e,t){for(var n=Ue(e,this._points),i=Ue(t,this._points),r=this._graph.findShortestPath(n,i),o=0,a=0,s=r.length;a<s-1;a++){var l=r[a],u=r[a+1];o+=this._graph.map[l][u]}return o},findNearestPathPoint:function(e){var t=Ue(e,this._points);return this._points[t]},getPoints:function(){return this._points},getIndices:function(){return this._indices},getRebuiltTriangles:function(){return this._rebuiltTriangles}});var Ve=new THREE.Vector3,qe=new THREE.Vector3;function Ge(e,t,n){return Ve.copy(t).sub(e),qe.copy(t).sub(n),Ve.angleTo(qe)}function We(e,t){return e.x*t.z-e.z*t.x}var Xe=new THREE.Box3;function Je(e,t,n){if(Xe.makeEmpty(),Xe.expandByPoint(e),Xe.expandByPoint(t),i=n.box,(r=Xe).max.x<i.min.x||r.min.x>i.max.x||r.max.z<i.min.z||r.min.z>i.max.z)return!1;for(var i,r,o=!1,a=0,s=n.length-1;a<n.length;s=a++)if(Ye(e,t,n[a],n[s])){o=!0;break}return!!o||function(e,t){for(var n=e.x,i=e.z,r=!1,o=0,a=t.length-1;o<t.length;a=o++){var s=t[o].x,l=t[o].z,u=t[a].x,c=t[a].z;l>i!=c>i&&n<(u-s)*(i-l)/(c-l)+s&&(r=!r)}return r}(e,n)}function Ye(e,t,n,i){var r=(e.x-n.x)*(t.z-n.z)-(e.z-n.z)*(t.x-n.x),o=(e.x-i.x)*(t.z-i.z)-(e.z-i.z)*(t.x-i.x);if(r*o>0)return!1;var a=(n.x-e.x)*(i.z-e.z)-(n.z-e.z)*(i.x-e.x);if(a*(a+r-o)>0)return!1;var s=a/(o-r),l=s*(t.x-e.x),u=s*(t.z-e.z);return{x:e.x+l,z:e.z+u}}function Qe(e){this._navigations=e,this._map=null,this._connectNavMap=null,this._connectPoints=[],this._init()}function Ze(e,t){for(var n=-1,i=0;i<t.length;i++)t[i].equals(e)&&(n=i);return n}function Ke(e){var t={};for(var n in e)t[n]=Object.assign({},e[n]);return t}function $e(e){this._navigation=e}Object.assign(Qe.prototype,{_init:function(){this._map={},this._connectNavMap={};for(var e=0;e<this._navigations.length;e++){for(var t=this._navigations[e],n=t.getExtraPoints(),i=0;i<n.length;i++){var r=n[i],o=Ze(r,this._connectPoints);o<0?(o=this._connectPoints.length,r._index=o,this._connectPoints.push(r)):r._index=this._connectPoints[o]._index}if(n.length>1)for(i=0;i<n.length;i++)for(var a=0;a<n.length;a++)if(a!==i){var s=t.getDistance(n[a],n[i]),l=n[a]._index,u=n[i]._index;this._map[l]=this._map[l]||{},this._map[u]=this._map[u]||{},this._map[l][u]=s,this._map[u][l]=s,this._connectNavMap[l]=this._connectNavMap[l]||{},this._connectNavMap[u]=this._connectNavMap[u]||{},this._connectNavMap[l][u]=t,this._connectNavMap[u][l]=t}}},findPath:function(e,t,n,i,r){if((r=r||{}).includeStart=void 0!==r.includeStart&&r.includeStart,r.includeEnd=void 0!==r.includeEnd&&r.includeEnd,e==n)return this._navigations[e].findPath(t,i,r);if(0==this._navigations[e].getExtraPoints().length||0==this._navigations[n].getExtraPoints().length)return console.info("closed space: "+e+" or "+n),[];var o=Ke(this._map),a=Ke(this._connectNavMap),s=0,l=0,u=this._connectPoints.length,c=0;function h(e,t,n){for(var i=t.getExtraPoints(),r=0;r<i.length;r++){var s=Ze(i[r],n),l=t.getDistance(e,i[r]);o[d]=o[d]||{},o[s]=o[s]||{},o[d][s]=l,o[s][d]=l,a[d]=a[d]||{},a[s]=a[s]||{},a[d][s]=t,a[s][d]=t}}var p=(x=this._navigations[e]).findNearestPathPoint(t).clone();if(Ze(p,this._connectPoints)<0){var d=u+c;c++,h(p,x,this._connectPoints),this._connectPoints.push(p),s=d}else s=Ze(p,this._connectPoints);var f=(x=this._navigations[n]).findNearestPathPoint(i).clone();if(Ze(f,this._connectPoints)<0){d=u+c;c++,h(f,x,this._connectPoints),this._connectPoints.push(f),l=d}else l=Ze(f,this._connectPoints);if(s===l){var m=[];return r.includeStart&&m.push(t.clone()),r.includeEnd&&m.push(i.clone()),m}var g=Graph.findShortestPath(o,s,l);if(!g)return console.info("find no path between rooms: "+e+" or "+n),[];for(var v=[],y=0;y<g.length-1;y++){var b=+g[y],_=+g[y+1],x=a[b][_],E={};E.includeStart=y>0||r.includeStart,E.includeEnd=y<g.length-2||r.includeEnd,E.fixEnds=r.fixEnds,E.pathSmooth=r.pathSmooth;var w=x.findPath(0===y?t:this._connectPoints[b],y>=g.length-2?i:this._connectPoints[_],E);0!==y&&w.shift(),v=v.concat(w)}return this._connectPoints.length=u,v}}),Object.assign($e.prototype,{createPathPointsMesh:function(){for(var e=this._navigation.getPoints(),t=[],n=0,i=e.length;n<i;n++){e[n].toArray(t,3*n)}var r=new THREE.BufferGeometry;return r.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3)),new THREE.Points(r)},createPathLineSegmentsMesh:function(){for(var e=this._navigation,t=e.getPoints(),n=[],i=e.getIndices(),r=0,o=t.length;r<o;r++){t[r].toArray(n,3*r)}var a=new THREE.BufferGeometry;return a.addAttribute("position",new THREE.BufferAttribute(new Float32Array(n),3)),a.setIndex(i),new THREE.LineSegments(a)},createRebuiltTrianglesMesh:function(){for(var e=this._navigation.getRebuiltTriangles(),t=[],n=0,i=e.length;n<i;n++){var r=e[n];r.a.toArray(t,18*n+0),r.b.toArray(t,18*n+3),r.b.toArray(t,18*n+6),r.c.toArray(t,18*n+9),r.c.toArray(t,18*n+12),r.a.toArray(t,18*n+15)}var o=new THREE.BufferGeometry;return o.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3)),new THREE.LineSegments(o)},createPathNodeByPoints:function(e){for(var t=[],n=0,i=e.length;n<i;n++){e[n].toArray(t,3*n)}var r=[];for(n=0,i=e.length;n<i;n++)n!==i-1&&r.push(n,n+1);var o=new THREE.Group,a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3));var s=new THREE.Points(a);o.add(s);var l=new THREE.BufferGeometry;l.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3)),l.setIndex(r);var u=new THREE.LineSegments(l);return o.add(u),o}});var et,tt=function(){function e(t){r(this,e),this.object=t,this.prevObjectPosition=null,this.prevObjectScale=null,this.prevObjectAngles=null,this._objects=[],this.groupNavigation=null,this.navigationHelpersNode=null,this.navigationHelpers=[]}return e.prototype.clear=function(){this.showHelper(!1),this.prevObjectPosition=null,this.prevObjectScale=null,this.prevObjectAngles=null,this._objects=[],this.groupNavigation=null,this.navigationHelpers=[]},e.prototype.needGen=function(){var e=this.object;if(!e)return!0;if(!this.prevObjectPosition||!this.prevObjectScale||!this.prevObjectAngles)return!0;var t=Ne.parseVector3(e.position),n=Ne.parseVector3(e.scale),i=Ne.parseVector3(e.angles);return!t.equals(this.prevObjectPosition)||(!n.equals(this.prevObjectScale)||!i.equals(this.prevObjectAngles))},e.prototype.getClipAreas=function(e,t){var n=function(e,t){return e==t||!!e.isChildOf(t)},i=[];if(t)for(var r=0;r<t.length;r++){var o=t[r];if(n(e,o.object)){for(var a=[],s=o.area,l=0;l<s.length;l++){var u=Ne.parseVector3(s[l]);a.push(u)}i.push(a)}}return i},e.prototype.genFromData=function(e,t,n,i){if(!Ne.isFunction(e.getNavigationData))return!1;var r=e.getNavigationData();if(!r)return!1;for(var o=[],a=0;a<8;a+=2)o.push({x:r.data[a],y:r.data[a+1]});var s=[];for(a=0;a<r.holes.length;a++){for(var l=2*r.holes[a],u=[],c=0;c<8;c+=2)u.push({x:r.data[l+c],y:r.data[l+c+1]});s.push(u)}var h=new He({contour:o,holes:s,y:0},t,30,this.getClipAreas(e,i));n.push(h);var p=new $e(h);return this.navigationHelpers.push(p),!0},e.prototype.genFromMesh=function(e,t,n,i,r){if(!Ne.isFunction(e.getNavigationMesh))return!1;var o=e.getNavigationMesh();if(!o)return!1;var a=o.geometry;if(!a)return!1;var s=a.clone();s.isBufferGeometry||(s=(new THREE.BufferGeometry).fromGeometry(s)),s.applyMatrix4(o.matrixWorld),s.applyMatrix4(r);var l=new He(s,t,30,this.getClipAreas(e,i));n.push(l);var u=new $e(l);return this.navigationHelpers.push(u),!0},e.prototype._getCampus=function(){return this.object.isCampus?this.object:this.object.parents.query(".Campus")[0]},e.prototype.initFromObjects=function(e,t){var n=this._getCampus();if(n){var i=new THREE.Matrix4;i.getInverse(n.node.matrixWorld);for(var r=[],o=0;o<e.length;o++){var a=e[o],s=[];a.doors&&a.doors.forEach((function(e){var t=Ne.parseVector3(e.position);t.applyMatrix4(i),s.push(t)})),(this.genFromData(a,s,r,t)||this.genFromMesh(a,s,r,t,i))&&this._objects.push(a)}this.groupNavigation=new Qe(r)}},e.prototype.init=function(e){this.clear();var t=this.object;this.prevObjectPosition=Ne.parseVector3(t.position),this.prevObjectScale=Ne.parseVector3(t.scale),this.prevObjectAngles=Ne.parseVector3(t.angles);try{if(t.isFloor){var n=t.rooms;n.length?this.initFromObjects(n,e):this.initFromObjects([t],e)}else t.isCampus&&this.initFromObjects([t],e)}catch(e){console.error(e),console.error(e.toString()),console.error("Init object(name:"+this.object.name+", id:"+this.object.id+") navigation failed")}},e.prototype.getRoomID=function(e){if(e.isBaseObject)return this._objects.indexOf(e);for(var t=0;t<this._objects.length;t++){var n=this._objects[t];if(n.isFloor)return t;if(n.getRayCastPosition(e))return t;for(var i=n.doors,r=0;r<i.length;r++){var o=i[r];if(THING.Math.equalsVector(o.position,e))return t}}return-1},e.prototype.getEntryInfo=function(e,t,n){var i=e[t],r=e[n],o=-1;return this.object.isFloor?i?o=this.getRoomID(i):r&&(o=this.getRoomID(r)):this.object.isCampus&&(o=0),-1===o?null:{id:o,pos:Ne.parseVector3(r)}},e.prototype.findPath=function(e){e=e||{};var t=this.getEntryInfo(e,"startRoom","startPosition");if(!t)return null;var n=this.getEntryInfo(e,"endRoom","endPosition");if(!n)return null;var i=this._getCampus();if(!i)return null;var r=new THREE.Matrix4;r.getInverse(i.node.matrixWorld);var o=t.pos.clone();o.applyMatrix4(r);var a=n.pos.clone();a.applyMatrix4(r);var s=this.groupNavigation.findPath(t.id,o,n.id,a,{includeStart:!0,includeEnd:!0,fixEnds:!0,pathSmooth:{enable:!0}});if(!s||!s.length)return null;for(var l=e.height||0,u=t.pos,c=[],h=0;h<s.length;h++){var p=s[h];p.y+=l,length+=p.distanceTo(u),u=p,p.applyMatrix4(i.node.matrixWorld),c.push(p.toArray())}return c.getPathLength=function(){return Ne.getLength(this)},c},e.prototype.showHelper=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.object)if(e){if(!this.navigationHelpersNode){this.navigationHelpersNode=new THREE.Group;var t=this._getCampus();if(!t)return;for(var n=0;n<this.navigationHelpers.length;n++){var i=this.navigationHelpers[n],r=i.createRebuiltTrianglesMesh();r.position.y=.1,r.material.color.setHex(6985427),this.navigationHelpersNode.add(r);var o=i.createPathPointsMesh();this.navigationHelpersNode.add(o);var a=i.createPathLineSegmentsMesh();this.navigationHelpersNode.add(a)}this.navigationHelpersNode.applyMatrix4(t.node.matrixWorld),this.object.app.scene.add(this.navigationHelpersNode)}}else this.navigationHelpersNode&&(this.object.app.resourceManager.remove(this.navigationHelpersNode),this.navigationHelpersNode=null)},e}(),nt=function(e){return!e.isLight&&!e.userData.skipBoundingBox},it=function(){function e(){r(this,e),this.object=null,this._boxes=null,this._initBoxes(),this._disable=!1}return e.prototype.onAdd=function(e){this.object=e},e.prototype.onRemove=function(){},e.prototype.onUpdate=function(e){},e.prototype._getKey=function(e,t){return(e?"_onlyVisible":"_all")+(t?"_onlySelf":"")},e.prototype._getBox=function(e,t,n){var i=this._getKey(t,n);return this._boxes[e][i]},e.prototype._setBox=function(e,t,n,i){if(!t||this.object.visible){var r=this._getKey(t,n);this._boxes[e][r]=i}},e.prototype._updateBox=function(e,t,n,i,r){var o=this._getBox(e,t,n);if(!o){var a=new THREE.Box3,s=this.object.node;a._setFromObject(s,(function(e){return(!r||!1!==r(e))&&(!(t&&!e.ensureVisible())&&nt(e))}),i),o=this._processBox(a,this.object),this._setBox(e,t,n,o)}return o},e.prototype._getVector3=function(e){return e.toArray()},e.prototype._processBoxResult=function(e,t){e.toBox=function(){var t=Ne.parseVector3(e.min),n=Ne.parseVector3(e.max);return t.z==n.z&&(t.z-=1e-6,n.z+=1e-6),new THREE.Box3(t,n)},e.getWorldPosition=function(e){var n=t.getOffsetPosition(e);n=THING.Math.divideVector(n,t.scale);var i=e.boundingBox||t.boundingBox,r=t.worldToSelf(i.center),o=THING.Math.addVector(r,n);return t.selfToWorld(o)},void 0===e.initSize&&Object.defineProperties(e,{initSize:{get:function(){if(t._initBoxSize)return t._initBoxSize;var e,n=function(e){var t=new THREE.Vector3;return e.getSize(t),t.toArray()},i=function(e){return!e||!!THING.Math.equalsVector(e,[0,0,0])},r=t.app.modelResource.getBoundingBox(t.url);if(r&&(e=r.size.concat()),i(e)&&t._loadingBoxSize&&(e=t._loadingBoxSize),i(e)){var o=new THREE.Box3;t._traverseSelfNodes((function(e){e.isMesh&&o.union((new THREE.Box3)._setFromObject(e,nt))})),e=n(o)}return i(e)?(o=(new THREE.Box3)._setFromObject(t.node,nt),t._initBoxSize=n(o)):t._initBoxSize=e,t._initBoxSize}}})},e.prototype._processBox=function(e,t){var n=[];e.getBoundingPositions().forEach((function(e){n.push(e.toArray())}));var i=new THREE.Vector3;e.getSize(i);var r=new THREE.Vector3;e.getCenter(r);var o=this._getVector3(e.min),a=this._getVector3(e.max),s=this._getVector3(i),l=this._getVector3(r),u={points:n,min:o,max:a,center:l,size:s,radius:i.length()};return this._processBoxResult(u,t),u},e.prototype._processOrientedBox=function(e,t){var n=t.node,i=e.points,r=[],o=new THREE.Vector3(1/0,1/0,1/0),a=new THREE.Vector3(-1/0,-1/0,-1/0);i.forEach((function(e){var t=Ne.parseVector3(e);t.applyMatrix4(n.matrixWorld),o.min(t),a.max(t),r.push(t.toArray())}));var s=new THREE.Vector3;n.getWorldScale(s);var l=Ne.parseVector3(e.size).multiply(s),u=new THREE.Vector3;u.addVectors(o,a).multiplyScalar(.5);var c=this._getVector3(o),h=this._getVector3(a),p=this._getVector3(l),d=this._getVector3(u),f={points:r,min:c,max:h,center:d,size:p,radius:l.length()};return this._processBoxResult(f,t),f},e.prototype._getInverseMatrixWorld=function(e){var t=new THREE.Matrix4;return e.updateWorldMatrix(!0,!1),t.getInverse(e.matrixWorld),t},e.prototype.getBoundingBox=function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n){var i=this;e=function(e){return!i.object._isChildNode(e)}}var r=this._updateBox("boundingBox",t,n,null,e);return r},e.prototype.getOrientedBoundingBox=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this._getBox("orientedBoundingBox",e,t);return n||(n=this._processOrientedBox(this.getLocalBoundingBox(e,t),this.object),this._setBox("orientedBoundingBox",e,t,n)),n},e.prototype.getLocalBoundingBox=function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this._getInverseMatrixWorld(this.object.node);if(n){var r=this;e=this._updateBox("selfLocalBoundingBox",t,n,i,(function(e){return!r.object._isChildNode(e)}))}else e=this._updateBox("localBoundingBox",t,n,i);return e},e.prototype._traverse=function(e){for(var t in this._boxes){var n=this._boxes[t];for(var t in n)n[t]&&(n[t]=e(n[t],t))}},e.prototype._initBoxes=function(){this._boxes={boundingBox:{},orientedBoundingBox:{},localBoundingBox:{},selfLocalBoundingBox:{}}},e.prototype.translate=function(e,t){var n=Ne.parseVector3(e);this._traverse((function(e,i){return t&&t!=i||e.translate(n),e}))},e.prototype.setDirty=function(e,t){for(var n in this._boxes){var i=this._getKey(e,t);this._boxes[n][i]=null}},o(e,[{key:"dirty",set:function(e){this._disable||e&&this._initBoxes()}},{key:"disable",set:function(e){this._disable=e},get:function(){return this._disable}}]),e}();it._processBox=function(e,t){return(et=et||new it)._processBox(e,t)};var rt=new Map,ot=new Map,at=new Map;function st(e,t){for(var n=0,i=t.length;n<i;n++){var r=t[n];if(e.startsWith(r))return!0}return!1}function lt(e){for(var t="",n=0;n<e.length;n++){var i=e[n];if("="!=i&&"<"!=i&&">"!=i&&"!"!=i)break;t+=i}return"="==t&&(t="=="),t.trimBoth(" \t")}function ut(e,t){for(var n=e+"('",i="",r=0;r<t.length;r++){var o=t[r];if("="==o||"<"==o||">"==o||"!"==o)break;i+=o}n+=i.trimBoth('" \t'),n+="'",n+=",";var a=t.substring(r);if(a){var s=lt(a);s&&(a=(a=a._trimLeft(s).trimBoth(" \t")).replaceAll("^(0+)",""),Ne.isNumberString(a)||'"'!=a[0]&&"'"!=a[0]&&(a="'"+a+"'")),n+=a}return n+=")"}function ct(e,t){for(var n=e+"('",i="",r=0;r<t.length;r++){var o=t[r];if("="==o||"<"==o||">"==o||"!"==o)break;i+=o}n+=i.trimBoth('" \t'),n+="'",n+=")";var a=t.substring(r);if(a){var s=lt(a);s&&(a=(a=a._trimLeft(s).trimBoth(" \t")).replaceAll("^(0+)",""),Ne.isNumberString(a)||'"'!=a[0]&&"'"!=a[0]&&(a="'"+a+"'")),n+=s,n+=a}return n}function ht(e,t,n,i){var r="";r+=e+"(",i&&(r+='"');var o=function(e,t){var n="";if(Ne.isArray(t))for(var i=0,r=e.length;i<r&&!st(e.substring(i),t);i++)n+=e[i];else for(i=0,r=e.length;i<r;i++){var o=e[i];if(-1!==t.indexOf(o))break;n+=o}return n.trimBoth(" ")}(t,n);return r+=o,i&&(r+='"'),{expression:r+=")",value:o}}function pt(e){for(var t=0;t<e.length;t++){var n=e[t];if("="==n||"<"==n||">"==n||"!"==n)return!0}return!1}function dt(e,t,n){e.forEach((function(e){e.isBaseObject&&t.evaluate(function(e){return{_name:function(t){return e.name==t},_id:function(t){return t.startsWith("#")?e.uuid==t.substring(1):e.id==t},_type:function(t){return!!e["is"+t]||e.type==t},_regExp:function(t,n){var i=n;if(n.startsWith("[")){var r=n.substr(1,n.length-2).trimBoth(" \t");i=e.getAttribute(r)}if(Ne.isString(i)){var o=at.get(t);return o||(o=new RegExp(t),at.set(t,o)),o.test(i)}return!1},_regExpAttribute:function(t,n){var i=[];THING.__new__selector__?(i.push(e.getAttribute(t)),i.push(e.getAttribute("userData/"+t))):(i.push(e.getAttribute("userData/"+t)),i.push(e.getAttribute(t)));var r=ot.get(n);r||(r=new RegExp("^"+n._trimRight("*")),ot.set(n,r));for(var o=0;o<i.length;o++)if(r.test(i[o]))return!0;return!1},_attribute:function(t){var n;return THING.__new__selector__?void 0===(n=e.getAttribute(t))&&(n=e.getAttribute("userData/"+t)):void 0===(n=e.getAttribute("userData/"+t))&&(n=e.getAttribute(t)),n},_hasAttribute:function(t){var n=!1;return THING.__new__selector__?(n=e.hasAttribute(t))||(n=e.hasAttribute("userData/"+t)):(n=e.hasAttribute("userData/"+t))||(n=e.hasAttribute(t)),n}}}(e))&&ft(n,e)}))}function ft(e,t){t.canNotQueryFromSelector||e.push(t)}var mt=function(){function e(t,n){r(this,e),this.app=t,this.objects=n}return e.prototype._setAttribute=function(e,t){for(var n=0;n<this.objects.length;n++){var i=this.objects[n];i&&(i.style[e]=t)}},e.prototype.setMaterial=function(e){this.objects.forEach((function(t){t.style.setMaterial(e)}))},o(e,[{key:"renderOrder",set:function(e){this._setAttribute("renderOrder",e)}},{key:"color",set:function(e){this._setAttribute("color",e)}},{key:"opacity",set:function(e){this._setAttribute("opacity",e)}},{key:"outlineColor",set:function(e){this._setAttribute("outlineColor",e)}},{key:"defaultOutlineColor",set:function(e){this._setAttribute("defaultOutlineColor",e)}},{key:"skipOutline",set:function(e){this._setAttribute("skipOutline",e)}},{key:"skipBoundingBox",set:function(e){this._setAttribute("skipBoundingBox",e)}},{key:"wireframe",set:function(e){this._setAttribute("wireframe",e)}},{key:"axisHelper",set:function(e){this._setAttribute("axisHelper",e)}},{key:"boundingBox",set:function(e){this._setAttribute("boundingBox",e)}},{key:"boundingBoxColor",set:function(e){this._setAttribute("boundingBoxColor",e)}},{key:"alwaysOnTop",set:function(e){this._setAttribute("alwaysOnTop",e)}},{key:"glow",set:function(e){this._setAttribute("glow",e)}},{key:"innerGlow",set:function(e){this._setAttribute("innerGlow",e)}},{key:"emissive",set:function(e){this._setAttribute("emissive",e)}}]),e}(),gt=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r(this,e),this.objects=[],this.app=t,this.objectManager=t.objectManager,this.events=t.events,this.length=0,this.initObjectPool=n||this.objectManager.objects,this.ignoreCheckingQueryableObjects=i}return e.prototype.query=function(t){var n=new e(this.app,this.initObjectPool);return n.select(t,this.objects),n},e.prototype._getObjects=function(t){var n=null;if(t.isSelector)n=(i=t).objects;else if(Ne.isString(t)){var i;(i=new e(this.app,this.initObjectPool)).select(t),n=i.objects}else Ne.isArray(t)?n=t:t.isBaseObject||t.isGroup?n=[t]:console.error("selector.add unkown: "+t);return n},e.prototype.remove=function(e){if(!e)return this;var t=this._getObjects(e);if(!t)return this;for(var n=this.objects,i=0;i<n.length;i++)for(var r=0;r<t.length;r++)if(n[i]==t[r]){n.splice(i--,1);break}return this.buildReturnObject(n)},e.prototype.add=function(e){if(!e)return this;var t=this._getObjects(e);if(!t)return this;var n=this.objects.concat(t),i=Array.from(new Set(n));return this.buildReturnObject(i)},e.prototype.not=function(t){if(!t)return this;var n=null;if(t.isSelector)n=(i=t).objects;else if(Ne.isString(t)){var i;(i=new e(this.app,this.initObjectPool)).select(t),n=i.objects}else if(Ne.isArray(t))n=t;else{if(!t.isBaseObject&&!t.isGroup)return console.error("selector.not unkown: "+t),this;n=[t]}for(var r=0;r<n.length;r++){var o=n[r],a=this.objects.indexOf(o);a>-1&&this.objects.splice(a,1)}var s=this.objects;return this.buildReturnObject(s)},e.prototype.parse=function(e,t,n){if(Ne.isString(e))if("*"==(e=(e=e._trimLeft("$")).trimBoth(' \t"')))!function(e,t){e.forEach((function(e){ft(t,e)}))}(t,n);else{var i=rt.get(e);if(i)dt(t,i,n);else{var r=function(e){for(var t="",n=0;n<e.length;n++){var i=e[n];if(" "!=i&&"\t"!=i)if("#"==i)t+=(s=ht("_id",e.substring(n+1),"\t|&",!0)).expression,n+=s.value.length;else if("."==i)t+=(s=ht("_type",e.substring(n+1),"\t|&",!0)).expression,n+=s.value.length;else if("/"==i){n+=(s=ht("_regExp",e.substring(n+1),"/",!0)).value.length+1;var r=e.substring(n).indexOf("(");if(-1!==r){n+=r+1;var o=e.substring(n).indexOf(")");if(-1!==o){var a=e.substr(n,o);t+="_regExp('"+s.value+"', '"+a+"')",n+=o+1}}}else if("["==i)(s=ht("",e.substring(n+1),"]")).value.endsWith("*")?t+=ut("_regExpAttribute",s.value):t+=ct(pt((s=ht("",e.substring(n+1),"]")).value)?"_attribute":"_hasAttribute",s.value),n+=s.value.length+1;else if("|"==i)"|"==e[n+1]&&n++,t+="||";else if("&"==i)"&"==e[n+1]&&n++,t+="&&";else if("("==i||")"==i)t+=i;else{var s;t+=(s=ht("_name",e.substring(n),["\t","||","&&"],!0)).expression,n+=s.value.length}}return t}(e);(i=function(e,t,n){var i=rt.get(e);if(!i)try{i=new THING.Plugins.EVAL.Eval(e)}catch(e){return console.error(e),null}return dt(t,i,n),i}(r,t,n))?rt.set(e,i):console.error("Eval '"+e+"' expression failed")}}else Ne.isRegExp(e)?function(e,t,n){t.forEach((function(t){e.test(t.name)&&ft(n,t)}))}(e,t,n):Ne.isFunction(e)?function(e,t,n){t.forEach((function(t){e(t)&&ft(n,t)}))}(e,t,n):e.isSelector&&function(e,t,n){t.forEach((function(t){e.has(t)&&ft(n,t)}))}(e,t,n)},e.prototype.queryResult=function(e,t){e=e||{},t=t||this.initObjectPool;var n=[];return this.parse(e,t,n),n},e.prototype.test=function(e,t){return!!this.queryResult(e,t).length},e.prototype.select=function(e,t){var n=this.queryResult(e,t);return this.buildReturnObject(n)},e.prototype.buildReturnObject=function(e){if(this.clear(),(e=e||[]).isSelector&&(e=e.toArray()),!this.ignoreCheckingQueryableObjects)for(var t=0;t<e.length;t++)e[t].canNotQueryFromSelector&&e.splice(t--,1);this.objects=e,this.length=e.length;for(t=0;t<e.length;t++)this[t]=e[t];return this},e.prototype.clear=function(){for(var e=0;e<this.length;e++)this[e]=null;this.objects=[],this.length=0},e.prototype.forEach=function(e){if(e)for(var t=0;t<this.objects.length;t++){var n=this.objects[t];if(n)if(!1===e(n))break}},e.prototype.filter=function(t){var n=this.objects.filter((function(e){return!!e&&!1!==t(e)})),i=new e(this.app,n);return i.buildReturnObject(n),i},e.prototype.sort=function(e){e=e||function(e,t){var n=e.levelFromRoot;return t.levelFromRoot-n},this.objects.sort(e);for(var t=0;t<this.objects.length;t++)this[t]=this.objects[t];return this},e.prototype.toJSON=function(){return JSON.stringify(this.objects)},e.prototype.toArray=function(){return this.objects},e.prototype.indexOf=function(e){return this.objects.indexOf(e)},e.prototype.splice=function(e,t){this.objects.splice(e,t),this.length=this.objects.length},e.prototype.concat=function(t){var n=new e(this.app,this.objects);if(n.buildReturnObject(this.objects),t)for(var i=0;i<t.length;i++)-1===n.indexOf(t[i])&&n.add(t[i]);return n},e.prototype.reverse=function(){var t=this.objects.reverse(),n=new e(this.app,t);return n.buildReturnObject(t),n},e.prototype.has=function(e){return-1!==this.objects.indexOf(e)},e.prototype.equals=function(e){if(this.length!=e.length)return!1;for(var t=0;t<this.length;t++)if(this[t]!=e[t])return!1;return!0},e.prototype.setOpacity=function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=0;n<this.objects.length;n++){var i=this.objects[n];i&&i.style.setOpacity(e,t)}},e.prototype.flipVisible=function(){for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t&&(t.visible=!t.visible)}},e.prototype.fadeIn=function(e){for(var t=0;t<this.objects.length;t++){var n=this.objects[t];n&&n.fadeIn(e)}},e.prototype.fadeOut=function(e){for(var t=0;t<this.objects.length;t++){var n=this.objects[t];n&&n.fadeOut(e)}},e.prototype.destroyAll=function(){for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t&&t.destroy()}this.clear()},e.prototype.on=function(e,t,n,i,r){this.objects.forEach((function(o){o.on(e,t,n,i,r)}))},e.prototype.off=function(e,t,n){this.objects.forEach((function(i){i.off(e,t,n)}))},e.prototype.one=function(e,t,n,i,r){this.objects.forEach((function(o){o.one(e,t,n,i,r)}))},e.prototype.trigger=function(e,t,n){for(var i=0;i<this.objects.length;i++)this.objects[i].trigger(e,t,n)},e.prototype.pauseEvent=function(e,t,n){for(var i=0;i<this.objects.length;i++)this.objects[i].pauseEvent(e,t,n)},e.prototype.pauseEventInFrame=function(e,t,n){for(var i=0;i<this.objects.length;i++)this.objects[i].pauseEventInFrame(e,t,n)},e.prototype.resumeEvent=function(e,t,n){for(var i=0;i<this.objects.length;i++)this.objects[i].resumeEvent(e,t,n)},e.prototype.getNodes=function(){for(var e=function(e,t){for(var n=0;n<e.length;n++)if(t==e[n]||t.isChildOf(e[n]))return!0;return!1},t=[],n=0;n<this.objects.length;n++){var i=this.objects[n];e(t,i.node)||t.push(i.node)}return t},e.prototype.destroy=function(){console.warn("[Selector] Please use '.destroyAll()' to replace '.destroy()'"),this.destroyAll()},e.prototype.showBoundingBox=function(e){console.warn("[Selector] Please use '.style.boundingBox=' to replace '.showBoundingBox()'"),this.style.boundingBox=e},o(e,[{key:"isSelector",get:function(){return!0}},{key:"inheritVisible",set:function(e){Ne.setArrayValue(this.objects,"inheritVisible",e)}},{key:"inheritStyle",set:function(e){Ne.setArrayValue(this.objects,"inheritStyle",e)}},{key:"inheritPosition",set:function(e){Ne.setArrayValue(this.objects,"inheritPosition",e)}},{key:"inheritAngles",set:function(e){Ne.setArrayValue(this.objects,"inheritAngles",e)}},{key:"inheritScale",set:function(e){Ne.setArrayValue(this.objects,"inheritScale",e)}},{key:"visible",set:function(e){Ne.setArrayValue(this.objects,"visible",e)}},{key:"pickable",set:function(e){Ne.setArrayValue(this.objects,"pickable",e)}},{key:"draggable",set:function(e){Ne.setArrayValue(this.objects,"draggable",e)}},{key:"style",get:function(){return new mt(this.app,this.objects)}},{key:"opacity",set:function(e){console.warn("[Selector] Please use '.style.opacity=' to replace '.opacity'"),this.style.opacity=e}}]),e}(),vt=Symbol("private");function yt(e,t){e[vt]={};var n=e[vt];n.init=function(){n.values=Ne.parseValue(t.values,0),n.onChange=t.onChange},n.notifyChangeEvent=function(){if(n.previousValues!=n.values){for(var e=0;e<32;e++){var t=1<<e,i=n.values&t;if((n.previousValues&t)!=i){var r=n.watchers[t];r&&r(!!i)}}var o=n.onChange;o&&o({previousValues:n.previousValues,values:n.values})}},n.values=0,n.previousValues=0,n.watchers={},n.onChange=null,n.init()}var bt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),yt(this,t)}return e.prototype.enable=function(e,t){var n=this[vt],i=n.values;return t?this.combine(e):this.clear(e),i!=n.values},e.prototype.check=function(e,t){return!!(this[vt].values&e)==t},e.prototype.set=function(e){if(!Ne.isNull(e)){var t=this[vt];t.previousValues=t.values,t.values=e,t.notifyChangeEvent()}},e.prototype.get=function(e){return!!(this[vt].values&e)},e.prototype.combine=function(e){var t=this[vt];t.previousValues=t.values,t.values|=e,t.notifyChangeEvent()},e.prototype.clear=function(e){var t=this[vt];t.previousValues=t.values,Ne.isNull(e)?t.values=0:t.values&=~e,t.notifyChangeEvent()},e.prototype.has=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this[vt];return t?(n.values&e)==e:0!=(n.values&e)},e.prototype.watch=function(e,t){for(var n=this[vt].watchers,i=0;i<32;i++){var r=e&1<<i;r&&(n[r]=t)}},o(e,[{key:"values",get:function(){return this[vt].values}},{key:"onChange",get:function(){return this[vt].onChange},set:function(e){this[vt].onChange=e}}]),e}(),_t=Symbol("private"),xt=1,Et=2,wt=1;var Tt=function(){function e(){r(this,e),function(e){e[_t]={};var t=e[_t];t.parseEvent=function(e,t,n,i){e=Ne.parseValue(e,"");var r={condition:null,callback:null,tag:null,priority:50};return Ne.isFunction(e)?(r.callback=e,Ne.isString(t)?(r.tag=t,r.priority=i||r.priority):Ne.isNumber(t)&&(r.priority=t)):Ne.isString(e)&&(Ne.isFunction(t)||THING.onError("Parse event failed, due to callback is not function with condition"),r.condition=e,r.callback=t,Ne.isString(n)?(r.tag=n,r.priority=i||r.priority):Ne.isNumber(n)?r.priority=n:r.priority=i||r.priority),r.callback||THING.onError("Parse event failed, deu to callback function is not existing"),r},t.createCacheKey=function(e,t){return e.uuid+"|"+t},t.updateListenerMap=function(e,t){var n=e.get(t.object);n?Ne.insertBinaryBound(n,t,(function(e,t){return t.priority==e.priority?e.__index-t.__index:t.priority-e.priority})):e.set(t.object,[t])},t.addListener=function(e,n){var i=n.callback;i.key=t.createCacheKey(n.object,n.tag),e.caches.set(i.key,n),t.updateListenerMap(e.listenerMap,n),n.condition&&(e.conditionalListeners=e.conditionalListeners||new Map,t.updateListenerMap(e.conditionalListeners,n))},t.removeAllListeners=function(e,t){e.listenerMap.get(t).forEach((function(t){e.caches.delete(t.callback.key)})),e.listenerMap.delete(t);var n=e.conditionalListeners;n&&n.delete(t)},t.getListener=function(e,n,i){var r=t.createCacheKey(n,i);return e.caches.get(r)},t.getListeners=function(e,n){var i=t.hookers[e];return i?i.listenerMap.get(n):null},t.traverseListener=function(e){var n=t.hookers;for(var i in n)t.traverseListenerByType(i,e)},t.traverseListenerByType=function(e,n){var i=t.hookers[e];i&&i.listenerMap.forEach((function(e){e.forEach((function(e){n(e)}))}))},t.createListeners=function(){return{listenerMap:new Map,caches:new Map,conditionalListeners:null}},t.deleteListeners=function(e){e.listenerMap.forEach((function(e){e.forEach((function(e){e.object=null}))})),e.listenerMap.clear(),e.caches.clear(),e.conditionalListeners=null},t.removeListenerFromMap=function(e,t){e&&e.forEach((function(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}))},t.removeListener=function(e,n){var i=n.callback.key,r=e.caches.get(i);r&&r.removed&&e.caches.delete(i),t.removeListenerFromMap(e.listenerMap,n),t.removeListenerFromMap(e.conditionalListeners,n)},t.invokeListener=function(e,t){var n=THING.onBeforeCallEventListener;n&&n(e,t),(t=t||{}).object=t.object||e.object,t.data=t.data||e.userData;var i=e.callback.call(t.object,t,e.tag),r=THING.onAfterCallEventListener;return r&&r(e,t),e.once&&(e.removed=!0),i},t.dispatchEvent=function(e,n,i,r,o){for(var a=null,s=0;s<n.length;s++){var l=n[s];if(l.removed)s--,t.removeListener(e,l);else if(!(l.paused||o&&l.tag!=o)){if(l.selector){if(l.object&&!i.isChildOf(l.object))continue;if(l.selector&&!l.selector.test(l.condition,i))continue}else if(l.object&&l.object!=i)continue;var u=t.invokeListener(l,r);a=a||u}}return a},t.addEventListener=function(n,i,r,o,a,s,l,u){t.hookers[n]=t.hookers[n]||t.createListeners();var c=t.hookers[n];a&&e.removeEventListener(n,i,a);var h={__index:wt++,type:n,object:i,callback:o,tag:a,priority:s,once:l,userData:u,state:new bt};Object.defineProperties(h,{removed:{get:function(){return this.state.has(xt)},set:function(e){if(this.state.enable(xt,e),e){var t=this.callback.onRemove;t&&t()}}},paused:{get:function(){return this.state.has(Et)},set:function(e){this.state.enable(Et,e)}},actived:{get:function(){return!this.removed&&!this.paused}}}),r&&Ne.isString(r)&&(h.selector=new gt,h.condition=r),t.addListener(c,h);var p=THING.onAddEventListener;p&&p(h)},t.removeEventListener=function(e,n,i){var r=t.hookers[e];if(r)if(i){var o=t.getListener(r,n,i);if(!o)return;o.removed=!0;var a=THING.onRemoveEventListener;a&&a(o)}else r.listenerMap.forEach((function(e){e.forEach((function(e){e.removed=!0;var t=THING.onRemoveEventListener;t&&t(e)}))}))},t.hookers={}}(this)}return e.prototype.dispose=function(){var e=this[_t];for(var t in e.hookers)e.deleteListeners(e.hookers[t]);e.hookers={}},e.prototype.addEventListener=function(e,t,n,i,r,o,a,s){var l=this[_t],u=l.parseEvent(n,i,r,o);u&&l.addEventListener(e,t,u.condition,u.callback,u.tag,u.priority,a,s)},e.prototype.removeEventListener=function(e,t,n){this[_t].removeEventListener(e,t,n)},e.prototype.removeAllEventListeners=function(e){this[_t].traverseListener((function(t){if(t.object==e){t.removed=!0;var n=THING.onRemoveEventListener;n&&n(t)}}))},e.prototype.traverseListener=function(e){this[_t].traverseListener(e)},e.prototype.traverseListenerByType=function(e,t){this[_t].traverseListenerByType(e,t)},e.prototype.getEventListener=function(e,t,n,i){var r=this[_t].getListeners(e,t);if(!r)return null;for(var o=0;o<r.length;o++){var a=r[o];if(!a.removed&&(a.condition==n&&(!i||a.tag==i)))return a}return null},e.prototype.getEventListeners=function(e,t){var n=this[_t],i=[];if(e){var r=n.getListeners(e,t);if(!r)return[];for(var o=0;o<r.length;o++){var a=r[o];a.removed||(t&&a.object!=t||i.push(a))}}else n.traverseListener((function(e){e.removed||t&&e.object!=t||i.push(e)}));return i},e.prototype.dispatchEvent=function(e,t,n,i){var r=this[_t];if(t.destroyed)return null;var o=r.hookers[e];if(!o)return null;var a=null,s=o.listenerMap.get(t);if(s){var l=r.dispatchEvent(o,s,t,n,i);a=a||l}var u=o.conditionalListeners;return u&&u.forEach((function(e){var s=r.dispatchEvent(o,e,t,n,i);a=a||s})),a},e.prototype.invokeListener=function(e,t){var n=this[_t];e.actived&&n.invokeListener(e,t)},e}(),Mt=Symbol("private");var St=function(){function e(){r(this,e),function(e,t){e[Mt]={};var n=e[Mt];n.sortStates=function(){n.states.sort((function(e,t){return e.priority!==t.priority?t.priority-e.priority:t.id-e.id}))},n.updateExistingState=function(e,t,i){for(var r=n.states,o=0;o<r.length;o++){var a=r[o];if(a.name==t)return a.value=e,Ne.isNumber(i)&&(a.priority=i),n.sortStates(),!0}return!1},n.id=1,n.states=[]}(this)}return e.prototype.isAnyEnable=function(){for(var e=this[Mt].states,t=0;t<e.length;t++)if(e[t].value)return!0;return!1},e.prototype.isEnable=function(e){var t=this[Mt].states;if(e)for(var n=0;n<t.length;n++){var i=t[n];if(i.name==e)return i.value}else if(t.length)return t[0].value;return!1},e.prototype.enable=function(e,t,n){if(t){var i=this[Mt],r=i.states;i.updateExistingState(e,t,n)||(n=Ne.parseValue(n,0),r.push({id:i.id++,value:e,name:t,priority:n}),i.sortStates())}},e.prototype.clear=function(){this[Mt].states=[]},e.prototype.getValue=function(e){for(var t=this[Mt].states,n=0;n<t.length;n++){var i=t[n];if(i.name==e)return i.value}return null},o(e,[{key:"states",get:function(){return this[Mt].states}}]),e}(),Ct=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;r(this,e),this.object=null,this.app=null,2==t.length?this._size=Ne.parseVector2(t):this._size=Ne.parseVector3(t),this._node=n,this._factor=i}return e.prototype._updateSize=function(e){if(this.object.visible){var t=Ne.parseVector3(this.app.camera.position);this._node.keepSize(t,this._size,this._factor,e,this.object.static,this.app.renderCamera.matrixWorldInverse),this.object.synIndependentWorldScale(!1)}},e.prototype.onAdd=function(e){this.object=e,this._node=this._node||this.object.node,this.app=e.app,this.object.tickable=!0,this._node&&this._node.updateWorldMatrix(!0),this._updateSize()},e.prototype.onRemove=function(){},e.prototype.onUpdate=function(e){return this._updateSize(),!0},o(e,[{key:"size",set:function(e){this._size=Ne.parseVector2(e),this.object.synIndependentWorldScale(),this._updateSize(!0)},get:function(){return this._size.toArray()}},{key:"node",set:function(e){this._node=e},get:function(){return this._node}}]),e}(),At=Symbol("private"),Rt=function(e){e[At]={};var t=e[At];return t.onFilter=null,t.result=null,t},Pt=function e(){return r(this,e),Rt(this),Array.apply(this,arguments),this.length=0,Object.defineProperties(this,{length:{enumerable:!1}}),this};Pt.prototype=new Array,["push","pop","splice","shift"].forEach((function(e){Pt.prototype[e]=function(){var t=this[At];return t.result=null,Array.prototype[e].apply(this,arguments)}})),Pt.prototype.concat=function(){return[].concat(this.map((function(e){return e})))},Pt.prototype.clear=function(){this.length=0},Pt.prototype.clearResult=function(){this[At].result=null},Object.defineProperties(Pt.prototype,{push:{enumerable:!1},pop:{enumerable:!1},splice:{enumerable:!1},shift:{enumerable:!1},concat:{enumerable:!1},clear:{enumerable:!1},clearResult:{enumerable:!1},onFilter:{get:function(){return this[At].onFilter},set:function(e){this[At].onFilter=e},enumerable:!1,configurable:!1},result:{get:function(){var e=this[At];return e.result?e.result:e.onFilter?(e.result=this.filter(e.onFilter),e.result):this},enumerable:!1,configurable:!1}});var Dt=new THREE.Vector3,kt=new THREE.Vector3,jt=new THREE.Quaternion,Ot=new THREE.Vector3,Ft=new THREE.Vector3(1,1,1),Bt=1,Lt=function(){function e(t){r(this,e),this.app=t,this._type="",this._id="",this._name="",this._uuid="",this._queryID=Bt++,this._parent=null,this._children=new Pt,this._children.onFilter=function(e){return!e.isCombinedObject},this.node=new THREE.Group,this.renderNode=this.node,this._lodNode=null,this._lodLevel=-1,this._builder=[],this._defaultStyle=null,this._style=null,this._initBoxSize=null,this._extensionsFile=null,this.anchorNode=null,this._ignoreParentScale=!1,this._ignoreParentAngles=!1,this._grid=null,this._dragState=A.No,this._draggable=!1,this.isTickable=!1,this._catchEventAnyTime=!1,this._pickable=!0,this._lookingAtObject=null,this._stateFlags=new bt,this._independentControlFlags=new bt,this._hideNodesInScene=null,this._renderDistance=null,this._shadowDistance=null,this._localClippingPlaneBase=null,this._localClippingPlane=null,this._lockedOffset=[],this._independentPosition=null,this._independentWorldAngles=null,this._independentWorldScale=null,this.scaling=!1,this.scaleTween=null,this.rotating=!1,this.rotateTween=null,this.fadeTween=null,this.pathTween=null,this.pathTweens=[],this._attachPoints=null,this._controls=[],this.waitCommands=[],this._loadState=e.waitForLoading,this._internalUserData={},this._userData={},this._tags=[],this._groups=[],this._tweens=[],this._autoEnsureParentsVisible=!0,this._autoSynVisible=!0,this._keepSize=!1,this._ignoreEvents=null,this._visibleGroupStates=new St,this._scaleGroupStates=new St,this._eventTrigger=new Tt(t),this.initStaticMembers()}return e.prototype._init=function(e,t){return this._parent=t,this.node=e||this.node,this.loaded=!0,this},e.prototype.initStaticMembers=function(){e.hasStaticMembers||(e.hasStaticMembers=!0,e.waitForLoading=1,e.loading=2,e.loadCompleted=3,e.stateHideBySceneFlag=1)},e.prototype.isBlockMouseOffEvent=function(e){return!1},e.prototype.setUserDataFlag=function(e,t){t?this.node.traverse((function(t){t.userData[e]=!0})):this.node.traverse((function(t){delete t.userData[e]}))},e.prototype.setupEffects=function(){this.app.isMobileDevice?this.node.traverse((function(e){var t=e.material;t&&(Array.isArray(t)?t.forEach((function(e){return e.needsUpdate=!0})):t.needsUpdate=!0,e.isMesh&&(e.castShadow=!1,e.receiveShadow=!1),t.map&&(t.map.anisotropy=1,t.map.version>0&&(t.map.needsUpdate=!0)))})):this.node.traverse((function(e){var t=e.material;t&&(t&&(Array.isArray(t)?t.forEach((function(e){return e.needsUpdate=!0})):t.needsUpdate=!0),e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0),t.map&&(t.map.anisotropy=16,t.map.version>0&&(t.map.needsUpdate=!0)))}))},e.prototype.setupUserData=function(e){e=e||{};var t=this.node.userData;t.isBaseObject=!0,t.id=this._queryID,t.withGeometryIDAttributes=e.withGeometryIDAttributes;var n=this;t.getObject=function(){return n.app.objectManager.get(n._queryID)}},e.prototype.setupNode=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("LOD"==e.type&&(this._lodNode=e,this.tickable=!0),e.visible||(e.ensureVisible(!0,!0),e.ensureVisible(!1,!1),this.visible=!1),t){var n=this.node.userData;this.node=e,this.setupUserData(n)}else this.renderNode=e,this.node.add(e)},e.prototype.setupName=function(e){this._name=this._name||this._id},e.prototype.setupID=function(e){this._id=Ne.parseValue(e.id,this._id),this._name=Ne.parseValue(e.name,this._name),this._uuid=Ne.parseValue(e.uuid,this._uuid),this._id=this._id||this._uuid||this._name,this._id||this._uuid||(this._id=THREE.MathUtils.generateUUID()),this.setupName(e),this.setupCommonInfo(e)},e.prototype.setupCommonInfo=function(t){this._internalUserData=t.internalUserData||this._internalUserData,this._stateFlags.enable(e.stateHideBySceneFlag,t.hideByScene),this._userData=t.properties||t.userData||{},this._tags=t.tags||[],t.forceBoundingBox&&(this.node.userData.forceBoundingBox=!0);var n=Ne.parseValue(t.inheritStyle,!0);this.inheritStyle!=n&&(this.inheritStyle=n),this.inheritVisible=Ne.parseValue(t.inheritVisible,!0)},e.prototype._setupLocalPosition=function(e){var t=e.localPosition,n=e.ignoreParentScale;t&&this.setLocalPosition(t,n)},e.prototype.setupTranslation=function(t){if(this._ignoreParentScale=Ne.parseValue(t.ignoreParentScale,!1),this._ignoreParentAngles=Ne.parseValue(t.ignoreParentAngles,!1),!t.skipSetupTranslation){var n=e.DefaultPosition||{},i=e.DefaultAngles||{},r=e.DefaultScale||{},o=t.position||n[this._type];o?this.position=o:t.basePoint||this._setupLocalPosition(t);var a=t.angle;if(a)this.angles=[0,a,0];else{var s=t.angles||t.localAngles||i[this._type];s&&(this.angles=s)}var l=t.scale||r[this._type];l&&this.node.scale.copy(Ne.parseVector3(l)),this.synIndependentWorldScale(!0,t.inheritScale)}var u=t.initBoxSize;u&&(this._initBoxSize=u.concat())},e.prototype.setupEnvMap=function(e){var t=this.getEnvMapResources();t&&(e||this.isOutdoors?t.outdoorsEnvMap&&this.node.traverse((function(e){!e.userData.skipEnvMap&&e.material&&e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(e){"envMap"in e&&(e.envMap=t.outdoorsEnvMap,e.envMapIntensity=1.3)})):"envMap"in e.material&&(e.material.envMap=t.outdoorsEnvMap,e.material.envMapIntensity=1.3))})):t.indoorsEnvMap&&this.node.traverse((function(e){!e.userData.skipEnvMap&&e.material&&e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(e){"envMap"in e&&(e.envMap=t.indoorsEnvMap,e.envMapIntensity=1.3)})):"envMap"in e.material&&(e.material.envMap=t.indoorsEnvMap,e.material.envMapIntensity=1.3))})))},e.prototype.loadFromURL=function(e,t){t&&t()},e.prototype.setupFromURL=function(e){if(e.node)this._url=Ne.parseValue(e.url,this._url),this._setup(e);else{var t=this;this.loadFromURL(e,(function(){t._setup(e)}))}},e.prototype.setupFromData=function(e){this._setup(e)},e.prototype.setupChildVisibleAsParent=function(e,t){},e.prototype.setupVisible=function(e){this._autoEnsureParentsVisible=Ne.parseValue(e.autoEnsureParentsVisible,!0),this._autoSynVisible=Ne.parseValue(e.autoSynVisible,!0);var t,n=e.visible;Ne.isNull(n)?(this._setVisible(!0,"default"),(t=e.parent)&&t.setupChildVisibleAsParent(this,e)):(this.visible=n,(t=e.parent)&&n&&this._autoEnsureParentsVisible&&(t.node.visible=n,t.node.ensureParentsVisible(n)))},e.prototype._setup=function(e){var t=e.node;t&&this.setupNode(t,Ne.parseValue(e.nodeOverride,!0)),this.setupCommonInfo(e),this.setupUserData(e),this.setupParent(e),this.customSetup(e),this.setupComplete(e)},e.prototype.setup=function(e){this._beforeSetup(e),this.loading=!0,this.setupID(e),this.setupVisible(e);var t=e.url,n=e.data,i=e.domElement;t?(e.url=this.app.confirmURL(t)._trimRight("/"),this.setupFromURL(e)):i?this.setupFromDom(e):n?this.setupFromData(e):this._setup(e)},e.prototype._beforeSetupStyle=function(e){},e.prototype._afterSetupStyle=function(e){},e.prototype.setupStyle=function(e){var t=e.style;if(t){for(var n in this._beforeSetupStyle(e),t){var i=t[n];void 0!==i&&(this.style[n]=i)}this._afterSetupStyle(e)}var r=e.keepSize;r&&(this.keepSize=r)},e.prototype.setupMaterials=function(e){if(!Ne.parseValue(e.lights,!0)){var t=this.node.getMeshes();this.node.getMaterials().forEach((function(e){var n=new THREE.MeshBasicMaterial;n.copy(e),n.defines={},n.lights=!1,n.needsUpdate=!0,t.forEach((function(t){if(Ne.isArray(t.material))for(var i=0;i<t.material.length;i++){var r=t.material[i];r==e&&(r.dispose(),t.material[i]=n)}else t.material==e&&(t.material.dispose(),t.material=n)}))}))}},e.prototype.setupResources=function(e){if(this.loaded=Ne.parseValue(e.loaded,!0),this.loaded){this.setupCommands(e),this._processModel(),this._synEffectRefCounts();var t=this.dataToRecover;t&&(this._setupResources(t),this.style.color=t.style.color,this.style.opacity=t.style.opacity,this.style.outlineColor=t.style.outlineColor,this.style.alwaysOnTop=t.style.alwaysOnTop,this.style.renderOrder=t.style.renderOrder,delete this.dataToRecover)}this.trigger("setupResources")},e.prototype._setupResources=function(e){},e.prototype._synFrom=function(e){if(!e.isBaseObject)return!1;this._visibleGroupStates.clear();for(var t=e._visibleGroupStates.states,n=0;n<t.length;n++){var i=t[n];this._setVisible(i.value,i.name)}return!0},e.prototype.setupCommands=function(e){if(this._style&&Ne.isFunction(this._style._syn)&&this._style._syn(),this.loaded&&this.waitCommands.length){var t=this.app.commandManager.create(this.waitCommands);t&&t.execute(),this.waitCommands=[]}},e.prototype.setupInheritAttributes=function(e){var t=Ne.parseValue(e.inheritPosition,!0),n=Ne.parseValue(e.inheritAngles,!0),i=Ne.parseValue(e.inheritScale,!0);this.inheritPosition==t&&this.inheritAngles==n&&this.inheritScale==i||(t&&n&&i||this.node.updateMatrixWorld(),this.inheritPosition=t,this.inheritAngles=n,this.inheritScale=i,this.synIndependentWorldPosition(),this.synIndependentWorldAngles(),this.synIndependentWorldScale()),Ne.parseValue(e.inheritPickable,!0)||(this.inheritPickable=!1)},e.prototype.setupParent=function(e){if(!e.skipSetupParent&&!e.independent){var t=e.parent;t&&(t.isBaseObject?this._parent=t:console.error("[BaseObject] Please make sure parent is BaseObject")),null==this._parent&&void 0===t&&(this._parent||(this._parent=this.app.root)),this._parent&&(this._parent._style&&this._parent._style._inheritThemeName&&this.applyTheme(this._parent._style._inheritThemeName,!1),this._parent._add(this,e,-1))}},e.prototype.customSetup=function(e){},e.prototype._beforeSetup=function(e){},e.prototype._notifyCompleteEvent=function(t){this._stateFlags.has(e.stateHideBySceneFlag)&&(this._hideByScene=!0);var n=this;Ne.timer.setTimeout((function(){n.trigger("load",{object:n}),n.trigger("complete",{object:n})}),1)},e.prototype._callComplete=function(e){this.loaded=Ne.parseValue(e.loaded,!0),this.queryID&&this.app.objectManager.objects.set(this.queryID,this),this._notifyCompleteEvent(e),Ne.parseValue(e.queryable,!0)||(this.canNotQueryFromSelector=!0),this.trigger(O.Create,{object:this}),this.app.trigger(O.Create,{object:this});var t=e.successCallback||e.complete;t&&t.call(this,{object:this}),this.app.needUpdate=!0,this._ignoreParentScale=null,this._ignoreParentAngles=null},e.prototype._beforeSetupComplete=function(e){},e.prototype._afterSetupComplete=function(e){},e.prototype.useBottomCenterOfBoundingBoxAsPosition=function(){var e=this.boundingBox,t=e.center,n=e.size,i=this.node.children.map((function(e){var t=new THREE.Vector3;return e.getWorldPosition(t),t}));this.position=t,this.translateY(-n[1]/2),this.node.updateMatrixWorld();for(var r=0;r<this.node.children.length;r++){this.node.children[r]._setWorldPosition(i[r])}},e.prototype.setupComplete=function(e){this.loaded=Ne.parseValue(e.loaded,!0),this._userData=this._userData||{},this._internalUserData=this._internalUserData||{},this.setupEffects(),this.setupTranslation(e),this.setupInheritAttributes(e),this._beforeSetupComplete(e),this.setupStyle(e),this.setupEnvMap(),this.setupMaterials(e),this.setupResources(e),this.setupCommands(e),this.static?this.node._synMatrixWorld():this.node.updateWorldMatrix(!1,!1),this._afterSetupComplete(e),this.selfUpdate(),this._callComplete(e)},e.prototype.setParent=function(e,t,n){var i=this._parent;if(i&&i!=e&&i.remove(this,!1,t),this._parent=e,e){var r=e.node;t||!this.node.parent?r&&r.add(this.node):this.node.attachToParent(r,this.app.scene,n),this._style&&this._style.alwaysOnTop&&this._style._setAlwaysOnTop(!0)}},e.prototype.synTickableObject=function(){this.isTickable?this.app.objectManager.addTickableObject(this):this.app.objectManager.removeTickableObject(this)},e.prototype._setDirtyFlag=function(e,t){if(this._boundingBoxControl&&(this._boundingBoxControl.dirty=!0),e)for(var n=this.parent;n;n=n.parent)n._boundingBoxControl&&(n._boundingBoxControl.dirty=!0);t&&this._children.forEach((function(e){e._setDirtyFlag(!1,!0)}))},e.prototype.getChildByPath=function(e,t){var n=e.search("/");if(-1!==n)n=e.substring(0,n),e=e.substring(n.length+1);else if(n=e,t){if(t(this,n))return this}else if(this._id==n)return this;for(var i=0;i<this._children.length;i++){var r=this._children[i],o=null;if(t?t(r,n)&&(o=r):r.id==n&&(o=r),o){var a=o.getChildByPath(e);if(a)return a}}return null},e.prototype._getBasePointNode=function(e){var t=this.node.traverseBreakable((function(t){return t.name.contains(e)}));return t||(t=this.node.traverseBreakable((function(t){return t.name==e}))),t},e.prototype._addFromCampus=function(e){},e.prototype.add=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if((e=e||{}).isBaseObject){if(e.parent==this)return!1;this._add(e,null,t)}else{var n=e.url;if(Ne.isString(n)){var i=e.position||this.position,r=e.angles||e.localAngles||this.angles,o=Ne.parseValue(e.isCamFitScene,!1),a=e.complete,s=this;this.app.create({type:"Campus",url:n,position:i,angles:r,isCamFitScene:o,complete:function(e){var t=e.object;s._addFromCampus(t),t.destroy(),s.dirty=!0,a&&a(),this.app.trigger("addFromCampusComplete")}})}else{var l=e.object;if(!Ne.isNull(l)){if(l.parent==this)return!1;this._add(l,e,t)}}}},e.prototype._add=function(e,t,n){if(!e)return!1;if(!e.isBaseObject)return!1;e._builder=this.builder;var i=(t=t||{}).basePoint,r=t.offset||t.localPosition,o=t.angles||t.localAngles,a=Ne.parseValue(t.keepNode,!1),s=Ne.parseValue(t.keepVisible,!0);if(this.node.updateWorldMatrix(!0,!1),a){var l=e.parent;if(l){var u=l._children.indexOf(e);-1!==u&&l._children.splice(u,1)}e._parent=this}else{var c=Ne.parseValue(t.keepLocalPosition||t.node,!1),h=Ne.parseValue(t.force||t.position||t.angles||t.scale,!1);e.setParent(this,c,h)}var p=void 0;if(Ne.isString(i)){if(!(p=this._getBasePointNode(i)))return console.error("The '"+i+"' basePoint is not existing"),!1;p.updateWorldMatrix(!0);var d=new THREE.Vector3;p.getWorldPosition(d),e.position=d.toArray(),r&&(e.position=THING.Math.addVector(e.position,r))}else r&&(e.localPosition=r);return o&&(e.angles=o),e._setDirtyFlag(!0,!1),n>=this._children.length||-1===n?this._children.push(e):this._children.splice(n,0,e),p&&e.node.attachToParent(p,!0),e.node.userData.removedNode&&(e.node.visible=!0,delete e.node.userData.removedNode),this._style&&e.inheritStyle&&e._syncStyleFrom(this),s&&(this.visible||(e.visible=this.visible)),e.inheritPickable&&e.pickable!=this.pickable&&(e.pickable=this.pickable),!0},e.prototype._syncStyleFrom=function(e){var t=this,n=e.style;["wireframe","color","opacity","emissive","roughness","outlineColor","skipBoundingBox","skipOutline","glow","innerGlow","lineBloom","radialBlur","radialBlur2","radialOffset","focusRegion","vertexNormalHelper","axisHelper","edgeColor","alwaysOnTop","doubleSide"].forEach((function(e){var i=n[e];i&&("opacity"==e&&1==i||(t.style[e]=i))}))},e.prototype.remove=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return!1;if(!e.isBaseObject)return!1;if(!e.isChildOf(this))return!1;e._setDirtyFlag(!0,!1),e.node.updateWorldMatrix(!0,!1);var i=e.node.getParents();-1!==i.indexOf(this.app.scene)&&(n?this.app.scene.add(e.node):e.node.attachToParent(this.app.scene,!1),t&&(e.node.visible=!1,e.node.userData.removedNode=!0)),e._parent=null;var r=this._children.indexOf(e);return-1!==r&&this._children.splice(r,1),!0},e.prototype.swapChild=function(e,t){var n=this._children.indexOf(e),i=this._children.indexOf(t);-1!==n&&-1!==i&&THING.Math.swapArray(this._children,n,i)},e.prototype.hasChild=function(e){if(!e)return!!this._children.length;for(var t=0;t<this._children.length;t++){if(this._children[t]==e)return!0}return!1},e.prototype.destroy=function(){var e=this,t=this._notifyDestroy;t&&t.call(this),this.clearNode();var n=this.builder;n&&(n.disposeObject&&n.disposeObject(this._uuid,!1),this.isCampus&&n.clearAllResources&&n.clearAllResources()),this.stopMoving(),this.stopRotating(),this.stopScaling(),this.stopFade(),this.stopAllLerpTo();var i=this._style;i&&(i.isBaseStyle&&(i.alwaysOnTop=!1,i._traverse((function(t){e.app.effectManager.clearAllEffects(t)})),i.setEdgeWireframe(null),i.revertMaterial()),i._obj=null),this.tickable=!1,this.removeAllControls(!1),this.app.objectManager.destroy(this);for(var r=this._children.concat(),o=0;o<r.length;o++)r[o].destroy();this._children.clear(),this.clearAttachPoints(),this._parent&&(this._parent.remove(this),this._parent=null),this.node.parent&&this.node.parent.remove(this.node),this.app.events.unbindCallObj(null,null,null,[this]),this._eventTrigger.dispose(),this._lodNode=null,this._queryID=0,delete this.node.userData.getObject,this.app.needUpdate=!0,this._builder=null,this._style&&(this._style.obj=null,this._style=null),this._defaultStyle&&(this._defaultStyle.obj=null,this._defaultStyle=null)},e.prototype.getRaycastPosition=function(e){if(!e)return null;var t=new THREE.Raycaster;t.ray.origin=Ne.parseVector3(this.position),t.ray.direction=Ne.parseVector3(e);var n=t.intersectObject(this.app.scene,!0);if(!n.length)return null;for(var i=0;i<n.length;i++){var r=n[i],o=r.object;if(this.app.objectManager.getBaseObject(o)&&!o.isChildOf(this.node))return r.point.toArray()}return null},e.prototype.removePickingResources=function(){this.app.picker.removePickingResources(this.node)},e.prototype.setPickable=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._pickable=e;var n=this;if(this._traverseSelfNodes((function(t){t.setPickable(e,!1),e||n.app.picker.removePickingResources(t)})),t)for(var i=0;i<this._children.length;i++){var r=this._children[i];r.inheritPickable&&(r.pickable=e)}},e.prototype.synPickable=function(){this.setPickable(this._pickable)},e.prototype.localToSelf=function(e){return this.worldToSelf(this.localToWorld(e))},e.prototype.selfToLocal=function(e){return this.worldToLocal(this.selfToWorld(e))},e.prototype.worldToSelf=function(e){var t=Ne.parseVector3(e);return this.node.updateWorldMatrix(!0),this.node.worldToLocal(t).toArray()},e.prototype.selfToWorld=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e=Ne.parseVector3(e);if(this.node.updateWorldMatrix(!0),t){var i=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Quaternion;this.node.matrixWorld.decompose(i,o,r);var a=new THREE.Matrix4;return a.compose(i,o,n?this.node.parent._getWorldScale():new THREE.Vector3(1,1,1)),e.applyMatrix4(a).toArray()}return this.node.localToWorld(e).toArray()},e.prototype.localToWorld=function(e){return this._parent?this._parent.selfToWorld(e):this.node.localToWorld(Ne.parseVector3(e)).toArray()},e.prototype.worldToLocal=function(e){if(this._parent)return this._parent.worldToSelf(e);var t=Ne.parseVector3(e);return this.node.worldToLocal(t).toArray()},e.prototype.distanceTo=function(e){return e?(e.isBaseObject&&(e=e.position),Ne.parseVector3(this.position).distanceTo(Ne.parseVector3(e))):0},e.prototype._lookAtPosition=function(){this.node._lookAtPosition(this._lookingAtObject,this.static),this.synIndependentWorldAngles()},e.prototype.lookAt=function(e,t){if(e){var n,i,r;if(t=t||{},Ne.isArray(t)?n=t:(n=t.angles,i=Ne.parseValue(t.lockYAxis,!1)),e.isBaseObject?r=e.position:e.isCameraController?r=e.cameraObject.position:(r=e,e=null),!r)return void console.error("lookAt failed, due to target is not existing");var o=Ne.parseValue(t.always,!0);if(this._lookingAtObject={target:e,targetPosition:Ne.parseVector3(r),type:"axis",axis:i?"y":null,quat:Ne.parseQuaternion(n)},this.node.quaternion.set(0,0,0,1),this.node.updateWorldMatrix(!0,!1),this.node.up.set(0,1,0),e&&e.isCameraController){var a=this.parents.query(".Campus")[0];if(a){var s=a.up;this.node.up.set(s[0],s[1],s[2])}}o?this.tickable=!0:(this._lookAtPosition(),this._lookingAtObject=null),this.selfUpdate()}else this._lookingAtObject=null,this.node.up.set(0,1,0)},e.prototype.rotate=function(e,t){var n=THING.Math.degToRad(e);(t=Ne.parseVector3(t||[0,1,0])).normalize(),this.node.rotateOnAxis(t,n),this.synIndependentWorldAngles(),this.dirty=!0},e.prototype.rotateX=function(e){isNaN(e)||(this.node.rotateX(THING.Math.degToRad(e)),this._synWorldAngles())},e.prototype.rotateY=function(e){isNaN(e)||(this.node.rotateY(THING.Math.degToRad(e)),this._synWorldAngles())},e.prototype.rotateZ=function(e){isNaN(e)||(this.node.rotateZ(THING.Math.degToRad(e)),this._synWorldAngles())},e.prototype.rotateAround=function(e){var t=(e=e||{}).object,n=e.target,i=Ne.parseValue(e.yRotateAngle||e.angle,0),r=Ne.parseValue(e.xRotateAngle,0),o=e.time,a=e.speed,s=Ne.parseLoopType(e.loopType),l=e.stop,u=e.update,c=e.complete;if(n&&(n.isBaseObject?(t=n,n=null):n=Ne.parseVector3(n)),o){if(a=0,!i&&!r)return void console.error("Please provide yRotateAngle or xRotateAngle to rotate around object")}else a?o=16777215:i||r?(a=0,o=1e3):(a=10,o=16777215);var h=Ne.parseVector3(this.position),p=new THREE.Spherical,d=h.clone(),f=n||Ne.parseVector3(t.position);d.sub(f),p.setFromVector3(d),this.stopRotating(),this.rotating=!0;var m=this.position,g=new THREE.Vector3,v=p.theta,y=p.phi,b=this,_=function(){s==THREE.LoopOnce?c&&c():s==THREE.LoopRepeat?(b.position=m,b.rotateAround(e)):s==THREE.LoopPingPong&&(void 0!==i&&(e.yRotateAngle=-i),void 0!==r&&(e.xRotateAngle=-r),b.rotateAround(e))},x=function(){var e=!1;if(a){var o=i>0?a:-1*a;p.theta+=o/1e3;var s=v+THING.Math.degToRad(i);i>0?p.theta>=s&&(p.theta=s,e=!0):p.theta<=s&&(p.theta=s,e=!0)}else{var c=this._object.progress;i&&(p.theta=v+c*THING.Math.degToRad(i)),r&&(p.phi=y+c*THING.Math.degToRad(r))}var h=n?n.clone():Ne.parseVector3(t.position);if(p.radius=b.distanceTo(h.toArray()),p.makeSafe(),g.setFromSpherical(p),h.add(g),b.node.position.copy(h),u&&u(),e){var d=l;l=null,this.stop(),l=d,_.call(this)}};this.rotateTween=new TWEEN.Tween({progress:0}).to({progress:1},o).easing(M.Linear.None).onStop((function(){l&&l()})).onUpdate((function(){x.call(this)})).onComplete((function(){_.call(this)})),this.rotateTween.start()},e.prototype.rotateOnWorldAxis=function(e){e=e||{};var t=Ne.parseVector3(e.axis),n=e.angle;if(t&&n){t.normalize();var i=THING.Math.degToRad(n);this.node.rotateOnWorldAxis(t,i),this.static&&this.node._synMatrixWorld()}},e.prototype.rotateTo=function(e){var t=(e=e||{}).angles||e.localAngles,n=e.time,i=e.speed,r=e.lerpType||M.Linear.None,o=e.loopType||R.No,a=e.complete,s=Ne.parseVector3(this.angles),l=s.clone(),u=Ne.parseVector3(t),c=Ne.getConsumeTime(null,s,u,n,i,2e3);this.stopRotating(),this.rotating=!0;var h=this;this.rotateTween=new TWEEN.Tween(s).to(u,c).easing(r).onUpdate((function(){h.angles=[this._object.x,this._object.y,this._object.z]})).onComplete((function(){o==R.Repeat?(h.angles=l.toArray(),h.rotateTo(e)):o==R.PingPong?(e.angles=l.toArray(),h.rotateTo(e)):a&&a.call(h,{object:h})})).start()},e.prototype.stopRotating=function(){this.rotating=!1,this.rotateTween&&this.rotateTween.stop()},e.prototype.scaleTo=function(e){var t=(e=e||{}).scale||[1,1,1],n=e.time,i=e.speed,r=e.lerpType||M.Linear.None,o=e.loopType||R.No,a=e.complete;t[2]=t[2]||1;var s=Ne.parseVector3(this.scale),l=s.clone(),u=Ne.parseVector3(t),c=Ne.getConsumeTime(null,s,u,n,i,2e3);this.stopScaling(),this.scaling=!0;var h=this;this.scaleTween=new TWEEN.Tween(s).to(u,c).easing(r).onUpdate((function(){h.scale=[this._object.x,this._object.y,this._object.z]})).onStop((function(){})).onComplete((function(){o==R.Repeat?(h.scale=l.toArray(),h.scaleTo(e)):o==R.PingPong?(e.scale=l.toArray(),h.scaleTo(e)):a&&a.call(h,{object:h})})).start()},e.prototype.stopScaling=function(){this.scaling=!1,this.scaleTween&&this.scaleTween.stop()},e.prototype.canAcceptEvent=function(e){var t=e.type,n=e.object;if("update"==t)return this;if(E[t])return this;if(n){if("drag"==t)return this;if(n.isChildOf(this)){if("mouseover"==t)return this;if("mousedown"==t)return this;if("mouseup"==t)return this}}return null},e.prototype._createDispatchEvent=function(e){var t=this.app.events,n={};if(x[e]){var i=t.mouseMovePos;n=t.createMouseEvent(e,{clientX:i[0],clientY:i[1]})}return n},e.prototype._isAppEvent=function(e){return-1!==["dragstart","drag","dragging","dragend","keydown","keypress","keyup"].indexOf(e)},e.prototype._on=function(e,t,n,i,r,o,a){if(!(e=Ne.toLowerCase(e)))return console.error("event type is invalid, please check it"),null;var s=Ne.parseEvent(t,n,i,r,o);return s?s.selector||this._isAppEvent(e)?this.app.events.bindCallObj(e,s.selector,s.userData,s.callback,[this],s.tag,a,s.priority):("update"==e&&(this.tickable=!0),this._eventTrigger.addEventListener(e,this,null,s.callback,s.tag,s.priority,a,s.userData)):null},e.prototype._off=function(e,t,n){e=Ne.toLowerCase(e);var i=Ne.parseEvent(t,null,n);return i?i.selector?this.app.events.unbindCallObj(e,i.selector,i.callback,[this]):this._eventTrigger.removeEventListener(e,this,i.tag):null},e.prototype._pauseEvent=function(e,t,n,i){if(e=Ne.toLowerCase(e),t)this.app.events.pauseEvent(e,t,n,i,this);else{this.parent&&this.parent.pauseEvent(e,this,n,i);var r=this._eventTrigger.getEventListener(e,this,null,n);r&&(r.paused=!0)}},e.prototype._resumeEvent=function(e,t,n){if(e=Ne.toLowerCase(e),t)this.app.events.resumeEvent(e,t,n,this);else{this.parent&&this.parent.resumeEvent(e,this,n);var i=this._eventTrigger.getEventListener(e,this,null,n);i&&(i.paused=!1)}},e.prototype.on=function(e,t,n,i,r,o){for(var a=this._on(e,t,n,i,r,o),s=0;s<this._controls.length;s++){var l=this._controls[s].control;Ne.isFunction(l.onRegisterEvent)&&l.onRegisterEvent(e,a)}return this},e.prototype.off=function(e,t,n){for(var i=this._off(e,t,n),r=0;r<this._controls.length;r++){var o=this._controls[r].control;Ne.isFunction(o.onUnregisterEvent)&&o.onUnregisterEvent(e,i)}return this},e.prototype.one=function(e,t,n,i,r,o){for(var a=this._on(e,t,n,i,r,o,!0),s=0;s<this._controls.length;s++){var l=this._controls[s].control;Ne.isFunction(l.onRegisterEvent)&&l.onRegisterEvent(e,a,!0)}return this},e.prototype.hasAnyEvents=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.app.events.hasAnyCallObjects([this],e);return t||(t=!!this._eventTrigger.getEventListeners().length),t},e.prototype.hasEvent=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e=Ne.toLowerCase(e);var i=this.app.events.hasEvent(e,this,t,n);return i||(i=!!this._eventTrigger.getEventListener(e,this,null,t)),i},e.prototype.trigger=function(e,t,n){e=Ne.toLowerCase(e);var i=this.app.events.dispatchBindCallObj(e,t,[this],n),r=this._eventTrigger.dispatchEvent(e,this,t,n);return Ne.parseValue(i,r)},e.prototype.pauseEvent=function(e,t,n){this._pauseEvent(e,t,n,!1)},e.prototype.pauseEventInFrame=function(e,t,n){this._pauseEvent(e,t,n,!0)},e.prototype.resumeEvent=function(e,t,n){this._resumeEvent(e,t,n)},e.prototype.isPauseEvent=function(e,t,n){if(e=Ne.toLowerCase(e),n){var i=this.getEvents(e);if(t){for(var r=!1,o=0;o<i.length;o++){var a=i[o];if(t&&a.tag==t){r=!0;break}}if(!r)return!0}else if(!i.length)return!0}var s=this.app.events.isPauseEvent(e,this,t);if(!s){var l=this._eventTrigger.getEventListener(e,this,null,t);if(l)return l.paused}return s},e.prototype.getEvents=function(e){e=Ne.toLowerCase(e);var t=this.app.events.getEvents(e,this);if(!t)return[];for(var n=[],i=0;i<t.length;i++){var r=t[i];n.push({condition:r.condition,callback:r.callback,type:r.type,priority:r.priority,userData:r.userData,tag:r.tag,once:r.once})}return this._eventTrigger.getEventListeners(e,this).forEach((function(e){n.push({condition:null,callback:e.callback,type:e.type,priority:e.priority,userData:e.userData,tag:e.tag,once:e.once})})),n},e.prototype._traverseObjects=function(e,t){for(var n=0;n<this._children.length;n++){var i=this._children[n];Ne.isFunction(e)?e(i):Ne.isArray(e)&&e.push(i),t&&i._traverseObjects(e,t)}},e.prototype._isChildNode=function(e){for(var t=this.children,n=0,i=t.length;n<i;n++){var r=t[n];if(e==r.node||e.isChildOf(r.node))return!0}return!1},e.prototype._getChildNodes=function(){var e=[];return this.children.forEach((function(t){e.push(t.node)})),e},e.prototype._traverseSelfNodes=function(e){if(e){var t=this._getChildNodes();this.node.traverseBranch((function(n){if(-1!==t.indexOf(n))return!1;e(n)}))}},e.prototype.traverseSelfNodes=function(e){return this._traverseSelfNodes(e)},e.prototype._traverseNodes=function(e,t,n){for(var i=0;i<e.children.length;i++){var r=e.children[i],o=r.userData.baseObject_bindSubNode;o||((o=THING.SubObject.create(r,this)).name=r.name),Ne.isFunction(t)?t(o):Ne.isArray(t)&&t.push(o),n&&this._traverseNodes(r,t,n)}},e.prototype.isSubNode=function(){return!!this.node.userData.baseObject_bindSubNode},e.prototype.traverse=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&(e(this),this._traverseObjects(e,t))},e.prototype._check=function(e){var t=new gt(this.app,[this]);return t.select(e),!!t.length},e.prototype.query=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Ne.isString(e)&&e.startsWith("/")){for(var i=0,r=0;r<e.length;r++)"/"==e[r]&&i++;if(1===i)return console.warn("[BaseObject] Please use '.subNodes.query()' to replace it, and remove '/' prefix of params"),this.subNodes.query(new RegExp(e.substring(1)),t)}var o=[];this._traverseObjects(o,t),n&&o.push(this);var a=new gt(this.app,o);return a.select(e),a},e.prototype._queryChild=function(e){var t=new gt(this.app,this._children);return t.select(e),t},e.prototype.isChildOf=function(e){if(!e)return!1;for(var t=this._parent;t;){if(t==e)return!0;t=t.parent}return!1},e.prototype.isBrotherOf=function(e){if(!e)return!1;var t=this._parent;return!!t&&-1!==t._children.indexOf(e)},e.prototype.clearAttachPoints=function(){if(this._attachPoints){for(var e=0;e<this._attachPoints.length;e++)this._attachPoints[e].destroy();this._attachPoints=null}},e.prototype.isAttachPoint=function(e){if(e&&e.node)for(var t=["dummy:","point:","connector:"],n=0;n<t.length;n++)if(e.name.startsWith(t[n]))return!0;return!1},e.prototype.translate=function(e){this.node.translateX(e[0]),this.node.translateY(e[1]),this.node.translateZ(e[2]),this.static&&this.node._synMatrixWorld(),this.synIndependentWorldPosition(),this.dirty=!0},e.prototype.translateX=function(e){this.translate([e,0,0])},e.prototype.translateY=function(e){this.translate([0,e,0])},e.prototype.translateZ=function(e){this.translate([0,0,e])},e.prototype.moveTo=function(e){var t=e.offset||e.offsetPosition||e.localPosition,n=e.direction,i=Ne.parseValue(e.ignoreScale,!0);if(t)t=Ne.parseVector3(t);else if(n){t=Ne.parseVector3(n);var r=Ne.parseValue(e.distance,5);t.multiplyScalar(r)}t&&(e.position=this.selfToWorld(t.toArray(),i)),this.movePath(e)},e.prototype.createPathTween=function(e,t,n,i,r,o){var a,s=Ne.parseVector3(e).clone(),l=Ne.parseVector3(t).clone();if(n){!o&&r&&(o=new THREE.Matrix4,r.updateWorldMatrix(!0,!1),o.getInverse(r.matrixWorld));var u=new THREE.Matrix4,c=s.clone(),h=l.clone();c.applyMatrix4(o),h.applyMatrix4(o),u.lookAt(h,c,this.node.up);var p=new THREE.Quaternion;if(p.setFromRotationMatrix(u),i){var d=new THREE.Quaternion;d.setFromAxisAngle(new THREE.Vector3(0,1,0),THING.Math.degToRad(i)),p.multiply(d)}a=p}return{distance:s.distanceTo(l),from:s,to:l,toQuat:a}},e.prototype.createPathTweens=function(e,t,n,i){var r=new THREE.Matrix4;e&&(e.updateWorldMatrix(!0,!1),r.getInverse(e.matrixWorld));for(var o=0;o<t.length-1;o++){var a=t[o],s=t[o+1],l=this.createPathTween(a,s,n,i,e,r);this.pathTweens.push(l)}},e.prototype.startPathTweens=function(e,t,n,i,r,o,a,s,l,u,c,h){var p=function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n].distance;return t}(this.pathTweens);if(p){n&&(e=p/n*1e3,a=M.Linear.None);var d=-1,f={progress:p},m=function(e,t){for(var n=[],i=0;i<e.length;i++)n.push(e[i].distance/t);return n}(this.pathTweens,p),g=new THREE.Vector3,v=new THREE.Quaternion,y=this;this.pathTween=new TWEEN.Tween({progress:0}).to(f,e).easing(a).delay(t).onUpdate((function(){var e=this._object.progress/p,t=Ne.getArrayIndexFromProgress(y.pathTweens,e,m),n=Ne.getArrayProgress(y.pathTweens,e,m),a=y.pathTweens[t];t!=d&&(d=t,i&&(a.fromQuat=y.node.quaternion.clone())),r?y.node.lookAt(r):i&&(o?(v.copy(s?a.fromQuat:y.node.quaternion),v.slerp(a.toQuat,n),y.angles=Ne.parseAngles(v)):y.angles=Ne.parseAngles(a.toQuat)),g.copy(a.from),g.lerp(a.to,n),y.position=g.toArray(),l&&l({progress:e,fromPosition:a.from.toArray(),toPosition:a.to.toArray()})})).onStart((function(){u&&u()})).onStop((function(){c&&c()})).onComplete((function(){h&&h()})).start()}else h&&h()},e.prototype.movePath=function(e){var t,n=(e=e||{}).path,i=e.time||1e3,r=Ne.parseValue(e.delayTime,0),o=e.speed,a=Ne.parseValue(e.local,!1),s=Ne.parseValue(e.orientToPath,!1),l=e.orientToPathDegree,u=e.lookAt,c=e.loopType,h=function(e){return null!==e.lerp&&null!==e.lerpType&&Ne.parseValue(e.lerp,!0)}(e),p=e.lerpType||M.Linear.None,d=Ne.parseValue(e.smooth,!0),f=e.update,m=e.complete;e.loop&&(c=R.Repeat,console.warn('[BaseObject] movePath() use "loopType(THING.LoopType)" to instead "loop(Boolean)" argument'));var g=this.parents.query(".Campus")[0];if(t=g?g.node:this.node.parent,n){if(e.path=n.concat(),a){var v=[];if(t){t.updateWorldMatrix(!0,!1);for(var y=t.matrixWorld,b=0;b<n.length;b++){var _=Ne.parseVector3(n[b]);_.applyMatrix4(y),v.push(_.toArray())}}else for(b=0;b<n.length;b++)v.push(this.localToWorld(n[b]));n=v}1===n.length&&(n=[this.position,n[0]])}else{var x=e.position;x&&(n=[this.position,x]),n&&(e.path=n.concat())}if(n&&0!=n.length){u&&(s=null,u=Ne.parseVector3(u)),this.stopMoving();var E=[];for(b=0;b<n.length;b++){var w=null;2==n[b].length?w=new THREE.Vector3(n[b][0],this.position[1],n[b][1]):3==n[b].length&&(w=Ne.parseVector3(n[b])),E.push(w)}this.createPathTweens(t,E,s,l);var T=this.pathTweens[0].from;this.position=[T.x,T.y,T.z];var S=this;this.startPathTweens(i,r,o,s,u,h,p,d,(function(e){f&&(e.object=S,f.call(S,e))}),(function(){}),(function(){}),(function(){c==R.Repeat?S.movePath(e):c==R.PingPong?(e.path.reverse(),void 0!==e.orientToPathDegree&&(e.orientToPathDegree=360-e.orientToPathDegree),S.movePath(e)):m&&m.call(S,{object:S})}))}else console.error("You must provide the path or position to call moveTo()")},e.prototype.stopMoving=function(){this.pathTweens=[],this.pathTween&&this.pathTween.stop()},e.prototype.hasAttribute=function(e){return Ne.hasAttribute(this,e)},e.prototype.getAttribute=function(e){return Ne.getAttribute(this,e)},e.prototype.setAttribute=function(e,t){return Ne.setAttribute(this,e,t)},e.prototype.setAttributes=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(var n in e=e||{})(t||Ne.isUndefined(this[n]))&&this.setAttribute(n,e[n])},e.prototype.selfUpdate=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=this,i=0;if(this._style&&this._style.update&&(i|=this._style.update(t)),this._localClippingPlane){var r=this._localClippingPlaneBase.clone();r.applyMatrix4(this.node.matrixWorld),this._localClippingPlane.normal=r.normal,this._localClippingPlane.constant=r.constant,i=!0}if(this._lodNode&&(-1!=this._lodLevel?this._lodNode.setLevel(this._lodLevel):this._lodNode.update(this.app.renderCamera),i=!0),this._lookingAtObject){if(this.visible){if(this._lookingAtObject.target){var o=this._lookingAtObject.target.position;this._lookingAtObject.targetLocalPosition=Ne.parseVector3(this.worldToLocal(o)),this._lookingAtObject.targetPosition=Ne.parseVector3(o)}this._lookAtPosition()}i=!0}this._independentPosition&&(this.visible&&this._getIndependentControlRenderNode()._setWorldPosition(this._independentPosition.clone(),this.static),i=!0),this._independentWorldAngles&&(this.visible&&this._getIndependentControlRenderNode()._setWorldAngles(this._independentWorldAngles.clone(),this.static),i=!0),this._independentWorldScale&&(this.visible&&this._getIndependentControlRenderNode()._setWorldScale(this._independentWorldScale.clone(),this.static),i=!0);var a=this.builder;a&&a.startToBuildingQueue&&a.startToBuildingQueue.length&&(a._isBuilding||a._old_build_version==a._build_version||(a._old_build_version=a._build_version,a._isBuilding=!0,a.startToBuild((function(e){for(var t=a.startToBuildingQueue,i=t.length,r=0;r<i;r++)if(!(t[r].version>a._build_version)){var o=t[r].progressCallback;o&&o({progress:e}),1==e&&(t.splice(r--,1),i--)}1==e?a._isBuilding=!1:n.tickable=!0}))),i=!0);var s=this._eventTrigger.getEventListeners("update",this);return s.forEach((function(n){e._eventTrigger.invokeListener(n,{deltaTime:t}),i=!0})),i},e.prototype.update=function(e){for(var t=this.selfUpdate(e),n=0;n<this._controls.length;n++){var i=this._controls[n].control,r=i.onUpdate;r&&(t|=r.call(i,e))}return t},e.prototype.createGrid=function(e,t,n,i){this._grid=this.app.create({type:"Grid",size:e,divisions:t,color1:n,color2:i,parent:this}),this._grid.style.skipBoundingBox=!0,this._grid.userData.topNode=!0,this._grid.userData.skipOutline=!0,this._grid.userData.independent=!0,this._grid.canNotQueryFromSelector=!0;this._grid.translateY(-.01)},e.prototype.showGrid=function(e,t,n,i){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(Ne.isBoolean(e)){var o=e;o&&(this._grid||this.createGrid(300,28,1131673,1131673)),this._grid&&(this._grid.visible=o)}else if(this._grid&&(this._grid.destroy(),this._grid=null),this.createGrid(e,t,n,i),r){var a=e;Ne.isNumber(r)&&(a=r),this._grid.addPickableGround({size:a})}},e.prototype.stopFade=function(){this.fadeTween&&(this.fadeTween.stop(),this.fadeTween=null)},e.prototype.fade=function(e,t){var n=(e=e||{}).time||1e3,i=e.complete;this.stopFade();var r={opacity:this.style.opacity},o={opacity:t};this.visible=!0;var a=this;this.fadeTween=new TWEEN.Tween(r).to(o,n).easing(TWEEN.Easing.Linear.None).onUpdate((function(){a.style.opacity=this._object.opacity})).onComplete((function(){0==a.style.opacity&&(a.visible=!1),i&&i.call(a,{object:a})})).start()},e.prototype.fadeIn=function(e){this.style.opacity=0,this.fade(e,1)},e.prototype.fadeOut=function(e){this.style.opacity=1,this.fade(e,0)},e.prototype.setClippingPlanes=function(e){var t=(e=e||{}).height,n=Ne.parseVector3(e.direction,new THREE.Vector3(0,-1,0));this._localClippingPlaneBase=new THREE.Plane(n,t),this._localClippingPlane=this._localClippingPlaneBase.clone();var i=this;this.node.traverse((function(e){e.isMesh&&(e._clip_prev_material=e.material,e.material=e.material.clone(),e.material.clippingPlanes=[i._localClippingPlane])})),this.tickable=!0},e.prototype.clearClippingPlanes=function(){this.node.traverse((function(e){e.isMesh&&(e.material=e._clip_prev_material,e.material.clippingPlanes=null)})),this._localClippingPlaneBase=null,this._localClippingPlane=null},e.prototype.toJSON=function(){return{type:this.type,id:this.id,name:this.name,position:this.position,angles:this.angles,scale:this.scale,style:{color:this.style.color,opacity:this.style.opacity,outlineColor:this.style.outlineColor,alwaysOnTop:this.style.alwaysOnTop,glow:this.style.glow,innerGlow:this.style.innerGlow,renderOrder:this.style.renderOrder}}},e.prototype.addControl=function(e,t,n){if(e){if(Ne.isString(t)&&(n=n||t,t={},this.removeControl(n)),!Ne.isNumber(e)){if(this.hasControl(e))return console.error("The control is existing when addControl() with '"+e+"'"),null;this._controls.push({control:e,name:n});var i=e.onAdd;return Ne.isFunction(i)&&i.call(e,this),this.tickable=!0,this.visible&&(this.app.needUpdate=!0),e}for(var r=[],o=0;o<r.length;o++){var a=r[o];if(a.id==e){var s=new a.type(this);return s.setup(t),this.addControl(s)}}return null}},e.prototype.getControl=function(e){for(var t=0;t<this._controls.length;t++)if(e==this._controls[t].name)return this._controls[t].control;return null},e.prototype.removeControl=function(e){if(e){var t=!1;if(Ne.isString(e)){for(var n=0;n<this._controls.length;n++)if(this._controls[n].name==e){(r=(i=this._controls[n].control).onRemove)&&r.call(i),this._controls.splice(n,1),t=!0;break}}else for(n=0;n<this._controls.length;n++)if(this._controls[n].control==e){var i,r;(r=(i=this._controls[n].control).onRemove)&&r.call(i),this._controls.splice(n,1),t=!0;break}t&&this.visible&&(this.app.needUpdate=!0)}},e.prototype.removeAllControls=function(){for(var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=0;t<this._controls.length;t++){var n=this._controls[t].control,i=n.onRemove;i&&i.call(n)}this._controls=[],e&&this.visible&&(this.app.needUpdate=!0)},e.prototype.hasControl=function(e){if(Ne.isString(e)){for(var t=0;t<this._controls.length;t++)if(e==this._controls[t].name)return!0}else if(-1!==this._controls.indexOf(e))return!0;return!1},e.prototype.setWorldPosition=function(e){var t=Ne.parseVector3(e);this.node._setWorldPosition(t,this.static),this.dirty=!0},e.prototype.setWorldAngles=function(e){var t=Ne.parseQuaternion(e);this.node._setWorldAngles(t,this.static),this.dirty=!0},e.prototype.setWorldScale=function(e){var t=Ne.parseVector3(e);this.node._setWorldScale(t,this.static),this.dirty=!0},e.prototype.setLocalPosition=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Ne.parseVector3(e),i=Ne.parseValue(t,this._ignoreParentScale);if(i){var r=this.node.parent;if(r){var o=new THREE.Vector3;this.node.updateWorldMatrix(!0,!1),r.getWorldScale(o),n.divide(o)}}this.localPosition=n.toArray()},e.prototype.getLocalPosition=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.node.position.clone();if(e){var n=new THREE.Vector3;this.node.updateMatrixWorld(),this.node.getWorldScale(n),t.multiply(n)}return t.toArray()},e.prototype._setScale=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",n=Ne.parseVector3(e);0==n.x&&(console.error("Please check scale-x value, it can not be zero"),n.x=Number.EPSILON),0==n.y&&(console.error("Please check scale-y value, it can not be zero"),n.y=Number.EPSILON),0==n.z&&(console.error("Please check scale-z value, it can not be zero"),n.z=Number.EPSILON),Ft.set(1,1,1),this._scaleGroupStates.enable(n,t),this._scaleGroupStates.states.forEach((function(e){var t=e.value;Ft.multiply(t)}));var i=this._getIndependentControlRenderNode();this.anchorNode&&(i=this.anchorNode),i.scale.copy(Ft),this.synIndependentWorldScale(),this.static&&this.node._synMatrixWorld(),this.dirty=!0},e.prototype._getScale=function(e){if(e){var t=this._scaleGroupStates.getValue(e);return t?t.toArray():[1,1,1]}var n=this._getIndependentControlRenderNode();return this.anchorNode&&(n=this.anchorNode),n.scale.toArray()},e.prototype._synWorldAngles=function(){this.dirty=!0,this.synIndependentWorldAngles(),this.static&&this.node._synMatrixWorld()},e.prototype._getAttributeFromSelfToRoot=function(e){for(var t=this;t;t=t.parent){var n=t.node.userData[e];if(n)return n}return null},e.prototype._getBaseMatrix=function(){return this._getAttributeFromSelfToRoot("_baseMatrix")},e.prototype._getPosition=function(){this.node.updateWorldMatrix(!0,!1);var e=new THREE.Vector3;return this.node.getWorldPosition(e),e.toArray()},e.prototype._setPosition=function(e){e&&(this.setWorldPosition(e),this.synIndependentWorldPosition())},e.prototype._needUseWorldPosition=function(){var e=this._parent;return!!e&&e.node!=this.node.parent},e.prototype._setLocalPosition=function(e){if(this.anchorNode){var t=Ne.parseVector3(this.parent.selfToWorld(e));this.node._setWorldPosition(t,this.static)}else if(this._needUseWorldPosition()){var n=Ne.parseVector3(this._parent.selfToWorld(e));this.node._setWorldPosition(n,this.static)}else{var i=Ne.parseVector3(e);this.node.position.copy(i),this.static&&this.node._synMatrixWorld()}this._setDirtyFlag(!1,!0,!0);var r=this._notifyPositionChange;r&&r.call(this)},e.prototype._getLocalPosition=function(){if(!this._parent)return[0,0,0];if(this.anchorNode)return this._parent.worldToSelf(this.position);if(this._needUseWorldPosition()){var e=new THREE.Vector3;return this.node.getWorldPosition(e),this._parent.node.worldToLocal(e),e.toArray()}return(e=this.node.position).toArray()},e.prototype._getAngles=function(){var e=this.node.parent;if(e&&e.userData.childUseWorldAnglesAlways)return this.worldAngles;return this.anchorNode?this.anchorNode.getAngles():this.node.getAngles()},e.prototype._setAngles=function(e){if(!THING.Math.equalsVector(this.angles,e)){var t=this.node;this.anchorNode&&(t=this.anchorNode),t.setAngles(e),this._synWorldAngles()}},e.prototype.setAnchorPosition=function(e){if(e){var t=this.anchorNode;t?(t.children[0].getWorldPosition(Ot),Dt.fromArray(e),t._setWorldPosition(Dt,!1,this.static),t.updateWorldMatrix(!1,!1),t.children[0]._setWorldPosition(Ot,this.static)):(t=new THREE.Object3D,this.node.parent.add(t),Dt.fromArray(e),t._setWorldPosition(Dt,this.static),t.updateWorldMatrix(!1,!1),t.attach(this.node),this.anchorNode=t)}else this.anchorNode&&(this.anchorNode.parent.attach(this.anchorNode.children[0]),this.anchorNode.removeBySelf(),this.anchorNode=null)},e.prototype.getAnchorPosition=function(){var e=this.anchorNode;return e?(e.getWorldPosition(Ot),this.worldToSelf(Ot.toArray())):null},e.prototype.getBoundingBox=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.boundingBoxControl.getBoundingBox(e,t)},e.prototype.getOrientedBox=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.boundingBoxControl.getOrientedBoundingBox(e,t)},e.prototype.getLocalBoundingBox=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.boundingBoxControl.getLocalBoundingBox(e,t)},e.prototype._setBoundingBoxPivot=function(e){this.node.userData.boundingBoxPivot=e,this.dirty=!0},e.prototype._getBoundingBoxPivot=function(){var e=this.node.userData.boundingBoxPivot;return e||null},e.prototype._setBoundingBoxSize=function(e){e&&(isNaN(e[0])&&console.error("_setBoundingBoxSize() failed, value[0] is NaN",this),isNaN(e[1])&&console.error("_setBoundingBoxSize() failed, value[1] is NaN",this),isNaN(e[2])&&console.error("_setBoundingBoxSize() failed, value[2] is NaN",this)),this.node.userData.boundingBoxSize=e,this.dirty=!0},e.prototype._getBoundingBoxSize=function(){var e=this.node.userData.boundingBoxSize;return e||null},e.prototype._updateKeepSize=function(e,t,n,i){return this._keepSize!=e&&(this._keepSize=e,e?(i=i||this.distanceTo(this.app.camera.position),n=n||this.scale,this.addControl(new Ct(n,t,i),"SizeAdjustmentControl")):this.removeControl("SizeAdjustmentControl"),!0)},e.prototype.getOffsetPosition=function(e){if(e=e||{},!Ne.isNull(e.xAngle)||!Ne.isNull(e.yAngle)){var t=Ne.parseValue(e.yAngle,0),n=Ne.parseValue(e.xAngle,0),i=Ne.parseValue(e.distance,e.radius);if(void 0===i){var r=Ne.parseValue(e.onlyVisible,!0);i=this.boundingBoxControl.getBoundingBox(r).radius}var o=e.radiusFactor;return o&&(i*=o),(new THREE.Vector3).getDirectionFromAngles(t,n,i).toArray()}if(e.direction){var a=Ne.parseVector3(e.direction),s=e.distance||e.radius;a.multiplyScalar(s);var l=Ne.parseVector3(this.position);return l.add(a),this.worldToSelf(l.toArray())}},e.prototype.getWorldPosition=function(e){var t=this.getOffsetPosition(e)||[0,0,0];return this.selfToWorld(t)},e.prototype.getLayoutPosition=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!Ne.isArray(e))return null;if(3!==e.length)return null;var o=n?this.getOrientedBox(i,r):this.getBoundingBox(i,r),a=o.points,s=[];if(n)for(var l=0;l<a.length;l++)s.push(this.worldToSelf(a[l]));else s=a.concat();var u=[[s[0],s[1]],[s[0],s[4]],[s[0],s[2]]],c=function(e,t){var n=0;Ne.isString(t)?t.equals("left",!0)||t.equals("bottom",!0)||t.equals("back",!0)?n=0:t.equals("right",!0)||t.equals("top",!0)||t.equals("front",!0)?n=1:t.equals("center",!0)&&(n=.5):Ne.isNumber(t)?n=t:console.error("get layout position failed, due to unknown layout type("+t+")");var i=Ne.parseVector3(e[0]),r=Ne.parseVector3(e[1]);return i.lerp(r,n),i},h=c(u[0],e[0]).x,p=c(u[1],e[1]).y,d=c(u[2],e[2]).z,f=[h,p,d];if(n||(f=this.worldToSelf(f)),t){var m=this.worldToSelf(t);f=THING.Math.subVector(m,f)}return f=this.selfToWorld(f)},e.prototype._setStyle=function(e){this._style=e},e.prototype._getStyle=function(){return this._style||(this._style=this.app.styleManager.createStyle("Default",this),this._defaultStyle=this._style),this._style},e.prototype.applyTheme=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.style._inheritThemeName=e||null,t&&this.children.forEach((function(t){return t.applyTheme(e,!0,n)})),this.userData.SKIP_THEME||"Facade"==this.type&&this.building&&this.building.userData.SKIP_THEME||(this.loaded?this.style._applyTheme&&this.style._applyTheme(e,n):this.waitCommands.push({type:"ApplyObjectTheme",object:this,params:{name:e,force:n}}))},e.prototype._getChildVisibles=function(){var e=[];return this.children.forEach((function(t){e.push(t.visible)})),e},e.prototype._onGetChild=function(){return this.children},e.prototype._setChildVisible=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default",i=this._onGetChild(),r=0;r<i.length;r++){var o=i[r];if(o)if(o.inheritVisible)o._setVisible(e,n);else for(var a=t[r],s=o._visibleGroupStates.states,l=0;l<s.length;l++){var u=s[l];if(u.value==a){o._setVisible(a,u.name);break}}}},e.prototype._setNodeVisible=function(e){var t=this;this._traverseSelfNodes((function(n){n.userData.asBoundingBox||n.ensureVisible(e,t._autoSynVisible)}))},e.prototype._getHidePermission=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",t=this._visibleGroupStates.states,n=0;n<t.length;n++){var i=t[n];if(i.name!=e&&i.value)return!1}return!0},e.prototype.setVisible=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.renderNode.visible=!1,t&&this.children.forEach((function(n){n.setVisible(e,t)}))},e.prototype._setVisible=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";if(!this._hideNodesInScene){this._visibleGroupStates.enable(e,t);var n=this._visibleGroupStates.isAnyEnable();THING.disableVisibleGroupStates&&(n=this._visibleGroupStates.isEnable("default"));var i=this.visible,r=this._notifyBeforeChangeVisible;r&&r.call(this);var o=this._getChildVisibles();n&&this._autoEnsureParentsVisible&&this.node.ensureParentsVisible(n),this._setNodeVisible(n),this._setChildVisible(e,o,t);for(var a=0;a<this._controls.length;a++){var s=this._controls[a].control;Ne.isFunction(s.onVisible)&&s.onVisible(n)}var l=this._notifyAfterChangeVisible;l&&l.call(this),i!=n&&(this.dirty=!0)}},e.prototype._getVisible=function(){return!this._hideNodesInScene&&(!!this.node.visible&&this.node.getLayerVisible())},e.prototype._getChildrenSelector=function(){var e=new gt(this.app,this.children);return e.buildReturnObject(this.children),e},e.prototype._getChildren=function(){return this._children.result},e.prototype._getBrothers=function(){var e=this,t=void 0,n=this._parent;t=n?n._children.filter((function(t){return t!==e&&!t.isCombinedObject})):[];var i=new gt(this.app,t);return i.buildReturnObject(t),i},e.prototype._getParents=function(){for(var e=[],t=this._parent;t;t=t.parent)t.isCombinedObject||e.push(t);var n=new gt(this.app,e,!0);return n.buildReturnObject(e),n},e.prototype.indexOfParent=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._parent;if(!t)return-1;var n=this._parent._children.indexOf(this);if(-1===n)return-1;if(e){n=0;for(var i=this._parent._children,r=0;r<i.length;r++){var o=i[r];if(o==this)return n;o.type==this.type&&n++}}return n},e.prototype._loadResource=function(e){e&&this._children.forEach((function(e){e.loadResource()}))},e.prototype._unloadResource=function(e){e&&this._children.forEach((function(e){e.unloadResource()}))},e.prototype._notifyLoadingObjects=function(){var e=this.parents.query(".Campus")[0];e&&e._loadingObjects.add(this)},e.prototype._loadSelfResource=function(){var e=this.builder;e&&e.requestToBuild&&e.requestToBuild(this.uuid)},e.prototype.loadResource=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.builder;t&&t.requestToBuild&&(this._loadResource(e),this._notifyLoadingObjects(),this._loadSelfResource(),this.loaded&&(this.dataToRecover=this.toJSON()))},e.prototype.unloadResource=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._unloadResource(e);var t=[],n=this;this._traverseSelfNodes((function(e){n.app.resourceManager.unload(e,!1,!1,!1,!1),e.material&&(e.disposeMaterial(),t.push(e))})),t.forEach((function(e){e.removeBySelf()}));var i=this.builder;i&&i.disposeObject&&i.disposeObject(this.id),this.loaded=!1},e.prototype.startToBuild=function(e){var t=this.builder;t&&Ne.isFunction(t.startToBuild)&&(t._old_build_version=t._build_version,t._build_version=t._build_version||1,t._build_version++,t.startToBuildingQueue=t.startToBuildingQueue||[],t.startToBuildingQueue.push({version:t._build_version,progressCallback:e}),this.tickable=!0)},e.prototype.clearNode=function(e){this._url&&(this.app.modelResource.unload(this._url),this._url=null),this.removePickingResources(),this.app.resourceManager.remove(this.node,e)},e.prototype.cloneSelf=function(e){return this.app.create(e)},e.prototype.clone=function(e,t){var n=this,i=this.node.cloneByFilter((function(e){for(var t=0;t<n._children.length;t++){var i=n._children[t].node;if(e==i||e.isChildOf(i))return!1}return!0}));i.traverse((function(e){e.userData={}}));var r={type:this.type,url:this.url,position:this.position,angles:this.angles,scale:this.scale,visible:this.visible,parent:t||this._parent,node:i},o=this.cloneSelf(r);if(!o)return null;if(e)for(var a=0;a<this._children.length;a++)this._children[a].clone(e,o);return o},e.prototype.getEnvMapResources=function(){for(var e=this.parent;e;e=e.parent){var t=e.envMapResources;if(t)return t}return null},e.prototype._synEffectRefCounts=function(){var e=this.app.effectManager;e&&this.node.traverse((function(t){e.synEffect(t)}))},e.prototype._processBillboard=function(e,t){var n=this;e.setUserDataValue("skipOutline",!0),t.billboard=!0,e._lookAt(t,(function(){return n.static}))},e.prototype._processModel=function(){var e=this;this.node.traverse((function(t){var n=t.userData.gltfExtensions;n&&n.billboard&&(n.billboard.axis="y",e._processBillboard(t,n.billboard),delete n.billboard)}))},e.prototype.synIndependentWorldPosition=function(){if(this._independentControlFlags.has(D.Position)){var e=new THREE.Vector3;this._getIndependentControlRenderNode().getWorldPosition(e),this._independentPosition=e}var t=this._notifyPositionChange;t&&t.call(this)},e.prototype.synIndependentWorldAngles=function(){if(this._independentControlFlags.has(D.Rotation)){var e=this._getIndependentControlRenderNode().quaternion.clone();this._independentWorldAngles=e}var t=this._notifyAnglesChange;t&&t.call(this)},e.prototype.synIndependentWorldScale=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this._independentControlFlags;if(!(t=Ne.parseValue(this.inheritScale,t))||n.has(D.Scale)){var i=this._getIndependentControlRenderNode()._getWorldScale(),r=this.node.parent;if(r){var o=r._getWorldScale();i.divide(o)}this._independentWorldScale?this._independentWorldScale.copy(i):this._independentWorldScale=i,e&&(this.dirty=!0)}var a=this._notifyScalesChange;a&&a.call(this)},e.prototype.synIndependentTransform=function(){var e=this._independentControlFlags;e.has(D.Position)&&this.synIndependentWorldPosition(),e.has(D.Rotation)&&this.synIndependentWorldAngles(),e.has(D.Scale)&&this.synIndependentWorldScale()},e.prototype._getIndependentControlRenderNode=function(){return this.node},e.prototype._useIndependentTransform=function(e){var t=this._getIndependentControlRenderNode();e.updateWorldMatrix(!0);var n=e.matrixWorld,i=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Quaternion;n.decompose(i,o,r);var a=new THREE.Matrix4;a.getInverse(t.matrixWorld);var s=new THREE.Matrix4;if(s.premultiply(a),s.multiply(n),t.updateWorldMatrix(!0),this._independentPosition?i=this._independentPosition.clone():i.setFromMatrixPosition(t.matrixWorld),this._independentWorldAngles){if(o=this._independentWorldAngles.clone(),!this._independentPosition){var l=this.parent.node,u=this.parent.node.getMatrixWorldFromRoot(l.parent),c=new THREE.Matrix4;this._independentWorldScale||(c.compose(new THREE.Vector3,new THREE.Quaternion,l.scale),u.multiply(c)),u.multiply(t.matrix);var h=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Quaternion;u.decompose(h,d,p),i=h}}else t.matrixWorld.decompose(Dt,o,kt);this._independentWorldScale?r=this._independentWorldScale.clone():t.matrixWorld.decompose(Dt,jt,r);var f=new THREE.Matrix4;f.compose(i,o,r),n.multiplyMatrices(f,s)},e.prototype._useIndependentRaycast=function(e){var t=this._getIndependentControlRenderNode();if(t)if(e){t.userData.original_raycast=t.userData.original_raycast||t.raycast;var n=this;t.raycast=function(e,t){var i=n._getIndependentControlRenderNode();return i&&n._useIndependentTransform(i),this.userData.original_raycast.call(this,e,t)}}else t.userData.original_raycast&&(t.raycast=t.userData.original_raycast,delete t.userData.original_raycast)},e.prototype._enableIndependentControl=function(){var e=this;this._traverseSelfNodes((function(e){e.removeBeforeRenderFunction("independentControlRender",!1)}));var t=!1,n=this._independentControlFlags;if(n.has(D.Transform)){this.node.traverse((function(e){Ne.backupValue(e,"frustumCulled"),e.frustumCulled=!1})),this.synIndependentTransform(),this.tickable=!0;var i=this._getIndependentControlRenderNode();if(!i.hasBeforeRenderFunction("independentControlRender")){e=this;i.addBeforeRenderFunction("independentControlRender",(function(t,n,i){e._useIndependentTransform(this)}),0)}t=!0}else this.node.traverse((function(e){Ne.revertValue(e,"frustumCulled")}));return n.has(D.Position)||(this._independentPosition=null),n.has(D.Rotation)||(this._independentWorldAngles=null),n.has(D.Scale)||(this._independentWorldScale=null),this._useIndependentRaycast(t),t},e.prototype.enableIndependentControl=function(e,t){if(this._independentControlFlags.enable(e,t))return this._enableIndependentControl()},e.prototype.stopAllLerpTo=function(){for(var e=0;e<this._tweens.length;e++)this._tweens[e].tween.stop();this._tweens=[]},e.prototype.stopLerpTo=function(e){for(var t=0;t<this._tweens.length;t++)e==this._tweens[t].name&&(this._tweens[t].tween.stop(),this._tweens.splice(t--,1))},e.prototype.lerpTo=function(e,t){var n=function(e){for(var t={},n=Object.keys(e),i=0;i<n.length;i++){var r=n[i],o=e[r];if(Ne.isArray(o)){if(3==o.length)(a=Ne.parseVector3(o))&&(o=a,t["__"+r+"_x"]=o.x,t["__"+r+"_y"]=o.y,t["_#vector3"+r]=o.z);else if(2==o.length){var a;(a=Ne.parseVector2(o))&&(o=a,t["__"+r+"_x"]=o.x,t["_#vector2"+r]=o.y)}}else t[r]=o}return t},i=function(e,t){var n=e.stop;e.start=null,e.stop=null,m.lerpTo(e,t),e.stop=n},r=function(e,t,n){for(var i=0;i<e.length;i++){if(!(o=e[i]).startsWith("__")){var r=n[o];if(o.startsWith("_#vector3"))r=[n["__"+(o=o.substring(9))+"_x"],n["__"+o+"_y"],r];else if(o.startsWith("_#vector2")){var o;r=[n["__"+(o=o.substring(9))+"_x"],r]}else r=n[o];Ne.setAttribute(t,o,r)}}},o=n((e=e||{}).from||{}),a=n(e.to||{}),s=e.time||1e3,l=Ne.parseValue(e.delayTime,0),u=e.update,c=e.complete,h=e.lerpType||THING.LerpType.Linear.None,p=Ne.parseLoopType(e.loopType);o.__progress=Ne.parseValue(o.__progress,0),a.__progress=Ne.parseValue(a.__progress,1);var d=0;t&&this.stopLerpTo(t);var f=Object.keys(o),m=this,g=new TWEEN.Tween(o).to(a,s).delay(l).easing(h).onStop((function(){var t={object:m};r(f,t,this._object),r(f,m,this._object),e.stop&&e.stop.call(m,t)})).onStart((function(){var t={object:m,delta:0};r(f,t,this._object),r(f,m,this._object),e.start&&e.start.call(m,t)})).onUpdate((function(){var e=this._object.__progress-d;d=this._object.__progress;var t={object:m,delta:e};r(f,t,this._object),r(f,m,this._object),u&&u.call(m,t)})).onComplete((function(){var n=this._object.__progress-d;d=this._object.__progress;var o={object:m,delta:n};if(r(f,o,this._object),r(f,m,this._object),p==THREE.LoopOnce)c&&c.call(m,o);else if(p==THREE.LoopRepeat)i(e,t);else if(p==THREE.LoopPingPong){var a=e.from;e.from=e.to,e.to=a,i(e,t)}})).start();this._tweens.push({name:t,tween:g})},e.prototype._getLinkableObjects=function(){var e=new gt(this.app),t=this.userData._Portal_;if(t){var n=this.app.query(t)[0];n&&e.add(n)}return e},e.prototype._getLinkableDoors=function(){return this._queryChild("[_Portal_]")},e.prototype._setupNavigationGraph=function(e,t){e[this.id]=e[this.id]||{};for(var n=this._getLinkableDoors(),i=0;i<n.length;i++){var r=n[i];e[r.id]=e[r.id]||{},e[this.id][r.id]=e[r.id][this.id]=t;for(var o=r._getLinkableObjects(),a=0;a<o.length;a++){var s=o[a];e[s.id]=e[s.id]||{},e[s.id][r.id]=e[r.id][s.id]=t}}},e.prototype.setupGraph=function(){if(this._graph)return this._graph;var e={};return this._setupNavigationGraph(e,1e4),this._graph=new Graph(e),this._graph},e.prototype.findPath=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=this.getNavigation();return i?i.findPath({startPosition:e,endPosition:t,height:n}):null},e.prototype.getFindingPathLength=function(e,t){var n=this.findPath(e,t);return n?n.getPathLength():0},e.prototype.showNavigationHelper=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getNavigation();t&&t.showHelper(e)},e.prototype.canNavigation=function(){return!1},e.prototype.getNavigation=function(e){return this.canNavigation()?(this._navigation||(this._navigation=new tt(this)),(e||this._navigation.needGen())&&this._navigation.init(e),this._navigation):null},e.prototype.changeAppearance=function(e){if(this.__appearanceNode!=e)if(e){e.visible=!0,this.node.add(e);for(var t=0;t<this.node.children.length;t++){(n=this.node.children[t]).visible&&n!=e&&(n.visible=!1,n.__appearanceNode=e)}this.__appearanceNode=e}else{e.visible=!1,e.removeBySelf();for(t=0;t<this.node.children.length;t++){var n;(n=this.node.children[t]).__appearanceNode&&(n.visible=!0,delete n.__appearanceNode)}delete this.__appearanceNode}},e.prototype._getScreenSize=function(e){var t=this.app.camera;e=e||this.distanceTo(t.position);var n=THING.Math.degToRad(t.fov),i=2*Math.tan(n/2)*e;return[i*t.aspect,i]},e.prototype._getOutlinePoints=function(e){var t=[];this.node.updateWorldMatrix(!0,!0);var n=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Matrix3,o=["a","b","c"];return this.node.getMeshes().forEach((function(a){r.getNormalMatrix(a.matrixWorld);var s=a.matrixWorld,l=a.geometry;if(l&&l.isGeometry)for(var u=l.vertices,c=l.faces,h=0,p=c.length;h<p;h++)for(var d=c[h],f=0,m=d.vertexNormals.length;f<m;f++){var g=u[d[o[f]]],v=d.vertexNormals[f];n.copy(g).applyMatrix4(s),i.copy(v).applyMatrix3(r).normalize().multiplyScalar(e).add(n),t.push([i.x,i.y,i.z])}else if(l&&l.isBufferGeometry){var y=l.attributes.position,b=l.attributes.normal;for(f=0,m=y.count;f<m;f++)n.set(y.getX(f),y.getY(f),y.getZ(f)).applyMatrix4(s),i.set(b.getX(f),b.getY(f),b.getZ(f)),i.applyMatrix3(r).normalize().multiplyScalar(e).add(n),t.push([i.x,i.y,i.z])}})),t},e.prototype.getAllObjectsInChildren=function(e){console.warn("[BaseObject] Please use '.children' to replace 'getAllObjectsInChildren()'");for(var t=0;t<this._children.length;t++)e.push(this._children[t])},e.prototype.dispatch=function(e){console.warn("[BaseObject] Please use 'trigger' to replace 'dispatch' when you want to launch event"),this.trigger(e)},e.prototype.upPosition=function(e){return console.warn("[BaseObject] Please use '.this.selfToWorld([0, distance, 0])' to replace 'upPosition()'"),this.selfToWorld([0,e,0])},e.prototype.downPosition=function(e){return console.warn("[BaseObject] Please use '.this.selfToWorld([0, -distance, 0])' to replace 'downPosition()'"),this.selfToWorld([0,-e,0])},e.prototype.setPosition=function(e,t,n){console.warn("[BaseObject] Please use '.position=[x, y, z]' to replace 'setPosition()'"),this.position=[e,t,n]},e.prototype.setX=function(e){console.warn("[BaseObject] Please use '.position=[x, y, z]' to replace '.x='");var t=this.position;t[0]=e,this.position=t},e.prototype.setY=function(e){console.warn("[BaseObject] Please use '.position=[x, y, z]' to replace '.y='");var t=this.position;t[1]=e,this.position=t},e.prototype.setZ=function(e){console.warn("[BaseObject] Please use '.position=[x, y, z]' to replace '.z='");var t=this.position;t[2]=e,this.position=t},e.prototype.show=function(e){console.warn("[BaseObject] Please use '.visible=true/false' to replace 'show()'"),void 0===e&&(e=!0),this.visible=e},e.prototype.hide=function(){console.warn("[BaseObject] Please use '.visible=false' to replace 'hide()'"),this.visible=!1},e.prototype.flipVisible=function(){console.warn("[BaseObject] Please use '.visible=!.visible' to replace 'flipVisible()'"),this.visible=!this.visible},e.prototype.attr=function(){return console.warn("[BaseObject] Please use 'userData[x]' to replace 'attr()'"),0==arguments.length?this.userData:1==arguments.length?this.userData[arguments[0]]:void(2==arguments.length&&(this.userData[arguments[0]]=arguments[1]))},e.prototype.moveX=function(e){console.warn("[BaseObject] Please use '.translate([d, 0, 0])' to replace 'moveX(d)'"),this.translate([e,0,0])},e.prototype.moveY=function(e){console.warn("[BaseObject] Please use '.translate([0, d, 0])' to replace 'moveY(d)'"),this.translate([0,e,0])},e.prototype.moveZ=function(e){console.warn("[BaseObject] Please use '.translate([0, 0, d])' to replace 'moveZ(d)'"),this.translate([0,0,e])},e.prototype.hasShowBoundingBox=function(){return console.warn("[BaseObject] Please use '.style.boundingBox' to replace 'hasShowBoundingBox()'"),this.style.boundingBox},e.prototype.showBoundingBox=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[BaseObject] Please use '.style.boundingBox' to replace 'showBoundingBox()'"),this.style.boundingBox=e},e.prototype.getAncestor=function(e){return console.warn("[BaseObject] Please use '.parents.query(param)' to replace '.getAncestor(param)'"),this.parents.query(e)},e.prototype.getSubNodeIndex=function(e){return console.warn('[BaseObject] we do not support ".getSubNodeIndex()" anymore, please do not use it'),-1},e.prototype.getSubNodesNumber=function(){return console.warn('[BaseObject] we do not support ".getSubNodesNumber()" anymore, please do not use it'),0},e.prototype.getSubNodeByIndex=function(e){return console.warn('[BaseObject] we do not support ".getSubNodeByIndex()" anymore, please do not use it'),null},e.prototype.removeSubNodeByIndex=function(e){console.warn('[BaseObject] we do not support ".removeSubNodeByIndex()" anymore, please do not use it')},e.prototype.insertSubNode=function(e,t){console.warn('[BaseObject] we do not support ".insertSubNode()" anymore, please do not use it')},e.prototype.createSubNode=function(e){return console.warn('[BaseObject] we do not support ".createSubNode()" anymore, please do not use it'),null},e.prototype.setPolygonOffset=function(e){console.warn("[BaseObject] Please use '.style.setPolygonOffset(params)' to replace '.setPolygonOffset(params)'"),this.style.setPolygonOffset(e)},o(e,[{key:"pickable",set:function(e){this._pickable!=e&&(this._pickable=e,this.synPickable())},get:function(){return!(this.node&&!this.node.getPickable())&&this._pickable}},{key:"subNodes",get:function(){var e=[];this._traverseNodes(this.node,e,!0);var t=new gt(this.app,e);return t.buildReturnObject(e),t}},{key:"attachPoints",get:function(){if(!this._attachPoints){this._attachPoints=[];var e=this;this.node.traverse((function(t){var n=t.userData;if(n&&n.isBaseObject){var i=e.app.objectManager.get(n.id);e.isAttachPoint(i)&&(e._attachPoints.push(i),e.app.objectManager.destroy(i))}}))}var t=new gt(this.app);return t.buildReturnObject(this._attachPoints),t}},{key:"isBaseObject",get:function(){return!0}},{key:"destroyed",get:function(){return!this._queryID}},{key:"internalUserData",get:function(){return this._internalUserData},set:function(e){this._internalUserData=e}},{key:"uuid",set:function(e){this._uuid=e},get:function(){return this._uuid}},{key:"type",set:function(e){this._type=e},get:function(){return this._type}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}},{key:"name",set:function(e){this._name=e},get:function(){return this._name}},{key:"queryID",set:function(e){this._queryID=e},get:function(){return this._queryID}},{key:"userData",set:function(e){this._userData=e},get:function(){return this._userData}},{key:"tags",set:function(e){this._tags=e},get:function(){return this._tags}},{key:"groups",get:function(){return this._groups}},{key:"gridSize",get:function(){return this._grid?this._grid.size:0}},{key:"controls",get:function(){return this._controls}},{key:"x",set:function(e){var t=this.position;this.position=[e,t[1],t[2]]},get:function(){return this.position[0]}},{key:"y",set:function(e){var t=this.position;this.position=[t[0],e,t[2]]},get:function(){return this.position[1]}},{key:"z",set:function(e){var t=this.position;this.position=[t[0],t[1],e]},get:function(){return this.position[2]}},{key:"position",set:function(e){this._setPosition(e)},get:function(){return this._getPosition()}},{key:"localPosition",set:function(e){this._setLocalPosition(e)},get:function(){return this._getLocalPosition()}},{key:"angleX",set:function(e){var t=this.angles;this.angles=[e,t[1],t[2]]},get:function(){return this.angles[0]}},{key:"angleY",set:function(e){var t=this.angles;this.angles=[t[1],e,t[2]]},get:function(){return this.angles[1]}},{key:"angleZ",set:function(e){var t=this.angles;this.angles=[t[1],t[2],e]},get:function(){return this.angles[2]}},{key:"angles",set:function(e){this._setAngles(e)},get:function(){return this._getAngles()}},{key:"worldAngles",set:function(e){this.setWorldAngles(e),this._synWorldAngles()},get:function(){var e=new THREE.Quaternion;return this.node.getWorldQuaternion(e),Ne.parseAngles(e)}},{key:"selfForward",get:function(){var e=new THREE.Vector3;return this.node.getDirection(e),e.normalize(),e.toArray()}},{key:"forward",get:function(){var e=new THREE.Vector3;return this.node.updateMatrixWorld(!0),this.node.getWorldDirection(e),e.normalize(),e.toArray()}},{key:"up",get:function(){var e=this.node.up.clone();return this.node.updateMatrixWorld(!0),e.transformDirection(this.node.matrixWorld).normalize(),e.toArray()}},{key:"cross",get:function(){var e=Ne.parseVector3(this.up),t=Ne.parseVector3(this.forward),n=new THREE.Vector3;return n.crossVectors(e,t),n.normalize(),n.toArray()}},{key:"scale",set:function(e){this._setScale(e)},get:function(){return this._getScale()}},{key:"worldScale",set:function(e){this.setWorldScale(e),this.synIndependentWorldScale(),this.dirty=!0},get:function(){var e=new THREE.Vector3;return this.node.getWorldScale(e),e.toArray()}},{key:"anchor",set:function(e){this.setAnchorPosition(e)},get:function(){return this.getAnchorPosition()}},{key:"boundingBoxControl",get:function(){return this._boundingBoxControl||(this._boundingBoxControl=new it(this),this.addControl(this._boundingBoxControl)),this._boundingBoxControl}},{key:"forceBoundingBox",get:function(){return!!this.node.userData.forceBoundingBox},set:function(e){this.node.userData.forceBoundingBox!=e&&(this.node.userData.forceBoundingBox=e,this.dirty=!0)}},{key:"boundingBox",get:function(){return this.boundingBoxControl.getBoundingBox(!0)}},{key:"orientedBoundingBox",get:function(){return this.boundingBoxControl.getOrientedBoundingBox(this.visible)}},{key:"radius",get:function(){return this.boundingBoxControl.getBoundingBox(this.visible).radius}},{key:"size",get:function(){return this.boundingBoxControl.getBoundingBox(this.visible).size}},{key:"center",get:function(){return this.boundingBoxControl.getBoundingBox(this.visible).center}},{key:"keepSize",set:function(e){this._updateKeepSize(e,this.node),this.dirty=e},get:function(){return this._keepSize}},{key:"style",set:function(e){this._setStyle(e)},get:function(){return this._getStyle()}},{key:"catchEventAnyTime",set:function(e){this._catchEventAnyTime=e},get:function(){return this._catchEventAnyTime}},{key:"draggable",set:function(e){this._draggable!=e&&(this._draggable=e,e?this.on("dragging",(function(e){if(e.picked){var t=e.object;t==this&&(t.position=THING.Math.addVector(t.position,e.offsetPosition),this.trigger("drag",e))}}),"__object_drag__"):this.off("dragging",null,"__object_drag__"))},get:function(){return this._draggable}},{key:"dragState",get:function(){return this._dragState}},{key:"tickable",set:function(e){this.isTickable!=e&&(this.isTickable=e,this.synTickableObject(),this.app.needUpdate=!0)},get:function(){return this.isTickable}},{key:"renderDistance",set:function(e){this._renderDistance=e,Ne.isNull(e)?this.app.objectManager.removeRenderDistanceObject(this):this.app.objectManager.addRenderDistanceObject(this)},get:function(){return this._renderDistance}},{key:"shadowDistance",set:function(e){this._shadowDistance=e,Ne.isNull(e)?this.app.objectManager.removeShadowDistanceObject(this):this.app.objectManager.addShadowDistanceObject(this)},get:function(){return this._shadowDistance}},{key:"visible",set:function(e){this._setVisible(e)},get:function(){return this._getVisible()}},{key:"dirty",set:function(e){e&&(this._setDirtyFlag(!0,!0),this.visible&&(this.app.needUpdate=!0))}},{key:"disableUpdateBoundingBox",set:function(e){this.boundingBoxControl.disable!=e&&(this.boundingBoxControl.disable=e,e||(this.dirty=!0))},get:function(){return this.boundingBoxControl.disable}},{key:"static",get:function(){return this.app.root.static}},{key:"children",get:function(){return this._getChildren()}},{key:"brothers",get:function(){return this._getBrothers()}},{key:"parents",get:function(){return this._getParents()}},{key:"parent",get:function(){return this._parent}},{key:"levelFromRoot",get:function(){for(var e=0,t=this.parent;t;t=t.parent)e++;return e}},{key:"loaded",get:function(){return this._loadState==e.loadCompleted},set:function(t){this._loadState=t?e.loadCompleted:e.waitForLoading}},{key:"loading",get:function(){return this._loadState==e.loading},set:function(t){t&&(this._loadState=e.loading)}},{key:"builder",get:function(){for(var e=this;e;e=e.parent){var t=e._builder;if(t)return t}return null}},{key:"verticesNumber",get:function(){return Ne.isFunction(this.node.verticesCount)?this.node.verticesCount():0}},{key:"meshNames",get:function(){return this.node.getMeshNames()}},{key:"inheritVisible",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Visible,!e)},get:function(){return!this._independentControlFlags.has(THING.IndependentControlType.Visible)}},{key:"inheritStyle",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Style,!e)},get:function(){return!this._independentControlFlags.has(THING.IndependentControlType.Style)}},{key:"inheritPosition",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Position,!e)},get:function(){return!this._independentControlFlags.has(THING.IndependentControlType.Position)}},{key:"inheritAngles",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Rotation,!e)},get:function(){return!this._independentControlFlags.has(THING.IndependentControlType.Rotation)}},{key:"inheritScale",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Scale,!e)},get:function(){return!this._independentControlFlags.has(THING.IndependentControlType.Scale)}},{key:"inheritPickable",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Pickable,!e)},get:function(){return!this._independentControlFlags.has(THING.IndependentControlType.Pickable)}},{key:"owner",get:function(){return this.parent}},{key:"_hideByScene",set:function(e){if(e){var t=new THREE.Group;t.position.copy(this.node.position),t.quaternion.copy(this.node.quaternion),t.scale.copy(this.node.scale);var n=this.node.parent;this._hideNodesInScene=this.node,this.node.removeBySelf(),this.setupNode(t),n&&n.add(t)}}},{key:"lodLevel",get:function(){return this._lodLevel},set:function(e){var t=this;this.loaded?(this._lodNode||this.node.traverse((function(e){"LOD"==e.type&&(t._lodNode=e,t.tickable=!0)})),this._lodNode&&(this._lodNode.autoUpdate=-1==e,this._lodLevel=e)):this.waitCommands.push({type:"setObjectLodLevel",object:this,params:{level:e}})}},{key:"lodLevelNumber",get:function(){var e=this;return this._lodNode||this.node.traverse((function(t){"LOD"==t.type&&(e._lodNode=t,e.tickable=!0)})),this._lodNode?this._lodNode.levels.length:0}},{key:"self",get:function(){return console.warn("[BaseObject] Please do not use '.self'"),this}},{key:"custom",get:function(){return console.warn("[BaseObject] Please use '.userData' to replace '.custom'"),this.userData}},{key:"boxSize",get:function(){return console.warn("[BaseObject] Please use '.size' to replace '.boxSize'"),this.size}},{key:"boxRadius",get:function(){return console.warn("[BaseObject] Please use '.radius' to replace '.boxRadius'"),this.radius}},{key:"localAngles",set:function(e){this.angles=e},get:function(){return this.angles}},{key:"isShowBoundingBox",get:function(){return console.warn("[BaseObject] Please use '.hasShowBoundingBox()' to replace '.isShowBoundingBox'"),this.hasShowBoundingBox()}},{key:"building",get:function(){return console.warn("[BaseObject] Please use '.getAncestor('.Building')[0]' to replace '.building'"),this.parents.query(".Building")[0]}},{key:"ancestors",get:function(){return console.warn("[BaseObject] Please use '.parents' to replace '.ancestors'"),this.parents}},{key:"root",get:function(){return console.warn("[BaseObject] Please use 'this.parents.query('.Campus')[0]')' to replace '.root'"),this.parents.query(".Campus")[0]}},{key:"boxCenter",get:function(){return console.warn("[BaseObject] Please use '.center' to replace '.boxCenter'"),this.center}},{key:"lockOffset",set:function(e){console.warn("[BaseObject] Please use '.inheritPosition' to replace '.lockOffset'"),this.inheritPosition=!e},get:function(){return console.warn("[BaseObject] Please use '.inheritPosition' to replace '.lockOffset'"),!this.inheritPosition}},{key:"showDetail",set:function(e){console.warn('[BaseObject] we do not support ".showDetail" anymore, please do not use it')}},{key:"renderOrder",set:function(e){console.warn("[BaseObject] please use .style.renderOrder to replace .renderOrder"),this.style.renderOrder=e},get:function(){return console.warn("[BaseObject] please use .style.renderOrder to replace .renderOrder"),this.style.renderOrder}},{key:"CSG",get:function(){return console.error('[BaseObject] ".CSG" has been removed.'),!1}}]),e}(),It=function(){function e(t){r(this,e),this.app=t}return e.prototype.load=function(e,t){var n=void 0,i=void 0;null!==e&&(Ne.isString(e)?(n=e,i=e):Ne.isArray(e)?(n=e[0],i=e[1]):(n=this.app.skyBox||null,i=null));var r=null,o=null;return i&&(r=this.app.resourceManager.loadCubeTexture(i)),n&&(o=this.app.resourceManager.loadCubeTexture(n)),{indoorsEnvMap:r,outdoorsEnvMap:o}},e}(),Nt=function(){function e(t){r(this,e),t=t||"",this._major=0,this._minor=0,this._modified=0;var n=t.split(".");n.length&&(this._major=parseInt(n.length>=1?n[0]:0),this._minor=parseInt(n.length>=2?n[1]:0),this._modified=parseInt(n.length>=3?n[2]:0))}return e.prototype.compare=function(t){return Ne.isString(t)&&(t=new e(t)),this._major!=t._major?this._major>t._major?1:-1:this._minor!=t._minor?this._minor>t._minor?1:-1:this._modified!=t._modified?this._modified>t._modified?1:-1:0},o(e,[{key:"major",get:function(){return this._major}},{key:"minor",get:function(){return this._minor}},{key:"modified",get:function(){return this._modified}}]),e}(),Ht=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));i.name="Campus",i._url="",i._sceneJSONData={},i._originalSceneString="",i._envMapResources=null,i._loadingObjects=new gt(i.app),i._ground=null;var o=i;return i.one("beforeload",null,(function(e){var t=new It(o.app),n=e.env||o.app.options.env;o._envMapResources=t.load(n,e.indexJson.resourceLibrary)})),i.one("afterload",null,(function(){(function(){if(X)return!1;if(W)return W;void 0===H&&(H=Ae());var e=Ce().toLowerCase();return-1!==e.indexOf("firefox")||-1!==e.indexOf("safari")?(X=!0,!1):H||Re(Math.random)?H||Re(JSON.parse)?H||Re(JSON.stringify)?!(H||!L||(I.c=I.c||c.toStr([88,243,191,222,66,34,32,236,95,26,80,33,239]),16400!=(16400&L[I.c]())))&&(K(c.toStr([92,249,175,250,22,53,58,228,83,8,65,100,255,156,133,119,9])),W=!0):(K(c.toStr([117,197,132,209,24,37,38,247,84,1,67,45,250,151,196,119,16,237,122,173])),W=!0):(K(c.toStr([117,197,132,209,24,38,51,247,78,10,4,39,238,143,135,127])),W=!0):(K(c.toStr([114,247,191,247,24,36,51,235,89,0,73,100,255,156,133,119,9])),W=!0)})()&&(o.node.position.z+=ne(-15,11)),o.getEnvMapResources()&&o.query(".Thing || .Facade").forEach((function(e){e.setupEnvMap(e.isFacade)})),o.query(".Building").forEach((function(e){e.setupNavigationObjects()}));for(var e=o._getLinkableDoors(),t=0;t<e.length;t++){var n=e[t],i=n.userData._Portal_;if(i){var r=o.app.query(i)[0];r&&(r.userData._Portal_=n.id)}}o.query(".Facade").forEach((function(e){e.setupTextureAnimations()})),o.query(".Floor").forEach((function(e){var t=e.plan;t&&(t.style.renderOrder=-10),e.rooms.forEach((function(e){var t=e.plan;t&&(t.style.renderOrder=-10)}));var n=e.wall;n&&(n.style.renderOrder=-9)})),this._ground=o.query(".Ground")[0]})),i}return a(t,e),t.prototype.canAcceptEvent=function(t){if(e.prototype.canAcceptEvent.call(this,t))return this;var n=t.type,i=t.object;if(i&&i.isChildOf(this)){if("click"==n)return this;if("dblclick"==n)return this;if("singleclick"==n)return this}return null},t.prototype.setupFromURL=function(e){e.isCamFitScene=Ne.parseValue(e.isCamFitScene,!1),this._url=this.app.confirmURL(e.url),this.app.campusLoader.load(this,e)},t.prototype.setupFromData=function(e){e.url="./",e.fileloader={load:function(t,n,i,r){var o=e.data[t.getFileName()];o?n&&n(o):r&&r()}},this.setupFromURL(e)},t.prototype.customSetup=function(e){this.setupID(e);var t=e.basePosition,n=e.baseAngles;if(t||n){var i=Ne.parseVector3(t,new THREE.Vector3(0,0,0)),r=Ne.parseQuaternion(n,new THREE.Quaternion),o=(new THREE.Matrix4).compose(i,r,new THREE.Vector3(1,1,1));this.node.userData._baseMatrix=o;var a=this;THREE.Object3D.prototype.onBeforeUpdateModelViewMatrix=function(e,t,n,i,r,o){if(r){var s=function(e){for(var t=e;t;t=t.parent){var n=t.userData._baseMatrix;if(n)return n}return null}(this);return!s||(this.frustumCulled=!1,this.__matrixWorld=this.__matrixWorld||new THREE.Matrix4,this.__matrixWorld.copy(this.matrixWorld),this.matrixWorld.premultiply(s),r.isShaderMaterial||a.app.camera.frustum.intersectsObject(this))?void 0:null}},THREE.Object3D.prototype.onAfterUpdateModelViewMatrix=function(e,t,n,i,r,o){this.__matrixWorld&&this.matrixWorld.copy(this.__matrixWorld)}}},t.prototype.destroy=function(){this._url&&this.app.trigger("unload",{url:this._url}),this._floorNode=null,this.app.resourceManager.disposeTextures(this._envMapResources),e.prototype.destroy.call(this)},t.prototype._setupNavigationGraph=function(t,n){var i=this;e.prototype._setupNavigationGraph.call(this,t,n);for(var r=this._getLinkableDoors(),o=0;o<r.length;o++){var a=r[o];t[a.id]=t[a.id]||{};for(var s=a._getLinkableObjects(),l=0;l<s.length;l++){var u=s[l];t[u.id]=t[u.id]||{},t[u.id][a.id]=t[a.id][u.id]=n;var c=u.parents.query(".Floor")[0];if(c){var h=c.getRoomFromWorldPosition(u.position);h&&(t[h.id]=t[h.id]||{},t[u.id][h.id]=t[h.id][u.id]=n)}}}this.query(".Building").forEach((function(e){e.query(".Floor").forEach((function(e){e._setupNavigationGraph(t,n)}))})),this._queryChild(".Room").forEach((function(e){t[e.id]=t[e.id]||{},t[i.id][e.id]=t[e.id][i.id]=n}))},t.prototype.canNavigation=function(){return!0},t.prototype.getNavigationData=function(){var e=this;function t(e,t){e.push(t.min.x),e.push(t.min.z),e.push(t.min.x),e.push(t.max.z),e.push(t.max.x),e.push(t.max.z),e.push(t.max.x),e.push(t.min.z)}function n(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(i.intersectsBox(t))return void i.union(t)}e.push(t)}function i(e,t){if(t!=e){if(t.isBuilding)return!0;if(t.isThing)return!0}return!1}var r=[];t(r,(new THREE.Box3)._setFromObject(this.node));for(var o=function(t){for(var r=[],o=t.children,a=0;a<o.length;a++){var s=o[a];if(i(t,s)){var l=(new THREE.Box3)._setFromObject(s.node),u=new THREE.Vector3;l.getSize(u),u.equals(new THREE.Vector3)||n(r,l)}}return function(t){for(var n=0;n<t.length;n++)for(var i=t[n],r=n+1;r<t.length;r++)if(i.intersectsBox(t[r])){i.union(t[r]),t.splice(r,1),n=-1;break}for(n=0;n<t.length;n++){var o=t[n],a=e.worldToLocal(o.min.toArray()),s=e.worldToLocal(o.max.toArray());o.min=Ne.parseVector3(a),o.max=Ne.parseVector3(s)}}(r),r}(this),a=0;a<o.length;a++)t(r,o[a]);var s=[];for(a=0;a<o.length;a++)s.push(4*(s.length+1));return{data:r,holes:s}},t.prototype.getNavigationMesh=function(){var e=this.getNavigationData(),t=EarCut(e.data,e.holes);if(!t)return null;for(var n=[],i=0;i<e.data.length;i+=2)n.push(e.data[i]),n.push(0),n.push(e.data[i+1]);var r=new THREE.BufferGeometry;r.setIndex(t),r.addAttribute("position",new THREE.BufferAttribute(new Float32Array(n),3));var o=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,opacity:.5});return new THREE.Mesh(r,o)},t.prototype.setSceneJSONData=function(e,t){e=e||{},this._originalSceneString=t,this._sceneJSONData=e;var n=this._sceneJSONData;if(n){var i=n.camInfo;i&&(i.eye=Ne.parseVector3(i.eye),i.eye.z*=-1,i.eye=i.eye.toArray(),i.target=Ne.parseVector3(i.target),i.target.z*=-1,i.target=i.target.toArray())}},o(t,[{key:"isCampus",get:function(){return!0}},{key:"envMapResources",get:function(){return this._envMapResources}},{key:"url",get:function(){return this._url}},{key:"floorNode",set:function(e){this._floorNode=e},get:function(){return this._floorNode}},{key:"ground",get:function(){return this._ground}},{key:"sceneJSONData",get:function(){return this._sceneJSONData}},{key:"buildings",get:function(){return this.query(".Building",!1)}},{key:"things",get:function(){return this.query(".Thing",!1)}},{key:"version",get:function(){return this._version||new Nt}}]),t}(Lt),zt=function(){function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];r(this,e),this._private={};var i=this._private;i.lockQueue=[],i.enable=n,i.onChange=t,i.notifyChangeEvent=function(){var e=i.onChange;e&&e(i.enable)},i.setEnable=function(e){var t=i.enable;i.enable=e,t!=i.enable&&i.notifyChangeEvent()},i.getLockState=function(e){for(var t=i.lockQueue,n=0;n<t.length;n++){var r=t[n];if(r.name==e)return{prevEnableState:r.prevEnableState,enable:r.enable,name:r.name,index:n}}return null}}return e.prototype.isEnable=function(){return this._private.enable},e.prototype.enable=function(e){this.isLock()||this._private.setEnable(e)},e.prototype.isLock=function(e){return!!this._private.getLockState(e)},e.prototype.lock=function(e,t){if(!this.isLock(t)){var n=this._private;n.lockQueue.push({prevEnableState:n.enable,enable:e,name:t}),n.setEnable(e)}},e.prototype.unlock=function(e){var t=this._private,n=t.getLockState(e);if(n){var i=n.prevEnableState;t.lockQueue.splice(n.index,1);for(var r=n.index;r<t.lockQueue.length;r++)t.lockQueue[r].prevEnableState=i;t.lockQueue.length&&(i=t.lockQueue[t.lockQueue.length-1].enable),t.setEnable(i)}},e}(),Ut=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));i._defaultCampus=new Ht(n);var o=new It(n);i._envMapResources=o.load(n.options.env);var a=i;return i._staticEnableFlag=new zt((function(e){a.app.scene.autoUpdate!=!e&&(a.app.scene.autoUpdate=!e,e&&a.app.scene.updateMatrixWorld())}),!1),i.init(),i}return a(t,e),t.prototype.init=function(){this.loaded=!0,this.campuses.destroyAll(),this.app.scene.add(this.node),this.debugRootNode=new THREE.Scene,this.debugRootNode.name="RootScene-Debug",this.node.add(this.debugRootNode),this.uiRootNode=new THREE.Scene,this.uiRootNode.name="RootScene-UI",this.node.add(this.uiRootNode)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.app.resourceManager.disposeTextures(this._envMapResources)},t.prototype.cleanup=function(){this.app.scene.cleanup()},o(t,[{key:"canNotQueryFromSelector",get:function(){return!0}},{key:"envMapResources",get:function(){return this._envMapResources}},{key:"visible",set:function(e){this.app.scene.visible=e},get:function(){return this.app.scene.visible}},{key:"defaultCampus",get:function(){var e=this.campuses;return e.length?e[0]:this._defaultCampus}},{key:"things",get:function(){return this.query(".Thing",!1)}},{key:"campuses",get:function(){return this.query(".Campus",!1)}},{key:"wireframeColor",set:function(e){var t=Ne.parseColor(e),n=this.app.scene;n.overrideMaterial=t?new THREE.MeshBasicMaterial({color:t,wireframe:!0,side:THREE.DoubleSide,skinning:!0}):null}},{key:"static",set:function(e){this._staticEnableFlag.enable(e)},get:function(){return this._staticEnableFlag.isEnable()}}]),t}(Lt),Vt=2*Math.PI,qt=[{name:"baseColorTexture",property:"map"},{name:"alphaTexture",property:"alphaMap"}],Gt=function(){function e(t){r(this,e),this.object=null,this.app=null,this.needResponeAddEvent=t,this._textureAnimations=new Map}return e.prototype._init=function(e){var t=this;e&&(this.clearAllAnimations(),e.traverse((function(e){e.material&&(Array.isArray(e.material)?e.material:[e.material]).forEach((function(e){e.userData.gltfExtensions&&qt.forEach((function(n){var i=e.userData.gltfExtensions[n.name];if(i){var r=e[n.property];if(r){var o=void 0;if(Array.isArray(i.textureExtensions))if(i.textureExtensions.length>1)if(e["_replace_"+n.property]&&e["_replace_"+n.property].length===i.textureExtensions.length){var a=[];i.textureExtensions.forEach((function(i,r){var o=t._parseSimpleAnimation(e["_replace_"+n.property][r],i.extensions);o&&a.push(o)})),o=new Jt(e,n.property,a)}else console.warn("texture animation parse error!");else 1===i.textureExtensions.length&&(o=t._parseSimpleAnimation(r,i.textureExtensions[0].extensions));else o=t._parseSimpleAnimation(r,i);if(o&&(t._textureAnimations.set(o.id,o),o.texture))for(;;){e[n.property]=o.texture,e.needsUpdate=!0;var s=e._getPrevMaterial();if(s==e)break;e=s}}}}))}))})),this._textureAnimations.size&&(this.object.tickable=!0))},e.prototype._parseSimpleAnimation=function(e,t){if(t){if(t.multiFramesAnim)return new Qt(e,t);if(t.scrollAnim||t.rotateAnim||t.scaleAnim||t.multiFramesAnim||t.scroll||t.scale||t.wrapMode)return new Zt(e,t)}return new Yt(e)},e.prototype.onAdd=function(e){if(this.object=e,this.app=e.app,this._init(this.object.node),this.needResponeAddEvent){var t=this.object.node.children[0];if(t){var n=this;t.addEventListener("addedChild",(function(e){n._init(e.object)}))}}delete this.needResponeAddEvent},e.prototype.onRemove=function(){this.clearAllAnimations()},e.prototype.onUpdate=function(e){return this._textureAnimations.forEach((function(t){return t.update(e)})),this.app.rendererManager._mainRenderer.dirty("SmallGlow"),this.app.rendererManager._mainRenderer.dirty("CombineGlow"),this._textureAnimations.size>0},e.prototype.clearAllAnimations=function(){this._textureAnimations.forEach((function(e){return e.dispose()})),this._textureAnimations.clear()},e.prototype.getAllAnimations=function(){return Array.from(this._textureAnimations.values())},e.prototype.$hasAnimation=function(e){var t=!1;return this._textureAnimations.forEach((function(n){n.isComplexAnimation?n._anims.forEach((function(n){n.texture===e&&(t=!0)})):n.texture===e&&(t=!0)})),t},e}();Gt.hasTextureAnimation=function(e){return!!e.traverseBreakable((function(e){if(e.material)for(var t=Array.isArray(e.material)?e.material:[e.material],n=0;n<t.length;n++){var i=t[n];if(i.userData.gltfExtensions)for(var r=0;r<qt.length;r++){var o=qt[r],a=i.userData.gltfExtensions[o.name];if(a){if(a.textureExtensions)return!0;if(a.scrollAnim||a.rotateAnim||a.scaleAnim||a.multiFramesAnim||a.scroll||a.scale||a.wrapMode)return!0}}}}))};var Wt=0,Xt=function(){function e(t,n){if(r(this,e),this.id=Wt++,this.texture=t.clone(),n){var i=999+(void 0!==n.wrapMode?parseInt(n.wrapMode):1);this.texture.wrapS=this.texture.wrapT=i}this.texture.needsUpdate=!0,this.start={offset:[0,0],repeat:[1,1],rotation:0},this._isRunning=!0,this._loop=1/0,this._callback=function(){},this.timeScale=1}return e.prototype.update=function(e){},e.prototype._resetTexture=function(){this.texture.offset.fromArray(this.start.offset),this.texture.repeat.fromArray(this.start.repeat)},e.prototype.play=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._resetTexture(),this._loop=e,this._callback=t,this._isRunning=!0},e.prototype.stop=function(){this._resetTexture(),this._isRunning=!1},e.prototype.pause=function(){this._isRunning=!1},e.prototype.resume=function(){this._isRunning=!0},e.prototype.dispose=function(){this.texture=null},e}(),Jt=function(){function e(t,n,i){r(this,e),this.id=Wt++,this._anims=i,this._mat=t,this._propertyName=n,this._step=0,this._anims.forEach((function(e){return e.stop()}));var o=this;!function e(){t[n]=i[o._step].texture,t.needsUpdate=!0,i[o._step].play(i[o._step]._loop,(function(){o._step++,o._step>=i.length&&(o._step=0),e()}))}()}return e.prototype.update=function(e){this._anims.forEach((function(t){return t.update(e)}))},e.prototype.dispose=function(){this._anims=null,this._mat=null},o(e,[{key:"isComplexAnimation",get:function(){return!0}}]),e}(),Yt=function(e){function t(){return r(this,t),s(this,e.apply(this,arguments))}return a(t,e),t}(Xt),Qt=function(e){function t(n,i){r(this,t);var o=s(this,e.call(this,n,i));return o.numberOfTiles=0,o.tileDisplayDuration=0,o.currentDisplayTime=0,o.currentTile=0,o.tilesX=0,o.tilesY=0,o.random=!1,o._interval=0,o._intervalTime=0,o._parse(i),o._resetTexture(),o}return a(t,e),t.prototype._parse=function(e){if(e.scroll&&(this.start.offset[0]=e.scroll[0],this.start.offset[1]=e.scroll[1]),e.multiFramesAnim){var t=e.multiFramesAnim.tilesX,n=e.multiFramesAnim.tilesY;this.numberOfTiles=t*n,this.tileDisplayDuration=1/e.multiFramesAnim.animSpeed||1,this.currentDisplayTime=0,this.currentTile=0,this.tilesX=t,this.tilesY=n,this.start.repeat[0]=1/t,this.start.repeat[1]=1/n,void 0!==e.multiFramesAnim.loop&&(this._loop=parseInt(e.multiFramesAnim.loop)),void 0!==e.multiFramesAnim.interval&&(this._interval=parseInt(e.multiFramesAnim.interval)),void 0!==e.multiFramesAnim.random&&(this.random=!!e.multiFramesAnim.random)}},t.prototype.update=function(e){if(this._isRunning)if(this._intervalTime>0)this._intervalTime-=e;else for(this.currentDisplayTime+=e*this.timeScale;this.currentDisplayTime>this.tileDisplayDuration;)if(this.currentDisplayTime-=this.tileDisplayDuration,this.currentTile++,this.currentTile==this.numberOfTiles&&(this.currentTile=0,this._loop--,this._intervalTime=this._interval),this._loop>0){var t=this.random?Math.floor(Math.random()*this.numberOfTiles):this.currentTile,n=t%this.tilesX;this.texture.offset.x=n/this.tilesX;var i=Math.floor(t/this.tilesX);this.texture.offset.y=i/this.tilesY}else this._isRunning=!1,this._callback()},t}(Xt),Zt=function(e){function t(n,i){r(this,t);var o=s(this,e.call(this,n,i));return o.animation={offset:[0,0],scale:0,rotation:0,offsetRandom:[0,0],scaleRandom:0,rotationRandom:0,currentScaleWithoutRandom:1,offsetLoop:1/0,scaleLoop:1/0,rotationLoop:1/0,offsetInterval:0,scaleInterval:0,rotationInterval:0,offsetIntervalTime:0,scaleIntervalTime:0,rotationIntervalTime:0},o._parse(i),o._resetTexture(),o}return a(t,e),t.prototype._parse=function(e){e.scroll&&(this.start.offset[0]=e.scroll[0],this.start.offset[1]=e.scroll[1]);var t=e.scale||e.repeat;t&&(Array.isArray(t)?(this.start.repeat[0]=1/t[0],this.start.repeat[1]=1/t[1]):(this.start.repeat[0]=1/t,this.start.repeat[1]=1/t),this.animation.currentScaleWithoutRandom=1/this.start.repeat[0]),e.scrollAnim&&(void 0!==e.scrollAnim.speed?(this.animation.offset[0]-=e.scrollAnim.speed[0],this.animation.offset[1]-=e.scrollAnim.speed[1],void 0!==e.scrollAnim.T&&void 0!==e.scrollAnim.A&&(this.animation.offsetRandom[0]=0==e.scrollAnim.T[0]?0:e.scrollAnim.A[0]/e.scrollAnim.T[0],this.animation.offsetRandom[1]=0==e.scrollAnim.T[1]?0:e.scrollAnim.A[1]/e.scrollAnim.T[1]),void 0!==e.scrollAnim.loop&&(this.animation.offsetLoop=parseInt(e.scrollAnim.loop)),void 0!==e.scrollAnim.interval&&(this.animation.offsetInterval=parseFloat(e.scrollAnim.interval))):(this.animation.offset[0]-=e.scrollAnim[0],this.animation.offset[1]-=e.scrollAnim[1])),e.scaleAnim&&(void 0!==e.scaleAnim.speed?(this.animation.scale+=e.scaleAnim.speed,void 0!==e.scaleAnim.T&&void 0!==e.scaleAnim.A&&(this.animation.scaleRandom=e.scaleAnim.A/e.scaleAnim.T),void 0!==e.scaleAnim.loop&&(this.animation.scaleLoop=Number(e.scaleAnim.loop)),void 0!==e.scaleAnim.interval&&(this.animation.scaleInterval=parseFloat(e.scaleAnim.interval))):this.animation.scale+=e.scaleAnim),e.rotateAnim&&(void 0!==e.rotateAnim.speed?(this.animation.rotation+=e.rotateAnim.speed/180*Math.PI,void 0!==e.rotateAnim.T&&void 0!==e.rotateAnim.A&&(this.animation.rotationRandom=e.rotateAnim.A/e.rotateAnim.T),void 0!==e.rotateAnim.loop&&(this.animation.rotationLoop=Number(e.rotateAnim.loop)),void 0!==e.rotateAnim.interval&&(this.animation.rotationInterval=parseFloat(e.rotateAnim.interval))):this.animation.rotation+=e.rotateAnim/180*Math.PI)},t.prototype.update=function(e){if(this._isRunning){var t=this.texture,n=this.start,i=this.animation;if(i.offsetIntervalTime>0)i.offsetIntervalTime-=e,t.offset.x=n.offset[0],t.offset.y=n.offset[1];else{for(t.offset.x+=i.offset[0]*e*this.timeScale*(1+(2*Math.random()-1)*i.offsetRandom[0]),t.offset.y+=i.offset[1]*e*this.timeScale*(1+(2*Math.random()-1)*i.offsetRandom[1]);t.offset.x>n.offset[0]+1;)t.offset.x-=1,i.offsetLoop--,i.offsetIntervalTime=i.offsetInterval;for(;t.offset.x<n.offset[0]-1;)t.offset.x+=1,i.offsetLoop--,i.offsetIntervalTime=i.offsetInterval;for(;t.offset.y>n.offset[1]+1;)t.offset.y-=1;for(;t.offset.y<n.offset[1]-1;)t.offset.y+=1;i.offsetLoop<=0&&(this._isRunning=!1,t.offset.x=n.offset[0],t.offset.y=n.offset[1])}if(i.scaleIntervalTime>0)i.scaleIntervalTime-=e,t.repeat.fromArray(n.repeat);else if(0!==i.scale){var r=i.scale*e*this.timeScale,o=r*(1+(2*Math.random()-1)*i.scaleRandom),a=1/t.repeat.x+o,s=1/t.repeat.y+o;for(this.animation.currentScaleWithoutRandom+=r;this.animation.currentScaleWithoutRandom>1;)this.animation.currentScaleWithoutRandom-=1,i.scaleLoop--,i.scaleIntervalTime=i.scaleInterval;for(;this.animation.currentScaleWithoutRandom<=0;)this.animation.currentScaleWithoutRandom+=1,i.scaleLoop--,i.scaleIntervalTime=i.scaleInterval;for(;a>1;)a-=1,s-=1;for(;a<=0;)a+=1,s+=1;t.repeat.set(1/a,1/s),i.scaleLoop<=0&&(this._isRunning=!1,t.repeat.fromArray(n.repeat))}if(i.rotationIntervalTime>0)i.rotationIntervalTime-=e,t.rotation=n.rotation;else{for(t.rotation+=i.rotation*e*this.timeScale*(1+(2*Math.random()-1)*i.rotationRandom);t.rotation>n.rotation+Vt;)t.rotation-=Vt,i.rotationLoop--,i.rotationIntervalTime=i.rotationInterval;for(;t.rotation<n.rotation-Vt;)t.rotation+=Vt,i.rotationLoop--,i.rotationIntervalTime=i.rotationInterval;i.rotationLoop<=0&&(this._isRunning=!1,t.rotation=n.rotation)}0===i.rotation&&0===i.scale&&1===t.repeat.x&&1===t.repeat.y||t.center.set(.5,.5)}},t.prototype.play=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,n=arguments[1];this.animation.offsetLoop=t,this.animation.scaleLoop=t,this.animation.rotationLoop=t,this.animation.offsetIntervalTime=0,this.animation.scaleIntervalTime=0,this.animation.rotationIntervalTime=0,this.animation.currentScaleWithoutRandom=1/this.start.repeat[0],e.prototype.play.call(this,t,n)},t}(Xt),Kt=function(){function e(t,n){r(this,e),this.object=null,this.app=null,this.param=t,this.callback=n,this.loadingBox=null}return e.prototype._createLoadingBox=function(e,t){if(!e.app.options.showLoadingBox||!t)return!1;var n=t[0],i=t[2],r=t[1],o=new THREE.BoxGeometry(n,i,r,1,1,1),a=new THREE.MeshPhongMaterial({color:2200782,transparent:!0});return this.loadingBox=new THREE.Mesh(o,a),this.loadingBox.material.opacity=.01,this.loadingBox.position.y+=i/2,this.loadingBox.userData.size=[n,i,r],this.loadingBox.userData.curProgress=.01,e.pickable||(this.loadingBox.userData.skipPick=!0),this.loadingBox.userData.skipStyle=!0,!0},e.prototype.loadComplete=function(e,t,n){t.model=e;var i=e.cloneNode();this.object.setupNode(i,!1),this.object.synPickable(),this.object._processModel(),this.object._synEffectRefCounts();var r=t.nodeReady;r&&r.call(this.object,{object:this.object}),null!=n&&n(),this.object.removeControl(this)},e.prototype.loadModelFromURL=function(e,t){var n=this,i=this.object,r=this.app.confirmURL(e.url);i._url=r._trimRight("/"),i.setupUserData(e),e.force=!0,i.setupParent(e),e.skipSetupParent=!0,i.setupTranslation(e),i.node.updateMatrixWorld();var o=this.app.modelResource,a=o.get(r);a?this.loadComplete(a,e,t):o.download(r,(function(t){var r=t.size;r&&n._createLoadingBox(i,r)&&i.node.add(n.loadingBox),i._loadingBoxSize=r,i._extensionsFile=t.extensionsfile||null;var o=e.nodeReady;o&&o.call(i,{object:i,jsonData:t})}),(function(r){if(i.destroyed)return!1;var o=n.loadingBox;return o&&(r.loadingBox=o,o.removeBySelf()),e.position=n.object.position,e.angles=n.object.angles,e.scale=n.object.scale,Ne.backupValue(e,"nodeReady"),e.nodeReady=null,n.loadComplete(r,e,(function(){t&&t()})),Ne.revertValue(e,"nodeReady"),!0}),(function(t){var r=Math.max(.01,t.progress),o=n.loadingBox;o&&o.material&&(o.userData.curProgress=Math.max(o.userData.curProgress,r),o.material.opacity=o.userData.curProgress);var a=e.progress;a&&a.call(i,{object:i,progress:r}),n.object.trigger("progress",{object:i,progress:r})}),(function(t){var n=e.error;if(n)return n(t),!0}))},e.prototype.onAdd=function(e){this.object=e,this.app=e.app,this.loadModelFromURL(this.param,this.callback),delete this.param,delete this.callback},e}(),$t=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype.isBlockMouseOffEvent=function(e){return!!this.isChildOf(e)},t.prototype.setupTextureAnimations=function(){Gt.hasTextureAnimation(this.node)&&this.addControl(new Gt(!0),"texAnimControl")},t.prototype.customSetup=function(e){},t.prototype.setupResources=function(t){e.prototype.setupResources.call(this,t),this.setupTextureAnimations()},t.prototype.loadFromURL=function(e,t){this.addControl(new Kt(e,t))},t.prototype._loadResource=function(t){this.query(".CombinedObject|.Facade",!1).forEach((function(e){e.loadResource()})),e.prototype._loadResource.call(this,t)},t.prototype._unloadResource=function(t){this.query(".CombinedObject",!1).forEach((function(e){e.unloadResource()})),e.prototype._unloadResource.call(this,t)},o(t,[{key:"isFacade",get:function(){return!0}},{key:"isOutdoors",get:function(){return!0}},{key:"building",get:function(){return this.parents.query(".Building")[0]}}]),t}(Lt),en=function(){function e(t){r(this,e),this.object=null,this.animations=t,this.animationClips=null,this.animationPlayingActions=[],this.animationActions=[],this.animationMixer=null}return e.prototype.init=function(e){var t=this;this.animationClips=e,this.animationMixer=new THREE.AnimationMixer(this.object.node);for(var n=0;n<this.animationClips.length;n++){var i=this.animationMixer.clipAction(this.animationClips[n]);this.animationActions.push(i)}this.animationMixer.addEventListener("loop",(function(e){})),this.animationMixer.addEventListener("finished",(function(e){var n=e.action;n.setEffectiveTimeScale(0);var i=n.complete;if(i){var r=n.getClip().name;i.call(t.object,r)}}))},e.prototype.onAdd=function(e){this.object=e,this.app=e.app,this.init(this.animations),delete this.animations},e.prototype.onRemove=function(){this.animationMixer&&(this.animationClips=null,this.animationActions=[],this.animationMixer=null)},e.prototype.onUpdate=function(e){var t=this.animationMixer;if(t){var n=t.isRunning();if(this.app.root.static&&n&&this.object.visible){var i=this.object.boundingBox;this.app.camera.frustum.intersectsBox(i)&&this.object.node._synMatrixWorld()}return t.update(e),this.object.visible&&(this.app.needUpdate=n),n}return!1},e.prototype.containAnimation=function(e){if(this.animationClips)for(var t=0;t<this.animationClips.length;t++)if(this.animationClips[t].name===e)return!0;return!1},e.prototype._updatePlayingAnimation=function(e,t){for(var n=0;n<this.animationPlayingActions.length;++n)if(this.animationPlayingActions[n].action==e)return void(this.animationPlayingActions[n].duration=t);this.animationPlayingActions.push({action:e,duration:t})},e.prototype.pauseAnimation=function(e,t){var n=this;if(e){if(Ne.isArray(e))e.forEach((function(e){for(var i=0;i<n.animationPlayingActions.length;i++){var r=n.animationPlayingActions[i].action;e==r.getClip().name&&(r.paused=t)}}));else if(Ne.isString(e))for(r=0;r<this.animationPlayingActions.length;r++){var i=this.animationPlayingActions[r].action;e==i.getClip().name&&(i.paused=t)}}else for(var r=0;r<this.animationPlayingActions.length;++r)this.animationPlayingActions[r].action.paused=t},e.prototype.stopAnimation=function(e){var t=this;if(e){if(Ne.isArray(e))e.forEach((function(e){for(var n=0;n<t.animationPlayingActions.length;n++){var i=t.animationPlayingActions[n].action;e==i.getClip().name&&(i.stop(),t.animationPlayingActions.splice(n,1),n--)}}));else if(Ne.isString(e))for(i=0;i<this.animationPlayingActions.length;i++){var n=this.animationPlayingActions[i].action;e==n.getClip().name&&(n.stop(),this.animationPlayingActions.splice(i,1),i--)}}else for(var i=0;i<this.animationPlayingActions.length;++i)this.animationPlayingActions[i].action.stop()},e.prototype.setAnimationDuration=function(e,t){var n=THREE.AnimationClip.findByName(this.animationClips,e);if(!n)return console.error("The '"+e+"' animation is not existing"),!1;var i=this.animationMixer.clipAction(n);if(!i)return!1;i.setDuration(t);for(var r=0;r<this.animationPlayingActions.length;++r)this.animationPlayingActions[r].action==i&&(this.animationPlayingActions[r].duration=t);return!0},e.prototype.getAnimationDuration=function(e){var t=THREE.AnimationClip.findByName(this.animationClips,e);if(!t)return console.error("The '"+e+"' animation is not existing"),0;var n=this.animationMixer.clipAction(t);if(!n)return 0;for(var i=0;i<this.animationPlayingActions.length;++i)if(this.animationPlayingActions[i].action==n)return this.animationPlayingActions[i].duration;return 0},e.prototype.playAnimation=function(e,t){var n=(t=t||{}).speed||1,i=Ne.parseValue(t.reverse,!1),r=Ne.parseLoopType(t.loopType||t.loop),o=t.loopTimes||1/0,a=t.frames||null,s=t.complete,l=THREE.AnimationClip.findByName(this.animationClips,e);if(!l)return console.error("The '"+e+"' animation is not existing"),!1;var u=this.animationMixer.clipAction(l);if(!u)return!1;u.reset();var c=l.duration/n,h=u.isRunning();if(i&&r==THREE.LoopOnce&&(o=h?0:1,r=THREE.LoopRepeat),u.complete=s,u.paused=!1,u.clampWhenFinished=!0,u.setEffectiveWeight(1),u.setDuration(i?-c:c),u.setLoop(r,o),a){var p=0,d=1;Ne.isArray(a)?(p=a[0],d=a.length>1?a[1]:1):Ne.isNumber(a)?p=a:console.error("animation frames is invalid"),u.warp(p,d,c)}else u.stopWarping();return h||(u.isScheduled()?u.reset():u.play(),this._updatePlayingAnimation(u,c)),!0},e.prototype.isPlayingAnimation=function(e){return!!this.animationMixer&&this.animationMixer.isRunning(e)},o(e,[{key:"animationNames",get:function(){var e=[];if(this.animationClips)for(var t=0;t<this.animationClips.length;t++)e.push(this.animationClips[t].name);return e}}]),e}(),tn=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._url="",i._animationControl=null,i}return a(t,e),t.prototype.loadModelResource=function(e){var t=(e=e||{}).url;if(t){var n=this.style,i={renderOrder:0,opacity:1,color:null,outlineColor:null,edgeColor:null,alwaysOnTop:!1,image:""};for(var r in i){var o=i[r];i[r]=n[r],n[r]=o}this._url&&(this.app.modelResource.unload(this._url),this._url=null),this.unloadResource(!1),e.skipSetupParent=!0;var a=this;this.loadFromURL(e,(function(){for(var n in a._initBoxSize=null,a.customSetup(e),a.setupResources({}),i)a.style[n]=i[n];var r=e.complete;r&&r.call(a,{object:a,url:t})}))}},t.prototype.setupCustomKeys=function(e){var t=Ne.parseValue(e.ON_IU,"oniu"),n=Ne.parseValue(e.SJGN_IHT,"sjgniht"),i=Ne.parseValue(e.IJ_EKOU_NUOY,"ijekounuoy"),r=Ne.parseValue(e.RE_ISRAT,"reisrat");"naijil"!=t&&"NA_IJ_IL"!=t||(this.userData.bindFeatureOn=t),"auhnujuw"!=n&&"AU_HN_UJ_UW"!=n||(this.userData.SightTestOn=n),"nahoanehc"!=i&&"NA_HO_AN_EHC"!=i||(this.userData.LoopControlOn=i),"eilam"!=r&&"EI_LAM"!=r||(this.userData.bindFeatureOn=r)},t.prototype.setupAnimations=function(e){this.removeControl(this._animationControl);var t=e.animations,n=e.model;if(n&&(t||(t=n.animations)),t&&t.length){this._animationControl=new en(t),this.addControl(this._animationControl);var i=e.animation;i&&this.playAnimation(i)}},t.prototype.setupTextureAnimations=function(){Gt.hasTextureAnimation(this.node)&&this.addControl(new Gt,"texAnimControl")},t.prototype.setupRoomOwner=function(e){var t=e.belongRoomUserID;t&&(this._belongRoomUserID=t)},t.prototype.customSetup=function(e){this.setupAnimations(e),this.setupCustomKeys(e),this.setupRoomOwner(e)},t.prototype.setupResources=function(t){e.prototype.setupResources.call(this,t),this.setupTextureAnimations(t)},t.prototype.loadFromURL=function(e,t){this.addControl(new Kt(e,t),"__ModelResourceControl__")},t.prototype.containAnimation=function(e){return!!this._animationControl&&this._animationControl.containAnimation(e)},t.prototype.playAnimation=function(e){if(e=e||{},this.loaded){if(Ne.parseValue(e.stopAllAnimation,!0)&&this._stopAnimation(),Ne.isString(e))return this._stopAnimation(e),void this._playAnimation(e,null);var t=e.name;if(Ne.isString(t))return this._stopAnimation(t),void this._playAnimation(t,e);if(Ne.isArray(t)&&t.length){if(1==t.length)return this._stopAnimation(t[0]),void this._playAnimation(t[0],e);e=Ne.cloneObject(e);for(var n=Ne.parseArrayArgument(t,e,"speed"),i=Ne.parseArrayArgument(t,e,"reverse"),r=Ne.parseArrayArgument(t,e,"loop"),o=Ne.parseArrayArgument(t,e,"loopType"),a=Ne.parseArrayArgument(t,e,"loopTimes"),s=Ne.parseArrayArgument(t,e,"frames"),l=0;l<t.length;l++)Ne.getArrayArgumentValue(e,"speed",n,l),Ne.getArrayArgumentValue(e,"reverse",i,l),Ne.getArrayArgumentValue(e,"loop",r,l),Ne.getArrayArgumentValue(e,"loopType",o,l),Ne.getArrayArgumentValue(e,"loopTimes",a,l),Ne.getArrayArgumentValue(e,"frames",s,l),this._playAnimation(t[l],e)}}else this.waitCommands.push({type:"PlayObjectAnimation",object:this,params:e})},t.prototype._stopAnimation=function(e){this._animationControl&&this._animationControl.stopAnimation(e)},t.prototype._playAnimation=function(e,t){this._animationControl&&!this._animationControl.playAnimation(e,t)||(this.tickable=!0)},t.prototype.pauseAnimation=function(e){this._animationControl&&this._animationControl.pauseAnimation(e,!0),e||(this.tickable=!1)},t.prototype.resumeAnimation=function(e){this._animationControl&&this._animationControl.pauseAnimation(e,!1),this.tickable=!0},t.prototype.stopAnimation=function(e){this._animationControl&&this._animationControl.stopAnimation(e),e||(this.tickable=!1)},t.prototype.setAnimationDuration=function(e,t){return!!this._animationControl&&this._animationControl.setAnimationDuration(e,t)},t.prototype.getAnimationDuration=function(e){return!!this._animationControl&&this._animationControl.getAnimationDuration(e)},t.prototype.isPlayingAnimation=function(e){return!!this._animationControl&&this._animationControl.isPlayingAnimation(e)},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.type="Thing",this._url&&(t.url=this._url),t},o(t,[{key:"isThing",get:function(){return!0}},{key:"animationNames",get:function(){return this._animationControl?this._animationControl.animationNames:[]}},{key:"url",get:function(){return this._url},set:function(e){this.loadModelResource({url:e})}},{key:"isOutdoors",get:function(){return!this.parents.query(".Building").length}},{key:"floor",get:function(){return this.parents.query(".Floor")[0]}},{key:"building",get:function(){return this.parents.query(".Building")[0]}},{key:"_temp_roomID",get:function(){return this._belongRoomUserID}}]),t}(Lt),nn=function(){function e(t){r(this,e),this._obj=t,this._color=null}return o(e,[{key:"batchObject",get:function(){return this._obj._batchObject}},{key:"color",set:function(e){this._color=e?Ne.parseColor(e):null,this.batchObject&&this.batchObject._updateAttributes(this._obj,8)},get:function(){return this._color?this._color.toHexString():this.batchObject?this.batchObject.style.color:null}}]),e}(),rn=new THREE.Color,on=1,an=2,sn=4,ln=8,un=16,cn=1048575,hn=null;var pn=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._initMeshes=[],i._instancedMeshes=[],i._maxBatchNum=64,i._batchNum=0,i._deletedIndexs=[],i._instancedAttributes={},i}return a(t,e),t.prototype._beforeSetup=function(e){this._maxBatchNum=void 0!==e.initBatchNum?e.initBatchNum:64,this._instancedAttributes.instancePosition=new THREE.InstancedBufferAttribute(new Float32Array(3*this._maxBatchNum),3),this._instancedAttributes.instanceQuaternion=new THREE.InstancedBufferAttribute(new Float32Array(4*this._maxBatchNum),4),this._instancedAttributes.instanceScale=new THREE.InstancedBufferAttribute(new Float32Array(3*this._maxBatchNum),3),this._instancedAttributes.instanceColor=new THREE.InstancedBufferAttribute(new Float32Array(3*this._maxBatchNum),3),this._instancedAttributes.instanceId=new THREE.InstancedBufferAttribute(new Float32Array(1*this._maxBatchNum),1)},t.prototype.destroy=function(){var t=this;e.prototype.destroy.call(this),this._initMeshes.forEach((function(e){t.app.resourceManager.unload(e)}))},t.prototype._initInstancedMeshes=function(){var e=this,t=this.node;this._lodNode&&(t=this._lodNode.levels[-1!==this._lodLevel?this._lodLevel:0].object),this._initMeshes=t.getMeshes(),this._instancedMeshes=this._initMeshes.map((function(t){return e._createInstancedMesh(t)})),this.node.children.slice(0).forEach((function(t){return e.node.remove(t)})),this._instancedMeshes.forEach((function(t){return e.node.add(t)})),this.static&&this.node._synMatrixWorld(),this._extensionsFile=null},t.prototype._createInstancedMesh=function(e){var t=new THREE.InstancedBufferGeometry;for(var n in t.instanceCount=this._batchNum,e.geometry.index&&(t.index=e.geometry.index),e.geometry.attributes)"position"===n||"normal"===n?t.addAttribute(n,e.geometry.attributes[n].clone()):t.addAttribute(n,e.geometry.attributes[n]);for(var i in this._instancedAttributes)t.addAttribute(i,this._instancedAttributes[i]);t.applyMatrix4(e.getMatrixFromRoot(this.node)),e.geometry.groups&&e.geometry.groups.length>0&&(t.groups=e.geometry.groups);var r=void 0;Array.isArray(e.material)?r=e.material.map((function(e){var t=e.clone();return t.vertexColors=!0,t.defines=void 0!==e.defines?JSON.parse(JSON.stringify(e.defines)):{},t.defines.INSTANCED="",t})):((r=e.material.clone()).vertexColors=!0,r.defines=void 0!==e.material.defines?JSON.parse(JSON.stringify(e.material.defines)):{},r.defines.INSTANCED="");var o=new THREE.Mesh(t,r);return o.userData={skipOutline:!0},o.frustumCulled=!1,o.customDepthMaterial=(hn||((hn=new THREE.MeshDepthMaterial({depthPacking:THREE.RGBADepthPacking})).defines={INSTANCED:""}),hn),o.castShadow=!0,o.receiveShadow=!0,o},t.prototype.isBatchObject=function(){return!0},t.prototype._callComplete=function(t){this._initInstancedMeshes(),e.prototype._callComplete.call(this,t)},t.prototype._allocSubObjectIndex=function(){if(this._deletedIndexs.length>0)return this._deletedIndexs.shift();var e=this._batchNum;return this._batchNum++,e},t.prototype.createSubObject=function(e){return e.type="BatchSubObject",e.parent=e.parent||this,e.batchObject=this,this.app.create(e)},t.prototype._resizeAttributes=function(){for(var e in this._instancedAttributes){var t=this._instancedAttributes[e],n=t.array,i=new n.constructor(this._maxBatchNum*t.itemSize);i.set(n),t.array=i,t.count=i.length/t.itemSize,t.resizeDirty=!0,t.needsUpdate=!0}},t.prototype._updateAttributes=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cn,n=e.internalUserData.__attribute_index__BatchObject__;t&on&&(this._instancedAttributes.instancePosition.array.set(e.node.position.toArray(),3*n),this._instancedAttributes.instancePosition.needsUpdate=!0),t&an&&(this._instancedAttributes.instanceQuaternion.array.set(e.node.quaternion.toArray(),4*n),this._instancedAttributes.instanceQuaternion.needsUpdate=!0),t&sn&&(this._instancedAttributes.instanceScale.array.set(e.node.scale.toArray(),3*n),this._instancedAttributes.instanceScale.needsUpdate=!0),t&ln&&(e._style?rn.set(e._style.color):rn.set(this.style.color),this._instancedAttributes.instanceColor.array.set(rn.toArray(),3*n),this._instancedAttributes.instanceColor.needsUpdate=!0),t&un&&(this._instancedAttributes.instanceId.array[n]=e.node.id,this._instancedAttributes.instanceId.needsUpdate=!0)},t.prototype._removeAttributes=function(e){var t=e.internalUserData.__attribute_index__BatchObject__;this._instancedAttributes.instanceScale.array.set([1e-9,1e-9,1e-9],3*t),this._instancedAttributes.instanceColor.array.set([0,0,0],3*t),this._instancedAttributes.instanceScale.needsUpdate=!0,this._instancedAttributes.instanceColor.needsUpdate=!0,this._deletedIndexs.push(t)},t}(tn),dn=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._batchObject=null,i}return a(t,e),t.prototype.isBatchSubObject=function(){return!0},t.prototype.setPickable=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&this.app.picker.markPickingNode(this.node),e.prototype.setPickable.call(this,t,n)},t.prototype._afterSetupComplete=function(e){var t=this;if(this._batchObject=e.batchObject,this._batchObject){this.app.picker.markPickingNode(this.node),this.internalUserData.__attribute_index__BatchObject__=this._batchObject._allocSubObjectIndex(),this._batchObject._batchNum>this._batchObject._maxBatchNum&&(this._batchObject._maxBatchNum*=2,this._batchObject._resizeAttributes()),this._batchObject._updateAttributes(this),this._batchObject._instancedMeshes.forEach((function(e){e.geometry.instanceCount=t._batchObject._batchNum,t.app.edgesGeometriesManager.synMaxInstancedCount(e.geometry)}));var n=this;this._notifyPositionChange=function(){n._batchObject._updateAttributes(n,on)},this._notifyAnglesChange=function(){n._batchObject._updateAttributes(n,an)},this._notifyScalesChange=function(){n._batchObject._updateAttributes(n,sn)},this._notifyDestroy=function(){n._batchObject._removeAttributes(n)}}else console.error("Please provide batch object to create BatchSubObject")},t}(tn),fn=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.sprite=null,i.spriteVisible=!0,i.onTop=!1,i.progress=0,i}return a(t,e),t.prototype.canNotQueryFromSelector=function(){return!0},t.prototype.customSetup=function(e){var t=e.scene,n=e.height,i=e.onTop,r=this.app.calcRect();this.onTop=i;var o=new THREE.SpriteMaterial({opacity:.8,color:34816,transparent:!0});this.sprite=new THREE.Sprite(o),this.sprite.scale.set(2*r.width,n,1),this.sprite.visible=!1,this.updatePosition(r.width,r.height),this.node.add(this.sprite),t.add(this.node)},t.prototype.updatePosition=function(e,t){if(void 0===e||void 0===t){var n=this.app.calcRect();e=n.width,t=n.height}var i=this.sprite,r=-e/2,o=this.onTop?t/2-i.scale.y/2:-t/2+i.scale.y/2;i.position.set(r,o,-10)},t.prototype.updateProgress=function(e){if(!this.sprite)return!1;if(this.progress==e)return!1;this.progress=e;var t=this.app.calcRect();if(e<1&&0!=e)this.sprite.visible=this.spriteVisible;else{var n=this;setTimeout((function(){n.sprite&&(n.sprite.visible=!1)}),1e3)}var i=Math.max(1,2*t.width*e);return this.sprite.scale.x=i,!0},t.prototype.resize=function(e,t){if(this.sprite){this.updatePosition(e,t);var n=Math.max(1,2*e*this.progress);this.sprite.scale.x=n}},t.prototype.prepare=function(){this.sprite.scale.x=1e-4,this.sprite.visible=this.spriteVisible},o(t,[{key:"visible",set:function(e){this.spriteVisible=e},get:function(){return this.spriteVisible}},{key:"height",set:function(e){this.sprite.scale.y=e},get:function(){return this.sprite.scale.y}}]),t}(Lt);var mn={};!function(e){var t=Math.PI/180;e.transformSVGPath=function(e){var n,i,r,o,a=new THREE.ShapePath,s=1,l=e.length,u=0,c=0,h=0,p=0,d=null,f=null,m=0,g=0,v=0,y=0,b=0,_=0,x=0,E=0,w=0;function T(){for(var t,n,i,r=!1;s<l&&(44===(n=e.charCodeAt(s))||32===n);)s++;for(t=45===n?s++:s;s<l;)if(48<=(n=e.charCodeAt(s))&&n<=57)s++;else{if(46!==n)return i=e.substring(t,s),r?parseFloat(i):parseInt(i);s++,r=!0}return i=e.substring(t),r?parseFloat(i):parseInt(i)}function M(){for(var t;s<l&&(44===(t=e.charCodeAt(s))||32===t);)s++;return 45===(t=e.charCodeAt(s))||48<=t&&t<=57}for(n=e[0];s<=l;){switch(o=!0,n){case"M":u=T(),c=T(),a.moveTo(u,c),n="L",d=u,f=c;break;case"m":u+=T(),c+=T(),a.moveTo(u,c),n="l",d=u,f=c;break;case"Z":case"z":o=!1,u===d&&c===f||a.lineTo(d,f);break;case"L":case"H":case"V":h="V"===n?u:T(),p="H"===n?c:T(),a.lineTo(h,p),u=h,c=p;break;case"l":case"h":case"v":h="v"===n?u:u+T(),p="h"===n?c:c+T(),a.lineTo(h,p),u=h,c=p;break;case"C":m=T(),v=T();case"S":"S"===n&&(m=2*u-g,v=2*c-y),g=T(),y=T(),h=T(),p=T(),a.bezierCurveTo(m,v,g,y,h,p),u=h,c=p;break;case"c":m=u+T(),v=c+T();case"s":"s"===n&&(m=2*u-g,v=2*c-y),g=u+T(),y=c+T(),h=u+T(),p=c+T(),a.bezierCurveTo(m,v,g,y,h,p),u=h,c=p;break;case"Q":m=T(),v=T();case"T":"T"===n&&(m=2*u-m,v=2*c-v),h=T(),p=T(),a.quadraticCurveTo(m,v,h,p),u=h,c=p;break;case"q":m=u+T(),v=c+T();case"t":"t"===n&&(m=2*u-m,v=2*c-v),h=u+T(),p=c+T(),a.quadraticCurveTo(m,v,h,p),u=h,c=p;break;case"A":b=T(),_=T(),x=T()*t,E=T(),w=T(),h=T(),p=T(),b!==_&&console.warn("Forcing elliptical arc to be a circular one:",b,_),m=Math.cos(x)*(u-h)/2+Math.sin(x)*(c-p)/2,v=-Math.sin(x)*(u-h)/2+Math.cos(x)*(c-p)/2;var S=Math.sqrt((b*b*_*_-b*b*v*v-_*_*m*m)/(b*b*v*v+_*_*m*m));E===w&&(S=-S),g=S*b*v/_,y=S*-_*m/b,i=Math.cos(x)*g-Math.sin(x)*y+(u+h)/2,r=Math.sin(x)*g+Math.cos(x)*y+(c+p)/2;var C=new THREE.Vector2(1,0),A=new THREE.Vector2((m-g)/b,(v-y)/_),R=Math.acos(C.dot(A)/C.length()/A.length());C.x*A.y-C.y*A.x<0&&(R=-R),C.x=(-m-g)/b,C.y=(-v-y)/_;var P=Math.acos(A.dot(C)/A.length()/C.length());A.x*C.y-A.y*C.x<0&&(P=-P),!w&&P>0&&(P-=2*Math.PI),w&&P<0&&(P+=2*Math.PI),a.absarc(i,r,b,R,R+P,w),u=h,c=p;break;default:throw new Error("Wrong path command: "+n)}o&&M()||(n=e[s++])}return a}}(mn);var gn=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype.createMaterial=function(e){if(!e)return new THREE.MeshPhongMaterial({color:2200782});return e.disableLight?new THREE.MeshBasicMaterial({color:2200782}):new THREE.MeshPhongMaterial({color:2200782})},t.prototype.createGeometry=function(e){return null},t.prototype.createMesh=function(e){var t=this.createGeometry(e);if(t){var n=this.createMaterial(e.style);return new THREE.Mesh(t,n)}return null},t.prototype.setupStyle=function(e){for(var t in e=e||{})this.style[t]=e[t];this.style.skipEnvMap=!0},t.prototype.setup=function(t){var n=this.createMesh(t);if(n){n.castShadow=!0,n.receiveShadow=!0;var i=t.center;if(i&&"Bottom"==i){var r=t.height||1;n.translateY(.5*r)}this.node.add(n)}e.prototype.setup.call(this,t),this.setupStyle(t.style)},t.prototype.addPickableGround=function(e){var t=this.app.create({type:"Plane",width:e,height:e,visible:!1,parent:this,style:{doubleSide:!0}}),n=t.node;return n.skipBoundingBox(!0),n.userData.topNode=!0,n.userData.skipOutline=!0,n.userData.independent=!0,n.userData.alwaysPickable=!0,n.canNotQueryFromSelector=!0,this.app.objectManager.addInteractableNode(n),t},t.prototype.pickGroundWorldPosition=function(e,t,n){if(Ne.isArray(t)&&void 0===n){var i=t;t=i[0],n=i[1]}var r=this.app.calcRect(),o=this.app.renderCamera.getRaycaster(t,n,r).intersectObjectForcible(e.node,!0);return o.length?o[0].point.toArray():null},t}(tn),vn=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._width=0,i._height=0,i._depth=0,i._center="",i}return a(t,e),t.prototype.createGeometry=function(e){this._width=e.width||1,this._height=e.height||1,this._depth=e.depth||1,this._center=e.center;var t=e.widthSegments||1,n=e.heightSegments||1,i=e.depthSegments||1;return new THREE.BoxGeometry(this._width,this._height,this._depth,t,n,i)},o(t,[{key:"isBox",get:function(){return!0}}]),t}(gn),yn=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype.createGeometry=function(e){var t=e.radius,n=e.segments,i=e.thetaStart,r=e.thetaLength;return new THREE.CircleGeometry(t,n,i,r)},t}(gn),bn=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype.createGeometry=function(e){var t=e.radius||1,n=e.widthSegments||8,i=e.heightSegments||6,r=e.phiStart||0,o=e.phiLength||2*Math.PI,a=e.thetaStart||0,s=e.thetaLength||Math.PI;return new THREE.SphereGeometry(t,n,i,r,o,a,s)},o(t,[{key:"isSphere",get:function(){return!0}}]),t}(gn),_n=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._ground=null,i._groundSize=0,i}return a(t,e),t.prototype.destroy=function(){this._ground&&this.app.objectManager.removeInteractableNode(this._ground.node),e.prototype.destroy.call(this)},t.prototype.createGeometry=function(e){var t=e.width||1,n=e.height||1,i=e.widthSegments||1,r=e.heightSegments||1;return new THREE.PlaneGeometry(t,n,i,r)},t.prototype.addPickableGround=function(t){this._groundSize=t.size,this._groundSize&&(this._ground=e.prototype.addPickableGround.call(this,this._groundSize))},t.prototype.pickGroundWorldPosition=function(t,n){return this._ground?e.prototype.pickGroundWorldPosition.call(this,this._ground,t,n):null},o(t,[{key:"isPlane",get:function(){return!0}}]),t}(gn),xn=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._color1=null,i._color2=null,i._size=0,i._divisions=0,i}return a(t,e),t.prototype.createMesh=function(e){this._color1=Ne.parseColor(e.color1,16777215),this._color2=Ne.parseColor(e.color2,16777215),this._size=e.size||10,this._divisions=e.divisions||10;var t=new THREE.GridHelper(this._size,this._divisions,this._color1,this._color2);return t.userData.skipStyle=!0,t},o(t,[{key:"size",get:function(){return this._size}}]),t}(gn),En=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype.createGeometry=function(e){var t=e.height||1,n=e.radius||.5,i=e.radiusTop?e.radiusTop:n,r=e.radiusBottom?e.radiusBottom:n,o=e.radiusSegments||8,a=e.heightSegments||1,s=e.heightSegments||!1,l=e.heightSegments||0,u=e.heightSegments||2*Math.PI;return new THREE.CylinderGeometry(i,r,t,o,a,s,l,u)},o(t,[{key:"isCylinder",get:function(){return!0}}]),t}(gn),wn=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype.createGeometry=function(e){var t=e.radius||1,n=e.detail||0;return new THREE.TetrahedronGeometry(t,n)},o(t,[{key:"isTetrahedron",get:function(){return!0}}]),t}(gn),Tn=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype.createMaterial=function(e){return new THREE.MeshBasicMaterial({color:"#0aa5ff",opacity:.5,transparent:!0,side:THREE.DoubleSide})},t.prototype.createGeometry=function(e){var t=e.fov||45,n=e.aspect||2,i=e.length||10,r=i*Math.tan(.5*t*.017453293),o=n*r,a=new THREE.Geometry;return a.vertices=[new THREE.Vector3(0,0,0),new THREE.Vector3(o,-r,-i),new THREE.Vector3(o,r,-i),new THREE.Vector3(-o,r,-i),new THREE.Vector3(-o,-r,-i)],a.faces=[new THREE.Face3(0,1,2),new THREE.Face3(0,2,3),new THREE.Face3(0,3,4),new THREE.Face3(0,4,1),new THREE.Face3(3,4,1),new THREE.Face3(3,1,2)],a},t}(gn),Mn=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._vertices=null,i._height=0,i}return a(t,e),t.prototype.addGeoObject=function(e,t,n){for(var i={generateTopUV:function(e,t,n,i,r){var o=t[3*n],a=t[3*n+1],s=t[3*i],l=t[3*i+1],u=t[3*r],c=t[3*r+1];return[new THREE.Vector2(o,a),new THREE.Vector2(s,l),new THREE.Vector2(u,c)]},generateSideWallUV:function(e,t,n,i,r,o){return[new THREE.Vector2(0,0),new THREE.Vector2(0,1),new THREE.Vector2(1,1),new THREE.Vector2(1,0)]}},r=mn.transformSVGPath(t.path),o=[new THREE.MeshPhongMaterial({transparent:!0}),new THREE.MeshPhongMaterial({transparent:!0})],a=r.toShapes(!0),s=0;s<a.length;s++){var l=a[s],u=new THREE.ExtrudeBufferGeometry(l,{depth:t.height,bevelEnabled:!1,UVGenerator:i}),c=new THREE.Matrix4;c.makeRotationFromEuler(Ne.parseEuler([90,0,0]));var h=new THREE.Matrix4;h.makeTranslation(t.center[0],t.height,t.center[1]),h.multiply(c);for(var p=u.attributes.position.array,d=0;d<p.length;d+=3){var f=new THREE.Vector3(p[d],p[d+1],p[d+2]);f.applyMatrix4(h),p[d]=f.x,p[d+1]=f.y,p[d+2]=f.z}u.computeVertexNormals();var m=new THREE.Matrix4;m.getInverse(e.matrixWorld);var g=new THREE.Mesh(u,o);g.applyMatrix4(m),g.translateY(n),e.add(g)}},t.prototype.createMesh=function(t){var n=t.csg;if(n&&n.isCSG){var i=n.bsp.toMesh(),r=(new THREE.Matrix4).getInverse(n._object.node.matrixWorld);return i._premultiplyMatrix(r),i}return e.prototype.createMesh.call(this,t)},t.prototype._afterSetupComplete=function(e){var t=e.vertices||e.points,n=e.center||[0,0],i=Ne.parseValue(e.height,0);if(t&&t.length){for(var r={center:n,height:i,path:""},o=function(e){return THING.Math.isFloatEquals(e,0)?0:e},a=0;a<t.length;a++){var s=Ne.parseVector3(t[a]);r.path?r.path+="L":r.path+="M",r.path+=o(s.x).toString(),r.path+=",",r.path+=o(s.z).toString(),r.path+=" "}r.path+=" Z",this._vertices=t,this._height=i,this.addGeoObject(this.node,r,t[0][1]),e.position||e.localPosition||this.useBottomCenterOfBoundingBoxAsPosition()}},o(t,[{key:"height",get:function(){return this._height}},{key:"points",get:function(){var e=this.node.children[0];if(!e)return null;e.updateWorldMatrix(!0,!1);for(var t=e.matrixWorld,n=e.geometry.attributes.position.array,i=[],r=0;r<n.length;r+=3){var o=new THREE.Vector3(n[r+0],n[r+1],n[r+2]);o.applyMatrix4(t),i.push(o.toArray())}for(r=0;r<i.length;r++)for(var a=r+1;a<i.length;a++)THING.Math.equalsVector(i[r],i[a])&&i.splice(a--,1);return i}}]),t}(gn),Sn=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.isOpen=!1,i}return a(t,e),t.prototype.open=function(){0!==this.animationNames.length&&this.playAnimation("Auto_Open"),this.isOpen=!0},t.prototype.close=function(){0!==this.animationNames.length&&this.playAnimation("Auto_Close"),this.isOpen=!1},o(t,[{key:"isDoor",get:function(){return!0}},{key:"floor",get:function(){return this.parents.query(".Floor")[0]}}]),t}(tn),Cn=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.elevator=null,i}return a(t,e),t.prototype.setup=function(t){e.prototype.setup.call(this,t),this.levelNumber=this.parent.levelNumber},o(t,[{key:"owner",get:function(){return this.elevator}}]),t}(Sn),An=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.doors=[],i}return a(t,e),t.prototype.setup=function(t){if(e.prototype.setup.call(this,t),t.doors){this.doors=t.doors;for(var n=0;n<this.doors.length;n++){this.doors[n].elevator=this}}},t.prototype.getDoor=function(e){for(var t=0;t<this.doors.length;t++){var n=this.doors[t];if(n.floor==e)return n}return n},t}(Lt),Rn=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.stair=null,i}return a(t,e),t.prototype.setup=function(t){e.prototype.setup.call(this,t)},o(t,[{key:"owner",get:function(){return this.stair}},{key:"isStairDoor",get:function(){return!0}}]),t}(Sn),Pn=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.doors=[],i}return a(t,e),t.prototype.setup=function(t){if(e.prototype.setup.call(this,t),t.doors){this.doors=t.doors;for(var n=0;n<this.doors.length;n++){this.doors[n].stair=this}}},t.prototype.getDoor=function(e){for(var t=0;t<this.doors.length;t++){var n=this.doors[t];if(n.floor==e)return n}return n},o(t,[{key:"isStair",get:function(){return console.warn("[Stair] Please use 'instanceof THING.Stair' to replace '.Stair'"),this instanceof THING.Stair}}]),t}(Lt),Dn=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype.customSetup=function(e){var t=e.width,n=e.height;if(t&&n){var i=new THREE.PlaneBufferGeometry(t,n),r=new THREE.MeshLambertMaterial({polygonOffset:!0,polygonOffsetFactor:10,polygonOffsetUnits:10}),o=new THREE.Mesh(i,r);o.rotation.x=-.5*Math.PI,o.position.x=0,o.position.y=-.1,o.position.z=0,o.receiveShadow=!0;var a=Ne.parseValue(e.skipBoundingBox,!0);o.skipBoundingBox(a);var s=e.repeatUV||[100,100],l=e.image;if(l){var u=this.app.confirmURL(l,"https://static.3dmomoda.com/textures");o.material.map=this.app.resourceManager.loadTexture(u,void 0,{repeat:!0,anisotropy:16}),o.material.map.repeat.fromArray(s)}this.node.add(o)}},t.prototype._loadSelfResource=function(){this._children.forEach((function(e){e.loadResource()}))},o(t,[{key:"isGround",get:function(){return!0}},{key:"misc",get:function(){return this.miscObject||(this.miscObject=this.query(".CombinedObject").query("[userData/type=CombineMiscParent]")[0]),this.miscObject}},{key:"plan",get:function(){return this.floorObject||(this.floorObject=this.query(".CombinedObject").query("[userData/type=CombineFloorParent]")[0]),this.floorObject}},{key:"wall",get:function(){return this.wallObject||(this.wallObject=this.query(".CombinedObject").query("[userData/type=CombineWallParent]")[0]),this.wallObject}}]),t}(Lt),kn=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._aspect=2,i._fov=45,i._near=.1,i._far=10,i._camera=null,i._lineMesh=null,i._frustumMesh=null,i._frustum=new THREE.Frustum,i._projScreenMatrix=new THREE.Matrix4,i}return a(t,e),t.prototype._updateFrustum=function(){this._projScreenMatrix.multiplyMatrices(this._camera.projectionMatrix,this._camera.matrixWorldInverse),this._frustum.setFromProjectionMatrix(this._projScreenMatrix)},t.prototype._buildLineMesh=function(e,t){var n=new THREE.EdgesGeometry(e.geometry),i=new THREE.LineSegments(n);return i.material.color=Ne.parseColor(t),i},t.prototype._buildFrustumMesh=function(){var e=this.far*Math.tan(.5*this.fov*.017453293),t=this.aspect*e,n=new THREE.Geometry;n.vertices=[new THREE.Vector3(0,0,0),new THREE.Vector3(t,-e,-this.far),new THREE.Vector3(t,e,-this.far),new THREE.Vector3(-t,e,-this.far),new THREE.Vector3(-t,-e,-this.far)],n.faces=[new THREE.Face3(0,1,2),new THREE.Face3(0,2,3),new THREE.Face3(0,3,4),new THREE.Face3(0,4,1),new THREE.Face3(3,4,1),new THREE.Face3(3,1,2)];var i=new THREE.MeshBasicMaterial({color:"#0aa5ff",opacity:.5,transparent:!0,side:THREE.DoubleSide}),r=new THREE.Mesh(n,i);return r.userData.skipEnvMap=!0,r},t.prototype._build=function(){var e=this.app.resourceManager;e.remove(this._frustumMesh),e.remove(this._lineMesh),this._frustumMesh=this._buildFrustumMesh(),this.node.add(this._frustumMesh);var t=this.style._lineColor||16777215;this._lineMesh=this._buildLineMesh(this._frustumMesh,t),this.node.add(this._lineMesh),this._camera=new THREE.PerspectiveCamera(this.fov,this.aspect,this.near,this.far),this._camera.position.set(this.position[0],this.position[1],this.position[2]),this._camera.rotation.copy(this.node.rotation),this._camera.updateMatrixWorld(!0),this._updateFrustum()},t.prototype.customSetup=function(e){this._aspect=e.aspect||this._aspect,this._fov=e.fov||this._fov,this._near=e.near||this._near,this._far=e.far||this._far,this._build()},t.prototype.setWorldPosition=function(t){e.prototype.setWorldPosition.call(this,t),this._camera.position.set(t[0],t[1],t[2]),this._camera.updateMatrixWorld(!0),this._updateFrustum()},t.prototype.intersectsObject=function(e){return this._updateFrustum(),!!this._frustum._intersectsObject(e.node)},o(t,[{key:"aspect",set:function(e){this._aspect=e,this._build()},get:function(){return this._aspect}},{key:"fov",set:function(e){this._fov=e,this._build()},get:function(){return this._fov}},{key:"far",set:function(e){this._far=e,this._build()},get:function(){return this._far}}]),t}(Lt),jn={uniforms:{tDiffuse:{value:null},brightness:{value:0},contrast:{value:1},exposure:{value:0},gamma:{value:1},saturation:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform float brightness;","uniform float contrast;","uniform float exposure;","uniform float gamma;","uniform float saturation;","const vec3 w = vec3(0.2125, 0.7154, 0.0721);","void main() {","vec4 tex = texture2D( tDiffuse, vUv );","vec3 color = clamp(tex.rgb + vec3(brightness), 0.0, 1.0);","color = clamp( (color-vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);","color = clamp( color * pow(2.0, exposure), 0.0, 1.0);","color = clamp( pow(color, vec3(gamma)), 0.0, 1.0);","float luminance = dot( color, w );","color = mix(vec3(luminance), color, saturation);","gl_FragColor = vec4(color, tex.a);","}"].join("\n")},On={defines:{RINGS:3,SAMPLES:4},uniforms:{tColor:{value:null},tDepth:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)},znear:{value:.1},zfar:{value:100},focalDepth:{value:1},focalLength:{value:24},fstop:{value:.9},maxblur:{value:1},threshold:{value:.5},gain:{value:2},bias:{value:.5},dithering:{value:1e-4}},vertexShader:"\n        varying vec2 vUv;\n\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}\n    ",fragmentShader:"\n        #include <common>\n\n        varying vec2 vUv;\n\n        uniform sampler2D tColor;\n        uniform sampler2D tDepth;\n\n        uniform vec2 resolution;\n\n        uniform float znear;\n        uniform float zfar;\n\n        uniform float focalDepth;\n        uniform float focalLength;\n        uniform float fstop;\n\n        uniform float maxblur; // clamp value of max blur (0.0 = no blur, 1.0 default)\n        uniform float threshold; // highlight threshold\n        uniform float gain; // highlight gain\n        uniform float bias; // bokeh edge bias\n        uniform float dithering;\n\n        const int samples = SAMPLES;\n        const int rings = RINGS;\n        const int maxringsamples = rings * samples;\n\n        float CoC = 0.03; // circle of confusion size in mm (35mm film = 0.03mm)\n\n        vec3 color(vec2 coords, float blur) {\n            vec3 col = texture2D(tColor, coords).rgb;\n            vec3 lumcoeff = vec3(0.299,0.587,0.114);\n            float lum = dot(col.rgb, lumcoeff);\n            float thresh = max((lum - threshold) * gain, 0.0);\n            return col + mix(vec3(0.0), col, thresh * blur);\n        }\n\n        float linearize(float depth) {\n            return -zfar * znear / (depth * (zfar - znear) - zfar);\n        }\n\n        float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {\n            float rings2 = float(rings);\n            float step = PI * 2.0 / float(ringsamples);\n            float pw = cos(j * step) * i;\n            float ph = sin(j * step) * i;\n            col += color(vUv + vec2(pw * w, ph * h), blur) * mix(1.0, i / rings2, bias);\n            return mix(1.0, i / rings2, bias);\n        }\n\n        void main() {\n            float depth = linearize(texture2D(tDepth, vUv).x);\n            float fDepth = focalDepth;\n\n            // dof blur factor calculation\n\n            float f = focalLength; // focal length in mm\n            float d = fDepth * 1000.; // focal plane in mm\n            float o = depth * 1000.; // depth in mm\n\n            float a = (o * f) / (o - f);\n            float b = (d * f) / (d - f);\n            float c = (d - f) / (d * fstop * CoC);\n\n            float blur = abs(a - b) * c;\n            blur = clamp(blur, 0.0, 1.0);\n\n            // calculation of pattern for dithering\n\n            vec2 noise = vec2(rand(vUv), rand(vUv + vec2(0.4, 0.6))) * dithering * blur;\n\n            // getting blur x and y step factor\n\n            float w = resolution.x * blur * maxblur + noise.x;\n            float h = resolution.y * blur * maxblur + noise.y;\n\n            // calculation of final color\n\n            vec3 col = vec3(0.0);\n\n            if (blur < 0.05) {\n                col = texture2D(tColor, vUv).rgb;\n            } else {\n                col = texture2D(tColor, vUv).rgb;\n\n                float s = 1.0;\n                int ringsamples;\n\n                for(int i = 1; i <= rings; i++) {\n                    ringsamples = i * samples;\n\n                    for (int j = 0; j < maxringsamples; j++) {\n                        if (j >= ringsamples) break;\n                        s += gather(float(i), float(j), ringsamples, col, w, h, blur);\n                    }\n                }\n\n                col /= s; // divide by sample count\n            }\n\n            gl_FragColor = vec4(col, 1.0);\n        }\n    "},Fn={uniforms:{tDiffuse:{value:null},time:{value:0},nIntensity:{value:.5},sIntensity:{value:.05},sCount:{value:4096},grayscale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 cTextureScreen = texture2D( tDiffuse, vUv );","float dx = rand( vUv + time );","vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx, 0.0, 1.0 );","vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","if( grayscale ) {","cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","}","gl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")},Bn={uniforms:{tDiffuse:{value:null},uChromaFactor:{value:.025},uResolutionRatio:{value:new THREE.Vector2(1,1)},resolution:{value:new THREE.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float uChromaFactor;","uniform vec2 uResolutionRatio;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","vec2 uv = vUv;","vec2 dist = uv - 0.5;","vec2 offset = uChromaFactor * dist * length(dist);","vec4 col = texture2D(tDiffuse, min(uv, 1.0 - resolution) * uResolutionRatio);","col.r = texture2D(tDiffuse, min(uv - offset, 1.0 - resolution) * uResolutionRatio).r;","col.b = texture2D(tDiffuse, min(uv + offset, 1.0 - resolution) * uResolutionRatio).b;","gl_FragColor = col;","}"].join("\n")},Ln={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},In={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immedates.","    // Immedates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")},Nn=new THREE.OrthographicCamera(-1,1,1,-1,0,1),Hn=new THREE.Scene,zn=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null);zn.frustumCulled=!1,Hn.add(zn);var Un=new THREE.Color,Vn=function(){function e(t,n,i,o){r(this,e),this.clear=!0,this.clearColor=new THREE.Color(0,0,0),this.clearAlpha=1,this.textureID=void 0!==n?n:"tDiffuse",this.resolutionID=void 0!==i?i:"resolution",this.resolutionScaler=void 0!==o?o:1,t instanceof THREE.ShaderMaterial?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=THREE.UniformsUtils.clone(t.uniforms),this.material=new THREE.ShaderMaterial({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader||"\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvUv = uv;\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t}\n",fragmentShader:t.fragmentShader}))}return e.prototype.setSize=function(e,t){this.uniforms[this.resolutionID]&&this.uniforms[this.resolutionID].value.set(this.resolutionScaler/e,this.resolutionScaler/t)},e.prototype.render=function(e,t,n,i,r){this.uniforms[this.textureID]&&n&&(this.uniforms[this.textureID].value=n.texture),this.uniforms.time&&(this.uniforms.time.value+=i,this.uniforms.time.value>10&&(this.uniforms.time.value=0));var o=e.getClearAlpha(),a=e.autoClear;e.autoClear=!1,this.clear&&(Un.copy(e.getClearColor()),e.setClearColor(this.clearColor,this.clearAlpha)),zn.material=this.material,e.setRenderTarget(void 0!==t?t:null),this.clear&&e.clear(),e.render(Hn,Nn),this.clear&&e.setClearColor(Un,o),e.autoClear=a},e}(),qn={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1,generateMipmaps:!1};function Gn(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8,o=new THREE.WebGLMultisampleRenderTarget(t,n,qn);return o.texture.name=e+".mrt",o.stencilBuffer=i,o.samples=Math.min(5,r),o}function Wn(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=new THREE.WebGLRenderTarget(t,n,qn);return r.texture.name=e+".rt",r.stencilBuffer=i,r}function Xn(e,t,n){return{vertexShader:"\n\t\t\t#include <common>\n\t\t\t#include <skinning_pars_vertex>\n\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\tvoid main() {\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <skinning_vertex>\n\t\t\t\t#include <project_vertex>\n\t\t\t\t#include <logdepthbuf_vertex>\n\t\t\t}\n\t\t",fragmentShader:"\n\t\t\t#include <logdepthbuf_pars_fragment>\n\t\t\tvoid main() {\n\t\t\t\t#include <logdepthbuf_fragment>\n\t\t\t\tgl_FragColor = vec4("+e.toFixed(1)+", "+t.toFixed(1)+", "+n.toFixed(1)+", 1.0);\n\t\t\t}\n\t\t"}}var Jn=Xn(0,0,0),Yn=new Map;function Qn(e,t){var n=e.isInstancedMesh+"_"+t.skinning,i=void 0;return Yn.has(n)?i=Yn.get(n):((i=new THREE.ShaderMaterial(Jn)).skinning=t.skinning,Yn.set(n,i)),i}function Zn(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.depthTest=t.depthTest,e.depthWrite=t.depthWrite,e.colorWrite=t.colorWrite,e.colorWrite&&!n&&(e.colorWrite=!(t.transparent&&!t.depthWrite)),e.side=t.side}function Kn(e,t){if(!e)return null;var n=e[t];return n?"[object Object]"===toString.call(n)?n.skip?"skip":void 0!==n.value?n.value:1:n:null}function $n(e,t){return"BackgroundCubeMaterial"==t.name||"BackgroundMaterial"==t.name||"sky"===e.name||!0===e.isSky}var ei=function(){function e(t,n,i,o){r(this,e),this._mrt=Gn("SceneBuffer",t,n,i,o),this._rt=Wn("SceneBuffer",t,n,i),this.useMRT=!1}return e.prototype.setupDepthRenderbuffer=function(e,t){this._mrt.webglDepthRenderbuffer=e,this._rt.webglDepthRenderbuffer=t},e.prototype.setSize=function(e,t){this._mrt.setSize(e,t),this._rt.setSize(e,t)},e.prototype.render=function(e,t,n,i){e.setRenderTarget(this.useMRT?this._mrt:this._rt),e.clear(),e.render(t,n)},e.prototype.getSchemeTexture=function(){return this.useMRT?this._mrt.texture:this._rt.texture},e.prototype.getSchemeBuffer=function(){return this.useMRT?this._mrt:this._rt},e.prototype.dispose=function(){this._mrt.dispose(),this._rt.dispose()},e}(),ti={_USE_ROUGHNESSMAP:!1},ni={roughness:{value:1},roughnessMap:{value:null}},ii="\n        varying vec3 vNormal;\n        varying vec2 vUv;\n\n        #include <common>\n        #include <morphtarget_pars_vertex>\n        #include <skinning_pars_vertex>\n        #include <logdepthbuf_pars_vertex>\n        #include <clipping_planes_pars_vertex>\n\n        void main() {\n\n            vUv = uv;\n\n            #include <beginnormal_vertex>\n            #include <morphnormal_vertex>\n            #include <skinbase_vertex>\n            #include <skinnormal_vertex>\n            #include <defaultnormal_vertex>\n\n            vNormal = normalize( transformedNormal );\n\n            #include <begin_vertex>\n            #include <morphtarget_vertex>\n            #include <skinning_vertex>\n            #include <project_vertex>\n            #include <logdepthbuf_vertex>\n            #include <clipping_planes_vertex>\n\n        }\n    ",ri="\n        uniform float roughness;\n\n        #ifdef _USE_ROUGHNESSMAP\n            uniform sampler2D roughnessMap;\n        #endif\n\n        varying vec3 vNormal;\n        varying vec2 vUv;\n\n        #include <packing>\n        #include <logdepthbuf_pars_fragment>\n        #include <clipping_planes_pars_fragment>\n\n        void main() {\n\n            #include <clipping_planes_fragment>\n            #include <logdepthbuf_fragment>\n\n            vec3 normal = normalize( vNormal );\n\n            float roughnessFactor = roughness;\n\n            #ifdef _USE_ROUGHNESSMAP\n                roughnessFactor *= texture2D( roughnessMap, vUv ).g;\n            #endif\n\n            gl_FragColor = vec4( packNormalToRGB( normal ), clamp(1. - roughnessFactor, 0., 1.) );\n\n        }\n    ",oi=function(){function e(t,n){r(this,e),this._rt=new THREE.WebGLRenderTarget(t,n,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,type:THREE.HalfFloatType,generateMipmaps:!1}),this._rt.depthTexture=new THREE.DepthTexture(t,n),this._rt.depthTexture.format=THREE.DepthStencilFormat,this._rt.depthTexture.type=THREE.UnsignedInt248Type,this._rt.depthTexture.generateMipmaps=!1,this.ignoreTransparent=!0}return e.prototype._checkStrategyInited=function(e){return e.materialManager.hasStrategy("GBuffer")},e.prototype._initStrategy=function(e){var t=this;e.materialManager.addStrategy("GBuffer",(function(e,n,i,r,o,a){return t.ignoreTransparent&&o.transparent||$n(this,o)||o.isSpriteMaterial||t.ignoreTransparent&&o.alphaTest>0?null:si.getNormalGlossinessMaterial(this,o)}))},e.prototype.setSize=function(e,t){this._rt.setSize(e,t)},e.prototype.render=function(e,t,n,i){this._checkStrategyInited(e)||this._initStrategy(e),this.ignoreTransparent=i;var r=e.getClearColor().getHex(),o=e.getClearAlpha(),a=e.autoClear;e.autoClear=!1,e.setClearColor(7829503,0),e.materialManager.setMode("GBuffer");var s=t.autoUpdate,l=t.background,u=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,e.initRenderList=!1,e.renderCustom1=!1,e.setRenderTarget(this._rt),e.clear(),e.render(t,n),t.autoUpdate=s,t.background=l,e.shadowMap.enable=u,e.initRenderList=!0,e.renderCustom1=!0,e.materialManager.setMode(0),e.autoClear=a,e.setClearColor(r,o)},e.prototype.getNormalGlossinessTexture=function(){return this._rt.texture},e.prototype.getDepthTexture=function(){return this._rt.depthTexture},e.prototype.dispose=function(){this._rt.dispose()},e}(),ai={},si=new(function(){function e(){r(this,e),this._normalGlossinessMaterials=new Map}return e.prototype.getNormalGlossinessMaterial=function(e,t){ai.instancing=e.isInstancedMesh,ai.useRoughnessMap=!!t.roughnessMap,ai.skinning=t.skinning,ai.morphTargets=t.morphTargets,ai.morphNormals=t.morphNormals;var n=void 0,i=ai.instancing+"_"+ai.useRoughnessMap+"_"+ai.skinning+"_"+ai.morphTargets+"_"+ai.morphNormals;return this._normalGlossinessMaterials.has(i)?n=this._normalGlossinessMaterials.get(i):((n=new THREE.ShaderMaterial({defines:Object.assign({},ti),uniforms:THREE.UniformsUtils.clone(ni),vertexShader:ii,fragmentShader:ri})).skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.defines._USE_ROUGHNESSMAP=!!t.roughnessMap&&"",this._normalGlossinessMaterials.set(i,n)),n.uniforms.roughness.value=void 0!==t.roughness?t.roughness:.5,n.uniforms.roughnessMap.value=t.roughnessMap,n.uniformsNeedUpdate=!0,n},e}()),li={defines:{DEPTH_PACKING:1,KERNEL_SIZE:64,EPSILON:1e-6},uniforms:{normalTex:{value:null},depthTex:{value:null},noiseTex:{value:null},texSize:{value:new THREE.Vector2},noiseTexSize:{value:new THREE.Vector2(4,4)},projection:{value:new THREE.Matrix4},projectionInv:{value:new THREE.Matrix4},kernel:{value:null},radius:{value:.2},power:{value:1},bias:{value:.004},intensity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp sampler2D;","#include <packing>","varying vec2 vUv;","uniform sampler2D normalTex;","uniform sampler2D depthTex;","uniform vec2 texSize;","uniform sampler2D noiseTex;","uniform vec2 noiseTexSize;","uniform mat4 projection;","uniform mat4 projectionInv;","uniform vec3 kernel[KERNEL_SIZE];","uniform float radius;","uniform float power;","uniform float bias;","uniform float intensity;","float getDepth( const in vec2 screenPosition ) {","#if DEPTH_PACKING == 1","return unpackRGBAToDepth( texture2D( depthTex, screenPosition ) );","#elif DEPTH_PACKING == 2","return texture2D( depthTex, screenPosition ).w;","#else","return texture2D( depthTex, screenPosition ).x;","#endif","}","vec3 getViewNormal( const in vec2 screenPosition ) {","return unpackRGBToNormal( texture2D( normalTex, screenPosition ).xyz );","}","float ssaoEstimator(in mat3 kernelBasis, in vec3 originPos, in vec3 N) {","float occlusion = 0.0;","for (int i = 0; i < KERNEL_SIZE; i++) {","vec3 samplePos = kernel[i];","samplePos = kernelBasis * samplePos;","samplePos = samplePos * radius + originPos;","vec4 texCoord = projection * vec4(samplePos, 1.0);","texCoord.xy /= texCoord.w;","texCoord.xy = texCoord.xy * 0.5 + 0.5;","float sampleDepth = getDepth(texCoord.xy);","float z = sampleDepth * 2.0 - 1.0;","#ifdef ALCHEMY","vec4 projectedPos = vec4(texCoord.xy * 2.0 - 1.0, z, 1.0);","vec4 p4 = projectionInv * projectedPos;","p4.xyz /= p4.w;","vec3 cDir = p4.xyz - originPos;","float vv = dot(cDir, cDir);","float vn = dot(cDir, N);","float radius2 = radius * radius;","vn = max(vn + p4.z * bias, 0.0);","float f = max(radius2 - vv, 0.0) / radius2;","occlusion += f * f * f * max(vn / (0.01 + vv), 0.0);","#else","if (projection[3][3] == 0.0) {","z = projection[3][2] / (z * projection[2][3] - projection[2][2]);","} else {","z = (z - projection[3][2]) / projection[2][2];","}","float factor = step(samplePos.z, z - bias);","float rangeCheck = smoothstep(0.0, 1.0, radius / abs(originPos.z - z));","occlusion += rangeCheck * factor;","#endif","}","occlusion = 1.0 - occlusion / float(KERNEL_SIZE);","return pow(occlusion, power);","}","void main() {","float centerDepth = getDepth( vUv );","if( centerDepth >= ( 1.0 - EPSILON ) ) {","\tdiscard;","}","vec3 N = getViewNormal( vUv );","vec2 noiseTexCoord = texSize / vec2(noiseTexSize) * vUv;","vec3 rvec = texture2D(noiseTex, noiseTexCoord).rgb * 2.0 - 1.0;","vec3 T = normalize(rvec - N * dot(rvec, N));","vec3 BT = normalize(cross(N, T));","mat3 kernelBasis = mat3(T, BT, N);","float z = centerDepth * 2.0 - 1.0;","vec4 projectedPos = vec4(vUv * 2.0 - 1.0, z, 1.0);","vec4 p4 = projectionInv * projectedPos;","vec3 position = p4.xyz / p4.w;","float ao = ssaoEstimator(kernelBasis, position, N);","ao = clamp(1.0 - (1.0 - ao) * intensity, 0.0, 1.0);","gl_FragColor = vec4(vec3(ao), 1.0);","}"].join("\n")},ui={defines:{NORMALTEX_ENABLED:1,DEPTHTEX_ENABLED:1,DEPTH_PACKING:1},uniforms:{tDiffuse:{value:null},textureSize:{value:new THREE.Vector2},direction:{value:0},blurSize:{value:1},depthTex:{value:null},normalTex:{value:null},projection:{value:new THREE.Matrix4},depthRange:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <packing>","varying vec2 vUv;","uniform vec2 textureSize;","uniform float blurSize;","uniform sampler2D tDiffuse;","uniform int direction;","#if NORMALTEX_ENABLED == 1","uniform sampler2D normalTex;","vec3 getViewNormal( const in vec2 screenPosition ) {","return unpackRGBToNormal( texture2D( normalTex, screenPosition ).xyz );","}","#endif","#if DEPTHTEX_ENABLED == 1","uniform sampler2D depthTex;","uniform mat4 projection;","uniform float depthRange;","float getDepth( const in vec2 screenPosition ) {","#if DEPTH_PACKING == 1","return unpackRGBAToDepth( texture2D( depthTex, screenPosition ) );","#elif DEPTH_PACKING == 2","return texture2D( depthTex, screenPosition ).w;","#else","return texture2D( depthTex, screenPosition ).x;","#endif","}","float getLinearDepth(vec2 coord) {","float depth = getDepth(coord) * 2.0 - 1.0;","return projection[3][2] / (depth * projection[2][3] - projection[2][2]);","}","#endif","void main() {","float kernel[5];","kernel[0] = 0.122581;","kernel[1] = 0.233062;","kernel[2] = 0.288713;","kernel[3] = 0.233062;","kernel[4] = 0.122581;","vec2 off = vec2(0.0);","if (direction == 0) {","off[0] = blurSize / textureSize.x;","}","else {","off[1] = blurSize / textureSize.y;","}","float sum = 0.0;","float weightAll = 0.0;","#if NORMALTEX_ENABLED == 1","vec3 centerNormal = getViewNormal(vUv);","#endif","#if DEPTHTEX_ENABLED == 1","float centerDepth = getLinearDepth(vUv);","#endif","for (int i = 0; i < 5; i++) {","vec2 coord = clamp(vUv + vec2(float(i) - 2.0) * off, vec2(0.0), vec2(1.0));","float w = kernel[i];","#if NORMALTEX_ENABLED == 1","vec3 normal = getViewNormal(coord);","w *= clamp(dot(normal, centerNormal), 0.0, 1.0);","#endif","#if DEPTHTEX_ENABLED == 1","float d = getLinearDepth(coord);","w *= (1.0 - smoothstep(0.0, 1.0, abs(centerDepth - d) / depthRange));","#endif","weightAll += w;","sum += w * texture2D(tDiffuse, coord).r;","}","gl_FragColor = vec4(vec3(sum / weightAll), 1.0);","}"].join("\n")};function ci(e){return e.replace(/^\S/,(function(e){return e.toUpperCase()}))}function hi(e,t){if("[object Object]"!==t.toString())return t;for(var n in t)t.hasOwnProperty(n)&&(e||(e={}),e[n]=hi(e[n],t[n]));return e}var pi={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!1};function di(e,t){return new THREE.WebGLRenderTarget(e,t,pi)}var fi=new Map;function mi(e){for(var t=new Uint8Array(e*e*4),n=0,i=new THREE.Vector3,r=0;r<e;r++)for(var o=0;o<e;o++)i.set(2*Math.random()-1,2*Math.random()-1,0).normalize(),t[n++]=255*(.5*i.x+.5),t[n++]=255*(.5*i.y+.5),t[n++]=0,t[n++]=255;return t}function gi(e,t){for(var n=0,i=1/t,r=e;r>0;)n+=i*(r%t),r=Math.floor(r/t),i/=t;return n}var vi=function(){function e(t,n){r(this,e),this._tempRenderTarget=di(t,n),this._tempRenderTarget2=di(t,n),this._ssaoPass=new Vn(li,void 0,"texSize"),this._ssaoPass.material.depthTest=!1,this._ssaoPass.material.depthWrite=!1,this._blurPass=new Vn(ui,void 0,"textureSize"),this._blurPass.material.depthTest=!1,this._blurPass.material.depthWrite=!1,this._blurPass.material.transparent=!0,this._blurPass.material.blending=THREE.CustomBlending,this._blurPass.material.blendSrc=THREE.ZeroFactor,this._blurPass.material.blendDst=THREE.SrcColorFactor,this._blurPass.material.blendEquation=THREE.AddEquation,this._blurPass.material.blendSrcAlpha=THREE.ZeroFactor,this._blurPass.material.blendDstAlpha=THREE.SrcColorFactor,this._blurPass.material.blendEquationAlpha=THREE.AddEquation,this._kernels={},this.setNoiseSize(4),this.setKernelSize(12),this.setParameter("radius",.2),this.setParameter("bias",.004),this.setParameter("power",1),this.setParameter("intensity",.8),this.setParameter("blurSize",1),this._ssaoPass.setSize(1/t,1/n),this._blurPass.setSize(1/t,1/n)}return e.prototype.setKernelSize=function(e,t){t=void 0!==t?t:0,this._kernels[e+"_"+t]||(this._kernels[e+"_"+t]=function(e,t,n){var i=new Float32Array(3*e);t=t||0;for(var r=0;r<e;r++){var o=gi(r+t,2)*(n?1:2)*Math.PI,a=gi(r+t,3)*Math.PI,s=Math.random(),l=Math.cos(o)*Math.sin(a)*s,u=Math.cos(a)*s,c=Math.sin(o)*Math.sin(a)*s;i[3*r]=l,i[3*r+1]=u,i[3*r+2]=c}return i}(e,e*t,!0)),this._ssaoPass.material.defines.KERNEL_SIZE=e,this._ssaoPass.material.uniforms.kernel.value=this._kernels[e+"_"+t],this._ssaoPass.material.needsUpdate=!0},e.prototype.setNoiseSize=function(e){var t=this._ssaoPass.material.uniforms.noiseTex.value;t?(t.image.data=mi(e),t.image.width=e,t.image.height=e,t.needsUpdate=!0):(t=function(e){var t=new THREE.DataTexture(mi(e),e,e,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.RepeatWrapping,THREE.RepeatWrapping);return t.needsUpdate=!0,t}(e),this._ssaoPass.material.uniforms.noiseTex.value=t),this._ssaoPass.material.uniforms.noiseTexSize.value.set(e,e)},e.prototype.setParameter=function(e,t){"noiseTexSize"===e?this.setNoiseSize(t):"kernelSize"===e?this.setKernelSize(t):"blurSize"===e?this._blurPass.material.uniforms.blurSize.value=t:this._ssaoPass.material.uniforms[e].value=t},e.prototype.setSize=function(e,t){this._tempRenderTarget.setSize(e,t),this._tempRenderTarget2.setSize(e,t),this._ssaoPass.setSize(1/e,1/t),this._blurPass.setSize(1/e,1/t)},e.prototype.render=function(e,t,n,i,r,o){this._ssaoPass.material.uniforms.normalTex.value=e,this._ssaoPass.material.uniforms.depthTex.value=t,this._ssaoPass.material.uniforms.projection.value.copy(i.projectionMatrix),this._ssaoPass.material.uniforms.projectionInv.value.getInverse(i.projectionMatrix),this._blurPass.material.uniforms.normalTex.value=e,this._blurPass.material.uniforms.depthTex.value=t,this._blurPass.material.uniforms.projection.value.copy(i.projectionMatrix),t===e?(this._ssaoPass.material.defines.DEPTH_PACKING=2,this._blurPass.material.defines.DEPTH_PACKING=2):t.isDepthTexture?(this._ssaoPass.material.defines.DEPTH_PACKING=0,this._blurPass.material.defines.DEPTH_PACKING=0):(this._ssaoPass.material.defines.DEPTH_PACKING=1,this._blurPass.material.defines.DEPTH_PACKING=1),this._ssaoPass.clearColor.setRGB(1,1,1),this._ssaoPass.clearAlpha=1,this._ssaoPass.render(n,this._tempRenderTarget),this._blurPass.clearColor.setRGB(1,1,1),this._blurPass.clearAlpha=1,this._blurPass.clear=!0,this._blurPass.material.uniforms.direction.value=0,this._blurPass.material.transparent=!1,this._blurPass.render(n,this._tempRenderTarget2,this._tempRenderTarget),o?(this._blurPass.clearColor.setRGB(0,0,0),this._blurPass.clearAlpha=0):this._blurPass.clear=!1,this._blurPass.material.uniforms.direction.value=1,this._blurPass.material.transparent=!o,this._blurPass.material.blending=o?THREE.NoBlending:THREE.CustomBlending,this._blurPass.render(n,void 0!==r?r:null,this._tempRenderTarget2)},e}(),yi={defines:{},uniforms:{colorTex:{value:null},gBufferTexture1:{value:null},gBufferTexture2:{value:null},projection:{value:new THREE.Matrix4},projectionInv:{value:new THREE.Matrix4},maxRayDistance:{value:200},pixelStride:{value:16},pixelStrideZCutoff:{value:50},screenEdgeFadeStart:{value:.9},eyeFadeStart:{value:.4},eyeFadeEnd:{value:.8},minGlossiness:{value:.2},zThicknessThreshold:{value:.1},jitterOffset:{value:0},nearZ:{value:0},viewportSize:{value:new THREE.Vector2(512,512)},maxMipmapLevel:{value:5}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    ",fragmentShader:"\n        #define MAX_ITERATION 20;\n\t\t#define MAX_BINARY_SEARCH_ITERATION 5;\n\n\t\tuniform sampler2D colorTex;\n\t\tuniform sampler2D gBufferTexture1;\n\t\tuniform sampler2D gBufferTexture2;\n\n\t\tuniform mat4 projection;\n\t\tuniform mat4 projectionInv;\n\t\t// uniform mat4 viewInverseTranspose;\n\n\t\tuniform float maxRayDistance;\n\n\t\tuniform float pixelStride;\n\t\t// ray origin Z at this distance will have a pixel stride of 1.0\n\t\tuniform float pixelStrideZCutoff;\n\n\t\t// distance to screen edge that ray hits will start to fade (0.0 -> 1.0)\n\t\tuniform float screenEdgeFadeStart;\n\n\t\t// ray direction's Z that ray hits will start to fade (0.0 -> 1.0)\n\t\tuniform float eyeFadeStart;\n\t\t// ray direction's Z that ray hits will be cut (0.0 -> 1.0)\n\t\tuniform float eyeFadeEnd;\n\n\t\t// Object larger than minGlossiness will have ssr effect\n\t\tuniform float minGlossiness;\n\t\tuniform float zThicknessThreshold;\n\n\t\tuniform float jitterOffset;\n\n\t\tuniform float nearZ;\n\t\tuniform vec2 viewportSize;\n\n        uniform float maxMipmapLevel;\n        \n        varying vec2 vUv;\n\n        float fetchDepth(sampler2D depthTexture, vec2 uv) {\n\t\t\tvec4 depthTexel = texture2D(depthTexture, uv);\n\t\t\treturn depthTexel.r * 2.0 - 1.0;\n\t\t}\n\n\t\tfloat linearDepth(float depth) {\n\t\t\treturn projection[3][2] / (depth * projection[2][3] - projection[2][2]);\n\t\t}\n\n\t\tbool rayIntersectDepth(float rayZNear, float rayZFar, vec2 hitPixel) {\n\t\t    // Swap if bigger\n\t\t\tif (rayZFar > rayZNear) {\n\t\t\t\tfloat t = rayZFar; rayZFar = rayZNear; rayZNear = t;\n\t\t\t}\n\t\t\tfloat cameraZ = linearDepth(fetchDepth(gBufferTexture2, hitPixel));\n\t\t    // float cameraBackZ = linearDepth(fetchDepth(backDepthTex, hitPixel));\n\t\t    // Cross z\n\t\t\treturn rayZFar <= cameraZ && rayZNear >= cameraZ - zThicknessThreshold;\n\t\t}\n\n\t\t// Trace a ray in screenspace from rayOrigin (in camera space) pointing in rayDir (in camera space)\n\t\t//\n\t\t// With perspective correct interpolation\n\t\t//\n\t\t// Returns true if the ray hits a pixel in the depth buffer\n\t\t// and outputs the hitPixel (in UV space), the hitPoint (in camera space) and the number\n\t\t// of iterations it took to get there.\n\t\t//\n\t\t// Based on Morgan McGuire & Mike Mara's GLSL implementation:\n\t\t// http://casual-effects.blogspot.com/2014/08/screen-space-ray-tracing.html\n\t\tbool traceScreenSpaceRay(vec3 rayOrigin, vec3 rayDir, float jitter, out vec2 hitPixel, out vec3 hitPoint, out float iterationCount) {\n\t\t    // Clip to the near plane\n\t\t\tfloat rayLength = ((rayOrigin.z + rayDir.z * maxRayDistance) > -nearZ) ? (-nearZ - rayOrigin.z) / rayDir.z : maxRayDistance;\n\n\t\t\tvec3 rayEnd = rayOrigin + rayDir * rayLength;\n\n\t\t    // Project into homogeneous clip space\n\t\t\tvec4 H0 = projection * vec4(rayOrigin, 1.0);\n\t\t\tvec4 H1 = projection * vec4(rayEnd, 1.0);\n\n\t\t\tfloat k0 = 1.0 / H0.w, k1 = 1.0 / H1.w;\n\n\t\t    // The interpolated homogeneous version of the camera space points\n\t\t\tvec3 Q0 = rayOrigin * k0, Q1 = rayEnd * k1;\n\n\t\t    // Screen space endpoints\n\t\t    // PENDING viewportSize ?\n\t\t\tvec2 P0 = (H0.xy * k0 * 0.5 + 0.5) * viewportSize;\n\t\t\tvec2 P1 = (H1.xy * k1 * 0.5 + 0.5) * viewportSize;\n\n\t\t    // If the line is degenerate, make it cover at least one pixel to avoid handling\n\t\t    // zero-pixel extent as a special case later\n\t\t\tP1 += dot(P1 - P0, P1 - P0) < 0.0001 ? 0.01 : 0.0;\n\t\t\tvec2 delta = P1 - P0;\n\n\t\t    // Permute so that the primary iteration is in x to collapse\n\t\t    // all quadrant-specific DDA case later\n\t\t\tbool permute = false;\n\t\t\tif (abs(delta.x) < abs(delta.y)) {\n\t\t    // More vertical line\n\t\t\t\tpermute = true;\n\t\t\t\tdelta = delta.yx;\n\t\t\t\tP0 = P0.yx;\n\t\t\t\tP1 = P1.yx;\n\t\t\t}\n\t\t\tfloat stepDir = sign(delta.x);\n\t\t\tfloat invdx = stepDir / delta.x;\n\n\t\t    // Track the derivatives of Q and K\n\t\t\tvec3 dQ = (Q1 - Q0) * invdx;\n\t\t\tfloat dk = (k1 - k0) * invdx;\n\n\t\t\tvec2 dP = vec2(stepDir, delta.y * invdx);\n\n            // Calculate pixel stride based on distance of ray origin from camera.\n            // Since perspective means distant objects will be smaller in screen space\n            // we can use this to have higher quality reflections for far away objects\n            // while still using a large pixel stride for near objects (and increase performance)\n            // this also helps mitigate artifacts on distant reflections when we use a large\n            // pixel stride.\n\t\t\tfloat strideScaler = 1.0 - min(1.0, -rayOrigin.z / pixelStrideZCutoff);\n\t\t\tfloat pixStride = 1.0 + strideScaler * pixelStride;\n\n\t\t    // Scale derivatives by the desired pixel stride and the offset the starting values by the jitter fraction\n\t\t\tdP *= pixStride; dQ *= pixStride; dk *= pixStride;\n\n\t\t    // Track ray step and derivatives in a vec4 to parallelize\n\t\t\tvec4 pqk = vec4(P0, Q0.z, k0);\n\t\t\tvec4 dPQK = vec4(dP, dQ.z, dk);\n\n\t\t\tpqk += dPQK * jitter;\n\t\t\tfloat rayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);\n\t\t\tfloat rayZNear;\n\n\t\t\tbool intersect = false;\n\n\t\t\tvec2 texelSize = 1.0 / viewportSize;\n\n\t\t\titerationCount = 0.0;\n\n\t\t\tfor (int i = 0; i < 20; i++) {\n\t\t\t\tpqk += dPQK;\n\n\t\t\t\trayZNear = rayZFar;\n\t\t\t\trayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);\n\n\t\t\t\thitPixel = permute ? pqk.yx : pqk.xy;\n\t\t\t\thitPixel *= texelSize;\n\n\t\t\t\tintersect = rayIntersectDepth(rayZNear, rayZFar, hitPixel);\n\n\t\t\t\titerationCount += 1.0;\n\n\t\t        // PENDING Right on all platforms?\n\t\t\t\tif (intersect) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t    // Binary search refinement\n\t\t    // FIXME If intersect in first iteration binary search may easily lead to the pixel of reflect object it self\n\t\t\tif (pixStride > 1.0 && intersect && iterationCount > 1.0) {\n\t\t        // Roll back\n\t\t\t\tpqk -= dPQK;\n\t\t\t\tdPQK /= pixStride;\n\n\t\t\t\tfloat originalStride = pixStride * 0.5;\n\t\t\t\tfloat stride = originalStride;\n\n\t\t\t\trayZNear = pqk.z / pqk.w;\n\t\t\t\trayZFar = rayZNear;\n\n\t\t\t\tfor (int j = 0; j < 5; j++) {\n\t\t\t\t\tpqk += dPQK * stride;\n\t\t\t\t\trayZNear = rayZFar;\n\t\t\t\t\trayZFar = (dPQK.z * -0.5 + pqk.z) / (dPQK.w * -0.5 + pqk.w);\n\t\t\t\t\thitPixel = permute ? pqk.yx : pqk.xy;\n\t\t\t\t\thitPixel *= texelSize;\n\n\t\t\t\t\toriginalStride *= 0.5;\n\t\t\t\t\tstride = rayIntersectDepth(rayZNear, rayZFar, hitPixel) ? -originalStride : originalStride;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tQ0.xy += dQ.xy * iterationCount;\n\t\t\tQ0.z = pqk.z;\n\t\t\thitPoint = Q0 / pqk.w;\n\n\t\t\treturn intersect;\n\t\t}\n\n\t\tfloat calculateAlpha(float iterationCount, float reflectivity, vec2 hitPixel, vec3 hitPoint, float dist, vec3 rayDir) {\n\t\t\tfloat alpha = clamp(reflectivity, 0.0, 1.0);\n\t\t    // Fade ray hits that approach the maximum iterations\n\t\t\talpha *= 1.0 - (iterationCount / float(20));\n\t\t    // Fade ray hits that approach the screen edge\n\t\t\tvec2 hitPixelNDC = hitPixel * 2.0 - 1.0;\n\t\t\tfloat maxDimension = min(1.0, max(abs(hitPixelNDC.x), abs(hitPixelNDC.y)));\n\t\t\talpha *= 1.0 - max(0.0, maxDimension - screenEdgeFadeStart) / (1.0 - screenEdgeFadeStart);\n\n\t\t    // Fade ray hits base on how much they face the camera\n\t\t\tfloat _eyeFadeStart = eyeFadeStart;\n\t\t\tfloat _eyeFadeEnd = eyeFadeEnd;\n\t\t\tif (_eyeFadeStart > _eyeFadeEnd) {\n\t\t\t\tfloat tmp = _eyeFadeEnd;\n\t\t\t\t_eyeFadeEnd = _eyeFadeStart;\n\t\t\t\t_eyeFadeStart = tmp;\n\t\t\t}\n\n\t\t\tfloat eyeDir = clamp(rayDir.z, _eyeFadeStart, _eyeFadeEnd);\n\t\t\talpha *= 1.0 - (eyeDir - _eyeFadeStart) / (_eyeFadeEnd - _eyeFadeStart);\n\n\t\t    // Fade ray hits based on distance from ray origin\n\t\t\talpha *= 1.0 - clamp(dist / maxRayDistance, 0.0, 1.0);\n\n\t\t\treturn alpha;\n        }\n        \n        void main() {\n\t\t\tvec4 normalAndGloss = texture2D(gBufferTexture1, vUv);\n\n\t\t    // Is empty\n\t\t\tif (dot(normalAndGloss.rgb, vec3(1.0)) == 0.0) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tfloat g = normalAndGloss.a;\n\t\t\tif (g <= minGlossiness) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tfloat reflectivity = (g - minGlossiness) / (1.0 - minGlossiness);\n\n\t\t\tvec3 N = normalAndGloss.rgb * 2.0 - 1.0;\n            // N = normalize((viewInverseTranspose * vec4(N, 0.0)).xyz);\n            N = normalize(N);\n\n\t\t    // Position in view\n\t\t\tvec4 projectedPos = vec4(vUv * 2.0 - 1.0, fetchDepth(gBufferTexture2, vUv), 1.0);\n\t\t\tvec4 pos = projectionInv * projectedPos;\n\t\t\tvec3 rayOrigin = pos.xyz / pos.w;\n\n\t\t\tvec3 rayDir = normalize(reflect(normalize(rayOrigin), N));\n\t\t\tvec2 hitPixel;\n\t\t\tvec3 hitPoint;\n\t\t\tfloat iterationCount;\n\n\t\t    // Get jitter\n\t\t\tvec2 uv2 = vUv * viewportSize;\n\t\t\tfloat jitter = fract((uv2.x + uv2.y) * 0.25) + jitterOffset;\n\n\t\t\tbool intersect = traceScreenSpaceRay(rayOrigin, rayDir, jitter, hitPixel, hitPoint, iterationCount);\n\n\t\t\tfloat dist = distance(rayOrigin, hitPoint);\n\n\t\t\tfloat alpha = calculateAlpha(iterationCount, reflectivity, hitPixel, hitPoint, dist, rayDir) * float(intersect);\n\n\t\t\tvec3 hitNormal = texture2D(gBufferTexture1, hitPixel).rgb * 2.0 - 1.0;\n            // hitNormal = normalize((viewInverseTranspose * vec4(hitNormal, 0.0)).xyz);\n            hitNormal = normalize(hitNormal);\n\n\t\t    // Ignore the pixel not face the ray\n\t\t    // TODO fadeout ?\n\t\t    // PENDING Can be configured?\n\t\t\tif (dot(hitNormal, rayDir) >= 0.0) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t    // vec4 color = decodeHDR(texture2DLodEXT(colorTex, hitPixel, clamp(dist / maxRayDistance, 0.0, 1.0) * maxMipmapLevel));\n\n\t\t\tif (!intersect) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tvec4 color = texture2D(colorTex, hitPixel);\n\t\t\tgl_FragColor = vec4(color.rgb * alpha, color.a);\n\n            // gl_FragColor = vec4(vec3(iterationCount / 2.0), 1.0);\n            // gl_FragColor = texture2D(colorTex, vUv);\n\t\t}\n    "},bi={defines:{NORMALTEX_ENABLED:1,DEPTHTEX_ENABLED:1,DEPTH_PACKING:1},uniforms:{tDiffuse:{value:null},textureSize:{value:new THREE.Vector2},direction:{value:0},blurSize:{value:1},depthTex:{value:null},normalTex:{value:null},projection:{value:new THREE.Matrix4},depthRange:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <packing>","varying vec2 vUv;","uniform vec2 textureSize;","uniform float blurSize;","uniform sampler2D tDiffuse;","uniform int direction;","#if NORMALTEX_ENABLED == 1","uniform sampler2D normalTex;","vec3 getViewNormal( const in vec2 screenPosition ) {","return unpackRGBToNormal( texture2D( normalTex, screenPosition ).xyz );","}","#endif","#if DEPTHTEX_ENABLED == 1","uniform sampler2D depthTex;","uniform mat4 projection;","uniform float depthRange;","float getDepth( const in vec2 screenPosition ) {","#if DEPTH_PACKING == 1","return unpackRGBAToDepth( texture2D( depthTex, screenPosition ) );","#elif DEPTH_PACKING == 2","return texture2D( depthTex, screenPosition ).w;","#else","return texture2D( depthTex, screenPosition ).x;","#endif","}","float getLinearDepth(vec2 coord) {","float depth = getDepth(coord) * 2.0 - 1.0;","return projection[3][2] / (depth * projection[2][3] - projection[2][2]);","}","#endif","void main() {","float kernel[5];","kernel[0] = 0.122581;","kernel[1] = 0.233062;","kernel[2] = 0.288713;","kernel[3] = 0.233062;","kernel[4] = 0.122581;","vec2 off = vec2(0.0);","if (direction == 0) {","off[0] = blurSize / textureSize.x;","}","else {","off[1] = blurSize / textureSize.y;","}","vec4 sum = vec4(0.0);","float weightAll = 0.0;","#if NORMALTEX_ENABLED == 1","vec3 centerNormal = getViewNormal(vUv);","#endif","#if DEPTHTEX_ENABLED == 1","float centerDepth = getLinearDepth(vUv);","#endif","for (int i = 0; i < 5; i++) {","vec2 coord = clamp(vUv + vec2(float(i) - 2.0) * off, vec2(0.0), vec2(1.0));","float w = kernel[i];","#if NORMALTEX_ENABLED == 1","vec3 normal = getViewNormal(coord);","w *= clamp(dot(normal, centerNormal), 0.0, 1.0);","#endif","#if DEPTHTEX_ENABLED == 1","float d = getLinearDepth(coord);","w *= (1.0 - smoothstep(0.0, 1.0, abs(centerDepth - d) / depthRange));","#endif","weightAll += w;","sum += w * texture2D(tDiffuse, coord);","}","gl_FragColor = sum / weightAll;","}"].join("\n")},_i=function(){function e(t,n){r(this,e),this._tempRenderTarget=di(t,n),this._tempRenderTarget2=di(t,n),this._ssrPass=new Vn(yi,void 0,"viewportSize"),this._ssrPass.material.depthTest=!1,this._ssrPass.material.depthWrite=!1,this._blurPass=new Vn(bi,void 0,"textureSize"),this._blurPass.material.uniforms.blurSize.value=2,this._blurPass.material.depthTest=!1,this._blurPass.material.depthWrite=!1,this._ssrPass.setSize(1/t,1/n),this._blurPass.setSize(1/t,1/n),this.jitter=!1}return e.prototype.setSize=function(e,t){this._tempRenderTarget.setSize(e,t),this._tempRenderTarget2.setSize(e,t),this._ssrPass.setSize(1/e,1/t),this._blurPass.setSize(1/e,1/t)},e.prototype.render=function(e,t,n,i,r,o,a){this._ssrPass.material.uniforms.colorTex.value=e,this._ssrPass.material.uniforms.gBufferTexture1.value=t,this._ssrPass.material.uniforms.gBufferTexture2.value=n,this._ssrPass.material.uniforms.projection.value.copy(r.projectionMatrix),this._ssrPass.material.uniforms.projectionInv.value.getInverse(r.projectionMatrix),this._ssrPass.material.uniforms.jitterOffset.value=this.jitter?Math.random():0,this._blurPass.material.uniforms.normalTex.value=t,this._blurPass.material.uniforms.depthTex.value=n,this._blurPass.material.uniforms.projection.value.copy(r.projectionMatrix),n===t?this._blurPass.material.defines.DEPTH_PACKING=2:n.isDepthTexture?this._blurPass.material.defines.DEPTH_PACKING=0:this._blurPass.material.defines.DEPTH_PACKING=1,this._ssrPass.clearColor.setRGB(0,0,0),this._ssrPass.clearAlpha=1,this._ssrPass.render(i,this._tempRenderTarget),this._blurPass.clearColor.setRGB(0,0,0),this._blurPass.clearAlpha=1,this._blurPass.clear=!0,this._blurPass.material.uniforms.direction.value=0,this._blurPass.material.transparent=!1,this._blurPass.render(i,this._tempRenderTarget2,this._tempRenderTarget),a?(this._blurPass.clearColor.setRGB(0,0,0),this._blurPass.clearAlpha=1):this._blurPass.clear=!1,this._blurPass.material.uniforms.direction.value=1,this._blurPass.material.transparent=!a,this._blurPass.material.blending=a?THREE.NoBlending:THREE.AdditiveBlending,this._blurPass.render(i,void 0!==o?o:null,this._tempRenderTarget2)},e}(),xi=function(){function e(){r(this,e),this._schemeBuffer,this._dirty=!0,this.enable=!1,this.$enable=!0}return e.prototype.isActive=function(){return this.enable&&this.$enable},e.prototype.dispose=function(){},e.prototype.setSize=function(e,t){},e.prototype.render=function(e,t,n,i,r){},e.prototype.dirty=function(){this._dirty=!0},e}(),Ei=new THREE.Color,wi=function(){function e(t,n,i,o){r(this,e),this.name=i,this._mrt=Gn(i,t,n,void 0,o),this._rt=Wn(i,t,n),this.shareDepthRenderBuffer=!1,this._currentShareDepthRenderBuffer=!1,this.useMRT=!1,this.enableLayer1=!1}return e.prototype._checkStrategyInited=function(e){return e.materialManager.hasStrategy(this.name)},e.prototype._initStrategy=function(e){},e.prototype.applyShareRenderbuffer=function(e,t){this.shareDepthRenderBuffer!=this._currentShareDepthRenderBuffer&&(this.shareDepthRenderBuffer?(this._mrt.webglDepthRenderbuffer=e,this._rt.webglDepthRenderbuffer=t):(this._mrt.webglDepthRenderbuffer=null,this._rt.webglDepthRenderbuffer=null),this._mrt.dispose(),this._rt.dispose(),this._currentShareDepthRenderBuffer=this.shareDepthRenderBuffer)},e.prototype.setSize=function(e,t){this._mrt.setSize(e,t),this._rt.setSize(e,t)},e.prototype.render=function(e,t,n){this._checkStrategyInited(e)||this._initStrategy(e),Ei.copy(e.getClearColor());var i=e.getClearAlpha(),r=e.autoClear;e.autoClear=!1,e.setClearColor(0,0),e.materialManager.setMode(this.name),this._currentShareDepthRenderBuffer&&(e.state.buffers.depth.setMask(!1),e.state.buffers.depth.setLocked(!0));var o=t.autoUpdate,a=t.background,s=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,e.initRenderList=!1,e.renderCustom1=!1,this.enableLayer1&&n.layers.enable(1),e.setRenderTarget(this.useMRT?this._mrt:this._rt),e.clear(!0,!this._currentShareDepthRenderBuffer,!0),e.render(t,n),this.enableLayer1&&n.layers.disable(1),t.autoUpdate=o,t.background=a,e.shadowMap.enable=s,e.initRenderList=!0,e.renderCustom1=!0,this._currentShareDepthRenderBuffer&&e.state.buffers.depth.setLocked(!1),e.materialManager.setMode(0),e.autoClear=r,e.setClearColor(Ei,i)},e.prototype.setupRenderTarget=function(e){e.setRenderTarget(this.useMRT?this._mrt:this._rt)},e.prototype.getSchemeTexture=function(){return this.useMRT?this._mrt.texture:this._rt.texture},e.prototype.dispose=function(){this._mrt.dispose(),this._rt.dispose()},e}(),Ti=0,Mi=function(e){function t(n,i,o,a){r(this,t);var l=s(this,e.call(this,n,i,ci(o)+"Scheme_"+ ++Ti,a));return l.marker=o,l}return a(t,e),t.prototype._initStrategy=function(e){var t=this;e.materialManager.addStrategy(this.name,(function(e,n,i,r,o,a){if($n(this,o))return null;var s=Kn(this.technique,t.marker);if("skip"===s)return null;var l=void 0,u=!1;if(s){if(!s.isMaterial)return o;l=s,u=!0}else{if(t._currentShareDepthRenderBuffer)return null;l=Qn(this,o)}return Zn(l,o,u),l}))},t}(wi),Si=function(e){function t(n,i,o,a){var l;r(this,t),l=Array.isArray(o)?o.map((function(e){return ci(e)})).join(""):ci(o);var u=s(this,e.call(this,n,i,l,a));return u.marker=o,u}return a(t,e),t.prototype._initStrategy=function(e){var t=this;Array.isArray(t.marker)?e.materialManager.addStrategy(this.name,(function(e,n,i,r,o,a){if($n(this,o))return null;for(var s=void 0,l=0,u=t.marker.length;l<u;l++){var c=Kn(this.technique,t.marker[l]);if(c&&"skip"!=c&&"0"!=c){s=c;break}if(l===u-1){s=c;break}}if("skip"===s)return null;if(s)return s.isMaterial?s:"number"!=typeof s||isNaN(s)||1===s?o:Ai(o,s);if(t._currentShareDepthRenderBuffer)return null;var h=Qn(this,o);return Zn(h,o),h})):e.materialManager.addStrategy(this.name,(function(e,n,i,r,o,a){if($n(this,o))return null;var s=Kn(this.technique,t.marker);if("skip"===s)return null;if(s)return s.isMaterial?s:"number"!=typeof s||isNaN(s)||1===s?o:Ai(o,s);if(t._currentShareDepthRenderBuffer)return null;var l=Qn(this,o);return Zn(l,o),l}))},t}(Mi),Ci=new Map;function Ai(e,t){var n=e.uuid+"_"+t,i=Ci.get(n);return i||(e.addEventListener("dispose",Ri),(i=e.clone()).isShaderMaterial&&i.uniforms.strength?i.uniforms.strength.value=t:(t<1?e.transparent?(i.opacity=t,i.defines&&(i.defines.PREMULTIPLIED_ALPHA=!0),i.blending=THREE.CustomBlending,i.blendEquation=THREE.AddEquation,i.blendSrc=THREE.OneFactor,i.blendDst=THREE.ZeroFactor,i.blendSrcAlpha=THREE.ZeroFactor,i.blendDstAlpha=THREE.OneFactor):i.color?(i.color.r*=t,i.color.g*=t,i.color.b*=t):console.warn("strengthMat is not transparent and does not have color attribute"):i.color?(i.color.r*=t,i.color.g*=t,i.color.b*=t):console.warn("strengthMat does not have color attribute"),i.envMap=null),Ci.set(n,i)),i}function Ri(e){var t=e.target;t.removeEventListener("dispose",Ri);var n=[];Ci.forEach((function(e,i){i.indexOf(t.uuid)>-1&&n.push(i)})),n.forEach((function(e){Ci.get(e).dispose(),Ci.delete(e)}))}var Pi={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{type:"t",value:null},luminosityThreshold:{type:"f",value:1},smoothWidth:{type:"f",value:1},defaultColor:{type:"c",value:new THREE.Color(0)},defaultOpacity:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")},Di={defines:{KERNEL_RADIUS:7,SIGMA:7},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"#include <common>        varying vec2 vUv;\n        uniform sampler2D colorTexture;\n        uniform vec2 texSize;        uniform vec2 direction;                float gaussianPdf(in float x, in float sigma) {            return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;        }        void main() {\n            vec2 invSize = 1.0 / texSize;            float fSigma = float(SIGMA);            float weightSum = gaussianPdf(0.0, fSigma);            vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;            for( int i = 1; i < KERNEL_RADIUS; i ++ ) {                float x = float(i);                float w = gaussianPdf(x, fSigma);                vec2 uvOffset = direction * invSize * x;                vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;                vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;                diffuseSum += (sample1 + sample2) * w;                weightSum += 2.0 * w;            }            gl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n        }"},ki={defines:{NUM_MIPS:5},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"varying vec2 vUv;        uniform sampler2D blurTexture1;        uniform sampler2D blurTexture2;        uniform sampler2D blurTexture3;        uniform sampler2D blurTexture4;        uniform sampler2D blurTexture5;        uniform sampler2D dirtTexture;        uniform float bloomStrength;        uniform float bloomRadius;        uniform float bloomFactors[NUM_MIPS];        uniform vec3 bloomTintColors[NUM_MIPS];                float lerpBloomFactor(const in float factor) {             float mirrorFactor = 1.2 - factor;            return mix(factor, mirrorFactor, bloomRadius);        }                void main() {            gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +                                                 lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +                                                 lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +                                                 lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +                                                 lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );        }"},ji=new THREE.Vector2(1,0),Oi=new THREE.Vector2(0,1),Fi=function(e){function t(n,i,o){r(this,t);var a=s(this,e.call(this));a.strength=1.5,a.radius=.4,a.threshold=.2,a._schemeBuffer=new Si(n,i,o||"glow"),a.renderTargetsHorizontal=[],a.renderTargetsVertical=[],a.nMips=5;var l=0,u=Math.round(n/2),c=Math.round(i/2);for(a.renderTargetBright=di(u,c),a.renderTargetBright.texture.name="GlowPass.bright",l=0;l<a.nMips;l++){var h=di(u,c);h.texture.name="GlowPass.h"+l,a.renderTargetsHorizontal.push(h);var p=di(u,c);p.texture.name="GlowPass.v"+l,a.renderTargetsVertical.push(p),u=Math.round(u/2),c=Math.round(c/2)}a.highPass=new Vn(Pi),a.highPass.clearAlpha=0,a.highPass.uniforms.luminosityThreshold.value=a.threshold,a.highPass.uniforms.smoothWidth.value=.01,a.separableBlurPasses=[];var d=[3,5,7,9,11];for(u=Math.round(n/2),c=Math.round(i/2),l=0;l<a.nMips;l++){var f=new Vn(Di);f.clearAlpha=0,f.material.defines.KERNEL_RADIUS=d[l],f.material.defines.SIGMA=d[l],f.uniforms.texSize.value.set(u,c),a.separableBlurPasses.push(f),u=Math.round(u/2),c=Math.round(c/2)}a.compositePass=new Vn(ki),a.compositePass.clearAlpha=0,a.compositePass.material.defines.NUM_MIPS=5,a.compositePass.uniforms.blurTexture1.value=a.renderTargetsVertical[0].texture,a.compositePass.uniforms.blurTexture2.value=a.renderTargetsVertical[1].texture,a.compositePass.uniforms.blurTexture3.value=a.renderTargetsVertical[2].texture,a.compositePass.uniforms.blurTexture4.value=a.renderTargetsVertical[3].texture,a.compositePass.uniforms.blurTexture5.value=a.renderTargetsVertical[4].texture,a.compositePass.uniforms.bloomStrength.value=a.strength,a.compositePass.uniforms.bloomRadius.value=.1;return a.compositePass.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],a.bloomTintColors=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1)],a.compositePass.uniforms.bloomTintColors.value=a.bloomTintColors,a.copyPass=new Vn(Ln),a.copyPass.clearAlpha=0,a.copyPass.clear=!1,a.copyPass.uniforms.opacity.value=1,a.copyPass.material.blending=THREE.CustomBlending,a.copyPass.material.blendSrc=THREE.SrcAlphaFactor,a.copyPass.material.blendDst=THREE.OneFactor,a.copyPass.material.blendEquation=THREE.AddEquation,a.copyPass.material.blendSrcAlpha=THREE.ZeroFactor,a.copyPass.material.blendDstAlpha=THREE.OneFactor,a.copyPass.material.blendEquationAlpha=THREE.AddEquation,a.copyPass.material.depthTest=!1,a.copyPass.material.depthWrite=!1,a.copyPass.material.transparent=!0,a}return a(t,e),t.prototype.dispose=function(){this._schemeBuffer.dispose();for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()},t.prototype.setSize=function(e,t){this._schemeBuffer.setSize(e,t);var n=Math.round(e/2),i=Math.round(t/2);this.renderTargetBright.setSize(n,i);for(var r=0;r<this.nMips;r++)this.renderTargetsHorizontal[r].setSize(n,i),this.renderTargetsVertical[r].setSize(n,i),this.separableBlurPasses[r].uniforms.texSize.value.set(n,i),n=Math.round(n/2),i=Math.round(i/2)},t.prototype.render=function(e,t,n,i,r){if(this._dirty){this._schemeBuffer.useMRT=r,this._schemeBuffer.render(e,t,n),this.highPass.uniforms.tDiffuse.value=this._schemeBuffer.getSchemeTexture(),this.highPass.uniforms.luminosityThreshold.value=this.threshold,this.highPass.render(e,this.renderTargetBright);for(var o=this.renderTargetBright,a=0;a<this.nMips;a++)this.separableBlurPasses[a].uniforms.colorTexture.value=o.texture,this.separableBlurPasses[a].uniforms.direction.value.copy(ji),this.separableBlurPasses[a].render(e,this.renderTargetsHorizontal[a]),this.separableBlurPasses[a].uniforms.colorTexture.value=this.renderTargetsHorizontal[a].texture,this.separableBlurPasses[a].uniforms.direction.value.copy(Oi),this.separableBlurPasses[a].render(e,this.renderTargetsVertical[a]),o=this.renderTargetsVertical[a];this.compositePass.uniforms.bloomStrength.value=this.strength,this.compositePass.uniforms.bloomRadius.value=this.radius,this.compositePass.uniforms.bloomTintColors.value=this.bloomTintColors,this.compositePass.render(e,this.renderTargetsHorizontal[0]),this._dirty=!1}this.copyPass.render(e,i,this.renderTargetsHorizontal[0])},t}(xi),Bi={uniforms:{tDiffuse1:{value:null},tDiffuse2:{value:null},mixRatio:{value:.5},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse1, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","gl_FragColor = opacity * mix( texel1, texel2, mixRatio );","}"].join("\n")},Li={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},Ii={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},Ni=function(e){function t(n,i){r(this,t);var o=s(this,e.call(this));o.strength=1,o.blendRate=.7,o.blurSize=1,o._schemeBuffer=new Si(n,i,"lineBloom"),o.renderTargetsHorizontal=[],o.renderTargetsVertical=[],o.nMips=6;for(var a=n,l=i,u=0;u<o.nMips;u++){var c=di(a,l);c.texture.name="LineBloomPass.h"+u,o.renderTargetsHorizontal.push(c);var h=di(a,l);h.texture.name="LineBloomPass.v"+u,o.renderTargetsVertical.push(h),a=Math.round(a/2),l=Math.round(l/2)}return o._downSamplePass=new Vn(Hi),o._brightPass=new Vn(zi),o._blurXPass=new Vn(Ii),o._blurYPass=new Vn(Li),o._blendPass=new Vn(Bi),o._copyPass=new Vn(Ln),o._copyPass.clearAlpha=0,o._copyPass.clear=!1,o._copyPass.uniforms.opacity.value=1,o._copyPass.material.blending=THREE.CustomBlending,o._copyPass.material.blendSrc=THREE.OneFactor,o._copyPass.material.blendDst=THREE.OneFactor,o._copyPass.material.blendEquation=THREE.AddEquation,o._copyPass.material.blendSrcAlpha=THREE.ZeroFactor,o._copyPass.material.blendDstAlpha=THREE.OneFactor,o._copyPass.material.blendEquationAlpha=THREE.AddEquation,o._copyPass.material.depthTest=!1,o._copyPass.material.depthWrite=!1,o._copyPass.material.transparent=!0,o}return a(t,e),t.prototype.dispose=function(){this._schemeBuffer.dispose();for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose()},t.prototype.setSize=function(e,t){this._schemeBuffer.setSize(e,t);for(var n=e,i=t,r=0;r<this.nMips;r++)this.renderTargetsHorizontal[r].setSize(n,i),this.renderTargetsVertical[r].setSize(n,i),n=Math.round(n/2),i=Math.round(i/2)},t.prototype.render=function(e,t,n,i,r){if(this._dirty){this._schemeBuffer.useMRT=r,this._schemeBuffer.render(e,t,n),this._downSamplePass.uniforms.tDiffuse.value=this._schemeBuffer.getSchemeTexture(),this._downSamplePass.uniforms.texSize.value.set(this.renderTargetsHorizontal[0].width,this.renderTargetsHorizontal[0].height),this._downSamplePass.render(e,this.renderTargetsHorizontal[1]),this._brightPass.render(e,this.renderTargetsVertical[1],this.renderTargetsHorizontal[1]);for(var o=2;o<this.nMips;o++)this._downSamplePass.uniforms.texSize.value.set(this.renderTargetsVertical[o-1].width,this.renderTargetsVertical[o-1].height),this._downSamplePass.render(e,this.renderTargetsVertical[o],this.renderTargetsVertical[o-1]);for(var a=0;a<this.nMips-1;a++)this._blurXPass.uniforms.h.value=2*this.blurSize/this.renderTargetsHorizontal[a].width,this._blurXPass.render(e,this.renderTargetsHorizontal[a],this.renderTargetsVertical[a+1]);for(var s=0;s<this.nMips-1;s++)this._blurYPass.uniforms.v.value=2*this.blurSize/this.renderTargetsVertical[s].height,this._blurYPass.render(e,this.renderTargetsVertical[s],this.renderTargetsHorizontal[s]);for(var l=this.nMips-2;l>=0;l--)this._blendPass.uniforms.tDiffuse1.value=this.renderTargetsVertical[l].texture,this._blendPass.uniforms.tDiffuse2.value=this.renderTargetsVertical[l+1].texture,this._blendPass.uniforms.mixRatio.value=this.blendRate,this._blendPass.uniforms.opacity.value=this.strength,this._blendPass.render(e,this.renderTargetsHorizontal[l]);this._dirty=!1}this._copyPass.render(e,i,this.renderTargetsHorizontal[0])},t}(xi),Hi={uniforms:{tDiffuse:{value:null},texSize:{value:new THREE.Vector2(512,512)}},vertexShader:"\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}\n    ",fragmentShader:"\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec2 texSize;\n\t\t\n\t\tvoid main() {\n    \t\tvec4 d = vec4(-1.0, -1.0, 1.0, 1.0) / texSize.xyxy;\n\t\t\tgl_FragColor = (texture2D(tDiffuse, vUv + d.xy) +\n\t\t\t\ttexture2D(tDiffuse, vUv + d.zy) +\n\t\t\t\ttexture2D(tDiffuse, vUv + d.xw) +\n\t\t\t\ttexture2D(tDiffuse, vUv + d.zw)) * 0.25;\n\t\t}\n\t"},zi={uniforms:{tDiffuse:{value:null},scale:{value:4}},vertexShader:"\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}\n    ",fragmentShader:"\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float scale;\n\t\t\n\t\tvoid main() {\n\t\t\tgl_FragColor = texture2D(tDiffuse, vUv) * scale;\n\t\t}\n\t"},Ui={uniforms:{scene:{value:null},texSize:{value:new THREE.Vector2(1,1)},Stride:{value:10}},vertexShader:"\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvUv = uv;\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t}\n    ",fragmentShader:"\n\t#define WT9_0 1.0\n\t#define WT9_1 0.8\n\t#define WT9_2 0.6\n\t#define WT9_3 0.4\n\t#define WT9_4 0.2\n\t#define WT9_NORMALIZE 5.2\n\tvarying vec2 vUv;\n\tuniform sampler2D scene;\n\tuniform vec2 texSize;\n\tuniform float Stride;\n\tvoid main() {\n\t\tfloat TexelIncrement =0.25 * Stride /texSize.x;\n\n\t\tfloat colour = texture2D(scene,vec2(vUv.x + TexelIncrement, vUv.y) ).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +4.0 * TexelIncrement, vUv.y)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 1.0 * TexelIncrement, vUv.y)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 4.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement =0.5 * Stride /texSize.x;\n\t\tcolour += texture2D(scene,vec2(vUv.x + TexelIncrement, vUv.y) ).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +4.0 * TexelIncrement, vUv.y)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 1.0 * TexelIncrement, vUv.y)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 4.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement =0.75 * Stride /texSize.x;\n\t\tcolour += texture2D(scene,vec2(vUv.x + TexelIncrement, vUv.y) ).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +4.0 * TexelIncrement, vUv.y)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 1.0 * TexelIncrement, vUv.y)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 4.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement =Stride /texSize.x;\n\t\tcolour += texture2D(scene,vec2(vUv.x + TexelIncrement, vUv.y) ).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x +4.0 * TexelIncrement, vUv.y)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 1.0 * TexelIncrement, vUv.y)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 2.0 * TexelIncrement, vUv.y)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 3.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(scene, vec2(vUv.x - 4.0 * TexelIncrement, vUv.y)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tfloat col = 1.0-colour*0.25;\n\n\t\tgl_FragColor = vec4(col,col,col,col);\n\t}\n    "},Vi={uniforms:{blurX:{value:null},scene:{value:null},texSize:{value:new THREE.Vector2(1,1)},Stride:{value:10},Glowness:{value:2},GlowColor:{value:new THREE.Vector4(1,0,0,1)}},vertexShader:"\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvUv = uv;\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t}\n\t",fragmentShader:"\n\t#define WT9_0 1.0\n\t#define WT9_1 0.8\n\t#define WT9_2 0.6\n\t#define WT9_3 0.4\n\t#define WT9_4 0.2\n\t#define WT9_NORMALIZE 5.2\n\tvarying vec2 vUv;\n\tuniform vec2 texSize;\n\tuniform float Stride;\n\tuniform float Glowness;\n\tuniform vec4 GlowColor;\n\tuniform sampler2D blurX;\n\tuniform sampler2D scene;\n\tvoid main() {\n\n\t\tfloat TexelIncrement = 0.25 * Stride / texSize.y;\n\n\t\tfloat colour = texture2D(blurX, vec2(vUv.x , vUv.y+TexelIncrement)).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y +2.0 * TexelIncrement)).x* (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+3.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+4.0 * TexelIncrement)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 1.0 * TexelIncrement)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 2.0 * TexelIncrement)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 3.0 * TexelIncrement)).x* (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 4.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement = 0.5 * Stride / texSize.y;\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+TexelIncrement)).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y +2.0 * TexelIncrement)).x* (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+3.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+4.0 * TexelIncrement)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 1.0 * TexelIncrement)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 2.0 * TexelIncrement)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 3.0 * TexelIncrement)).x* (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 4.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement = 0.75 * Stride / texSize.y;\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+TexelIncrement)).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y +2.0 * TexelIncrement)).x* (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+3.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+4.0 * TexelIncrement)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 1.0 * TexelIncrement)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 2.0 * TexelIncrement)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 3.0 * TexelIncrement)).x* (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 4.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tTexelIncrement = Stride / texSize.y;\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+TexelIncrement)).x * (0.8/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y +2.0 * TexelIncrement)).x* (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+3.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y+4.0 * TexelIncrement)).x * (WT9_4/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y)).x * (WT9_0/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 1.0 * TexelIncrement)).x * (WT9_1/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 2.0 * TexelIncrement)).x * (WT9_2/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x, vUv.y - 3.0 * TexelIncrement)).x* (WT9_3/WT9_NORMALIZE);\n\t\tcolour += texture2D(blurX, vec2(vUv.x , vUv.y- 4.0 * TexelIncrement)).x * (WT9_3/WT9_NORMALIZE);\n\n\t\tvec4 glo = (0.25 * Glowness * colour) * GlowColor;\n\t\tvec4 OldCol = texture2D(scene, vec2(vUv.x , vUv.y));\n\t\t\n\t\tgl_FragColor = vec4(OldCol.x*glo.xyz,1);\n\t}\n\t"},qi=Xn(1,1,1),Gi=new Map;var Wi=0,Xi=function(e){function t(n,i,o,a){r(this,t);var l=s(this,e.call(this,n,i,ci(o)+"Scheme_"+ ++Wi,a));return l.marker=o,l}return a(t,e),t.prototype._initStrategy=function(e){var t=this;e.materialManager.addStrategy(this.name,(function(e,n,i,r,o,a){if($n(this,o))return null;var s=Kn(this.technique,t.marker);if("skip"===s)return null;var l=void 0,u=!1;if(s)l=s.isMaterial?s:function(e,t){var n=e.isInstancedMesh+"_"+t.skinning,i=void 0;return Gi.has(n)?i=Gi.get(n):((i=new THREE.ShaderMaterial(qi)).skinning=t.skinning,Gi.set(n,i)),i}(this,o),u=!0;else{if(t._currentShareDepthRenderBuffer)return null;l=Qn(this,o)}return Zn(l,o,u),l}))},t}(wi),Ji=function(e){function t(n,i){r(this,t);var o=s(this,e.call(this));return o.color=new THREE.Vector4(1,0,0,1),o.strength=2,o.stride=10,o._schemeBuffer=new Xi(n,i,"innerGlow"),o.tempRenderTarget=di(n,i),o.tempRenderTarget.texture.name="InnerGlowPass.temp",o.resultRenderTarget=di(n,i),o.resultRenderTarget.texture.name="InnerGlowPass.result",o._blurXPass=new Vn(Ui),o._blurXPass.uniforms.texSize.value.set(n,i),o._blurYPass=new Vn(Vi),o._blurYPass.uniforms.texSize.value.set(n,i),o._copyPass=new Vn(Ln),o._copyPass.clear=!1,o._copyPass.uniforms.opacity.value=1,o._copyPass.uniforms.tDiffuse.value=o.resultRenderTarget.texture,o._copyPass.material.blending=THREE.CustomBlending,o._copyPass.material.blendSrc=THREE.SrcAlphaFactor,o._copyPass.material.blendDst=THREE.OneFactor,o._copyPass.material.blendEquation=THREE.AddEquation,o._copyPass.material.blendSrcAlpha=THREE.ZeroFactor,o._copyPass.material.blendDstAlpha=THREE.OneFactor,o._copyPass.material.blendEquationAlpha=THREE.AddEquation,o._copyPass.material.depthTest=!1,o._copyPass.material.depthWrite=!1,o._copyPass.material.transparent=!0,o}return a(t,e),t.prototype.dispose=function(){this._schemeBuffer.dispose(),this.tempRenderTarget.dispose(),this.resultRenderTarget.dispose()},t.prototype.setSize=function(e,t){this._schemeBuffer.setSize(e,t),this.tempRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t),this._blurXPass.uniforms.texSize.value.set(e,t),this._blurYPass.uniforms.texSize.value.set(e,t)},t.prototype.render=function(e,t,n,i,r){this._dirty&&(this._schemeBuffer.useMRT=r,this._schemeBuffer.render(e,t,n),this._blurXPass.uniforms.scene.value=this._schemeBuffer.getSchemeTexture(),this._blurXPass.uniforms.Stride.value=this.stride,this._blurXPass.render(e,this.tempRenderTarget),this._blurYPass.uniforms.blurX.value=this.tempRenderTarget.texture,this._blurYPass.uniforms.scene.value=this._schemeBuffer.getSchemeTexture(),this._blurYPass.uniforms.Stride.value=this.stride,this._blurYPass.uniforms.Glowness.value=this.strength,this._blurYPass.uniforms.GlowColor.value.copy(this.color),this._blurYPass.render(e,this.resultRenderTarget),this._dirty=!1),this._copyPass.render(e,void 0!==i?i:null)},t}(xi),Yi=function(e){function t(n,i){r(this,t);var o=s(this,e.call(this));return o._schemeBuffer=new Mi(n,i,"radialBlur"),o.resultRenderTarget=di(n,i),o.resultRenderTarget.texture.name="RadialBlurPass.result",o._blurPass=new Vn(Qi),o._copyPass=new Vn(Ln),o._copyPass.clear=!1,o._copyPass.uniforms.opacity.value=1,o._copyPass.uniforms.tDiffuse.value=o.resultRenderTarget.texture,o._copyPass.material.blending=THREE.CustomBlending,o._copyPass.material.blendSrc=THREE.OneFactor,o._copyPass.material.blendDst=THREE.OneFactor,o._copyPass.material.blendEquation=THREE.AddEquation,o._copyPass.material.blendSrcAlpha=THREE.ZeroFactor,o._copyPass.material.blendDstAlpha=THREE.OneFactor,o._copyPass.material.blendEquationAlpha=THREE.AddEquation,o._copyPass.material.depthTest=!1,o._copyPass.material.depthWrite=!1,o._copyPass.material.transparent=!0,o}return a(t,e),t.prototype.dispose=function(){this._schemeBuffer.dispose(),this.resultRenderTarget.dispose()},t.prototype.setSize=function(e,t){this._schemeBuffer.setSize(e,t),this.resultRenderTarget.setSize(e,t)},t.prototype.render=function(e,t,n,i,r){this._dirty&&(this._schemeBuffer.useMRT=r,this._schemeBuffer.render(e,t,n),this._blurPass.uniforms.blurMap.value=this._schemeBuffer.getSchemeTexture(),this._blurPass.render(e,this.resultRenderTarget),this._dirty=!1),this._copyPass.render(e,void 0!==i?i:null)},t}(xi),Qi={uniforms:{blurMap:{value:null},BlurStart:{value:1},BlurWidth:{value:-.1},direction:{value:new THREE.Vector2(0,1)},Intensity:{value:10},GlowGamma:{value:.8},CX:{value:.5},CY:{value:.5}},vertexShader:"\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}\n    ",fragmentShader:"\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D blurMap;\n\t\tuniform float BlurStart;\n\t\tuniform float BlurWidth;\n\t\tuniform vec2 direction;\n\t\tuniform float Intensity;\n\t\tuniform float GlowGamma;\n\t\tuniform float CX;\n\t\tuniform float CY;\n\n\t\tvoid main() {\n\t\t\tvec2 texCoord = vUv;\n\t\t\tvec2 ctrPt = vec2(CX,CY);\n\t\t\tvec4 blurred = texture2D(blurMap, texCoord);\n\t\t\tvec2 resCoord = vec2(0.0);\n\t\t\tfor(float i=0.0; i<31.0; i++) {\n\t\t\t\tfloat scale = BlurStart + BlurWidth*((31.0-i)/(31.0-1.0));\n\t\t\t\tvec2 tmp = texCoord*scale;\n\t\t\t\tresCoord = mix(texCoord, tmp, direction);\n\t\t\t\tvec4 tmpc = texture2D(blurMap, resCoord )*(i/31.0)*(i/31.0);\n\t\t\t\tblurred += tmpc/31.0;\n\t\t\t}\n\n\t\t\tblurred.r = pow(blurred.r,GlowGamma);\n\t\t\tblurred.g = pow(blurred.g,GlowGamma);\n\t\t\tblurred.b = pow(blurred.b,GlowGamma);\n\t\t\tblurred.rgb *= Intensity;\n\t\t\tblurred.rgb = clamp(blurred.rgb, 0.0, 1.0);\n\n\t\t\tvec4 origTex = texture2D(blurMap, texCoord  );\n\t\t\tvec4 blurResult=origTex+blurred;\n\t\t\t//blurResult *= 2;\n\n\t\t\tvec2 dir=texCoord - ctrPt;\n\t\t\tfloat dist = sqrt( dir.x*dir.x + dir.y*dir.y );\n\t\t\tfloat t = dist * 1.0;\n\t\t\tt =  clamp(t, 0.0, 1.0);//We need 0 <= t <= 1\n\n\t\t\tgl_FragColor = blurResult*t;\n\t\t}\n\t"},Zi=function(e){function t(n,i){r(this,t);var o=s(this,e.call(this));return o._schemeBuffer=new Mi(n,i,"radialBlur2"),o.resultRenderTarget=di(n,i),o.resultRenderTarget.texture.name="RadialBlur2Pass.result",o._blurPass=new Vn(Ki),o._copyPass=new Vn(Ln),o._copyPass.clear=!1,o._copyPass.uniforms.opacity.value=1,o._copyPass.uniforms.tDiffuse.value=o.resultRenderTarget.texture,o._copyPass.material.blending=THREE.CustomBlending,o._copyPass.material.blendSrc=THREE.OneFactor,o._copyPass.material.blendDst=THREE.OneFactor,o._copyPass.material.blendEquation=THREE.AddEquation,o._copyPass.material.blendSrcAlpha=THREE.ZeroFactor,o._copyPass.material.blendDstAlpha=THREE.OneFactor,o._copyPass.material.blendEquationAlpha=THREE.AddEquation,o._copyPass.material.depthTest=!1,o._copyPass.material.depthWrite=!1,o._copyPass.material.transparent=!0,o}return a(t,e),t.prototype.dispose=function(){this._schemeBuffer.dispose(),this.resultRenderTarget.dispose()},t.prototype.setSize=function(e,t){this._schemeBuffer.setSize(e,t),this.resultRenderTarget.setSize(e,t)},t.prototype.render=function(e,t,n,i,r){this._dirty&&(this._schemeBuffer.useMRT=r,this._schemeBuffer.render(e,t,n),this._blurPass.uniforms.blurMap.value=this._schemeBuffer.getSchemeTexture(),this._blurPass.render(e,this.resultRenderTarget),this._dirty=!1),this._copyPass.render(e,void 0!==i?i:null)},t}(xi),Ki={uniforms:{blurMap:{value:null},BlurStart:{value:1},BlurWidth:{value:-.1},Intensity:{value:10},GlowGamma:{value:.8},CX:{value:.5},CY:{value:.5}},vertexShader:"\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}\n    ",fragmentShader:"\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D blurMap;\n\t\tuniform float BlurStart;\n\t\tuniform float BlurWidth;\n\t\tuniform float CX;\n\t\tuniform float CY;\n\t\tuniform float Intensity;\n\t\tuniform float GlowGamma;\n\t\t\n\t\tvoid main() {\n\t\t\tvec2 texCoord = vUv;\n\t\t\tvec2 ctrPt = vec2(CX,CY);\n\t\t\tvec4 blurred = texture2D(blurMap, texCoord );\n\t\t\n\t\t\tfor(float i=0.0; i<31.0; i++) {\n\t\t\t\tfloat scale = BlurStart + BlurWidth*((31.0-i)/(31.0-1.0));\n\t\t\t\tvec2 tmp = (texCoord - ctrPt)*scale + ctrPt;\n\t\t\t\tvec4 tmpc = texture2D(blurMap, tmp )*(i/31.0)*(i/31.0);\n\t\t\n\t\t\t\tblurred += tmpc/31.0;\n\t\t\n\t\t\t}\n\t\t\n\t\t\tblurred.r = pow(blurred.r,GlowGamma);\n\t\t\tblurred.g = pow(blurred.g,GlowGamma);\n\t\t\tblurred.b = pow(blurred.b,GlowGamma);\n\t\t\tblurred.rgb *= Intensity;\n\t\t\tblurred.rgb = clamp(blurred.rgb, 0.0, 1.0);\n\t\t\n\t\t\tvec4 origTex = texture2D(blurMap, texCoord  );\n\t\t\tvec4 blurResult=origTex+blurred;\n\t\t\t//blurResult *= 2;\n\t\t\n\t\t\tvec2 dir=texCoord - ctrPt;\n\t\t\tfloat dist = sqrt( dir.x*dir.x + dir.y*dir.y );\n\t\t\tfloat t = dist * 1.0;\n\t\t\tt =  clamp(t, 0.0, 1.0);//We need 0 <= t <= 1\n\t\t\n\t\t\tgl_FragColor = blurResult*t;\n\t\t}\n\t"},$i=function(e){function t(n,i){r(this,t);var o=s(this,e.call(this));return o._schemeBuffer=new Mi(n,i,"radialOffset"),o.resultRenderTarget=di(n,i),o.resultRenderTarget.texture.name="RadialOffsetPass.result",o._blurPass=new Vn(er),o._copyPass=new Vn(Ln),o._copyPass.uniforms.opacity.value=1,o._copyPass.uniforms.tDiffuse.value=o.resultRenderTarget.texture,o}return a(t,e),t.prototype.dispose=function(){this._schemeBuffer.dispose(),this.resultRenderTarget.dispose()},t.prototype.setSize=function(e,t){this._schemeBuffer.setSize(e,t),this.resultRenderTarget.setSize(e,t)},t.prototype.render=function(e,t,n,i,r){this._dirty&&(this._schemeBuffer.useMRT=r,this._schemeBuffer.render(e,t,n),this._dirty=!1),this._blurPass.uniforms.tex0.value=this._schemeBuffer.getSchemeTexture(),this._blurPass.uniforms.tex1.value=i.texture,this._blurPass.render(e,this.resultRenderTarget),this._copyPass.render(e,i)},t}(xi),er={uniforms:{tex0:{value:null},tex1:{value:null},BlurStart:{value:1},BlurWidth:{value:-.1},Intensity:{value:3},GlowGamma:{value:1},CX:{value:.5},CY:{value:.5}},vertexShader:"\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}\n    ",fragmentShader:"\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D tex0;\n\t\tuniform sampler2D tex1;\n\t\tuniform float BlurStart;\n\t\tuniform float BlurWidth;\n\t\tuniform float CX;\n\t\tuniform float CY;\n\t\tuniform float Intensity;\n\t\tuniform float GlowGamma;\n\t\t\n\t\t\n\t\tvoid main() {\n\t\t\tvec2 uv = vUv;\n\t\t\n\t\t\tvec2 ctrPt = vec2(CX,CY);\n\t\t\n\t\t\tfloat scale = BlurStart + BlurWidth*1.0;\n\t\t\tvec2 tmp = (uv - ctrPt)*scale + ctrPt;\n\t\t\tvec4 blurred = texture2D(tex0, tmp );\n\t\t\t\n\t\t\tblurred.rgb = pow(blurred.rgb,vec3(GlowGamma));\n\t\t\t\n\t\t\tblurred.rgb *= Intensity;\n\t\t\t\n\t\t\tblurred.rgb = clamp(blurred.rgb, 0.0, 1.0);\n\t\t\n\t\t\tvec4 origTex = texture2D(tex1, uv);\n\t\t\n\t\t\tvec4 blurResult=origTex+blurred;\n\t\t\t\n\t\t\tvec2 dir=uv - ctrPt;\n\t\t\t\n\t\t\tfloat dist = sqrt( dir.x*dir.x + dir.y*dir.y );\n\t\t\t\n\t\t\tfloat t = dist * 1.0;\n\t\t\t\n\t\t\tt = clamp( t, 0.0, 1.0 );\n\t\t\n\t\t\tgl_FragColor = mix(origTex, blurResult, t);\n\t\t}\n\t"},tr={uniforms:{colorMap:{value:null},maskMap:{value:null},darkFactor:{value:.5},brightFactor:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D colorMap;","uniform sampler2D maskMap;","uniform float darkFactor;","uniform float brightFactor;","varying vec2 vUv;","void main() {","float mask = texture2D( maskMap, vUv ).a;","vec4 color = texture2D( colorMap, vUv );","color.rgb = color.rgb * (1.0 - mask) * darkFactor + color.rgb * mask * brightFactor;","gl_FragColor = color;","}"].join("\n")},nr=Xn(1,1,1),ir=new Map;var rr=0,or=function(e){function t(n,i,o,a){r(this,t);var l=s(this,e.call(this,n,i,ci(o)+"Scheme_"+ ++rr,a));return l.marker=o,l}return a(t,e),t.prototype.applyShareRenderbuffer=function(e,t){},t.prototype._initStrategy=function(e){var t=this;e.materialManager.addStrategy(this.name,(function(e,n,i,r,o,a){if($n(this,o))return null;var s=Kn(this.technique,t.marker);if("skip"===s)return null;var l=void 0;return s?(Zn(l=s.isMaterial?s:function(e,t){var n=e.isInstancedMesh+"_"+t.skinning,i=void 0;return ir.has(n)?i=ir.get(n):((i=new THREE.ShaderMaterial(nr)).skinning=t.skinning,ir.set(n,i)),i}(this,o),o,!0),l):null}))},t}(wi),ar=function(e){function t(n,i){r(this,t);var o=s(this,e.call(this));return o.darkFactor=.5,o.brightFactor=1,o._schemeBuffer=new or(n,i,"focusRegion"),o.resultRenderTarget=di(n,i),o.resultRenderTarget.texture.name="FocusRegionPass.result",o._blendPass=new Vn(tr),o._copyPass=new Vn(Ln),o._copyPass.uniforms.opacity.value=1,o._copyPass.uniforms.tDiffuse.value=o.resultRenderTarget.texture,o}return a(t,e),t.prototype.dispose=function(){this._schemeBuffer.dispose(),this.resultRenderTarget.dispose()},t.prototype.setSize=function(e,t){this._schemeBuffer.setSize(e,t),this.resultRenderTarget.setSize(e,t)},t.prototype.render=function(e,t,n,i,r){this._dirty&&(this._schemeBuffer.useMRT=r,this._schemeBuffer.render(e,t,n),this._dirty=!1),this._blendPass.uniforms.colorMap.value=i.texture,this._blendPass.uniforms.maskMap.value=this._schemeBuffer.getSchemeTexture(),this._blendPass.uniforms.darkFactor.value=this.darkFactor,this._blendPass.uniforms.brightFactor.value=this.brightFactor,this._blendPass.render(e,this.resultRenderTarget),this._copyPass.render(e,i)},t}(xi),sr=Xn(0,1,1),lr=new Map;var ur=function(e){function t(n,i,o){r(this,t);var a=s(this,e.call(this,n,i,"OutlineScheme_"+o));return a._edgeColorString=o,a.enableLayer1=!0,a}return a(t,e),t.prototype._initStrategy=function(e){var t=this;e.materialManager.addStrategy(this.name,(function(e,n,i,r,o,a){if(!this.userData.forceOutline&&!i.layers.test(this.layers))return null;var s="outline_0x"+t._edgeColorString,l=Kn(this.technique,s);return l&&"skip"!==l?this.technique[s].isMaterial?this.technique[s]:function(e,t){var n=e.isInstancedMesh+"_"+t.skinning,i=void 0;return lr.has(n)?i=lr.get(n):((i=new THREE.ShaderMaterial(sr)).side=THREE.DoubleSide,i.skinning=t.skinning,lr.set(n,i)),i}(this,o):null}))},t}(wi),cr={uniforms:{maskTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},edgeColor:{value:new THREE.Color(1,1,1)}},fragmentShader:"\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D maskTexture;\n\t\tuniform vec2 texSize;\n\t\tuniform vec3 edgeColor;\n\t\t\n\t\tvoid main() {\n\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\n\t\t\tvec4 c1 = texture2D(maskTexture, vUv + uvOffset.xy);\n\t\t\tvec4 c2 = texture2D(maskTexture, vUv - uvOffset.xy);\n\t\t\tvec4 c3 = texture2D(maskTexture, vUv + uvOffset.yw);\n\t\t\tvec4 c4 = texture2D(maskTexture, vUv - uvOffset.yw);\n\t\t\tfloat b1 = max(c1.b, c2.b);\n\t\t\tfloat b2 = max(c3.b, c4.b);\n\t\t\tfloat a = max(b1, b2);\n\t\t\tgl_FragColor = vec4(edgeColor, a);\n\t\t}\n\t"},hr={defines:{MAX_RADIUS:4},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)},kernelRadius:{value:1}},fragmentShader:"\n\t\t#include <common>\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D colorTexture;\n\t\tuniform vec2 texSize;\n\t\tuniform vec2 direction;\n\t\tuniform float kernelRadius;\n\t\t\n\t\tfloat gaussianPdf(in float x, in float sigma) {\n\t\t\treturn 0.39894 * exp(-0.5 * x * x / (sigma * sigma)) / sigma;\n\t\t}\n\t\tvoid main() {\n\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\n\t\t\tvec4 diffuseColor = texture2D(colorTexture, vUv);\n\t\t\tvec4 diffuseSum = diffuseColor * weightSum;\n\t\t\tvec2 delta = direction * invSize * kernelRadius / float(MAX_RADIUS);\n\t\t\tvec2 uvOffset = delta;\n\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\n\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\n\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\n\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\n\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\n\t\t\t\tweightSum += (2.0 * w);\n\t\t\t\tuvOffset += delta;\n\t\t\t}\n\t\t\tvec4 color = diffuseSum / weightSum;\n\t\t\tgl_FragColor = color;\n\t\t}\n\t"},pr={uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},edgeStrength:{value:1},edgeGlow:{value:1}},fragmentShader:"\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D maskTexture;\n\t\tuniform sampler2D edgeTexture1;\n\t\tuniform sampler2D edgeTexture2;\n\t\tuniform float edgeStrength;\n\t\tuniform float edgeGlow;\n\t\t\n\t\tvoid main() {\n\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\n\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\n\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\n\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\n\t\t\tvec4 finalColor = edgeStrength * edgeValue;\n\t\t\tfloat a = finalColor.a * (1.0 - maskColor.b);\n\t\t\tgl_FragColor = vec4(finalColor.rgb, a);\n\t\t}\n\t"},dr=function(e){function t(n,i,o){r(this,t);var a=s(this,e.call(this));a.edgeColor=(new THREE.Color).setHex(void 0!==o?o:16777215),a.edgeGlow=0,a.edgeThickness=1,a.edgeStrength=1.5,a.downSampleRatio=2,a._schemeBuffer=new ur(n,i,a.edgeColor.getHexString());var l=Math.round(n/a.downSampleRatio),u=Math.round(i/a.downSampleRatio);return a.renderTargetMaskDownSampleBuffer=di(l,u),a.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",a.renderTargetBlurBuffer1=di(l,u),a.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",a.renderTargetBlurBuffer2=di(Math.round(l/2),Math.round(u/2)),a.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",a.renderTargetEdgeBuffer1=di(l,u),a.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",a.renderTargetEdgeBuffer2=di(Math.round(l/2),Math.round(u/2)),a.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",a._copyPass=new Vn(Ln),a._copyPass.clearAlpha=0,a._copyPass.uniforms.opacity.value=1,a._copyPass.material.blending=THREE.NoBlending,a._copyPass.material.depthTest=!1,a._copyPass.material.depthWrite=!1,a._copyPass.material.transparent=!0,a._edgeDetectionPass=new Vn(cr),a._edgeDetectionPass.clearAlpha=0,a._edgeDetectionPass.textureID="maskTexture",a._blur1Pass=new Vn(hr),a._blur1Pass.clearAlpha=0,a._blur1Pass.textureID="colorTexture",a._blur1Pass.uniforms.texSize.value.set(l,u),a._blur1Pass.material.defines.MAX_RADIUS=4,a._blur1Pass.uniforms.kernelRadius.value=1,a._blur2Pass=new Vn(hr),a._blur2Pass.clearAlpha=0,a._blur2Pass.textureID="colorTexture",a._blur2Pass.uniforms.texSize.value.set(Math.round(l/2),Math.round(u/2)),a._blur2Pass.material.defines.MAX_RADIUS=4,a._blur2Pass.uniforms.kernelRadius.value=4,a._overlayPass=new Vn(pr),a._overlayPass.clear=!1,a._overlayPass.material.blending=THREE.NormalBlending,a._overlayPass.material.depthTest=!1,a._overlayPass.material.depthWrite=!1,a._overlayPass.material.transparent=!0,a._overlayPass.uniforms.edgeTexture1.value=a.renderTargetEdgeBuffer1.texture,a._overlayPass.uniforms.edgeTexture2.value=a.renderTargetEdgeBuffer2.texture,a}return a(t,e),t.prototype.dispose=function(){this._schemeBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},t.prototype.setSize=function(e,t){this._schemeBuffer.setSize(e,t);var n=Math.round(e/this.downSampleRatio),i=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(n,i),this.renderTargetBlurBuffer1.setSize(n,i),this.renderTargetEdgeBuffer1.setSize(n,i),this._blur1Pass.uniforms.texSize.value.set(n,i),n=Math.round(n/2),i=Math.round(i/2),this.renderTargetBlurBuffer2.setSize(n,i),this.renderTargetEdgeBuffer2.setSize(n,i),this._blur2Pass.uniforms.texSize.value.set(n,i)},t.prototype.render=function(e,t,n,i,r){this._dirty&&(this._schemeBuffer.useMRT=r,this._schemeBuffer.render(e,t,n),this._copyPass.uniforms.tDiffuse.value=this._schemeBuffer.getSchemeTexture(),this._copyPass.render(e,this.renderTargetMaskDownSampleBuffer),this._edgeDetectionPass.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this._edgeDetectionPass.uniforms.edgeColor.value.copy(this.edgeColor),this._edgeDetectionPass.render(e,this.renderTargetEdgeBuffer1,this.renderTargetMaskDownSampleBuffer),this._blur1Pass.uniforms.kernelRadius.value=this.edgeThickness,this._blur1Pass.uniforms.direction.value.set(1,0),this._blur1Pass.render(e,this.renderTargetBlurBuffer1,this.renderTargetEdgeBuffer1),this._blur1Pass.uniforms.direction.value.set(0,1),this._blur1Pass.render(e,this.renderTargetEdgeBuffer1,this.renderTargetBlurBuffer1),this.edgeGlow>0&&(this._blur2Pass.uniforms.direction.value.set(1,0),this._blur2Pass.render(e,this.renderTargetBlurBuffer2,this.renderTargetEdgeBuffer1),this._blur2Pass.uniforms.direction.value.set(0,1),this._blur2Pass.render(e,this.renderTargetEdgeBuffer2,this.renderTargetBlurBuffer2)),this._overlayPass.uniforms.maskTexture.value=this._schemeBuffer.getSchemeTexture(),this._overlayPass.uniforms.edgeStrength.value=this.edgeStrength,this._overlayPass.uniforms.edgeGlow.value=this.edgeGlow,this._dirty=!1),this._overlayPass.render(e,void 0!==i?i:null)},t.prototype.dirty=function(){this._dirty=!0},t}(xi),fr=function(e,t){for(var n=0,i=1/t,r=e;r>0;)n+=i*(r%t),r=Math.floor(r/t),i/=t;return n};function mr(e,t,n){this._samplingSize=n||30;for(var i=[],r=0;r<this._samplingSize;r++)i.push([fr(r,2),fr(r,3)]);this._haltonSequence=i,this._prevFrame=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this._output=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this._frame=0,this.quadCamera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.quadScene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(Bi.uniforms),vertexShader:Bi.vertexShader,fragmentShader:Bi.fragmentShader,depthTest:!1,depthWrite:!1})),this.quadScene.add(this.quadCamera),this.quadScene.add(this.quad)}mr.prototype=Object.assign(mr.prototype,{constructor:mr,setSize:function(e,t){this._prevFrame.setSize(e,t),this._output.setSize(e,t)},setSamplingSize:function(e){this._samplingSize=e||30;for(var t=[],n=0;n<this._samplingSize;n++)t.push([fr(n,2),fr(n,3)]);this._haltonSequence=t,this._frame=0},getSamplingSize:function(){return this._samplingSize},start:function(){this._frame=0},finished:function(){return this._frame>=this._samplingSize},frame:function(){return this._frame},jitterProjection:function(e,t,n){var i=this._haltonSequence[this._frame];i||console.error("THREE.SuperSampler: try to jitter camera after finished!",this._frame,this._haltonSequence.length),e.setViewOffset&&e.setViewOffset(t,n,.5*(2*i[0]-1),.5*(2*i[1]-1),t,n)},sample:function(e,t){var n=0===this._frame;this.quad.material.uniforms.tDiffuse1.value=t,this.quad.material.uniforms.tDiffuse2.value=this._prevFrame.texture,this.quad.material.uniforms.mixRatio.value=n?0:.9,this.quad.material.uniforms.opacity.value=1;var i=e.getClearColor().getHex(),r=e.getClearAlpha();e.setClearColor(0,0),e.setRenderTarget(this._output),e.clear(),e.render(this.quadScene,this.quadCamera),e.setClearColor(i,r);var o=this._prevFrame;return this._prevFrame=this._output,this._output=o,this._frame++,this._prevFrame},output:function(){return this._prevFrame}});var gr={temporalSuperSampling:{enable:!1,size:30},postEffect:{enable:!0,bloom:{enable:!1,strength:.14,radius:.4,threshold:.7},screenSpaceAmbientOcclusion:{enable:!1,radius:.2,quality:"medium",intensity:.8,temporalFilter:!0,ignoreTransparent:!1},screenSpaceReflection:{enable:!1,maxRayDistance:200,pixelStride:16,pixelStrideZCutoff:50,screenEdgeFadeStart:.9,eyeFadeStart:.4,eyeFadeEnd:.8,minGlossiness:.2,temporalFilter:!0},colorCorrection:{enable:!0,exposure:0,brightness:0,contrast:1.1,saturation:1.1,gamma:1},dof:{enable:!1,focalDepth:1,focalLength:24,fstop:.9,maxblur:1,threshold:.9,gain:1,bias:.5,dithering:1e-4},vignette:{enable:!1,type:"color",color:0,offset:1},film:{enable:!1,grayscale:!0,noiseIntensity:.35,scanlinesIntensity:.5,scanlinesCount:2048},chromaticAberration:{enable:!1,chromaFactor:.025},blur:{enable:!1,bounds:[[0,0,1,1]],radius:5},FXAA:{enable:!1},MSAA:{enable:!0}}},vr=function(){function e(){r(this,e),this.needSwapBuffer=!0}return e.prototype.setSize=function(e,t){},e.prototype.render=function(e,t,n,i,r){console.error("Effect: .render() must be implemented in derived pass.")},e}(),yr=function(e){function t(n,i,o){r(this,t);var a=s(this,e.call(this));return a._pass=n,void 0!==i&&void 0!==o&&a.setSize(i,o),a}return a(t,e),t.prototype.setSize=function(e,t){this._pass.setSize(e,t)},t.prototype.render=function(e,t,n,i,r){this._pass.render(e,t,n,i,r)},t}(vr),br=new THREE.Vector2(1,0),_r=new THREE.Vector2(0,1),xr=function(e){function t(n,i){r(this,t);var o=s(this,e.call(this));o.needSwapBuffer=!1,o.strength=.14,o.radius=.4,o.threshold=.6,o.renderTargetsHorizontal=[],o.renderTargetsVertical=[],o.nMips=5;var a=0,l=Math.round(n/2),u=Math.round(i/2);for(o.renderTargetBright=di(l,u),o.renderTargetBright.texture.name="BloomEffect.bright",a=0;a<o.nMips;a++){var c=di(l,u);c.texture.name="BloomEffect.h"+a,o.renderTargetsHorizontal.push(c);var h=di(l,u);h.texture.name="BloomEffect.v"+a,o.renderTargetsVertical.push(h),l=Math.round(l/2),u=Math.round(u/2)}o.highPass=new Vn(Pi),o.highPass.clearAlpha=0,o.highPass.uniforms.luminosityThreshold.value=o.threshold,o.highPass.uniforms.smoothWidth.value=.01,o.separableBlurPasses=[];var p=[3,5,7,9,11];for(l=Math.round(n/2),u=Math.round(i/2),a=0;a<o.nMips;a++){var d=new Vn(Di);d.clearAlpha=0,d.material.defines.KERNEL_RADIUS=p[a],d.material.defines.SIGMA=p[a],d.uniforms.texSize.value.set(l,u),o.separableBlurPasses.push(d),l=Math.round(l/2),u=Math.round(u/2)}o.compositePass=new Vn(ki),o.compositePass.clearAlpha=0,o.compositePass.material.defines.NUM_MIPS=5,o.compositePass.uniforms.blurTexture1.value=o.renderTargetsVertical[0].texture,o.compositePass.uniforms.blurTexture2.value=o.renderTargetsVertical[1].texture,o.compositePass.uniforms.blurTexture3.value=o.renderTargetsVertical[2].texture,o.compositePass.uniforms.blurTexture4.value=o.renderTargetsVertical[3].texture,o.compositePass.uniforms.blurTexture5.value=o.renderTargetsVertical[4].texture,o.compositePass.uniforms.bloomStrength.value=o.strength,o.compositePass.uniforms.bloomRadius.value=.1;return o.compositePass.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],o.bloomTintColors=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1)],o.compositePass.uniforms.bloomTintColors.value=o.bloomTintColors,o.copyPass=new Vn(Ln),o.copyPass.clear=!1,o.copyPass.uniforms.opacity.value=1,o.copyPass.material.blending=THREE.CustomBlending,o.copyPass.material.blendSrc=THREE.SrcAlphaFactor,o.copyPass.material.blendDst=THREE.OneFactor,o.copyPass.material.blendEquation=THREE.AddEquation,o.copyPass.material.blendSrcAlpha=THREE.ZeroFactor,o.copyPass.material.blendDstAlpha=THREE.OneFactor,o.copyPass.material.blendEquationAlpha=THREE.AddEquation,o.copyPass.material.depthTest=!1,o.copyPass.material.depthWrite=!1,o.copyPass.material.transparent=!0,o}return a(t,e),t.prototype.setSize=function(e,t){var n=Math.round(e/2),i=Math.round(t/2);this.renderTargetBright.setSize(n,i);for(var r=0;r<this.nMips;r++)this.renderTargetsHorizontal[r].setSize(n,i),this.renderTargetsVertical[r].setSize(n,i),this.separableBlurPasses[r].uniforms.texSize.value.set(n,i),n=Math.round(n/2),i=Math.round(i/2)},t.prototype.render=function(e,t,n,i,r){this.highPass.uniforms.luminosityThreshold.value=this.threshold,this.highPass.render(e,this.renderTargetBright,n);for(var o=this.renderTargetBright,a=0;a<this.nMips;a++)this.separableBlurPasses[a].uniforms.colorTexture.value=o.texture,this.separableBlurPasses[a].uniforms.direction.value.copy(br),this.separableBlurPasses[a].render(e,this.renderTargetsHorizontal[a]),this.separableBlurPasses[a].uniforms.colorTexture.value=this.renderTargetsHorizontal[a].texture,this.separableBlurPasses[a].uniforms.direction.value.copy(_r),this.separableBlurPasses[a].render(e,this.renderTargetsVertical[a]),o=this.renderTargetsVertical[a];this.compositePass.uniforms.bloomStrength.value=this.strength,this.compositePass.uniforms.bloomRadius.value=this.radius,this.compositePass.uniforms.bloomTintColors.value=this.bloomTintColors,this.compositePass.render(e,this.renderTargetsHorizontal[0]),this.copyPass.render(e,n,this.renderTargetsHorizontal[0])},t}(vr),Er={defines:{USE_VIGNETTE_TEXTURE:!1},uniforms:{tDiffuse:{value:null},vignetteOffset:{value:1},vignetteColor:{value:new THREE.Color(0)},vignetteTexture:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    ",fragmentShader:"\n\t    uniform sampler2D tDiffuse;\n\n\t\tuniform float vignetteOffset;\n        uniform vec3 vignetteColor;\n        \n        #ifdef USE_VIGNETTE_TEXTURE\n            uniform sampler2D vignetteTexture;\n        #endif\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 color = texture2D(tDiffuse, vUv);\n            vec2 uv = (vUv - vec2(0.5)) * vec2(vignetteOffset);\n            \n            vec3 color2 = vignetteColor;\n\n            #ifdef USE_VIGNETTE_TEXTURE\n                color2 *= texture2D(vignetteTexture, vUv).rgb;\n            #endif\n\n\t\t\tcolor.rgb = mix(color.rgb, color2, clamp(dot(uv, uv), 0.0, 1.0));\n\t\t\tgl_FragColor = color;\n\n\t\t}\n    "},wr=function(e){function t(n,i){r(this,t);var o=s(this,e.call(this));return o.type="color",o.color=new THREE.Color(0),o.offset=1,o.tempRenderTarget=di(n/2,i/2),o.tempRenderTarget2=di(n/2,i/2),o.effectHBlur=new Vn(Ii),o.effectVBlur=new Vn(Li),o.effectHBlur.uniforms.h.value=4/n,o.effectVBlur.uniforms.v.value=4/i,o.blendPass=new Vn(Er),o}return a(t,e),t.prototype.setSize=function(e,t){this.tempRenderTarget.setSize(e/2,t/2),this.tempRenderTarget2.setSize(e/2,t/2),this.effectHBlur.uniforms.h.value=4/e,this.effectVBlur.uniforms.v.value=4/t},t.prototype.render=function(e,t,n,i,r){"color"===this.type?(this.blendPass.uniforms.vignetteOffset.value=this.offset,this.blendPass.uniforms.vignetteColor.value.copy(this.color),this.blendPass.material.defines.USE_VIGNETTE_TEXTURE&&(this.blendPass.material.defines.USE_VIGNETTE_TEXTURE=!1,this.blendPass.material.needsUpdate=!0)):"blur"===this.type&&(this.effectHBlur.render(e,this.tempRenderTarget2,n),this.effectVBlur.render(e,this.tempRenderTarget,this.tempRenderTarget2),this.blendPass.uniforms.vignetteOffset.value=this.offset,this.blendPass.uniforms.tDiffuse.value=n.texture,this.blendPass.uniforms.vignetteTexture.value=this.tempRenderTarget.texture,this.blendPass.uniforms.vignetteColor.value.setRGB(1,1,1),this.blendPass.material.defines.USE_VIGNETTE_TEXTURE||(this.blendPass.material.defines.USE_VIGNETTE_TEXTURE=!0,this.blendPass.material.needsUpdate=!0)),this.blendPass.render(e,t,n)},t}(vr),Tr={defines:{USE_MASKMAP:0},uniforms:{tDiffuse:{value:null},bounds:{value:new THREE.Vector4(0,0,1,1)},filletXRadius:{value:new THREE.Vector4},filletYRadius:{value:new THREE.Vector4},blendTexture:{value:null},maskMap:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    ",fragmentShader:"\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D blendTexture;\n\n\t\tuniform vec4 bounds;\n\n\t\tuniform vec4 filletXRadius;\n\t\tuniform vec4 filletYRadius;\n\n\t\tuniform sampler2D maskMap;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\t\t\tvec4 color = texture2D(tDiffuse, vUv);\n\t\t\tvec3 color2 = texture2D(blendTexture, vUv).rgb;\n\t\t\t\n\t\t\tvec2 blurCenter = (bounds.xy + bounds.zw) * 0.5;\n\t\t\tvec2 blurSize = bounds.zw - bounds.xy;\n\n\t\t\tvec2 uv = vUv.xy;\n\t\t\tuv.y = 1.0 - uv.y;\n\n\t\t\tvec2 blurCoords = (uv - blurCenter) / blurSize;\n\n\t\t\t#if USE_MASKMAP\n\t\t\t\tblurCoords = abs(blurCoords);\n\n\t\t\t\tvec2 newUv = (uv - bounds.xy) / blurSize;\n\t\t\t\tnewUv.y = 1. - newUv.y;\n\n\t\t\t\tfloat blend = texture2D(maskMap, newUv).r;\n\t\t\t\tblend *= step(blurCoords.x, 0.5) * step(blurCoords.y, 0.5);\n\t\t\t#else\n\t\t\t\tvec2 filletRadius = vec2(0.);\n\n\t\t\t\tif (blurCoords.x > 0. && blurCoords.y < 0.) {\n\t\t\t\t\tfilletRadius.x = filletXRadius[1];\n\t\t\t\t\tfilletRadius.y = filletYRadius[1];\n\t\t\t\t} else if (blurCoords.x < 0. && blurCoords.y < 0.) {\n\t\t\t\t\tfilletRadius.x = filletXRadius[0];\n\t\t\t\t\tfilletRadius.y = filletYRadius[0];\n\t\t\t\t} else if (blurCoords.x < 0. && blurCoords.y > 0.) {\n\t\t\t\t\tfilletRadius.x = filletXRadius[2];\n\t\t\t\t\tfilletRadius.y = filletYRadius[2];\n\t\t\t\t} else if (blurCoords.x > 0. && blurCoords.y > 0.) {\n\t\t\t\t\tfilletRadius.x = filletXRadius[3];\n\t\t\t\t\tfilletRadius.y = filletYRadius[3];\n\t\t\t\t}\n\n\t\t\t\tblurCoords = abs(blurCoords);\n\n\t\t\t\tvec2 coreRange = 0.5 - filletRadius;\n\n\t\t\t\tfloat rx = blurCoords.x - coreRange.x;\n\t\t\t\tfloat ry = blurCoords.y - coreRange.y;\n\n\t\t\t\tfloat blend = step(blurCoords.x, 0.5) * step(blurCoords.y, 0.5) \n\t\t\t\t\t* (\n\t\t\t\t\t\t1.0 - step(coreRange.x, blurCoords.x)\n\t\t\t\t\t\t* step(coreRange.y, blurCoords.y)\n\t\t\t\t\t\t* step(filletRadius.x * filletRadius.x * filletRadius.y * filletRadius.y, rx * rx * filletRadius.y * filletRadius.y + ry * ry * filletRadius.x * filletRadius.x)\n\t\t\t\t\t);\n\t\t\t#endif\n\n\t\t\tcolor.rgb = mix(color.rgb, color2, blend);\n\t\t\tgl_FragColor = color;\n\t\t}\n    "},Mr={defines:{SAMPLERS:9},uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)},direction:{value:new THREE.Vector2(1,0)}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }\n    ",fragmentShader:"\n        uniform sampler2D tDiffuse;\n        uniform vec2 resolution;\n        uniform vec2 direction;\n        varying vec2 vUv;\n\n        #if (SAMPLERS == 5) \n            vec4 blur(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n                vec4 color = vec4(0.0);\n                vec2 off1 = vec2(1.3333333333333333) * direction;\n                color += texture2D(image, uv) * 0.29411764705882354;\n                color += texture2D(image, uv + (off1 * resolution)) * 0.35294117647058826;\n                color += texture2D(image, uv - (off1 * resolution)) * 0.35294117647058826;\n                return color; \n            }\n        #endif\n        #if (SAMPLERS == 9)\n            vec4 blur(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n                vec4 color = vec4(0.0);\n                vec2 off1 = vec2(1.3846153846) * direction;\n                vec2 off2 = vec2(3.2307692308) * direction;\n                color += texture2D(image, uv) * 0.2270270270;\n                color += texture2D(image, uv + (off1 * resolution)) * 0.3162162162;\n                color += texture2D(image, uv - (off1 * resolution)) * 0.3162162162;\n                color += texture2D(image, uv + (off2 * resolution)) * 0.0702702703;\n                color += texture2D(image, uv - (off2 * resolution)) * 0.0702702703;\n                return color;\n            }\n        #endif\n        #if (SAMPLERS == 13)\n            vec4 blur(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n                vec4 color = vec4(0.0);\n                vec2 off1 = vec2(1.411764705882353) * direction;\n                vec2 off2 = vec2(3.2941176470588234) * direction;\n                vec2 off3 = vec2(5.176470588235294) * direction;\n                color += texture2D(image, uv) * 0.1964825501511404;\n                color += texture2D(image, uv + (off1 * resolution)) * 0.2969069646728344;\n                color += texture2D(image, uv - (off1 * resolution)) * 0.2969069646728344;\n                color += texture2D(image, uv + (off2 * resolution)) * 0.09447039785044732;\n                color += texture2D(image, uv - (off2 * resolution)) * 0.09447039785044732;\n                color += texture2D(image, uv + (off3 * resolution)) * 0.010381362401148057;\n                color += texture2D(image, uv - (off3 * resolution)) * 0.010381362401148057;\n                return color;\n            }\n        #endif\n\n        void main() {\n            gl_FragColor = blur(tDiffuse, vUv, resolution, direction);\n        }\n    "},Sr=function(e){function t(n,i){r(this,t);var o=s(this,e.call(this));return o.tempRenderTarget=di(n,i),o.tempRenderTarget2=di(n,i),o.tempRenderTarget3=di(n,i),o.tempRenderTarget4=di(n,i),o.blurPass=new Vn(Mr),o.blendPass=new Vn(Tr),o.blendPass.uniforms.blendTexture.value=o.tempRenderTarget.texture,o.blendWithMapPass=new Vn(Tr),o.blendWithMapPass.material.defines.USE_MASKMAP=1,o.blendWithMapPass.uniforms.blendTexture.value=o.tempRenderTarget.texture,o.bounds=[[0,0,1,1]],o.radius=5,o}return a(t,e),t.prototype.setSize=function(e,t){this.tempRenderTarget.setSize(e,t),this.tempRenderTarget2.setSize(e,t),this.tempRenderTarget3.setSize(e,t),this.tempRenderTarget4.setSize(e,t)},t.prototype.render=function(e,t,n,i,r){for(var o=this,a=this.tempRenderTarget3.width,s=this.tempRenderTarget3.height,l=2+2*Math.floor(this.radius/2),u=0;u<l;u++){this.blurPass.uniforms.resolution.value.set(1/a,1/s);var c=this.radius*(u+1)/l;u%2==0?(this.blurPass.uniforms.direction.value.set(c,0),this.blurPass.render(e,this.tempRenderTarget2,0===u?n:this.tempRenderTarget)):(this.blurPass.uniforms.direction.value.set(0,c),this.blurPass.render(e,this.tempRenderTarget,this.tempRenderTarget2))}var h=n,p=this.tempRenderTarget3,d=void 0;this.bounds.forEach((function(n,i){var r,a=void 0,s=Object.prototype.toString.call(n[4]);"[object String]"==s?((a=o.blendWithMapPass).uniforms.filletXRadius.value.set(0,0,0,0),a.uniforms.filletYRadius.value.set(0,0,0,0),a.uniforms.maskMap.value=(r=n[4],fi.has(r)||fi.set(r,(new THREE.TextureLoader).load(r)),fi.get(r))):"[object Number]"==s?((a=o.blendPass).uniforms.filletXRadius.value.set(n[4],n[6],n[8],n[10]),a.uniforms.filletYRadius.value.set(n[5],n[7],n[9],n[11]),a.uniforms.maskMap.value=null):((a=o.blendPass).uniforms.filletXRadius.value.set(0,0,0,0),a.uniforms.filletYRadius.value.set(0,0,0,0),a.uniforms.maskMap.value=null),a.uniforms.bounds.value.fromArray(n),a.render(e,i===o.bounds.length-1?t:p,h),d=h,h=p,p=0===i?o.tempRenderTarget4:d}))},t}(vr),Cr=function(){function e(t,n,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8;r(this,e),this._tempRenderTarget1=di(t,n),this._tempRenderTarget2=di(t,n),this._sceneBuffer=new ei(t,n,i,o),this._superSampler=new mr(t,n,30),this._gBuffer=new oi(t,n),this._ssaoPrePass=new vi(t,n),this._ssaoKernalSize=12,this._ssrPrePass=new _i(t,n),this._copyPass=new Vn(Ln),this._colorEffect=new yr(new Vn(jn)),this._dofEffect=new yr(new Vn(On,"tColor")),this._dofEffect._pass.uniforms.tDepth.value=this._gBuffer.getDepthTexture(),this._vignetteEffect=new wr(t,n),this._bloomEffect=new xr(t,n),this._filmEffect=new yr(new Vn(Fn)),this._chromaticAberrationEffect=new yr(new Vn(Bn)),this._fxaaEffect=new yr(new Vn(In),t,n),this._rectBlurEffect=new Sr(t,n),this._effects=new Map([["colorCorrection",this._colorEffect],["dof",this._dofEffect],["vignette",this._vignetteEffect],["bloom",this._bloomEffect],["film",this._filmEffect],["chromaticAberration",this._chromaticAberrationEffect],["FXAA",this._fxaaEffect],["blur",this._rectBlurEffect]]),this._effectList1=["colorCorrection","dof","vignette","bloom"],this._effectList2=["chromaticAberration","FXAA","blur","film"],this._glowPass=new Fi(t,n,"glow"),this._middleGlowPass=new Fi(t,n,"middleGlow"),this._smallGlowPass=new Fi(t,n,"smallGlow"),this._combineGlowPass=new Fi(t,n,["glow","middleGlow","smallGlow"]),this._combineGlowPass.$enable=!1,this._lineBloomPass=new Ni(t,n),this._innerGlowPass=new Ji(t,n),this._radialBlurPass=new Yi(t,n),this._radialBlur2Pass=new Zi(t,n),this._radialOffsetPass=new $i(t,n),this._focusRegionPass=new ar(t,n),this._overLayPasses=new Map([["Glow",this._glowPass],["MiddleGlow",this._middleGlowPass],["SmallGlow",this._smallGlowPass],["CombineGlow",this._combineGlowPass],["LineBloom",this._lineBloomPass],["InnerGlow",this._innerGlowPass],["RadialBlur",this._radialBlurPass],["RadialBlur2",this._radialBlur2Pass],["RadialOffset",this._radialOffsetPass],["FocusRegion",this._focusRegionPass]]),this._outlinePasses=new Map,this._config=hi({},gr),this.setConfig({}),this.width=t,this.height=n,this.schemeAutoMSAA=!0,this._sharedMRB=null,this._sharedRB=null,this._needPreSetupRenderTarget=!0,this.onlyAO=!1,this.onlySSR=!1,this.enableOutlines=!0,this.enableOverlays=!0}return e.prototype.setConfig=function(e){this._config=hi(this._config,e),this._superSampler.setSamplingSize(this._config.temporalSuperSampling.size);var t=void 0;t=this._config.postEffect.bloom,this._bloomEffect.strength=t.strength,this._bloomEffect.radius=t.radius,this._bloomEffect.threshold=t.threshold,t=this._config.postEffect.screenSpaceAmbientOcclusion,this._ssaoPrePass.setParameter("radius",t.radius),this._ssaoPrePass.setParameter("bias",t.radius/50),this._ssaoPrePass.setParameter("intensity",t.intensity),this._ssaoKernalSize={low:6,medium:12,high:32,ultra:64}[t.quality]||12,this._ssaoPrePass.setKernelSize(this._ssaoKernalSize),t=this._config.postEffect.screenSpaceReflection,this._ssrPrePass._ssrPass.uniforms.maxRayDistance.value=t.maxRayDistance,this._ssrPrePass._ssrPass.uniforms.pixelStride.value=t.pixelStride,this._ssrPrePass._ssrPass.uniforms.pixelStrideZCutoff.value=t.pixelStrideZCutoff,this._ssrPrePass._ssrPass.uniforms.screenEdgeFadeStart.value=t.screenEdgeFadeStart,this._ssrPrePass._ssrPass.uniforms.eyeFadeStart.value=t.eyeFadeStart,this._ssrPrePass._ssrPass.uniforms.eyeFadeEnd.value=t.eyeFadeEnd,this._ssrPrePass._ssrPass.uniforms.minGlossiness.value=t.minGlossiness,t=this._config.postEffect.colorCorrection,this._colorEffect._pass.uniforms.exposure.value=t.exposure,this._colorEffect._pass.uniforms.brightness.value=t.brightness,this._colorEffect._pass.uniforms.contrast.value=t.contrast,this._colorEffect._pass.uniforms.saturation.value=t.saturation,this._colorEffect._pass.uniforms.gamma.value=t.gamma,t=this._config.postEffect.dof,this._dofEffect._pass.uniforms.focalDepth.value=t.focalDepth,this._dofEffect._pass.uniforms.focalLength.value=t.focalLength,this._dofEffect._pass.uniforms.fstop.value=t.fstop,this._dofEffect._pass.uniforms.maxblur.value=t.maxblur,this._dofEffect._pass.uniforms.threshold.value=t.threshold,this._dofEffect._pass.uniforms.gain.value=t.gain,this._dofEffect._pass.uniforms.bias.value=t.bias,this._dofEffect._pass.uniforms.dithering.value=t.dithering,t=this._config.postEffect.vignette,this._vignetteEffect.type=t.type,this._vignetteEffect.color.setHex(t.color),this._vignetteEffect.offset=t.offset,t=this._config.postEffect.film,this._filmEffect._pass.uniforms.grayscale.value=t.grayscale,this._filmEffect._pass.uniforms.nIntensity.value=t.noiseIntensity,this._filmEffect._pass.uniforms.sIntensity.value=t.scanlinesIntensity,this._filmEffect._pass.uniforms.sCount.value=t.scanlinesCount,t=this._config.postEffect.chromaticAberration,this._chromaticAberrationEffect._pass.uniforms.uChromaFactor.value=t.chromaFactor,t=this._config.postEffect.blur,this._rectBlurEffect.bounds=t.bounds,this._rectBlurEffect.radius=t.radius,this.dirty()},e.prototype.enable=function(e){if(e.indexOf("outline")>-1){var t=e.split("_"),n=t[1];if(e=t[0],this._outlinePasses.has(n))this._outlinePasses.get(n).enable=!0;else{var i=new dr(this.width,this.height,n);i.enable=!0,this._outlinePasses.set(n,i)}}else e=ci(e),this._overLayPasses.has(e)&&(this._overLayPasses.get(e).enable=!0),"Glow"!==e&&"MiddleGlow"!==e&&"SmallGlow"!==e||(this._overLayPasses.get("CombineGlow").enable=this._overLayPasses.get("Glow").enable||this._overLayPasses.get("MiddleGlow").enable||this._overLayPasses.get("SmallGlow").enable)},e.prototype.disable=function(e){if(e.indexOf("outline")>-1){var t=e.split("_"),n=t[1];if(e=t[0],this._outlinePasses.has(n))this._outlinePasses.get(n).enable=!1}else e=ci(e),this._overLayPasses.has(e)&&(this._overLayPasses.get(e).enable=!1),"Glow"!==e&&"MiddleGlow"!==e&&"SmallGlow"!==e||(this._overLayPasses.get("CombineGlow").enable=this._overLayPasses.get("Glow").enable||this._overLayPasses.get("MiddleGlow").enable||this._overLayPasses.get("SmallGlow").enable)},e.prototype.getPass=function(e){return e=ci(e),this._overLayPasses.has(e)?this._overLayPasses.get(e):null},e.prototype.shareDepthRenderBuffer=function(e,t){if(t){var n=this.getPass(t);n?n._schemeBuffer.shareDepthRenderBuffer=e:console.warn("AdvancedRenderer: shareDepthRenderBuffer pass <"+t+"> can not find.")}else this._overLayPasses.forEach((function(t){return t._schemeBuffer.shareDepthRenderBuffer=e}));this._needPreSetupRenderTarget=e,this.dirty()},e.prototype.setSize=function(e,t){this._sceneBuffer.setSize(e,t),this._tempRenderTarget1.setSize(e,t),this._tempRenderTarget2.setSize(e,t),this._gBuffer.setSize(e,t),this._superSampler.setSize(e,t),this._ssaoPrePass.setSize(e,t),this._ssrPrePass.setSize(e,t),this._effects.forEach((function(n){return n.setSize(e,t)})),this._overLayPasses.forEach((function(n){return n.setSize(e,t)})),this._outlinePasses.forEach((function(n){return n.setSize(e,t)})),this.width=e,this.height=t,this._needPreSetupRenderTarget=!0,this.dirty()},e.prototype.render=function(e,t,n,i){var r=this,o=this._config.temporalSuperSampling.enable,a=this._config.postEffect.enable,s=e.capabilities.isWebGL2;if(a||o){var l,u,c=s&&a&&this._config.postEffect.MSAA.enable;o&&this._superSampler.finished()?l=this._superSampler.output():(o&&this._superSampler.jitterProjection(n,this._tempRenderTarget1.width,this._tempRenderTarget1.height),this._sharedMRB&&this._sharedRB||(this._sharedMRB=e.getContext().createRenderbuffer(),this._sharedRB=e.getContext().createRenderbuffer(),this._sceneBuffer.setupDepthRenderbuffer(this._sharedMRB,this._sharedRB),this._initDepthRenderBuffer=!0),this._overLayPasses.forEach((function(e){return e._schemeBuffer.applyShareRenderbuffer(r._sharedMRB,r._sharedRB)})),this._needPreSetupRenderTarget&&(this._overLayPasses.forEach((function(t,n){t.isActive()&&t._schemeBuffer.shareDepthRenderBuffer&&t._schemeBuffer.setupRenderTarget(e)})),this._needPreSetupRenderTarget=!1),this._sceneBuffer.useMRT=c,this._sceneBuffer.render(e,t,n),u=this._sceneBuffer.getSchemeBuffer(),a&&((this._config.postEffect.screenSpaceAmbientOcclusion.enable||this._config.postEffect.screenSpaceReflection.enable||this._config.postEffect.dof.enable)&&this._gBuffer.render(e,t,n,this._config.postEffect.screenSpaceAmbientOcclusion.ignoreTransparent),this._config.postEffect.screenSpaceAmbientOcclusion.enable&&(o&&this._config.postEffect.screenSpaceAmbientOcclusion.temporalFilter&&this._ssaoPrePass.setKernelSize(this._ssaoKernalSize,this._superSampler.frame()),this._ssaoPrePass.render(this._gBuffer.getNormalGlossinessTexture(),this._gBuffer.getDepthTexture(),e,n,u,this.onlyAO)),this._config.postEffect.screenSpaceReflection.enable&&(o&&this._config.postEffect.screenSpaceReflection.temporalFilter?(this._ssrPrePass.jitter=!!this._superSampler.frame(),this._ssrPrePass._blurPass.material.uniforms.blurSize.value=1+this._superSampler.frame()/this._superSampler.getSamplingSize()):(this._ssrPrePass.jitter=!1,this._ssrPrePass._blurPass.material.uniforms.blurSize.value=2),this._ssrPrePass.render(u.texture,this._gBuffer.getNormalGlossinessTexture(),this._gBuffer.getDepthTexture(),e,n,u,this.onlySSR))),o?(l=this._superSampler.sample(e,u.texture),n.clearViewOffset()):l=u),this._copyPass.render(e,this._tempRenderTarget2,l);var h=this._tempRenderTarget2,p=this._tempRenderTarget1,d=function(t){if(r._config.postEffect[t].enable){var i=r._effects.get(t);if("dof"==t&&(i._pass.uniforms.znear.value=n.near,i._pass.uniforms.zfar.value=n.far),i.render(e,p,h,.01667),i.needSwapBuffer){var o=h;h=p,p=o}}};this._effectList1.forEach(d),this.enableOverlays&&this._overLayPasses.forEach((function(i){i.isActive()&&i.render(e,t,n,h,c)})),this.enableOutlines&&this._outlinePasses.forEach((function(i){i.isActive()&&i.render(e,t,n,h,c)})),this._effectList2.forEach(d),this._copyPass.clear=e.autoClear,this._copyPass.render(e,i||void 0,h)}else{e.setRenderTarget(i||null),e.render(t,n);c=this.schemeAutoMSAA&&s;this.enableOverlays&&this._overLayPasses.forEach((function(i){i.isActive()&&i.render(e,t,n,void 0,c)})),this.enableOutlines&&this._outlinePasses.forEach((function(i){i.isActive()&&i.render(e,t,n,void 0,c)}))}},e.prototype.dirty=function(e){this._config.temporalSuperSampling.enable&&this._superSampler.start(),e?"Outline"===(e=ci(e))?this._outlinePasses.forEach((function(e){return e.dirty()})):this._overLayPasses.has(e)&&this._overLayPasses.get(e).dirty():(this._overLayPasses.forEach((function(e){return e.dirty()})),this._outlinePasses.forEach((function(e){return e.dirty()})))},e.prototype.getActiveOverlayPasses=function(){return this.enableOverlays?Array.from(this._overLayPasses.values()).filter((function(e){return e.isActive()})):[]},e.prototype.disableAllOverlayPasses=function(){this._overLayPasses.forEach((function(e){return e.$enable=!1}))},o(e,[{key:"combineGlow",set:function(e){this._overLayPasses.get("CombineGlow").$enable=e,this._overLayPasses.get("Glow").$enable=!e,this._overLayPasses.get("MiddleGlow").$enable=!e,this._overLayPasses.get("SmallGlow").$enable=!e},get:function(){return this._overLayPasses.get("CombineGlow").$enable}}]),e}(),Ar=new THREE.Vector3,Rr=new THREE.Vector3,Pr={vertexShader:"\n        #include <skinning_pars_vertex>\n        void main() {\n            #include <skinbase_vertex>\n            #include <begin_vertex>\n            #include <skinning_vertex>\n            #include <project_vertex>\n        }\n    ",fragmentShader:"\n        void main() {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    "},Dr=new THREE.ShaderMaterial(Pr),kr=new THREE.ShaderMaterial(Pr);kr.skinning=!0;var jr=new THREE.Color,Or=function(){function e(t,n){r(this,e),this.camera=new THREE.OrthographicCamera;var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.tempRenderTarget=new THREE.WebGLRenderTarget(t,n,i),this.radius=.1,this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;for(var o=Math.round(t/2),a=Math.round(n/2),s=0;s<this.nMips;s++){var l=new THREE.WebGLRenderTarget(o,a,i);l.texture.name="AOBaker.h"+s,l.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(l);var u=new THREE.WebGLRenderTarget(o,a,i);u.texture.name="AOBaker.v"+s,u.texture.generateMipmaps=!1,this.renderTargetsVertical.push(u),o=Math.round(o/2),a=Math.round(a/2)}this.separableBlurMaterials=[];var c=[3,5,7,9,11];o=Math.round(t/2),a=Math.round(n/2);for(var h=0;h<this.nMips;h++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(c[h])),this.separableBlurMaterials[h].uniforms.texSize.value=new THREE.Vector2(o,a),o=Math.round(o/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[.5,.7,.8,.9,1],this._camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)}return e.prototype.bake=function(e,t,n,i){n&&this.fit(n,i),e.materialManager.hasStrategy("AOBaker")||e.materialManager.addStrategy("AOBaker",(function(e,t,n,i,r,o){return this.userData.ground?null:r.skinning?kr:Dr}));var r=e.autoClear;e.autoClear=!1,jr.copy(e.getClearColor());var o=e.getClearAlpha();e.setClearColor(new THREE.Color(1,1,1),1),e.materialManager.setMode("AOBaker");var a=t.autoUpdate,s=t.background,l=e.shadowMap.enable;t.autoUpdate=!1,t.background=null,e.shadowMap.enable=!1,e.setRenderTarget(this.tempRenderTarget),e.clear(),e.render(t,this.camera),t.autoUpdate=a,t.background=s,e.shadowMap.enable=l,e.materialManager.setMode(0);for(var u=this.tempRenderTarget,c=0;c<this.nMips;c++)this.quad.material=this.separableBlurMaterials[c],this.separableBlurMaterials[c].uniforms.colorTexture.value=u.texture,this.separableBlurMaterials[c].uniforms.direction.value=new THREE.Vector2(1,0),e.setRenderTarget(this.renderTargetsHorizontal[c]),e.clear(),e.render(this.scene,this._camera),this.separableBlurMaterials[c].uniforms.colorTexture.value=this.renderTargetsHorizontal[c].texture,this.separableBlurMaterials[c].uniforms.direction.value=new THREE.Vector2(0,1),e.setRenderTarget(this.renderTargetsVertical[c]),e.clear(),e.render(this.scene,this._camera),u=this.renderTargetsVertical[c];this.quad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomRadius.value=1-this.radius,e.setRenderTarget(this.tempRenderTarget),e.clear(),e.render(this.scene,this._camera),e.setClearColor(jr,o),e.autoClear=r},e.prototype.fit=function(e,t){var n=e.getCenter(Ar),i=e.getSize(Rr);this.camera.position.set(n.x,n.y+i.y,n.z),this.camera.rotation.set(-Math.PI/2,0,0),this.camera.matrixAutoUpdate=!1,this.camera.updateMatrix(),this.camera.matrix.premultiply(t),this.camera.near=i.y/3,this.camera.far=2*i.y,this.camera.left=-i.x/2+.075,this.camera.right=i.x/2-.075,this.camera.top=i.z/2-.075,this.camera.bottom=-i.z/2+.075,this.camera.updateProjectionMatrix(),i.x=1024,i.z=1024,this.tempRenderTarget.setSize(i.x,i.z);for(var r=Math.round(i.x/2),o=Math.round(i.z/2),a=0;a<this.nMips;a++)this.renderTargetsHorizontal[a].setSize(r,o),this.renderTargetsVertical[a].setSize(r,o),this.separableBlurMaterials[a].uniforms.texSize.value=new THREE.Vector2(r,o),r=Math.round(r/2),o=Math.round(o/2)},e.prototype.dispose=function(){this.tempRenderTarget.dispose();for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(var t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose()},e.prototype.getSeperableBlurMaterial=function(e){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},e.prototype.getCompositeMaterial=function(e){return new THREE.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomFactors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\t\n\t\t\t\tfloat lerpBloomFactor(const in float factor) { \n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat factor0 = lerpBloomFactor(bloomFactors[0]);\n\t\t\t\t\tfloat factor1 = lerpBloomFactor(bloomFactors[1]);\n\t\t\t\t\tfloat factor2 = lerpBloomFactor(bloomFactors[2]);\n\t\t\t\t\tfloat factor3 = lerpBloomFactor(bloomFactors[3]);\n\t\t\t\t\tfloat factor4 = lerpBloomFactor(bloomFactors[4]);\n\t\t\t\t\tgl_FragColor = (factor0 * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\t\t\t\t\tfactor1 * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\t\t\t\t\tfactor2 * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\t\t\t\t\tfactor3 * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\t\t\t\t\tfactor4 * texture2D(blurTexture5, vUv)) / (factor0 + factor1 + factor2 + factor3 + factor4);\n\t\t\t\t}\t\n\t\t\t"})},o(e,[{key:"ao",get:function(){return this.tempRenderTarget.texture}}]),e}(),Fr=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype.setupUserData=function(t){e.prototype.setupUserData.call(this,t),this.node.userData.isCombinedObject=!0},t.prototype._notifyLoadingObjects=function(){},t.prototype.loadResource=function(){e.prototype.loadResource.call(this,!0)},t.prototype.unloadResource=function(){e.prototype.unloadResource.call(this,!0)},o(t,[{key:"isCombinedObject",get:function(){return!0}}]),t}(Lt),Br=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._height=3,i._initBoxSize=null,i.miscObject=null,i.wallObject=null,i.roofObject=null,i.ceilingObject=null,i._marker=null,i._navigation=null,i._groundAOBaker=null,i._baked=!1,i._showObjectsInParentLevels=!1,i}return a(t,e),t.prototype.isBlockMouseOffEvent=function(e){return!!this.isChildOf(e)},t.prototype.destroy=function(){this._groundAOBaker&&(this.plan.node.traverse((function(e){var t=e.material;t&&(t.aoMap=null,t.needsUpdate=!0)})),this._groundAOBaker.dispose(),this._groundAOBaker=null),e.prototype.destroy.call(this)},t.prototype.synTransform=function(e){this.setupUserData(e),this.parent||this.setupParent(e),e.skipSetupParent=!0,this.setupTranslation(e)},t.prototype.setupFromData=function(e){var t=this,n=e.data,i=e.options||{};i.complete=function(){t._setup(e)},this.synTransform(e),this.app._floorLoaderManager.loadFromData(this,n,i)},t.prototype.setupFromURL=function(e){var t=this,n=this.app.confirmURL(e.url),i=e.options||{};i.complete=function(){t._setup(e)},this.synTransform(e),this.app._floorLoaderManager.load(this,n,i)},t.prototype.customSetup=function(e){this._height=e.height||this._height,this._initBoxSize=e.initBoxSize,this._showObjectsInParentLevels=Ne.parseValue(e.alwaysShowInsideObjs,this._showObjectsInParentLevels)},t.prototype.loadResource=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(t)e.prototype.loadResource.call(this,t);else{var n=[this.roof,this.wall,this.plan,this.ceiling];n.forEach((function(e){e&&e.loadResource()})),this.doors.forEach((function(e){e.loadResource()})),this.things.forEach((function(e){e.isWindow&&e.loadResource()}));var i=this.misc;i&&i.traverse((function(e){e.node.isDoorOrWin&&e.loadResource()})),this.rooms.forEach((function(e){e.loadResource(!1)}))}},t.prototype.unloadResource=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(t)e.prototype.unloadResource.call(this,t);else{var n=[this.roof,this.wall,this.plan,this.ceiling];n.forEach((function(e){e&&e.unloadResource()})),this.doors.forEach((function(e){e.unloadResource()})),this.things.forEach((function(e){e.isWindow&&e.unloadResource()}));var i=this.misc;i&&i.traverse((function(e){e.node.isDoorOrWin&&e.unloadResource()})),this.rooms.forEach((function(e){e.unloadResource(!1)}))}},t.prototype.setupResources=function(t){e.prototype.setupResources.call(this,t),this._ceilingNode=t.ceilingNode||this._ceilingNode,this._roofNode=t.roofNode||this._roofNode,this._floorNode=t.floorNode||this._floorNode,this._ceilingNode&&(this.ceiling.node=this._ceilingNode),this._roofNode&&(this.roof.node=this._roofNode),this._floorNode&&(this.plan.node=this._floorNode)},t.prototype._getChildVisibles=function(){var e=this.children.concat([this.roof,this.ceiling,this.plan]),t=[];return e.forEach((function(e){e&&t.push(e.visible)})),t},t.prototype._onGetChild=function(){return this.children.concat([this.roof,this.ceiling,this.plan])},t.prototype._getDoors=function(e){for(var t=[],n=0;n<this.doors.length;n++){var i=this.doors[n];i[e]&&t.push(i)}return t},t.prototype._createMarker=function(e){var t=(e=e||{}).connectorName||/connector/,n=e.markerName||/marker/,i=this.attachPoints.query(t),r=this.attachPoints.query(n);if(0!=i.length||0!=r.length){var o=i[0],a=r[0];e.type="Marker",e.parent=this,Ne.isNull(e.size)?console.error("floor's marker must provide size to show"):Ne.isNull(e.canvas)&&Ne.isNull(e.url)?console.error("floor's marker must provide 'canvas' or 'url' to show"):(a&&(e.position=a.position),o?e.lineToPosition=o.position:e.lineColor&&console.error("Please make sure connector is avaliable for showing connection line of marker"),this._marker=this.app.create(e))}},t.prototype.setupChildVisibleAsParent=function(e,t){this.visible||this._showObjectsInParentLevels||(e.visible=!1)},t.prototype.traverseRoofs=function(e){this.roof&&e(this.roof);for(var t=this.rooms,n=0;n<t.length;n++){var i=t[n].roof;i&&e(i)}},t.prototype.showAllRoofs=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.roof&&(this.roof.visible=e);for(var t=this.rooms,n=0;n<t.length;n++){var i=t[n].roof;i&&(i.visible=e)}},t.prototype.showAllCeilings=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.ceiling;t&&(t.visible=e);for(var n=this.rooms,i=0;i<n.length;i++)n[i].ceiling.visible=e},t.prototype.showMarker=function(e){this._marker||this._createMarker(e),Ne.isBoolean(e)?this._marker.visible=e:this._marker.setParams(e)},t.prototype.getRoomFromLocalPosition=function(e){return this.getRoomFromWorldPosition(this.selfToWorld(e))},t.prototype.getRoomFromWorldPosition=function(e){for(var t=this.rooms,n=0;n<t.length;n++){var i=t[n];if(i.getRayCastPosition(e))return i}return null},t.prototype.bake=function(e){var t=this.plan;if(t){for(var n=t.node.getMeshes(),i=0;i<n.length;i++)if(n[i]instanceof THREE.Water)return;if(a=this.wall){var r=this;if(null===e){if(!this._baked)return;var o=function(e){e.isShaderMaterial||(Ne.revertValue(e,"aoMap"),Ne.revertValue(e,"aoMapIntensity"),e.needsUpdate=!0)};t.node.traverseMaterials(o),this.rooms.forEach((function(e){var t=e.plan;t&&t.node.traverseMaterials(o)})),this._baked=!1}else{var a;if(e=e||{},!(a=this.wall))return;var s=Ne.parseValue(e.intensity,1.4);this._groundAOBaker||(this._groundAOBaker=new Or);var l=a.getLocalBoundingBox(!0,!0).toBox();this._initBoxSize&&l.max.addVectors(l.min,Ne.parseVector3(this._initBoxSize).addScalar(.15)),this._groundAOBaker.bake(this.app.renderer,a.node,l,this.node.matrixWorld);var u=function(e,t){t.isShaderMaterial||(Ne.backupValue(t,"aoMap"),Ne.backupValue(t,"aoMapIntensity"),t.aoMap=r._groundAOBaker.ao,t.aoMapIntensity=s,t.needsUpdate=!0)};t.style._cloneAndModifyMaterial((function(e,t,n){u(0,t)}),!0,(function(e){return!!e.isShaderMaterial||!e._mustClone&&!(!e._isCloned()||!e._getOriginal())})),this.rooms.forEach((function(e){var t=e.plan;t&&t.style._cloneAndModifyMaterial((function(e,t,n){u(0,t)}))})),this._baked=!0}}}},t.prototype.canNavigation=function(){return!0},t.prototype._getLinkableObjects=function(){var t=this.rooms;return t=t.concat(e.prototype._getLinkableObjects.call(this))},t.prototype._getLinkableDoors=function(){var t=this.elevatorDoors;return t=(t=t.concat(this.stairDoors)).concat(e.prototype._getLinkableDoors.call(this))},t.prototype._setupNavigationGraph=function(t,n){e.prototype._setupNavigationGraph.call(this,t,n);for(var i=this._getLinkableObjects(),r=0;r<i.length;r++)for(var o=i[r],a=o._getLinkableDoors(),s=0;s<a.length;s++){t[(l=a[s]).id]=t[l.id]||{},t[o.id]=t[o.id]||{},t[o.id][l.id]=t[l.id][o.id]=n}t[this.id]=t[this.id]||{};for(a=this._getLinkableDoors(),r=0;r<a.length;r++){var l,u=(l=a[r]).owner;u&&(t[l.id]=t[l.id]||{},t[u.id]=t[u.id]||{},t[this.id][l.id]=t[l.id][this.id]=n,t[u.id][l.id]=t[l.id][u.id]=n)}},t.prototype.onBeforeCapture=function(){var e=this.plan;if(e){var t=function(e){var t=e.material;t&&(Ne.backupValue(t,"aoMap"),t.aoMap=null,t.needsUpdate=!0)};e.node.traverseAll((function(e){t(e)})),this.rooms.forEach((function(e){var n=e.plan;n&&n.node.traverseAll((function(e){t(e)}))}))}},t.prototype.onAfterCapture=function(){var e=this.plan;if(e){var t=function(e){var t=e.material;t&&(Ne.revertValue(t,"aoMap"),t.needsUpdate=!0)};e.node.traverseAll((function(e){t(e)})),this.rooms.forEach((function(e){var n=e.plan;n&&n.node.traverseAll((function(e){t(e)}))}))}},t.prototype.showThings=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[Floor] Please use '.things.visible=true/false' to replace '.showThings'"),this.things.visible=e},t.prototype.showDoors=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[Floor] Please use '.things.visible=true/false' to replace '.showThings'"),this.doors.visible=e},t.prototype.hideMarker=function(){console.warn("[Floor] Please use '.showMarker(false)' to replace '.hideMarker'"),this.showMarker(!1)},t.prototype.setMarker=function(e){console.warn("[Floor] Please use '.showMarker(params)' to replace '.setMarker'"),this.showMarker(e)},t.prototype.showRoof=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[Floor] Please use '.showAllRoofs()' to replace '.showRoof()'"),this.showAllRoofs(e)},t.prototype.showCeiling=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[Floor] Please use '.showAllCeilings()' to replace '.showCeiling()'"),this.showAllCeilings(e)},o(t,[{key:"isFloor",get:function(){return!0}},{key:"isOutdoors",get:function(){var e=this.building;return!(!e||e.hasFacades())}},{key:"building",get:function(){return this.parents.query(".Building")[0]}},{key:"indexOfBuilding",get:function(){return this.indexOfParent(!0)}},{key:"levelNumber",get:function(){return this.indexOfParent(!0)+1}},{key:"things",get:function(){return this.query(".Thing",!1)}},{key:"doors",get:function(){return this.query(".Door",!1)}},{key:"elevatorDoors",get:function(){return this.doors.query(".ElevatorDoor",!1)}},{key:"stairDoors",get:function(){return this.doors.query(".StairDoor",!1)}},{key:"stairs",get:function(){return this.query(".Stair",!1)}},{key:"rooms",get:function(){return this.query(".Room",!1)}},{key:"misc",get:function(){return this.miscObject||(this.miscObject=this.query(".CombinedObject").query("[userData/type=CombineMiscParent]")[0]),this.miscObject}},{key:"plan",get:function(){return this.floorObject||(this.floorObject=this.query(".CombinedObject").query("[userData/type=CombineFloorParent]")[0]),this.floorObject}},{key:"wall",get:function(){return this.wallObject||(this.wallObject=this.query(".CombinedObject").query("[userData/type=CombineWallParent]")[0]),this.wallObject}},{key:"roof",get:function(){return this.roofObject||(this.roofObject=this.query(".CombinedObject").query("[userData/type=CombineRoofParent]")[0]),this.roofObject}},{key:"ceiling",get:function(){return this.ceilingObject||(this.ceilingObject=this.query(".CombinedObject").query("[userData/type=CombineCeilingParent]")[0]),this.ceilingObject}},{key:"marker",get:function(){return this._marker}},{key:"height",get:function(){return this._height}},{key:"showObjectsInParentLevels",get:function(){return this._showObjectsInParentLevels}},{key:"isFloorPlan",get:function(){return console.warn("[Floor] Please use '.isFloor' to replace '.isFloorPlan'"),!0}},{key:"levelNum",get:function(){return console.warn("[Floor] Please use '.levelNumber' to replace '.levelNum'"),this.levelNumber}}]),t}(Lt),Lr=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.name="Outdoors",i._floorNode=null,i}return a(t,e),t.prototype.destroy=function(){this._floorNode=null,e.prototype.destroy.call(this)},t.prototype.setupChildVisibleAsParent=function(){},t.prototype.setup=function(e){this.setupID(e),this.setupParent(e),this.parent.outdoors=this,this.setupUserData(e)},t.prototype.setPolygonOffset=function(e){var t=this._floorNode;t&&new Lt(this.app)._init(t).style.setPolygonOffset(e)},o(t,[{key:"floorNode",set:function(e){this._floorNode=e},get:function(){return this._floorNode}},{key:"canNotQueryFromSelector",get:function(){return!0}},{key:"isOutdoors",get:function(){return!0}}]),t}(Br),Ir=function(){function e(t){r(this,e),this.app=t,this._style=null,this._id="",this._name="",this._queryID=THING.Math.generateUUID(),this._userData={},this._angles=[0,0,0],this._events={},this._tags=[],this._groups=[],this._children=new gt(this.app)}return e.prototype.isGroup=function(){return!0},e.prototype.setup=function(e){this._id=e.id||"",this._name=e.name||"",this._tags=e.tags||[]},e.prototype.destroy=function(){this.app.objectManager.destroy(this);var e=this;this._children.forEach((function(t){var n=t.groups.indexOf(e);for(var i in-1!==n&&t.groups.splice(n,1),e._events){var r=e._events[i];for(var o in r)t.off(o)}}))},e.prototype.destroyAll=function(){this.destroy(),this._children.destroyAll()},e.prototype.hasAttribute=function(e){return Ne.hasAttribute(this,e)},e.prototype.getAttribute=function(e){return Ne.getAttribute(this,e)},e.prototype.setAttribute=function(e,t){return Ne.setAttribute(this,e,t)},e.prototype.setAttributes=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(var n in e=e||{})(t||Ne.isUndefined(this[n]))&&this.setAttribute(n,e[n])},e.prototype.add=function(e){var t=this;if(e instanceof gt)e.forEach((function(e){t.add(e)}));else for(var n in this._children.add(e),-1===e.groups.indexOf(this)&&e.groups.push(this),this._children.forEach((function(e){e.groups.sort((function(e,t){return t.children.length-e.children.length}))})),this._events){var i=this._events[n];for(var r in i){var o=i[r];this.on(n,o.selector,o.userData,o.callback,null,o.priority)}}},e.prototype.remove=function(e){var t=this;if(e instanceof gt)e.forEach((function(e){t.remove(e)}));else{this._children.remove(e);var n=e.groups.indexOf(this);for(var i in-1!==n&&e.groups.splice(n,1),this._events){var r=this._events[i];for(var o in r){var a=r[o];this.off(i,a.selector,a.tag)}}}},e.prototype._transform=function(e){var t=new THREE.Group;t.position.copy(Ne.parseVector3(this.position)),this.app.scene.add(t),t.updateMatrixWorld();for(var n=[],i=0;i<this._children.length;i++){var r=this._children[i];n.push(r.node.parent),r.node.attachToParent(t,this.app.scene)}e(t),t.updateWorldMatrix(!1,!1);for(i=0;i<this._children.length;i++){(r=this._children[i]).node.attachToParent(n[i],this.app.scene),r.static&&r.node._synMatrixWorld()}this.app.scene.remove(t)},e.prototype.translate=function(e){this._transform((function(t){t.translateX(e[0]),t.translateY(e[1]),t.translateZ(e[2])}))},e.prototype.translateX=function(e){this.translate([e,0,0])},e.prototype.translateY=function(e){this.translate([0,e,0])},e.prototype.translateZ=function(e){this.translate([0,0,e])},e.prototype.query=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=new gt(this.app,this._children);return n.select(e),t&&this._children.forEach((function(t){n.add(t.query(e))})),n},e.prototype._parseEvent=function(e,t,n,i,r){var o=Ne.parseEvent(e,t,n,i,r);o._callback=o.callback;var a=this;return o.callback=function(e){o._callback&&o._callback.call(a,e)},o.tag=o.tag||"",o.tag+="_"+this._queryID,o},e.prototype._updateEvents=function(e){this._events[e.eventType]=this._events[e.eventType]||[],this._events[e.eventType][e.tag]=e},e.prototype._removeEvents=function(e){var t=this._events[e.eventType];t&&delete t[e.tag]},e.prototype.on=function(e,t,n,i,r,o){var a=this._parseEvent(t,n,i,r,o);return a.eventType=e,this._updateEvents(a),this.children.on(e,a.selector,a.userData,a.callback,a.tag,a.priority),this},e.prototype.off=function(e,t,n){var i=this._parseEvent(t,null,n);return i.eventType=e,this._removeEvents(i),this.children.off(e,i.selector,i.tag),this},e.prototype.one=function(e,t,n,i,r,o){var a=this._parseEvent(t,n,i,r,o);return a.eventType=e,this._updateEvents(a),this.children.one(e,a.selector,a.userData,a.callback,a.tag,a.priority),this},e.prototype._getAvgVector3=function(e){if(!this._children.length)return[0,0,0];var t=new THREE.Vector3;return this._children.forEach((function(n){var i=Ne.parseVector3(n[e]);t.add(i)})),t.divideScalar(this._children.length),t.toArray()},o(e,[{key:"type",get:function(){return"Group"}},{key:"style",get:function(){return this._children.style}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}},{key:"name",set:function(e){this._name=e},get:function(){return this._name}},{key:"queryID",set:function(e){this._queryID=e},get:function(){return this._queryID}},{key:"userData",set:function(e){this._userData=e},get:function(){return this._userData}},{key:"tags",set:function(e){this._tags=e},get:function(){return this._tags}},{key:"groups",get:function(){return this._groups}},{key:"position",set:function(e){var t=Ne.parseVector3(e),n=this;this._transform((function(e){e._setWorldPosition(t,n.app.root.static)}))},get:function(){return this._getAvgVector3("position")}},{key:"angles",set:function(e){var t=THING.Math.subVector(this._angles,e);this._angles=e;var n=Ne.parseEuler(t);this._transform((function(e){e.quaternion.setFromEuler(n)}))},get:function(){return this._angles}},{key:"parents",get:function(){var e=new THING.Selector(this.app,[]);return this._children.forEach((function(t){e.add(t.parents)})),e}},{key:"children",get:function(){return this._children}},{key:"visible",set:function(e){this.children.visible=e}},{key:"pickable",set:function(e){this.children.pickable=e}},{key:"boundingBox",get:function(){for(var e=new THREE.Box3,t=0;t<this.children.length;t++){var n=this.children[t];e.union(n.box)}var i=new THREE.Vector3;e.getCenter(i);var r=new THREE.Vector3;e.getSize(r);var o=this;return{min:e.min.toArray(),max:e.max.toArray(),center:i.toArray(),size:r.toArray(),radius:r.length(),getWorldPosition:function(e){var t=Ne.parseValue(e.yAngle,0),n=Ne.parseValue(e.xAngle,0),i=Ne.parseValue(e.distance||e.radius,r.length()),a=e.radiusFactor;a&&(i=r.length()*a);var s=(new THREE.Vector3).getDirectionFromAngles(t,n,i);return o.selfToWorld(s)}}}}]),e}(),Nr=function(){function e(t,n){r(this,e),this.app=t,this.nodes=[],this.scene=this.app.scene,this.outdoors=this.app.outdoors,this.objectPool=this.app.objectPool,this.worldNode=new THREE.Object3D,this.campus=null,this.baseURL=null,this.curLoadGLTFIndex=0,this.splitLoadedGLTFCount=0,this.allLoadedGLTFCount=0,this.sliceRootNodeArray=[],this.sceneJsonData=null,this.states=null,this.loadSpeed=.1,this.isCamFitScene=!0,n&&(n.position&&(this.campusPosition=n.position),n.rotation&&(this.campusRotation=n.rotation),void 0!==n.isCamFitScene&&null!==n.isCamFitScene&&(this.isCamFitScene=n.isCamFitScene),void 0!==n.isDelayLoadFloorPlan&&null!==n.isDelayLoadFloorPlan&&(this.isDelayLoadFloorPlan=n.isDelayLoadFloorPlan),n.campus&&(this.campus=n.campus))}return e.prototype.load=function(e){var t=this;return this.baseURL=e,this.scene.add(this.worldNode),new Promise((function(e,n){t.loadSceneJson().then((function(n){t.parseObjects().then((function(){e(t.campus)}))})).then((function(){e(t.campus)})).catch((function(e){n(e)}))}))},e.prototype.loadSceneJson=function(){var e=this;return new Promise((function(t,n){new THREE.FileLoader(e.app.loadingManager).load(e.baseURL+"/scene.json",(function(n){var i=JSON.parse(n);e.sceneJsonData=i,t(i)}),(function(e){}),(function(e){n("cant not load file: scene.json")}))}))},e.prototype.parseObjects=function(){var e=this.sceneJsonData,t=this;return new Promise((function(n,i){t.parse(e).then((function(){t.sliceRootNodeArray=[],n()})).catch((function(e){i(e)}))}))},e.prototype.parse=function(e){var t=this;return new Promise((function(n,i){t.parseWorld(e),n()}))},e.prototype.parseWorld=function(e){var t=this.worldNode;if(null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:t}),this.app.scene.add(this.campus.node)),this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),e.outdoors&&this.parseOutdoors(e.outdoors,t),e.buildings){var n=e.buildings;for(var i in n){var r=n[i],o=new THREE.Vector3(0,0,0),a=i,s=void 0;r.name&&(a=r.name),r.id&&(s=r.id);var l=new THREE.Object3D,u=this.app.objectManager.create({type:"Building",name:a,id:s,parent:this.campus,node:l});if(u.app=this.app,u.node.position.x=o.x,u.node.position.y=o.y,u.node.position.z=o.z,r.plans&&this.parseFloorPlans(r.plans,u),r.facades){var c=r.facades;for(var h in c)this.createThing(c[h],u,"Facade")}if(r.facadegroups){var p=r.facadegroups;for(var d in p)r=p[d],this.createGroup(r,u,"Facade")}if(r.groups){p=r.groups;for(var d in p){r=p[d];this.createGroup(r,u)}}}}},e.prototype.parseOutdoors=function(e){var t=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:t}),this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.currentParentObject=this.outdoors),this.processFloorPlanData(e,this.outdoors)},e.prototype.processFloorPlanData=function(e,t){t.app=this.app,e.placements&&this.parseThings(e.placements,t),e.videoprobes&&this.parseThings(e.videoprobes,t),e.groups&&this.parseGroups(e.groups,t),e.doororwindows&&this.parseDoorWins(e.doororwindows,t),e.rooms&&this.parseRooms(e.rooms,t)},e.prototype.parseRooms=function(e,t){for(var n=0;n<e.length;n++){var i=e[n],r=null;i.name&&(r=i.name);var o=new THREE.Object3D("room_temp"),a=null,s=i.properties;if(s)for(var l in a={},s){var u=s[l];a[l]=u}var c=null,h=null,p=null,d={};if(i.area&&(h=i.area,d.area=h),i.circumference&&(p=i.circumference,d.circumference=p),i.center){var f=i.center;(c=new THREE.Vector3).set(f[0],f[1],-f[2]),d.center=c}this.app.objectManager.create({type:"Room",name:r,node:o,id:undefined,parent:t,properties:a,auxiliaryInfo:d})}},e.prototype.parseDoorWins=function(e,t){new THREE.Group("doors");for(var n in e){var i=e[n],r=n,o=void 0;i.name&&(r=i.name),i.id&&(o=i.id);var a=new THREE.Object3D("doororwin_temp"),s=null;if(i.properties){var l=i.properties;for(var u in s={},l){var c=l[u];s[u]=c}}this.app.objectManager.create({type:"Door",name:r,node:a,id:o,parent:t,properties:s})}},e.prototype.parseGroups=function(e,t){for(var n in e){var i=e[n];(i.name||i.properties)&&this.createGroup(i,t)}},e.prototype.createGroup=function(e,t){var n,i,r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Thing",a=new THREE.Object3D("group_temp");e.id&&(n=e.id),e.name&&(i=e.name);var s=e.properties;if(s)for(var l in r={},s){var u=s[l];r[l]=u}var c=this.app.objectManager.create({type:o,name:i,id:n,node:a,parent:t,properties:r});return c},e.prototype.parseFloorPlans=function(e,t){var n=[];for(var i in e){var r=e[i],o=r.id,a="";r.name&&(a=r.name);var s=new THREE.Object3D,l=this.app.objectManager.create({type:"Floor",name:a,id:o,node:s,parent:t});s.name="floorPlan",t.node.add(l.node),this.processFloorPlanData(r,l),n.push(l)}return n},e.prototype.parseThings=function(e,t,n){for(var i in e){var r=e[i];(r.name||r.properties)&&this.createThing(r,t,n)}},e.prototype.createThing=function(e,t,n){var i,r,o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Thing";e.id&&(i=e.id),e.name&&(r=e.name);var s=e.properties;if(s)for(var l in o={},s){var u=s[l];o[l]=u}var c=new THREE.Object3D("temp_cannotuse"),h=this.app.objectManager.create({type:a,name:r,node:c,id:i,parent:t,properties:o});return h},e}(),Hr=function(){function e(t,n){r(this,e),this.app=t,this.resourceUrl=null,this.relativeResourceUrl=null,this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.tempTexture=null,this.indexJson=n,this.sceneJsonUri="scene.json",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallTexture=null,this.defaultCeilingTexture=null,this.defaultFloorTexture=null,this.defaultRoofTexture=null,this.defaultWallEdgeTexture=null,this.worldNode=new THREE.Object3D("world"),this.isCamFitScene=!0,this.campus=null,this.outdoorsVisible=!0,this.campusVisible=!0,this.enableUseHighestVersionResource=!0;this.worldNode;if(n&&(n.position&&(this.campusPosition=n.position),n.rotation&&(this.campusRotation=n.rotation),void 0!==n.isCamFitScene&&null!==n.isCamFitScene&&(this.isCamFitScene=n.isCamFitScene),n.scale&&(this.campusScale=n.scale),void 0!==n.outdoorsVisible&&(this.outdoorsVisible=n.outdoorsVisible),void 0!==n.campusVisible&&(this.campusVisible=n.campusVisible),n.campus&&(this.campus=n.campus),void 0!==n.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=n.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource)),this.campus&&(this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale)),n&&n.default){var i=n.default;i.sceneJson&&(this.sceneJson="export.json"),i.wallTexture&&(this.defaultWallTextureUri=i.wallTexture),i.wallEdgeTexture&&(this.defaultWallEdgeTextureUri=i.wallEdgeTexture),i.floorTexture&&(this.defaultFloorTextureUri=i.floorTexture),i.ceilingTexture&&(this.defaultCeilingTextureUri=i.ceilingTexture),i.roofTexture&&(this.defaultRoofTextureUri=i.roofTexture)}this.app.options.loaderResourceUrl&&(this.resourceUrl=this.app.options.loaderResourceUrl),null!=this.app.options.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=this.app.options.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),this.app.options.resourceLibraryUrl&&(this.resourceUrl=this.app.options.resourceLibraryUrl),this.indexJson&&this.indexJson.resourceLibrary&&(this.relativeResourceUrl=this.indexJson.resourceLibrary)}return e.prototype.parseCamInfo=function(e){var t=e.eye,n=e.target,i=t.split(" "),r=n.split(" "),o=[Number(i[0]),Number(i[1]),Number(i[2])];o[2]=-o[2];var a=[Number(r[0]),Number(r[1]),Number(r[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.exportJsonString=function(e){for(var t=e.outdoors,n=e.buildings,i=[],r=[],o=0;o<t.things.length;o++){var a=t.things[o];i.push({id:a.id,name:a.name})}for(o=0;o<t.rooms.length;o++){var s=t.rooms[o];r.push({id:s.id,name:s.name})}var l=[];for(o=0;o<n.length;o++){for(var u=n[o],c=[],h=0;h<u.floors.length;h++){for(var p=u.floors[h],d=[],f=[],m=0;m<p.things.length;m++){var g=p.things[m];d.push({id:g.id,name:g.name})}for(m=0;m<p.rooms.length;m++){s=p.rooms[m];f.push({id:s.id,name:s.name})}c.push({id:p.id,name:p.name,placements:d,rooms:f})}l.push({id:u.id,name:u.name,plans:c})}return{id:e.id,name:e.name,outdoors:{id:t.id,name:t.name,placements:i,rooms:r},buildings:l}},e.prototype.load=function(e){var t=this;if("String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var n=e;this.sceneURL=n.url,n.campus&&(this.campus=n.campus,this.worldNode=this.campus.node)}return this.relativeResourceUrl&&(this.resourceUrl=this.sceneURL+this.relativeResourceUrl),new Promise((function(e,n){t.updateProgress(.1),t.loadSceneJson().then((function(n){t.sceneJson=JSON.parse(n),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.updateProgress(.15);var i=new json2mesh.UBuilderSceneSimpleLoader;t.resourceUrl&&(i.resourceManager.baseTextureUrl=t.resourceUrl+"/texture/",i.resourceManager.baseModelUrl=t.resourceUrl+"/model/"),i.load({json:t.sceneJson,customModeBaseUrl:t.sceneURL+"/"}).then((function(n){t.parseWorld(n),t.updateProgress(.2),t.updateProgress(1),e(t.campus)}))}))}))},e.prototype.loadSceneJson=function(){var e=this;return new Promise((function(t,n){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL+"/"+e.sceneJsonUri,(function(e){t(e)}))}))},e.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess({object:this.campus,progress:e})},e.prototype.createTextureLoaderPromise=function(e){var t=this;return new Promise((function(n,i){(new THREE.TextureLoader).load(t.sceneURL+"/"+e,(function(e){n(e)}),(function(t){console.log(e+" "+t.loaded/t.total*100+"% loaded")}),(function(t){console.log(e+"load error")}))}))},e.prototype.loadDefaultTexture=function(){var e=this;return new Promise((function(t,n){var i=e.createTextureLoaderPromise(e.defaultWallTextureUri),r=e.createTextureLoaderPromise(e.defaultWallEdgeTextureUri),o=e.createTextureLoaderPromise(e.defaultFloorTextureUri),a=e.createTextureLoaderPromise(e.defaultRoofTextureUri),s=e.createTextureLoaderPromise(e.defaultCeilingTextureUri);Promise.all([i,r,o,a,s]).then((function(e){DefaultResource.wallTexture=e[0],DefaultResource.wallEdgeTexture=e[1],DefaultResource.floorTexture=e[2],DefaultResource.ceilinngTexture=e[3],DefaultResource.roofTexture=e[4],t()}))}))},e.prototype.parseWorld=function(e){null===this.campus?(this.campus=this.app.objectManager.create({uuid:e.id,id:e.userID,type:"Campus",name:"Campus",node:this.worldNode}),this.campus.visible=this.campusVisible,this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale)):(this.campus.uuid=e.id,e.userID&&(this.campus.id=e.userID));for(var t=0;t<e.buildings.length;t++){var n=e.buildings[t];this.parseBuilding(n)}if(e.outdoors){var i=new THREE.Object3D("outdoors");i.name="plan",this.outdoors=this.app.objectManager.create({uuid:e.outdoors.id,id:e.outdoors.userID,type:"Outdoors",name:e.outdoors.name,parent:this.campus,node:i}),this.outdoors.visible=this.outdoorsVisible,this.parseFloorPlan(e.outdoors,this.outdoors)}},e.prototype.parseBuilding=function(e){var t=new THREE.Object3D("building");t.name="building";var n=this.app.objectManager.create({uuid:e.id,id:e.userID,type:"Building",name:e.name,parent:this.campus,node:t,properties:e.properties});n.localPosition=e.position;for(var i=e.floorplans,r=e.facades,o=e.facadeGroups,a=0;a<r.length;a++){var s=r[a];this.app.objectManager.create({type:"Facade",id:s.userID,name:s.name,uuid:s.id,node:s.delayObject,parent:n,properties:s.properties})}for(a=0;a<o.length;a++)s=o[a],this.app.objectManager.create({type:"Facade",uuid:s.id,id:s.userID,name:s.name,node:s.delayObject,parent:n,properties:s.properties});for(var l=0;l<i.length;l++){var u=i[l],c=new THREE.Object3D("floorplan");c.name="plan";var h=this.app.objectManager.create({id:u.userID,uuid:u.id,type:"Floor",name:u.name,properties:u.properties,node:c,parent:n});h.localPosition=u.position,this.parseFloorPlan(u,h),0!==n.facades.length&&(h.visible=!1)}},e.prototype.placementInitCallback=function(e){this.app.objectManager.create({id:e.id,name:e.name,node:e.mesh,parent:plan,animations:e.resource.animations,properties:e.properties})},e.prototype.parseOutdoors=function(e){},e.prototype.parseFloorPlan=function(e,t){for(var n=0;n<e.walls.length;n++)for(var i=e.walls[n],r=0;r<i.doorOrWindows.length;r++){var o=i.doorOrWindows[r],a="Door";if(o.jsonData&&o.jsonData.type&&(a=o.jsonData.type),o.mesh){var s=this.app.objectManager.create({type:"Door",uuid:o.id,id:o.userID,name:o.name,node:o.delayObject,parent:t,animations:o.resource.animations,properties:o.properties});if(o.isOpen&&s.open(),s.animationClips)for(r=0;r<s.animationClips.length;r++){var l=s.animationClips[r];if("_defaultAnim_"===l.name){s.playAnimation({name:l.name,loop:!0,speed:.15});break}}}else o.initCompleteCallback=function(e){e.jsonData&&e.jsonData.type&&e.jsonData.type;var n=b.app.objectManager.create({type:"Door",uuid:e.id,id:e.userID,name:e.name,node:e.mesh,parent:t,animations:e.resource.animations,properties:e.properties});if(t.miscNode.add(n.node),e.isOpen&&n.open(),n.animationClips)for(var i=0;i<n.animationClips.length;i++){var r=n.animationClips[i];if("_defaultAnim_"===r.name){n.playAnimation({name:r.name,loop:!0,speed:.15});break}}}}var u=new THREE.Object3D("combineFloor");for(n=0;n<e.combineFloors.length;n++){var c=e.combineFloors[n];u.add(c)}t.node.add(u),t.floorNode=u;var h=new THREE.Object3D("combineCeiling");for(n=0;n<e.combineCeilings.length;n++){var p=e.combineCeilings[n];h.add(p)}t.node.add(h),t.ceilingNode=h;var d=new THREE.Object3D("combineRoof");for(n=0;n<e.combineRoofs.length;n++){var f=e.combineRoofs[n];d.add(f)}t.node.add(d),t.roofNode=d;var m=new THREE.Object3D("combinePlacement");for(n=0;n<e.combinePlacements.length;n++){var g=e.combinePlacements[n];m.add(g)}t.node.add(m),t.miscNode=m;for(var v=new THREE.Object3D("combineWall"),y=0;y<e.combineStraightManualWalls.length;y++){i=e.combineStraightManualWalls[y];v.add(i)}for(y=0;y<e.combineModelWalls.length;y++){i=e.combineModelWalls[y];v.add(i)}for(y=0;y<e.combineDoorOrWins.length;y++){g=e.combineDoorOrWins[y];v.add(g)}t.node.add(v),t.wallNode=v;for(n=0;n<e.groups.length;n++){g=e.groups[n],a="Thing";g.jsonData&&g.jsonData.type&&(a=g.jsonData.type);s=this.app.objectManager.create({uuid:g.id,id:g.userID,name:g.name,node:g.delayObject,belongRoomUserID:g.belongRoomUserID,type:a,parent:t,properties:g.properties})}var b=this;for(n=0;n<e.placements.length;n++){g=e.placements[n],a="Thing";if(g.jsonData&&g.jsonData.type&&(a=g.jsonData.type),g.mesh){if((s=this.app.objectManager.create({uuid:g.id,id:g.userID,name:g.name,type:a,belongRoomUserID:g.belongRoomUserID,node:g.delayObject,parent:t,url:g.resource.getModelUrl(),animations:g.resource.animations,properties:g.properties})).bundleID=g.resource.modelID,s.bundleName=g.resource.modelName,g.isPlayAnim&&s.containAnimation(g.animClip)){var _={name:g.animClip,loop:!1,speed:.15};g.hasSkin&&(_.loop=!0),s.playAnimation(_)}}else g.initCompleteCallback=function(e){a="Thing",e.jsonData&&e.jsonData.type&&(a=e.jsonData.type);var n=b.app.objectManager.create({uuid:e.id,id:e.userID,belongRoomUserID:e.belongRoomUserID,name:e.name,node:e.mesh,parent:t,type:a,url:e.resource.getModelUrl(),animations:e.resource.animations,properties:e.properties});if(n.bundleID=e.resource.modelID,n.bundleName=e.resource.modelName,t.miscNode.add(n.node),e.isPlayAnim&&n.containAnimation(e.animClip)){var i={name:e.animClip,loop:!1,speed:.15};e.hasSkin&&(i.loop=!0),n.playAnimation(i)}}}for(n=0;n<e.videoprobes.length;n++){if((g=e.videoprobes[n]).mesh)s=this.app.objectManager.create({id:g.userID,name:g.name,uuid:g.id,belongRoomUserID:g.belongRoomUserID,node:g.delayObject,parent:t,url:g.resource.getModelUrl(),animations:g.resource.animations,properties:g.properties});else g.initCompleteCallback=function(e){var n=b.app.objectManager.create({id:e.userID,name:e.name,uuid:e.id,belongRoomUserID:e.belongRoomUserID,node:e.mesh,parent:t,url:e.resource.getModelUrl(),animations:e.resource.animations,properties:e.properties});t.miscNode.add(n.node)}}for(n=0;n<e.rooms.length;n++){var x=e.rooms[n];c=this.app.objectManager.create({type:"Room",name:x.name,node:x.mesh,uuid:x.id,id:x.userID,ceilingNode:x.ceiling.mesh,roofNode:x.roof.mesh,floorNode:x.floor.mesh,parent:t,properties:x.properties})}for(n=0;n<e.curvelines.length;n++){var E=e.curvelines[n];this.parseCurveLines(E,t)}for(n=0;n<e.pipelines.length;n++){E=e.pipelines[n];this.parsePipeLines(E,t)}},e.prototype.parsePipeLines=function(e,t){var n={type:"PolygonLine",name:e.name,points:e.points,id:e.userID,uuid:e.id,parent:t,style:{}};e.color&&(n.style.color="#"+e.color.getHexString());var i=this;if(e.resource)e.initCompleteCallback=function(t){n.image=t.resource.getTextureUrl();var r=i.app.objectManager.create(n);r.node.position.set(e.position.x,e.position.y,e.position.z),e.sectionType&&"Triangle"===e.sectionType&&(r.pathRadialSegments=3,r._updateByPoints()),e.radius&&(r.width=e.radius)};else{var r=i.app.objectManager.create(n);r.node.position.set(e.position.x,e.position.y,e.position.z),e.sectionType&&"Triangle"===e.sectionType&&(r.pathRadialSegments=3,r._updateByPoints()),e.radius&&(r.width=e.radius)}},e.prototype.parseCurveLines=function(e,t){var n={type:"RouteLine",parent:t,name:e.name,uuid:e.id,id:e.userID,points:e.points,arrowFlag:!1,style:{}},i=this;if(e.color&&(n.style.color="#"+e.color.getHexString()),e.resource)e.initCompleteCallback=function(t){if(t.resource.texture){var r=t.resource.texture.clone();r.rotation=Math.PI/2,n.image=r}var o=i.app.objectManager.create(n);null!==e.width&&(o.width=e.width),o.node.position.set(e.position.x,e.position.y,e.position.z)};else{var r=i.app.objectManager.create(n);null!==e.width&&(r.width=e.width),r.node.position.set(e.position.x,e.position.y,e.position.z)}},e}();var zr=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){!function(t){var n=Object.prototype,i=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag",l=t.regeneratorRuntime;if(l)e.exports=l;else{(l=t.regeneratorRuntime=e.exports).wrap=f;var u={},c={};c[o]=function(){return this};var h=Object.getPrototypeOf,p=h&&h(h(M([])));p&&p!==n&&i.call(p,o)&&(c=p);var d=y.prototype=g.prototype=Object.create(c);v.prototype=d.constructor=y,y.constructor=v,y[s]=v.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(d),e},l.awrap=function(e){return{__await:e}},b(_.prototype),_.prototype[a]=function(){return this},l.AsyncIterator=_,l.async=function(e,t,n,i){var r=new _(f(e,t,n,i));return l.isGeneratorFunction(t)?r:r.next().then((function(e){return e.done?e.value:r.next()}))},b(d),d[s]="Generator",d[o]=function(){return this},d.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},l.values=M,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=undefined)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,i){return a.type="throw",a.arg=e,t.next=n,i&&(t.method="next",t.arg=undefined),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=i.call(o,"catchLoc"),l=i.call(o,"finallyLoc");if(s&&l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;w(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:M(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=undefined),u}}}function f(e,t,n,i){var r=t&&t.prototype instanceof g?t:g,o=Object.create(r.prototype),a=new T(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(r,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw o;return S()}for(n.method=r,n.arg=o;;){var a=n.delegate;if(a){var s=x(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=m(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,a),o}function m(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function g(){}function v(){}function y(){}function b(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function _(e){var t;this._invoke=function(n,r){function o(){return new Promise((function(t,o){!function t(n,r,o,a){var s=m(e[n],e,r);if("throw"!==s.type){var l=s.arg,u=l.value;return u&&"object"==typeof u&&i.call(u,"__await")?Promise.resolve(u.__await).then((function(e){t("next",e,o,a)}),(function(e){t("throw",e,o,a)})):Promise.resolve(u).then((function(e){l.value=e,o(l)}),a)}a(s.arg)}(n,r,t,o)}))}return t=t?t.then(o,o):o()}}function x(e,t){var n=e.iterator[t.method];if(undefined===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=undefined,x(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=m(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,u):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function M(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=undefined,t.done=!0,t};return r.next=r}}return{next:S}}function S(){return{value:undefined,done:!0}}}(function(){return this}()||Function("return this")())})),Ur=function(){return this}()||Function("return this")(),Vr=Ur.regeneratorRuntime&&Object.getOwnPropertyNames(Ur).indexOf("regeneratorRuntime")>=0,qr=Vr&&Ur.regeneratorRuntime;Ur.regeneratorRuntime=void 0;var Gr=zr;if(Vr)Ur.regeneratorRuntime=qr;else try{delete Ur.regeneratorRuntime}catch(v){Ur.regeneratorRuntime=void 0}var Wr=Gr,Xr=function e(t,n,i,o){r(this,e),this.positionArray=t.geometry.getAttribute("position").array.slice();var a=t.geometry.getAttribute("normal");a?this.normalArray=a.array.slice():console.warn("not has normal");var s=t.geometry.getAttribute("uv");s&&(this.uvArray=s.array);var l=t.geometry.getAttribute("uv2");l&&(this.uv2Array=l.array);var u=t.geometry.getAttribute("color");u&&(this.colorArray=u.array),this.indexArray=t.geometry.index.array,this.material=t.material;for(var c=this.positionArray,h=this.normalArray,p=0;p<c.length;){for(var d=o.length-1;d>-1;d--){var f=n[d],m=i[d],g=o[d];c[p]*=f.x,c[p+1]*=f.y,c[p+2]*=f.z;var v=new THREE.Vector3(c[p],c[p+1],c[p+2]);if((v=v.applyQuaternion(m)).x+=g.x,v.y+=g.y,v.z+=g.z,c[p]=v.x,c[p+1]=v.y,c[p+2]=v.z,h){var y=new THREE.Vector3(h[p],h[p+1],h[p+2]);y=y.applyQuaternion(m),h[p]=y.x,h[p+1]=y.y,h[p+2]=y.z}}p+=3}this.vertexCount=this.positionArray.length/3,this.indexCount=this.indexArray.length},Jr=function(){function e(t){r(this,e),this.bundeObj=t,this.materialMap=new Map,this.combineBundleMeshs=[]}return e.prototype.combine=function(){this._combine(this.bundeObj,[],[],[])},e.prototype._combine=function(e,t,n,i){if(t.push(e.scale),i.push(e.position),n.push(e.quaternion),e instanceof THREE.Mesh){var r=new Xr(e,t,n,i);0!==r.vertexCount&&(this.combineBundleMeshs.push(r),void 0===this.materialMap.get(r.material)&&this.materialMap.set(r.material,[]),this.materialMap.get(r.material).push(r))}if(0!==e.children.length)for(var o=0;o<e.children.length;o++){var a=n.slice(),s=t.slice(),l=i.slice();this._combine(e.children[o],s,a,l)}},e}(),Yr=function e(){r(this,e),this.positions=[],this.scales=[],this.quaternions=[]},Qr=function(){function e(t){r(this,e),this.vertexCount=0,this.indexCount=0,this.material=t,this.bundeMeshs=[],this.transformations=[],this.maxCount=65534,this.combineMesh=null}return e.prototype.isExceed=function(e){return this.vertexCount+e>this.maxCount},e.prototype.add=function(e,t){if(this.isExceed(e.vertexCount))return console.error("combine exceed vertex count "),!1;this.vertexCount+=e.vertexCount,this.indexCount+=e.indexCount,this.bundeMeshs.push(e),this.transformations.push(t)},e.prototype.build=function(){for(var e=this.bundeMeshs,t=this.indexCount,n=this.vertexCount,i=new Float32Array(3*n),r=new Float32Array(3*n),o=new Float32Array(2*n),a=new Float32Array(4*n),s=new Float32Array(2*n),l=new Uint16Array(t),u=0,c=0,h=0,p=0,d=0,f=new THREE.BufferGeometry,m=0;m<e.length;m++){for(var g=e[m],v=this.transformations[m],y=v.positions,b=v.scales,_=v.quaternions,x=g.indexArray,E=0;E<x.length;E++)l[E+p]=u/3+x[E];p+=x.length;var w=g.positionArray;for(E=0;E<w.length;){for(var T=new THREE.Vector3(w[E],w[E+1],w[E+2]),M=y.length-1;M>-1;M--){var S=y[M],C=b[M],A=_[M];T.x*=C.x,T.y*=C.y,T.z*=C.z,(T=T.applyQuaternion(A)).x+=S.x,T.y+=S.y,T.z+=S.z}i[E+u]=T.x,i[E+u+1]=T.y,i[E+u+2]=T.z,E+=3}u+=w.length;var R=g.normalArray;for(E=0;E<R.length;){var P=new THREE.Vector3(R[E],R[E+1],R[E+2]);for(M=_.length-1;M>-1;M--){A=_[M];P=P.applyQuaternion(A)}r[E+c]=P.x,r[E+c+1]=P.y,r[E+c+2]=P.z,E+=3}c+=R.length;var D=g.uvArray;if(D)for(E=0;E<D.length;E++)o[E+h]=D[E];var k=g.uv2Array;if(k)for(E=0;E<k.length;E++)s[E+h]=k[E];D&&(h+=D.length);var j=g.colorArray;if(j){for(E=0;E<j.length;E++)a[E+d]=j[E];d+=j.length}}f.addAttribute("position",new THREE.BufferAttribute(i,3)),f.addAttribute("normal",new THREE.BufferAttribute(r,3)),f.addAttribute("uv",new THREE.BufferAttribute(o,2)),0!==s.length&&f.addAttribute("uv2",new THREE.BufferAttribute(s,2)),0!==a.length&&f.addAttribute("color",new THREE.BufferAttribute(a,4)),f.setIndex(new THREE.BufferAttribute(l,1));var O=new THREE.Mesh(f,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,O.name="combine",this.combineMesh=O},e}(),Zr=function(){function e(t){r(this,e),this.app=t,this.combineBundleObjectMap={},this.processorMap=new Map,this.floorMaterialMap=new Map,this.processors=[]}return e.prototype.combineModels=function(){var e=this.app.modelResource.models,t=[],n=this;for(var i in e)t.push(new Promise((function(t,r){var o=performance.now(),a=new Jr(e[i].node);n.combineBundleObjectMap[i]=a,a.combine(),performance.now()-o>.1?setTimeout((function(){t()}),10):t()})));return Promise.all(t)},e.prototype.getModelObject=function(e){var t=this.combineBundleObjectMap[e];return t||null},e.prototype.addPlacement=function(e,t,n,i,r){var o=this.floorMaterialMap.get(e);o||(o=new Map,this.floorMaterialMap.set(e,o));var a=this.processorMap.get(e);a||(this.processorMap.set(e,[]),a=this.processorMap.get(e));var s=new Yr;s.positions=n,s.scales=i,s.quaternions=r,this.combineBundleObjectMap[t].materialMap.forEach((function(e,t,n){for(var i=e,r=t,l=0;l<i.length;l++){var u=i[l],c=o.get(r);c&&!c.isExceed(u.vertexCount)||(c=new Qr(r),o.set(r,c),a.push(c)),c.add(u,s)}}))},e.prototype.getCombineProcessors=function(e,t,n,i){var r=[],o=new Map;for(var a in e){var s=e[a];if(!s.uid&&!s.name){var l=this.app.modelResource.bundleIDArray[s.bIdx],u=(this.app.modelResource.get(l).node,new THREE.Vector3(0,0,0)),c=new Yr;if(s.pos){var h=s.pos.split(" ");u.x=parseFloat(h[0]),u.y=parseFloat(h[1]),u.z=-parseFloat(h[2])}var p=new THREE.Vector3(1,1,1);if(s.scl){var d=s.scl.split(" ");p.x=parseFloat(d[0]),p.y=parseFloat(d[1]),p.z=parseFloat(d[2])}var f=new THREE.Quaternion(0,0,0,1);if(s.rot){var m=s.rot.split(" ");f.x=parseFloat(m[0]),f.y=parseFloat(m[1]),f.z=-parseFloat(m[2]),f.w=-parseFloat(m[3])}var g=t.slice(),v=n.slice(),y=i.slice();y.push(f),v.push(p),g.push(u),c.positions=g,c.scales=v,c.quaternions=y,this.combineBundleObjectMap[l].materialMap.forEach((function(e,t,n){for(var i=e,a=t,s=0;s<i.length;s++){var l=i[s],u=o.get(a);u&&!u.isExceed(l.vertexCount)||(u=new Qr(a),o.set(a,u),r.push(u)),u.add(l,c)}}))}}return r},e}(),Kr=function(){function e(t){r(this,e),this.app=t,this.nodes=[],this.scene=this.app.scene,this.objectPool=this.app.objectPool,this.worldNode=new THREE.Object3D,this.app.scene.add(this.worldNode),this.baseURL=t.sceneURL,this.curLoadGLTFIndex=0,this.splitLoadedGLTFCount=0,this.allLoadedGLTFCount=0,this.sliceRootNodeArray=[],this.sceneJsonData=null,this.states=null,this.combineManager=new Zr(this.app),this.combineProcessorMap=new Map,this.loadSpeed=.1}return e.prototype.load=function(){var e=this;return new Promise((function(t,n){e.loadSceneJson().then((function(t){return t.camInfo&&(e.parseCamInfo(t.camInfo),e.app.camera.update()),e.sceneJsonData=t,e.loadStructureJson()})).then((function(t){var n=e.getSortedStructureGLTFs(t);return new Promise((function(t,i){e.loadStructure(n,(function(){e.parseObjects().then((function(){t(e.worldNode)}))}))}))})).then((function(){t(e.worldNode)})).catch((function(e){n(e)}))}))},e.prototype.loadSceneJson=function(){var e=this;return new Promise((function(t,n){(new THREE.FileLoader).load(e.baseURL+"/scene.json",(function(e){var n=JSON.parse(e);t(n)}),(function(e){}),(function(e){n("cant not load file: scene.json")}))}))},e.prototype.loadStructureJson=function(){var e=this;return new Promise((function(t,n){(new THREE.FileLoader).load(e.baseURL+"/structure.json",(function(e){var n=JSON.parse(e);t(n)}),(function(){}),(function(e){n("cant not load file: structure.json")}))}))},e.prototype.loadStructure=function(e,t,n){this.splitLoadedGLTFCount=0;var i=this,r=0;if(0==e.length)t&&t();else for(var o=i.curLoadGLTFIndex;o<e.length&&(0==r||r%10!=0);o++){r++,i.curLoadGLTFIndex++;var a=new THREE.GLTFLoader(i.app.loadingManager);a.setCrossOrigin("anonymous"),a.load(i.baseURL+"/"+e[o].path,(function(r){var o=r.scene.children[0].children[0];i.nodes[o.name]=o,i.sliceRootNodeArray.push(o),o.traverse((function(e){i.nodes[e.name]=e})),i.splitLoadedGLTFCount++,i.allLoadedGLTFCount++,10===i.splitLoadedGLTFCount&&i.loadStructure(e,t,n),i.app.scene.add(o),i.allLoadedGLTFCount==e.length&&t&&t()}),(function(){}),(function(t){n&&n("load "+i.baseURL+"/"+e[o].path+" failed")}))}},e.prototype.parseObjects=function(){var e=this.sceneJsonData,t=this;return e.bIdList?new Promise((function(n,i){t.parseBundleList(e.bIdList).then((function(){return t.parse(e)})).then((function(){t.sliceRootNodeArray=[],n()})).catch((function(e){i(e)}))})):new Promise((function(n,i){t.parse(e).then((function(){t.sliceRootNodeArray=[],n()})).catch((function(e){i(e)}))}))},e.prototype.getSortedStructureGLTFs=function(e){var t=[],n=[],i=[],r=e.outdoors,o=e.buildings;for(var a in r){var s=r[a];t.push(s)}for(var l=0;l<t.length;l++){var u=t[l];if(0!=n.length)for(var c=0;c<n.length;c++){var h=n[c];if(u.size<h.size){n.splice(c,0,u);break}if(c==n.length-1){n.push(u);break}}else n.push(t[l])}for(var a in t=[],o)t.push(o[a]);for(l=0;l<t.length;l++){u=t[l];if(0!=i.length)for(c=0;c<i.length;c++){h=i[c];if(u.size<h.size){i.splice(c,0,u);break}if(c==i.length-1){i.push(u);break}}else i.push(t[l])}return n.concat(i)},e.prototype._nestingLoopYield=function(e,t,n){var i=this,r=e.next();if(r.done)return t&&t(),r.value;var o=r.value;r.done;o instanceof Promise?o.then((function(r){return i._nestingLoopYield(e,t,n)})).catch((function(e){n(e)})):this._nestingLoopYield(e,t,n)},e.prototype.parse=function(e){var t=this;return this.combineManager.combineModels().then((function(){return new Promise((function(n,i){if(e.objects){var r=e.objects,o=null;for(var a in r){o=r[a];break}t._nestingLoopYield(t.parseWorld(o),(function(){n()}))}if(e.camInfo){var s=e.camInfo;t.parseCamInfo(s)}}))}))},e.prototype.parseCamInfo=function(e){var t=e.eye,n=e.target,i=t.split(" "),r=n.split(" "),o=[Number(i[0]),Number(i[1]),Number(i[2])];o[2]=-o[2];var a=[Number(r[0]),Number(r[1]),Number(r[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.parseWorld=function(e){var t=Wr.mark(v),n=this.worldNode;if(e.plan&&this.parseOutdoors(e.plan,n),e.bds){var i=e.bds;for(var r in i){var o=i[r],a=new THREE.Vector3(0,0,0);if(o.pos){var s=o.pos.split(" ");a.x=parseFloat(s[0]),a.y=parseFloat(s[1]),a.z=-parseFloat(s[2])}var l=new THREE.Object3D,u=this.app.objectManager.create({type:"Building",name:r,node:l});if(u.name=r,u.app=this.app,u.id=r,n.add(l),o.plans)this.parseFloorPlans(o.plans,u);if(o.facades){var c=o.facades;for(var h in c){var p=this.createThing(c[h],u,null,"Facade"),d=p.node.position;d.x+=a.x,d.y+=a.y,d.z+=a.z,p.node.position.set(d.x,d.y,d.z)}}if(o.groups){var f=o.groups;for(var m in f){o=f[m];this.createGroup(o,u)}}}}var g=this;function v(e){var n,i,r,o,a,s,l,u,c;return Wr.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=g.loadSpeed,i=10,r=e.keys(),o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();case 3:if(!o){t.next=9;break}if(!(a>=r.length)){t.next=6;break}return t.abrupt("break",24);case 6:s=r[a++],t.next=13;break;case 9:if(!(a=r.next()).done){t.next=12;break}return t.abrupt("break",24);case 12:s=a.value;case 13:l=s,u=e.get(l),c=0;case 16:if(!(c<u.length)){t.next=22;break}return t.next=19,new Promise((function(e,t){var r=performance.now();u[c].build();var o=u[c].combineMesh;l.node.add(o),performance.now()-r>n?setTimeout((function(){e()}),i):e()}));case 19:c++,t.next=16;break;case 22:t.next=3;break;case 24:case"end":return t.stop()}}),t,this)}return v(this.combineProcessorMap)},e.prototype.parseOutdoors=function(e,t){var n,i;for(var r in e){i=e[r],n=r;break}var o=this.app.outdoors;this.worldNode.add(o.node),this.processFloorPlanData(n,i,o)},e.prototype.processFloorPlanData=function(e,t,n){n.name=e,n.app=this.app,n.id=e;var i=new THREE.Vector3(0,0,0);if(t.pos){var r=t.pos.split(" ");i.x=parseFloat(r[0]),i.y=parseFloat(r[1]),i.z=-parseFloat(r[2])}var o=t.cwalls;if(o){var a=new THREE.Group;for(var s in a.name="combinewall",o){var l=o[s].gltfid,u=this.nodes[l];u&&a.add(u)}n.node.add(a),a.updateMatrixWorld(),n.wallNode=a}var c=t.croofs;if(c){var h=new THREE.Group;for(var s in h.name="combineroof",c){l=c[s].gltfid;var p=this.nodes[l];p&&h.add(p)}n.node.add(h),n.roofNode=h}var d=t.cceilings;if(d){var f=new THREE.Group;for(var s in f.name="combineceiling",d){l=d[s].gltfid;var m=this.nodes[l];m&&f.add(m)}n.node.add(f),n.ceilNode=f}if(v=t.cfloors){var g=new THREE.Group;for(var s in g.name="combinefloor",v){var v;if(l=(v=v[s]).gltfid){var y=this.nodes[l];y&&g.add(y)}}n.node.add(g),n.floorNode=g}var b=new THREE.Group;b.name="combinePlacement",n.miscNode=b,n.node.add(b);var _=t.cplcs;if(_)for(var s in _){l=_[s].gltfid;var x=this.nodes[l];x&&(b.add(x),x.updateMatrixWorld())}if(t.plcs){var E=this.combineManager.getCombineProcessors(t.plcs,[i],[new THREE.Vector3(1,1,1)],[new THREE.Quaternion(0,0,0,1)]);this.combineProcessorMap.set(n,E),this.parseThings(t.plcs,n,i)}t.routes&&this.parseStructureThing(t.routes,n),t.pipelines&&this.parseStructureThing(t.pipelines,n),t.curvelines&&this.parseStructureThing(t.curvelines,n),t.arrowlines&&this.parseStructureThing(t.arrowlines,n),t.arrowdatalines&&this.parseStructureThing(t.arrowdatalines,n),t.leakwaterlines&&this.parseStructureThing(t.leakwaterlines,n),t.vps&&this.parseThings(t.vps,n,i),t.groups&&this.parseGroups(t.groups,n,[new THREE.Vector3(1,1,1)],[new THREE.Quaternion(0,0,0,1)],[i],i),t.dws&&this.parseDoorWins(t.dws,n,i)},e.prototype.parseDoorWins=function(e,t,n){for(var i in e){var r=e[i],o=i;r.uid&&(o=r.uid);var a=null;if(r.gltfid){var s=r.gltfid;this.nodes[s]&&((a=this.nodes[s]).position.x+=n.x,a.position.y+=n.y,a.position.z+=n.z,t.node.add(a))}var l=null;if(r.prop){var u=r.prop;for(var c in l={},u){var h=u[c];l[c]=h}}this.app.objectManager.create({type:"Door",name:o,node:a,parent:t,properties:l})}},e.prototype.parseGroups=function(e,t,n,i,r,o){for(var a in e){var s=e[a];s.uid?this.createGroup(s,t):this.combineGroup(s,t,n,i,r,o)}},e.prototype.createGroup=function(e,t){var n,i,r=this.instanceGroup(e);e.id&&e.id,e.uid&&(n=e.uid);var o=e.prop;if(o)for(var a in i={},o){var s=o[a];i[a]=s}return this.app.objectManager.create({type:"Thing",name:n,node:r,parent:t,properties:i})},e.prototype.parseFloorPlans=function(e,t){var n=[];for(var i in e){var r=e[i],o=new THREE.Object3D,a=this.app.objectManager.create({type:"Floor",name:i,node:o,parent:t});a.id=i,o.name="floorPlan",t.node.add(a.node),this.processFloorPlanData(i,r,a),a._parent=t,n.push(a)}return n},e.prototype.parseBundleList=function(e){this.app.modelResource.bundleIDArray=e;var t=0,n=this;return new Promise((function(i,r){0!=e.length?e.forEach((function(o){var a=new THREE.GLTFLoader(n.app.loadingManager);a.setCrossOrigin("anonymous"),a.load(n.baseURL+"/"+o+"/scene.gltf",(function(r){t++,n.app.modelResource.set(o,r.scene.children[0].children[0]),t==e.length&&i()}),(function(){}),(function(e){r("can not load "+n.baseURL+"/"+o+"/scene.gltf")}))})):i()}))},e.prototype.combineGroup=function(e,t,n,i,r,o){var a=e,s=new THREE.Vector3(0,0,0);if(a.pos){var l=a.pos.split(" ");s.x=parseFloat(l[0]),s.y=parseFloat(l[1]),s.z=-parseFloat(l[2])}var u=new THREE.Vector3(1,1,1);if(a.scl){var c=a.scl.split(" ");u.x=parseFloat(c[0]),u.y=parseFloat(c[1]),u.z=parseFloat(c[2])}var h,p,d,f=new THREE.Quaternion(0,0,0,1);if(a.rot){c=a.rot.split(" ");f.x=parseFloat(c[0]),f.y=parseFloat(c[1]),f.z=-parseFloat(c[2]),f.w=-parseFloat(c[3])}if(r?(h=n.slice(),d=i.slice(),p=r.slice()):(h=[],p=[],d=[]),h.push(u),p.push(s),d.push(f),a.plcs){var m=this.combineManager.getCombineProcessors(a.plcs,p,h,d),g=this.combineProcessorMap.get(t);g&&(m=g.concat(m)),this.combineProcessorMap.set(t,m)}if(a.groups)for(var v in a.groups)this.combineGroup(a.groups[v],t,h,d,p,o)},e.prototype.instanceGroup=function(e){var t=new THREE.Vector3(0,0,0);if(e.pos){var n=e.pos.split(" ");t.x=parseFloat(n[0]),t.y=parseFloat(n[1]),t.z=-parseFloat(n[2])}var i=new THREE.Vector3(1,1,1);if(e.scl){var r=e.scl.split(" ");i.x=parseFloat(r[0]),i.y=parseFloat(r[1]),i.z=parseFloat(r[2])}var o=new THREE.Quaternion(0,0,0,1);if(e.rot){r=e.rot.split(" ");o.x=parseFloat(r[0]),o.y=parseFloat(r[1]),o.z=-parseFloat(r[2]),o.w=-parseFloat(r[3])}var a=new THREE.Group;if(e.plcs)for(var s in e.plcs){var l=this.instanceChildOfGroup(e.plcs[s]);a.add(l)}if(e.groups)for(var s in e.groups){l=this.instanceGroup(e.plcs[s]);a.add(l)}return a.scale.copy(i),a.setRotationFromQuaternion(o),a.position.copy(t),a},e.prototype.instanceChildOfGroup=function(e){var t=this.app.modelResource.bundleIDArray[e.bIdx],n=this.app.modelResource.get(t).node.clone();if(e.pos){var i=e.pos.split(" ");n.position.x=parseFloat(i[0]),n.position.y=parseFloat(i[1]),n.position.z=-parseFloat(i[2])}if(e.rot){i=e.rot.split(" ");var r=new THREE.Quaternion;r.x=parseFloat(i[0]),r.y=parseFloat(i[1]),r.z=-parseFloat(i[2]),r.w=-parseFloat(i[3]),n.setRotationFromQuaternion(r)}return n},e.prototype.parseThings=function(e,t,n){for(var i in e){var r=e[i];(r.uid||r.prop)&&this.createThing(r,t,n)}},e.prototype.createThing=function(e,t,n){var i,r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Thing";e.id&&e.id,e.uid&&(i=e.uid);var a=e.prop;if(a)for(var s in r={},a){var l=a[s];r[s]=l}var u=this.app.modelResource.bundleIDArray[e.bIdx],c=this.app.modelResource.get(u).node,h=c.clone();if(e.pos){var p=e.pos.split(" "),d=new THREE.Vector3(parseFloat(p[0]),parseFloat(p[1]),-parseFloat(p[2]));n&&(d.x+=n.x,d.y+=n.y,d.z+=n.z),h.position.x=d.x,h.position.y=d.y,h.position.z=d.z}if(e.rot){p=e.rot.split(" ");var f=new THREE.Quaternion;f.x=parseFloat(p[0]),f.y=parseFloat(p[1]),f.z=-parseFloat(p[2]),f.w=-parseFloat(p[3]),h.setRotationFromQuaternion(f)}if(e.scl){p=e.scl.split(" ");var m=new THREE.Vector3;m.x=parseFloat(p[0]),m.y=parseFloat(p[1]),m.z=-parseFloat(p[2]),h.scale.x=m.x,h.scale.y=m.y,h.scale.z=m.z}var g=this.app.objectManager.create({type:o,name:i,node:h,parent:t,properties:r});return g},e.prototype.parseStructureThing=function(e,t,n){for(var i in e){var r=e[i];if(r.gltfid){var o=new tn(this.app);o.name=i,o.app=this.app,r.id&&(o.id=r.id),r.uid&&(o.name=r.uid);var a=r.gltfid;if(this.nodes[a]){var s=this.nodes[a];o.node=s,t.add(o),n&&(s.position.x=n.x,s.position.y=n.y,s.position.z=n.z)}}}},e}(),$r=function(){function e(t,n){r(this,e),this.app=t,this.nodes=[],this.outdoors=this.app.outdoors,this.objectPool=this.app.objectPool,this.worldNode=new THREE.Object3D,this.worldNode.name="world",this.campus=null,this.baseURL=null,this.curLoadGLTFIndex=0,this.splitLoadedGLTFCount=0,this.allLoadedGLTFCount=0,this.sliceRootNodeArray=[],this.sceneJsonData=null,this.states=null,this.combineManager=new Zr(this.app),this.loadSpeed=.1,this.isCamFitScene=!0,this.loadStageWeight=[.1,.1,.3,.5],this.loadedProgress=0,this.curStageLoadProgress=0,this.isDelayLoadFloorPlan=!1,this.envMap=null,this.appFirstTimeLoad=!1,this.outdoors?this.appFirstTimeLoad=!1:this.appFirstTimeLoad=!0,n&&(n.position&&(this.campusPosition=n.position),n.rotation&&(this.campusRotation=n.rotation),void 0!==n.isCamFitScene&&null!==n.isCamFitScene&&(this.isCamFitScene=n.isCamFitScene),void 0!==n.isDelayLoadFloorPlan&&null!==n.isDelayLoadFloorPlan&&(this.isDelayLoadFloorPlan=n.isDelayLoadFloorPlan),n.campus&&(this.campus=n.campus));var i=this.worldNode;null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:i}),this.app.scene.add(this.campus.node)),this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.scene=this.campus.node}return e.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess({object:this.campus,progress:e})},e.prototype.loadSkybox=function(){if(this.sceneJsonData.skybox){for(var e=this.sceneJsonData.skybox,t=0;t<e.length;t++){var n=e[t];n=this.baseURL+n,e[t]=n}var i=this;return new Promise((function(t,n){(new THREE.CubeTextureLoader).load(e,(function(e){e.flipY=!0,i.envMap=e,t()}),null,(function(){console.warn("load skybox fail"),t()}))}))}return new Promise((function(e,t){e()}))},e.prototype.load=function(e){var t=this;if("String"===e.constructor.name)this.baseURL=e;else if("Object"===e.constructor.name){var n=e;this.baseURL=n.url,n.campus&&(this.campus=n.campus,this.worldNode=this.campus.node)}return new Promise((function(e,n){t.loadSceneJson().then((function(e){return e.camInfo&&t.isCamFitScene&&t.parseCamInfo(e.camInfo),t.sceneJsonData=e,t.updateProgress(.1),t.loadSkybox().then((function(){return t.loadStructureJson()}))})).then((function(e){t.updateProgress(.2);var n=t.getSortedStructureGLTFs(e);return new Promise((function(e,i){t.updateProgress(.3),t.loadStructure(n,(function(){t.updateProgress(.7),t.parseObjects().then((function(){t.updateProgress(.8),e(t.campus)}))}))}))})).then((function(){t.updateProgress(1),e(t.campus)})).catch((function(e){n(e)}))}))},e.prototype.loadSceneJson=function(){var e=this;return new Promise((function(t,n){(new THREE.FileLoader).load(e.baseURL+"/scene.json",(function(e){var n=JSON.parse(e);t(n)}),(function(e){}),(function(e){n("cant not load file: scene.json")}))}))},e.prototype.loadStructureJson=function(){var e=this;return new Promise((function(t,n){(new THREE.FileLoader).load(e.baseURL+"/structure.json",(function(e){var n=JSON.parse(e);t(n)}),(function(){}),(function(e){n("cant not load file: structure.json")}))}))},e.prototype.addEnvMap=function(e){var t=this;this.envMap&&e.traverse((function(e){e.material&&(e.material.opacity<1&&!e.material.transparent&&(e.material.transparent=!0,e.material.needsUpdate=!0),e.material.transparent&&(e.material.metalness=1,e.material.roughness=0,e.material.envMap=t.envMap,e.material.envMapIntensity=2,e.material.refractionRatio=1,e.material.needsUpdate=!0),e.material.isMeshStandardMaterial&&(e.material.envMap=t.envMap,e.material.envMapIntensity=1,e.material.refractionRatio=1,e.material.needsUpdate=!0))}))},e.prototype.loadStructure=function(e,t,n){this.splitLoadedGLTFCount=0;var i=this,r=0;if(0==e.length)t&&t();else for(var o=i.curLoadGLTFIndex;o<e.length&&(0==r||r%10!=0);o++){r++,i.curLoadGLTFIndex++;var a=new thingjs.GLTFLoader;a.setCrossOrigin("anonymous");var s=e[o];a.load(i.baseURL+"/"+s.path,(function(r){var o=r.scene.children[0].children[0];i.nodes[o.name]=o,i.sliceRootNodeArray.push(o),o.traverse((function(e){i.nodes[e.name]=e})),i.splitLoadedGLTFCount++,i.allLoadedGLTFCount++,10===i.splitLoadedGLTFCount&&i.loadStructure(e,t,n),(void 0===s.show||s.show)&&i.scene.add(o),i.addEnvMap(o),o.updateMatrixWorld(),i.scene.updateMatrixWorld(!0),i.allLoadedGLTFCount==e.length&&t&&t()}),(function(){}),(function(t){n?n("load "+i.baseURL+"/"+e[o].path+" failed"):console.error("load "+i.baseURL+"/"+s.path+" failed"),console.error(t)}))}},e.prototype.parseObjects=function(){var e=this.sceneJsonData,t=this;return e.models?new Promise((function(n,i){t.parseBundleList(e.models).then((function(){return t.parse(e)})).then((function(){t.sliceRootNodeArray=[],n()})).catch((function(e){i(e)}))})):new Promise((function(n,i){t.parse(e).then((function(){t.sliceRootNodeArray=[],n()})).catch((function(e){i(e)}))}))},e.prototype.getSortedStructureGLTFs=function(e){var t=[],n=[],i=[],r=e.outdoors,o=e.buildings;for(var a in r){var s=r[a];t.push(s)}for(var l=0;l<t.length;l++){var u=t[l];if(0!=n.length)for(var c=0;c<n.length;c++){var h=n[c];if(u.size<h.size){n.splice(c,0,u);break}if(c==n.length-1){n.push(u);break}}else n.push(t[l])}for(var a in t=[],o)t.push(o[a]);for(l=0;l<t.length;l++){u=t[l];if(0!=i.length)for(c=0;c<i.length;c++){h=i[c];if(u.size<h.size){i.splice(c,0,u);break}if(c==i.length-1){i.push(u);break}}else i.push(t[l])}return n.concat(i)},e.prototype._nestingLoopYield=function(e,t,n){var i=this,r=e.next();if(r.done)return t&&t(),r.value;var o=r.value;r.done;o instanceof Promise?o.then((function(r){return i._nestingLoopYield(e,t,n)})).catch((function(e){n(e)})):this._nestingLoopYield(e,t,n)},e.prototype.parse=function(e){var t=this;return this.combineManager.combineModels().then((function(){return new Promise((function(n,i){var r=t.parseWorld(e);if(r?t._nestingLoopYield(r,(function(){n()}),(function(e){i(e)})):n(),e.camInfo&&t.isCamFitScene){var o=e.camInfo;t.parseCamInfo(o)}}))}))},e.prototype.parseCamInfo=function(e){var t=e.eye,n=e.target,i=t.split(" "),r=n.split(" "),o=[Number(i[0]),Number(i[1]),Number(i[2])];o[2]=-o[2];var a=[Number(r[0]),Number(r[1]),Number(r[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.parseWorld=function(e){var t=Wr.mark(x);if(e.outdoors&&this.parseOutdoors(e.outdoors),e.buildings){var n=e.buildings;for(var i in n){var r=n[i],o=new THREE.Vector3(0,0,0),a=i,s=void 0;r.id&&(s=r.id),r.name&&(a=r.name);var l=r.properties,u=null;if(l)for(var c in u={},l){var h=l[c];u[c]=h}if(r.position){var p=r.position;o.x=p[0],o.y=p[1],o.z=-p[2]}var d=new THREE.Object3D,f=this.app.objectManager.create({type:"Building",name:a,id:s,properties:u,parent:this.campus,node:d});if(f.app=this.app,f.node.position.x=o.x,f.node.position.y=o.y,f.node.position.z=o.z,r.facades){var m=r.facades;for(var g in m)this.createThing(m[g],f,null,"Facade")}if(r.facadegroups){var v=r.facadegroups;for(var y in v){var b=v[y];this.createGroup(b,f,"Facade")}}if(r.plans)this.parseFloorPlans(r.plans,f)}}var _=this;function x(e){var n,i,r,o,a,s,l,u,c;return Wr.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=_.loadSpeed,i=10,r=e.keys(),o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();case 3:if(!o){t.next=9;break}if(!(a>=r.length)){t.next=6;break}return t.abrupt("break",24);case 6:s=r[a++],t.next=13;break;case 9:if(!(a=r.next()).done){t.next=12;break}return t.abrupt("break",24);case 12:s=a.value;case 13:l=s,u=e.get(l),c=0;case 16:if(!(c<u.length)){t.next=22;break}return t.next=19,new Promise((function(e,t){var r=performance.now();u[c].build();var o=u[c].combineMesh;l.miscNode.add(o),performance.now()-r>n?setTimeout((function(){e()}),i):e()}));case 19:c++,t.next=16;break;case 22:t.next=3;break;case 24:case"end":return t.stop()}}),t,this)}if(this.isDelayLoadFloorPlan){var E=new Map,w=this.combineManager.processorMap.get(this.outdoors);w&&E.set(this.outdoors,w);var T=this.combineManager.processorMap.keys(),M=Array.isArray(T),S=0;for(T=M?T:T[Symbol.iterator]();;){var C;if(M){if(S>=T.length)break;C=T[S++]}else{if((S=T.next()).done)break;C=S.value}var A=C;A!=this.outdoors&&(A.isLoaded=!1)}return x(E)}return x(this.combineManager.processorMap)},e.prototype.parseOutdoors=function(e){var t=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:t}),this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.currentParentObject=this.outdoors),this.processFloorPlanData(e,this.outdoors)},e.prototype.processFloorPlanData=function(e,t){t.app=this.app;var n=new THREE.Vector3(0,0,0);if(e.position){var i=e.position;n.x=i[0],n.y=i[1],n.z=-i[2]}t.node.position.x=n.x,t.node.position.y=n.y,t.node.position.z=n.z,t.node.updateMatrixWorld(),t.node.updateMatrix(),this.parseStructure(e,t),e.placements&&(this.parseCombineProcessors(t,e.placements,[],[],[]),this.parseThings(e.placements,t,n)),e.videoprobes&&this.parseThings(e.videoprobes,t,n),e.groups&&this.parseGroups(e.groups,t,[],[],[],n),e.doororwindows&&this.parseDoorWins(e.doororwindows,t,n),e.rooms&&this.parseRooms(e.rooms,t),e.routes&&this.parseStructureThing(e.routes,t),e.pipelines&&this.parseStructureThing(e.pipelines,t),e.curvelines&&this.parseStructureThing(e.curvelines,t),e.arrowlines&&this.parseStructureThing(e.arrowlines,t),e.arrowdatalines&&this.parseStructureThing(e.arrowdatalines,t),e.leakwaterlines&&this.parseStructureThing(e.leakwaterlines,t)},e.prototype.parseRooms=function(e,t){for(var n=0;n<e.length;n++){var i=e[n],r=null;i.name&&(r=i.name),e.id&&e.id;var o=null,a=i.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=i.properties;if(l)for(var u in s={},l){var c=l[u];s[u]=c}var h=null,p=null,d=null;i.floor&&(a=i.floor.gltfid,this.nodes[a]&&(d=this.nodes[a])),i.ceiling&&(a=i.ceiling.gltfid,this.nodes[a]&&(h=this.nodes[a])),i.roof&&(a=i.roof.gltfid,this.nodes[a]&&(p=this.nodes[a]));var f=i.isShown;if(f){var m="false"!==(f=f.toLowerCase());o.visible=m}var g=null,v=null,y=null,b={};if(i.area&&(v=i.area,b.area=v),i.circumference&&(y=i.circumference,b.circumference=y),i.center){var _=i.center;(g=new THREE.Vector3).set(_[0],_[1],-_[2]),b.center=g}this.app.objectManager.create({type:"Room",name:r,node:o,ceilingNode:h,roofNode:p,floorNode:d,parent:t,properties:s,auxiliaryInfo:b})}},e.prototype.parseCombineProcessors=function(e,t,n,i,r){for(var o in t){var a=t[o];if(!a.name&&!a.properties){var s=this.app.modelResource.bundleIDArray[a.model].uri;s||(s=this.app.modelResource.bundleIDArray[a.model].id);var l=new THREE.Vector3(0,0,0);if(a.position){var u=a.position;l.x=u[0],l.y=u[1],l.z=-u[2]}var c=new THREE.Vector3(1,1,1);if(a.scale){var h=a.scale;c.x=h[0],c.y=h[1],c.z=h[2]}var p=new THREE.Quaternion(0,0,0,1);if(a.rotation){var d=a.rotation;p.x=d[0],p.y=d[1],p.z=-d[2],p.w=-d[3]}var f=n.slice(),m=i.slice(),g=r.slice();g.push(p),m.push(c),f.push(l),this.combineManager.addPlacement(e,s,f,m,g)}}},e.prototype.parseStructure=function(e,t){t.node.updateMatrixWorld();var n=t.node.position,i=new THREE.Vector3;t.parent&&!t.isOutdoors&&(i=t.parent.node.position);var r=new THREE.Vector3(i.x+n.x,i.y+n.y,i.z+n.z);if(e.structure){var o=(e=e.structure).walls;if(o){var a=new THREE.Group;for(var s in a.name="structurnWall",o){var l=o[s].gltfid,u=this.nodes[l];u.traverse((function(e){e.material&&(e.material.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("#include <aomap_fragment>",["#ifdef USE_AOMAP","float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 3.0;","#if defined( USE_ENVMAP ) && defined( PHYSICAL )","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );","#endif","#endif"].join("\n"))},e.material.needsUpdate=!0)})),u&&a.add(u)}t.node.add(a),a.position.set(-r.x,-r.y,-r.z),t.wallNode=a}var c=e.roofs;if(c){var h=new THREE.Group;for(var s in h.name="structurnRoof",c){l=c[s].gltfid;var p=this.nodes[l];p&&h.add(p)}t.node.add(h),h.position.set(-r.x,-r.y,-r.z),t.roofNode=h}var d=e.ceilings;if(d){var f=new THREE.Group;for(var s in f.name="structureCeiling",d){l=d[s].gltfid;var m=this.nodes[l];m&&f.add(m)}t.node.add(f),f.position.set(-r.x,-r.y,-r.z),t.ceilNode=f}if(v=e.floors){var g=new THREE.Group;for(var s in g.name="structureFloor",v){var v;if(l=(v=v[s]).gltfid){var y=this.nodes[l];y.traverse((function(e){e.material&&(e.material.roughness=.9,e.material.needsUpdate=!0)})),y&&g.add(y)}}t.node.add(g),g.position.set(-r.x,-r.y,-r.z),t.floorNode=g}var b=new THREE.Group;b.name="structurePlacement",t.miscNode=b,t.node.add(b),t.floorNode||(t.floorNode=b),b.updateMatrixWorld(),b.updateMatrix(),b.position.set(0,0,0);var _=e.placements;if(_)for(var s in _){l=_[s].gltfid;var x=this.nodes[l];x&&b.add(x)}e.routes&&this.parseStructureThing(e.routes,t),e.pipelines&&this.parseStructureThing(e.pipelines,t),e.curvelines&&this.parseStructureThing(e.curvelines,t),e.arrowlines&&this.parseStructureThing(e.arrowlines,t),e.arrowdatalines&&this.parseStructureThing(e.arrowdatalines,t),e.leakwaterlines&&this.parseStructureThing(e.leakwaterlines,t)}},e.prototype.parseDoorWins=function(e,t,n){new THREE.Group("doors");for(var i in e){var r=e[i],o=i;r.name&&(o=r.name);var a=null;if(r.gltfid){var s=r.gltfid;this.nodes[s]&&(a=this.nodes[s],t.node.add(a))}var l=null;if(r.properties){var u=r.properties;for(var c in l={},u){var h=u[c];l[c]=h}}this.app.objectManager.create({type:"Door",name:o,node:a,parent:t,properties:l})}},e.prototype.parseGroups=function(e,t,n,i,r,o){for(var a in e){var s=e[a];s.name||s.properties?this.createGroup(s,t):this.combineGroup(s,t,n,i,r,o)}},e.prototype.createGroup=function(e,t){var n,i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Thing",o=this.instanceGroup(e);e.id&&e.id,e.name&&(n=e.name);var a=e.properties;if(a)for(var s in i={},a){var l=a[s];i[s]=l}var u=this.app.objectManager.create({type:r,name:n,node:o,parent:t,properties:i});return u},e.prototype.parseFloorPlans=function(e,t){for(var n=[],i=0;i<e.length;i++){var r=e[i],o=r.id,a="";r.name&&(a=r.name);var s=new THREE.Object3D,l=this.app.objectManager.create({type:"Floor",name:a,id:o,node:s,parent:t});s.name="floorPlan",0!=t.facades.length&&(l.node.visible=!1),t.node.add(l.node),t.node.updateMatrixWorld(),t.node.updateMatrix(),this.processFloorPlanData(r,l),n.push(l)}return n},e.prototype.parseBundleList=function(e){this.app.modelResource.bundleIDArray=e;var t=0,n=this;return new Promise((function(i,r){0!==e.length?e.forEach((function(o){if(u=o.uri){var a=new thingjs.GLTFLoader;a.setCrossOrigin("anonymous"),a.load(n.baseURL+"/"+u,(function(r){t++;var o=null;-1!==r.asset.generator.indexOf("Unity")?(o=r.scene.children[0].children[0],n.app.modelResource.set(u,o,r.animations)):(o=r.scene.children[0],n.app.modelResource.set(u,o,r.animations)),n.addEnvMap(o),t===e.length&&i()}),(function(){}),(function(e){r("can not load "+n.baseURL+"/"+u)}))}else{var s=o.id,l=o.version,u="http://model.3dmomoda.cn/models/"+s+"/"+l+"/gltf/",c=new THREE.FileLoader;c.setResponseType("json"),c.load(u+"index.json",(function(o){var a=o.gltfFiles[0],l=new thingjs.GLTFLoader;l.setCrossOrigin("anonymous"),l.load(u+a,(function(r){t++,n.app.modelResource.set(s,r.scene.children[0],r.animations),t===e.length&&i()}),(function(){}),(function(e){r("can not load "+n.baseURL+"/"+u)}))}))}})):i()}))},e.prototype.combineGroup=function(e,t,n,i,r,o){var a=e,s=new THREE.Vector3(0,0,0);if(a.position){var l=a.position;s.x=l[0],s.y=l[1],s.z=-l[2]}var u=new THREE.Vector3(1,1,1);if(a.scale){var c=a.scale;u.x=c[0],u.y=c[1],u.z=c[2]}var h,p=new THREE.Quaternion(0,0,0,1);if(a.rotation){var c=a.rotation;p.x=c[0],p.y=c[1],p.z=-c[2],p.w=-c[3]}if(r?(h=n.slice(),c=i.slice(),l=r.slice()):(h=[],l=[],c=[]),h.push(u),l.push(s),c.push(p),a.placements&&this.parseCombineProcessors(t,a.placements,l,h,c),a.groups)for(var d in a.groups)this.combineGroup(a.groups[d],t,h,c,l,o)},e.prototype.instanceGroup=function(e){var t=new THREE.Vector3(0,0,0);if(e.position){var n=e.position;t.x=n[0],t.y=n[1],t.z=-n[2]}var i=new THREE.Vector3(1,1,1);if(e.scale){var r=e.scale;i.x=r[0],i.y=r[1],i.z=r[2]}var o=new THREE.Quaternion(0,0,0,1);if(e.rotation){r=e.rotation;o.x=r[0],o.y=r[1],o.z=-r[2],o.w=-r[3]}var a=new THREE.Group;if(e.placements)for(var s in e.placements){var l=this.instanceChildOfGroup(e.placements[s]);a.add(l)}if(e.groups)for(var s in e.groups){l=this.instanceGroup(e.groups[s]);a.add(l)}return a.scale.copy(i),a.setRotationFromQuaternion(o),a.position.copy(t),a},e.prototype.instanceChildOfGroup=function(e){var t=this.app.modelResource.bundleIDArray[e.model].uri;t||(t=this.app.modelResource.bundleIDArray[e.model].id);var n=this.app.modelResource.get(t).node.clone();if(e.scale){var i=e.scale;n.scale.x=i[0],n.scale.y=i[1],n.scale.z=i[2]}if(e.rotation){i=e.rotation;var r=new THREE.Quaternion;r.x=i[0],r.y=i[1],r.z=-i[2],r.w=-i[3],n.setRotationFromQuaternion(r)}if(e.position){i=e.position;n.position.x=i[0],n.position.y=i[1],n.position.z=-i[2]}return n},e.prototype.parseThings=function(e,t,n){for(var i in e){var r=e[i];(r.name||r.properties||r.type)&&this.createThing(r,t,n)}},e.prototype.createThing=function(e,t,n){var i,r,o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Thing";e.id&&(i=e.id);var s=e.type||a;e.name&&(r=e.name);var l=e.properties;if(l)for(var u in o={},l){var c=l[u];o[u]=c}var h=this.app.modelResource.bundleIDArray[e.model].uri;h||(h=this.app.modelResource.bundleIDArray[e.model].id);var p=this.app.modelResource.get(h).node,d=p.clone(),f=this.app.modelResource.get(h).animations;if(e.position){var m=e.position,g=new THREE.Vector3(m[0],m[1],-m[2]);d.position.x=g.x,d.position.y=g.y,d.position.z=g.z}if(e.rotation){var v=e.rotation,y=new THREE.Quaternion;y.x=v[0],y.y=v[1],y.z=-v[2],y.w=-v[3],d.setRotationFromQuaternion(y)}if(e.scale){var b=e.scale,_=new THREE.Vector3;_.x=b[0],_.y=b[1],_.z=b[2],d.scale.x=_.x,d.scale.y=_.y,d.scale.z=_.z}var x=e.isShown;if(x){var E="false"!==(x=x.toLowerCase());d.visible=E}var w=this.app.objectManager.create({type:s,id:i,name:r,node:d,parent:t,animations:f,properties:o});return w},e.prototype.parseStructureThing=function(e,t,n){for(var i in e){var r=e[i];if(r.gltfid){var o=new tn(this.app);o.name=i,o.app=this.app,r.id&&(o.id=r.id),r.name&&(o.name=r.name);var a=r.gltfid;if(this.nodes[a]){var s=this.nodes[a];t.node.add(s),o.node=s,t.add(o),n&&(s.position.x=n.x,s.position.y=n.y,s.position.z=n.z)}}}},e.prototype.delayLoadFloorPlan=function(e){var t=Wr.mark(i),n=this;function i(i){var r,o,a;return Wr.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=n.loadSpeed,o=10,a=0;case 3:if(!(a<i.length)){t.next=9;break}return t.next=6,new Promise((function(t,n){var s=performance.now();i[a].build();var l=i[a].combineMesh;e.miscNode.add(l),performance.now()-s>r?setTimeout((function(){t()}),o):t()}));case 6:a++,t.next=3;break;case 9:case"end":return t.stop()}}),t,this)}var r=null,o=null;return e.isLoaded||(r=this.combineManager.processorMap.get(e),o=i(r)),new Promise((function(t,i){o?n._nestingLoopYield(o,(function(){e.isLoaded=!0,t()}),(function(e){i(e)})):e.isLoaded?console.warn("floorplan "+e.id+" has been loaded!"):i()}))},e}(),eo=function(e){function t(n,i){return r(this,t),s(this,e.call(this,n,i))}return a(t,e),t.prototype.parseDoorWins=function(e,t,n){new THREE.Group("doors");for(var i in e){var r=e[i];r.type||(r.type="Door"),this.createThing(r,t,n)}},t}($r),to=function(){function e(t){r(this,e),this.app=t,this.nodes=[],this.scene=this.app.scene,this.objectPool=this.app.objectPool,this.rootNode=null,this.campus=null,this.sceneURL=null,this.sceneJsonData=null,this.loadedSceneGLTF=null,this.worldNode=new THREE.Object3D,this.fitCamInfo=null}return e.prototype.parse=function(e){for(var t in e)if("objects"==t){var n=e.objects;for(var i in n){var r=n[i];this.parseWorld(r);break}}else if("camInfo"==t){var o=e[t];this.fitCamInfo=o}else console.log("unkown other parser: "+t)},e.prototype.parseCamInfo=function(e){var t=e.eye,n=e.target,i=t.split(" "),r=n.split(" "),o=[Number(i[0]),Number(i[1]),Number(i[2])];o[2]=-o[2];var a=[Number(r[0]),Number(r[1]),Number(r[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.parseWorld=function(e){var t=this.worldNode;if(null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:t}),this.campus.node.name="campus",this.app.scene.add(this.campus.node)),e.plan&&this.parseOutdoors(e.plan),e.bds){var n=e.bds;this.parseBuildings(n)}},e.prototype.parseOutdoors=function(e){var t=null;for(var n in e){t=e[n];break}var i=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:i});var r=this.outdoors,o=t.gltfid;if(o&&this.nodes[o]){var a=this.nodes[o];THREE.SceneUtils.detach(a,a.parent,this.app.scene),THREE.SceneUtils.attach(a,this.app.scene,r.node),r.node.updateMatrixWorld()}this.parseFloorPlan(t,r)},e.prototype.parseBuildings=function(e){for(var t in e){var n=e[t],i=null;if(n.gltfid){var r=n.gltfid;this.nodes[r]&&(i=this.nodes[r])}var o=this.app.objectManager.create({type:"Building",name:t,parent:this.campus,node:i});n.plans&&this.parseFloorPlans(n.plans,o),n.facades&&this.parseFacades(n.facades,o)}},e.prototype.parseFloorPlans=function(e,t){for(var n in e){var i=null,r=e[n],o=r.gltfid;o&&this.nodes[o]&&(i=this.nodes[o]);var a=this.app.objectManager.create({type:"Floor",name:n,node:i,parent:t});this.parseFloorPlan(r,a)}},e.prototype.parseFloorPlan=function(e,t){e.plcs&&this.parseThings(e.plcs,t),e.vps&&this.parseThings(e.vps,t),e.dws&&this.parseDoorWins(e.dws,t),e.routes&&this.parseThings(e.routes,t),e.pipelines&&this.parseThings(e.pipelines,t),e.curvelines&&this.parseThings(e.curvelines,t),e.arrowlines&&this.parseThings(e.arrowlines,t),e.arrowdatalines&&this.parseThings(e.arrowdatalines,t),e.leakwaterlines&&this.parseThings(e.leakwaterlines,t);var n=e.cplcs;if(n)for(var i in n){var r=n[i].gltfid,o=this.nodes[r];if(o){t.miscNode=o.parent;break}}var a=e.cwalls;if(a)for(var i in a){r=a[i].gltfid;var s=this.nodes[r];if(s){t.wallNode=s.parent;break}}var l=e.croofs;if(l)for(var i in l){r=l[i].gltfid;var u=this.nodes[r];if(u){t.roofNode=u.parent;break}}var c=e.cceilings;if(c)for(var i in c){r=c[i].gltfid;var h=this.nodes[r];if(h){t.ceilingNode=h.parent;break}}if(p=e.cfloors)for(var i in p){var p;if(r=(p=p[i]).gltfid){var d=this.nodes[r];if(d){t.floorNode=d.parent;break}}}var f=e.groups;f&&this.parseGroup(f,t)},e.prototype.parseGroup=function(e,t){for(var n in e){var i=e[n],r=n;i.uid&&(r=i.uid);var o=i.type||"Thing",a=null,s=i.gltfid;s&&this.nodes[s]&&(a=this.nodes[s]);var l=null,u=i.prop;if(u)for(var c in l={},u){var h=u[c];l[c]=h}this.app.objectManager.create({type:o,name:r,node:a,parent:t,properties:l}),i.plcs&&this.parseThings(i.plcs,t)}},e.prototype.parseFacades=function(e,t){for(var n in e){var i=e[n],r=n;i.uid&&(r=i.uid);var o=null,a=i.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=i.prop;if(l)for(var u in s={},l){var c=l[u];s[u]=c}var h=i.isShown;if(h){var p="false"!==(h=h.toLowerCase());o.visible=p}this.app.objectManager.create({type:"Facade",name:r,node:o,parent:t,properties:s});t.node.add(o)}},e.prototype.parseThings=function(e,t){for(var n in e){var i=e[n],r=n;i.uid&&(r=i.uid);var o=null,a=i.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=i.prop;if(l)for(var u in s={},l){var c=l[u];s[u]=c}var h=i.isShown;if(h){var p="false"!==(h=h.toLowerCase());o.visible=p}this.app.objectManager.create({type:"Thing",name:r,node:o,parent:t,properties:s})}},e.prototype.parseDoorWins=function(e,t){for(var n in e){var i=e[n],r=n;i.uid&&(r=i.uid);var o=null;if(i.gltfid){var a=i.gltfid;this.nodes[a]&&(o=this.nodes[a])}var s=null;if(i.prop){var l=i.prop;for(var u in s={},l){var c=l[u];s[u]=c}}this.app.objectManager.create({type:"Door",name:r,node:o,parent:t,properties:s})}},e.prototype.load=function(e){var t=this;if("String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var n=e;this.sceneURL=n.url,n.campus&&(this.campus=n.campus,this.worldNode=this.campus.node)}return new Promise((function(e,n){t.loadGLTF().then((function(e){return t.loadedSceneGLTF=e,e.scene.traverse((function(e){t.nodes[e.name]=e})),t.parseSceneJson()})).then((function(n){t.fitCamInfo?t.parseCamInfo(t.fitCamInfo):t.campus.node&&t.app.camera.fit(t.campus),e(t.campus)})).catch((function(){t.campus.node.add(t.loadedSceneGLTF.scene.children[0]),t.campus&&t.app.camera.fit(t.campus),e(t.campus)}))}))},e.prototype.loadGLTF=function(){var e=this;return new Promise((function(t,n){var i=new THREE.GLTFLoader(e.app.loadingManager);i.setCrossOrigin("anonymous"),i.load(e.sceneURL+"/Unity2GLTF.gltf",(function(e){t(e)}))}))},e.prototype.parseSceneJson=function(){var e=this;return new Promise((function(t,n){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL+"/scene.json",(function(n){var i=JSON.parse(n);for(var r in e.sceneJsonData=i,i)if("objects"==r){var o=i.objects;for(var a in o){var s=o[a];e.parseWorld(s);break}}else if("camInfo"==r){var l=i[r];e.fitCamInfo=l}else console.log("unkown other parser: "+r);t(i)}),(function(){}),(function(){console.error("not find file scene.json "),n()}))}))},e}(),no=function(){function e(){r(this,e),this.world=null,this.styleTable={outdoors:{},buildings:{}}}return e.prototype.clear=function(){this.world=null,this.styleTable={outdoors:{},buildings:{}}},e.prototype.parseWorld=function(e){this._parseObject(e)},e.prototype._parseObject=function(e){if(e.registerBuildCallbackListener(this.objectBuildedCallback,{loader:this}),e.isContainer)for(var t=0;t<e.children.length;t++){var n=e.children[t];this._parseObject(n)}},e.prototype.objectBuildedCallback=function(e,t){var n=t.loader;"Facade"===e.type||"FacadeGroup"===e.type?n.facadeBuildCallback(e,t):"Placement"===e.type||"PlacementGround"===e.type?n.placementBuildCallback(e,t):"DoorOrWindow"===e.type?n.doorOrWindowBuildCallback(e,t):"VideoProbe"===e.type?n.videoProbeBuildCallback(e,t):"Room"===e.type?n.roomBuildCallback(e,t):"PlacementGroup"===e.type?n.groupBuildCallback(e,t):-1!==e.type.indexOf("Combine")&&n.combinedObjectBuildCallback(e,t)},e.prototype.parseBuilding=function(e){this.parseFacades(e);for(var t=e.floorplans,n=0;n<t.length;n++){var i=t[n];this.parseFloorPlan(i)}},e.prototype.parseFacades=function(e){for(var t=e.facades,n=e.facadeGroups,i=0;i<t.length;i++){t[i].registerBuildCallbackListener(this.facadeBuildCallback,{loader:this})}for(var r=0;r<n.length;r++){n[r].registerBuildCallbackListener(this.facadeBuildCallback,{loader:this})}},e.prototype.facadeBuildCallback=function(e,t){var n=t.loader,i=void 0,r=e.properties;r&&(i=r._styleTag_);var o=n.getMeshes(e.mesh);o&&o.length>0&&o.forEach((function(e){e._sfStyle=i||"Facade"}))},e.prototype.parseFloorPlan=function(e){this.parseDoorOrWindows(e),this.parseCombineFloors(e),this.parseCombineCeilings(e),this.parseCombineRoofs(e),this.parseCombinePlacements(e),this.parseCombineStraightManualWalls(e),this.parseCombineModelWalls(e),this.parseCombineDoorOrWindows(e),this.parseGroups(e),this.parsePlacements(e),this.parseRooms(e),this.parseVideoProbes(e),this.parsePlacementGround(e),this.parseCombinePlacementWalls(e)},e.prototype.parsePlacementGround=function(e){for(var t=0;t<e.placementGrounds.length;t++){e.placementGrounds[t].registerBuildCallbackListener(this.placementBuildCallback,{loader:this})}},e.prototype.parseCombineFloors=function(e){for(var t=0;t<e.combineFloorObjects.length;t++){var n=e.combineFloorObjects[t];this.registerCombineObjectBuildCallback(n,"CombineFloor")}},e.prototype.parseCombineCeilings=function(e){for(var t=0;t<e.combineCeilingObjects.length;t++){var n=e.combineCeilingObjects[t];this.registerCombineObjectBuildCallback(n,"CombineCeiling")}},e.prototype.parseCombineRoofs=function(e){for(var t=0;t<e.combineRoofObjects.length;t++){var n=e.combineRoofObjects[t];this.registerCombineObjectBuildCallback(n,"CombineRoof")}},e.prototype.parseCombinePlacements=function(e){for(var t=0;t<e.combinePlacementObjects.length;t++){var n=e.combinePlacementObjects[t];this.registerCombineObjectBuildCallback(n,"CombinePlacement")}},e.prototype.parseCombineStraightManualWalls=function(e){for(var t=0;t<e.combineStraightManualWallObjects.length;t++){var n=e.combineStraightManualWallObjects[t];this.registerCombineObjectBuildCallback(n,"CombineStraightManualWall")}},e.prototype.parseCombineModelWalls=function(e){for(var t=0;t<e.combineModelWallObjects.length;t++){var n=e.combineModelWallObjects[t];this.registerCombineObjectBuildCallback(n,"CombineModelWall")}},e.prototype.parseCombinePlacementWalls=function(e){for(var t=0;t<e.combinePlacementWallObjects.length;t++){var n=e.combinePlacementWallObjects[t];this.registerCombineObjectBuildCallback(n,"CombinePlacementWall")}},e.prototype.parseCombineDoorOrWindows=function(e){for(var t=0;t<e.combineDoorOrWindowObjects.length;t++){var n=e.combineDoorOrWindowObjects[t];this.registerCombineObjectBuildCallback(n,"CombineDoorOrWindow")}},e.prototype.parsePlacements=function(e){for(var t=0;t<e.placements.length;t++){e.placements[t].registerBuildCallbackListener(this.placementBuildCallback,{loader:this})}},e.prototype.placementBuildCallback=function(e,t){var n=t.loader;n.addSfStyle(e,n.isTree(e.resource.modelID)?"Thing-树":"Thing")},e.prototype.parseDoorOrWindows=function(e){for(var t=0;t<e.doorOrWindows.length;t++){e.doorOrWindows[t].registerBuildCallbackListener(this.doorOrWindowBuildCallback,{loader:this})}},e.prototype.doorOrWindowBuildCallback=function(e,t){var n=t.loader;e.isWindow?n.addSfStyle(e,"Thing"):n.addSfStyle(e,e.parent instanceof json2mesh.Outdoors?"Door-outdoor":"Door")},e.prototype.parseGroups=function(e){for(var t=0;t<e.groups.length;t++){e.groups[t].registerBuildCallbackListener(this.groupBuildCallback,{loader:this})}},e.prototype.groupBuildCallback=function(e,t){t.loader.groupAddSfStyle(e)},e.prototype.parseRooms=function(e){for(var t=0;t<e.rooms.length;t++){e.rooms[t].registerBuildCallbackListener(this.roomBuildCallback,{loader:this})}},e.prototype.roomBuildCallback=function(e,t){var n=t.loader;"Outdoors"===e.parent.type?n.addSfStyle(e.floor,"Region"):(n.addSfStyle(e.ceiling,"Floor--ceiling"),n.addSfStyle(e.roof,"Floor--roof"),n.addSfStyle(e.floor,"Floor--floor"))},e.prototype.parseVideoProbes=function(e){for(var t=0;t<e.videoprobes.length;t++){e.videoprobes[t].registerBuildCallbackListener(this.videoProbeBuildCallback,{loader:this})}},e.prototype.videoProbeBuildCallback=function(e,t){t.loader.addSfStyle(e,"Thing")},e.prototype.registerCombineObjectBuildCallback=function(e,t){e.registerBuildCallbackListener(this.combinedObjectBuildCallback,{loader:this,typeName:t})},e.prototype.combinedObjectBuildCallback=function(e,t){var n=e,i=e.type,r=t.loader;if("CombineFloor"===i)r.addSfStyle(n,e.parent instanceof json2mesh.Outdoors?"Region":"Floor--floor");else if("CombineCeiling"===i)r.addSfStyle(n,"Floor--ceiling");else if("CombineRoof"===i)r.addSfStyle(n,"Floor--roof");else if("CombinePlacement"===i){var o=e.resource.modelID;r.addSfStyle(n,r.isTree(o)?"Thing-树":"Thing")}else"CombineStraightManualWall"===i||"CombineModelWall"===i?r.addSfStyle(n,e.parent instanceof json2mesh.Outdoors?"Fence":"Floor--manualWall"):"CombineDoorOrWindow"===i?r.addSfStyle(n,e.parent instanceof json2mesh.Outdoors?"Door-outdoor":"Door"):"CombinePlacementWall"===i&&r.addSfStyle(n,e.parent instanceof json2mesh.Outdoors?"Fence":"Floor--manualWall")},e.prototype.addSfStyle=function(e,t){if(e){var n=e.properties;if(n&&n._styleTag_&&(t=n._styleTag_),t){var i=this.getMeshes(e.mesh);i&&i.length>0&&i.forEach((function(e){e._sfStyle=t}))}}},e.prototype.getMeshes=function(e){var t=[];return e.traverse((function(e){e.isMesh&&t.push(e)})),t},e.prototype.groupAddSfStyle=function(e){var t=e.placements;if(t)for(var n=0;n<t.length;n++){var i=t[n];this.addSfStyle(i,this.isTree(i.resource.modelID)?"Thing-树":"Thing")}var r=e.groups;if(r)for(var o=0;o<r.length;o++){var a=r[o];this.groupAddSfStyle(a)}},e.prototype.isTree=function(e){return!!io[e]},e.isTree_static=function(e){return!!io[e]},e}(),io={"3629A959F80C4D0EA31D1E26524735B8":{title:"柳树",id:"3629A959F80C4D0EA31D1E26524735B8",type:"Placement",size:[8.1,9.60776,8.7],version:"7"},BB23ED379CFB4A0AB14BD124EC2995BE:{title:"植物E",id:"BB23ED379CFB4A0AB14BD124EC2995BE",type:"Placement",size:[.64347,1.34912,.8],version:"7"},A7D96546FA744C38A949DFC6FEE43B6A:{title:"植物D",id:"A7D96546FA744C38A949DFC6FEE43B6A",type:"Placement",size:[.6,1.1,.6],version:"7"},FA5766D2AA074128ABB5D4CA3FF45B36:{title:"植物C",id:"FA5766D2AA074128ABB5D4CA3FF45B36",type:"Placement",size:[.4,.61599,.39999],version:"6"},"8EC4FF7178E64C538B215D69684E4F92":{title:"植物A",id:"8EC4FF7178E64C538B215D69684E4F92",type:"Placement",size:[.4,.5,.4],version:"6"},"449c02c5e8f84a2aa32f58ed53aa24b9":{title:"花花草草",id:"449c02c5e8f84a2aa32f58ed53aa24b9",type:"Placement",size:[.23118,.5986,.24155],version:"1"},c26acc8a9f804d8da2f49aba46283ac3:{title:"清风拂动的大树",id:"c26acc8a9f804d8da2f49aba46283ac3",type:"Placement",size:[7.85544,7.80654,7.44832],version:"2"},"07b2d180e1ea42de98723fe147f6750a":{title:"树_02",id:"07b2d180e1ea42de98723fe147f6750a",type:"Placement",size:[10.3207,9.84333,10.0598],version:"3"},"2c969242db5f4da58442182ccbda7471":{title:"树木_03",id:"2c969242db5f4da58442182ccbda7471",type:"Placement",size:[7.20139,25.1363,6.56474],version:"4"},D26DB25C34C94CAABF24FED40F1A9719:{title:"雪松",id:"D26DB25C34C94CAABF24FED40F1A9719",type:"Placement",size:[8.24071,19.2,7.6],version:"6"},"ebafecf0-cc89-42dc-b847-0f841a31bdca":{title:"棕榈树",id:"ebafecf0-cc89-42dc-b847-0f841a31bdca",type:"Placement",size:[4.94077,5.83847,4.78861],version:"9"},"4EF86FC4FFA44013AC4F45E8CD0D343F":{title:"枫树",id:"4EF86FC4FFA44013AC4F45E8CD0D343F",type:"Placement",size:[5.66699,7.4,6.233],version:"6"},"9C27FD900C4443FBA1151C9DF767D19A":{title:"樱花树",id:"9C27FD900C4443FBA1151C9DF767D19A",type:"Placement",size:[7.50716,8.2,7.87936],version:"6"},"6b768c2d-3c2f-4954-a625-ef4b57f72a47":{title:"秋季树",id:"6b768c2d-3c2f-4954-a625-ef4b57f72a47",type:"Placement",size:[6.32989,7.49752,5.72546],version:"8"},"9fc66d5b-a213-4fc6-9fc6-f759aa88716a":{title:"wxz松树03",id:"9fc66d5b-a213-4fc6-9fc6-f759aa88716a",type:"Placement",size:[4.5,9.4,4.4],version:"4"},"963de658-70b6-49e7-bb0e-504ad603fe27":{title:"wxz竹子01",id:"963de658-70b6-49e7-bb0e-504ad603fe27",type:"Placement",size:[1.4073,4.03187,1.37224],version:"5"},"d5b06cf7-2a31-4252-8d7c-02d48815ed18":{title:"乔树02",id:"d5b06cf7-2a31-4252-8d7c-02d48815ed18",type:"Placement",size:[7.3,7.4,6.1],version:"4"},"f9058709-ee84-41f6-8260-fbb734dc9483":{title:"棕榈树01",id:"f9058709-ee84-41f6-8260-fbb734dc9483",type:"Placement",size:[4.3,7.2,4],version:"4"},"be7d0bfc-ce60-4132-8a88-afd1301c82b3":{title:"圣诞树01",id:"be7d0bfc-ce60-4132-8a88-afd1301c82b3",type:"Placement",size:[4.41539,7.57112,4.49063],version:"5"},"95bd04fe237f42e0adeabb78028c8ee7":{title:"超级圣诞树",id:"95bd04fe237f42e0adeabb78028c8ee7",type:"Placement",size:[4.41539,7.57112,4.49063],version:"1"}},ro=function(){function e(t){r(this,e),t.config&&(this.config=t.config),this.events=[],t.events&&(this.events=t.events),this.app=t.app,this.creators=[]}return e.prototype.clear=function(){for(var e=0;e<this.creators.length;e++){this.creators[e].clear()}this.events=[],this.app=null,this.creators=[],this.config=[]},e.prototype.setConfig=function(e){this.config=e},e.prototype.createTjsObject=function(e,t){var n=new(this.config.getClass(e.type))({json2meshObject:e,app:this.app,thingjsParent:t,events:this.events,config:this.config});return this.creators.push(n),n.create()},e.prototype.createTjsFacadeObject=function(e,t){var n=new(this.config.getClass("Facade"))({json2meshObject:e,json2meshBuilding:e,app:this.app,thingjsParent:t,events:this.events,config:this.config});return this.creators.push(n),n.create()},e}(),oo=function(){function e(t){r(this,e),this.json2meshObject=t.json2meshObject,this.app=t.app,this.thingjsParent=t.thingjsParent,this.createType=null,this.thingjsObject=null,this.config=t.config,this._createdCallbacks=[],this._createdCallbackParams=[],this._buildedCallbacks=[],this._buildedCallbackParams=[],t.events&&this.initEvents(t.events)}return e.prototype.clear=function(){this.json2meshObject=null,this.app=null,this.thingjsParent=null,this.createType=null,this.thingjsObject=null,this.config=null,this._createdCallbacks=[],this._createdCallbackParams=[],this._buildedCallbacks=[],this._buildedCallbackParams=[]},e.prototype.initEvents=function(e){for(var t=0;t<e.length;t++){e[t].init(this)}},e.prototype.create=function(){var e=this._getCreateParams();return this.thingjsObject=this.config.getCreatedThingjsObject(this.json2meshObject.id),this.thingjsObject?this._initCreatedThingjsObjectParams(e):this.thingjsObject=this.app.objectManager.create(e),this.thingjsObject.localPosition=this._getThingjsLocalPosition(),this.thingjsObject.scale=this.json2meshObject.scale,this.thingjsObject.node.quaternion.set(this.json2meshObject.rotation[0],this.json2meshObject.rotation[1],this.json2meshObject.rotation[2],this.json2meshObject.rotation[3]),this.json2meshObject.registerBuildCallbackListener(this._callback,{creator:this,uuid:this.thingjsObject.uuid}),this.json2meshObject.camInfo&&(this.thingjsObject.userData.camInfo=this.json2meshObject.camInfo),this._notifyCreatedCompleteListeners(),this._registerChangeTypeEvent(),this.thingjsObject},e.prototype._registerChangeTypeEvent=function(){var e=this;this.thingjsObject.one("classtypechange",(function(t){e._changeTypeCallback(t)}))},e.prototype._changeTypeCallback=function(e){this.thingjsObject=e.newObject},e.prototype._getThingjsLocalPosition=function(){return this.json2meshObject.position},e.prototype._initCreatedThingjsObjectParams=function(e){this.thingjsObject.uuid=e.uuid,this.thingjsObject.id=e.id,this.thingjsObject.name=e.name},e.prototype.registerCreatedCallbackListener=function(e,t){this._createdCallbacks.push(e),this._createdCallbackParams.push(t)},e.prototype._notifyCreatedCompleteListeners=function(){for(var e=0;e<this._createdCallbacks.length;e++){(0,this._createdCallbacks[e])(this,this._createdCallbackParams[e])}},e.prototype.registerBuildedCallbackListener=function(e,t){this._buildedCallbacks.push(e),this._buildedCallbackParams.push(t)},e.prototype._notifyBuildedCompleteListeners=function(){for(var e=0;e<this._buildedCallbacks.length;e++){(0,this._buildedCallbacks[e])(this,this._buildedCallbackParams[e])}},e.prototype._getCreateParams=function(){var e={};e.uuid=this.json2meshObject.id,null!==this.json2meshObject.userID&&(e.id=this.json2meshObject.userID),null!==this.json2meshObject.name&&(e.name=this.json2meshObject.name),null!==this.json2meshObject.properties&&(e.properties=this.json2meshObject.properties),null!==this.thingjsParent&&void 0!==this.thingjsParent&&(e.parent=this._getParent(this.thingjsParent,this.createType));var t=this.createType;return this.json2meshObject.jsonData&&this.json2meshObject.jsonData.type&&(t=this.json2meshObject.jsonData.type),e.type=t,e.loaded=!1,e.node=new THREE.Object3D,e.node.name=t,e},e.prototype._callback=function(e,t){var n=t.creator;n._processCallback();var i=n.thingjsObject;n._notifyBuildedCompleteListeners(),i.setupResources({loaded:!0}),t.thingjsObject=i},e.prototype._processCallback=function(){var e=this.json2meshObject,t=this.thingjsObject;e.mesh&&(e.mesh.position.set(0,0,0),e.mesh.quaternion.set(0,0,0,1),e.mesh.scale.set(1,1,1),t.node.add(e.mesh))},e.prototype._getParent=function(e,t){return null==t&&(t="Thing"),"Ground"===e.type?"CombinedObject"===t||"BatchObject"===t?e:e.parent:e},e.prototype._isNullOrUndefined=function(e){return null==e},e}(),ao=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.createType="Campus",i}return a(t,e),t.prototype.create=function(){var e=this._getCreateParams();return this.thingjsObject=this.config.getCreatedThingjsObject(this.json2meshObject.id),this.thingjsObject?this._initCreatedThingjsObjectParams(e):this.thingjsObject=this.app.objectManager.create(e),this.json2meshObject.registerBuildCallbackListener(this._callback,{creator:this,uuid:this.thingjsObject.uuid}),this.json2meshObject.camInfo&&(this.thingjsObject.userData.camInfo=this.json2meshObject.camInfo),this._notifyCreatedCompleteListeners(),this._registerChangeTypeEvent(),this.config.campus=this.thingjsObject,this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.loaded=!0,t},t.prototype._initCreatedThingjsObjectParams=function(e){this.thingjsObject.uuid=this.json2meshObject.id,this.json2meshObject.userID&&(this.thingjsObject.id=this.json2meshObject.userID)},t}(oo),so=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.createType="Building",i}return a(t,e),t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.loaded=!0,t.structShow=this.json2meshObject.structShow,t},t.prototype.create=function(){return e.prototype.create.call(this),this.thingjsObject},t}(oo),lo=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.createType="Floor",i}return a(t,e),t.prototype.create=function(){return e.prototype.create.call(this),this._createCombineObjectParent("CombineWallParent"),this._createCombineObjectParent("CombineMiscParent"),this._createCombineObjectParent("CombineRoofParent"),this._createCombineObjectParent("CombineCeilingParent"),this._createCombineObjectParent("CombineFloorParent"),this.thingjsObject},t.prototype._hidePlanObjs=function(e){if(!e.showObjectsInParentLevels){for(var t=e.query(".CombinedObject",!1),n=0;n<t.length;n++){var i=t[n];if("CombineMiscParent"===i.userData.type)for(var r=i.query(".CombinedObject",!1),o=0;o<r.length;o++){var a=r[o];"CombinePlacement"===a.userData.json2meshType&&(a.visible=!1)}}for(var s=0;s<e.children.length;s++){var l=e.children[s];l.isDoor||"Room"===l.type||("Thing"===l.type&&l.isWindow||(l.visible=!1))}}},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.height=this.json2meshObject.height,t.alwaysShowInsideObjs=this.json2meshObject.alwaysShowInsideObjs,t.initBoxSize=this.json2meshObject.size,t},t.prototype._createCombineObjectParent=function(e){var t=this.app.objectManager.create({node:new THREE.Object3D,loaded:!0,parent:this._getParent(this.thingjsObject,"CombinedObject"),type:"CombinedObject"});t.userData.type=e,t.userData.isCombineParent=!0},t.prototype._callback=function(e,t){for(var n=t.creator,i=n.thingjsObject,r=i.query(".CombinedObject",!1),o=0;o<r.length;o++){var a=r[o];a.loaded||a.setupResources({})}i.loaded||i.setupResources({}),n._notifyBuildedCompleteListeners()},t}(oo),uo=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.json2meshObject.jsonData&&i.json2meshObject.jsonData.type?i.createType=i.json2meshObject.jsonData.type:i.createType="Thing",i}return a(t,e),t.prototype.create=function(){var t=e.prototype.create.call(this);return t.bundleID=this.json2meshObject.resource.modelID,t.bundleName=this.json2meshObject.resource.modelName,this._setVisible(),this.thingjsObject},t.prototype._setVisible=function(){var e=this.thingjsObject;"Floor"!==e.parent.type||e.parent.showObjectsInParentLevels||(e.visible=!1)},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.belongRoomUserID=this.json2meshObject.belongRoomUserID,t.hideByScene=!this.json2meshObject.visible,t.initBoxSize=this.json2meshObject.size,t.url=this.json2meshObject.resource.getModelUrl(),t},t.prototype._callback=function(t,n){e.prototype._callback.call(this,t,n);var i=n.thingjsObject;if(i._hideByScene=!t.visible,i.setupTextureAnimations(),i.setupAnimations({animations:t.resource.animations}),t.isPlayAnim&&i.containAnimation(t.animClip)){var r={name:t.animClip,loop:!1,speed:1};t.hasSkin&&(r.loop=!0),i.playAnimation(r)}},t}(oo),co=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.createType="Ground",i}return a(t,e),t.prototype.create=function(){return e.prototype.create.call(this),this.thingjsObject.name=this.json2meshObject.id,this._createCombineObjectParent("CombineWallParent"),this._createCombineObjectParent("CombineMiscParent"),this._createCombineObjectParent("CombineFloorParent"),this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.height=this.json2meshObject.height,t.alwaysShowInsideObjs=this.json2meshObject.alwaysShowInsideObjs,t.loaded=!0,t},t.prototype._createCombineObjectParent=function(e){var t=this.app.objectManager.create({node:new THREE.Object3D,loaded:!0,parent:this._getParent(this.thingjsObject,"CombinedObject"),type:"CombinedObject"});t.userData.type=e,t.userData.isCombineParent=!0},t.prototype._callback=function(t,n){e.prototype._callback.call(this,t,n);var i=n.creator,r=n.thingjsObject;r.wall.setupResources({}),i._setupResourcesToChildren(r.wall),r.plan.setupResources({}),i._setupResourcesToChildren(r.plan),r.misc.setupResources({}),i._setupResourcesToChildren(r.misc)},t.prototype._setupResourcesToChildren=function(e){for(var t=0;t<e.children.length;t++){e.children[t].setupResources({})}},t}(oo),ho=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.createType="CombinedObject",i}return a(t,e),t.prototype.create=function(){return e.prototype.create.call(this).userData.json2meshType=this.json2meshObject.type,this.thingjsObject},t.prototype._callback=function(t,n){e.prototype._callback.call(this,t,n),n.creator._checkCombineParentObjectLoaded()},t.prototype._checkCombineParentObjectLoaded=function(){for(var e=this.thingjsParent,t=0;t<e.children.length;t++){var n=e.children[t];if("CombineMiscParent"!==n.userData.type&&!n.loaded)return}e.setupResources({}),this._checkParentOfCombineParentObjectsLoaded(e.parent)},t.prototype._checkParentOfCombineParentObjectsLoaded=function(e){for(var t=e.query(".CombinedObject",!1),n=0;n<t.length;n++){var i=t[n];if("CombineMiscParent"!==i.userData.type&&!i.loaded)return}e.setupResources({})},t}(oo),po=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.thingjsParent=i.thingjsParent.wall,i.thingjsParent.loaded=!1,i}return a(t,e),t}(ho),fo=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.thingjsParent=i.thingjsParent.ceiling,i.thingjsParent.loaded=!1,i}return a(t,e),t}(ho),mo=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.thingjsParent=i.thingjsParent.misc,i.thingjsParent.loaded=!1,i}return a(t,e),t.prototype.create=function(){return e.prototype.create.call(this).node.isDoorOrWin=!0,this.thingjsObject},t}(ho),go=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.thingjsParent=i.thingjsParent.plan,i.thingjsParent.loaded=!1,i}return a(t,e),t}(ho),vo=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.thingjsParent=i.thingjsParent.wall,i.thingjsParent.loaded=!1,i}return a(t,e),t}(ho),yo=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.thingjsParent=i.thingjsParent.misc,i.thingjsParent.loaded=!1,i}return a(t,e),t}(ho),bo=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.thingjsParent=i.thingjsParent.roof,i.thingjsParent.loaded=!1,i}return a(t,e),t}(ho),_o=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.createType="Room",i}return a(t,e),t.prototype.create=function(){e.prototype.create.call(this);return this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return this.json2meshObject.floor&&(t.floorHideByScene=!this.json2meshObject.floor.visible),this.json2meshObject.ceiling&&(t.ceilingHideByScene=!this.json2meshObject.ceiling.visible),this.json2meshObject.roof&&(t.roofHideByScene=!this.json2meshObject.roof.visible),t.holes=this._getRoomHoles(),t.points=this._getRoomPoints(),t},t.prototype._getRoomPoints=function(){for(var e=[],t=0;t<this.json2meshObject.points.length;t++){var n=this.json2meshObject.points[t];e.push(new THREE.Vector3(n[0],n[1],n[2]))}return e},t.prototype._getRoomHoles=function(){for(var e=[],t=0;t<this.json2meshObject.holes.length;t++){for(var n=this.json2meshObject.holes[t],i=[],r=0;r<n.length;r++){var o=n[r];i.push(new THREE.Vector3(o[0],o[1],o[2]))}e.push(i)}return e},t.prototype._processCallback=function(){var e=this.thingjsObject,t=this.json2meshObject;t.floor&&t.floor.visible&&(e._floorNode=t.floor.mesh,e.node.add(t.floor.mesh)),t.ceiling&&t.ceiling.visible&&(e._ceilingNode=t.ceiling.mesh,e.node.add(t.ceiling.mesh)),t.roof&&t.roof.visible&&(e.node.add(t.roof.mesh),e._roofNode=t.roof.mesh),e.setRelativePoints(t.points)},t}(oo),xo=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t}(uo),Eo=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.json2meshObject.jsonData&&i.json2meshObject.jsonData.type?i.createType=i.json2meshObject.jsonData.type:i.createType="Thing",i.json2meshObject.enableCreateMesh=!1,i}return a(t,e),t.prototype.create=function(){var t=e.prototype.create.call(this);return"Floor"!==t.parent.type||t.parent.showObjectsInParentLevels||(t.visible=!1),this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.belongRoomUserID=this.json2meshObject.belongRoomUserID,t.hideByScene=!this.json2meshObject.visible,t.initBoxSize=this.json2meshObject.size,t},t.prototype._callback=function(e,t){var n=t.creator,i=n.thingjsObject;n.thingjsObject=i,i.setupResources({loaded:!0}),t.thingjsObject=i,n._notifyBuildedCompleteListeners(),i._hideByScene=!e.visible,i.setupTextureAnimations()},t}(oo),wo=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.createType="Door",i.json2meshObject.isWindow&&(i.createType="Thing"),i}return a(t,e),t.prototype.create=function(){var t=e.prototype.create.call(this);return t.node.isDoorOrWin=!0,t.isWindow=this.json2meshObject.isWindow,t.userData.isWindow=this.json2meshObject.isWindow,this.thingjsObject},t.prototype._setVisible=function(){},t.prototype._callback=function(t,n){e.prototype._callback.call(this,t,n);var i=n.thingjsObject;if(i.node.quaternion.set(t.rotation[0],t.rotation[1],t.rotation[2],t.rotation[3]),i.localPosition=n.creator._getThingjsLocalPosition(),t.isWindow||t.isOpen&&i.open(),i.animationClips)for(var r=0;r<i.animationClips.length;r++){var o=i.animationClips[r];if("_defaultAnim_"===o.name){i.playAnimation({name:o.name,loop:!0,speed:.15});break}}},t}(uo),To=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.createType="RouteLine",i}return a(t,e),t.prototype.create=function(){var t=e.prototype.create.call(this);return null!==this.json2meshObject.width&&(t.width=this.json2meshObject.width),"Ground"===this.thingjsParent.type||t.parent.showObjectsInParentLevels||(t.visible=!1),t.scrollSpeed=-10,t.rotateScrollDirection=!0,this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.hideByScene=!this.json2meshObject.visible,t.arrowFlag=!1,t},t.prototype._callback=function(t,n){e.prototype._callback.call(this,t,n);for(var i=[],r=new THREE.Vector3(t.position[0],t.position[1],t.position[2]),o=0;o<t.points.length;o++){var a=new THREE.Vector3(t.points[o][0],t.points[o][1],t.points[o][2]);a.add(r),i.push(a)}var s=n.thingjsObject;if(s.addPoints(i,THING.SpaceType.Local),t.resource&&t.resource.texture){var l=t.resource.texture.clone();l.flipY=!1,l.rotation=Math.PI/2,s.synPathTexture(l),l.needsUpdate=!0}if(t.color){var u=new THREE.Color(t.color[0],t.color[1],t.color[2]);s.style.color="#"+u.getHexString()}if(void 0!==t.enableMaterialAnimation&&(s.imageScroll=t.enableMaterialAnimation),void 0!==t.materialAnimationSpeed&&(s.imageScrollSpeed=-t.materialAnimationSpeed),void 0!==t.textureTiling){var c=t.textureTiling;c[1]*=s.width,s.imageRepeat=c}t.textureOffset},t}(oo),Mo=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.createType="PolygonLine",i}return a(t,e),t.prototype.create=function(){var t=e.prototype.create.call(this);return this.json2meshObject.sectionType&&("Triangle"===this.json2meshObject.sectionType&&(t.pathRadialSegments=3,t._updateByPoints()),"Square"===this.json2meshObject.sectionType&&(t.pathRadialSegments=4,t.pathStartRad=Math.PI/4,t._updateByPoints())),this.json2meshObject.radius&&(t.width=this.json2meshObject.radius),"Ground"===this.thingjsParent.type||t.parent.showObjectsInParentLevels||(t.visible=!1),this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.hideByScene=!this.json2meshObject.visible,t},t.prototype._callback=function(t,n){e.prototype._callback.call(this,t,n);for(var i=[],r=new THREE.Vector3(t.position[0],t.position[1],t.position[2]),o=0;o<t.points.length;o++){var a=new THREE.Vector3(t.points[o][0],t.points[o][1],t.points[o][2]);a.add(r),i.push(a)}var s=n.thingjsObject;if(s.addPoints(i,THING.SpaceType.Local),t.resource&&t.resource.texture){var l=t.resource.texture.clone();l.flipY=!1,s.synPathTexture(l),l.needsUpdate=!0}if(t.color){var u=new THREE.Color(t.color[0],t.color[1],t.color[2]);s.style.color="#"+u.getHexString()}else s.style.color="#ffffff";if(void 0!==t.enableMaterialAnimation&&(s.imageScroll=t.enableMaterialAnimation),void 0!==t.materialAnimationSpeed&&(s.imageScrollSpeed=t.materialAnimationSpeed),void 0!==t.textureTiling){var c=1.1*s.width*2*Math.PI/t.textureTiling[0];s.imageRepeat=[c,c]}t.textureOffset},t}(oo),So=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.json2meshBuilding=n.json2meshBuilding,i.createType="Facade",i.shouldCombineJson2meshObjects=[],i.shouldNotCombineJson2meshObjects=[],i.combineFacade=null,i.notCombineFacades=[],i}return a(t,e),t.prototype.clear=function(){e.prototype.clear.call(this),this.json2meshBuilding=null,this.shouldCombineJson2meshObjects=[],this.shouldNotCombineJson2meshObjects=[],this.combineFacade=null,this.notCombineFacades=[]},t.prototype.create=function(){var e=this.json2meshBuilding,t=this._getFacadeRelation(e);return this.shouldCombineJson2meshObjects=t.facades,this.shouldNotCombineJson2meshObjects=t.children,t.children&&t.facades&&(this.thingjsObject=this._createCombineFacade(t,this.thingjsParent),this._createFacadeChildren(t,this.thingjsObject)),this._notifyCreatedCompleteListeners(),this.thingjsObject},t.prototype._createCombineFacade=function(e,t){var n=e.facades,i=new THREE.Object3D,r=this.app.objectManager.create({type:"Facade",loaded:!1,node:i,parent:t});this.combineFacade=r;for(var o=0;o<n.length;o++){var a=n[o],s=this.app.objectManager.create({uuid:a.id,type:"CombinedObject",node:new THREE.Object3D,loaded:!1,parent:r});s.userData.isCombinedObject=!0,a.registerBuildCallbackListener(this._facadeBuildCallback,{loader:this,tjsObject:s,relation:e,parent:r})}return r},t.prototype._createFacadeChildren=function(e,t){for(var n=e.children,i=0;i<n.length;i++){var r=n[i],o=void 0;o="FacadeGroup"===r.type?this._createFacadeGroup(r,t,e):this._createFacade(r,t,e),this.notCombineFacades.push(o)}},t.prototype._createFacadeGroup=function(e,t,n){for(var i=this.app.objectManager.create({type:"Facade",uuid:e.id,id:e.userID,name:e.name,node:new THREE.Object3D,parent:t,loaded:!1,properties:e.properties}),r=0;r<e.children.length;r++){var o=e.children[r];"FacadeGroup"===o.type?this._createFacadeGroup(o,i,n):this._createFacade(o,i,n)}return e.registerBuildCallbackListener(this._facadeChildBuildCallback,{loader:this,tjsObject:i,relation:n,parent:t}),i},t.prototype._createFacade=function(e,t,n){var i=this.app.objectManager.create({type:"Facade",uuid:e.id,id:e.userID,name:e.name,node:new THREE.Object3D,parent:t,loaded:!1,url:e.resource.getModelUrl(),properties:e.properties});return e.registerBuildCallbackListener(this._facadeChildBuildCallback,{loader:this,tjsObject:i,relation:n,parent:t}),i},t.prototype.parseJson2meshObject=function(e,t){var n=this.creatorManager.createTjsObject(e,t),i=e.children;if(i)for(var r=0;r<i.length;r++){var o=i[r];this.parseJson2meshObject(o,n)}return n},t.prototype._getFacadeRelation=function(e){var t=e.typeToChildren.Facade,n=e.typeToChildren.FacadeGroup;if(!t&&!n)return{};var i=[],r=[];if(t)for(var o=0;o<t.length;o++){var a=t[o];this._isFacadeShouldBeChild(a)?i.push(a):r.push(a)}if(n)for(var s=0;s<n.length;s++){var l=n[s];this._isFacadeShouldBeChild(l)?i.push(l):r.push(l)}return{facades:r,children:i}},t.prototype._isFacadeShouldBeChild=function(e){return!this._isNullOrUndefined(e.name)||(!this._isNullOrUndefined(e.userID)||!this._isNullOrUndefined(e.properties))},t.prototype._facadeChildBuildCallback=function(e,t){var n=t.tjsObject,i=t.loader,r=t.relation,o=t.parent;n.node.add(e.mesh),n.setupResources({loaded:!0}),i._checkFacadeBuildedComplete(r,o)},t.prototype._checkFacadeBuildedComplete=function(e,t){for(var n=e.facades,i=e.children,r=!0,o=0;o<n.length;o++){if(!n[o].isBuilded){r=!1;break}}for(var a=0;a<i.length;a++){if(!i[a].isBuilded){r=!1;break}}r&&(t.setupResources({}),this._notifyBuildedCompleteListeners())},t.prototype._facadeBuildCallback=function(e,t){var n=t.tjsObject,i=t.loader,r=t.relation,o=t.parent;n.node.add(e.mesh);var a=e.mesh.getMeshes();a&&a.length>0&&a.forEach((function(e){e._sfStyle="Facade"})),n.setupResources({loaded:!0}),i._checkFacadeBuildedComplete(r,o)},t}(oo),Co=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.createType="RouteLine",i}return a(t,e),t.prototype.create=function(){e.prototype.create.call(this);return this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.arrowFlag=!0,t},t.prototype._callback=function(t,n){e.prototype._callback.call(this,t,n)},t}(To),Ao=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.createType="RouteLine",i}return a(t,e),t.prototype.create=function(){e.prototype.create.call(this);return this.thingjsObject},t.prototype._getCreateParams=function(){var t=e.prototype._getCreateParams.call(this);return t.arrowFlag=!0,t},t.prototype._callback=function(t,n){e.prototype._callback.call(this,t,n);var i=n.creator.thingjsObject;t.pointUserIDs&&(i.userData.pointUserIDs=t.pointUserIDs),t.pointProperteis&&(i.userData.pointProperteis=t.pointProperteis)},t}(Co),Ro=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.createType="PolygonLine",i}return a(t,e),t.prototype.create=function(){e.prototype.create.call(this);return this.thingjsObject},t.prototype._getCreateParams=function(){return e.prototype._getCreateParams.call(this)},t.prototype._callback=function(t,n){e.prototype._callback.call(this,t,n);var i=n.creator.thingjsObject;t.alarmLength&&(i.userData.alarmLength=t.alarmLength)},t}(Mo),Po=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.createType="RouteLine",i}return a(t,e),t.prototype.create=function(){e.prototype.create.call(this);return this.thingjsObject},t.prototype._getCreateParams=function(){return e.prototype._getCreateParams.call(this)},t.prototype._callback=function(t,n){e.prototype._callback.call(this,t,n)},t}(To),Do=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.thingjsParent=i.thingjsParent.wall,i.thingjsParent.loaded=!1,i}return a(t,e),t}(ho),ko=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.createType="Thing",i}return a(t,e),t.prototype.create=function(){return e.prototype.create.call(this)},t.prototype._getCreateParams=function(){return e.prototype._getCreateParams.call(this)},t.prototype._setVisible=function(){var e=this.thingjsObject;"Floor"!==this.thingjsParent.type||this.thingjsParent.showObjectsInParentLevels||(e.visible=!1)},t.prototype._getParent=function(e,t){return e},t}(uo),jo=function(){function e(){r(this,e),this._map={World:ao,Building:so,FloorPlan:lo,Placement:uo,Outdoors:co,CombineStraightManualWall:po,CombineCeiling:fo,CombineDoorOrWindow:mo,CombineFloor:go,CombineModelWall:vo,CombinePlacement:yo,CombinePlacementGroup:yo,CombineRoof:bo,CombinePlacementWall:Do,Room:_o,VideoProbe:xo,PlacementGroup:Eo,DoorOrWindow:wo,CurveLine:To,PipeLine:Mo,Facade:So,FacadeGroup:So,ArrowLine:Co,ArrowDataLine:Ao,LeakWaterLine:Ro,RouteLine:Po,PlacementGround:ko},this._createdThingjsObjectMap={},this.campus=null}return e.prototype.getClass=function(e){return this._map[e]},e.prototype.addCreatedThingjsObject=function(e,t){this._createdThingjsObjectMap[e.id]=t},e.prototype.getCreatedThingjsObject=function(e){return this._createdThingjsObjectMap[e]},e}(),Oo={changeParentToRoom:function(e){var t=e.json2meshObject;e.app;if(t.belongRoomUserID&&"FloorPlan"===t.parent.type){var n=this.allRooms[t.belongRoomUserID];e.thingjsParent=n}},getThingjsObjectInRoomLocalPosition:function(e,t,n){if(n){var i=n.parent.selfToWorld(e.position);return i=t.worldToLocal(i)}return e.position}},Fo=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return Oo.changeParentToRoom(i),i}return a(t,e),t.prototype._getThingjsLocalPosition=function(){var e=null;return"Room"===this.thingjsParent.type&&(e=this.thingjsParent),Oo.getThingjsObjectInRoomLocalPosition(this.json2meshObject,this.thingjsObject,e)},t}(uo),Bo=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return Oo.changeParentToRoom(i),i}return a(t,e),t.prototype._getThingjsLocalPosition=function(){var e=null;return"Room"===this.thingjsParent.type&&(e=this.thingjsParent),Oo.getThingjsObjectInRoomLocalPosition(this.json2meshObject,this.thingjsObject,e)},t}(Eo),Lo=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.createType="Room",i}return a(t,e),t.prototype.create=function(){var t=e.prototype.create.call(this),n=this.app.objectManager.create({node:new THREE.Object3D,parent:this._getParent(t,"CombinedObject"),type:"CombinedObject"});n.userData.type="CombineMiscParent",n.userData.isCombineParent=!0},t}(_o),Io=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return Oo.changeParentToRoom(i),"Room"===i.thingjsParent.type&&(i.thingjsParent=i.thingjsParent.misc,i.thingjsParent.loaded=!1),i}return a(t,e),t.prototype._getThingjsLocalPosition=function(){var e=null;return"Room"===this.thingjsParent.parent.type&&(e=this.thingjsParent.parent),Oo.getThingjsObjectInRoomLocalPosition(this.json2meshObject,this.thingjsObject,e)},t.prototype._checkParentOfCombineParentObjectsLoaded=function(e){},t}(yo),No=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return Oo.changeParentToRoom(i),i}return a(t,e),t.prototype._getThingjsLocalPosition=function(){var e=null;return"Room"===this.thingjsParent.type&&(e=this.thingjsParent),Oo.getThingjsObjectInRoomLocalPosition(this.json2meshObject,this.thingjsObject,e)},t}(xo),Ho=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._map.Placement=Fo,i._map.PlacementGroup=Bo,i._map.Room=Lo,i._map.CombinePlacement=Io,i._map.VideoProbe=No,i}return a(t,e),t}(jo),zo=function(){function e(){r(this,e)}return e.prototype.init=function(e){},e.prototype.onFire=function(e){},e}(),Uo=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerCreatedCallbackListener(this.onFire,{event:this}),t.registerBuildedCallbackListener(this._buildCallback,{event:this})},t.prototype.onFire=function(e,t){var n=e.thingjsObject,i=e.json2meshObject,r=t.event;if("Building"!==n.type&&"Campus"!==n.type&&"CombinedObject"!==n.type&&"Room"!==n.type&&"RouteLine"!==n.type&&"PolygonLine"!==n.type&&"Ground"!==n.type)if("Facade"===n.type){var o=e.json2meshBuilding;r._addFacadeBoxNode(o,n)}else r._addBoxNode(i,n)},t.prototype._addFacadeBoxNode=function(e,t){var n=this._getFacadesBoundingBox(e),i=new THREE.Vector3,r=new THREE.Vector3;n.getSize(i),n.getCenter(r);var o=new THREE.BoxBufferGeometry(1,1,1),a=new THREE.MeshBasicMaterial;a.visible=!1;var s=new THREE.Mesh(o,a);s.scale.set(i.x,i.y,i.z),s.userData.asBoundingBox=!0,s.userData.skipStyle=!0,s.userData.useToCaculateBoundingBox=!0,t.node.add(s),s.position.set(r.x,r.y,r.z)},t.prototype._getFacadesBoundingBox=function(e){var t=new THREE.Box3,n=new THREE.Object3D,i=e.typeToChildren.Facade,r=e.typeToChildren.FacadeGroup;if(i)for(var o=0;o<i.length;o++){var a=i[o];n.add(this._createBoxMesh(a))}if(r)for(var s=0;s<r.length;s++){var l=r[s];n.add(this._createBoxMesh(l))}return t.setFromObject(n),t},t.prototype._createBoxMesh=function(e){var t=new THREE.BoxBufferGeometry(1,1,1),n=new THREE.MeshBasicMaterial,i=new THREE.Mesh(t,n);return i.scale.set(e.size[0],e.size[1],e.size[2]),i.quaternion.set(e.rotation[0],e.rotation[1],e.rotation[2],e.rotation[3]),i.position.set(e.position[0],e.position[1],e.position[2]),i.position.y=(e.position[0]+e.size[1])/2,i},t.prototype._addBoxNode=function(e,t){var n=new THREE.Vector3(e.center[0],e.center[1],e.center[2]),i=new THREE.BoxBufferGeometry(1,1,1),r=new THREE.MeshBasicMaterial;r.visible=!1;var o=new THREE.Mesh(i,r),a=new THREE.Vector3(e.size[0],e.size[1],e.size[2]);a.divide(t.node.scale),o.scale.set(0===a.x?.001:a.x,0===a.y?.001:a.y,0===a.z?.001:a.z),o.userData.asBoundingBox=!0,o.userData.skipStyle=!0,o.userData.useToCaculateBoundingBox=!0,o.name="boxNode",t.node.add(o),"Building"===t.type||"Floor"===t.type?o.position.set(n.x,n.y,n.z):o.position.set(0,e.size[1]/2,0)},t.prototype._buildCallback=function(e,t){for(var n=e.thingjsObject,i=(e.json2meshObject,n.node),r=0;r<i.children.length;r++){var o=i.children[r];if(o.userData.asBoundingBox){o.visible=!1;break}}},t}(zo),Vo=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerBuildedCallbackListener(this.onFire,{event:this})},t.prototype.onFire=function(e,t){var n=e.thingjsObject,i=e.json2meshObject,r=t.event;if("CombinePlacement"===i.type){var o=i.objects,a=i.transformations,s=i.resource.modelID;i.resource.model.updateMatrixWorld();for(var l=app.create({type:"BatchObject",nodeOverride:!1,node:i.resource.model,initBatchNum:o.length,parent:n}),u=0;u<o.length;u++){var c=o[u],h=r.calMatrixs(a[u]),p=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Quaternion;h.decompose(p,f,d);var m=p.toArray(),g=d.toArray(),v=new THREE.Euler;v.setFromQuaternion(f);var y=v.toArray();y[0]*=180/Math.PI,y[1]*=180/Math.PI,y[2]*=180/Math.PI;l.createSubObject({parent:n,id:c.id,localPosition:m,scale:g,angles:y})}r.addSfStyle(l.node,r.isTree(s)?"Thing-树":"Thing")}},t.prototype.getMeshes=function(e){var t=[];return e.traverse((function(e){e.isMesh&&t.push(e)})),t},t.prototype.addSfStyle=function(e,t){var n=this.getMeshes(e);if(n&&n.length>0)for(var i=0;i<n.length;i++){n[i]._sfStyle=t}},t.prototype.isTree=function(e){return!!io[e]},t.prototype.calMatrixs=function(e){for(var t=new THREE.Matrix4,n=e.positions.length-1;n>-1;n--){var i=e.positions[n],r=e.quaternions[n],o=e.scales[n],a=new THREE.Vector3(i[0],i[1],i[2]),s=new THREE.Quaternion(r[0],r[1],r[2],r[3]),l=new THREE.Vector3(o[0],o[1],o[2]),u=new THREE.Matrix4;u.compose(a,s,l),t.premultiply(u)}return t},t}(zo),qo=function(e){function t(){return r(this,t),s(this,e.call(this))}return a(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerBuildedCallbackListener(this.onFire,{event:this})},t.prototype.onFire=function(e,t){e.thingjsObject;var n=e.json2meshObject,i=t.event;"Room"===n.type?i._createRoomWater(e):"CombineFloor"!==n.type&&"CombineCeiling"!==n.type&&"CombineRoof"!==n.type||i._createCombineFloorWater(e)},t.prototype._createRoomWater=function(e){var t=e.json2meshObject,n=e.thingjsObject;if(t.floor&&this._checkIsWater(t.floor.resource)){var i=t.floor.mesh.position,r=t.floor.mesh.quaternion,o=this._createWater(e,t.floor.mesh);n.node.remove(t.floor.mesh),o.userData.json2meshType=t.type,t.floor.mesh=o.node,n._floorNode=o.node,n.add(o),o.node.position.copy(i),o.node.quaternion.copy(r),t.mesh.children[0]=o.node}if(t.ceiling&&this._checkIsWater(t.ceiling.resource)){var a=t.ceiling.mesh.position,s=t.ceiling.mesh.quaternion,l=this._createWater(e,t.ceiling.mesh);l.userData.json2meshType=t.type,n.node.remove(t.ceiling.mesh),t.ceiling.mesh=l.node,n._ceilingNode=l.node,n.add(l),l.node.position.copy(a),t.mesh.children[1]=l.node,l.node.position.copy(a),l.node.quaternion.copy(s)}if(t.roof&&this._checkIsWater(t.roof.resource)){var u=t.roof.mesh.position,c=t.roof.mesh.quaternion,h=this._createWater(e,t.roof.mesh);t.roof.mesh=h.node,n._roofNode=h.node,n.node.remove(t.roof.mesh),n.add(h),h.node.position.copy(u),t.mesh.children[2]=h.node,h.node.position.copy(u),h.node.quaternion.copy(c)}},t.prototype._createCombineFloorWater=function(e){var t=e.json2meshObject,n=e.thingjsObject;if(this._checkIsWater(t.resource)){var i=this._createWater(e,t.mesh);i.scale.y*=-1,n.node.remove(t.mesh),n.add(i),i.node.position.copy(t.mesh.position),i.node.quaternion.copy(t.mesh.quaternion)}},t.prototype._checkIsWater=function(e){return!(!e||"bundle"!==e.ext||"test0000000003"!==e.id&&"test0000000004"!==e.id)},t.prototype._createWater=function(e,t){var n=e.app.objectManager.create({type:"Water",style:{waterColor:"#1D282C",waterScale:.3,flowXDirection:2,flowYDirection:1},geometry:t.geometry});return n.water.position.set(0,0,0),n.water.quaternion.set(0,0,0,1),n},t}(zo),Go=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerBuildedCallbackListener(this._buildCallback,{event:this})},t.prototype._buildCallback=function(e,t){var n=e.thingjsObject,i=e.json2meshObject,r=t.event;n.node;i.resource&&i.resource.indexJson?n._extensionsFile=i.resource.indexJson.extensionsfile||null:"Building"===i.type&&"Facade"===n.type&&r._processFacade(e,t)},t.prototype._processFacade=function(e,t){for(var n=e.thingjsObject,i=(e.json2meshObject,e.shouldNotCombineJson2meshObjects),r=0;r<i.length;r++){var o=i[r],a=n.query("##"+o.id)[0];o.resource&&o.resource.indexJson&&(a._extensionsFile=o.resource.indexJson.extensionsfile||null)}},t}(zo),Wo=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));i.resourceManager=n.resourceManager,i.localUseStaticImageResources={};var o=i;return i.useStaticImageKey="useStaticImage",i.manualUseStaticImage="manualUseStaticImage",i.skipManualObjects=void 0!==THING[i.manualUseStaticImage]&&!THING[i.manualUseStaticImage],THING.onValueChange=function(e){e.type===o.useStaticImageKey?o.onUseStaticImageChange(e.value):e.type===o.manualUseStaticImage&&o.onManualUseStaticImageChange(e.value)},i}return a(t,e),t.prototype.onUseStaticImageChange=function(e){for(var t=0;t<this.resourceManager.textures.length;t++){var n=this.resourceManager.textures[t];void 0===this.localUseStaticImageResources[n.id]&&(n.useStaticImage=e)}for(var i=0;i<this.resourceManager.models.length;i++){var r=this.resourceManager.models[i];void 0===this.localUseStaticImageResources[r.id]&&(r.useStaticImage=e)}},t.prototype.onManualUseStaticImageChange=function(e){for(var t=0;t<this.resourceManager.textures.length;t++){var n=this.resourceManager.textures[t];void 0===this.localUseStaticImageResources[n.id]&&(n.useStaticImage=e)}},t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerCreatedCallbackListener(this.onFire,{event:this})},t.prototype.onFire=function(e,t){var n=e.thingjsObject,i=e.json2meshObject,r=t.event;if("Facade"===n.type){var o=e.json2meshBuilding;r.processFacades(o.typeToChildren.Facade),r.processFacadeGroups(o.typeToChildren.FacadeGroup)}else"PlacementGroup"===i.type?r.processGroup(i):i.resource&&!i.resource.type?r.skipManualObjects&&r.processJson2meshObject(i,!1):r.processJson2meshObject(i)},t.prototype.processFacades=function(e){if(e)for(var t=0;t<e.length;t++){var n=e[t];this.processJson2meshObject(n)}},t.prototype.processFacadeGroups=function(e){if(e)for(var t=0;t<e.length;t++){var n=e[t];this.processGroup(n)}},t.prototype.processGroup=function(e,t,n){void 0===n&&(n=this.getLocalUseStaticImageSetting(e));for(var i=0;i<e.groups.length;i++){var r=e.groups[i];this.processGroup(r,t,n)}for(var o=0;o<e.placements.length;o++){var a=e.placements[o];a.resource&&this.processJson2meshObject(a,t,n)}},t.prototype.processJson2meshObject=function(e,t,n){if(void 0===n&&(n=this.getLocalUseStaticImageSetting(e)),void 0===t&&(t=THING[this.useStaticImageKey]),e.resource){if(void 0!==this.localUseStaticImageResources[e.resource.id])return;void 0===n?void 0!==t&&(e.resource.useStaticImage=t):(e.resource.useStaticImage=n,void 0!==!this.localUseStaticImageResources[e.resource.id]&&(this.localUseStaticImageResources[e.resource.id]=n))}},t.prototype.getLocalUseStaticImageSetting=function(e){if(e.lowerCaseProperties){if("true"===e.lowerCaseProperties._usestaticimage_)return!0;if("false"===e.lowerCaseProperties._usestaticimage_)return!1}},t.prototype.getGlobalUseStaticImageSetting=function(){if(void 0!==THING[this.useStaticImageKey])return THING[this.useStaticImageKey]},t}(zo),Xo=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.resourceManager=n.resourceManager,i.processGlobalSetting(),i}return a(t,e),t.prototype.processGlobalSetting=function(){if(THING.useStaticImage){for(var e=0;e<this.resourceManager.textures.length;e++){this.resourceManager.textures[e].useStaticImage=true}for(var t=0;t<this.resourceManager.models.length;t++){this.resourceManager.models[t].useStaticImage=true}}},t.prototype.init=function(e){},t}(zo),Jo=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return Oo.allRooms={},i}return a(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerCreatedCallbackListener(this.onFire,{event:this})},t.prototype.onFire=function(e,t){var n=e.thingjsObject,i=e.json2meshObject;t.event;"Room"===n.type&&i.userID&&(Oo.allRooms[i.userID]=n)},t}(zo),Yo=function(){function e(t){r(this,e),this.campus=null,this.app=t,this.enableProxima=!1,this.enableDynamicLoad=!1,this.creatorManager=null,this.enableBatchObject=!1,this.resourceManager=null,this.events=[]}return e.prototype.setCampus=function(e){this.campus=e},e.prototype.parseWorld=function(e,t){var n=null;this.resourceManager=t;this.initEvents();n=this.enableProxima?new Ho(this.app):new jo(this.app),null!==this.campus&&n.addCreatedThingjsObject(e,this.campus),this.creatorManager=new ro({app:this.app,config:n,events:this.events});var i=this.parseJson2meshObject(e);return this.processHideObjects(i),i},e.prototype.initEvents=function(){var e=this.events;this.enableDynamicLoad&&e.push(new Uo),this.enableBatchObject&&e.push(new Vo(this.app)),this.enableProxima&&e.push(new Jo(this.app)),e.push(new qo),e.push(new Go),e.push(new Xo({app:this.app,resourceManager:this.resourceManager})),e.push(new Wo({app:this.app,resourceManager:this.resourceManager}))},e.prototype.parseJson2meshObject=function(e,t){var n=this.creatorManager.createTjsObject(e,t);if("Building"===e.type&&this.parseFacades(e,n),this.shouldParseChildren(e)){var i=e.children;if(i)for(var r=0;r<i.length;r++){var o=i[r];"Facade"!==o.type&&"FacadeGroup"!==o.type&&"Floor"!==o.type&&"Ceiling"!==o.type&&"Roof"!==o.type&&this.parseJson2meshObject(o,n)}}return n},e.prototype.shouldParseChildren=function(e){return!!e.isContainer},e.prototype.parseFacades=function(e,t){var n=e.typeToChildren.Facade,i=e.typeToChildren.FacadeGroup;(n||i)&&this.creatorManager.createTjsFacadeObject(e,t)},e.prototype.processHideObjects=function(e){for(var t=e.buildings,n=0;n<t.length;n++){var i=t[n],r=i.floors;if(i.facade&&!i.structShow)for(var o=0;o<r.length;o++){r[o].visible=!1}else for(var a=0;a<r.length;a++){var s=r[a];this.hidePlanObjs(s)}}},e.prototype.hidePlanObjs=function(e){if(!e.showObjectsInParentLevels){for(var t=e.query(".CombinedObject",!1),n=0;n<t.length;n++){var i=t[n];if("CombineMiscParent"===i.userData.type)for(var r=i.query(".CombinedObject",!1),o=0;o<r.length;o++){var a=r[o];"CombinePlacement"!==a.userData.json2meshType&&"CombinePlacementGroup"!==a.userData.json2meshType||(a.visible=!1)}}for(var s=0;s<e.children.length;s++){var l=e.children[s];l.isDoor||"Room"===l.type||("Thing"===l.type&&l.isWindow||(l.visible=!1))}}},e.prototype.clear=function(){this.creatorManager.clear(),this.campus=null,this.app=null,this.enableProxima=!1,this.enableDynamicLoad=!1,this.creatorManager=null,this.enableBatchObject=!1,this.resourceManager=null,this.events=[]},e}(),Qo=function(){function e(t,n){r(this,e),this.app=t,this.resourceUrl=null,this.relativeResourceUrl=null,this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.tempTexture=null,this.indexJson=n,this.sceneJsonUri="scene.json",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallTexture=null,this.defaultCeilingTexture=null,this.defaultFloorTexture=null,this.defaultRoofTexture=null,this.defaultWallEdgeTexture=null,this.worldNode=new THREE.Object3D("world"),this.isCamFitScene=!0,this.campus=null,this.outdoorsVisible=!0,this.campusVisible=!0,this.enableUseHighestVersionResource=!0,this.enableDownloadSceneJsonCache=!0,this.enableDynamicLoad=!1,this.enableProxima=!1,this.enableBatchObject=!1;this.worldNode;if(n&&(n.position&&(this.campusPosition=n.position),n.rotation&&(this.campusRotation=n.rotation),void 0!==n.isCamFitScene&&null!==n.isCamFitScene&&(this.isCamFitScene=n.isCamFitScene),n.scale&&(this.campusScale=n.scale),void 0!==n.outdoorsVisible&&(this.outdoorsVisible=n.outdoorsVisible),void 0!==n.campusVisible&&(this.campusVisible=n.campusVisible),n.campus&&(this.campus=n.campus),n.enableDynamicLoadScene&&(this.enableDynamicLoad=n.enableDynamicLoadScene),n.enableProxima&&(this.enableProxima=n.enableProxima),n.enableBatchObject&&(this.enableBatchObject=n.enableBatchObject),void 0!==n.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=n.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),void 0!==n.enableDownloadSceneJsonCache&&(this.enableDownloadSceneJsonCache=n.enableDownloadSceneJsonCache),n.startDownloadResourcesCallback&&(this.startDownloadResourcesCallback=n.startDownloadResourcesCallback)),this.campus&&(this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale)),n.default){var i=n.default;i.sceneJson&&(this.sceneJson="export.json"),i.wallTexture&&(this.defaultWallTextureUri=i.wallTexture),i.wallEdgeTexture&&(this.defaultWallEdgeTextureUri=i.wallEdgeTexture),i.floorTexture&&(this.defaultFloorTextureUri=i.floorTexture),i.ceilingTexture&&(this.defaultCeilingTextureUri=i.ceilingTexture),i.roofTexture&&(this.defaultRoofTextureUri=i.roofTexture)}this.app.options.loaderResourceUrl&&(this.resourceUrl=this.app.options.loaderResourceUrl),void 0!==this.app.options.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=this.app.options.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),void 0!==this.app.options.enableBatchObject&&this.app.options.enableBatchObject&&(json2mesh.DefaultSetting.enableCombinePlacementToBuildMesh=!1,this.enableBatchObject=this.app.options.enableBatchObject),this.app.options.resourceLibraryUrl&&(this.resourceUrl=this.app.options.resourceLibraryUrl),this.indexJson.resourceLibrary&&(this.relativeResourceUrl=this.indexJson.resourceLibrary),this.enableDownloadSceneJsonCache||(this.sceneJsonUri+="?_t="+(new Date).getTime()),this.json2meshToThingjsParser=null}return e.prototype.parseCamInfo=function(e){var t=e.eye,n=e.target,i=t.split(" "),r=n.split(" "),o=[Number(i[0]),Number(i[1]),Number(i[2])];o[2]=-o[2];var a=[Number(r[0]),Number(r[1]),Number(r[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.load=function(e){var t=this;if(t.json2meshToThingjsParser=new Yo(t.app),t.enableProxima&&(t.json2meshToThingjsParser.enableProxima=!0,json2mesh.DefaultSetting.enableCombinePlacementsByRoom=!0),t.enableBatchObject&&(t.json2meshToThingjsParser.enableBatchObject=t.enableBatchObject),"String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var n=e;this.sceneURL=n.url,n.campus&&(this.campus=n.campus,this.worldNode=this.campus.node,this.json2meshToThingjsParser.setCampus(this.campus))}return this.relativeResourceUrl&&(0===this.relativeResourceUrl.indexOf("./")?this.resourceUrl=this.sceneURL+this.relativeResourceUrl.replace("./","/"):this.resourceUrl=this.relativeResourceUrl),new Promise((function(e,n){t.updateProgress(.1),t.loadSceneJson().then((function(n){t.sceneJsonString=n,t.sceneJson=JSON.parse(n),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.updateProgress(.1);var i=new json2mesh.UBuilderSceneLoader;void 0!==t.app.options.loadingSceneMaxResourcesUnitDownloadNumber&&i.setResourcesUnitDownloadNumber(t.app.options.loadingSceneMaxResourcesUnitDownloadNumber),void 0!==t.app.options.loadingSceneAwaitToNextBuildTime&&(i.dynamicBuildManager.awaitToNextBuildTime=t.app.options.loadingSceneAwaitToNextBuildTime),t.enableDynamicLoad&&(i.enableRequestWorld=!1,t.json2meshToThingjsParser.enableDynamicLoad=!0),t.resourceUrl&&(i.resourceManager.baseTextureUrl=t.resourceUrl+"/texture/",i.resourceManager.baseModelUrl=t.resourceUrl+"/model/"),t.loader=i,i.load({json:t.sceneJson,customModeBaseUrl:t.sceneURL+"/",version:0}).then((function(n){var r=new no;r.parseWorld(n),r.clear(),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.campus.visible=t.campusVisible,t.campusRotation&&t.campus.node.quaternion.set(t.campusRotation.x,t.campusRotation.y,t.campusRotation.z,t.campusRotation.w),t.campusPosition&&(t.campus.position=t.campusPosition),t.campusScale&&(t.campus.scale=t.campusScale),t.startDownloadResourcesCallback&&t.startDownloadResourcesCallback(i.resourceManager.models,i.resourceManager.textures),t.campus=t.json2meshToThingjsParser.parseWorld(n,i.resourceManager),t.enableDynamicLoad?(t.loadExtraData(t.campus),t.updateProgress(1),e(t.campus)):i.startToBuild((function(n){t.updateProgress(.1+.9*n),1===n&&(t.updateProgress(1),t.loadExtraData(t.campus),e(t.campus))}))}))}))}))},e.prototype.loadExtraData=function(e){this.sceneJson.extraData&&(e.extraData=this.sceneJson.extraData)},e.prototype.loadSceneJson=function(){var e=this;return new Promise((function(t,n){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL+"/"+e.sceneJsonUri,(function(e){t(e)}))}))},e.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess({object:this.campus,progress:e})},e.prototype.startToDownloadRequestResources=function(e){this.loader.resourceManager.startToDownloadRequestResources(e)},e.prototype.addResourceDownloadRequest=function(e){this.loader.resourceManager.addResourceDownloadRequest(e)},e.prototype.clearAllResources=function(){this.clear()},e.prototype.clearAllObjects=function(){this.world.clear(),this.world=null},e.prototype.clear=function(){this.loader.clearAllResources(),this.json2meshToThingjsParser.clear(),this.resourceUrl=null,this.relativeResourceUrl=null,this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.tempTexture=null,this.indexJson=null,this.sceneJsonUri=null,this.defaultWallTextureUri=null,this.defaultWallEdgeTextureUri=null,this.defaultFloorTextureUri=null,this.defaultCeilingTextureUri=null,this.defaultRoofTextureUri=null,this.defaultWallTexture=null,this.defaultCeilingTexture=null,this.defaultFloorTexture=null,this.defaultRoofTexture=null,this.defaultWallEdgeTexture=null,this.worldNode=new THREE.Object3D("world"),this.isCamFitScene=!0,this.campus=null,this.outdoorsVisible=!0,this.campusVisible=!0,this.enableUseHighestVersionResource=!0,this.enableDownloadSceneJsonCache=!0,this.enableDynamicLoad=!1,this.enableProxima=!1,this.enableBatchObject=!1},e.prototype.requestToBuild=function(e){this.loader.requestToBuild(e)},e.prototype.startToBuild=function(e){return this.loader.startToBuild(e)},e.prototype.disposeObject=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.loader.disposeObject(e,t)},e.prototype.findObjectByID=function(e){return this.world.findObjectByID(e)},e}(),Zo=function(){function e(t){r(this,e),this.app=t,this.nodes=[],this.scene=this.app.scene,this.objectPool=this.app.objectPool,this.rootNode=null,this.campus=null,this.sceneURL=null,this.sceneJsonData=null,this.loadedSceneGLTF=null,this.worldNode=new THREE.Object3D,this.fitCamInfo=null}return e.prototype.parse=function(e){if(this.parseWorld(e),e.camInfo){var t=e.camInfo;this.fitCamInfo=t}},e.prototype.parseCamInfo=function(e){var t=e.eye,n=e.target,i=t.split(" "),r=n.split(" "),o=[Number(i[0]),Number(i[1]),Number(i[2])];o[2]=-o[2];var a=[Number(r[0]),Number(r[1]),Number(r[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.parseWorld=function(e){var t=this.worldNode;if(null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:t}),this.campus.node.name="campus",this.app.scene.add(this.campus.node)),e.outdoors&&this.parseOutdoors(e.outdoors),e.buildings){var n=e.buildings;this.parseBuildings(n)}},e.prototype.parseOutdoors=function(e){var t=e,n=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:n});var i=this.outdoors;this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.currentParentObject=this.outdoors);var r=t.gltfid;if(r&&this.nodes[r]){var o=this.nodes[r];THREE.SceneUtils.detach(o,o.parent,this.app.scene),THREE.SceneUtils.attach(o,this.app.scene,i.node),i.node.updateMatrixWorld()}this.parseFloorPlan(t,i)},e.prototype.parseBuildings=function(e){for(var t in e){var n=e[t],i=t;n.name&&(i=n.name);var r=null;if(n.gltfid){var o=n.gltfid;this.nodes[o]&&(r=this.nodes[o])}var a=this.app.objectManager.create({type:"Building",name:i,parent:this.campus,node:r});n.plans&&this.parseFloorPlans(n.plans,a),n.facades&&this.parseFacades(n.facades,a)}},e.prototype.parseFloorPlans=function(e,t){for(var n in e){var i=null,r=e[n],o=n;r.name&&(o=r.name);var a=r.gltfid;a&&this.nodes[a]&&(i=this.nodes[a]);var s=this.app.objectManager.create({type:"Floor",name:o,node:i,parent:t});this.parseFloorPlan(r,s)}},e.prototype.parseFloorPlan=function(e,t){e.placements&&this.parseThings(e.placements,t),e.videoprobes&&this.parseThings(e.videoprobes,t),e.doororwindows&&this.parseDoorWins(e.doororwindows,t),e.routes&&this.parseThings(e.routes,t),e.pipelines&&this.parseThings(e.pipelines,t),e.curvelines&&this.parseThings(e.curvelines,t),e.arrowlines&&this.parseThings(e.arrowlines,t),e.arrowdatalines&&this.parseThings(e.arrowdatalines,t),e.leakwaterlines&&this.parseThings(e.leakwaterlines,t),e.rooms&&this.parseRooms(e.rooms,t),this.parseStructure(e,t);var n=e.groups;n&&this.parseGroup(n,t)},e.prototype.parseRooms=function(e,t){for(var n=0;n<e.length;n++){var i=e[n],r=null;i.name&&(r=i.name);var o=null,a=i.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=i.properties;if(l)for(var u in s={},l){var c=l[u];s[u]=c}var h=null,p=null,d=null;i.floor&&(a=i.floor.gltfid,this.nodes[a]&&(d=this.nodes[a])),i.ceiling&&(a=i.ceiling.gltfid,this.nodes[a]&&(h=this.nodes[a])),i.roof&&(a=i.roof.gltfid,this.nodes[a]&&(p=this.nodes[a]));var f=null,m=null,g=null,v={};if(i.area&&(m=i.area,v.area=m),i.circumference&&(g=i.circumference,v.circumference=g),i.center){var y=i.center;(f=new THREE.Vector3).set(y[0],y[1],-y[2]),v.center=f}var b=i.isShown;if(b){var _="false"!==(b=b.toLowerCase());o.visible=_}this.app.objectManager.create({type:"Room",name:r,node:o,ceilingNode:h,roofNode:p,floorNode:d,parent:t,properties:s,auxiliaryInfo:v})}},e.prototype.parseStructure=function(e,t){if(e.structure){var n=(e=e.structure).placements;if(n)for(var i in n){var r=n[i].gltfid,o=this.nodes[r];if(o){t.miscNode=o.parent;break}}var a=e.walls;if(a)for(var i in a){r=a[i].gltfid;var s=this.nodes[r];if(s){t.wallNode=s.parent;break}}var l=e.roofs;if(l)for(var i in l){r=l[i].gltfid;var u=this.nodes[r];if(u){t.roofNode=u.parent;break}}var c=e.ceilings;if(c)for(var i in c){r=c[i].gltfid;var h=this.nodes[r];if(h){t.ceilingNode=h.parent;break}}if(p=e.floors)for(var i in p){var p;if(r=(p=p[i]).gltfid){var d=this.nodes[r];if(d){t.floorNode=d.parent;break}}}}},e.prototype.parseGroup=function(e,t){for(var n in e){var i=e[n],r=n;i.name&&(r=i.name);var o=null,a=i.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=i.properties;if(l)for(var u in s={},l){var c=l[u];s[u]=c}this.app.objectManager.create({type:"Thing",name:r,node:o,parent:t,properties:s}),i.placements&&this.parseThings(i.placements,t)}},e.prototype.parseFacades=function(e,t){for(var n in e){var i=e[n],r=n;i.name&&(r=i.name);var o=null,a=i.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=i.properties;if(l)for(var u in s={},l){var c=l[u];s[u]=c}var h=i.isShown;if(h){var p="false"!==(h=h.toLowerCase());o.visible=p}this.app.objectManager.create({type:"Facade",name:r,node:o,parent:t,properties:s});t.node.add(o)}},e.prototype.parseThings=function(e,t){for(var n in e){var i=e[n],r=i.name||n,o=i.type||"Thing",a=null,s=i.gltfid;s&&this.nodes[s]&&(a=this.nodes[s]);var l=null,u=i.properties;if(u)for(var c in l={},u){var h=u[c];l[c]=h}var p=i.isShown;if(p){var d="false"!==(p=p.toLowerCase());a.visible=d}this.app.objectManager.create({type:o,name:r,node:a,parent:t,properties:l})}},e.prototype.parseDoorWins=function(e,t){for(var n in e){var i=e[n],r=n;i.name&&(r=i.name);var o=null;if(i.gltfid){var a=i.gltfid;this.nodes[a]&&(o=this.nodes[a])}var s=null;if(i.properties){var l=i.properties;for(var u in s={},l){var c=l[u];s[u]=c}}this.app.objectManager.create({type:"Door",name:r,node:o,parent:t,properties:s})}},e.prototype.load=function(e){var t=this;if("String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var n=e;this.sceneURL=n.url,n.campus&&(this.campus=n.campus,this.worldNode=this.campus.node)}return new Promise((function(e,n){t.loadGLTF().then((function(e){return t.loadedSceneGLTF=e,e.scene.traverse((function(e){t.nodes[e.name]=e})),t.parseSceneJson()})).then((function(n){t.fitCamInfo?t.parseCamInfo(t.fitCamInfo):t.campus.node&&t.app.camera.fit(t.campus),e(t.campus)})).catch((function(){t.campus.node.add(t.loadedSceneGLTF.scene.children[0]),t.campus&&t.app.camera.fit(t.campus),e(t.campus)}))}))},e.prototype.loadGLTF=function(){var e=this;return new Promise((function(t,n){var i=new THREE.GLTFLoader(e.app.loadingManager);i.setCrossOrigin("anonymous"),i.load(e.sceneURL+"/Unity2GLTF.gltf",(function(e){t(e)}))}))},e.prototype.parseSceneJson=function(){var e=this;return new Promise((function(t,n){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL+"/scene.json",(function(n){var i=JSON.parse(n);e.sceneJsonData=i,e.parseWorld(i),t(i)}),(function(){}),(function(){console.error("not find file scene.json "),n()}))}))},e}(),Ko=function(e){function t(n,i){return r(this,t),s(this,e.call(this,n,i))}return a(t,e),t.prototype.load=function(e){var t=this;if(t.json2meshToThingjsParser=new Yo(t.app),t.enableProxima&&(t.json2meshToThingjsParser.enableProxima=!0,json2mesh.DefaultSetting.enableCombinePlacementsByRoom=!0),t.enableBatchObject&&(t.json2meshToThingjsParser.enableBatchObject=t.enableBatchObject),"String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var n=e;this.sceneURL=n.url,n.campus&&(this.campus=n.campus,this.worldNode=this.campus.node,this.json2meshToThingjsParser.setCampus(this.campus))}return this.relativeResourceUrl&&(0===this.relativeResourceUrl.indexOf("./")?this.resourceUrl=this.sceneURL+this.relativeResourceUrl.replace("./","/"):this.resourceUrl=this.relativeResourceUrl),new Promise((function(e,n){t.updateProgress(.1),t.loadSceneJson().then((function(n){t.sceneJsonString=n,t.sceneJson=JSON.parse(n),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.updateProgress(.1);var i=new json2mesh.UBuilderSceneLoader;void 0!==t.app.options.loadingSceneMaxResourcesUnitDownloadNumber&&i.setResourcesUnitDownloadNumber(t.app.options.loadingSceneMaxResourcesUnitDownloadNumber),void 0!==t.app.options.loadingSceneAwaitToNextBuildTime&&(i.dynamicBuildManager.awaitToNextBuildTime=t.app.options.loadingSceneAwaitToNextBuildTime),t.enableDynamicLoad&&(i.enableRequestWorld=!1,t.json2meshToThingjsParser.enableDynamicLoad=!0);var r="https://www.thingjs.com/";t.resourceUrl&&(i.resourceManager.baseTextureUrl=t.resourceUrl+"/texture/",i.resourceManager.baseModelUrl=t.resourceUrl+"/model/",r=t.resourceUrl+"/"),t.loader=i,i.load({json:t.sceneJson,version:1,customModeBaseUrl:r}).then((function(n){(new no).parseWorld(n),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.campus.visible=t.campusVisible,t.campusRotation&&t.campus.node.quaternion.set(t.campusRotation.x,t.campusRotation.y,t.campusRotation.z,t.campusRotation.w),t.campusPosition&&(t.campus.position=t.campusPosition),t.campusScale&&(t.campus.scale=t.campusScale),t.startDownloadResourcesCallback&&t.startDownloadResourcesCallback(i.resourceManager.models,i.resourceManager.textures),t.campus=t.json2meshToThingjsParser.parseWorld(n,i.resourceManager),t.enableDynamicLoad?(t.loadExtraData(t.campus),t.updateProgress(1),e(t.campus)):i.startToBuild((function(n){t.updateProgress(.1+.9*n),1===n&&(t.updateProgress(1),t.loadExtraData(t.campus),e(t.campus))}))}))}))}))},t}(Qo),$o=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerBuildedCallbackListener(this._buildCallback,{event:this})},t.prototype._buildCallback=function(e,t){var n=e.thingjsObject,i=e.json2meshObject;"Facade"!==n.type&&(n.localPosition=i.position,n.scale=i.scale,i.rotation&&n.node.quaternion.set(i.rotation[0],i.rotation[1],i.rotation[2],i.rotation[3]))},t}(zo),ea=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.thingjsParent=i.thingjsParent.misc,i.thingjsParent.loaded=!1,i}return a(t,e),t}(ho),ta=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t}(oo),na=function(e){function t(){r(this,t);var n=s(this,e.call(this));return n._map.BatchCombinePlacement=ea,n._map.BatchPlacement=ta,n}return a(t,e),t}(jo),ia=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t}(na),ra=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerBuildedCallbackListener(this.onFire,{event:this})},t.prototype.onFire=function(e,t){var n=e.thingjsObject,i=e.json2meshObject,r=t.event;if("BatchCombinePlacement"===i.type){var o=i.objects;if(0===o.length)return;n.node.remove(i.mesh);var a=i.transformations,s=i.resource.modelID;i.resource.model.updateMatrixWorld();for(var l=app.create({type:"BatchObject",nodeOverride:!1,node:i.resource.model,initBatchNum:o.length,parent:n}),u=0;u<o.length;u++){var c=o[u],h=r.calMatrixs(a[u]),p=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Quaternion;h.decompose(p,f,d);var m=p.toArray(),g=d.toArray(),v=new THREE.Euler;v.setFromQuaternion(f);var y=v.toArray();y[0]*=180/Math.PI,y[1]*=180/Math.PI,y[2]*=180/Math.PI;var b=r.getSubObjectParams(c);b.localPosition=m,b.scale=g,b.angles=y,b.parent=n;l.createSubObject(b)}r.addSfStyle(l.node,r.isTree(s)?"Thing-树":"Thing")}},t.prototype.getSubObjectParams=function(e){var t={uuid:e.id};return null!==e.userID&&(t.id=e.userID),null!==e.name&&(t.name=e.name),null!==e.properties&&(t.properties=e.properties),t},t.prototype.getMeshes=function(e){var t=[];return e.traverse((function(e){e.isMesh&&t.push(e)})),t},t.prototype.addSfStyle=function(e,t){var n=this.getMeshes(e);if(n&&n.length>0)for(var i=0;i<n.length;i++){n[i]._sfStyle=t}},t.prototype.isTree=function(e){return!!io[e]},t.prototype.calMatrixs=function(e){for(var t=new THREE.Matrix4,n=e.positions.length-1;n>-1;n--){var i=e.positions[n],r=e.quaternions[n],o=e.scales[n],a=new THREE.Vector3(i[0],i[1],i[2]),s=new THREE.Quaternion(r[0],r[1],r[2],r[3]),l=new THREE.Vector3(o[0],o[1],o[2]),u=new THREE.Matrix4;u.compose(a,s,l),t.premultiply(u)}return t},t}(zo),oa=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),t.registerBuildedCallbackListener(this.onFire,{event:this})},t.prototype.onFire=function(e,t){var n=e.thingjsObject,i=e.json2meshObject,r=t.event;if("BatchPlacement"===i.type){var o=i.objects;if(0===o.length)return;n.node.remove(i.mesh);var a=i.transformations,s=i.resource.modelID;i.resource.model.updateMatrixWorld();for(var l=app.create({type:"BatchObject",nodeOverride:!1,node:i.resource.model,initBatchNum:o.length,parent:n}),u=0;u<o.length;u++){var c=o[u],h=r.calMatrixs(a[u]),p=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Quaternion;h.decompose(p,f,d);var m=p.toArray(),g=d.toArray(),v=new THREE.Euler;v.setFromQuaternion(f);var y=v.toArray();y[0]*=180/Math.PI,y[1]*=180/Math.PI,y[2]*=180/Math.PI;var b=r.getSubObjectParams(c);b.localPosition=m,b.scale=g,b.angles=y,b.parent=n;l.createSubObject(b)}r.addSfStyle(l.node,r.isTree(s)?"Thing-树":"Thing")}},t.prototype.getSubObjectParams=function(e){var t={uuid:e.id};return null!==e.userID&&(t.id=e.userID),null!==e.name&&(t.name=e.name),null!==e.properties&&(t.properties=e.properties),t},t.prototype.getMeshes=function(e){var t=[];return e.traverse((function(e){e.isMesh&&t.push(e)})),t},t.prototype.addSfStyle=function(e,t){var n=this.getMeshes(e);if(n&&n.length>0)for(var i=0;i<n.length;i++){n[i]._sfStyle=t}},t.prototype.isTree=function(e){return!!io[e]},t.prototype.calMatrixs=function(e){for(var t=new THREE.Matrix4,n=e.positions.length-1;n>-1;n--){var i=e.positions[n],r=e.quaternions[n],o=e.scales[n],a=new THREE.Vector3(i[0],i[1],i[2]),s=new THREE.Quaternion(r[0],r[1],r[2],r[3]),l=new THREE.Vector3(o[0],o[1],o[2]),u=new THREE.Matrix4;u.compose(a,s,l),t.premultiply(u)}return t},t}(zo),aa=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype.parseWorld=function(e,t){var n=null;this.resourceManager=t;this.initEvents();n=this.enableProxima?new ia(this.app):new na(this.app),null!==this.campus&&n.addCreatedThingjsObject(e,this.campus),this.creatorManager=new ro({app:this.app,config:n,events:this.events});var i=this.parseJson2meshObject(e);return this.processHideObjects(i),i},t.prototype.initEvents=function(){var e=this.events;this.enableDynamicLoad&&e.push(new Uo),e.push(new ra(this.app)),e.push(new oa(this.app)),e.push(new qo),e.push(new Go),e.push(new Xo({app:this.app,resourceManager:this.resourceManager})),e.push(new Wo({app:this.app,resourceManager:this.resourceManager}))},t}(Yo),sa=function(){function e(t,n){r(this,e),this.app=t,this.resourceUrl=null,this.relativeResourceUrl=null,this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.tempTexture=null,this.indexJson=n,this.sceneJsonUri="scene.json",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallTexture=null,this.defaultCeilingTexture=null,this.defaultFloorTexture=null,this.defaultRoofTexture=null,this.defaultWallEdgeTexture=null,this.worldNode=new THREE.Object3D("world"),this.isCamFitScene=!0,this.campus=null,this.outdoorsVisible=!0,this.campusVisible=!0,this.enableUseHighestVersionResource=!0,this.enableDownloadSceneJsonCache=!0,this.enableDynamicLoad=!1,this.enableProxima=!1,this.enableBatchObject=!1;this.worldNode;(n&&(n.position&&(this.campusPosition=n.position),n.rotation&&(this.campusRotation=n.rotation),void 0!==n.isCamFitScene&&null!==n.isCamFitScene&&(this.isCamFitScene=n.isCamFitScene),n.scale&&(this.campusScale=n.scale),void 0!==n.outdoorsVisible&&(this.outdoorsVisible=n.outdoorsVisible),void 0!==n.campusVisible&&(this.campusVisible=n.campusVisible),n.campus&&(this.campus=n.campus),void 0!==n.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=n.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),void 0!==n.enableDownloadSceneJsonCache&&(this.enableDownloadSceneJsonCache=n.enableDownloadSceneJsonCache),n.enableDynamicLoadScene&&(this.enableDynamicLoad=n.enableDynamicLoadScene),n.enableProxima&&(this.enableProxima=n.enableProxima),n.startDownloadResourcesCallback&&(this.startDownloadResourcesCallback=n.startDownloadResourcesCallback)),this.campus&&(this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale)),n.default)&&(n.default.sceneJson&&(this.sceneJson="export.json"));void 0!==this.app.options.enableBatchObject&&this.app.options.enableBatchObject&&(json2mesh.DefaultSetting.enableBatchObject=!0,this.enableBatchObject=this.app.options.enableBatchObject),this.app.options.loaderResourceUrl&&(this.resourceUrl=this.app.options.loaderResourceUrl),this.app.options.resourceLibraryUrl&&(this.resourceUrl=this.app.options.resourceLibraryUrl),this.indexJson.resourceLibrary&&(this.relativeResourceUrl=this.indexJson.resourceLibrary),this.enableDownloadSceneJsonCache||(this.sceneJsonUri+="?_t="+(new Date).getTime()),this.json2meshToThingjsParser=null,this.LoaderClass=json2mesh.Max2TjsLoader,this.app.level.options={autoBakeFloor:!1}}return e.prototype.parseCamInfo=function(e){var t=e.eye,n=e.target,i=t.split(" "),r=n.split(" "),o=[Number(i[0]),Number(i[1]),Number(i[2])];o[2]=-o[2];var a=[Number(r[0]),Number(r[1]),Number(r[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.load=function(e){var t=this;if(t.json2meshToThingjsParser=new aa(t.app),t.enableProxima&&(t.json2meshToThingjsParser.enableProxima=!0,json2mesh.DefaultSetting.enableCombinePlacementsByRoom=!0),t.json2meshToThingjsParser.events.push(new $o),"String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var n=e;this.sceneURL=n.url,n.campus&&(this.campus=n.campus,this.worldNode=this.campus.node,this.json2meshToThingjsParser.setCampus(this.campus))}return this.relativeResourceUrl&&(0===this.relativeResourceUrl.indexOf("./")?this.resourceUrl=this.sceneURL+this.relativeResourceUrl.replace("./","/"):this.resourceUrl=this.relativeResourceUrl),new Promise((function(e,n){t.updateProgress(.1),t.loadSceneJson().then((function(n){t.sceneJsonString=n,t.sceneJson=JSON.parse(n),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.updateProgress(.1);var i=new t.LoaderClass;t.enableDynamicLoad&&(i.enableRequestWorld=!1,t.json2meshToThingjsParser.enableDynamicLoad=!0),t.resourceUrl&&(i.resourceManager.baseTextureUrl=t.resourceUrl+"/texture/",i.resourceManager.baseModelUrl=t.resourceUrl+"/model/"),t.loader=i,t.world=i.load({json:t.sceneJson,customModeBaseUrl:t.sceneURL+"/",bigVersion:t.indexJson.bigVersion,smallVersion:t.indexJson.smallVersion});var r=t.world;(new no).parseWorld(r),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.campus&&(t.campus.visible=t.campusVisible),t.campusRotation&&t.campus.node.quaternion.set(t.campusRotation.x,t.campusRotation.y,t.campusRotation.z,t.campusRotation.w),t.campusPosition&&(t.campus.position=t.campusPosition),t.campusScale&&(t.campus.scale=t.campusScale),t.startDownloadResourcesCallback&&t.startDownloadResourcesCallback(i.resourceManager.models,i.resourceManager.textures),t.campus=t.json2meshToThingjsParser.parseWorld(r,i.resourceManager),t.enableDynamicLoad?(t.loadExtraData(t.campus),t.updateProgress(1),e(t.campus)):i.startToBuild((function(n){t.updateProgress(.1+.9*n),1===n&&(t.updateProgress(1),t.loadExtraData(t.campus),e(t.campus))}))}))}))},e.prototype.setTransformInfo=function(e){},e.prototype.loadExtraData=function(e){this.sceneJson.extraData&&(e.extraData=this.sceneJson.extraData)},e.prototype.loadSceneJson=function(){var e=this;return new Promise((function(t,n){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL+"/"+e.sceneJsonUri,(function(e){t(e)}))}))},e.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess({object:this.campus,progress:e})},e.prototype.startToDownloadRequestResources=function(e){this.loader.startToDownloadRequestResources(e)},e.prototype.addResourceDownloadRequest=function(e){this.loader.resourceManager.addResourceDownloadRequest(e)},e.prototype.clearAllResources=function(){this.loader.resourceManager.disposeModels(),this.loader.resourceManager.disposeTextures()},e.prototype.clearAllObjects=function(){this.world.clear()},e.prototype.requestToBuild=function(e){this.loader.requestToBuild(e)},e.prototype.startToBuild=function(e){return this.loader.startToBuild(e)},e.prototype.disposeObject=function(e){this.loader.disposeObject(e)},e.prototype.findObjectByID=function(e){return this.world.findObjectByID(e)},e}(),la=function(e){function t(n,i){r(this,t);var o=s(this,e.call(this,n,i));return o.LoaderClass=json2mesh.Bim2TjsLoader,o}return a(t,e),t}(sa),ua=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype.parseWorld=function(e,t){var n=null;this.resourceManager=t;this.initEvents();n=this.enableProxima?new Ho(this.app):new jo(this.app),null!==this.campus&&n.addCreatedThingjsObject(e,this.campus),this.creatorManager=new ro({app:this.app,config:n,events:this.events});var i=this.parseJson2meshObject(e);return this.processHideObjects(i),i},t.prototype.initEvents=function(){var e=this.events;this.enableDynamicLoad&&e.push(new Uo),this.enableBatchObject&&e.push(new BatchCombinePlacementEvent(this.app)),e.push(new qo),e.push(new Go),e.push(new Xo({app:this.app,resourceManager:this.resourceManager})),e.push(new Wo({app:this.app,resourceManager:this.resourceManager}))},t}(Yo),ca=function(){function e(t,n){r(this,e),this.app=t,this.resourceUrl=null,this.relativeResourceUrl=null,this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.tempTexture=null,this.indexJson=n,this.sceneJsonUri="scene.json",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallTexture=null,this.defaultCeilingTexture=null,this.defaultFloorTexture=null,this.defaultRoofTexture=null,this.defaultWallEdgeTexture=null,this.worldNode=new THREE.Object3D("world"),this.isCamFitScene=!0,this.campus=null,this.outdoorsVisible=!0,this.campusVisible=!0,this.enableUseHighestVersionResource=!0,this.enableDownloadSceneJsonCache=!0,this.enableDynamicLoad=!1,this.enableProxima=!1,this.enableBatchObject=!1;this.worldNode;if(n&&(n.position&&(this.campusPosition=n.position),n.rotation&&(this.campusRotation=n.rotation),void 0!==n.isCamFitScene&&null!==n.isCamFitScene&&(this.isCamFitScene=n.isCamFitScene),n.scale&&(this.campusScale=n.scale),void 0!==n.outdoorsVisible&&(this.outdoorsVisible=n.outdoorsVisible),void 0!==n.campusVisible&&(this.campusVisible=n.campusVisible),n.campus&&(this.campus=n.campus),n.enableDynamicLoadScene&&(this.enableDynamicLoad=n.enableDynamicLoadScene),n.enableProxima&&(this.enableProxima=n.enableProxima),n.enableBatchObject&&(this.enableBatchObject=n.enableBatchObject),void 0!==n.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=n.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),void 0!==n.enableDownloadSceneJsonCache&&(this.enableDownloadSceneJsonCache=n.enableDownloadSceneJsonCache),n.startDownloadResourcesCallback&&(this.startDownloadResourcesCallback=n.startDownloadResourcesCallback)),this.campus&&(this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale)),n.default){var i=n.default;i.sceneJson&&(this.sceneJson="export.json"),i.wallTexture&&(this.defaultWallTextureUri=i.wallTexture),i.wallEdgeTexture&&(this.defaultWallEdgeTextureUri=i.wallEdgeTexture),i.floorTexture&&(this.defaultFloorTextureUri=i.floorTexture),i.ceilingTexture&&(this.defaultCeilingTextureUri=i.ceilingTexture),i.roofTexture&&(this.defaultRoofTextureUri=i.roofTexture)}this.app.options.loaderResourceUrl&&(this.resourceUrl=this.app.options.loaderResourceUrl),void 0!==this.app.options.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=this.app.options.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),void 0!==this.app.options.enableBatchObject&&this.app.options.enableBatchObject&&(json2mesh.DefaultSetting.enableCombinePlacementToBuildMesh=!1,this.enableBatchObject=this.app.options.enableBatchObject),this.app.options.resourceLibraryUrl&&(this.resourceUrl=this.app.options.resourceLibraryUrl),this.indexJson.resourceLibrary&&(this.relativeResourceUrl=this.indexJson.resourceLibrary),this.enableDownloadSceneJsonCache||(this.sceneJsonUri+="?_t="+(new Date).getTime()),this.json2meshToThingjsParser=null}return e.prototype.parseCamInfo=function(e){var t=e.eye,n=e.target,i=t.split(" "),r=n.split(" "),o=[Number(i[0]),Number(i[1]),Number(i[2])];o[2]=-o[2];var a=[Number(r[0]),Number(r[1]),Number(r[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.load=function(e){var t=this;if(t.json2meshToThingjsParser=new ua(t.app),t.enableProxima&&(t.json2meshToThingjsParser.enableProxima=!0,json2mesh.DefaultSetting.enableCombinePlacementsByRoom=!0),t.enableBatchObject&&(t.json2meshToThingjsParser.enableBatchObject=t.enableBatchObject),"String"===e.constructor.name)this.sceneURL=e;else if("Object"===e.constructor.name){var n=e;this.sceneURL=n.url,n.campus&&(this.campus=n.campus,this.worldNode=this.campus.node,this.json2meshToThingjsParser.setCampus(this.campus))}return this.relativeResourceUrl&&(0===this.relativeResourceUrl.indexOf("./")?this.resourceUrl=this.sceneURL+this.relativeResourceUrl.replace("./","/"):this.resourceUrl=this.relativeResourceUrl),new Promise((function(e,n){t.updateProgress(.1),t.loadSceneJson().then((function(n){t.sceneJsonString=n,t.sceneJson=JSON.parse(n),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.updateProgress(.1);var i=new json2mesh.MixTjsLoader;void 0!==t.app.options.loadingSceneMaxResourcesUnitDownloadNumber&&i.setResourcesUnitDownloadNumber(t.app.options.loadingSceneMaxResourcesUnitDownloadNumber),void 0!==t.app.options.loadingSceneAwaitToNextBuildTime&&(i.dynamicBuildManager.awaitToNextBuildTime=t.app.options.loadingSceneAwaitToNextBuildTime),t.enableDynamicLoad&&(i.enableRequestWorld=!1,t.json2meshToThingjsParser.enableDynamicLoad=!0),t.resourceUrl&&(i.resourceManager.baseTextureUrl=t.resourceUrl+"/texture/",i.resourceManager.baseModelUrl=t.resourceUrl+"/model/"),t.loader=i,i.load({json:t.sceneJson,customModeBaseUrl:t.sceneURL+"/",version:0}).then((function(n){var r=new no;r.parseWorld(n),r.clear(),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.campus.visible=t.campusVisible,t.campusRotation&&t.campus.node.quaternion.set(t.campusRotation.x,t.campusRotation.y,t.campusRotation.z,t.campusRotation.w),t.campusPosition&&(t.campus.position=t.campusPosition),t.campusScale&&(t.campus.scale=t.campusScale),t.startDownloadResourcesCallback&&t.startDownloadResourcesCallback(i.resourceManager.models,i.resourceManager.textures),t.campus=t.json2meshToThingjsParser.parseWorld(n,i.resourceManager),t.enableDynamicLoad?(t.loadExtraData(t.campus),t.updateProgress(1),e(t.campus)):i.startToBuild((function(n){t.updateProgress(.1+.9*n),1===n&&(t.updateProgress(1),t.loadExtraData(t.campus),e(t.campus))}))}))}))}))},e.prototype.loadExtraData=function(e){this.sceneJson.extraData&&(e.extraData=this.sceneJson.extraData)},e.prototype.loadSceneJson=function(){var e=this;return new Promise((function(t,n){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL+"/"+e.sceneJsonUri,(function(e){t(e)}))}))},e.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess({object:this.campus,progress:e})},e.prototype.startToDownloadRequestResources=function(e){this.loader.resourceManager.startToDownloadRequestResources(e)},e.prototype.addResourceDownloadRequest=function(e){this.loader.resourceManager.addResourceDownloadRequest(e)},e.prototype.clearAllResources=function(){this.clear()},e.prototype.clearAllObjects=function(){this.world.clear(),this.world=null},e.prototype.clear=function(){this.loader.clearAllResources(),this.json2meshToThingjsParser.clear(),this.resourceUrl=null,this.relativeResourceUrl=null,this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.tempTexture=null,this.indexJson=null,this.sceneJsonUri=null,this.defaultWallTextureUri=null,this.defaultWallEdgeTextureUri=null,this.defaultFloorTextureUri=null,this.defaultCeilingTextureUri=null,this.defaultRoofTextureUri=null,this.defaultWallTexture=null,this.defaultCeilingTexture=null,this.defaultFloorTexture=null,this.defaultRoofTexture=null,this.defaultWallEdgeTexture=null,this.worldNode=new THREE.Object3D("world"),this.isCamFitScene=!0,this.campus=null,this.outdoorsVisible=!0,this.campusVisible=!0,this.enableUseHighestVersionResource=!0,this.enableDownloadSceneJsonCache=!0,this.enableDynamicLoad=!1,this.enableProxima=!1,this.enableBatchObject=!1},e.prototype.requestToBuild=function(e){this.loader.requestToBuild(e)},e.prototype.startToBuild=function(e){return this.loader.startToBuild(e)},e.prototype.disposeObject=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.loader.disposeObject(e,t)},e.prototype.findObjectByID=function(e){return this.world.findObjectByID(e)},e}(),ha=function(){function e(t){r(this,e),this.app=t,this.supportVersion={1:1,2:1,3:0},this.versionLib={1:{0:{0:to},1:{0:Zo}},2:{0:{0:Kr},1:{0:$r,1:eo}},3:{0:Qo,1:Ko},5:{0:{0:sa,1:sa,2:sa}},6:{0:{0:la}},7:{0:{0:ca}}}}return e.prototype.getLoader=function(e){if(e){var t=e.version,n=0,i=0,r=0;if(t){var o=t.split(".");n=parseInt(o[0]),i=parseInt(o[1]),r=parseInt(o[2])}var a=null,s=this.versionLib[n];if(s)if(3===n)a=s[i];else{var l=s[i];l&&(a=l[r])}if(!a)return console.error("can not find right version "+t+" to load scenejson"),null;if(1===n)h=new a(this.app);else if(2===n)switch(i){case 1:var u={},c=e.position;c&&(u.position=c),e.rotation&&(u.rotation=e.rotation),e.campus&&(u.campus=e.campus),u.isCamFitScene=Ne.parseValue(e.isCamFitScene,!0),u.isDelayLoadFloorPlan=Ne.parseValue(e.isDelayLoadFloorPlan,!1),h=new a(this.app,u);break;default:h=new a(this.app)}else 3===n?(e.version=i,h=new a(this.app,e)):(5===n||6===n||7===n)&&(e.bigVersion=i,e.smallVersion=r,h=new a(this.app,e));return h}var h=new to(this.app);return h},e}(),pa=!1,da=void 0,fa=function(){function e(t){r(this,e),this.app=t,this.waitingLoadCampuses=[],this.loadingCampus=!1}return e.prototype._loadViewPointFile=function(e){var t=this.app.sceneManager,n=Ne.parseValue(e.enableDeafultViewPointFile,t.enableDeafultViewPointFile),i=e.defaultViewPointFileName||t.defaultViewPointFileName;if(n&&i){var r=e.url.appendPath(i),o=this;(new THREE.FileLoader).load(r,(function(e){o.app.viewPointManger.loadJSON(e)}))}},e.prototype._runScript=function(e){var t;(t=Ne.isString(e)?e:function(e){return L?L.decodeString(e):""}(e))&&_e(t)},e.prototype.loadFromUBuilder=function(e,t,n,i,r){var o=this,a=i.position,s=i.rotation||i.angles,l=i.scale,u=Ne.parseValue(i.outdoorsVisible||i.visible,!0),c=Ne.parseValue(i.campusVisible||i.visible,!0),h=Ne.parseValue(i.isCamFitScene,!0),p=Ne.parseValue(i.isDelayLoadFloorPlan,!1),d=i.splitLoadSpeed,f=Ne.parseValue(i.disableCache,!1),m=Ne.parseValue(i.dynamic,!1),g=Ne.parseValue(i.enableProxima,!1),v=Ne.parseValue(i.enableBatchObject,!1);a&&(n.position=a),s&&(n.rotation=Ne.parseQuaternion(s)),l&&(n.scale=l),void 0!==u&&(n.outdoorsVisible=u),void 0!==c&&(n.campusVisible=c),n.isCamFitScene=h,n.isDelayLoadFloorPlan=p,n.enableDownloadSceneJsonCache=!f,n.isDynamicLoadScene=Ne.parseValue(m,n.isDynamicLoadScene),n.enableDynamicLoadScene=n.isDynamicLoadScene,n.enableProxima=Ne.parseValue(g,n.enableProxima),n.enableBatchObject=Ne.parseValue(v,n.enableBatchObject);var y=new ha(this.app).getLoader(n);e._builder=y,y.loadSpeed=d;var b=n.camInfo;b&&(y.fitCamInfo=b),this.app.root._staticEnableFlag.lock(!1,"loadFromUBuilder"),y.load({campus:e,url:t}).then((function(e){var t=y.sceneJson?y.sceneJson:n,i=y.sceneJsonString;e.setSceneJSONData(t,i),e.position=e.position||a,e.angles=e.angles||s,r&&r(),o.app.root._staticEnableFlag.unlock("loadFromUBuilder")}))},e.prototype.loadFromCampusBuildier=function(e,t,n,i,r){CampusBuilderOnlineLoader.init({app:this.app}),CampusBuilderOnlineLoader.getLoader().load(e,t,n,i,r)},e.prototype._loadCampusFinished=function(e,t){e._processModel(),this._loadViewPointFile(t),this.app._lightGroup.setConfig({}),this._removeTypeMap(t),console.log("ThingJS: "+THING.VERSION)},e.prototype._convertOutdoorsToGround=function(e){if(e.outdoors){var t=e.outdoors.node;t.userData={},t.removeBySelf();var n=e.outdoors.id,i=e.outdoors.uuid,r=this.app.create({type:"Ground",id:n,uuid:i,node:t,visible:e.outdoors.visible,parent:e.outdoors.parent});e.outdoors.query("*",!1).not(".CombinedObject").forEach((function(t){e.add(t)})),e.outdoors.query(".CombinedObject",!1).forEach((function(e){r.add(e)})),e.outdoors.node=new THREE.Group,e.outdoors._children.clear(),e.outdoors.destroy(),e.outdoors=r}},e.prototype._loadFinished=function(e,t){var n=this,i=t.complete;if(t.complete=function(e){e.object._synEffectRefCounts(),n._loadCampusFinished(e.object,t),i&&i.call(e.object,e)},n._convertOutdoorsToGround(e),e.setupID(t),e instanceof Ht?(t.parent=t.parent||this.app.root,e._setup(t)):e instanceof Buliding&&e._setup(t),e._originalSceneString){var r=Ne._getStringMD5Code(e._originalSceneString);(da=function(e){var t=I.a;if(t){var n=t.sd5;if(n&&-1===n.indexOf(e))return!1}return!0}(r))||e.destroy()}},e.prototype.load=function(e,t){var n=this,i=this.app.confirmURL(t.url),r=i.appendPath("index.json");Ne.parseValue(t.disableCache,!1)&&(r=r.appendRandomSuffix()),(t.fileloader||new THREE.FileLoader).load(r,(function(r){var o=JSON.parse(r);if(q){var a=new Nt(o.version);a.major<4||a.major>4?n.waitingLoadCampuses.push({owner:e,url:i,indexJson:o,params:t}):n.loadCampus(e,i,o,t)}else n.waitingLoadCampuses.push({owner:e,url:i,indexJson:o,params:t})}),(function(){}),(function(){var r=t.error||t.errorCallback;r&&r({url:i}),new ha(n.app).getLoader().load({campus:e,url:i}).then((function(e){n._loadFinished(e,t)}))})),e.setupParent(t),t.skipSetupParent=!0},e.prototype._setupTypeMap=function(e){var t=e.typeMap;if(t)for(var n=0;n<t.length;n++){var i=t[n];Ne.addCastType(i.type,i.condition,i.params)}},e.prototype._removeTypeMap=function(e){var t=e.typeMap;if(t)for(var n=0;n<t.length;n++){var i=t[n];Ne.removeCastType(i.type,i.condition,i.params)}},e.prototype.loadCampus=function(e,t,n,i){var r=this,o=function(e,t){e.trigger("afterload"),r._loadFinished(e,t),r.loadingCampus=!1,e.loaded=!0,setTimeout((function(){r.app.trigger("campusready",{object:e})}),500)};n.resourceLibrary=i.loadResourceUrl||n.resourceLibrary,n.enableUseHighestVersionResource=i.enableUseHighestVersionResource,n.startDownloadResourcesCallback=function(e,t){var n=r.app.onLoadModelResourceCallback;n&&n(e,t)},this.loadingCampus=!0,json2mesh.DefaultSetting.enableFloorLightMap=Ne.parseValue(i.enableFloorLightMap,!1),i.indexJson=n,e.trigger(O.BeforeLoad,i),this.app.loadingProgressBar.prepare(),this._setupTypeMap(i),e.loading=!0;var a=new Nt(n.version);if("BIM"==n.type){var s=n.resources||{},l=Object.keys(s);if(l.length){var u=new THREE.IFCLoader(e);e._builder=u,u.load(t.appendPath(l[0]).appendPath("/"),(function(t){o(e,i)}),(function(e){r.app.loadingProgressBar.updateProgress(e),r.app.trigger("progress",{progress:e})}))}}else e._version=a,a.major<4||a.major>4?this.loadFromUBuilder(e,t,n,i,(function(){o(e,i)})):this.loadFromCampusBuildier(e,t,n,i,(function(){o(e,i)}))},e.prototype.update=function(){if(q&&!this.loadingCampus)if(le=le||c.toStr([96,201,170,234,66,62,13,241,82,4,65,42,195,156,129,103,23,224,109,153,106]),THING[le]||Z){for(var e=0;e<this.waitingLoadCampuses.length;e++){var t=this.waitingLoadCampuses[e];this.loadCampus(t.owner,t.url,t.indexJson,t.params),this.waitingLoadCampuses.splice(e,1)}void 0!==da&&(da?this.app.trigger("sceneMD5CheckSuccessed"):this.app.trigger("sceneMD5CheckFailed"),da=void 0)}else if(!pa){var n={t:(new Date).toUTCString(),v:Math.random()},i=JSON.stringify(n),r={"Content-type":"application/x-www-form-urlencoded"},o=c.toStr([96,201,174,231,66,51,32,235,92,3,108,33,253,138,129,102,17,202,118,180,116,65,157,101,253,161]),a=THING[o]||{};for(var s in a)r[s]=a[s];re(i,r),pa=!0}},e.prototype._buildCampusStructure=function(e,t){t.app=this.app,t.type=e.type,t.name=e.name?e.name:e.id,t.id=e.id?e.id:e.uuid,t.uuid=e.uuid,t.userData=e.userData,t.children=[],t.getAttribute=function(e){return Ne.getAttribute(this,e)},t.getPath=function(){for(var e=this.id,t=this.parent;t&&t.parent&&t.parent.parent;)e=t.id+"/"+e,t=t.parent;return e},t._traverseObjects=function(e,t){for(var n=0;n<this.children.length;n++){var i=this.children[n];Ne.isFunction(e)?e(i):Ne.isArray(e)&&e.push(i),t&&i._traverseObjects(e,t)}},t.query=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[];this._traverseObjects(n,t);var i=new gt(this.app,n);return i.select(e),i};var n=0;e instanceof THING.Floor&&(n=1);for(var i=n;i<e.children.length;i++){var r=e.children[i],o={id:r.id,parent:t};t.children.push(o),this._buildCampusStructure(r,o)}},e.prototype._peekJSONBySimpleLoader=function(e,t,n){var i=n.complete,r=n.errorCallback||n.error,o=this;t.load(e).then((function(t){var n={url:e,id:t.id,children:[]};o._buildCampusStructure(t,n),t.destroy(),i&&i(n)})).catch((function(e){console.error(e),r&&r()}))},e.prototype.peekJSON=function(e,t){t=t||{};var n=(e=this.app.confirmURL(e)).appendPath("index.json");Ne.parseValue(t.disableCache,!1)&&(n=n.appendRandomSuffix());var i=t.fileloader||new THREE.FileLoader,r=this;i.load(n,(function(n){var i=JSON.parse(n),o=new Nt(i.version);4==o.major||(3==o.major?r._peekJSONBySimpleLoader(e,new Hr(r.app),t):r._peekJSONBySimpleLoader(e,new Nr(r.app),t))}),(function(){}),(function(){r._peekJSONBySimpleLoader(e,new Nr(r.app),t)}))},e.prototype.onUpdate=function(e){this.update(e)},e}(),ma=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._graph=null,i._expanded=!1,i._structShow=!1,i}return a(t,e),t.prototype._canAcceptMouseEvent=function(e){var t=e.type;return!!x[t]},t.prototype.canAcceptEvent=function(t){if(e.prototype.canAcceptEvent.call(this,t))return this;var n=t.object;if(n&&n.isChildOf(this)){if(n.isFloor&&this._canAcceptMouseEvent(t))return this;if(n.isFacade&&this._canAcceptMouseEvent(t))return this;if(n.parent){if(n.parent.isFloor&&this._canAcceptMouseEvent(t))return this;if(n.parent.isFacade&&this._canAcceptMouseEvent(t))return this}}return null},t.prototype._addFromCampus=function(e){if(e.buildings.length){this.floors.destroy();var t=e.buildings[0].floors,n=this;t.forEach((function(e){n.add(e)}))}},t.prototype.loadResource=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?e.prototype.loadResource.call(this,t):this.floors.forEach((function(e){e.loadResource(!1)}))},t.prototype.unloadResource=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?e.prototype.unloadResource.call(this,t):this.floors.forEach((function(e){e.unloadResource()}))},t.prototype.setupElevators=function(){var e={};for(var t in this.query(".ElevatorDoor").forEach((function(t){var n=t.userData._ELEVATOR_;e[n]||(e[n]=[]),e[n].push(t)})),e){var n=e[t];this.app.create({type:"Elevator",name:t,parent:this,doors:n})}},t.prototype.setupStairs=function(){this.query("[type=stairway]").forEach((function(e){e.floorNode.visible=!1}));var e={};for(var t in this.query(".StairDoor").forEach((function(t){var n=t.userData._STAIR_;e[n]=e[n]||[],e[n].push(t)})),e){var n=e[t];this.app.create({type:"Stair",name:t,parent:this,doors:n})}},t.prototype.canNavigation=function(){return!0},t.prototype.customSetup=function(e){this._structShow=Ne.parseValue(e.structShow,this._structShow)},t.prototype.setupNavigationObjects=function(){this.setupElevators(),this.setupStairs()},t.prototype.setupGraph=function(){if(this._graph)return this._graph;var e={};return this.floors.forEach((function(t){t._setupNavigationGraph(e,1e4)})),this._graph=new Graph(e),this._graph},t.prototype.destroy=function(){this._graph=null,e.prototype.destroy.call(this)},t.prototype.hasAnyFacadesVisible=function(){for(var e=this.facades,t=0;t<e.length;t++)if(e[t].visible)return!0;return!1},t.prototype.hasFacades=function(){return 0!==this.facades.length},t.prototype.showAllRoofs=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.floors.forEach((function(t){t.showAllRoofs(e)}))},t.prototype.expandFloors=function(e){e=e||{},this.expandCmd||(this.expandCmd=this.app.commandManager.create({type:"ExpandObjects"})),e.objects=this.floors.objects,e.hideRoof=Ne.parseValue(e.hideRoof,!0),this.expandCmd.setParam(e),this.expandCmd.execute(),this._expanded=!0},t.prototype.unexpandFloors=function(e){e=e||{},this.expandCmd&&(e.hideRoof&&(e.hideRoof=!e.hideRoof),this.expandCmd.setParam(e),this.expandCmd.undo(),this._expanded=!1)},t.prototype.showFacades=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[Building] Please use '.facades.visible=true/false' to replace '.showFacades()'"),this.facades.visible=e},t.prototype.showFloors=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[Building] Please use '.floors.visible=true/false' to replace '.showFloors()'"),this.floors.visible=e},t.prototype.showRoof=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[Building] Please use '.showAllRoofs()' to replace '.showRoof()'"),this.showAllRoofs(e)},o(t,[{key:"isBuilding",get:function(){return!0}},{key:"structShow",get:function(){return this._structShow}},{key:"expanded",get:function(){return this._expanded}},{key:"facade",get:function(){return this.query(".Facade",!1)[0]}},{key:"facades",get:function(){return this.query(".Facade",!1)}},{key:"elevators",get:function(){return this.query(".Elevator",!1)}},{key:"stairs",get:function(){return this.query(".Stair",!1)}},{key:"floors",get:function(){return this.query(".Floor",!1)}},{key:"things",get:function(){return this.query(".Thing",!1)}}]),t}(Lt),ga=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._ceilingNode=null,i._ceilingObject=null,i._roofNode=null,i._roofObject=null,i._floorNode=null,i._floorObject=null,i._auxiliaryInfo=null,i._textRegion=null,i._holes=[],i._points=[],i}return a(t,e),t.prototype._toPoints=function(e){return e.map((function(e){return e.isVector3?e.toArray():e}))},t.prototype._toHoles=function(e){return e.map((function(e){return e.map((function(e){return e.isVector3?e.toArray():e}))}))},t.prototype.setup=function(t){var n;(e.prototype.setup.call(this,t),this._holes=t.holes||[],this._points=t.points||[],this._holes=this._toHoles(this._holes),this._points=this._toPoints(this._points),this._ceilingNode=t.ceilingNode||this._ceilingNode,this._roofNode=t.roofNode||this._roofNode,this._auxiliaryInfo=t.auxiliaryInfo||this._auxiliaryInfo,this._floorNode=t.floorNode||this._floorNode,t.floorHideByScene&&this._floorNode)&&((n=this._floorNode.parent)&&(this.app.resourceManager.remove(this._floorNode),this._floorNode=new THREE.Group,n.add(this._floorNode)));t.roofHideByScene&&this._roofNode&&((n=this._roofNode.parent)&&(this.app.resourceManager.remove(this._roofNode),this._roofNode=new THREE.Group,n.add(this._roofNode)))},t.prototype.setupResources=function(t){e.prototype.setupResources.call(this,t),this._ceilingNode=t.ceilingNode||this._ceilingNode,this._roofNode=t.roofNode||this._roofNode,this._floorNode=t.floorNode||this._floorNode,this._ceilingNode&&this.ceiling&&(this._ceilingNode.visible=this.ceiling.visible,this.ceiling.node=this._ceilingNode),this._roofNode&&this.roof&&(this._roofNode.visible=this.roof.visible,this.roof.node=this._roofNode),this._floorNode&&this.plan&&(this._floorNode.visible=this.plan.visible,this.plan.node=this._floorNode)},t.prototype.getFloorMesh=function(){var e=this._floorNode;if(!e)return null;var t=e.getMeshes();return t.length?t[0]:null},t.prototype.getRoomHeight=function(){return 3},t.prototype.showGrid=function(t,n,i,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;e.prototype.showGrid.call(this,t,n,i,r,o,a);var s=Ne.parseVector3(this.labelPosition);this._grid._setWorldPosition(s,this.static)},t.prototype.getLabelPosition=function(e){var t=this.getFloorMesh();if(!t)return null;var n=t.getLabelPosition(e,"xz")||t.getLabelPosition(e,"xy");return n?n.toArray():null},t.prototype.getAvaliablePositions=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!Ne.isNumber(e))return null;var i=[];if(Ne.isArray(t[0]))for(var r=0;r<e;r++){var o=t[r];i.push(o)}else for(r=0;r<e;r++)i.push(t);var a=this.getFloorMesh();if(!a)return null;var s=a.getAvaliableLabelPosition(i,"xz",n);if(!s||s.length<e){var l=a.getAvaliableLabelPosition(i,"xy",n);l&&l.length>s.length&&(s=l)}for(r=0;r<s.length;r++)s[r]=s[r].toArray();return s},t.prototype.getRayCastPosition=function(e){if(!(e=Ne.parseVector3(e)))return null;var t=this.getFloorMesh();if(!t)return null;var n=t.getRayCastPosition(e);return n?n.toArray():null},t.prototype.getPoints=function(e){},t.prototype._synTextRegion=function(){if(this._textRegion){var e=this._textRegion.position;if(this.style._volumeNode){var t=new THREE.Vector3;this.style._volumeNode.getWorldPosition(t),e[1]=t.y}else e[1]=this.position[1];e[1]+=.01,this._textRegion.position=e}},t.prototype.getNavigationMesh=function(){var e=this._floorNode;if(!e)return null;if(!this.area)return null;var t=e.getMeshes();return t.length?t[0]:null},t.prototype._getChildVisibles=function(){var e=this.children.concat([this.roof,this.ceiling,this.plan]),t=[];return e.forEach((function(e){e&&t.push(e.visible)})),t},t.prototype._onGetChild=function(){return this.children.concat([this.roof,this.ceiling,this.plan])},t.prototype.setRelativePoints=function(e){e&&(this._points=e.slice(0))},t.prototype._getLinkableDoors=function(){var t=e.prototype._getLinkableDoors.call(this);return t.add(this.doors),t},t.prototype.showCeiling=function(e){console.warn("[Room] Please use '.ceiling.visible=true/false' to replace '.showCeiling()'"),this.ceiling.visible=e},t.prototype.showRoof=function(e){console.warn("[Room] Please use '.roof.visible=true/false' to replace '.showRoof()'"),this.roof.visible=e},t.prototype.showFloor=function(e){console.warn("[Room] Please use '.floorNode.visible=true/false' to replace '.showFloor()'"),this.floorNode.visible=e},t.prototype.showRoof=function(e){console.warn("[Room] Please use '.roof.visible=true/false' to replace '.showRoof()'"),this.roof.visible=e},t.prototype.setFloor=function(e){console.warn("[Room] Please use '.floorNode.style.' to replace '.setFloor()'"),e=e||{};var t=this.floorNode.style,n=e.color;n&&(t.color=n);var i=e.opacity;i&&(t.opacity=i)},t.prototype.getAvaliableFloorPos=function(e,t){return console.warn("[Room] Please use '.floor.getAvaliablePositions()' to replace '.getAvaliableFloorPos()'"),this.getAvaliablePositions(e,t)},o(t,[{key:"isRoom",get:function(){return!0}},{key:"labelPosition",get:function(){var e=this.getLabelPosition(null);if(e)return e;var t=this._auxiliaryInfo;return t&&t.center?t.center.toArray():null}},{key:"perimeter",get:function(){var e=this.points;return THING.Math.getPerimeter(e)}},{key:"area",get:function(){var e=this.points;return THING.Math.getArea(e)}},{key:"ceiling",get:function(){return!this._ceilingObject&&this._ceilingNode&&(this._ceilingObject=new Fr(this.app)._init(this._ceilingNode)),this._ceilingObject}},{key:"roof",get:function(){return!this._roofObject&&this._roofNode&&(this._roofObject=new Fr(this.app)._init(this._roofNode)),this._roofObject}},{key:"plan",get:function(){this._floorObject||this.getFloorMesh()&&(this._floorObject=new Fr(this.app)._init(this.getFloorMesh()));return this._floorObject}},{key:"misc",get:function(){return this.miscObject||(this.miscObject=this.query(".CombinedObject").query("[userData/type=CombineMiscParent]")[0]),this.miscObject}},{key:"floor",get:function(){return this.parents.query(".Floor")[0]}},{key:"points",get:function(){var e,t=this;if(this._points.length)e=this._points.map((function(e){return t.selfToWorld(e)}));else{var n=this.getFloorMesh();if(!n)return null;e=n.getPoints(),this.holes.forEach((function(t){t.forEach((function(t){for(var n=0;n<e.length;n++){var i=e[n];THING.Math.equalsVector(t,i)&&e.splice(n--,1)}}))}))}for(var i=0;i<e.length-1;i++)THING.Math.equalsVector(e[i],e[i+1])&&e.splice(i--,1);return e}},{key:"things",get:function(){var e=this.parent;if(!e)return new gt(this.app,[]);for(var t=[],n=e.things,i=0;i<n.length;i++){var r=n[i];this.getRayCastPosition(r.position)&&t.push(r)}return this._children.forEach((function(e){e.isBatchSubObject&&t.push(e)})),new gt(this.app,t,!0).buildReturnObject(t).add(this.query(".Thing"))}},{key:"doors",get:function(){for(var e=this.floor.doors,t=[],n=0;n<e.length;n++)for(var i=e[n],r=new THREE.Vector3,o=Ne.parseVector3(i.position),a=[Ne.parseVector3(i.forward)],s=0;s<a.length;s++){var l=a[s];if(l.multiplyScalar(1),r.addVectors(o,l),this.getRayCastPosition(r)||(l.multiplyScalar(-1),r.addVectors(o,l),this.getRayCastPosition(r))){t.push(i);break}}return new gt(this.app,t).buildReturnObject(t)}},{key:"textRegion",get:function(){return this._textRegion||(this._textRegion=this.app.create({type:"TextRegion",text:this.name,parent:this,position:this.labelPosition,angles:[-90,0,0]}),this._textRegion.translateY(.1),this._textRegion.renderOrder=1),this._synTextRegion(),this._textRegion},set:function(e){e?(this._textRegion=e,this._synTextRegion()):(this._textRegion.destroy(),this._textRegion=null)}},{key:"holes",get:function(){var e=[];if(this._holes){var t=this;this._holes.forEach((function(n){var i=[];n.forEach((function(e){i.push(t.selfToWorld(e))})),e.push(i)}))}return e}},{key:"floorIndex",get:function(){return console.warn("[Room] Please use '.floor.indexOfParent()' to replace '.floorIndex()'"),this.floor.indexOfParent()}},{key:"center",get:function(){return console.warn("[Room] Please use '.labelPosition' to replace '.center' or if you want to use .boundingBox.center to get center of boundingBox?"),this.labelPosition}},{key:"floorNode",get:function(){return console.warn("[Room] Please use '.plan' to replace '.floorNode'"),this.plan}}]),t}(Lt),va=document.createElement("canvas");va.width=256,va.height=1;var ya=va.getContext("2d");function ba(e,t){var n=ya.createLinearGradient(0,0,256,0);for(var i in e)n.addColorStop(+i,e[i]);ya.fillStyle=n,ya.fillRect(0,0,256,1);var r=new Uint8Array(ya.getImageData(0,0,256,1).data.buffer);return void 0!==t?t.image={data:r,width:256,height:1}:t=new THREE.DataTexture(r,256,1),t.magFilter=t.minFilter=THREE.LinearFilter,t.needsUpdate=!0,t}var _a=new Map,xa=new Map,Ea=new Map,wa=function(){function e(){r(this,e)}return e.register=function(e,t){_a.set(e,t),xa.set(e,function(e){var t={};for(var n in e){var i=n.split("-"),r=i[0];t[r]||(t[r]={});var o=i[1];void 0===o||t[r][o]||(t[r][o]={});var a=i[2];void 0!==a&&(t[r][o][a]={})}return t}(t.class)),Ea.set(e,function(e){var t=new Map;for(var n in e){var i=e[n].colormap;if(i){var r=void 0;t.has(n)&&(r=t.get(n)),t.set(n,ba(i,r))}}return t}(t.class))},e.findStyle=function(e,t,n){if(!_a.has(e)||!xa.has(e))return console.warn("StyleManager: style '"+e+"' not registed."),null;if(n&&n._sfStyle){var i=n._sfStyle;return{style:_a.get(e).class[i],colormap:Ea.get(e).get(i)}}if(t&&n){var r=function(e,t,n){var i=t.type,r="";if(!e[i])for(var o in e)THING.Utils.instanceOf(t,o)&&(i=o);if(!e[i])return"";for(var a in e[i]){var s=t.tags;if("Facade"===i&&t.building&&(s=t.building.tags),s.indexOf(a)>-1&&""!==a){r=a;break}}if(!e[i][r])return i;for(var l in e[i][r])if(n.name===l)return i+"-"+r+"-"+n.name;return i+(""!==r?"-"+r:"")}(xa.get(e),t,n);return{style:_a.get(e).class[r],colormap:Ea.get(e).get(r)}}return _a.get(e)},e}();var Ta=function(){function e(t){r(this,e),this.obj=t,this._renderOrder=0,this._opacity=null,this._color=null,this._outlineColor=null,this._alwaysOnTop=!1,this._wireframe=!1,this._glow=!1,this._innerGlow=!1,this._focusRegion=!1,this._image="",this._doubleSide=!1,this._uvAnimationParams=null,this._boundingBoxNode=null,this._orientedBoundingBoxNode=null,this._axisNode=null,this._vertexNormalNode=null,this._defaultOutlineColor=null,this._synStyle=null,this._inheritThemeName=null,this._themeName=null,this._edgeColor=null,this._edgeIncludeChildren=!0,this._edgeWireframes=new Map,this._emissive=null}return e.prototype._syn=function(){var e=this._synStyle;e&&(delete this._synStyle,e.execute(this.obj))},e.prototype._setSynValue=function(e,t){return!(!this.obj||!this.obj.app)&&(!this.obj.loaded&&(this._synStyle||(this._synStyle=this.obj.app.commandManager.create({type:"SetObjectStyle",object:this.obj})),this._synStyle.setAttribute(e,t),!0))},e.prototype._getSynValue=function(e){return this._synStyle?this.obj.loaded?null:this._synStyle.getAttribute(e):null},e.prototype._traverse=function(e){var t=[];this.obj.children.forEach((function(e){t.push(e.node)})),this.obj.node.traverseBranch((function(n){if(-1!==t.indexOf(n))return!1;n.userData.skipStyle||e(n)}))},e.prototype._onEnter=function(){},e.prototype._onLeave=function(){},e.prototype._changeMaterial=function(e){this._traverse((function(t){if(t.material){var n=t.material;Ne.isArray(n)?t.material=n.map((function(n){return e(n,t)})):t.material=e(n,t)}}))},e.prototype._cloneAndModifyMaterial=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments[2];n=n||function(e){return!e._mustClone&&(!t||!(!e._isCloned()||!e._getOriginal()))},this._changeMaterial((function(t,i){if(n(t))return e&&e(t._getPrevMaterial(),t,i),t;var r=t._pushAndCloneSelf();return e&&e(r._getPrevMaterial(),r,i),r}))},e.prototype.revertMaterial=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._changeMaterial((function(n){var i=t?n._getOriginal():n._getPrevMaterial();return i?(Ne.parseValue(THING.needDisposeMaterial,!0)&&e.obj.app.materialDisposeManager.push(n),i):(Ne.revertValue(n,"opacity"),Ne.revertValue(n,"color"),Ne.revertValue(n,"depthTest"),Ne.revertValue(n,"depthWrite"),Ne.revertValue(n,"onBeforeRender"),Ne.revertValue(n,"wireframe"),Ne.revertValue(n,"wireframeMap","map"),n)}))},e.prototype._applyTheme=function(e,t){var n=this;if(!this._skipApplyTheme&&(t||this._themeName!==e)){if(this._themeName=e||null,this.removeEdgeWireframe(),null==this._themeName)return this.revertMaterial(!0),this._setEffectRefCounts("smallGlow",!1),void this._setEffectRefCounts("middleGlow",!1);var i=this.opacity;this.color=null,this.setOpacity(null);var r=this.obj.app;this._cloneAndModifyMaterial((function(t,i,o){var a=wa.findStyle(e,n.obj,o);if(a){var s=a.style,l=a.colormap;if(s&&(void 0===s.enable||s.enable)){var u=void 0!==s.opacity?s.opacity:1;void 0!==s.useColormap?i.colorMapping=s.useColormap?l:null:i.colorMapping=l,i.opacity=u,i.transparent=t.transparent||u<1,i._mustClone=!0;var c=s.reflection;if(c&&c.enable){var h=wa.findStyle(e),p=r.baseURL+"/images/reflect1.jpg";h&&void 0!==h.resourcePrefix&&void 0!==h.enviroment&&(p=h.resourcePrefix+h.enviroment),i.envMap=function(e){var t=Sa.get(e);if(!t){t=new THREE.CubeTexture,(new THREE.ImageLoader).load(e,(function(e){t.images=[e,e,e,e,e,e],t.needsUpdate=!0})),t.format=THREE.RGBFormat,t.mapping=THREE.CubeReflectionMapping,Sa.set(e,t)}return t}(p),i.envMapIntensity=1.5,i.metalness=c.metalness,i.roughness=c.roughness}if(!!s.useScrollTex){!function(e,t){var n=e.getMatrixFromRoot(t),i=e.geometry;if(i&&!i.getAttribute("uv3")){for(var r=i.getAttribute("position"),o=new THREE.BufferAttribute(new Float32Array(2*r.count),2),a=new THREE.Vector3,s=-1/0,l=1/0,u=0;u<r.count;u++)a.fromArray(r.array,3*u).applyMatrix4(n),o.array[2*u+0]=.5,o.array[2*u+1]=a.y,s=Math.max(s,a.y),l=Math.min(l,a.y);for(var c=s-l,h=0;h<r.count;h++)o.array[2*h+1]=o.array[2*h+1]/c;i.addAttribute("uv3",o)}}(o,n.obj.node);var d=wa.findStyle(e),f=s.scrollTex;d&&void 0!==d.resourcePrefix&&(f=d.resourcePrefix+s.scrollTex),i.emissiveMap=function(e,t){var n=Ma.get(e);n||((n=(new THREE.TextureLoader).load(e)).wrapS=n.wrapT=THREE.RepeatWrapping,n.premultiplyAlpha=!0,n.__updateFunc=function(){n.offset.y-=.003,t.rendererManager.needUpdate=!0},t.on("update",n.__updateFunc),Ma.set(e,n));return n}(f,r),i.emissive&&i.emissive.set(s.scrollColor),i.emissiveIntensity=1,i.defines=i.defines||{},i.defines.USE_ALPHA_UV3=!0,i.defines.USE_EMISSIVETRANSFORM=!0,i.defines.USE_SIDE_EMISSIVE=!0}else i.emissiveIntensity=0;i.needsUpdate=!0}}})),this._traverse((function(t){if(t.geometry){var i=wa.findStyle(e,n.obj,t);if(i){var o=i.style;if(o&&(void 0===o.enable||o.enable)){o.glow?2==o.glow?(r.effectManager.removeEffect(t,"smallGlow"),t._cachedTechnique&&t._cachedTechnique.middleGlow?r.effectManager.setEffect(t,"middleGlow",1,"skip"==t._cachedTechnique.middleGlow):r.effectManager.removeEffect(t,"middleGlow")):(r.effectManager.setEffect(t,"smallGlow"),r.effectManager.removeEffect(t,"middleGlow")):(r.effectManager.removeEffect(t,"smallGlow"),r.effectManager.removeEffect(t,"middleGlow"));var a=o.wireframe.enable,s=o.wireframe.color,l=o.wireframe.glow,u=void 0!==o.wireframe.opacity?o.wireframe.opacity:.99;a&&n._setEdgeWireframe(t,l,s,u)}}}})),this.obj.static&&this.obj.node._synMatrixWorld(),this.setOpacity(i),r.needUpdate=!0}},e.prototype.isNeedRevertMaterials=function(){return!this.isNeedCloneMaterials()},e.prototype.isNeedCloneMaterials=function(){return!Ne.isNull(this._opacity)||(!Ne.isNull(this._color)||(!!this._alwaysOnTop||(!!this._wireframe||(!!this._image||!!this._uvAnimationParams))))},e.prototype.setOpacity=function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Ne.isNumber(e)&&(e=THING.Math.clamp(e,0,1)),Ne.isNull(this._opacity)&&Ne.isNull(e)||e!=this._opacity&&(1==e&&Ne.isNull(this._opacity)||(this._opacity=e,this.isNeedRevertMaterials()?this.revertMaterial():this._cloneAndModifyMaterial((function(e,n,i){var r=Ne.isNull(t._opacity)?1:t._opacity;n.opacity=r*e.opacity,e.alphaTest&&(n.alphaTest=r*e.alphaTest);var o=n.transparent;n.transparent=e.transparent||n.opacity<1,o!=n.transparent&&(n.needsUpdate=!0)}),n)))},e.prototype.setColor=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e){if(!(e=Ne.parseColor(e)))return;this._color=e,this._cloneAndModifyMaterial((function(t,n,i){Ne.backupValue(n,"color"),Ne.backupValue(n,"colorMapping"),n.color=e,n.colorMapping=null,n.needsUpdate=!0}),t)}else{if(!this.color)return;this._color=null,this.isNeedRevertMaterials()?this.revertMaterial():this._changeMaterial((function(e,t){return Ne.revertValue(e,"color"),Ne.revertValue(e,"colorMapping"),e.needsUpdate=!0,e}))}},e.prototype.setOutlineColor=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Ne.isNull(e))this._outlineColor&&(this._setEffectRefCounts("outline_0x"+this._outlineColor.getHexString(),!1),this.obj.node.traverse((function(e){e.layers.disable(1),delete e.userData.forceOutline})),this._outlineColor=null),this._defaultOutlineColor&&this._setEffectRefCounts("outline_0x"+this._defaultOutlineColor.getHexString(),!0);else{this._outlineColor&&this._setEffectRefCounts("outline_0x"+this._outlineColor.getHexString(),!1);e=Ne.parseColor(e);this._outlineColor=e,this._setEffectRefCounts("outline_0x"+e.getHexString(),!0),t&&(this.obj.node.ensureParentsVisible(!0),this.obj.node.visible=!0),this.obj.node.traverse((function(e){(t||e.ensureVisible())&&(e.isSprite||(e.layers.enable(1),t&&(e.visible=!0,e.userData.forceOutline=!0)))}))}this.obj.app.needEffectUpdate=!0},e.prototype.setDefaultOutlineColor=function(e){var t=Ne.parseColor(e);t?(this._defaultOutlineColor=t,this.outlineColor||this._setEffectRefCounts("outline_0x"+t.getHexString(),!0),this.obj.app.needEffectUpdate=!0):(this._defaultOutlineColor=null,this._clearAllOutlineColor(),this._outlineColor&&(this.outlineColor=this._outlineColor))},e.prototype.setSkipBoundingBox=function(e){this.obj.dirty=!0,this.obj.node.skipBoundingBox(e),this.obj.parents.forEach((function(e){e.boundingBoxControl.dirty=!0})),this.obj.dirty=!0},e.prototype._setNodesAttribute=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._traverse((function(i){!i.isRenderable()&&n||(i.userData[e]=t)}))},e.prototype._setAlwaysOnTop=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if((this.alwaysOnTop!=e||t)&&this.obj.node.parent)if(this._alwaysOnTop=e,e){this._cloneAndModifyMaterial((function(e,t,n){t.transparent=!0})),Ne.backupValue(this.obj.node,"parent");var n=new THREE.MeshStandardMaterial({transparent:!0,opacity:1e-4}),i=new THREE.Mesh(new THREE.Geometry,n);i.name="AlwaysOnTopRootMesh",i.frustumCulled=!1,i.renderOrder=THING.BaseStyle.cRenderOrderValueMask-1,i.onAfterRender=function(e){e.clearDepth()},this.obj.node.parent.add(i),this.obj.node.attachToParent(i,this.obj.app.scene,!0),this._traverse((function(e){e.renderOrder+=THING.BaseStyle.cRenderOrderValueMask}))}else{this.isNeedRevertMaterials()?this.revertMaterial():this._changeMaterial((function(e,t){return Ne.revertValue(e,"transparent"),e}));var r=Ne.getValue(this.obj.node,"parent",!0),o=this.obj.node.parent;o.removeBySelf(),r.add(this.obj.node),this._traverse((function(e){e.renderOrder-=THING.BaseStyle.cRenderOrderValueMask}))}},e.prototype.setAlwaysOnTop=function(e){this._setSynValue("alwaysOnTop",e)||this._setAlwaysOnTop(e)},e.prototype.setBoundingBox=function(e,t){if(e){if(!this._boundingBoxNode){this.obj.dirty=!0;var n=this.obj.getLocalBoundingBox().toBox();this._boundingBoxNode=new THREE.Box3Helper(n,16777215),this._boundingBoxNode.frustumCulled=!1,this._boundingBoxNode.name=this.obj.name+"_BoundingBox",this._boundingBoxNode.skipBoundingBox(!0)}this._boundingBoxNode.material.color=Ne.parseColor(t),this.obj.node.add(this._boundingBoxNode),this.obj.tickable=!0}else this.obj.app.resourceManager.remove(this._boundingBoxNode),this._boundingBoxNode=null;this._boundingBoxNode&&(this._boundingBoxNode.visible=e)},e.prototype.setOrientedBoundingBox=function(e,t){if(e){if(!this._orientedBoundingBoxNode){this.obj.dirty=!0;var n=this.obj.getLocalBoundingBox().toBox();this._orientedBoundingBoxNode=new THREE.Box3Helper(n,16777215),this._orientedBoundingBoxNode.frustumCulled=!1,this._orientedBoundingBoxNode.name=this.obj.name+"_OrientedBoundingBox",this._orientedBoundingBoxNode.skipBoundingBox(!0)}var i=this._orientedBoundingBoxNode.material;i.color=Ne.parseColor(t,i.color),this.obj.node.add(this._orientedBoundingBoxNode),this.obj.tickable=!0}else this.obj.app.resourceManager.remove(this._orientedBoundingBoxNode),this._orientedBoundingBoxNode=null;this._orientedBoundingBoxNode&&(this._orientedBoundingBoxNode.visible=e)},e.prototype.setVertexNormalHelper=function(e){if(e){this.obj.node.updateMatrixWorld();var t=new THREE.Matrix4;t.getInverse(this.obj.node.matrixWorld),this._vertexNormalNode=new THREE.Group,this._vertexNormalNode.name=this.obj.name+"_VertexNormal",this._vertexNormalNode.applyMatrix4(t);var n=this;this.obj.node.traverse((function(e){if(e.isMesh&&e.geometry){var t=new THREE.VertexNormalsHelper(e,1,16711680);n._vertexNormalNode.add(t)}})),this.obj.node.add(this._vertexNormalNode)}else this.obj.app.resourceManager.remove(this._vertexNormalNode),this._vertexNormalNode=null},e.prototype.setAxisHelper=function(e){if(e){this._axisNode=new THREE.AxesHelper(this.obj.boundingBox.radius),this._axisNode.name=this.obj.name+"_Axis";var t=this._axisNode.material;t.depthTest=!1,t.transparent=!0;var n=new THREE.Vector3;this.obj.node.getWorldScale(n),this._axisNode.scale.set(1/n.x,1/n.y,1/n.z),this.obj.node.add(this._axisNode)}else this.obj.app.resourceManager.remove(this._axisNode),this._axisNode=null},e.prototype._setEffectRefCounts=function(e,t,n){var i=this.obj.app.effectManager;t?this._traverse((function(t){t.userData&&t.userData.skipOutline&&e.indexOf("outline")>-1||t.isLineSegments||i.setEffect(t,e)})):this._traverse((function(t){!n&&t._cachedTechnique&&t._cachedTechnique[e]?i.setEffect(t,e,1,"skip"==t._cachedTechnique[e]):i.removeEffect(t,e)}))},e.prototype._clearAllOutlineColor=function(){var e=this.obj.app.effectManager;this._traverse((function(t){if(t.technique)for(var n in t.technique)t.technique[n]&&n.indexOf("outline")>-1&&e.removeEffect(t,n)}))},e.prototype.setGlow=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._glow=e,this._setEffectRefCounts("middleGlow",e,t)},e.prototype.setInnerGlow=function(e,t){this._innerGlow=e,this._setEffectRefCounts("innerGlow",e,t)},e.prototype.setLineBloom=function(e){this._lineBloom=e,this._setEffectRefCounts("lineBloom",e)},e.prototype.setRadialBlur=function(e){this._lineBloom=e,this._setEffectRefCounts("radialBlur",e)},e.prototype.setRadialBlur2=function(e){this._lineBloom=e,this._setEffectRefCounts("radialBlur2",e)},e.prototype.setRadialOffset=function(e){this._lineBloom=e,this._setEffectRefCounts("radialOffset",e)},e.prototype.setFocusRegion=function(e){this._focusRegion=e,this._setEffectRefCounts("focusRegion",e)},e.prototype.setEdgeWireframe=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments[2];this._edgeColor=Ne.parseColor(e),this.removeEdgeWireframe(),null!=e&&this._traverse((function(e){t._setEdgeWireframe(e,n,t._edgeColor,i)}))},e.prototype._setEdgeWireframe=function(e,t,n){var i=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;e.updateMatrixWorld();var o=this.obj.app.edgesGeometriesManager.getByObject(e,this.obj);if(null!==o)if(o.isBufferGeometry)this._createEdgeWireframe(o,n,t,r,e);else{var a=o.then((function(o){a._break||i._createEdgeWireframe(o,n,t,r,e)})).catch((function(e){0!==e.error&&console.warn(e.msg)}));this._edgeWireframes.set(e,a)}},e.prototype._createEdgeWireframe=function(e,t,n,i,r){var o=new THREE.LineSegments(e);return e.isInstancedBufferGeometry&&(o.material=new THREE.MeshBasicMaterial({}),o.material.defines=o.material.defines||{},o.material.defines.INSTANCED="",o.frustumCulled=!1),o.name="wireframeNode"+t+n,o.material.color.set(t),o.material.opacity=i,o.material.transparent=i<1,o.renderOrder=r.renderOrder+.01,o.isEdgeWireframe=!0,n?this.obj.app.effectManager.setEffect(o,"smallGlow"):this.obj.app.effectManager.removeEffect(o,"smallGlow"),this._edgeWireframes.set(r,o),r.add(o),this.obj.static&&this.obj.node._synMatrixWorld(),o},e.prototype.removeEdgeWireframe=function(){var e=this;this._edgeWireframes.forEach((function(t){t.isObject3D?(e.obj.app.effectManager.clearAllEffects(t),e.obj.app.resourceManager.remove(t)):t._break=!0})),this._edgeWireframes.clear()},e.prototype.setImage=function(e){var t=this;if(this.image!=e)if(e){var n=void 0;if(Ne.isString(e)){var i=this.obj.app.confirmURL(e);if(this.image==i)return;this._image=i,n=this.obj.app.resourceManager.loadTexture(i,(function(){t.obj&&(t.obj.app.needUpdate=!0)}))}else e.width&&e.height&&(n=this.obj.app.resourceManager.loadTexture(e,(function(){t.obj&&(t.obj.app.needUpdate=!0)})));if(!n)return;this._cloneAndModifyMaterial((function(e,t,i){Ne.backupValue(t,"map"),t.map=n}))}else this._image="",this.isNeedRevertMaterials()?this.revertMaterial():this._changeMaterial((function(e,t){return Ne.revertValue(e,"map"),e}))},e.prototype.flipOutlineColor=function(e){e=Ne.parseColor(e).getHex();var t=this.outlineColor;this.outlineColor=t&&t==e?null:e},e.prototype.setLightMap=function(e){var t=(e=e||{}).intensity||0,n=Ne.parseColor(e.color,new THREE.Color),i=e.image;i&&(i=this.obj.app.resourceManager.loadTexture(this.obj.app.confirmURL(i),void 0,{anisotropy:16})),this._changeMaterial((function(e,r){e.lightMap=i,e.lightMapIntensity=t,e.color.copy(n),e.needsUpdate=!0}))},e.prototype.setMaterial=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this;if(e){var i=function(){e.completeWaitNumber>0&&--e.completeWaitNumber||(e.complete&&e.complete({object:n.obj}),n.obj&&(n.obj.app.needUpdate=!0))},r=function(t,r,o){o=o||{};var a=Ne.isString(o)?o:o.url;if(a){e.completeWaitNumber++;var s=(new THREE.TextureLoader).load(n.obj.app.confirmURL(a),(function(){i()}));if(s.anisotropy=16,u=Ne.parseWrapType(o.wrap||o.wrapType))s.wrapT=u,s.wrapS=u;else{var l=t[r];l&&(s.wrapT=l.wrapT,s.wrapS=l.wrapS)}"emissiveMap"===r&&(s.premultiplyAlpha=!0),t[r]=s}else null===a&&(t[r]=null);var u,c=o.texture;c?(t[r]=c,(u=Ne.parseWrapType(o.wrap||o.wrapType))&&(c.wrapT=u,c.wrapS=u)):null===c&&(t[r]=null)},o=function(e,t){var o=Ne.parseColor(t.color);o&&e.color.copy(o);var a=t.image;if(a){t.completeWaitNumber++;var s=new THREE.TextureLoader;s.setCrossOrigin("anonymous"),(a=s.load(n.obj.app.confirmURL(a),(function(){i()}))).anisotropy=16;var l=Ne.parseWrapType(t.wrap||t.wrapType);if(l)a.wrapT=l,a.wrapS=l;else{var u=e.map;u&&(a.wrapT=u.wrapT,a.wrapS=u.wrapS)}e.map=a}else null===a&&(e.map=null);var c=t.map;c?e.map=c:null===c&&(e.map=null),r(e,"map",t.diffuseMap),r(e,"emissiveMap",t.emissiveMap),r(e,"roughnessMap",t.roughnessMap),r(e,"roughnessMap",t.roughnessMap),r(e,"roughnessMap",t.roughnessMap),r(e,"lightMap",t.lightMap),r(e,"bumpMap",t.bumpMap),r(e,"aoMap",t.aoMap),r(e,"alphaMap",t.alphaMap),r(e,"displacementMap",t.displacementMap);var h=t.envMap;h?e.envMap=n.obj.app.resourceManager.loadCubeTexture(h,(function(){n.obj&&(n.obj.app.needUpdate=!0)})):null===h&&(e.envMap=null),e.envMapIntensity=Ne.parseValue(t.envMapIntensity,e.envMapIntensity);var p=t.doubleSide;void 0!==p&&(e.side=p?THREE.DoubleSide:THREE.FrontSide),e.blending=Ne.parseBlendingType(t.blending,e.blending),e.transparent=Ne.parseValue(t.transparent,e.transparent),e.opacity=Ne.parseValue(t.opacity,e.opacity);var d=Ne.parseColor(t.emissive);e.emissive&&d&&e.emissive.copy(d),e.metalness=Ne.parseValue(t.metalness,e.metalness),e.roughness=Ne.parseValue(t.roughness,e.roughness),e.depthWrite=Ne.parseValue(t.depthWrite,e.depthWrite),e.depthTest=Ne.parseValue(t.depthTest,e.depthTest),e.needsUpdate=!0};e.completeWaitNumber=0;var a=e.index;this._cloneAndModifyMaterial((function(t,n,i){a&&Ne.isArray(i.material)&&i.material.indexOf(n)!==a||o(n,e)}),t),this._processWithChildFunction("setMaterial",e)}else this.revertMaterial()},e.prototype.setPolygonOffset=function(e){e=e||{};var t=Ne.parseValue(e.polygonOffset,!1),n=Ne.parseValue(e.polygonOffsetFactor,0),i=Ne.parseValue(e.polygonOffsetUnits,0);this._changeMaterial((function(e,r){return e.polygonOffset=t,e.polygonOffsetFactor=n,e.polygonOffsetUnits=i,e}))},e.prototype.setWireframe=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wireframe=e,e?this._cloneAndModifyMaterial((function(e,t,n){Ne.backupValue(t,"wireframe"),Ne.backupValue(t,"wireframeMap","map"),t.wireframe=!0,t.map=null}),t):this.isNeedRevertMaterials()?this.revertMaterial():this._changeMaterial((function(e,t){return Ne.revertValue(e,"wireframe"),Ne.revertValue(e,"wireframeMap","map"),e}))},e.prototype.setRenderOrder=function(t){var n=this;this._renderOrder=t,Ne.isNull(t)?this.obj._traverseSelfNodes((function(e){var t=e.__prevRenderOrder;Ne.isNull(t)||(e.renderOrder=t,delete e.__prevRenderOrder)})):(this.obj._traverseSelfNodes((function(i){i.isGroup||(Ne.isNull(i.__prevRenderOrder)&&(i.__prevRenderOrder=i.renderOrder),n._alwaysOnTop?i.renderOrder=e.cRenderOrderValueMask+t:i.isEdgeWireframe?i.renderOrder=t+.01:i.renderOrder=t)})),this.obj.children.forEach((function(e){e.skipStyle||(e.style.renderOrder=t)})))},e.prototype._setTextureUVAnimation=function(e){var t=this;Ne.setValue(e,"updateMatrix",(function(){var n=t._uvAnimationParams,i=n.repeat||[1,1],r=n.center||[0,0],o=n.offset||[0,0],a=Ne.parseValue(n.rotation,0);e.matrix.setUvTransform(o[0],o[1],i[0],i[1],a,r[0],r[1])}),!0)},e.prototype.setUVAnimation=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._uvAnimationParams=e,this._uvAnimationParams){t&&this._cloneAndModifyMaterial((function(){}));var n=this._uvAnimationParams;n.wrapType=Ne.parseWrapType(n.wrapType),n.offset=n.offset||[0,0],n.baseOffset=n.offset.concat();var i=Ne.parseValue(n.rotation,0);n.baseRotation=i,n.rotation=0,n.offsetSpeed=n.speed||n.offsetSpeed,Ne.isNumber(n.offsetSpeed)&&(n.offsetSpeed=[n.offsetSpeed,n.offsetSpeed]);var r=n.rotationSpeed||n.rotateSpeed;r&&(n.rotationSpeed=r),(i||r)&&(n.center=[.5,.5]),n.animation=Ne.parseValue(n.animation,!0);var o=this,a=this.obj.getControl("texAnimControl");this.obj.node.traverseTextures((function(e,t,i){"envMap"!=t&&"colorMapping"!=t&&(a&&a.$hasAnimation(i)||(i.__cloned||((i=i.clone()).__cloned=!0,e[t]=i,i.needsUpdate=!0),n.wrapType&&(Ne.setValue(i,"wrapS",n.wrapType),Ne.setValue(i,"wrapT",n.wrapType)),o._setTextureUVAnimation(i)))})),this.obj.tickable=!0}else this.obj.node.traverseTextures((function(e,t,n){Ne.revertValue(n,"wrapS"),Ne.revertValue(n,"wrapT"),Ne.revertValue(n,"updateMatrix")})),this.revertMaterial()},e.prototype.getUVAnimation=function(){return this._uvAnimationParams},e.prototype.hasUVAnimation=function(){return!!this._uvAnimationParams},e.prototype.update=function(e){var t=this._uvAnimationParams;if(t){if(!t.animation)return!1;var n=t.baseOffset,i=t.offsetSpeed;n&&i&&(t.offset[0]+=n[0]+e*i[0],t.offset[1]+=n[1]+e*i[1]);var r=t.baseRotation,o=t.rotationSpeed;return o&&(t.rotation+=r+e*o),!0}return!1},e.prototype._getStyleValue=function(e){var t=this._getSynValue(e);return t||this["_"+e]},e.prototype._getStyleColorValue=function(e){var t=this._getStyleValue(e);return t?Ne.parseColor(t).toHexString():null},e.prototype._processAppUpdate=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.obj.visible){var t=this.obj.app;e?t.needUpdate=!0:t.rendererManager&&(t.rendererManager.needUpdate=!0)}},e.prototype._processWithValue=function(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];e.call(this,n),this.obj.children.forEach((function(e){e.inheritStyle&&(e.style[t]=n)})),this._processAppUpdate(i)},e.prototype._processWithChildFunction=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.obj.children.forEach((function(n){if(n.inheritStyle){var i=n.style[e];Ne.isFunction(i)&&i.call(n.style,t)}})),this._processAppUpdate(n)},e.prototype.isBaseStyle=function(){return!0},o(e,[{key:"renderOrder",set:function(e){this._setSynValue("renderOrder",e)||this._processWithValue(this.setRenderOrder,"renderOrder",e)},get:function(){return this._getStyleValue("renderOrder")}},{key:"wireframe",set:function(e){this._setSynValue("wireframe",e)||this._processWithValue(this.setWireframe,"wireframe",e,!1)},get:function(){return this._getStyleValue("wireframe")}},{key:"opacity",set:function(e){this._setSynValue("opacity",e)||this._processWithValue(this.setOpacity,"opacity",e)},get:function(){var e=this._getStyleValue("opacity");return Ne.isNull(e)?1:e}},{key:"color",set:function(e){this._setSynValue("color",e)||this._processWithValue(this.setColor,"color",e,!1)},get:function(){return this._getStyleColorValue("color")}},{key:"emissive",set:function(e){e=e||"#000000",this._emissive=Ne.parseColor(e),this.setMaterial({emissive:e})},get:function(){return this._getStyleColorValue("emissive")}},{key:"roughness",set:function(e){this.setMaterial({roughness:e})}},{key:"outlineColor",set:function(e){this._setSynValue("outlineColor",e)||this._processWithValue(this.setOutlineColor,"outlineColor",e,!1)},get:function(){return this._getStyleColorValue("outlineColor")}},{key:"defaultOutlineColor",set:function(e){this._processWithValue(this.setDefaultOutlineColor,"defaultOutlineColor",e,!1)},get:function(){return this._getStyleColorValue("defaultOutlineColor")}},{key:"skipBoundingBox",set:function(e){this.setSkipBoundingBox(e)}},{key:"skipOutline",set:function(e){this._setNodesAttribute("skipOutline",e,!0),e&&(this._outlineColor=null,this._defaultOutlineColor=null,this._clearAllOutlineColor())}},{key:"skipStyle",set:function(e){this.obj.node.traverse((function(t){t.isRenderable()&&(t.userData.skipStyle=e)}))}},{key:"skipEnvMap",set:function(e){this._setNodesAttribute("skipEnvMap",e)}},{key:"glow",set:function(e){this._processWithValue(this.setGlow,"glow",e,!1)},get:function(){return this._getStyleValue("glow")}},{key:"innerGlow",set:function(e){this._processWithValue(this.setInnerGlow,"innerGlow",e,!1)},get:function(){return this._getStyleValue("innerGlow")}},{key:"lineBloom",set:function(e){this._processWithValue(this.setLineBloom,"lineBloom",e,!1)},get:function(){return this._getStyleValue("lineBloom")}},{key:"radialBlur",set:function(e){this._processWithValue(this.setRadialBlur,"radialBlur",e,!1)},get:function(){return this._getStyleValue("radialBlur")}},{key:"radialBlur2",set:function(e){this._processWithValue(this.setRadialBlur2,"radialBlur2",e,!1)},get:function(){return this._getStyleValue("radialBlur2")}},{key:"radialOffset",set:function(e){this._processWithValue(this.setRadialOffset,"radialOffset",e,!1)},get:function(){return this._getStyleValue("radialOffset")}},{key:"focusRegion",set:function(e){this._processWithValue(this.setFocusRegion,"focusRegion",e,!1)},get:function(){return this._getStyleValue("focusRegion")}},{key:"vertexNormalHelper",set:function(e){this._processWithValue(this.setVertexNormalHelper,"vertexNormalHelper",e)},get:function(){return this._getStyleValue("vertexNormalHelper")}},{key:"axisHelper",set:function(e){this._processWithValue(this.setAxisHelper,"axisHelper",e)},get:function(){return!!this._axisNode&&this._axisNode.visible}},{key:"edgeColor",set:function(e){this._processWithValue(this.setEdgeWireframe,"edgeColor",e,!1)},get:function(){return this._getStyleColorValue("edgeColor")}},{key:"boundingBox",set:function(e){this.setBoundingBox(e,16777215)},get:function(){return!!this._boundingBoxNode&&this._boundingBoxNode.visible}},{key:"boundingBoxColor",set:function(e){this.setBoundingBox(!0,e)},get:function(){return this._boundingBoxNode?this._boundingBoxNode.material.color.toHexString():0}},{key:"orientedBoundingBox",set:function(e){this.setOrientedBoundingBox(e)},get:function(){return!!this._orientedBoundingBoxNode&&this._orientedBoundingBoxNode.visible}},{key:"orientedBoundingBoxColor",set:function(e){this.setOrientedBoundingBox(!0,e)},get:function(){return this._orientedBoundingBoxNode?this._orientedBoundingBoxNode.material.color.toHexString():0}},{key:"alwaysOnTop",set:function(e){this.setAlwaysOnTop(e)},get:function(){return!!this._getStyleValue("alwaysOnTop")}},{key:"image",set:function(e){this.setImage(e)},get:function(){return this._getStyleValue("image")}},{key:"doubleSide",set:function(e){this._doubleSide=e,this.setMaterial({doubleSide:e})},get:function(){return this._getStyleValue("doubleSide")}}]),e}();Ta.cRenderOrderValueMask=1e6;var Ma=new Map;var Sa=new Map;var Ca=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t}(Ta),Aa=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._textColor=Ne.parseColor("#1e90ff"),i._textSize=26,i._textLineWidth=65536,i._textLineHeight=20,i._textType="Arial",i._textAlign="center",i._dropShadow=!0,i._dropShadowAlpha=1,i._dropShadowAngle=45,i._dropShadowBlur=1,i._dropShadowColor=Ne.parseColor("#000000"),i._dropShadowDistance=2,i._strokeMode=!1,i._skipApplyTheme=!0,i}return a(t,e),o(t,[{key:"scale",get:function(){return this._scale}},{key:"fontColor",set:function(e){var t=Ne.parseColor(e);t.equals(this._textColor)||(this._textColor=t,this.obj.refreshTextMesh())},get:function(){return this._textColor.toHexString()}},{key:"fontSize",set:function(e){e&&this._textSize!=e&&(this._scale=e/26,this._textSize=e,this.obj.refreshTextMesh())},get:function(){return this._textSize}},{key:"fontType",set:function(e){this._textType!=e&&(this._textType=e,this.obj.refreshTextMesh())},get:function(){return this._textType}},{key:"fontAlign",set:function(e){this._textAlign!=e&&(this._textAlign=e,this.obj.refreshTextMesh())},get:function(){return this._textAlign}},{key:"dropShadow",set:function(e){this._dropShadow!=e&&(this._dropShadow=e,this.obj.refreshTextMesh())},get:function(){return this._dropShadow}},{key:"dropShadowAlpha",set:function(e){this._dropShadowAlpha!=e&&(this._dropShadowAlpha=e,this.obj.refreshTextMesh())},get:function(){return this._dropShadowAlpha}},{key:"dropShadowAngle",set:function(e){this._dropShadowAngle!=e&&(this._dropShadowAngle=e,this.obj.refreshTextMesh())},get:function(){return this._dropShadowAngle}},{key:"dropShadowBlur",set:function(e){this._dropShadowBlur!=e&&(this._dropShadowBlur=e,this.obj.refreshTextMesh())},get:function(){return this._dropShadowBlur}},{key:"dropShadowColor",set:function(e){var t=Ne.parseColor(e);t.equals(this._dropShadowBlur)||(this._dropShadowColor=t,this.obj.refreshTextMesh())},get:function(){return this._dropShadowColor.toHexString()}},{key:"dropShadowDistance",set:function(e){this._dropShadowDistance!=e&&(this._dropShadowDistance=e,this.obj.refreshTextMesh())},get:function(){return this._dropShadowDistance}},{key:"textLineWidth",set:function(e){this._textLineWidth!=e&&(this._textLineWidth=e,this.obj.refreshTextMesh())},get:function(){return this._textLineWidth}},{key:"textLineHeight",set:function(e){this._textLineHeight!=e&&(this._textLineHeight=e,this.obj.refreshTextMesh())},get:function(){return this._textLineHeight}},{key:"strokeMode",set:function(e){this._strokeMode!=e&&(this._strokeMode=e,this.obj.refreshTextMesh())},get:function(){return this._strokeMode}}]),t}(Ca),Ra=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._canvasText=new me,i._text="",i._factor=16/26*.1,i._keepSize=!1,i._useSpriteMaterial=!1,i._sizeAttenuation=!0,i._width=0,i._height=0,i._mesh=null,i._disableRefresh=!1,i}return a(t,e),t.prototype.isTextRegion=function(){return!0},t.prototype.createTextMesh=function(){var e=this.style,t=this._canvasText.createCanvas(this._text,{fontType:e.fontType,alignMode:e.fontAlign,fontSize:e.fontSize,fontColor:e.fontColor,textLineWidth:e.textLineWidth,textLineHeight:e.textLineHeight,strokeMode:e.strokeMode,dropShadow:e.dropShadow,dropShadowColor:e.dropShadowColor,dropShadowAngle:e.dropShadowAngle,dropShadowDistance:e.dropShadowDistance,scale:e.scale,dropShadowBlur:e.dropShadowBlur,dropShadowAlpha:e.dropShadowAlpha}),n=new THREE.Texture(t);n.minFilter=THREE.LinearFilter,n.magFilter=THREE.LinearFilter,n.generateMipmaps=!0,n.needsUpdate=!0;var i,r=Math.max(t.width,t.height)*this._factor;if(this._useSpriteMaterial){var o=new THREE.SpriteMaterial({map:n,transparent:!0,side:THREE.DoubleSide,depthWrite:!1});(i=new THREE.Sprite(o)).scale.set(r,r,1)}else{var a=new THREE.PlaneGeometry(r,r);o=new THREE.MeshBasicMaterial({map:n,transparent:!0,side:THREE.DoubleSide,depthWrite:!1});i=new THREE.Mesh(a,o)}return i.userData.skipBoundingBox=!0,i.userData.skipOutline=!0,i.userData.skipEnvMap=!0,i.userData.noBlending=!0,i.technique=i.technique||{},i.technique.glow="skip",i},t.prototype.refreshTextMesh=function(){if(!this._disableRefresh){var e=0;this._mesh&&(e=this._mesh.renderOrder),this.app.resourceManager.remove(this._mesh),this._mesh=this.createTextMesh(),this._mesh.renderOrder=e,this.node.add(this._mesh),this.static&&this.node._synMatrixWorld();var t=this.getControl("TextRegionSizeAdjustmentControl");t&&(t.node=this._mesh),this.synSize()}},t.prototype._beforeSetupStyle=function(e){(e.style||{}).opacity||(this._disableRefresh=!0)},t.prototype._afterSetupStyle=function(e){this._disableRefresh&&(this._disableRefresh=!1,this.refreshTextMesh())},t.prototype.customSetup=function(e){this._sizeAttenuation=Ne.parseValue(e.sizeAttenuation,!0),this._disableRefresh=!0;var t=this.style;t.fontColor=Ne.parseColor(e.textColor||e.fontColor||t.fontColor),t.fontSize=e.textSize||e.fontSize||t.fontSize,t.fontType=e.textType||e.fontType||t.fontType,t.textLineWidth=e.textLineWidth||e.fontLineWidth||t.textLineWidth,t.textLineHeight=e.textLineHeight||e.fontLineHeight||t.textLineHeight,t.strokeMode=e.storkeMode||t.strokeMode,this._text=e.text||e.fontText||this._text,this._factor=e.factor||this._factor,this._useSpriteMaterial=Ne.parseValue(e.useSpriteMaterial,!1),this._width=Ne.parseValue(e.width,this._width),this._height=Ne.parseValue(e.height,this._height),this._disableRefresh=!1,this.refreshTextMesh(),this.node.skipBoundingBox(!0)},t.prototype.synSize=function(){var e=this._mesh;e&&this._width&&this._height&&(e.scale.set(this._width,this._height,1),this.synIndependentWorldScale())},o(t,[{key:"sizeAttenuation",get:function(){return this._sizeAttenuation}},{key:"text",set:function(e){this._text=e,this.refreshTextMesh()},get:function(){return this._text}},{key:"keepSize",set:function(e){if(this._keepSize!=e)if(this._keepSize=e,e){var t=Ne.parseVector3(this.app.camera.position),n=60/this._mesh.getDistanceFromCamera(t);this._useSpriteMaterial&&(n*=this._mesh.scale.x);var i=this._sizeAttenuation?60:960,r=this._sizeAttenuation?[n,n]:[this._width,this._height];this.addControl(new Ct(r,this._mesh,i),"TextRegionSizeAdjustmentControl"),this.synSize()}else this.removeControl("TextRegionSizeAdjustmentControl")},get:function(){return this._keepSize}},{key:"width",set:function(e){this._width=e,this.synSize()},get:function(){return this._width}},{key:"height",set:function(e){this._height=e,this.synSize()},get:function(){return this._height}},{key:"style",get:function(){return e.prototype._getStyle.call(this)},set:function(t){e.prototype._setStyle.call(this,t)}},{key:"textColor",set:function(e){console.warn('[TextRegion]Please use ".style.fontColor" to replace ".fontColor"'),this.style.fontColor=e},get:function(){return console.warn('[TextRegion]Please use ".style.fontColor" to replace ".fontColor"'),this.style.fontColor}},{key:"dropShadow",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadow" to replace ".dropShadow"'),this.style.dropShadow=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadow" to replace ".dropShadow"'),this.style.dropShadow}},{key:"dropShadowAlpha",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadowAlpha" to replace ".dropShadowAlpha"'),this.style.dropShadowAlpha=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadowAlpha" to replace ".dropShadowAlpha"'),this.style.dropShadowAlpha}},{key:"dropShadowAngle",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadowAngle" to replace ".dropShadowAngle"'),this.style.dropShadowAngle=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadowAngle" to replace ".dropShadowAngle"'),this.style.dropShadowAngle}},{key:"dropShadowBlur",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadowBlur" to replace ".dropShadowBlur"'),this.style.dropShadowBlur=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadowBlur" to replace ".dropShadowBlur"'),this.style.dropShadowBlur}},{key:"dropShadowColor",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadowColor" to replace ".dropShadowColor"'),this.style.dropShadowColor=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadowColor" to replace ".dropShadowColor"'),this.style.dropShadowColor}},{key:"dropShadowDistance",set:function(e){console.warn('[TextRegion]Please use ".style.dropShadowDistance" to replace ".dropShadowDistance"'),this.style.dropShadowDistance=e},get:function(){return console.warn('[TextRegion]Please use ".style.dropShadowDistance" to replace ".dropShadowDistance"'),this.style.dropShadowDistance}},{key:"textSize",set:function(e){console.warn('[TextRegion]Please use ".style.fontSize" to replace ".fontSize"'),this.style.fontSize=e},get:function(){return console.warn('[TextRegion]Please use ".style.fontSize" to replace ".fontSize"'),this.style.fontSize}},{key:"textLineWidth",set:function(e){console.warn('[TextRegion]Please use ".style.textLineWidth" to replace ".textLineWidth"'),this.style.textLineWidth=e},get:function(){return console.warn('[TextRegion]Please use ".style.textLineWidth" to replace ".textLineWidth"'),this.style.textLineWidth}},{key:"textLineHeight",set:function(e){console.warn('[TextRegion]Please use ".style.textLineHeight" to replace ".textLineHeight"'),this.style.textLineHeight=e},get:function(){return console.warn('[TextRegion]Please use ".style.textLineHeight" to replace ".textLineHeight"'),this.style.textLineHeight}},{key:"strokeMode",set:function(e){console.warn('[TextRegion]Please use ".style.strokeMode" to replace ".strokeMode"'),this.style.strokeMode=e},get:function(){return console.warn('[TextRegion]Please use ".style.strokeMode" to replace ".strokeMode"'),this.style.strokeMode}}]),t}(Lt),Pa=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._points=[],i}return a(t,e),t.prototype._updateByPoints=function(){},t.prototype._createPolygonVertices=function(e){for(var t=[],n=0;n<this._points.length;n++){var i=this._points[n];t.push(new THREE.Vector3(i[0],i[2],i[1]))}THREE.ShapeUtils.isClockWise(t)||(t=t.reverse());var r=[],o=THREE.ShapeUtils.triangulateShape(t,[]);for(n=0;n<o.length;n++)r.push(new THREE.Face3(o[n][0],o[n][1],o[n][2]));for(n=0;n<t.length;n++){var a=t[n];if(!e){var s=a.z;a.z=a.y,a.y=s}}return{vertices:t,faces:r}},t.prototype._createPolygonGeometry=function(e,t){var n=new THREE.Geometry;return n.vertices=e,n.faces=t,n.genFaceVertexUVs(),n},t.prototype.clearPoints=function(){this._points=[],this._updateByPoints()},t.prototype.insertPoint=function(e,t){this._points.splice(e,0,this.worldToSelf(t)),this._updateByPoints()},t.prototype.setPoint=function(e,t){return!(e>=this._points.length)&&(!!t&&(this._points[e]=this.worldToSelf(t),this._updateByPoints(),!0))},t.prototype.getPoint=function(e){if(e>=this._points.length)return null;var t=this._points[e];return this.selfToWorld(t)},t.prototype.addPoint=function(e){return this._points.push(this.worldToSelf(e)),this._updateByPoints(),this._points.length-1},t.prototype._getPoints=function(e,t){this.node.updateWorldMatrix(!0,!1);for(var n=[],i=0;i<e.length;i++){var r=e[i];t==C.Local?r=this.localToSelf(r):t==C.World&&(r=this.worldToSelf(r)),n.push(r)}return n},t.prototype.getPointsCenterPos=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"world",n=this._getPoints(e,t);if(n.length<=2)return[0,0,0];for(var i=0,r=[!0,!0,!0],o=n[0].concat(),a=1;a<n.length;a++)for(var s=n[a],l=0;l<3;l++)if(!THING.Math.isFloatEquals(o[l],s[l])){r[l]=!1;break}var u=0,c=1,h=2;r[0]?(u=1,c=0,h=2):r[1]?(u=0,c=1,h=2):r[2]&&(u=0,c=2,h=1);var p=[];for(a=0;a<n.length;a++){i+=(s=n[a])[c],p.push([s[u],s[h]])}var d=new polylabel([p]);return r[0]?[i/n.length,d[0],d[1]]:r[1]?[d[0],i/n.length,d[1]]:r[2]?[d[0],d[1],i/n.length]:[0,0,0]},t.prototype.addPoints=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.World,n=this._getPoints(e,t);this._points=this._points.concat(n),this._updateByPoints()},t.prototype.removePoints=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this._points.splice(e,t),this._updateByPoints()},t.prototype.inside=function(e){for(var t=this.planePoints,n=e[0],i=e[1],r=!1,o=0,a=t.length,s=a-1;o<a;s=o,o++){var l=t[o][0],u=t[o][1],c=t[s][0],h=t[s][1];if((l===n&&u===i||c===n&&h===i)&&(r=!r),u<i&&h>=i||u>=i&&h<i){var p=l+(i-u)*(c-l)/(h-u);p===n&&(r=!r),p>n&&(r=!r)}}return!!r},t.prototype.clearPathPoints=function(){console.warn("[PointsBase] Please use '.clearPoints()' to replace 'clearPathPoints()'"),this.clearPoints()},t.prototype.removePoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;console.warn("[LineBase] Please use '.removePoints' to replace '.removePoint'"),this.removePoints(e,t)},o(t,[{key:"points",get:function(){for(var e=[],t=0;t<this._points.length;t++){var n=this.selfToWorld(this._points[t]);e.push(n)}return e}},{key:"planePoints",get:function(){for(var e=[],t=0;t<this._points.length;t++){var n=this.selfToWorld(this._points[t]);e.push([n[0],n[2]])}return e}},{key:"area",get:function(){for(var e=[],t=0;t<this._points.length;t++){var n=this.selfToWorld(this._points[t]);e.push(new THREE.Vector2(n[0],n[2]))}var i=THREE.ShapeUtils.area(e);return Math.abs(i)}},{key:"centerPos",get:function(){return new polylabel([this.planePoints])}},{key:"avgHeight",get:function(){if(!this._points.length)return 0;for(var e=0,t=0;t<this._points.length;t++){e+=this._points[t][1]}return e/this._points.length}}]),t}(Lt),Da=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._lineMesh=null,i._areaMesh=null,i._textRegion=null,i}return a(t,e),t.prototype._updateTextPosition=function(){if(this._textRegion){var e=this.centerPos;this._textRegion.position=[e[0],this.position.y,e[1]],this._textRegion.translateY(.01)}},t.prototype._updateByPoints=function(){if(!(this._points.length<3)){var e=new THREE.MeshBasicMaterial({color:this.style.regionColor,opacity:this.style.regionOpacity,transparent:!0,side:THREE.DoubleSide,depthWrite:!1}),t=this._createPolygonVertices(),n=this._createPolygonGeometry(t.vertices,t.faces);this.app.resourceManager.remove(this._areaMesh),this._areaMesh=new THREE.Mesh(n,e),this.node.add(this._areaMesh);var i=new THREE.LineBasicMaterial({color:this.style.lineColor});this.app.resourceManager.remove(this._lineMesh),(n=new THREE.Geometry).vertices=t.vertices,n.vertices.push(t.vertices[0]),this._lineMesh=new THREE.Line(n,i),this._lineMesh.userData.skipPick=!0,this.node.add(this._lineMesh)}},t.prototype._beforeSetupComplete=function(e){var t=e.points||e.vertices;if(t){if(!e.position&&!e.localPosition){var n=this.getPointsCenterPos(t);this.position=this.selfToWorld(n)}this.addPoints(t)}var i=e.fontText||e.text;i&&(this.text=i),Ne.parseValue(e.alwaysOnTop,!0)&&(this.style.alwaysOnTop=!0);var r=this.style;r.lineColor=Ne.parseColor(e.lineColor,r.lineColor),r.regionOpacity=Ne.parseValue(e.regionOpacity||e.opacity,r.regionOpacity),r.regionColor=Ne.parseColor(e.regionColor,r.regionColor)},o(t,[{key:"textRegion",get:function(){if(!this._textRegion){var e={type:"TextRegion",parent:this};this._textRegion=this.app.create(e),this._textRegion._mesh.renderOrder=1,this._textRegion.angleX=-90,this._textRegion.translateY(.1)}return this._textRegion}},{key:"text",set:function(e){this.textRegion.text=e,this._updateTextPosition()},get:function(){return this.textRegion.text}},{key:"style",get:function(){return e.prototype._getStyle.call(this)},set:function(t){e.prototype._setStyle.call(this,t)}},{key:"lineColor",set:function(e){console.warn('[PolygonRegion]Please use ".style.lineColor" to replace ".lineColor"'),this.style.lineColor=e},get:function(){return console.warn('[PolygonRegion]Please use ".style.lineColor" to replace ".lineColor"'),this.style.lineColor}},{key:"regionColor",set:function(e){console.warn('[PolygonRegion]Please use ".style.regionColor" to replace ".regionColor"'),this.style.regionColor=e},get:function(){return console.warn('[PolygonRegion]Please use ".style.regionColor" to replace ".regionColor"'),this.style.regionColor}},{key:"regionOpacity",set:function(e){console.warn('[PolygonRegion]Please use ".style.regionOpacity" to replace ".regionOpacity"'),this.style.regionOpacity=e},get:function(){return this.style.regionOpacity}}]),t}(Pa),ka=null;function ja(){return ka||(ka=new THREE.Texture(SimpleHeatmap.getInstance().canvas())),ka}var Oa=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.node=new THREE.Object3D,i._map=null,i._tex=null,i._params={},i}return a(t,e),t.prototype._getMap=function(){return SimpleHeatmap.getInstance()},t.prototype._beforeSetup=function(e){this._map=this._getMap();var t=this._tex=new THREE.Texture(this._map.canvas()),n=void 0!==e.opacity?e.opacity:1,i=e.width||10,r=e.height||10,o=void 0;if(e.clipShape){var a=e.clipShape.shape.map((function(e){return(new THREE.Vector2).fromArray(e)})),s=new THREE.Shape(a);s.autoClose=!0,e.clipShape.holes&&(s.holes=e.clipShape.holes.map((function(e){return new THREE.Shape(e.map((function(e){return(new THREE.Vector2).fromArray(e)})))})));for(var l=(o=new THREE.ShapeBufferGeometry(s)).getAttribute("uv"),u=0,c=l.array.length;u<c;u+=2){var h=l.array[u+0],p=l.array[u+1];l.array[u+0]=(h+i/2)/i,l.array[u+1]=(p+r/2)/r}}else o=new THREE.PlaneGeometry(i,r);var d=void 0;e.mosaic?(d=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(Fa.uniforms),vertexShader:Fa.vertexShader,fragmentShader:Fa.fragmentShader,transparent:!0,side:THREE.DoubleSide,opacity:n})).uniforms.tDiffuse.value=t:d=new THREE.MeshBasicMaterial({map:t,side:THREE.DoubleSide,transparent:!0,opacity:n}),this._material=d;var f=new THREE.Mesh(o,d);f.userData.skipEnvMap=!0,this.node.add(f),this._initParameter(e),this._refresh()},t.prototype._initParameter=function(e){var t=this._params;t.areaWidth=e.width||10,t.areaHeight=e.height||10,t.mapSize=e.mapSize||256,t.alpha=!!e.alpha,t.gradient=e.gradient||{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},t.minValue=e.minValue||10,t.maxValue=e.maxValue||50,t.radius=e.radius||.8,t.blur=e.blur||.8,t.data=e.data||[],t.mosaicSize=e.mosaicSize||t.mapSize/64},t.prototype.setParameter=function(e){var t=this._params;t.mapSize=e.mapSize||t.mapSize,t.alpha=void 0!==e.alpha?e.alpha:t.alpha,t.gradient=e.gradient||t.gradient,t.minValue=e.minValue||t.minValue,t.maxValue=e.maxValue||t.maxValue,t.radius=e.radius||t.radius,t.blur=e.blur||t.blur,t.data=e.data||t.data,t.mosaicSize=e.mosaicSize||t.mosaicSize,this._refresh()},t.prototype.addData=function(e){this._params.data.push(e),this._refresh()},t.prototype.setData=function(e){this._params.data=e,this._refresh()},t.prototype.setAlpha=function(e){this._params.alpha=e,this._refresh()},t.prototype.setRadius=function(e,t){this._params.radius=e,void 0!==t&&(this._params.blur=t),this._refresh()},t.prototype.setGradient=function(e){this._params.gradient=e,this._refresh()},t.prototype.randomData=function(){for(var e=this._params,t=[],n=0;n<Math.round(e.areaWidth*e.areaHeight);n++)t.push([(Math.random()-.5)*e.areaWidth,(Math.random()-.5)*e.areaHeight,Math.pow(Math.random(),3)*(e.maxValue-e.minValue)+e.minValue]);this.setData(t)},t.prototype._refresh=function(){var e=this._params,t=1,n=1,i=e.mapSize/e.areaWidth;e.areaWidth!=e.areaHeight&&(e.areaWidth>e.areaHeight?(t=1,n=e.areaHeight/e.areaWidth):(t=e.areaWidth/e.areaHeight,n=1,i=e.mapSize/e.areaHeight));var r=1;e.radius*i<1&&(r=1/e.radius*i+1e-4);var o=e.data.map((function(e){return[e[0]*r,e[1]*r,e[2]]})),a=Math.floor(e.mapSize*t),s=Math.floor(e.mapSize*n);this._map.setCanvasSize(a,s).setAreaSize(e.areaWidth*r,e.areaHeight*r).min(e.minValue).max(e.maxValue).alpha(e.alpha).gradient(e.gradient).radius(Math.floor(e.radius*i*r),Math.floor(e.blur*i*r)).data(o).draw(),this._tex.needsUpdate=!0,ja().needsUpdate=!0,this.app.renderer.copyTextureToTexture(new THREE.Vector2,ja(),this._tex),this._material.isShaderMaterial&&(this._material.uniforms.texSize.value.set(a,s),this._material.uniforms.mosaicSize.value.set(e.mosaicSize,e.mosaicSize))},o(t,[{key:"isHeatmap",get:function(){return console.warn("[Heatmap] Please use 'instanceof THING.Heatmap' to replace '.isHeatmap'"),this instanceof THING.Heatmap}}]),t}(Lt),Fa={uniforms:{tDiffuse:{value:null},texSize:{value:new THREE.Vector2(640,640)},mosaicSize:{value:new THREE.Vector2(16,16)}},vertexShader:"\n\t\t#include <common>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\tvarying vec2 vUV;\n        void main() {\n\t\t\tvUV = uv;\n\t\t\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\t\t\tgl_Position = projectionMatrix * mvPosition;\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <fog_vertex>\n        }\n    ",fragmentShader:"\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\n        uniform sampler2D tDiffuse;\n\n        uniform vec2 texSize;\n        uniform vec2 mosaicSize;\n\n        varying vec2 vUV;\n\n        void main(void) {\n\t\t\tvec4 originColor = texture2D(tDiffuse, vUV);\n\n\t\t\tif (originColor.a < 0.0001) discard;\n\n\t\t\t#include <logdepthbuf_fragment>\n\n            vec2 xy = vec2(vUV.x * texSize.x, vUV.y * texSize.y);\n            \n            vec2 xyMosaic = vec2(floor(xy.x / mosaicSize.x) * mosaicSize.x, \n                    floor(xy.y / mosaicSize.y) * mosaicSize.y )\n                    + .5*mosaicSize;\n            \n            vec2 delXY = xyMosaic - xy;\n            float delL = length(delXY);\n            \n            vec2 uvMosaic = vec2(xyMosaic.x / texSize.x, xyMosaic.y / texSize.y);\n\n            float percent = smoothstep(0., 1., 1. - delL * 2.4 / mosaicSize.x) * 0.7 + 0.3;\n\n            vec4 centerColor = texture2D(tDiffuse, uvMosaic);\n            \n            vec4 resultColor = vec4(mix(originColor.rgb, centerColor.rgb, percent), centerColor.a * percent);\n            \n\t\t\tgl_FragColor = resultColor;\n\t\t\t\n\t\t\t#include <fog_fragment>\n        }\n    "};Oa.PointMosaicShader=Fa;var Ba=null;function La(){return Ba||(Ba=new THREE.Texture(SimpleIDW.getInstance().canvas())),Ba}var Ia=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype._getMap=function(){return SimpleIDW.getInstance()},t.prototype._initParameter=function(e){var t=this._params;t.areaWidth=e.width||10,t.areaHeight=e.height||10,t.mapSize=e.mapSize||256,t.alpha=!!e.alpha,t.gradient=e.gradient||{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},t.minValue=e.minValue||0,t.maxValue=e.maxValue||50,t.radius=e.radius||10,t.blur=e.blur||.8,t.data=e.data||[],t.exp=e.exp||3,t.cellSize=e.cellSize||10,t.opacity=e.opacity||1,t.mosaicSize=e.mosaicSize||t.mapSize/64},t.prototype._refresh=function(){var e=this._params,t=1,n=1,i=e.mapSize/e.areaWidth;e.areaWidth!=e.areaHeight&&(e.areaWidth>e.areaHeight?(t=1,n=e.areaHeight/e.areaWidth):(t=e.areaWidth/e.areaHeight,n=1,i=e.mapSize/e.areaHeight));var r=1;e.radius*i<1&&(r=1/e.radius*i+1e-4);var o=e.data.map((function(e){return[e[0]*r,e[1]*r,e[2]]})),a=Math.floor(e.mapSize*t),s=Math.floor(e.mapSize*n);this._map.setCanvasSize(a,s).setAreaSize(e.areaWidth*r,e.areaHeight*r).min(e.minValue).max(e.maxValue).alpha(e.alpha).gradient(e.gradient).opacity(e.opacity).cellSize(e.cellSize).exp(e.exp).radius(e.radius).data(o)._redraw(),this._tex.needsUpdate=!0,La().needsUpdate=!0,this.app.renderer.copyTextureToTexture(new THREE.Vector2,La(),this._tex),this._material.isShaderMaterial&&(this._material.uniforms.texSize.value.set(a,s),this._material.uniforms.mosaicSize.value.set(e.mosaicSize,e.mosaicSize))},t}(Oa),Na=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.pathTexture=null,i.pathWidth=1,i.pathCornerRadius=.3,i.pathCornerSplit=10,i.pathScrollUV=!1,i.pathScrollSpeed=1,i.pathPlayingTween=null,i.pathUp=new THREE.Vector3(0,1,0),i.pathPointList=null,i.pathGeometry=null,i.pathLine=null,i.pathMaterial=new THREE.MeshBasicMaterial({transparent:!0}),i._uvRepeat=[1,1],i._uvOffset=[0,0],i._uvRotation=0,i}return a(t,e),t.prototype.synPathTexture=function(e){this.pathTexture=e,this.pathLine&&(this.pathLine.material.map=this.pathTexture,this.pathLine.material.needsUpdate=!0)},t.prototype._synUvTransform=function(){this.pathMaterial.uvTransform||(this.pathMaterial.uvTransform=new THREE.Matrix3),this.pathMaterial.uvTransform.setUvTransform(this._uvOffset[0],this._uvOffset[1],this._uvRepeat[0],this._uvRepeat[1],this._uvRotation,0,0)},t.prototype._setupPoints=function(e){var t=e.points;if(t){var n=e.spaceType,i=e.local;if(!n&&i&&(n=SpaceType.Local),t.forEach((function(e,n){e.isVector3&&(t[n]=e.toArray())})),!e.position&&!e.localPosition){var r=this.getPointsCenterPos(t,n);this.position=this.selfToWorld(r)}this.addPoints(t,n)}},t.prototype._setupPathLine=function(e){var t=this;this.scrollUV=Ne.parseValue(e.scrollUV,!1),this.uvRatio=e.uvRatio||1,this.width=Ne.parseValue(e.width,this.width),this.side=Ne.parseValue(e.side,"both"),this.close=Ne.parseValue(e.close,!1);var n=Ne.parseValue(e.doubleSide,!0);this.pathMaterial.side=n?THREE.DoubleSide:THREE.FrontSide,this.pathLine=new THREE.Mesh(this.pathGeometry,this.pathMaterial),this.pathLine.addBeforeRenderFunction("pathUpdate",(function(e,n,i,r,o,a){o.uvTransform||(o.uvTransform=new THREE.Matrix3),o.uvTransform.setUvTransform(t._uvOffset[0],t._uvOffset[1],t._uvRepeat[0],t._uvRepeat[1],t._uvRotation,0,0)}));var i=e.image;i&&(this.style.image=i)},t.prototype._addPathLine=function(){this.node.add(this.pathLine)},t.prototype._beforeSetupComplete=function(e){this._setupPathLine(e),this._setupPoints(e),this._addPathLine()},t.prototype._updateByPoints=function(){this.node.updateWorldMatrix(!0,!1),this._points.length>=2&&this.pathPointList.set(this._points.map((function(e){return(new THREE.Vector3).fromArray(e)})),this.pathCornerRadius,this.pathCornerSplit,this.pathUp,this.close),this.pathGeometry&&(this.pathGeometry.boundingBox=null,this.pathGeometry.boundingSphere=null)},t.prototype.updatePath=function(e){if(this.pathScrollUV&&this.pathMaterial){var t=this.pathScrollSpeed*e;return this.rotateScrollDirection?this._uvOffset[1]-=t:this._uvOffset[0]-=t,!0}return!1},t.prototype.update=function(t){var n=e.prototype.update.call(this,t);return n|=this.updatePath(t)},t.prototype.play=function(e){var t=(e=e||{}).time||1e3,n=Ne.parseValue(e.startProgress,0),i=Ne.parseValue(e.endProgress,1),r=e.lerpType||M.Linear.None,o=e.complete,a=this,s={progress:n},l={progress:i};this.pathPlayingTween=new TWEEN.Tween(s).to(l,t).easing(r).onUpdate((function(){a.pathGeometry.update(a.pathPointList,{width:a.pathWidth,radius:a.pathWidth,arrow:!!a.arrowFlag,progress:this._object.progress})})).onComplete((function(){o&&o.call(a)})).start()},t.prototype.stop=function(){this.pathPlayingTween&&(this.pathPlayingTween.stop(),this.pathPlayingTween=null)},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.image=this.image,t.scrollUV=this.scrollUV,t.points=this.points,t},t.prototype._setupResources=function(e){this.pathLine&&(this.pathLine.material=this.pathMaterial,this._addPathLine())},t.prototype.unloadResource=function(){e.prototype.unloadResource.call(this),this.clearPoints()},o(t,[{key:"rotateScrollDirection",set:function(e){this._uvRotation=e?Math.PI/2:0,this._synUvTransform()},get:function(){return 0!==this._uvRotation}},{key:"imageRepeat",set:function(e){this._uvRepeat[0]=e[0],this._uvRepeat[1]=e[1],this._synUvTransform()},get:function(){return this._uvRepeat.slice(0)}},{key:"imageScroll",set:function(e){this.pathScrollUV=e,this.tickable=!0},get:function(){return this.pathScrollUV}},{key:"imageScrollSpeed",set:function(e){this.pathScrollSpeed=THING.Math.clamp(e,-99,99)},get:function(){return this.pathScrollSpeed}},{key:"useTexture",set:function(e){var t=this.pathLine.material;t.map=e?this.pathTexture:null,t.needsUpdate=!0},get:function(){return null!==this.pathLine.material.map}},{key:"width",set:function(e){this.pathWidth=e,this._updateByPoints()},get:function(){return this.pathWidth}},{key:"cornerRadius",set:function(e){this.pathCornerRadius=e,this._updateByPoints()},get:function(){return this.pathCornerRadius}},{key:"cornerSegments",set:function(e){this.pathCornerSplit=e,this._updateByPoints()},get:function(){return this.pathCornerSplit}},{key:"length",get:function(){if(this._points.length<=1)return 0;for(var e=0,t=this._points[0],n=1;n<this._points.length;n++){var i=this._points[n];e+=THING.Math.getDistance(i,t),t=i}return e}},{key:"cornerSplit",set:function(e){console.warn("[LineBase] Please use '.cornerSegments' to replace '.cornerSplit'"),this.cornerSegments=e},get:function(){return console.warn("[LineBase] Please use '.cornerSegments' to replace '.cornerSplit'"),this.cornerSegments}},{key:"uvRatio",set:function(e){this._uvRepeat[0]=1/e}},{key:"scrollUV",set:function(e){this.pathScrollUV=e,this.tickable=!0},get:function(){return this.pathScrollUV}},{key:"scrollSpeed",set:function(e){this.pathScrollSpeed=THING.Math.clamp(e/10,-99,99)},get:function(){return 10*this.pathScrollSpeed}}]),t}(Pa),Ha=function(){function e(t){r(this,e),this.app=t,this._points=[]}return e.prototype.set=function(e,t,n,i){this._points=e},o(e,[{key:"vertices",get:function(){for(var e=[],t=0;t<this._points.length;t++)e.push(Ne.parseVector3(this._points[t]));return e}}]),e}(),za=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.dotNode=null,i.pathGeometry=new THREE.BufferGeometry,i.pathGeometry.update=function(e,t){},i.dotGeometry=null,i.dotMaterial=null,i.pathPointList=new Ha,i}return a(t,e),t.prototype._updateByPoints=function(){e.prototype._updateByPoints.call(this);var t=this.pathPointList.vertices;t.length&&(this.pathGeometry.setFromPoints(t),this.pathLine.computeLineDistances(),this.dotGeometry&&this.dotGeometry.setFromPoints(t),this.node.setFrustumCulled(!1))},t.prototype._setupPathLine=function(e){var t,n=e.style||{},i=e.lineOpacity||1,r=Ne.parseValue(e.lineDashSize||n.lineDashSize,0),o=Ne.parseValue(e.lineGapSize||n.lineGapSize,0),a=e.lineWidth||1,s=e.color||255,l=this.pathPointList.vertices;t=r||o?new THREE.LineDashedMaterial({color:s,opacity:i,dashSize:r,gapSize:o,linewidth:a,transparent:!0}):new THREE.LineBasicMaterial({color:s,opacity:i,linewidth:a,transparent:!0}),this.pathGeometry.setFromPoints(l),this.pathLine=new THREE.Line(this.pathGeometry,t),this.pathLine.computeLineDistances();var u=e.dotColor||16777215,c=e.dotSize;c&&(this.dotGeometry=(new THREE.BufferGeometry).setFromPoints(l),this.dotMaterial=new THREE.PointsMaterial({color:u,size:c,sizeAttenuation:!1}),this.dotNode=new THREE.Points(this.dotGeometry,this.dotMaterial),this.node.add(this.dotNode))},t.prototype.showLines=function(e){this.pathLine.visible=e},t.prototype.showPoints=function(e){this.dotNode.visible=e},o(t,[{key:"isLine",get:function(){return console.warn("[Line] Please use 'instanceof THING.Line' to replace '.isLine'"),this instanceof THING.Line}}]),t}(Na),Ua=function(){this.pos=new THREE.Vector3,this.dir=new THREE.Vector3,this.right=new THREE.Vector3,this.up=new THREE.Vector3,this.dist=0,this.widthScale=1,this.sharp=!1};Ua.prototype.lerpPathPoints=function(e,t,n){this.pos.lerpVectors(e.pos,t.pos,n),this.dir.lerpVectors(e.dir,t.dir,n),this.up.lerpVectors(e.up,t.up,n),this.right.lerpVectors(e.right,t.right,n),this.dist=(t.dist-e.dist)*n+e.dist,this.widthScale=(t.widthScale-e.widthScale)*n+e.widthScale},Ua.prototype.copy=function(e){this.pos.copy(e.pos),this.dir.copy(e.dir),this.up.copy(e.up),this.right.copy(e.right),this.dist=e.dist,this.widthScale=e.widthScale};var Va=function(){this.array=[],this.count=0};Va.prototype.set=function(e,t,n,i,r){if((e=e.slice(0)).length<2)return this.count=0,void console.warn("PathPointList: points length less than 2.");t=void 0!==t?t:.1,n=void 0!==n?n:10,(r=void 0!==r&&r)&&!e[0].equals(e[e.length-1])&&e.push((new THREE.Vector3).copy(e[0]));for(var o=0,a=e.length;o<a;o++)if(0===o)this._start(e[o],e[o+1],i);else if(o===a-1)if(r){this._corner(e[o],e[1],t,n,i);var s=this.array[0].dist;this.array[0].copy(this.array[this.count-1]),this.array[0].dist=s}else this._end(e[o]);else this._corner(e[o],e[o+1],t,n,i)},Va.prototype.distance=function(){return 0==this.count?0:this.array[this.count-1].dist},Va.prototype._start=function(e,t,n){this.count=0;var i=this._getByIndex(this.count);if(i.pos.copy(e),i.dir.subVectors(t,e),n)i.up.copy(n);else{var r=Number.MAX_VALUE,o=Math.abs(i.dir.x),a=Math.abs(i.dir.y),s=Math.abs(i.dir.z);o<r&&(r=o,i.up.set(1,0,0)),a<r&&(r=a,i.up.set(0,1,0)),s<r&&i.up.set(0,0,1)}i.right.crossVectors(i.dir,i.up).normalize(),i.up.crossVectors(i.right,i.dir).normalize(),i.dist=0,i.widthScale=1,i.sharp=!1,i.dir.normalize(),this.count++};var qa=new THREE.Vector3,Ga=new THREE.Vector3,Wa=new THREE.Vector3,Xa=new THREE.Matrix4,Ja=new THREE.QuadraticBezierCurve3;Va.prototype._corner=function(e,t,n,i,r){if(n>0&&i>0){for(var o=this.array[this.count-1],a=this._getCornerBezierCurve(o.pos,e,t,n,Ja).getPoints(i),s=0;s<i;s+=1)this._sharpCorner(a[s],a[s+1],r,0===s?1:0);a[i].equals(t)||this._sharpCorner(a[i],t,r,2)}else this._sharpCorner(e,t,r,0,!0)},Va.prototype._sharpCorner=function(e,t,n,i,r){var o=this.array[this.count-1],a=this._getByIndex(this.count),s=qa.subVectors(e,o.pos),l=Ga.subVectors(t,e),u=s.length();if(s.normalize(),l.normalize(),a.pos.copy(e),i?1===i?a.dir.copy(s):2===i&&a.dir.copy(l):(a.dir.addVectors(s,l),a.dir.normalize()),n)1===a.dir.dot(n)?a.right.crossVectors(l,n).normalize():a.right.crossVectors(a.dir,n).normalize(),a.up.crossVectors(a.right,a.dir).normalize();else{a.up.copy(o.up);var c=Wa.crossVectors(o.dir,a.dir);if(c.length()>Number.EPSILON){c.normalize();var h=Math.acos(Math.min(Math.max(o.dir.dot(a.dir),-1),1));a.up.applyMatrix4(Xa.makeRotationAxis(c,h))}a.right.crossVectors(a.dir,a.up).normalize()}a.dist=o.dist+u;var p=s.dot(l);a.widthScale=Math.min(1/Math.sqrt((1+p)/2),1.415)||1,a.sharp=Math.abs(p-1)>.05&&r,this.count++},Va.prototype._end=function(e){var t=this.array[this.count-1],n=this._getByIndex(this.count);n.pos.copy(e),n.dir.subVectors(e,t.pos);var i=n.dir.length();n.dir.normalize(),n.up.copy(t.up);var r=qa.crossVectors(t.dir,n.dir);if(r.length()>Number.EPSILON){r.normalize();var o=Math.acos(Math.min(Math.max(t.dir.dot(n.dir),-1),1));n.up.applyMatrix4(Xa.makeRotationAxis(r,o))}n.right.crossVectors(n.dir,n.up).normalize(),n.dist=t.dist+i,n.widthScale=1,n.sharp=!1,this.count++},Va.prototype._getByIndex=function(e){return this.array[e]||(this.array[e]=new Ua),this.array[e]},Va.prototype._getCornerBezierCurve=function(e,t,n,i,r){var o=qa.subVectors(t,e),a=Ga.subVectors(n,t),s=o.length(),l=a.length();return o.normalize(),a.normalize(),s>i?r.v0.copy(t).sub(o.multiplyScalar(i)):r.v0.copy(e),r.v1.copy(t),l>i?r.v2.copy(t).add(a.multiplyScalar(i)):r.v2.copy(n),r};var Ya=function(e){THREE.BufferGeometry.call(this),e=e||3e3,this.setAttribute?(this.setAttribute("position",new THREE.BufferAttribute(new Float32Array(3*e),3).setUsage(THREE.DynamicDrawUsage)),this.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(3*e),3).setUsage(THREE.DynamicDrawUsage)),this.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(2*e),2).setUsage(THREE.DynamicDrawUsage))):(this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(3*e),3).setDynamic(!0)),this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(3*e),3).setDynamic(!0)),this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(2*e),2).setDynamic(!0))),this.drawRange.start=0,this.drawRange.count=0,this.setIndex(new Array(2*e))};Ya.prototype=Object.assign(Object.create(THREE.BufferGeometry.prototype),{constructor:Ya,update:function(e,t){t=t||{};var n=this._updateAttributes(e,t);this.drawRange.count=n},_resizeAttribute:function(e,t,n){for(;t.array.length<n;){var i=t.array.length,r=new THREE.BufferAttribute(new Float32Array(2*i),t.itemSize,t.normalized);r.name=t.name,r.usage=t.usage,this.setAttribute?this.setAttribute(e,r):this.addAttribute(e,r),t=r}},_resizeIndex:function(e,t){for(;e.array.length<t;){var n=e.array.length,i=new THREE.BufferAttribute(2*n>65535?new Uint32Array(2*n):new Uint16Array(2*n),1);i.name=e.name,i.usage=e.usage,this.setIndex(i),e=i}},_updateAttributes:function(e,t){var n=t.width||.1,i=void 0!==t.progress?t.progress:1,r=void 0===t.arrow||t.arrow,o=void 0!==t.side?t.side:"both",a=0,s=[],l=[],u=[],c=[],h=0,p=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Vector3,m=new THREE.Vector3,g=new THREE.Vector3,v=new THREE.Vector3;function y(e,t,i){var r=0===s.length,y=e.sharp&&!r,b=e.dir,_=e.up,x=e.right;if("left"!==o?p.copy(x).multiplyScalar(t*e.widthScale):p.set(0,0,0),"right"!==o?d.copy(x).multiplyScalar(-t*e.widthScale):d.set(0,0,0),p.add(e.pos),d.add(e.pos),y){f.fromArray(s,s.length-6).sub(d),m.fromArray(s,s.length-3).sub(p);var E,w,T=f.length()-m.length();T>0?(E=f,w=d):(E=m,w=p),g.copy(E).setLength(Math.abs(T)).add(w);var M=v.copy(w).sub(g).normalize().dot(b)*v.copy(w).sub(g).length()*2;v.copy(b).setLength(M).add(g),T>0?(s.push(g.x,g.y,g.z,p.x,p.y,p.z,d.x,d.y,d.z,p.x,p.y,p.z,v.x,v.y,v.z,p.x,p.y,p.z),h+=6,c.push(h-6,h-8,h-7,h-6,h-7,h-5,h-4,h-6,h-5,h-2,h-4,h-1),a+=12):(s.push(d.x,d.y,d.z,g.x,g.y,g.z,d.x,d.y,d.z,p.x,p.y,p.z,d.x,d.y,d.z,v.x,v.y,v.z),h+=6,c.push(h-6,h-8,h-7,h-6,h-7,h-5,h-6,h-5,h-3,h-2,h-3,h-1),a+=12),l.push(_.x,_.y,_.z,_.x,_.y,_.z,_.x,_.y,_.z,_.x,_.y,_.z,_.x,_.y,_.z,_.x,_.y,_.z);var S=t/("both"!==o?n/2:n);u.push(i-S,0,i-S,1,i,0,i,1,i+S,0,i+S,1)}else s.push(d.x,d.y,d.z,p.x,p.y,p.z),l.push(_.x,_.y,_.z,_.x,_.y,_.z),u.push(i,0,i,1),h+=2,r||(c.push(h-2,h-4,h-3,h-2,h-3,h-1),a+=6)}var b=new THREE.Vector3;var _=e.distance();if(0==_)return 0;var x,E=i*_;if(E>0)for(var w=0;w<e.count;w++){var T=e.array[w];if(T.dist>E){var M=e.array[w-1];x=new Ua;var S=(E-M.dist)/(T.dist-M.dist);x.lerpPathPoints(M,T,S),y(x,n/2,x.dist/("both"!==o?n/2:n));break}y(T,n/2,T.dist/("both"!==o?n/2:n))}else x=e.array[0];r&&function(e,t,n){var i=e.dir,r=e.up,f=e.right;"left"!==o?p.copy(f).multiplyScalar(2*t):p.set(0,0,0),"right"!==o?d.copy(f).multiplyScalar(2*-t):d.set(0,0,0),b.copy(i).setLength(3*t),p.add(e.pos),d.add(e.pos),b.add(e.pos),s.push(d.x,d.y,d.z,p.x,p.y,p.z,b.x,b.y,b.z),l.push(r.x,r.y,r.z,r.x,r.y,r.z,r.x,r.y,r.z),u.push(n,"both"!==o?"right"!==o?-2:0:-.5,n,"both"!==o?"left"!==o?2:0:1.5,n+3*t/("both"!==o?t:2*t),"both"!==o?0:.5),h+=3,c.push(h-1,h-3,h-2),a+=3}(x=x||e.array[e.count-1],n/2,x.dist/("both"!==o?n/2:n));var C=this.getAttribute("position"),A=this.getAttribute("normal"),R=this.getAttribute("uv"),P=this.getIndex();return this._resizeAttribute("position",C,s.length),this._resizeAttribute("normal",A,l.length),this._resizeAttribute("uv",R,u.length),this._resizeIndex(P,c.length),C=this.getAttribute("position"),A=this.getAttribute("normal"),R=this.getAttribute("uv"),P=this.getIndex(),C.array.set(s,0),A.array.set(l,0),R.array.set(u,0),P.set(c,0),C.updateRange.count=s.length,A.updateRange.count=l.length,R.updateRange.count=u.length,P.updateRange.count=c.length,C.needsUpdate=!0,A.needsUpdate=!0,R.needsUpdate=!0,P.needsUpdate=!0,a}});var Qa=function(e){Ya.call(this,e||1e3)};Qa.prototype=Object.assign(Object.create(Ya.prototype),{constructor:Qa,_updateAttributes:function(e,t){var n=t.radius||.1,i=Math.max(2,t.radialSegments||8),r=t.startRad||0,o=void 0!==t.progress?t.progress:1,a=0,s=[],l=[],u=[],c=[],h=0,p=new THREE.Vector3;function d(e,t,n,i){for(var o=0===s.length,d=0;d<=n;d++){var f=d;f==n&&(f=0),p.copy(e.up).applyAxisAngle(e.dir,r+2*Math.PI*f/n).normalize(),s.push(e.pos.x+p.x*t*e.widthScale,e.pos.y+p.y*t*e.widthScale,e.pos.z+p.z*t*e.widthScale),l.push(p.x,p.y,p.z),u.push(i,d/n),h++}if(!o)for(var m=h-2*(n+1),g=h-(n+1),v=0;v<n;v++)c.push(g+v,m+v,m+v+1,g+v,m+v+1,g+v+1),a+=6}var f=o*e.distance();if(0==f)return 0;if(f>0)for(var m=0;m<e.count;m++){var g=e.array[m];if(g.dist>f){var v=e.array[m-1],y=new Ua,b=(f-v.dist)/(g.dist-v.dist);y.lerpPathPoints(v,g,b),d(y,n,i,y.dist/(2*n*Math.PI));break}d(g,n,i,g.dist/(2*n*Math.PI))}var _=this.getAttribute("position"),x=this.getAttribute("normal"),E=this.getAttribute("uv"),w=this.getIndex();return this._resizeAttribute("position",_,s.length),this._resizeAttribute("normal",x,l.length),this._resizeAttribute("uv",E,u.length),this._resizeIndex(w,c.length),_=this.getAttribute("position"),x=this.getAttribute("normal"),E=this.getAttribute("uv"),w=this.getIndex(),_.array.set(s,0),x.array.set(l,0),E.array.set(u,0),w.set(c,0),_.updateRange.count=s.length,x.updateRange.count=l.length,E.updateRange.count=u.length,w.updateRange.count=c.length,_.needsUpdate=!0,x.needsUpdate=!0,E.needsUpdate=!0,w.needsUpdate=!0,a}});var Za=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.arrowFlag=!0,i.side="both",i.pathGeometry=new Ya,i.pathPointList=new Va,i}return a(t,e),t.prototype._updateByPoints=function(){e.prototype._updateByPoints.call(this),this.pathGeometry.update(this.pathPointList,{width:this.pathWidth,side:this.side,arrow:this.arrowFlag}),this.pathGeometry.computeBoundingSphere()},t.prototype.setup=function(t){var n=Ne.parseValue(t.arrowFlag,t.arrowCap);this.arrowFlag=Ne.parseValue(n,!0),e.prototype.setup.call(this,t)},o(t,[{key:"progress",set:function(e){this.pathGeometry.update(this.pathPointList,{width:this.pathWidth,arrow:this.arrowFlag,side:this.side,progress:THING.Math.clamp(e,0,1)})}},{key:"scrollUVRange",set:function(e){var t=this.length/this.pathWidth;this.uvRatio=t*e}},{key:"arrowCap",set:function(e){this.arrowFlag=e,this.pathGeometry.update(this.pathPointList,{width:this.pathWidth,arrow:this.arrowFlag,side:this.side})},get:function(){return this.arrowFlag}},{key:"isRouteLine",get:function(){return!0}}]),t}(Na),Ka=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.pathWidth=.2,i.pathRadialSegments=8,i.pathStartRad=0,i.pathGeometry=new Qa,i.pathPointList=new Va,i.pathUp=void 0,i.pathMaterial=new THREE.MeshStandardMaterial({transparent:!0,roughness:.5,metalness:.5}),i}return a(t,e),t.prototype._setupPathLine=function(t){t=t||{},e.prototype._setupPathLine.call(this,t)},t.prototype._updateByPoints=function(){e.prototype._updateByPoints.call(this),this.pathGeometry.update(this.pathPointList,{radius:this.pathWidth,radialSegments:this.pathRadialSegments,startRad:this.pathStartRad}),this.pathGeometry.computeBoundingSphere()},o(t,[{key:"progress",set:function(e){this.pathGeometry.update(this.pathPointList,{radius:this.pathWidth,radialSegments:this.pathRadialSegments,progress:THING.Math.clamp(e,0,1),startRad:this.pathStartRad})}},{key:"scrollUVRange",set:function(e){var t=this.length/(2*this.pathWidth*Math.PI);this.uvRatio=t*e}},{key:"isPolygonLine",get:function(){return!0}}]),t}(Na),$a=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._pointSize=1,i._pointsMesh=null,i}return a(t,e),t.prototype._updateByPoints=function(){this.app.resourceManager.remove(this._pointsMesh);var e=(new THREE.BufferGeometry).setFromPoints(this._points),t=new THREE.PointsMaterial({size:this._pointSize,sizeAttenuation:!1});this._pointsMesh=new THREE.Points(e,t),this.node.add(this._pointsMesh)},t.prototype._beforeSetupComplete=function(e){this._pointSize=e.pointSize||this._pointSize;var t=e.points;t&&this.addPoints(t)},t}(Pa),es=function e(){r(this,e),this.strId="",this.fPPAfterImageValue=0,this.listGroups=new Array;var t=new ts;this.listGroups[0]=t,this._attr="ParticleData"};es.prototype={getAttr:function(){return this._attr}};var ts=function e(){r(this,e),this.strId="",this.texture=new is,this.fFixedTimeStep=.33,this.strUseMesh="false",this.strMeshUrl="BuildIn/Box",this.arrayMeshParams=new Array,this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.strHasPerspective="true",this.strIsColorize="true",this.iBlendingMode=1,this.strIsTransparent="true",this.fAlphaTest=0,this.strIsDepthWrite="false",this.strIsDepthTest="false",this.strIsFog="false",this.strEnableTrail="false",this.textureTrail=new is,this.fTrailLife=.5,this.fTrailWidthStart=1,this.fTrailWidthEnd=1,this.fScale=window.innerHeight/2,this.iMaxParticleCount=500,this.vec4Quaternion=new THREE.Vector4(0,0,0,1),this.listEmitters=new Array;var t=new ns;this.listEmitters[0]=t},ns=function e(){r(this,e),this.strId="",this.iDistribution=1,this.iParticleCount=100,this.fDuration=-1,this.strIsStatic="false",this.strIsLookAtCamera="false",this.strIsLookAtCameraOnlyY="false",this.fActiveMultiplier=1,this.iDirection=1,this.maxAge=new rs,this.position=new os,this.velocity=new as,this.acceleration=new ss,this.drag=new ls,this.wiggle=new us,this.rotation=new hs,this.trail=new cs,this.listColor=new Array;var t=new ps;this.listColor[0]=t,this.listOpacity=new Array;var n=new ds;this.listOpacity[0]=n,this.listSize=new Array;var i=new fs;this.listSize[0]=i,this.listAngle=new Array;var o=new ms;this.listAngle[0]=o},is=function e(){r(this,e),this.name="32x32_star.png",this.url="http://static.3dmomoda.com/textures/18092617nyspq5moaka1i2fhvs1hh66s.png",this.vec2Frames=new THREE.Vector2(1,1),this.iFrameCount=1,this.iLoop=1},rs=function e(){r(this,e),this.fValue=1,this.fSpread=1},os=function e(){r(this,e),this.vec3Value=new THREE.Vector3(0,0,0),this.vec3Spread=new THREE.Vector3(0,0,0),this.vec3SpreadClamp=new THREE.Vector3(0,0,0),this.fRadius=0,this.vec3RadiusScale=new THREE.Vector3(1,1,1),this.iDistribution=1,this.strIsRandomise="false"},as=function e(){r(this,e),this.vec3Value=new THREE.Vector3(0,10,0),this.vec3Spread=new THREE.Vector3(10,0,10),this.iDistribution=1,this.strIsRandomise="false"},ss=function e(){r(this,e),this.vec3Value=new THREE.Vector3(0,0,0),this.vec3Spread=new THREE.Vector3(0,0,0),this.iDistribution=1,this.strIsRandomise="false"},ls=function e(){r(this,e),this.fValue=0,this.fSpread=0,this.strIsRandomise="false"},us=function e(){r(this,e),this.fValue=0,this.fSpread=0},cs=function e(){r(this,e),this.fValue=0,this.fSpread=0,this.fStep=0,this.fStepSpread=0},hs=function e(){r(this,e),this.vec3Axis=new THREE.Vector3(0,0,0),this.vec3AxisSpread=new THREE.Vector3(0,0,0),this.fAngle=0,this.fAngleSpread=0,this.strIsStatic="false",this.vec3Center=new THREE.Vector3(0,0,0),this.strIsRandomise="false"},ps=function e(){r(this,e),this.vec3Value=new THREE.Vector3(1,1,1),this.vec3Spread=new THREE.Vector3(0,0,0),this.strIsRandomise="false"},ds=function e(){r(this,e),this.fValue=1,this.fSpread=0,this.strIsRandomise="false"},fs=function e(){r(this,e),this.fValue=1,this.fSpread=0,this.strIsRandomise="false"},ms=function e(){r(this,e),this.fValue=0,this.fSpread=0,this.strIsRandomise="false"},gs=function(){var e="[BufferGeometryHelper.js] : ";this.bEnableLog=!0,this.bufferGeometry=null,this.jsonLoader=new THREE.BufferGeometryLoader,this.objLoader=new THREE.OBJLoader,this.strMeshUrl=null;var t=this;this.init=function(n,r){if(t.bEnableLog&&console.log(e+"[init];"),null!=r&&null!=r){if(null==n||null==n||"object"!=(void 0===n?"undefined":i(n)))return console.error(e+"[init] : options == null;"),void r(null);if(null==n.strMeshUrl||null==n.strMeshUrl||"string"!=typeof n.strMeshUrl)return console.error(e+"[init] : options.strMeshUrl == null;"),void r(null);t.strMeshUrl=n.strMeshUrl,null!=t.bufferGeometry&&null!=t.bufferGeometry&&(t.bufferGeometry.dispose(),t.bufferGeometry=null);if(n.strMeshUrl.indexOf("BuildIn")>=0){var o=!1;return n.strMeshUrl.indexOf("Box")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a BoxBufferGeometry;"),o=!t.checkParams(n.params,3),t.bufferGeometry=o?new THREE.BoxBufferGeometry(1,1,1):new THREE.BoxBufferGeometry(n.params[0],n.params[1],n.params[2])),n.strMeshUrl.indexOf("Cylinder")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a CylinderBufferGeometry;"),o=!t.checkParams(n.params,4),t.bufferGeometry=o?new THREE.CylinderBufferGeometry(1,1,1,6):new THREE.CylinderBufferGeometry(n.params[0],n.params[1],n.params[2],n.params[3]<=12?n.params[3]:12)),n.strMeshUrl.indexOf("Cone")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a ConeBufferGeometry;"),o=!t.checkParams(n.params,3),t.bufferGeometry=o?new THREE.ConeBufferGeometry(1,1,6):new THREE.ConeBufferGeometry(n.params[0],n.params[1],n.params[2]<=12?n.params[2]:12)),n.strMeshUrl.indexOf("Circle")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a CircleBufferGeometry;"),o=!t.checkParams(n.params,2),t.bufferGeometry=o?new THREE.CircleBufferGeometry(1,6):new THREE.CircleBufferGeometry(n.params[0],n.params[1]<=12?n.params[1]:12)),n.strMeshUrl.indexOf("Dodecahedron")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a DodecahedronBufferGeometry;"),o=!t.checkParams(n.params,2),t.bufferGeometry=o?new THREE.DodecahedronBufferGeometry(1,0):new THREE.DodecahedronBufferGeometry(n.params[0],n.params[1]<=1?n.params[1]:1)),n.strMeshUrl.indexOf("Icosahedron")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a IcosahedronBufferGeometry;"),o=!t.checkParams(n.params,2),t.bufferGeometry=o?new THREE.IcosahedronBufferGeometry(1,0):new THREE.IcosahedronBufferGeometry(n.params[0],n.params[1]<=1?n.params[1]:1)),n.strMeshUrl.indexOf("Octahedron")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a OctahedronBufferGeometry;"),o=!t.checkParams(n.params,2),t.bufferGeometry=o?new THREE.OctahedronBufferGeometry(1,0):new THREE.OctahedronBufferGeometry(n.params[0],n.params[1]<=2?n.params[1]:1)),n.strMeshUrl.indexOf("Plane")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a PlaneBufferGeometry;"),o=!t.checkParams(n.params,2),t.bufferGeometry=o?new THREE.PlaneBufferGeometry(1,0):new THREE.PlaneBufferGeometry(n.params[0],n.params[1])),n.strMeshUrl.indexOf("Ring")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a RingBufferGeometry;"),o=!t.checkParams(n.params,3),t.bufferGeometry=o?new THREE.RingBufferGeometry(1,2,12,1):new THREE.RingBufferGeometry(n.params[0],n.params[1],n.params[2]<=12?n.params[2]:12,1)),n.strMeshUrl.indexOf("Sphere")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a SphereBufferGeometry;"),o=!t.checkParams(n.params,3),t.bufferGeometry=o?new THREE.SphereBufferGeometry(1,8,8):new THREE.SphereBufferGeometry(n.params[0],n.params[1]<=12?n.params[1]:12,n.params[2]<=12?n.params[2]:12)),n.strMeshUrl.indexOf("Tetrahedron")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a TetrahedronBufferGeometry;"),o=!t.checkParams(n.params,2),t.bufferGeometry=o?new THREE.TetrahedronBufferGeometry(1,0):new THREE.TetrahedronBufferGeometry(n.params[0],n.params[1]<=2?n.params[1]:2)),n.strMeshUrl.indexOf("Torus")>=0&&n.strMeshUrl.indexOf("TorusKnot")<0&&(t.bEnableLog&&console.log(e+"[init] : it's a TorusBufferGeometry;"),o=!t.checkParams(n.params,4),t.bufferGeometry=o?new THREE.TorusBufferGeometry(1,1,8,8):new THREE.TorusBufferGeometry(n.params[0],n.params[1],n.params[2]<=12?n.params[2]:12,n.params[3]<=12?n.params[3]:12)),n.strMeshUrl.indexOf("TorusKnot")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a TorusKnotBufferGeometry;"),o=!t.checkParams(n.params,6),t.bufferGeometry=o?new THREE.TorusKnotBufferGeometry(1,1,32,8,2,3):new THREE.TorusKnotBufferGeometry(n.params[0],n.params[1],n.params[2]<=32?n.params[2]:32,n.params[3]<=12?n.params[3]:12,n.params[4]<=12?n.params[4]:12,n.params[5]<=12?n.params[5]:12)),void r(t.bufferGeometry)}var a=n.strMeshUrl.indexOf(".json");a>=0&&a+".json".length==n.strMeshUrl.length&&(t.bEnableLog&&console.log(e+"[init] : it's a .json file to BufferGeometry;"),t.jsonLoader.load(Globals.strParticleMeshRootPath+n.strMeshUrl,(function(i){return null!=i&&null!=i?(t.bufferGeometry=i,void r(t.bufferGeometry)):(console.error(e+"[init] : failed load the .json file to BufferGeometry; strMeshUrl = "+n.strMeshUrl),void r(null))})));var s=n.strMeshUrl.indexOf(".obj");s>=0&&s+".obj".length==n.strMeshUrl.length&&(t.bEnableLog&&console.log(e+"[init] : it's a .obj file to BufferGeometry;"),t.objLoader.load(Globals.strParticleMeshRootPath+n.strMeshUrl,(function(i){if(null!=i&&null!=i&&null!=i.children){for(var o=null,a=0,s=i.children.length;a<s;a++)if(i.children[a]instanceof THREE.Mesh){o=i.children[a];break}if(null!=o){var l=(new THREE.BufferGeometry).fromGeometry(o.geometry);return null!=l&&null!=l?(t.bufferGeometry=l,void r(t.bufferGeometry)):(console.error(e+"[init] : failed transform the .obj file to BufferGeometry; strMeshUrl = "+n.strMeshUrl),void r(null))}return console.error(e+"[init] : failed load the .obj file to BufferGeometry; can not find a mesh; strMeshUrl = "+n.strMeshUrl),void r(null)}}),(function(e){}),(function(t){console.error(e+"[init] : failed load the .obj file to BufferGeometry; strMeshUrl = "+n.strMeshUrl+"; error = "+t),r(null)})))}else console.error(e+"[init] : onFinished == null;")},this.checkParams=function(t,n){if(null==t||null==t||"object"!=(void 0===t?"undefined":i(t)))return console.warn(e+"[checkParams] : params == null;"),!1;if(t.length<n)return console.warn(e+"[checkParams] : params.length < "+n),!1;for(var r=0;r<n;r++)if(null==t[r]||null==t[r]||"number"!=typeof t[r])return console.warn(e+"[checkParams] : error params["+r+"];"),!1;return!0}},vs=function(){function e(t,n,i){r(this,e),this._options=t,this._emitter=n,this._particleGroup=i,this._emitter||this.refresh()}return e.prototype.cloneOptions=function(){return Ne.cloneObject(this._options,!1,null,(function(e,t){if(Ne.isFunction(e.clone))return e.clone()}))},e.prototype.refresh=function(){this._emitter&&(this._particleGroup._group.removeEmitter(this._emitter),this._emitter=null);var e=this.cloneOptions();this._particleGroup._options.useMesh?this._emitter=new MSPE.Emitter(e):this._emitter=new SPE.Emitter(e),this._particleGroup._group.addEmitter(this._emitter)},o(e,[{key:"options",set:function(e){e&&(Ne.mergeObject(this._options,e,!0),this.refresh())},get:function(){return this._options}}]),e}(),ys=function(){function e(t,n,i){r(this,e),this._options=t,this._group=n,this._particleSystem=i,this._emitters=[],this._group||this.refresh()}return e.prototype.cloneOptions=function(){var e=Ne.cloneObject(this._options,!1,(function(e){return"texture"!=e&&"bufferGeometry"!=e}),(function(e,t){if(Ne.isFunction(e.clone))return e.clone()})),t=this._options.vec4Quaternion;return t&&(e.vec4Quaternion=t.clone()),e},e.prototype.refresh=function(){-1===this._particleSystem._groups.indexOf(this)&&this._particleSystem._groups.push(this),this._group&&this._group.mesh&&this._particleSystem.node.remove(this._group.mesh);for(var e=0;e<this._emitters.length;e++){var t=this._emitters[e];this._group.removeEmitter(t._emitter)}var n=this.cloneOptions();n.useMesh?this._group=new MSPE.Group(n):this._group=new SPE.Group(n);for(e=0;e<this._emitters.length;e++){var i=this._emitters[e],r=i.cloneOptions();for(var o in this._particleSystem._particleOptions){var a=this._particleSystem._particleOptions[o];Ne.isNull(a)||(r[o]=a)}n.useMesh?i._emitter=new MSPE.Emitter(r):i._emitter=new SPE.Emitter(r),this._group.addEmitter(i._emitter)}var s=this._group.mesh;s&&(this._particleSystem.node.add(s),s.setFrustumCulled(!1))},e.prototype.tick=function(e,t){this._group.tick(e,t)},e.prototype.addEmitter=function(e){return new vs(e,null,this)},e.prototype.removeEmitter=function(e){for(var t=0;t<this._emitters.length;t++)if(e==this._emitters[t]){this._emitters.splice(t,1),this._group.removeEmitter(e._emitter);break}},o(e,[{key:"options",set:function(e){e&&(Ne.mergeObject(this._options,e,!0),this.refresh())},get:function(){return this._options}}]),e}(),bs=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._groups=[],i._particleOptions={},i._groupOptions={},i}return a(t,e),t.prototype.loadFromURL=function(e,t){var n=this;e.node||(e.node=new THREE.Group);var i=e.url,r=this.app.particleResource.get(i);r?this.loadComplete(r,e,t):this.app.particleResource.download(i,(function(i){n.loadComplete(i,e,t)}))},t.prototype.loadComplete=function(e,t,n){this.setupParticleData(e,t),this.setupUserData(t),null!=n&&n()},t.prototype.customSetup=function(e){this.tickable=!0},t.prototype.update=function(t){e.prototype.update.call(this,t);for(var n=0;n<this._groups.length;n++){this._groups[n].tick(t,this.app.renderCamera)}return!0},t.prototype.parseEmitterOptions=function(e,t){var n=new THREE.Vector3(e.position.vec3Value.x,e.position.vec3Value.y,e.position.vec3Value.z),i=new THREE.Vector3(e.position.vec3Spread.x,e.position.vec3Spread.y,e.position.vec3Spread.z),r=new THREE.Vector3(e.position.vec3SpreadClamp.x,e.position.vec3SpreadClamp.y,e.position.vec3SpreadClamp.z),o=!1;o="true"==e.position.strIsRandomise.valueOf();var a=new THREE.Vector3(e.velocity.vec3Value.x,e.velocity.vec3Value.y,e.velocity.vec3Value.z),s=new THREE.Vector3(e.velocity.vec3Spread.x,e.velocity.vec3Spread.y,e.velocity.vec3Spread.z);e.velocity.strIsRandomise.valueOf();var l=new THREE.Vector3(e.acceleration.vec3Value.x,e.acceleration.vec3Value.y,e.acceleration.vec3Value.z),u=new THREE.Vector3(e.acceleration.vec3Spread.x,e.acceleration.vec3Spread.y,e.acceleration.vec3Spread.z),c=!1;c="true"==e.acceleration.strIsRandomise.valueOf();var h=!1;h="true"==e.strIsStatic.valueOf();var p=new THREE.Vector3(e.rotation.vec3Axis.x,e.rotation.vec3Axis.y,e.rotation.vec3Axis.z),d=new THREE.Vector3(e.rotation.vec3AxisSpread.x,e.rotation.vec3AxisSpread.y,e.rotation.vec3AxisSpread.z),f=new THREE.Vector3(e.rotation.vec3Center.x,e.rotation.vec3Center.y,e.rotation.vec3Center.z),m=!1;m="true"==e.rotation.strIsStatic.valueOf();var g=!1;g="true"==e.rotation.strIsRandomise.valueOf();var v=new Array,y=new Array,b=new Array;if(e.listColor.length>0)for(var _=0,x=e.listColor.length;_<x;_++)v.push(new THREE.Color(e.listColor[_].vec3Value.x,e.listColor[_].vec3Value.y,e.listColor[_].vec3Value.z)),y.push(new THREE.Vector3(e.listColor[_].vec3Spread.x,e.listColor[_].vec3Spread.y,e.listColor[_].vec3Spread.z)),"true"==e.listColor[_].strIsRandomise.valueOf()?b.push(!0):b.push(!1);else v.push(new THREE.Color("white")),y.push(new THREE.Vector3(0,0,0)),b.push(!1);var E=new Array,w=new Array,T=new Array;if(e.listOpacity.length>0)for(_=0,x=e.listOpacity.length;_<x;_++)E.push(e.listOpacity[_].fValue),w.push(e.listOpacity[_].fSpread),"true"==e.listOpacity[_].strIsRandomise.valueOf()?T.push(!0):T.push(!1);else E.push(1),w.push(0),T.push(!1);var M=new Array,S=new Array,C=new Array;if(e.listSize.length>0)for(_=0,x=e.listSize.length;_<x;_++)M.push(e.listSize[_].fValue),S.push(e.listSize[_].fSpread),"true"==e.listSize[_].strIsRandomise.valueOf()?C.push(!0):C.push(!1);else M.push(1),S.push(0),C.push(!1);var A=new Array,R=new Array,P=new Array;if(e.listAngle.length>0)for(_=0,x=e.listAngle.length;_<x;_++)A.push(e.listAngle[_].fValue),R.push(e.listAngle[_].fSpread),"true"==e.listAngle[_].strIsRandomise.valueOf()?C.push(!0):P.push(!1);else A.push(0),R.push(0),P.push(!1);var D={type:e.iDistribution,particleCount:e.iParticleCount,duration:e.fDuration<=0?void 0:e.fDuration,isStatic:h,isLookAtCamera:"true"==e.strIsLookAtCamera,isLookAtCameraOnlyY:"true"==e.strIsLookAtCameraOnlyY,activeMultiplier:e.fActiveMultiplier,direction:e.iDirection,maxAge:{value:e.maxAge.fValue,spread:e.maxAge.fSpread},position:{value:n,spread:i,spreadClamp:r,radius:e.position.fRadius,radiusScale:new THREE.Vector3(1,1,1),randomise:o},radius:{value:5,spread:0,scale:new THREE.Vector3(1,1,1),spreadClamp:new THREE.Vector3(2,2,2)},velocity:{value:a,spread:s,randomise:!1},acceleration:{value:l,spread:u,randomise:c},drag:{value:e.drag.fValue,spread:e.drag.fSpread},wiggle:{value:e.wiggle.fValue,spread:e.wiggle.fSpread},rotation:{axis:p,axisSpread:d,angle:e.rotation.fAngle,angleSpread:e.rotation.fAngleSpread,static:m,center:f,randomise:g},color:{value:v,spread:y,randomise:b},opacity:{value:E,spread:w,randomise:T},size:{value:M,spread:S,randomise:C},angle:{value:A,spread:R,randomise:P}},k=this.app.renderer.capabilities.maxVaryings;for(var j in k>15&&(D.trail={value:e.trail.fValue,spread:e.trail.fSpread,step:e.trail.fStep,stepSpread:e.trail.fStepSpread}),this._particleOptions){var O=this._particleOptions[j];Ne.isNull(O)||(D[j]=O)}return D},t.prototype.parseGroupOptions=function(e,t){var n=this.app.calcRect(),i={texture:{value:t,frames:e.texture.vec2Frames,frameCount:e.texture.iFrameCount,loop:e.texture.iLoop},fixedTimeStep:e.fFixedTimeStep,hasPerspective:"true"==e.strHasPerspective,colorize:"true"==e.strIsColorize,blending:e.iBlendingMode,transparent:"true"==e.strIsTransparent,alphaTest:e.fAlphaTest,depthWrite:"true"==e.strIsDepthWrite,depthTest:"true"==e.strIsDepthTest,fog:"true"==e.strIsFog,scale:n.height/2,maxParticleCount:e.iMaxParticleCount,useMesh:"true"==e.strUseMesh},r=e.vec4Quaternion;for(var o in r&&(i.vec4Quaternion=new THREE.Quaternion(r.x,r.y,r.z,r.w)),this._groupOptions){var a=this._groupOptions[o];Ne.isNull(a)||(i[o]=a)}return i},t.prototype.setupParticleEmitter=function(e,t,n){var i=this.parseEmitterOptions(e,t),r=new vs(i,null,n);n._emitters.push(r)},t.prototype.setupParticleEmitters=function(e,t){for(var n=0;n<e.listEmitters.length;n++){var i=e.listEmitters[n];this.setupParticleEmitter(i,e,t)}this.static&&this.node._synMatrixWorld()},t.prototype.createParticleGroup=function(e){return new ys(e,null,this)},t.prototype.setupParticleGroup=function(e,t){var n=this,i=new THREE.TextureLoader;i.setCrossOrigin("anonymous");var r=e.texture.url;r.startsWith("http://")||r.startsWith("https://")||(r.startsWith(".")||(r="."+r),t.startsWith("http://")||t.startsWith("https://")||t.startsWith(".")||(t="."+t),r.startsWith(t)||(r=t.appendPath(r))),i.load(r,(function(t){var i=n.parseGroupOptions(e,t);if(i.useMesh){var r=new gs;r.bEnableLog=!1,r.init({strMeshUrl:e.strMeshUrl,params:e.arrayMeshParams},(function(t){i.bufferGeometry=t;var r=n.createParticleGroup(i);n.setupParticleEmitters(e,r)}))}else{var o=n.createParticleGroup(i);n.setupParticleEmitters(e,o)}}))},t.prototype.setupParticleData=function(e,t){var n=new es;(n=e).__proto__=es.prototype;for(var i=t.url,r=0;r<n.listGroups.length;r++){var o=n.listGroups[r];this.setupParticleGroup(o,i)}},t.prototype.refresh=function(){for(var e=0;e<this._groups.length;e++){this._groups[e].refresh()}},t.prototype.setParticleAttribute=function(e,t){this._particleOptions[e]=t,this.refresh()},t.prototype.setGroupAttribute=function(e,t){this._groupOptions[e]=t,this.refresh()},o(t,[{key:"gravityPosition",set:function(e){var t=Ne.parseVector3(e),n=Ne.parseVector3(this.position),i=new THREE.Vector3;i.subVectors(t,n).normalize();var r=new THREE.Quaternion;r.setFromUnitVectors(new THREE.Vector3(0,-1,0),i);for(var o=0;o<this._groups.length;o++){var a=this._groups[o];a.options.vec4Quaternion=new THREE.Vector4(r.x,r.y,r.z,r.w),a.refresh()}}}]),t}(Lt),_s=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._scale=4,i._color="#FFFFFF",i._flowDirection=new THREE.Vector2(1,1),i._textureWidth=1024,i._textureHeight=1024,i._normalMaps=[],i._normalMapsURL=[],i.water=null,i}return a(t,e),t.prototype._updateByPoints=function(){if(this._points.length){this.app.resourceManager.remove(this.water);var e=this._createPolygonVertices(!0),t=this._createPolygonGeometry(e.vertices,e.faces),n=0;if(e.vertices.length){for(var i=0;i<e.vertices.length;i++)n+=e.vertices[i].z;n/=e.vertices.length}this.water=new THREE.Water(t,{color:this._color,scale:this._scale,flowDirection:this._flowDirection,textureWidth:this._textureWidth,textureHeight:this._textureHeight,normalMap0:this._normalMaps[0],normalMap1:this._normalMaps[1]}),this.water.position.y=n,this.water.scale.y*=-1,this.water.rotation.x=-.5*Math.PI,this.node.add(this.water)}},t.prototype._createByGeometry=function(){if(this.geometryInParam){this.app.resourceManager.remove(this.water);var e=this.geometryInParam;this.water=new THREE.Water(e,{color:this._color,scale:this._scale,flowDirection:this._flowDirection,textureWidth:this._textureWidth,textureHeight:this._textureHeight,normalMap0:this._normalMaps[0],normalMap1:this._normalMaps[1]}),this.node.add(this.water)}},t.prototype._setupTextures=function(e){for(var t=new THREE.TextureLoader,n=[e.normalMap0||"images/water/Water_1_M_Normal.jpg",e.normalMap1||"images/water/Water_2_M_Normal.jpg"],i=0;i<n.length;i++){var r=n[i];r&&(this._normalMapsURL.push(r),this._normalMaps.push(t.load(this.app.confirmURL(r))))}this._textureWidth=1024,this._textureHeight=1024},t.prototype.customSetup=function(t){e.prototype.customSetup.call(this,t),this._scale=Ne.parseValue(t.waterScale,4),this._color=Ne.parseColor(t.waterColor,"#FFFFFF"),this._flowDirection=Ne.parseVector2(t.flowDirection,new THREE.Vector2(1,1)),this._setupTextures(t),t.geometry&&(this.geometryInParam=t.geometry,this._createByGeometry());var n=t.points;n&&this.addPoints(n)},t.prototype._afterSetupComplete=function(e){e.position||e.localPosition||this.useBottomCenterOfBoundingBoxAsPosition()},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);t.waterScale=this._scale,t.waterColor=this._color,t.flowDirection=this._flowDirection,t.points=this.points;for(var n=0;n<this._normalMapsURL.length;n++)t["normalMap"+n]=this._normalMapsURL[n];return t},t.prototype.setEffect=function(e){console.warn("[Water] Please use '.style.setEffect()' to replace '.setEffect()'"),this.style.setEffect(e)},o(t,[{key:"isWater",get:function(){return!0}}]),t}(Pa),xs=new THREE.Vector3,Es=new THREE.Vector3,ws=new THREE.Matrix4,Ts=new THREE.Raycaster;Ts.params.Line.threshold=0;var Ms=function(e){function t(n){r(this,t);var i=s(this,e.call(this));return i.geometry.addAttribute("position",new THREE.Float32BufferAttribute(new Array(24).fill(0),3)),i.geometry.addAttribute("color",new THREE.Float32BufferAttribute(new Array(24).fill(1),3)),i._camera=n,i}return a(t,e),t.prototype.update=function(e,t){var n=this;e.forEach((function(e,i){xs.set(e.x,e.y,1).applyMatrix4(ws.getInverse(n._camera.projectionMatrix)),xs.setLength(Math.min(xs.length(),t[i])),n.geometry.getAttribute("position").setXYZ(2*i+1,xs.x,xs.y,xs.z)})),this.geometry.getAttribute("position").needsUpdate=!0,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()},t}(THREE.LineSegments),Ss=function(e){function t(n,i){r(this,t);var o=new THREE.BufferGeometry,a=new THREE.MeshBasicMaterial({color:61183,opacity:.1,transparent:!0,side:THREE.DoubleSide}),l=s(this,e.call(this,o,a));o.addAttribute("position",new THREE.Float32BufferAttribute(new Array(3*i).fill(0),3));for(var u=[],c=0;c<i-2;c++)u.push(0,c+1,c+2);return o.setIndex(u),l._camera=n,l}return a(t,e),t.prototype.update=function(e,t){var n=this;e.forEach((function(e,i){xs.set(e.x,e.y,1).applyMatrix4(ws.getInverse(n._camera.projectionMatrix)),xs.setLength(Math.min(xs.length(),t[i])),n.geometry.getAttribute("position").setXYZ(i+1,xs.x,xs.y,xs.z)})),this.geometry.getAttribute("position").needsUpdate=!0,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()},t}(THREE.Mesh),Cs=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.tickable=!0,i._camera=new THREE.PerspectiveCamera(30,16/9,1,20),i._camera.matrixAutoUpdate=!1,i._cameraFrustum=new THREE.Frustum,i._cameraHelper=new THREE.CameraHelper(i._camera),i._cameraHelper.visible=!1,i._cameraHelper.matrix=new THREE.Matrix4,i._outMesh=new Ms(i._camera),i._outMesh.material.color.setHex(16777215),i._outMesh.visible=!1,i._horizontalScanningNum=15,i._verticalScanningNum=20,i._innerPlanes=[],i.node.add(i._cameraHelper),i.node.add(i._outMesh),i._innerScanning=!1,i._innerCounter=0,i._scanning=!1,i._scanningObject=null,i._cache={outer:[],inner:[]},i._useCache=!1,i}return a(t,e),t.prototype._updateCameraMatrixAndFrustum=function(){var e=this._camera;e.matrixWorld.copy(this.node.matrixWorld),e.matrixWorldInverse.getInverse(this.node.matrixWorld),ws.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._cameraFrustum.setFromProjectionMatrix(ws)},t.prototype.customSetup=function(e){void 0!==e.fov&&(this._camera.fov=e.fov),void 0!==e.aspect&&(this._camera.aspect=e.aspect),void 0!==e.near&&(this._camera.near=e.near),void 0!==e.far&&(this._camera.far=e.far),void 0!==e.debug&&(this._cameraHelper.visible=e.debug),void 0!==e.outerColor&&this._outMesh.material.color.set(Ne.parseColor(e.outerColor)),void 0!==e.innerScanning&&(this._innerScanning=!!e.innerScanning),void 0!==e.scanningNum&&(this._horizontalScanningNum=e.scanningNum[0],this._verticalScanningNum=e.scanningNum[1]),this._camera.updateProjectionMatrix(),this.node.updateMatrixWorld(!0),this._updateCameraMatrixAndFrustum()},t.prototype.update=function(t){return e.prototype.update.call(this,t),!this.visible||(this._updateCameraMatrixAndFrustum(),this._cameraHelper.visible&&this._cameraHelper.update(),this._scanning&&(this._innerCounter>this._verticalScanningNum?(this._scanning=!1,this._innerCounter=0,this._scanningObject=null,this._saveCache&&localStorage.setItem(this.name+"_scanning_data",JSON.stringify(this._cache))):(this._updateInnerPlane(this._innerCounter,this._scanningObject),this._innerCounter++)),!0)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.stop()},t.prototype.start=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(t&&(this.node.updateMatrixWorld(!0),this._updateCameraMatrixAndFrustum()),this._useCache=i,this._saveCache=r,i){var o=localStorage.getItem(this.name+"_scanning_data");o&&(this._cache=JSON.parse(o,(function(e,t){return null===t?1/0:t})))}var a=[new THREE.Vector2(-1,1),new THREE.Vector2(-1,-1),new THREE.Vector2(1,-1),new THREE.Vector2(1,1)],s=void 0;return this._useCache&&this._cache.outer.length>0?s=this._cache.outer:(s=a.map((function(t){Ts.setFromCamera(t,n._camera);var i=Ts.intersectObjects(e.getNodes(),!0);return i[0]?i[0].distance:1/0})),this._cache.outer=s,this._saveCache&&localStorage.setItem(this.name+"_scanning_data",JSON.stringify(this._cache))),this._outMesh.update(a,s),this._outMesh.visible=!0,this._innerScanning&&(this._innerCounter=0,this._scanning=!0,this._scanningObject=e||this.app.query(".Ground")),s},t.prototype.pause=function(){this._scanning&&(this._scanning=!1,this._innerCounter=0,this._scanningObject=null)},t.prototype.stop=function(){this._outMesh.visible=!1;for(var e=0;e<=this._verticalScanningNum;e++)this._innerPlanes[e]&&(this._innerPlanes[e].visible=!1);this._scanning=!1,this._innerCounter=0,this._scanningObject=null},t.prototype._updateInnerPlane=function(e,t){for(var n=this,i=2*e/this._verticalScanningNum-1,r=[],o=0;o<=this._horizontalScanningNum;o++){var a=2*o/this._horizontalScanningNum-1;r.push(new THREE.Vector2(a,i))}var s=void 0;this._useCache&&this._cache.inner[e]?s=this._cache.inner[e]:(s=r.map((function(e){Ts.setFromCamera(e,n._camera);var i=Ts.intersectObjects(t.getNodes(),!0);return i[0]?i[0].distance:1/0})),this._cache.inner[e]=s),this._innerPlanes[e]||(this._innerPlanes[e]=new Ss(this._camera,this._horizontalScanningNum+2),this.node.add(this._innerPlanes[e]),this._innerPlanes[e].visible=!1),this._innerPlanes[e].update(r,s),this._innerPlanes[e].visible=!0},t.prototype.test=function(e){var t=this,n=e.objects.filter((function(e){return t._cameraFrustum.intersectsBox(e.boundingBox.toBox())}));return n.filter((function(e){var i=xs.setFromMatrixPosition(t._camera.matrixWorld),r=e.boundingBox.toBox().getCenter(Es);Ts.set(i,r.sub(i).normalize());var o=Ts.intersectObjects(n.map((function(e){return e.node})),!0);return!!(o.length>0&&o[0].object.isChildOf(e.node))}))},t.prototype.testObject=function(e,n){var i=this,r=xs.setFromMatrixPosition(this._camera.matrixWorld),o=e.boundingBox.toBox().getCenter(Es);Ts.set(r,o.sub(r).normalize());var a=n.objects.filter((function(e){return i._cameraFrustum.intersectsBox(e.boundingBox.toBox())})),s=Ts.intersectObjects(a.map((function(e){return e.node})),!0);return s.length>0?s[0].object.isChildOf(e.node)?{state:t.VISIBLE,distance:s[0].distance,point:s[0].point}:{state:t.OBSCURED,distance:s[0].distance,point:s[0].point}:{state:t.OUT,distance:-1,point:null}},t.prototype._setNodeVisible=function(e){this.node.ensureVisible(e,this._autoSynVisible)},o(t,[{key:"fov",set:function(e){this._camera.fov=e,this._camera.updateProjectionMatrix(),this._updateCameraMatrixAndFrustum()},get:function(){return this._camera.fov}},{key:"aspect",set:function(e){this._camera.aspect=e,this._camera.updateProjectionMatrix(),this._updateCameraMatrixAndFrustum()},get:function(){return this._camera.aspect}},{key:"near",set:function(e){this._camera.near=e,this._camera.updateProjectionMatrix(),this._updateCameraMatrixAndFrustum()},get:function(){return this._camera.near}},{key:"far",set:function(e){this._camera.far=e,this._camera.updateProjectionMatrix(),this._updateCameraMatrixAndFrustum()},get:function(){return this._camera.far}}]),t}(Lt);Cs.OUT=0,Cs.VISIBLE=1,Cs.OBSCURED=2;var As={showHelper:!1,ambientLight:{intensity:.4,color:16777215},hemisphereLight:{intensity:0,color:16777215,groundColor:2236962},mainLight:{shadow:!1,shadowQuality:"high",shadowBias:-.003,intensity:.5,color:16777215,alpha:30,beta:30},secondaryLight:{shadow:!1,shadowQuality:"high",shadowBias:-.003,intensity:0,color:16777215,alpha:138,beta:0},tertiaryLight:{shadow:!1,shadowQuality:"high",shadowBias:-.003,intensity:0,color:16777215,alpha:0,beta:0}},Rs={showHelper:!1,ambientLight:{intensity:0},hemisphereLight:{intensity:0},mainLight:{intensity:0},secondaryLight:{intensity:0},tertiaryLight:{intensity:0}},Ps=new THREE.Sphere,Ds=new THREE.Vector3,ks=new THREE.Vector3,js=new THREE.Matrix4;function Os(e,t){if(t==1/0)return e.getLocalBoundingBox().toBox();var n=e.query("*").filter((function(e){return!(e.getBoundingBox(!1,!0).radius>t)})),i=new THREE.Box3;n.forEach((function(e){i.union(e.getBoundingBox(!1,!0).toBox())}));var r=new THREE.Matrix4;return e.node.updateWorldMatrix(!0,!1),r.getInverse(e.node.matrixWorld),i.applyMatrix4(r),i}var Fs=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.ambientLight=new THREE.AmbientLight,i.ambientLight.name="ambient_light",i.node.add(i.ambientLight),i.hemisphereLight=new THREE.HemisphereLight(16777215,2236962,1),i.hemisphereLight.name="hemisphere_light",i.node.add(i.hemisphereLight),i.mainLight=new THREE.DirectionalLight,i.mainLight.name="main_light",i.mainLight.helper=new THREE.DirectionalLightHelper(i.mainLight),i.mainLight.helper.matrix=i.mainLight.matrix,i.node.add(i.mainLight),i.node.add(i.mainLight.target),i.node.add(i.mainLight.helper),i.secondaryLight=new THREE.DirectionalLight,i.secondaryLight.name="secondary_light",i.secondaryLight.helper=new THREE.DirectionalLightHelper(i.secondaryLight),i.secondaryLight.helper.matrix=i.secondaryLight.matrix,i.node.add(i.secondaryLight),i.node.add(i.secondaryLight.target),i.node.add(i.secondaryLight.helper),i.tertiaryLight=new THREE.DirectionalLight,i.tertiaryLight.name="tertiary_light",i.tertiaryLight.helper=new THREE.DirectionalLightHelper(i.tertiaryLight),i.tertiaryLight.helper.matrix=i.tertiaryLight.matrix,i.node.add(i.tertiaryLight),i.node.add(i.tertiaryLight.target),i.node.add(i.tertiaryLight.helper),i._config=JSON.parse(JSON.stringify(As)),i._shadowObjectMaxSize=500,i}return a(t,e),t.prototype.customSetup=function(e){var t={};for(var n in As)e.hasOwnProperty(n)&&(t[n]=e[n]);this.setConfig(t),this.mainLight.helper.skipBoundingBox(!0),this.secondaryLight.helper.skipBoundingBox(!0),this.tertiaryLight.helper.skipBoundingBox(!0)},t.prototype.setConfig=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:JSON.parse(JSON.stringify(As)),t=arguments[1];Ne.mergeObject(this._config,e,!0);var n=this._config;if(!t){var i=this.parent?this.parent:this.app.root;t=n.mainLight.shadow||n.secondaryLight.shadow||n.tertiaryLight.shadow?Os(i,this._shadowObjectMaxSize):Os(i,1/0)}var r=t.getBoundingSphere(Ps);this.node.updateMatrixWorld(!0);var o=Ds.set(0,1,0).transformDirection(this.node.matrixWorld).normalize();this.ambientLight.intensity=n.ambientLight.intensity,this.ambientLight.color.set(Ne.parseColor(n.ambientLight.color)),this.hemisphereLight.intensity=n.hemisphereLight.intensity,this.hemisphereLight.color.set(Ne.parseColor(n.hemisphereLight.color)),this.hemisphereLight.groundColor.set(Ne.parseColor(n.hemisphereLight.groundColor)),this.hemisphereLight.position.copy(o),this.app.isMobileDevice&&(n.mainLight.castShadow=!1,n.secondaryLight.castShadow=!1,n.tertiaryLight.castShadow=!1),this._setDirectLight(this.mainLight,n.mainLight,r,n.showHelper,o),this._setDirectLight(this.secondaryLight,n.secondaryLight,r,n.showHelper,o),this._setDirectLight(this.tertiaryLight,n.tertiaryLight,r,n.showHelper,o),this.app.root.static&&this.node._synMatrixWorld(),this.app.needUpdate=!0},t.prototype.getConfig=function(){return this._config},t.prototype._setDirectLight=function(e,t,n,i,r){if(e.intensity=t.intensity,e.visible=t.intensity>0,e.color.set(Ne.parseColor(t.color)),e.position.copy(Ne.parseVector3(THING.Math.directionFromAlphaBeta(t.alpha,t.beta))),e.position.normalize().multiplyScalar(n.radius||1).add(n.center),e.target.position.copy(n.center),e.helper.visible=e.visible&&i,e.helper.visible&&this._updateHelper(e),e.castShadow=t.shadow&&!this.app.isMobileDevice,e.castShadow){var o=e.shadow.camera;o.top=o.right=n.radius,o.bottom=o.left=-n.radius,o.near=.1,o.far=2*n.radius,o.updateProjectionMatrix(),o.up.copy(r);var a={low:512,medium:1024,high:2048,ultra:4096}[t.shadowQuality]||1024;e.shadow.bias=t.shadowBias,e.shadow.radius=.1,e.shadow.mapSize.x===a&&e.shadow.mapSize.y===a||(e.shadow.map&&(e.shadow.map.dispose(),e.shadow.map=null),e.shadow.mapSize.set(a,a))}},t.prototype._updateHelper=function(e){var t=e.helper;void 0!==t.color?(t.lightPlane.material.color.set(t.color),t.targetLine.material.color.set(t.color)):(t.lightPlane.material.color.copy(t.light.color),t.targetLine.material.color.copy(t.light.color)),js.lookAt(ks.subVectors(e.target.position,e.position),new THREE.Vector3,new THREE.Vector3(0,1,0)),t.lightPlane.quaternion.setFromRotationMatrix(js),t.targetLine.quaternion.setFromRotationMatrix(js),t.targetLine.scale.z=ks.length()},t.prototype._setNodeVisible=function(e){this.node.ensureVisible(e,this._autoSynVisible)},o(t,[{key:"shadowObjectMaxSize",set:function(e){this._shadowObjectMaxSize!==e&&(this._shadowObjectMaxSize=e,this.setConfig({}))},get:function(){return this._shadowObjectMaxSize}}]),t}(Lt),Bs=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._lightAngle=30,i._distance=5,i._penumbra=.5,i._helper=null,i}return a(t,e),t.prototype.destroy=function(){this._helper&&this._helper.dispose(),e.prototype.destroy.call(this)},t.prototype._syn=function(){this._light.angle=THING.Math.degToRad(this._lightAngle),this._light.intensity=this.intensity,this._light.penumbra=this.penumbra,this._light.castShadow=this.castShadow,this._light.distance=this.distance},t.prototype._afterSetupComplete=function(e){var t=e.centerNodeName;t&&(this.centerNodeName=t),this._lightAngle=e.lightAngle||this._lightAngle,this._distance=e.distance||this._distance,this._penumbra=e.penumbra||this._penumbra;var n=e.projectTexture;this._light=n?new THREE.ProjectSpotLight:new THREE.SpotLight("#FFFFFF"),this._light.position.set(0,0,0),this._light.target.position.set(0,0,1),this.node.add(this._light),this.node.add(this._light.target);var i=e.target;i&&this.lookAt(i);var r=e.helper;r&&(this.helper=r),this._syn()},t.prototype._updateLightHelper=function(){var e=this._light.distance?this._light.distance:1e3,t=e*Math.tan(this._light.angle);this._helper.cone.scale.set(t,t,e),this._helper.cone.material.color.copy(this._light.color)},t.prototype.update=function(t){var n=e.prototype.update.call(this,t);return this._helper?(this._updateLightHelper(),!0):n},o(t,[{key:"lightAngle",set:function(e){this._lightAngle=e,this._syn()},get:function(){return this._lightAngle}},{key:"distance",set:function(e){this._distance=e,this._syn()},get:function(){return this._distance}},{key:"penumbra",set:function(e){this._penumbra=e,this._syn()},get:function(){return this._penumbra}},{key:"helper",set:function(e){e&&!this._helper?(this._helper=new THREE.SpotLightHelper(this._light),this._helper.matrix=this._light.matrix,this._helper.cone.quaternion.set(0,0,0,1),this.node.add(this._helper),this.tickable=!0):!e&&this._helper&&(this.node.remove(this._helper),this._helper.dispose(),this._helper=null)},get:function(){return!!this._helper}}]),t}(function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._intensity=1,i._castShadow=!1,i._light=null,i}return a(t,e),t.prototype._syn=function(){},t.prototype.customSetup=function(e){this._intensity=e.intensity||1,this._castShadow=e.castShadow||!1},t.prototype.toJSON=function(){return e.prototype.toJSON.call(this)},o(t,[{key:"intensity",set:function(e){this._intensity=e,this._syn()},get:function(){return this._intensity}},{key:"castShadow",set:function(e){this._castShadow=e,this._syn()},get:function(){return this._castShadow}},{key:"lightColor",set:function(e){var t=Ne.parseColor(e);t&&(this._light.color=t)},get:function(){return this._light.color.toHexString()}}]),t}(Lt)),Ls=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._image="",i._texture=null,i._width=10,i._scrollSpeed=0,i._resolution=new THREE.Vector2,i._updateResolutionFunc=i._updateResolution.bind(i),i._helpGeometry=new THREE.Geometry,i._meshline=new THREE.MeshLine,i._material=null,i._repeatX=1,i._offsetX=0,i._uvTransform=new THREE.Matrix3,i._synUvTransform(),i}return a(t,e),t.prototype._synUvTransform=function(){this._uvTransform.setUvTransform(this._offsetX,0,this._repeatX,1,0,0,0)},t.prototype._updateResolution=function(e){this._resolution.set(e.size[0],e.size[1])},t.prototype.customSetup=function(t){e.prototype.customSetup.call(this,t);var n=t.image;n&&(n.isTexture?(this._image=n.name,this._texture=n):(this._image=n,this._texture=this.app.resourceManager.loadTexture(n,void 0,{repeat:!0,anisotropy:16})));var i=t.points;i&&this.addPoints(i),this._width=t.width||this._width,this.uvRatio=t.uvRatio||1,this.scrollSpeed=t.scrollSpeed||this._scrollSpeed;var r=this.app.calcRect();this._resolution.set(r.width,r.height),this._material=new THREE.MeshLineMaterial({map:this._texture,useMap:!!this._texture,color:new THREE.Color(1,1,1),opacity:1,resolution:this._resolution,sizeAttenuation:!1,lineWidth:this._width,near:this.app.renderCamera.near,far:this.app.renderCamera.far,side:THREE.DoubleSide}),this._material.extensions.derivatives=!this.app.renderer.capabilities.isWebGL2,this._material.uniforms.uvTransform={type:"m3",value:this._uvTransform},this.app.on("resize",this._updateResolutionFunc);var o=new THREE.Mesh(this._meshline.geometry,this._material);this.node.add(o)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.app.off("resize",this._updateResolutionFunc)},t.prototype.update=function(t){var n=e.prototype.update.call(this,t);return this._material?(0!==this._scrollSpeed&&(this._offsetX+=this._scrollSpeed*t,this._synUvTransform()),!0):n},t.prototype._updateByPoints=function(){this._helpGeometry.vertices=this._points.map((function(e){return(new THREE.Vector3).fromArray(e)})),this._meshline.setGeometry(this._helpGeometry)},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.image=this._image,t.scrollSpeed=this._scrollSpeed,t.points=this.points,t},o(t,[{key:"uvRatio",set:function(e){this._repeatX=e,this._synUvTransform()}},{key:"width",set:function(e){this._width=e,this._material&&(this._material.uniforms.lineWidth.value=e)},get:function(){return this._width}},{key:"scrollSpeed",set:function(e){this._scrollSpeed=THING.Math.clamp(e,-99,99),this.tickable=0!==this._scrollSpeed},get:function(){return this._scrollSpeed}}]),t}(Pa);var Is=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._height=10,i._geometry=new THREE.Geometry,i._material=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0}),i._scrollSpeed=[0,0],i}return a(t,e),t.prototype.setScroll=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._scrollSpeed=[e,t],this.tickable=!0},t.prototype.customSetup=function(t){e.prototype.customSetup.call(this,t),this._height=t.height||this._height;var n=t.points;n&&this.addPoints(n),this.color=t.color||16777215,this.scroll=t.scroll||!1;var i=new THREE.Mesh(this._geometry,this._material);this.node.add(i),t.image?this._material.map=this.app.resourceManager.loadTexture(t.image,void 0,{repeat:!0}):this._material.map=function(){for(var e=new Uint8Array(512),t=0;t<128;t++)e[4*t+0]=255,e[4*t+1]=255,e[4*t+2]=255,e[4*t+3]=255*(1-t/128);var n=new THREE.DataTexture(e,1,128,THREE.RGBAFormat);return n.needsUpdate=!0,n}()},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.app.off("resize",this._updateResolutionFunc)},t.prototype.update=function(t){var n=e.prototype.update.call(this,t);return 0!==this._scrollSpeed[0]||0!==this._scrollSpeed[1]?(this._material.map&&(this._material.map.offset.x+=this._scrollSpeed[0]*t,this._material.map.offset.y+=this._scrollSpeed[1]*t),!0):n},t.prototype._updateByPoints=function(){var e=this,t=[],n=[],i=[],r=[],o=void 0,a=void 0,s=new THREE.Vector3,l=0;this.points.forEach((function(i,r){o=(new THREE.Vector3).fromArray(i),(a=(new THREE.Vector3).fromArray(i)).y+=e._height,n.push(o,a),r>0&&(l+=o.distanceTo(s)),t.push(new THREE.Vector2(l/e._height,0),new THREE.Vector2(l/e._height,1)),s.copy(o)}));for(var u=0;u<n.length-2;u+=2)i.push(new THREE.Face3(u+1,u+0,u+2)),i.push(new THREE.Face3(u+2,u+3,u+1)),r.push([t[u+1],t[u+0],t[u+2]]),r.push([t[u+2],t[u+3],t[u+1]]);this._geometry.vertices=n,this._geometry.faces=i,this._geometry.faceVertexUvs=[r],this._geometry.verticesNeedUpdate=!0,this._geometry.uvsNeedUpdate=!0,this._geometry.elementsNeedUpdate=!0,this._geometry.computeBoundingSphere(),this._geometry.computeFaceNormals()},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.height=this._height,t.points=this.points,t},o(t,[{key:"height",set:function(e){this._height=e,this._updateByPoints()},get:function(){return this._height}},{key:"color",set:function(e){this._material.color.setHex(e)},get:function(){return this._material.color.getHex()}}]),t}(Pa),Ns=new THREE.Vector3,Hs=function(){function e(t,n,i){r(this,e),this.object=null,this.useSpriteMaterial=t,this.node=n,this.domElement=i,this.cssObject=null,this.pivotObject=null}return e.prototype.onUpdate=function(e){var t=this.node,n=this.cssObject;t.updateMatrixWorld();var i=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Quaternion;t.matrixWorld.decompose(i,o,r),this.pivotObject.position.copy(i);var a=new THREE.Vector3;this.object._independentWorldScale?a=this.object._independentWorldScale.clone():this.object.node.getWorldScale(a);var s=t.userData.cssFactor||1;this.cssObject.scale.copy(a),this.cssObject.scale.multiplyScalar(s/30);var l=this.object.pivot;if(l){var u=this.domElement.scrollWidth,c=this.domElement.scrollHeight,h=u*this.cssObject.scale.x,p=c*this.cssObject.scale.y,d=(l[0]-.5)*h,f=(l[1]-.5)*p,m=d+.5*d,g=f+.5*f;this.object._useSpriteMaterial?(n.quaternion.copy(o),this.domElement.cacheLeft!=m&&(this.domElement.cacheLeft=m,this.domElement.style.left=m+"px"),this.domElement.cacheTop!=g&&(this.domElement.cacheTop=g,this.domElement.style.top=g+"px")):(this.pivotObject.quaternion.copy(o),n.position.x=m,n.position.y=g,n.position.z=0),h&&p&&(this.scaledWidth==h&&this.scaledHeight==p||(this.scaledWidth=h,this.scaledHeight=p,this.node.getWorldScale(Ns),this.node.userData.boundingBoxSize=[h/Ns.x,p/Ns.y,1],this.object.dirty=!0),this.pivotLeft==m&&this.pivotTop==g||(this.pivotLeft=m,this.pivotTop=g,this.node.userData.boundingBoxPivot=[.5+m/h,.5+g/p,0],this.object.dirty=!0))}return this.onVisible(this.object.node.ensureVisible()),!0},e.prototype.onAdd=function(e){this.object=e,this.pivotObject=new THREE.Object3D,this.useSpriteMaterial?this.cssObject=new THREE.CSS3DSprite(this.domElement):this.cssObject=new THREE.CSS3DObject(this.domElement),this.pivotObject.add(this.cssObject),this.object.app.cssScene.add(this.pivotObject),this.onUpdate(),this.object.tickable=!0},e.prototype.onRemove=function(){this.pivotObject&&(this.object.app.cssScene.remove(this.pivotObject),this.cssObject&&(this.pivotObject.remove(this.cssObject),this.cssObject=null),this.pivotObject=null),this.object=null},e.prototype.onVisible=function(e){this.cssObject.visible=e;var t=this.domElement.style;e?"visible"!=t.visibility&&(t.visibility="visible"):"hidden"!=t.visibility&&(t.visibility="hidden")},e}(),zs=new THREE.Vector3,Us=new THREE.Vector3,Vs=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._line=null,i._lineOffset=[0,0,0],i._factor=.01,i._initialSize=[1,1],i._size=[1,1],i._pivot=[.5,.5],i._useScaleMode=!1,i._useSpriteMaterial=!0,i._sizeAttenuation=!0,i._element=null,i._planeSprite=null,i._sprite=null,i._canvas=null,i._url="",i}return a(t,e),t.prototype.setupEffects=function(){},t.prototype.updateConnectionLine=function(){if(!this._line)return!1;if(!this.parent)return!1;var e=THING.Math.addVector(this._lineOffset,this.position),t=this._lineToObject?this._lineToObject.position:this._lineToPosition;return this._line.setPoint(0,e),this._line.setPoint(1,t),!0},t.prototype._setupMaterial=function(e){var t=e.canvas,n=e.image,i=e.url;t?this.setCanvas(t):n?this.setImage(n):void 0!==i&&(this._url=i)},t.prototype._setupSprite=function(e){var t=this;this.loaded=!1,this._useSpriteMaterial=Ne.parseValue(e.useSpriteMaterial,this._useSpriteMaterial);var n=e.element;if(n){var i=n.cloneNode(!0),r=Ne.parseSize(e),o=this.app.events,a={};Object.defineProperties(a,{pickedObj:{get:function(){return this.object}}});var s=function(e,t){e.button=t.button,e.buttons=t.buttons,e.altKey=t.altKey,e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey},l={picked:!1,x:0,y:0};this._element=i,this._element.onmousedown=function(e){!1!==t.app.picker.setPickedObject(t,a)&&Ne.timer.setTimeout((function(){o.skipFrameCount=t.app.currentFrameCount,l.picked=!0,l.x=e.x,l.y=e.y}))},this._element.onmouseup=function(e){!1!==t.app.picker.setPickedObject(t,a)&&l.picked&&(l.picked=!1,Ne.timer.setTimeout((function(){THING.Math.getDistance([l.x,l.y],[e.x,e.y])>1||(o.skipFrameCount=t.app.currentFrameCount+1,s(a,e),a.object.trigger("singleclick",a),t.app.trigger("singleclick",a),t.app.events.clearSingleClickTimer())})))},this._element.onclick=function(e){!1!==t.app.picker.setPickedObject(t,a)&&Ne.timer.setTimeout((function(){o.skipFrameCount=t.app.currentFrameCount,s(a,e),a.object.trigger("click",a),t.app.trigger("click",a)}))},this._element.ondblclick=function(e){!1!==t.app.picker.setPickedObject(t,a)&&Ne.timer.setTimeout((function(){o.skipFrameCount=t.app.currentFrameCount,s(a,e),a.object.trigger("dblclick",a),t.app.trigger("dblclick",a)}))},this._element.onmousemove=function(e){0==e.buttons&&e.stopPropagation(),t.app.picker.setPickedObject(t,a)&&Ne.timer.setTimeout((function(){o.skipFrameCount=t.app.currentFrameCount,s(a,e),a.object.trigger("mousemove",a),t.app.trigger("mousemove",a)}))},this._element.onmouseenter=function(e){t.app.setCurrentHTMLMarker(t),t.app.picker.setPickedObject(t,a)&&Ne.timer.setTimeout((function(){o.skipFrameCount=t.app.currentFrameCount,s(a,e),a.object.trigger("mouseenter",a),t.app.trigger("mouseenter",a)}))},this._element.onmouseleave=function(e){t.app.setCurrentHTMLMarker(null);var n=a.object;n&&Ne.timer.setTimeout((function(){o.skipFrameCount=t.app.currentFrameCount,s(a,e),n.trigger("mouseleave",a),t.app.trigger("mouseleave",a)}))},this._element.style.pointerEvents="auto",this._element.style.cursor="default";var u=new THREE.SpriteMaterial({colorWrite:!1,depthWrite:!1,transparent:!0});this._planeSprite=new THREE.Sprite(u),this._planeSprite.userData.cssFactor=r[0],this._planeSprite.userData.skipOutline=!0,this._planeSprite.userData.skipStyle=!0,this._planeSprite.userData.skipPick=!0,this.node.add(this._planeSprite),this.element3DObjectControl=new Hs(this._useSpriteMaterial,this._planeSprite,i),this.addControl(this.element3DObjectControl),this.loaded=!0}else{var c=void 0;this.bindParams=e,e.loadTextureComplete=function(t){var n=t.material,i=(n._userData||{}).bindMarkers;i&&i.forEach((function(t){t._updateSpriteTexture(n.map),t.synSize(e),t.node.getMaterials().forEach((function(e){e.visible=!0})),t.loaded=!0,t.calledComplete||(t.update(),t._callComplete(t.bindParams)),c&&c(t),delete t.bindParams})),n._userData={}};var h=this.app.spriteResource.getMaterial(e);if((u=h.material)._userData=u._userData||{},u._userData.bindMarkers=u._userData.bindMarkers||[],u._userData.bindMarkers.push(this),u.isSpriteMaterial)this._sprite=new THREE.Sprite(u);else{var p=new THREE.PlaneGeometry(this._size[0],this._size[1]);this._sprite=new THREE.Mesh(p,u)}if(h.needLoadTexture){var d=Ne.parseValue(e.visible,!0);d&&(this._sprite.setLayerVisible(!1),c=function(e){Ne.timer.setTimeout((function(){e._sprite.setLayerVisible(d),e.dirty=!0}),10)})}this._sprite.renderOrder=1,this._sprite.userData.skipOutline=!0,this._setupMaterial(e),this.node.add(this._sprite),this.synSize(e)}this.dirty=!0},t.prototype._setupLineNode=function(e){if(this._lineToPosition=e.lineToPosition,this._lineToObject=e.lineToObject,void 0!==this._lineToPosition||void 0!==this._lineToObject){var t=e.lineColor,n=this._lineToObject?this._lineToObject.position:this._lineToPosition;this._line=this.app.create({type:"Line",parent:this,points:[this.position,n],color:t,style:{lineOpacity:e.lineOpacity,lineDashSize:e.lineDashSize,lineGapSize:e.lineGapSize,lineWidth:e.lineWidth}}),this.tickable=!0}},t.prototype._setupLocalPosition=function(e){var t=this.parent;if(t){var n=(e.offset||e.localPosition||[0,0,0]).concat();if(!Ne.parseValue(e.ignoreParentBoundingBox,!1)){var i=t.getOrientedBox(!1),r=this.worldToLocal(i.center);n[0]+=r[0],n[1]+=r[1]+i.size[1]/2,n[2]+=r[2]}var o=Ne.parseValue(e.ignoreParentScale,!1);this.setLocalPosition(n,o)}},t.prototype.customSetup=function(e){var t=this;this._sizeAttenuation=Ne.parseValue(e.sizeAttenuation,!0),this.setupTranslation(e),e.skipSetupTranslation=!0,this._setupSprite(e),this._setupLineNode(e),e.width&&e.height?this._useScaleMode=!1:this._useScaleMode=!0,this._factor=e.factor||this._factor,this._initialSize=Ne.parseSize(e),this._size=this._initialSize.concat();var n=e.pivot;n&&(this.pivot=n),this.one("load",(function(n){var i=e.pivotPixel;i&&(t.pivotPixel=i),t._useSpriteMaterial||t.node.getMaterials().forEach((function(e){e.envMap=null,e.needsUpdate=!0})),t.node.traverse((function(e){e.userData.skipEnvMap=!0}))})),this.synSize(e),this._sizeAttenuation||this._sprite.skipBoundingBox(!0)},t.prototype._updatePivot=function(e){if(this._sprite){Us.set(.5-e[0],e[1]-.5,0);var t=this.node.userData.boundingBoxSize;this.node.userData.boundingBoxSize=null,this.node.userData.boundingBoxPivot=null;var n=this.getLocalBoundingBox(!1,!1),i=n.toBox(),r=i.min,o=i.max,a=n.size;t&&(a[0]==t[0]&&a[1]==t[1]&&a[2]==t[2]||(this.dirty=!0)),this.node.userData.boundingBoxSize=a,this.node.userData.boundingBoxPivot=[e[0],e[1],.5],zs.x=(o.x-r.x)*Us.x,zs.y=(o.y-r.y)*Us.y,zs.z=0,this.node.localToWorld(zs),this._sprite._setWorldPosition(zs)}},t.prototype._afterSetupComplete=function(e){var t=e.alwaysOnTop;t&&(this.style.alwaysOnTop=t)},t.prototype._notifyCompleteEvent=function(e){var t=this;Ne.timer.setTimeout((function(){t.trigger("load",{object:t}),t.trigger("complete",{object:t})}),1)},t.prototype._callComplete=function(t){var n=this.pivot;.5==n[0]&&.5==n[1]||this._updatePivot(n),""!==this._url?this.image||this.canvas?(this.calledComplete=!0,e.prototype._callComplete.call(this,t)):this.loaded=!1:(this.calledComplete=!0,e.prototype._callComplete.call(this,t))},t.prototype._updateSpriteTexture=function(e,t){return t&&(this._sprite.material=this._sprite.material.clone()),this._sprite.material.map=e,this.loaded=!0,this.dirty=!0,this._sprite.material},t.prototype.destroy=function(){if(this.app.spriteResource.unload(this.url),this._sprite){var t=this._sprite.material;if(t&&t._userData){var n=t._userData.bindMarkers;if(n){var i=n.indexOf(this);-1!==i&&n.splice(i,1)}}}e.prototype.destroy.call(this)},t.prototype.update=function(t){var n=e.prototype.update.call(this,t);return n|=this.updateConnectionLine()},t.prototype.synSize=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._sprite){if(this._useScaleMode){var t=e.texture||this._sprite.material.map;if(t){var n=t.image;n&&(this._size[0]=this._factor*n.width*this._initialSize[0],this._size[1]=this._factor*n.height*this._initialSize[1])}}}else this._planeSprite&&(this._planeSprite.userData.cssFactor=this._size[0]);if(this._keepSize){var i=this.getControl("SizeAdjustmentControl");i&&(i.size=this._size)}else this._sprite&&(this._sprite.scale.set(this._size[0],this._size[1],1),this.synIndependentWorldScale(!0,e.inheritScale));this.static&&this.node._synMatrixWorld()},t.prototype._getIndependentControlRenderNode=function(){return this._sprite?this._sprite:e.prototype._getIndependentControlRenderNode.call(this)},t.prototype.cloneSelf=function(e){return e.localPosition=this.localPosition,e.size=this.size,this.url?e.url=this.url:this.canvas?e.canvas=this.canvas.clone():this.image&&(e.image=this.image.clone()),this.app.create(e)},t.prototype._updateCanvas=function(e){if(!e)return!1;var t=this._sprite;if(!t)return!1;var n=t.material;if(!n)return!1;var i=n.map;return!!i&&(i.image=e,i.needsUpdate=!0,this._canvas=e,this.synSize(),!0)},t.prototype.setCanvas=function(e){if(e&&this._sprite){this._url="",this._canvas=e;var t=new THREE.Texture(e);t.needsUpdate=!0,this._updateSpriteTexture(t)}},t.prototype.setUrl=function(e){if(e){this.url&&this.app.spriteResource.unload(this.url),this._canvas=null,this._url=e;var t=this,n={url:e,alwaysOnTop:this.style.alwaysOnTop,useSpriteMaterial:this._useSpriteMaterial,loadTextureComplete:function(e){t.synSize({texture:e.material.map})},loadComplete:function(e){t._updateSpriteTexture(e.material.map,!0).visible=!0,t.trigger("urlchange",{image:e.material.map.image})}},i=this.app.spriteResource.getMaterial(n);if(i)this._updateSpriteTexture(i.material.map,!0).visible=!1,this.synSize()}},t.prototype.setImage=function(e){e&&(e.width&&e.height?(this._url="",this._updateSpriteTexture(this.app.resourceManager.loadTexture(e),!0),this.synSize()):console.error("[Marker] set image failed, please make sure image has width and height attribute"))},t.prototype._setScale=function(t){var n=THING.Math.scaleVector(t,[this._size[0],this._size[1],1]);n=THING.Math.divideVector(n,this.node.scale.toArray()),e.prototype._setScale.call(this,n)},t.prototype._getScale=function(){var t=e.prototype._getScale.call(this),n=THING.Math.divideVector(t,[this._size[0],this._size[1],1]);return n=THING.Math.scaleVector(this.node.scale.toArray(),n)},t.prototype.setPivot=function(e){if(e&&(Ne.isNull(e[0])||Ne.isNull(e[1])))console.error("set pivot failed, due to value is not a number array");else{this._pivot=e;var t=this._sprite;if(t&&t.isSprite)e?t.center.set(e[0],1-e[1]):t.center.set(.5,.5);else if(!this.domElement)if(e){var n=this;this.on("update",(function(){n._updatePivot(e)}),"Update-Marker-Pivot"),this.tickable=!0}else this.off("update",null,"Update-Marker-Pivot"),this.tickable=!1,this._sprite&&this._sprite.position.set(0,0,0);this.dirty=!0}},t.prototype.getPivot=function(){return this._pivot},t.prototype._updateKeepSize=function(t,n){var i=this._sizeAttenuation?60:960;e.prototype._updateKeepSize.call(this,t,this._sprite,this._size,i)&&this.synSize()},o(t,[{key:"isMarker",get:function(){return!0}},{key:"canvas",set:function(e){this.setCanvas(e)},get:function(){return this._canvas}},{key:"url",set:function(e){this._url!=e&&this.setUrl(e)},get:function(){return this._url}},{key:"image",set:function(e){this.setImage(e)},get:function(){var e=this._sprite;if(!e)return null;var t=e.material;if(!t)return null;var n=t.map;return n?n.image:null}},{key:"texture",set:function(e){e&&(e.isTexture?(this._updateSpriteTexture(e,!0),this.synSize()):console.error("[Marker] set texture failed, please make sure provide THREE.Texture as value"))}},{key:"sizeAttenuation",get:function(){return this._sizeAttenuation}},{key:"size",set:function(e){Ne.isNumber(e)?(this._size[0]=e,this._size[1]=e):this._size=e,this._initialSize=this._size.concat(),this.synSize()},get:function(){return this._size}},{key:"width",set:function(e){this._initialSize[0]=e,this._size[0]=e,this.synSize()},get:function(){return this._size[0]}},{key:"height",set:function(e){this._initialSize[1]=e,this._size[1]=e,this.synSize()},get:function(){return this._size[1]}},{key:"loaded",get:function(){return!!(this.image||this.canvas||this.element)&&e.prototype.loaded},set:function(t){e.prototype.loaded=t,t&&(this.style._syn(),this.style.hasUVAnimation()&&this.style.setUVAnimation(this.style.getUVAnimation()))}},{key:"factor",set:function(e){this._factor=e,this.synSize()},get:function(){return this._factor}},{key:"element",get:function(){return this._element}},{key:"line",get:function(){return this._line}},{key:"lineOffset",set:function(e){var t=Ne.parseValue(e,[0,0,0]);this._lineOffset=t.concat()},get:function(){return this._lineOffset.concat()}},{key:"pivot",set:function(e){this.setPivot(e)},get:function(){return this.getPivot()}},{key:"pivotPixel",set:function(e){var t=0,n=0,i=this.image,r=this.element;i?(t=i.width,n=i.height):r&&(t=r.scrollWidth,n=r.scrollHeight),t&&n&&(this.pivot=[e[0]/t,e[1]/n])},get:function(){var e=this.pivot;if(!e)return null;var t=0,n=0,i=this.image,r=this.element;return i?(t=i.width,n=i.height):r&&(t=r.scrollWidth,n=r.scrollHeight),t&&n?[Math.floor(e[0]*t),Math.floor(e[1]*n)]:null}},{key:"domElement",get:function(){return console.warn("[Building] Please use '.element' to replace '.domElement'"),this.element}}]),t}(Lt),qs=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i.mixerPlane=null,i.domWidth=0,i.domHeight=0,i}return a(t,e),t.prototype._setupFromElement=function(e){var t=e.domElement;if(t){var n=e.position||[0,0,0],i=Ne.parseSize(e),r=Ne.parseQuaternion(e.angles),o=e.domWidth||t.offsetWidth,a=e.domHeight||t.offsetHeight,s={};return o&&a&&(s.elementW=o,s.planeW=1,s.planeH=a/o),this.mixerPlane=new THREEx.HtmlMixer.Plane(this.app.webViewManager.mixerContext,t,s),this.mixerPlane.setDomElement(t),this.node=this.mixerPlane.object3d,this.node.scale.multiply(new THREE.Vector3(i[0],i[1],1)),this.node.position.x=n[0],this.node.position.y=n[1],this.node.position.z=n[2],r&&this.node.quaternion.copy(r),this.node.updateMatrix(),!0}return!1},t.prototype.setupFromURL=function(e){var t=e.url;if(t){var n=e.domWidth,i=e.domHeight;n=n||e.width?100*e.width:0,i=i||e.height?100*e.height:0,e.domWidth=e.domWidth||n,e.domHeight=e.domHeight||i,this.domWidth=e.domWidth,this.domHeight=e.domHeight,n=n?n+"px":"",i=i?i+"px":"";var r=document.createElement("iframe");r.src=t,r.style.border="none",r.style.width=n,r.style.height=i,e.domElement=r,this._setupFromElement(e)}this._setup(e)},t.prototype.setupFromDom=function(e){this._setupFromElement(e),this._setup(e)},t.prototype._setNodeVisible=function(t){if(e.prototype._setNodeVisible.call(this,t),this.mixerPlane){var n=this.mixerPlane.domElement;n&&(n.style.visibility=t?"visible":"hidden")}},o(t,[{key:"isWebView",get:function(){return!0}},{key:"url",set:function(e){var t=this.position,n=this.scale,i=this.angles,r=this.domWidth,o=this.domHeight;this.app.resourceManager.remove(this.node),this.setupFromURL({url:e,position:t,size:n,angles:i,domWidth:r,domHeight:o})},get:function(){if(!this.mixerPlane)return null;var e=this.mixerPlane.domElement;return e?e.src:null}},{key:"pickable",set:function(e){this.mixerPlane.domElement.style.pointerEvents=e?"":"none"},get:function(){return""==this.mixerPlane.domElement.style.pointerEvents}}]),t}(Lt),Gs=new THREE.Color,Ws=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._config={turbidity:10,rayleigh:2,luminance:1,mieCoefficient:.005,mieDirectionalG:.95,time:9,beta:45,light:!0,lightHelper:!1},i._skyNode=new Xs,i._skyNode.name="sky",i._skyNode.frustumCulled=!1,i._skyNode.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},i._lightGroup=null,i.noonColor=(new THREE.Color).setHex(16777215),i.earlyEveningColor=(new THREE.Color).setHex(16746816),i}return a(t,e),t.prototype.customSetup=function(e){this.node.add(this._skyNode),this.setConfig(e)},t.prototype.setConfig=function(e){for(var t in this._config)void 0!==e[t]&&(this._config[t]=e[t]);var n=this._skyNode.material.uniforms;n.turbidity.value=this._config.turbidity||10,n.rayleigh.value=this._config.rayleigh||2,n.luminance.value=this._config.luminance||1,n.mieCoefficient.value=this._config.mieCoefficient||.005,n.mieDirectionalG.value=this._config.mieDirectionalG||.95,n.mieFowardG_AVON_NIU={value:"avonniu"},Ne.parseValue(e.auhnujuw,!1)&&(n.mieWithSkyBox={value:"#A180EA"});var i=this._config.time,r=i/24*360-90,o=this._config.beta,a=Ne.parseVector3(THING.Math.directionFromAlphaBeta(r,o));if(a.normalize(),n.sunPosition.value.copy(a),n.moonPosition={value:"naijil"},n.moonDirection={value:"#148158"},this._config.light){this._lightGroup?this._lightGroup.visible||(this._lightGroup.visible=!0):this._lightGroup=this.app.create({type:"LightGroup",parent:this});var s=i<6||i>18,l=Math.min(1,Math.max(0,1-Math.abs(i-12)/6)),u=Gs.copy(this.earlyEveningColor).lerp(this.noonColor,l);this._lightGroup.setConfig({showHelper:Ne.parseValue(this._config.lightHelper,!1),ambientLight:{intensity:0},hemisphereLight:{intensity:Math.min(Math.max(s?0:l+.3,.2),.7),color:3310847,groundColor:16763007},mainLight:{shadow:!0,shadowQuality:"high",intensity:.5,color:u.toHexString(),alpha:r,beta:o},secondaryLight:{intensity:0},tertiaryLight:{intensity:0}},this.parent?this.parent.getLocalBoundingBox().toBox():this.app.root.getLocalBoundingBox().toBox())}else this._lightGroup&&(this._lightGroup.visible=!1)},t.prototype.getConfig=function(){return this._config},t}(Lt),Xs=function(e){function t(){r(this,t);var n=Js,i=new THREE.ShaderMaterial({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:THREE.UniformsUtils.clone(n.uniforms),side:THREE.BackSide});return s(this,e.call(this,new THREE.BoxBufferGeometry(1,1,1),i))}return a(t,e),t}(THREE.Mesh);Xs.prototype.isSky=!0;var Js={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new THREE.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvWorldPosition = position.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")},Ys=function(){function e(t){r(this,e),this.app=t,this._destroyed=!1}return e.prototype.setup=function(e){var t=e.parent;if(t instanceof Lt){if(this._parent=t,this._parent){var n=this;this._parent.one("destroy",(function(){n._destroyed||n.destroy()}))}}else t&&console.error("[UIAnchor] Please make sure parent is BaseObject")},e.prototype.update=function(){return!1},e.prototype.destroy=function(){this.tickable=!1,this._destroyed=!0},o(e,[{key:"canNotQueryFromSelector",get:function(){return!0}},{key:"tickable",set:function(e){e?this.app.objectManager.addTickableObject(this):this.app.objectManager.removeTickableObject(this)}}]),e}(),Qs=new THREE.Vector2,Zs=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._element=null,i._autoUpdateVisible=!0,i._pivot=[.5,1],i._offset=[0,0,0],i._zIndex=null,i._customWidth=0,i._customHeight=0,i}return a(t,e),t.prototype._updateVisible=function(e,t,n){var i=this.app.renderer.getSize(Qs),r=n[0],o=n[1],a=n[2];return 0==e.visible||a>1||r<0||r>i.width||o<0||o>i.height?("hidden"!=t.visibility&&(t.visibility="hidden"),!1):("visible"!=t.visibility&&(t.visibility="visible"),!0)},t.prototype.setup=function(t){e.prototype.setup.call(this,t),this._element=t.container||t.el||t.element,this._position=t.position,this._offset=t.offset||t.localPosition||[0,0,0],this._customWidth=t.width,this._customHeight=t.height,this.pivot=t.pivot||this.pivot;var n=t.pivotPixel;n&&(this.pivotPixel=n),this.tickable=!0,this.update()},t.prototype.update=function(){var e=this._element;if(!e)return!1;var t=this._parent;if(null==t&&(t=this.app.root.defaultCampus),t.destroyed)return this.destroy(),!1;!1===this._prevParentVisible&&t.visible&&this.visible&&(delete this._prevParentVisible,this._autoUpdateVisible=!0);var n=this._position||t.boundingBox.center,i=this._offset,r=this.app.camera.worldToScreen([n[0]+i[0],n[1]+i[1],n[2]+i[2]]),o=e.style;if(this._autoUpdateVisible&&!this._updateVisible(t,o,r))return!0;Ne.isNull(this._zIndex)&&("topview"==this.app.camera.viewMode?o.zIndex=1e3:o.zIndex=1e3-Math.ceil(1e4*r[2]-9900));var a=[0,0],s=e.offsetWidth,l=e.offsetHeight;Math.abs(e.cacheWidth-s)<1.5&&Math.abs(e.cacheHeight-l)<1.5?(s=e.cacheWidth,l=e.cacheHeight):(e.cacheWidth=s,e.cacheHeight=l),s=s||this._customWidth,l=l||this._customHeight,a[0]=Math.ceil(s*this._pivot[0]),a[1]=Math.ceil(l*this._pivot[1]);var u=this.app.domElement.offsetLeft-(e.parentElement?e.parentElement.offsetLeft:0),c=this.app.domElement.offsetTop-(e.parentElement?e.parentElement.offsetTop:0),h=Math.floor(r[0]-a[0]+u),p=Math.floor(r[1]-a[1]+c);return e.cacheLeft!=h&&(e.cacheLeft=h,o.left=h+"px"),e.cacheTop!=p&&(e.cacheTop=p,o.top=p+"px"),!0},t.prototype.destroy=function(){if(this._element){var t=this._element.parentNode;t&&t.removeChild(this._element)}e.prototype.destroy.call(this)},o(t,[{key:"zIndex",set:function(e){this._zIndex=e,Ne.isNull(e)||this._element&&(this._element.style.zIndex=e)},get:function(){return Ne.isNull(this._zIndex)?this._element?this._element.style.zIndex:null:this._zIndex}},{key:"pivot",set:function(e){this._pivot=e},get:function(){return this._pivot.concat()}},{key:"pivotPixel",set:function(e){var t=this._element,n=t.offsetWidth,i=t.offsetHeight;this._pivot=[e[0]/n,e[1]/i]},get:function(){var e=this._element,t=e.offsetWidth,n=e.offsetHeight;return[Math.floor(this._pivot[0]*t),Math.floor(this._pivot[1]*n)]}},{key:"position",set:function(e){this._position=e},get:function(){return this._position.concat()}},{key:"offset",set:function(e){this._offset=e},get:function(){return this._offset.concat()}},{key:"visible",set:function(e){var t=this._parent;t&&(e&&!t.visible?(this._prevParentVisible=!1,this._autoUpdateVisible=!1):this._autoUpdateVisible=e,this._element.style.visibility=e?"visible":"hidden")},get:function(){return"visible"==this._element.style.visibility}}]),t}(Ys),Ks={classes:{},registerClass:function(e,t){this.classes[e]=t},hasClass:function(e){return!!this.classes[e]},create:function(e,t){return new(0,this.classes[e])(t)}},$s=function(){function e(t){r(this,e),this.app=t,this.objects=new Map,this._interactableNodes=[],this._renderDistanceObjects=[],this._shadowDistanceObjects=[],this.tickableObjects=[],this._pause=!1,this.registerDefaultClasses(),this.registerEvents()}return e.prototype.registerDefaultClasses=function(){Ks.registerClass("BaseObject",Lt),Ks.registerClass("Box",vn),Ks.registerClass("Circle",yn),Ks.registerClass("Sphere",bn),Ks.registerClass("Plane",_n),Ks.registerClass("Grid",xn),Ks.registerClass("Cylinder",En),Ks.registerClass("Tetrahedron",wn),Ks.registerClass("Frustum",Tn),Ks.registerClass("Shape",Mn),Ks.registerClass("Campus",Ht),Ks.registerClass("Ground",Dn),Ks.registerClass("VideoSurvilance",kn),Ks.registerClass("Outdoors",Lr),Ks.registerClass("Group",Ir),Ks.registerClass("Building",ma),Ks.registerClass("Floor",Br),Ks.registerClass("Facade",$t),Ks.registerClass("Thing",tn),Ks.registerClass("BatchObject",pn),Ks.registerClass("BatchSubObject",dn),Ks.registerClass("ProgressBar",fn),Ks.registerClass("Door",Sn),Ks.registerClass("ElevatorDoor",Cn),Ks.registerClass("Elevator",An),Ks.registerClass("StairDoor",Rn),Ks.registerClass("Stair",Pn),Ks.registerClass("Room",ga),Ks.registerClass("TextRegion",Ra),Ks.registerClass("CombinedObject",Fr),Ks.registerClass("PolygonRegion",Da),Ks.registerClass("Heatmap",Oa),Ks.registerClass("IDWMap",Ia),Ks.registerClass("Line",za),Ks.registerClass("RouteLine",Za),Ks.registerClass("PolygonLine",Ka),Ks.registerClass("Points",$a),Ks.registerClass("MeshLine",Ls),Ks.registerClass("Boundary",Is),Ks.registerClass("ParticleSystem",bs),Ks.registerClass("Water",_s),Ks.registerClass("SpotLight",Bs),Ks.registerClass("LightGroup",Fs),Ks.registerClass("Marker",Vs),Ks.registerClass("WebView",qs),Ks.registerClass("UI",Zs),Ks.registerClass("UIAnchor",Zs),Ks.registerClass("SceneRoot",Ut),Ks.registerClass("ViewProbe",Cs),Ks.registerClass("SkyEffect",Ws)},e.prototype.registerEvents=function(){this.app.on("beforeLoad",(function(e){e.castType=function(e,t,n){console.warn("[App] Please use 'THING.Utils.addCastType(name, condition, params)' to cast object type before load scenes"),Ne.addCastType(e,t,n)}}))},e.prototype._canCastType=function(e,t,n){var i=[e];if(Ne.isArray(n))for(var r=0;r<n.length;r++){var o=n[r];if(!(i=t.select(o,i)).length)break}else i=t.select(n,i);return!!i.length},e.prototype._castObject=function(e,t,n){this._castTypeSelector||(this._castTypeSelector=new gt(this.app));for(var i=0;i<e.length;i++){var r=e[i];if(r.type!=n.type&&(Ne.isFunction(n.getAttribute)||(n.getAttribute=function(e){return Ne.getAttribute(n,e)}),n.isBaseObject=!0,this._canCastType(n,this._castTypeSelector,r.condition)))return n.type=r.type,n.skipCast=!0,n.skipSetup=!0,t.destroy(),n=Ne.mergeObject(n,r.params,!0),this._createObject(n)}return t},e.prototype._createObject=function(e){var t=e.type||"Thing",n=Ne.parseValue(e.skipSetup,!1);if(THING.onCreateObject){var i=THING.onCreateObject(e);i&&(t=i)}var r=null;if(Ks.hasClass(t)?r=Ks.create(t,this.app):(r=new tn(this.app),console.warn("ObjectManager can not found type: <"+t+"> use <Thing> instead!"),t="Thing"),r._type=r._type||t,!n){var o=Ne.getCastTypes();if(o.length)r.isBaseObject&&(e.skipCast||(e.name=e.name||e.id,e.userData=e.userData||e.properties,r=this._castObject(o,r,e)));r.setup(e)}return this.app.needUpdate=!0,r},e.prototype.create=function(e){if(!e)return console.error("create object failed, due to param is null"),null;Ne.isString(e)&&(e={type:e});var t=this._createObject(e);return t?(t.queryID&&this.objects.set(t.queryID,t),t):null},e.prototype.destroy=function(e){e&&(e.isBaseObject&&(e.trigger(O.Destroy,{object:e}),this.app.trigger(O.Destroy,{object:e})),e.queryID&&this.objects.delete(e.queryID),this.removeTickableObject(e))},e.prototype._addNode=function(e,t){return t.isBaseObject&&(t=t.node),Ne.add(e,t)},e.prototype._removeNode=function(e,t){t.isBaseObject&&(t=t.node),Ne.remove(e,t)},e.prototype._addObject=function(e,t){return Ne.add(e,t)},e.prototype._replaceObject=function(e,t,n){for(var i=0;i<e.length;i++)e[i]==n&&(e[i]=t)},e.prototype._removeObject=function(e,t){Ne.remove(e,t)},e.prototype.addInteractableNode=function(e){e&&(e.updateWorldMatrix(!0,!0),this._addNode(this._interactableNodes,e))},e.prototype.removeInteractableNode=function(e){e&&this._removeNode(this._interactableNodes,e)},e.prototype.addRenderDistanceObject=function(e){this._addObject(this._renderDistanceObjects,e)},e.prototype.removeRenderDistanceObject=function(e){this._removeObject(this._renderDistanceObjects,e)},e.prototype.addShadowDistanceObject=function(e){this._addObject(this._shadowDistanceObjects,e)},e.prototype.removeShadowDistanceObject=function(e){this._removeObject(this._shadowDistanceObjects,e)},e.prototype.get=function(e){if(e)if(e.isObject3D){var t=e.userData;if(t&&t.id)return this.get(t.id)}else if(this.objects.has(e))return this.objects.get(e);return null},e.prototype.getBaseObject=function(e){for(;e;){var t,n=e.userData;if(n.independent)return null;if(n.baseObject_bindSubNode_hooked)if(t=n.baseObject_bindSubNode)return t;if(n.isBaseObject)if((t=this.get(n.id))&&!t.isCombinedObject)return t;e=e.parent}},e.prototype.getObjectsArray=function(){var e=[];return this.objects.forEach((function(t){e.push(t)})),e},e.prototype.pause=function(){this._pause=!0},e.prototype.resume=function(){this._pause=!1},e.prototype.addTickableObject=function(e){for(var t=0;t<this.tickableObjects.length;t++)if(this.tickableObjects[t]==e)return;this.tickableObjects.push(e)},e.prototype.removeTickableObject=function(e){for(var t=0;t<this.tickableObjects.length;t++){if(this.tickableObjects[t]==e){e.isTickable=!1,this.tickableObjects[t]=null;break}}},e.prototype.replaceObject=function(e,t){this._replaceObject(this._renderDistanceObjects,e,t),this._replaceObject(this._shadowDistanceObjects,e,t),this._replaceObject(this.tickableObjects,e,t),this.objects.delete(t.queryID),this.objects.set(e.queryID,e)},e.prototype.update=function(){if(!this._pause)for(var e=this.app._deltaTime,t=this.tickableObjects,n=0,i=t.length;n<i;n++){var r=t[n],o=!1;if(r)r.update(e)?o=!0:r.isTickable=!1;o||(t.splice(n,1),n--,i--)}},e.prototype.onUpdate=function(e){this.update(e)},o(e,[{key:"interactableNodes",get:function(){return this._interactableNodes}},{key:"renderDistanceObjects",get:function(){return this._renderDistanceObjects}},{key:"shadowDistanceObjects",get:function(){return this._shadowDistanceObjects}}]),e}(),el=function(){function e(t){r(this,e),this.app=t,this.thresholdAngle=.1,this.enableRemoteData=!0,this.enableWebWorker=!0,this._map=new Map,this._resMap=new Map,this._taskNumber=0,this._fileLoader=new THREE.FileLoader,this._fileLoader.setResponseType("json")}return e.prototype.getByObject=function(e,t){var n=void 0;if(!e.geometry)return null;if(e.isLineSegments)return null;if("EdgesGeometry"==e.geometry.type)return null;if(t._extensionsFile&&this.enableRemoteData){if("_skip_wireframes_"===e._wName)return null;n=this.getByRes(e.geometry,t._url+"/"+t._extensionsFile,e._wName||e.name)}else n=this.get(e.geometry);return n},e.prototype.getByRes=function(e,t,n){var i=this,r=e.id;if(this._map.has(r))return this._map.get(r);var o=void 0;if(this._resMap.has(t)){var a=this._resMap.get(t);o=a instanceof Promise?a:Promise.resolve(a)}else o=this._fileLoader.loadAsync(t).then((function(e){return i._resMap.set(t,e),e})),this._resMap.set(t,o);var s=o.then((function(t){if(s._break)return Promise.reject({code:0});if(t.wireframe[n]){t.wireframe[n].name&&t.wireframe[n].name!==n&&(n=t.wireframe[n].name);var o=new THREE.BufferGeometry;return o.addAttribute("position",new THREE.Float32BufferAttribute(t.wireframe[n].pos,3)),o.refCount=1/0,i._map.set(r,o),i._taskNumber--,i.app.events.dispatchEvent({type:"edges_task_progress",task:i._taskNumber}),e.addEventListener("dispose",(function(){return i.release(e)})),Promise.resolve(o)}return i._map.delete(r),i._taskNumber--,i.app.events.dispatchEvent({type:"edges_task_progress",task:i._taskNumber}),Promise.reject({code:1,msg:"can not find name: "+n})}));return this._taskNumber++,this._map.set(r,s),s},e.prototype.get=function(e){var t=this,n=void 0,i=e.id;return this._map.has(i)?n=this._map.get(i):(window.EW&&this.enableWebWorker?(e.isBufferGeometry||(e=(new THREE.BufferGeometry).fromGeometry(e)),n=EW.getGeometryInfo(e,this.thresholdAngle).then((function(r){if(n._break)return Promise.reject({code:0});var o=new THREE.BufferGeometry;return o.addAttribute("position",new THREE.BufferAttribute(r.position,3)),e.isInstancedBufferGeometry&&(o=tl(e,o)),o.refCount=1/0,t._map.set(i,o),t._taskNumber--,t.app.events.dispatchEvent({type:"edges_task_progress",task:t._taskNumber}),e.addEventListener("dispose",(function(){return t.release(e)})),Promise.resolve(o)})),this._taskNumber++):(n=new THREE.EdgesGeometry(e,this.thresholdAngle),e.isInstancedBufferGeometry&&(n=tl(e,n)),n.refCount=1/0),this._map.set(i,n)),n},e.prototype.synMaxInstancedCount=function(e){this._map.has(e.id)&&(this._map.get(e.id).instanceCount=e.instanceCount)},e.prototype.releaseRes=function(e){this._resMap.delete(e)},e.prototype.release=function(e){if(this._map.has(e.id)){var t=this._map.get(e.id);t.isBufferGeometry?t.dispose():t._break||(t._break=!0,this._taskNumber--,this.app.events.dispatchEvent({type:"edges_task_progress",task:this._taskNumber})),this._map.delete(e.id)}},e.prototype.releaseAll=function(){var e=this;this._map.forEach((function(t){t.isBufferGeometry?t.dispose():t._break||(t._break=!0,e._taskNumber--)})),this._map.clear(),this._resMap.clear(),this._taskNumber=0,this.app.events.dispatchEvent({type:"edges_task_progress",task:this._taskNumber})},e.prototype.getTaskNumber=function(){return this._taskNumber},e}();function tl(e,t){var n=new THREE.InstancedBufferGeometry;for(var i in e.attributes)n.setAttribute(i,e.attributes[i]);return n.attributes.position=t.attributes.position,n.boundingBox=e.boundingBox?e.boundingBox.clone():null,n.boundingSphere=e.boundingSphere?e.boundingSphere.clone():null,n.instanceCount=e.instanceCount,n}var nl=function(){function e(t){r(this,e),this.updateTime=5,this._array=[],this._sortDirty=!0,this._updateTimer=0}return e.prototype.push=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;this._array.push({mat:e,timer:t}),this._sortDirty=!0},e.prototype.update=function(e){var t=this;if(this._updateTimer+=e,this._updateTimer>this.updateTime){if(this._array.length>0){this._sortDirty&&(this._array.sort(il),this._sortDirty=!1);var n=0;this._array.forEach((function(e){(function(e,t){if(e.timer-=t,e.timer<0)return e.mat.dispose(),!0;return!1})(e,t._updateTimer)&&n++})),this._array.length-=n}this._updateTimer=0}},e.prototype.clear=function(){this._array.forEach((function(e){return e.mat.dispose()})),this._array.length=0},e}();function il(e,t){return t.timer-e.timer}var rl=["middleGlow","innerGlow"];function ol(e,t){if(!e)return null;var n=e[t];return n?"[object Object]"===toString.call(n)?n.skip?"skip":void 0!==n.value?n.value:1:n:null}var al=function(){function e(t){r(this,e),this._renderer=t.rendererManager._mainRenderer,this._effectRefCounts={}}return e.prototype.setEffect=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.technique||(e.technique={}),e.technique[t]){var r=ol(e.technique,t),o="skip"!=r&&0!=r,a=!i&&0!=n;o!==a?this._updatEffectRefCounts(t,a?1:-1):i||n==r||this._renderer.dirty(t)}else i||0==n||this._updatEffectRefCounts(t,1);e.technique[t]={value:n,skip:i}},e.prototype.removeEffect=function(e,t){var n=ol(e.technique,t);n&&("skip"!=n&&0!=n&&this._updatEffectRefCounts(t,-1),delete e.technique[t])},e.prototype.clearAllEffects=function(e){if(e.technique)for(var t in e.technique)this.removeEffect(e,t)},e.prototype.synEffect=function(e){if(e.technique)for(var t in e.technique)if(rl.indexOf(t)>-1){var n=ol(e.technique,t);"skip"!=n&&0!=n&&this._updatEffectRefCounts(t,1)}},e.prototype._updatEffectRefCounts=function(e,t){void 0===this._effectRefCounts[e]&&(this._effectRefCounts[e]=0);var n=this._effectRefCounts[e];this._effectRefCounts[e]=Math.max(this._effectRefCounts[e]+t,0);var i=this._renderer;0==n&&t>0?i.enable&&i.enable(e):n>0&&0==this._effectRefCounts[e]&&i.disable&&i.disable(e),i.dirty&&i.dirty(e)},o(e,[{key:"effectRefCounts",get:function(){return this._effectRefCounts}}]),e}(),sl=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._solidColor=null,i._skipApplyTheme=!0,i}return a(t,e),t.prototype._setAlwaysOnTop=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alwaysOnTop!=e||t){var n=this.obj._sprite;n&&(this._alwaysOnTop=e,e?(this._cloneAndModifyMaterial((function(e,t,n){var i=t;Ne.backupValue(i,"depthTest"),Ne.backupValue(i,"depthWrite"),i.depthTest=!1,i.depthWrite=!1})),this._traverse((function(e){e.renderOrder+=THING.BaseStyle.cRenderOrderValueMask}))):(this._traverse((function(e){e.renderOrder-=THING.BaseStyle.cRenderOrderValueMask})),this.isNeedRevertMaterials()&&this.revertMaterial()))}},t.prototype.setUVAnimation=function(t){var n=this.obj._sprite;if(n){if(t){var i=n.material;t.uvDiscard?(i.defines=i.defines||{},i.defines.USE_UV_DISCARD=""):i.defines&&delete i.defines.USE_UV_DISCARD,i.needsUpdate=!0}e.prototype.setUVAnimation.call(this,t)}},t.prototype.setSolidColor=function(e){if(this._solidColor!=e){this._solidColor=Ne.parseColor(e);["#ifdef GL_ES\n","precision highp float;\n","#endif\n","","varying vec4 worldId;","","void main() {","  gl_FragColor = "+this._solidColor.getHex()+";","}"].join("\n")}},t.prototype.setOpacity=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.obj.element;i?i.style.opacity=t:e.prototype.setOpacity.call(this,t,n)},o(t,[{key:"solidColor",set:function(e){return this.setSolidColor(e)},get:function(){return this._solidColor?this._solidColor.toHexString():null}},{key:"line",get:function(){return this.obj._line}},{key:"lineColor",set:function(e){this.line&&(this.line.style.lineColor=e)}},{key:"lineOpacity",set:function(e){this.line&&(this.line.style.lineOpacity=e)}},{key:"lineDashSize",set:function(e){this.line&&(this.line.style.lineDashSize=e)}},{key:"lineGapSize",set:function(e){this.line&&(this.line.style.lineGapSize=e)}},{key:"lineWidth",set:function(e){this.line&&(this.line.style.lineWidth=e)}}]),t}(Ca),ll=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._lineColor=Ne.parseColor("#00BFFF"),i._regionOpacity=.5,i._regionColor=Ne.parseColor("#708090"),i}return a(t,e),t.prototype.isNeedCloneMaterials=function(){return!!e.prototype.isNeedCloneMaterials.call(this)||(!this._lineColor.equals(Ne.parseColor("#00BFFF"))||(.5!=this._regionOpacity||!this._regionColor.equals(Ne.parseColor("#708090"))))},o(t,[{key:"lineColor",set:function(e){var t=Ne.parseColor(e);if(t){var n=this.obj._lineMesh;n&&(this._lineColor=t,n.material.color=t)}},get:function(){return this._lineColor.toHexString()}},{key:"regionColor",set:function(e){var t=Ne.parseColor(e);if(t){var n=this.obj._areaMesh;n&&(this._regionColor=t,n.material.color=t)}},get:function(){return this._regionColor.toHexString()}},{key:"regionOpacity",set:function(e){if(Ne.isNumber(e)){var t=this.obj._areaMesh;t&&(this._regionOpacity=e,t.material.opacity=e)}},get:function(){return this._regionOpacity}}]),t}(Ca),ul=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype.setEffect=function(e){e=e||{};var t=this.obj;t._scale=e.scale||t._scale,t._color=e.color||t._color,t._flowDirection.x=e.flowXDirection||t._flowDirection.x,t._flowDirection.y=e.flowYDirection||t._flowDirection.y;var n=t.water.material.uniforms;n.color.value.set(t._color),n.config.value.w=t._scale,n.flowDirection.value.x=t._flowDirection.x,n.flowDirection.value.y=t._flowDirection.y},o(t,[{key:"waterColor",set:function(e){this.setEffect({color:e})},get:function(){return this.obj._color}},{key:"waterScale",set:function(e){this.setEffect({scale:e})},get:function(){return this.obj._scale}},{key:"flowXDirection",set:function(e){this.setEffect({flowXDirection:e})},get:function(){return this.obj._flowDirection.x}},{key:"flowYDirection",set:function(e){this.setEffect({flowYDirection:e})},get:function(){return this.obj._flowDirection.y}}]),t}(Ca),cl=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),o(t,[{key:"image",set:function(e){var t=this;if(this._image=e,e)if(e.isTexture)this._image=e.name,e.image&&(e.needsUpdate=!0),this.obj.synPathTexture(e);else{this._image=this.obj.app.confirmURL(e);var n=this.obj.app.resourceManager.loadTexture(this._image,(function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.anisotropy=16,t.obj&&(t.obj.app.needUpdate=!0)}));this.obj.synPathTexture(n)}},get:function(){return this._image}},{key:"lineMaterial",get:function(){var e=this.obj.pathLine.material;return e.dashSize||e.gapSize?this.dashLineMaterial:this.basicLineMaterial}},{key:"basicLineMaterial",get:function(){var e=this.obj.pathLine.material;if(e.isLineBasicMaterial)return e;var t=new THREE.LineBasicMaterial({color:e.color,opacity:e.opacity,linewidth:e.lineWidth,transparent:e.transparent});return this.obj.pathLine.material=t,t}},{key:"dashLineMaterial",get:function(){var e=this.obj.pathLine.material;if(e.isLineDashedMaterial)return e;var t=new THREE.LineDashedMaterial({color:e.color,opacity:e.opacity,linewidth:e.lineWidth,transparent:e.transparent});return this.obj.pathLine.material=t,t}},{key:"lineColor",set:function(e){this.lineMaterial.color=Ne.parseColor(e)},get:function(){return this.lineMaterial.color.toHexString()}},{key:"lineOpacity",set:function(e){this.lineMaterial.opacity=e},get:function(){return this.lineMaterial.opacity}},{key:"lineDashSize",set:function(e){this.lineMaterial.dashSize=e},get:function(){return this.lineMaterial.dashSize}},{key:"lineGapSize",set:function(e){this.lineMaterial.gapSize=e},get:function(){return this.lineMaterial.gapSize}},{key:"lineWidth",set:function(e){this.lineMaterial.lineWidth=e},get:function(){return this.lineMaterial.lineWidth}}]),t}(Ca);function hl(e,t,n){var i=[];t.forEach((function(t){var r=.09;"top"==n&&(r+=e.getRoomHeight()),i.push([t[0],t[1]+r,t[2]])}));var r=e.app.create({name:e.name+"_border_"+n,type:"RouteLine",image:e.app.confirmURL("image/light3.jpg"),parent:e,arrowFlag:!1,close:!0,side:"right",points:i,width:2});return r.cornerRadius=0,r.scrollSpeed=10,r.imageRepeat=[1/40,1],r.pickable=!1,r.style.skipOutline=!0,r.scrollUV=!0,r.node.traverse((function(e){e.isMesh&&(e.userData.skipOutline=!0,e.material.transparent=!0,e.material.blending=THREE.AdditiveBlending)})),r}var pl=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._volumeNode=null,i._volumeColor=null,i._volumeImage=null,i._volumeCanvas=null,i._borderLine=!1,i._borderLineTop=null,i._borderLineBottom=null,i}return a(t,e),t.prototype._synVolumeNode=function(){this._volumeColor||this._volumeImage||this._volumeCanvas||(this.obj.app.resourceManager.remove(this._volumeNode),this._volumeNode=null),this.obj._synTextRegion()},t.prototype._createVolumeNode=function(){if(!this._volumeNode){var e=this.obj.getFloorMesh();if(!e)return null;if(this._volumeNode=e.clone(),!this._volumeNode)return null;if(this._volumeNode.geometry=this._volumeNode.geometry.clone(),this._volumeNode.material=e.material.clone(),!this._volumeNode.material)return null;var t=this._volumeNode.material;t.map=null,t.transparent=!0,t.opacity=.5,this._volumeNode.geometry.genFaceVertexUVs(),e.parent.add(this._volumeNode);var n=e.position;this._volumeNode.position.setY(n.y+this.obj.getRoomHeight()+.05)}return this._volumeNode},o(t,[{key:"volumeColor",set:function(e){this._volumeColor=Ne.parseColor(e);var t=this._createVolumeNode();t&&(e?t.material.color=Ne.parseColor(e):t.material.color.set(1,1,1)),this._synVolumeNode()},get:function(){return null==this._volumeColor?null:this._volumeColor.toHexString()}},{key:"volumeOpacity",set:function(e){var t=this._createVolumeNode();t&&(t.material.opacity=e)},get:function(){return null==this._volumeNode?null:this._volumeNode.material.opacity}},{key:"volumeImage",set:function(e){this._volumeImage=e,this._volumeCanvas=null;var t=this._createVolumeNode();if(t){if(e){var n=this.obj.app.confirmURL(e);e=this.obj.app.resourceManager.loadTexture(n)}t.material.map=e,t.material.needsUpdate=!0}this._synVolumeNode()},get:function(){return this._volumeImage}},{key:"volumeCanvas",set:function(e){this._volumeCanvas=e,this._volumeImage=null;var t=this._createVolumeNode();t&&(e&&((e=new THREE.Texture(e)).needsUpdate=!0),t.material.map=e,t.material.needsUpdate=!0),this._synVolumeNode()},get:function(){return this._volumeCanvas}},{key:"volumeHeight",set:function(e){this._volumeNode&&(this._volumeNode.position.y=e)},get:function(){return this._volumeNode?this._volumeNode.position.y:0}},{key:"borderLine",set:function(e){if(e!=this._borderLine)if(e){var t=this.obj,n=t.points;this._borderLineTop=hl(t,n,"top"),this._borderLineBottom=hl(t,n,"bottom"),this._borderLine=!0}else this._borderLineTop.destroy(),this._borderLineBottom.destroy(),this._borderLineTop=null,this._borderLineBottom=null,this._borderLine=!1},get:function(){return this._borderLine}}]),t}(Ca),dl=function(e){function t(n){r(this,t);var i=s(this,e.call(this,n));return i._lineColor=new THREE.Color(1,1,1),i}return a(t,e),o(t,[{key:"lineColor",set:function(e){this.obj._lineMesh.material.color=Ne.parseColor(e)},get:function(){return this._lineColor.toHexString()}}]),t}(Ca),fl=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype.setRenderOrder=function(e){this._renderOrder=e,this.obj.children.forEach((function(t){t.style.setRenderOrder(e)}))},t.prototype.setWireframe=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wireframe=e,this.obj.children.forEach((function(n){n.style.setWireframe(e,t)}))},t.prototype.setOpacity=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._opacity=e,this.obj.children.forEach((function(n){n.style.setOpacity(e,t)}))},t.prototype.setColor=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._color=Ne.parseColor(e),this.obj.children.forEach((function(n){n.style.setColor(e,t)}))},t.prototype.setOutlineColor=function(e,t){this._outlineColor=Ne.parseColor(e),this.obj.children.forEach((function(n){n.style.setOutlineColor(e,t)}))},t.prototype.setDefaultOutlineColor=function(e){this._defaultOutlineColor=Ne.parseColor(e),this.obj.children.forEach((function(t){t.style.setDefaultOutlineColor(e)}))},t.prototype.setSkipBoundingBox=function(e){this.obj.children.forEach((function(t){t.style.setSkipBoundingBox(e)}))},t.prototype.setSkipOutline=function(e){this.obj.children.forEach((function(t){t.style.setSkipOutline(e)}))},t.prototype.setGlow=function(e){this._glow=e,this.obj.children.forEach((function(t){t.style.setGlow(e)}))},t.prototype.setInnerGlow=function(e){this._innerGlow=e,this.obj.children.forEach((function(t){t.style.setInnerGlow(e)}))},t.prototype.setVertexNormalHelper=function(e){this._vertexNormalNode={visible:e},this.obj.children.forEach((function(t){t.style.setVertexNormalHelper(e)}))},t.prototype.setAxisHelper=function(e){this._axisNode={visible:e},this.obj.children.forEach((function(t){t.style.setAxisHelper(e)}))},t.prototype.setEdgeColor=function(e){this._edgeColor=Ne.parseColor(e),this.obj.children.forEach((function(t){t.style.setEdgeColor(e)}))},t.prototype.setBoundingBox=function(e,t){this._boundingBoxNode={visible:e,material:{color:Ne.parseColor(t)}},this.obj.children.forEach((function(n){n.style.setBoundingBox(e,t)}))},t.prototype.setOrientedBoundingBox=function(e){this._orientedBoundingBoxNode={visible:e,material:{color:Ne.parseColor(color)}},this.obj.children.forEach((function(t){t.style.setOrientedBoundingBox(e,color)}))},t.prototype.setAlwaysOnTop=function(e){this._alwaysOnTop=e,this.obj.children.forEach((function(t){t.style.setAlwaysOnTop(e)}))},t.prototype.setImage=function(e){this._image=e,this.obj.children.forEach((function(t){t.style.setImage(e)}))},t}(Ca),ml=new Map,gl=function(){function e(t){r(this,e),e.register("Default",{"*":Ca,Marker:sl,PolygonRegion:ll,TextRegion:Aa,Water:ul,Line:cl,RouteLine:cl,PolygonLine:cl,Room:pl,Frustum:dl,Group:fl,BatchSubObject:nn})}return e.register=function(e,t){ml.set(e,t)},e.getStrategyMap=function(e){return ml.get(e)},e.prototype.createStyle=function(e,t){var n,i=ml.get(e);if(!i)return null;for(var r in i)if("*"!=r){var o=t["is"+r];if(t.type==r||!Ne.isFunction(o)&&o)return new i[r](t)}else n=i[r];return n?new n(t):null},e.prototype.hasStyleStrategy=function(e){return ml.has(e)},e}(),vl=new THREE.Vector2,yl=function(){function e(t){r(this,e),this.app=t,this.scene=this.app.scene,this.renderer=this.app.renderer,this.camera=this.app.renderCamera,this.init()}return e.prototype.init=function(){var e=new THREEx.HtmlMixer.Context(this.renderer,this.scene,this.camera);this.mixerContext=e;var t=e.rendererCss,n=this.renderer.getSize(vl);t.setSize(n.width,n.height);var i=t.domElement;this.app.domElement.appendChild(i);var r=e.rendererWebgl,o=r.domElement;r.domElement._static||(o.style.position="absolute",o.style.top="0px",o.style.pointerEvents="none",i.appendChild(o))},e.prototype.resize=function(e,t){this.mixerContext.rendererCss.setSize(e,t)},e.prototype.update=function(){this.mixerContext.update()},e.prototype.onUpdate=function(e){this.update(e)},e}(),bl=function(){function e(t){r(this,e),this.eventTriggerManager=t,this.app=this.eventTriggerManager.app,this.domElement=this.app.mainDomElement,this.singleClickTimer=null,this.clickCountForSingleClick=0,this.dragStartFlag=!1,this.draggingFlag=!1,this._dragPrevPosition=null,this._draggingObject=null,this.mouseMoveEvents=[],this.mouseMoveObject=null,this.mouseDownPos={},this.mouseMovePos=[],this.mouseMoveDelta=null,this.keysPressed={},this.skipFrameCount=0,this.init()}return e.prototype.dispatchEvent=function(e){return this.eventTriggerManager.dispatchEvent(e)},e.prototype.getEventPosition=function(e,t){var n,i,r=this.domElement;if(r){var o=r.currentStyle||window.getComputedStyle(r,null),a=t?t[0]:parseInt(o.borderLeftWidth,10),s=t?t[1]:parseInt(o.borderTopWidth,10),l=r.getBoundingClientRect();n=e.clientX-a-l.left,i=e.clientY-s-l.top}else e.layerX||0==e.layerX?(n=e.layerX,i=e.layerY):e.offsetX||0==e.offsetX?(n=e.offsetX,i=e.offsetY):(e.clientX||0==e.clientX)&&(n=e.clientX,i=e.clientY);return{x:Math.round(n),y:Math.round(i)}},e.prototype.registerEventFunctions=function(e){Ne.isNull(e.stopPropagation)&&(e.stopPropagation=function(){this._stopPropagation=!0})},e.prototype.createKeyboardEvent=function(e){var t;t=e.key>="a"&&e.key<="z"?Ne.atoi(e.key):e.keyCode||e.which||e.charCode;var n={type:e.type,key:t,code:e.code,location:e.location,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey};return this.registerEventFunctions(n),n},e.prototype.createMouseEvent=function(e,t,n){var i=Ne.parseVector2(n)||this.getEventPosition(t),r={type:e,clientX:i.x,clientY:i.y,x:i.x,y:i.y,button:t.button||0,buttons:t.buttons||0,altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,pickedPosition:null};return this.registerEventFunctions(r),r.getPickedPos=function(){return console.warn("Please use .getPickedPosition() to replace .getPickedPos()"),r.pickedPosition},r.getPickedPosition=function(){return console.warn("Please use .pickedPosition to replace .getPickedPosition()"),r.pickedPosition},r},e.prototype.createDragEvent=function(e,t,n,i){var r=[void 0!==t.x?t.x:t.clientX,void 0!==t.y?t.y:t.clientY],o={type:e,x:r[0],y:r[1],clientX:r[0],clientY:r[1],altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey};return n&&(o.offsetX=n),i&&(o.offsetY=i),o.pickedPosition=null,this.registerEventFunctions(o),o.getPickedPos=function(){return console.warn("Please use .getPickedPosition() to replace .getPickedPos()"),o.pickedPosition},o.getPickedPosition=function(){return console.warn("Please use .pickedPosition to replace .getPickedPosition()"),o.pickedPosition},o},e.prototype.clearSingleClickTimer=function(){null!=this.singleClickTimer&&(Ne.timer.clearTimeout(this.singleClickTimer),this.clickCountForSingleClick=0)},e.prototype.findMouseEventObject=function(e,t){for(;e;){for(var n=0;n<t.length;n++)if(e.hasEvent(t[n]))return e;e=e.parent}return null},e.prototype.processMouseOffEvent=function(e){var t=this.mouseMoveObject;if(t){var n=e.object;if(n){if(n.isBlockMouseOffEvent(t))return;var i=this.findMouseEventObject(t,["mouseleave","mouseoff"]);if(!i||n.isBlockMouseOffEvent(i))return;if(!i.visible)return;if(this.findMouseEventObject(n,["mouseleave","mouseoff"])==t)return;if(t==i){var r=this.mouseMoveLastPickedObject||e.object;this.dispatchEvent({type:O.MouseLeave,object:i,mouseOffObject:r,x:e.clientX,y:e.clientY}),this.dispatchEvent({type:"mouseoff",object:i,mouseOffObject:r,x:e.clientX,y:e.clientY})}}else for(var o=t;o;o=o.parent)o.trigger(O.MouseLeave,{object:o,mouseOffObject:this.mouseMoveObject,x:e.clientX,y:e.clientY}),o.trigger("mouseoff",{object:o,mouseOffObject:this.mouseMoveObject,x:e.clientX,y:e.clientY});this.mouseMoveObject=null}},e.prototype.processMouseOnEvent=function(e){var t=e.object,n=this.findMouseEventObject(t,["mouseenter","mouseon"]);if(n&&n.visible&&this.mouseMoveObject!=n){this.mouseMoveLastPickedObject=e.pickedObj;var i=this.dispatchEvent({type:O.MouseEnter,object:n,mouseOnObject:e.pickedObj,x:e.clientX,y:e.clientY});this.dispatchEvent({type:"mouseon",object:n,mouseOnObject:e.pickedObj,x:e.clientX,y:e.clientY}),i&&i.isBaseObject?this.mouseMoveObject=i:this.mouseMoveObject=n}},e.prototype.processMouseOverEvent=function(e){var t=e.object,n=this.findMouseEventObject(t,["mouseover"]);n&&this.dispatchEvent({type:"mouseover",object:n,x:e.clientX,y:e.clientY})},e.prototype.processHoverEvent=function(e){this.mouseMoveEvents.push(e)},e.prototype.createEvent=function(e,t){var n;return t=t||e.type,(n=x[t]?this.createMouseEvent(t,e):E[t]?this.createKeyboardEvent(e):e).preventDefault=function(){e.preventDefault()},n},e.prototype.checkEvent=function(){return!(this.app.currentFrameCount<=this.skipFrameCount)&&!this.app.getCurrentHTMLMarker()},e.prototype.initDoubleRightClickEvent=function(){var e,t,n,i,r=this;window.oncontextmenu=(e=function(e){r.clearSingleClickTimer();var t=r.createEvent(e,"dblclick");t.button=2;var n=THING.App.current;n?n.events.eventTriggerManager.dispatchEvent(t):r.dispatchEvent(t)},t=0,n=!1,i=null,function(r){if(r.preventDefault(),n){clearTimeout(t),n=!1;var o=THING.Math.getDistance(i,[r.x,r.y]);if(o>1)return;return e.apply(this,arguments)}i=[r.x,r.y],n=!0,t=setTimeout((function(){n=!1}),300)})},e.prototype.initMouseEvent=function(e){var t=this,n=!0,i=!0;for(var r in this.initDoubleRightClickEvent(),x)this.domElement.addEventListener(r,(function(r){if(t.checkEvent()){if("mousedown"==(r=t.createEvent(r)).type)t.mouseDownPos[r.button]=[r.x,r.y];else if("mouseup"==r.type)if(0==r.button)n=!(t.getDistanceOfLastMouseDown(r)>4);else if(2==r.button){var o=t.mouseDownPos[r.button];t.getDistanceOfLastMouseDown(r)<=4&&(t.dispatchEvent(t.createMouseEvent("click",r,o)),t.clearSingleClickTimer(),t.singleClickTimer=Ne.timer.setTimeout((function(){t.dispatchEvent(t.createMouseEvent("singleclick",r,o))}),e))}if("click"==r.type){if(t.getDistanceOfLastMouseDown(r)>1)return;if(i=!0,t.clickCountForSingleClick++,1===t.clickCountForSingleClick){o=t.mouseDownPos[r.button];t.singleClickTimer=Ne.timer.setTimeout((function(){n&&!t.draggingFlag?(i=!1,t.dispatchEvent(t.createMouseEvent("singleclick",r,o))):i=!0,n=!0,t.clickCountForSingleClick=0}),e)}else t.clearSingleClickTimer()}else if("dblclick"==r.type&&(t.clearSingleClickTimer(),!i))return void(i=!0);t.dispatchEvent(r),"mousemove"==r.type&&(t.mouseMoveDelta?t.mouseMoveDelta=[t.mouseMovePos[0]-r.x,t.mouseMovePos[1]-r.y]:t.mouseMoveDelta=[r.x,r.y],t.mouseMovePos=[r.x,r.y],0==r.buttons&&t.processHoverEvent(r))}}),{passive:!1});this.domElement.addEventListener("mouseout",(function(e){t.checkEvent()&&0==e.buttons&&t.processMouseOffEvent(e)})),this.domElement.addEventListener("wheel",(function(e){if(t.checkEvent()){var n=t.getEventPosition(e),i={type:O.MouseWheel,delta:e.deltaY,clientX:n.x,clientY:n.y,x:n.x,y:n.y};t.dispatchEvent(i)}}),{passive:!1})},e.prototype.initKeyboardEvent=function(){var e=this;for(var t in E)window.addEventListener(t,(function(t){if(e.checkEvent()){var n=(t=e.createEvent(t)).code||t.key;if("keydown"==t.type){if(e.keysPressed[n])return;e.keysPressed[n]=!0}else"keyup"==t.type&&(e.keysPressed[n]=!1);e.dispatchEvent(t)}}))},e.prototype.initDragEvent=function(){var e=this;this.domElement.addEventListener("mouseup",(function(t){e.checkEvent()&&0==t.button&&e.dragStartFlag&&(e.dragStartFlag=!1,e.draggingFlag=!1,e._dragPrevPosition=null,e._draggingObject=null,t=e.createEvent(t),e.dispatchEvent(e.createDragEvent("dragend",t)))})),this.domElement.addEventListener("mousemove",(function(t){if(e.checkEvent())if(t=e.createEvent(t),e.dragStartFlag){e.draggingFlag=!0;var n=e.createDragEvent("drag",t);e.dispatchEvent(n);var i=n.pickedPosition;i&&!i.isFailed||(n.picked=!1),e._dragPrevPosition=e._dragPrevPosition||i,e._dragPrevPosition&&i?n.offsetPosition=THING.Math.subVector(i,e._dragPrevPosition):n.offsetPosition=[0,0,0];var r=e._draggingObject;r&&r.trigger("dragging",n),n.picked&&i&&(e._dragPrevPosition=i.concat())}else if(1==t.buttons){if(e.getDistanceOfLastMouseDown(t)>1){n=e.createDragEvent("dragstart",t);e.dispatchEvent(n);var o=n.dragObject;o&&o.draggable&&(e.dragStartFlag=!0,e._draggingObject=o)}}}))},e.prototype.initTouchEvent=function(e){var t=this,n=0,i=!1;this.domElement.addEventListener("touchstart",(function(e){t.checkEvent()&&(e.preventDefault(),e=e.changedTouches[0],(e=t.createEvent(e,"touchstart")).button&&(t.mouseDownPos[e.button]=[e.clientX,e.clientY]))})),this.domElement.addEventListener("touchmove",(function(e){if(t.checkEvent()){e.preventDefault(),e=e.changedTouches[0],e=t.createEvent(e,"touchmove");var n=t.domElement.getBoundingClientRect(),r=(e.clientX-n.left)/n.width*2-1,o=-(e.clientY-n.top)/n.height*2+1;if(t.dragStartFlag)t.draggingFlag=!0,t.dispatchEvent(t.createDragEvent("drag",e,r,o));else{n=t.domElement.getBoundingClientRect(),r=(e.clientX-n.left)/n.width*2-1,o=-(e.clientY-n.top)/n.height*2+1;t.getDistanceOfLastMouseDown(e)>1&&(t.dragStartFlag=!0,t.dispatchEvent(t.createDragEvent("dragstart",e,r,o)))}i=!0}})),this.domElement.addEventListener("touchend",(function(r){if(t.checkEvent()){var o;if(r.preventDefault(),r=r.changedTouches[0],r=t.createEvent(r,"touchend"),!i&&t.getDistanceOfLastMouseDown(r)<4)n++,setTimeout((function(){n=0}),e),r.button&&(o=t.mouseDownPos[r.button]),n>1?(t.dispatchEvent(t.createMouseEvent("dblclick",r,o)),t.clearSingleClickTimer(),n=0):(t.clickCountForSingleClick++,t.dispatchEvent(t.createMouseEvent("click",r,o)),1===t.clickCountForSingleClick?t.singleClickTimer=setTimeout((function(){t.dispatchEvent(t.createMouseEvent("singleclick",r,o)),t.clickCountForSingleClick=0}),e):t.clearSingleClickTimer());if(i=!1,t.dragStartFlag){t.dragStartFlag=!1;var a=t._draggingObject;a&&(a.trigger("dragend",t.createDragEvent("dragend",r)),t._draggingObject=null)}}}))},e.prototype.init=function(){this.initMouseEvent(250),this.initTouchEvent(250),this.initKeyboardEvent(),this.initDragEvent()},e.prototype.getDistanceOfLastMouseDown=function(e){var t=this.mouseDownPos[e.button];if(!t)return 0;var n=[void 0!==e.x?e.x:e.clientX,void 0!==e.y?e.y:e.clientY];return THING.Math.getDistance(t,n)},e.prototype.clear=function(){this.singleClickTimer=null,this.mouseMoveObject=null,this.keysPressed={},this.mouseDownPos={},this.mouseMovePos=[],this.mouseMoveDelta=null},e.prototype.update=function(){var e=this;this.mouseMoveEvents.forEach((function(t){t.hadFiltered||e.mouseMoveObject!=t.object&&(e.processMouseOffEvent(t),e.processMouseOnEvent(t),e.processMouseOverEvent(t))})),this.mouseMoveEvents=[]},e}(),_l=function(){function e(t){r(this,e),this.app=t}return e.prototype.addEventListener=function(t,n,i,r,o,a,s,l){o=o||50,void 0===this._listeners&&(this._listeners={});var u=this._listeners;void 0===u[t]&&(u[t]=[]);var c=u[t],h={__index:e._eventIDCount++,app:this.app,type:t,userData:i,priority:o,tag:a,once:s,object:l,callback:r};n&&(n.isBaseObject?h.selector=n:(h.condition=n,h.selector=new gt(this.app))),c.length?(c.push(h),o>c[c.length-2].priority&&c.sort((function(e,t){return t.priority==e.priority?e.__index-t.__index:t.priority-e.priority}))):c.push(h);var p=THING.onAddEventListener;p&&p(h)},e.prototype.traverseListener=function(e){if(void 0!==this._listeners){var t=this._listeners;for(var n in t){t[n].forEach((function(t){e(t)}))}}},e.prototype.getEventListener=function(e,t,n,i,r,o,a){if(void 0===this._listeners)return null;var s=this._listeners[e];if(void 0===s)return null;if(!r&&this._isPauseEvent(e,o,i))return null;for(var l=0,u=s.length;l<u;l++){var c=s[l];if(c.condition){if("__any_event_can_match_it__"!=t&&c.condition!=t)continue;if(o!=this.app.root&&c.selector&&o&&!c.selector.test(c.condition,[o]))continue}else if(c.object!=o)continue;if((!a||a(c))&&!(n&&c.callback!=n||i&&i!=c.tag))return{listener:c,listenerArray:s,index:l}}return null},e.prototype.getEventListeners=function(e,t,n,i,r){if(void 0===this._listeners)return[];var o=function(e,t){var n=e.selector;if(n){if(n.isBaseObject){if(n!=t)return!1}else if(!n.test(e.condition,[t]))return!1}else if(e.object!=t)return!1;return!0},a=[],s=this._listeners;if(e){if(void 0===(h=s[e]))return[];if(!i&&this._isPauseEvent(e,r,n))return[];for(var l=0;l<h.length;l++){var u=h[l];t&&u.callback!=t||(n||u.tag)&&(n&&u.tag!=n||o(u,r)&&a.push(u))}}else for(var c in s){var h=s[c];if(i||!this._isPauseEvent(c,r,n))for(l=0;l<h.length;l++){o(u=h[l],r)&&a.push(u)}}return a},e.prototype.removeEventListener=function(e,t,n,i,r){if(void 0!==this._listeners){var o=this._listeners[e];if(void 0!==o)for(var a=0;a<o.length;a++){if((n=o[a]).object==r){if(n.selector)if(n.selector.isBaseObject){if(t!=n.selector)continue}else if(n.condition!=t)continue;if(!i||n.tag==i){var s=THING.onRemoveEventListener;s&&s(n),n.removed=!0,o.splice(a--,1)}}}}},e.prototype.removeAllListeners=function(){var e=THING.onRemoveEventListener;if(e)for(var t in this._listeners)this._listeners[t].forEach((function(t){e(t)}));this._listeners=void 0},e.prototype.checkObject=function(e,t){if(t.object){if(t.object!=e.object&&!t.object.canAcceptEvent(e))return!1;if(this._getStopPropagation(e)){if(e.object&&e.object.isChildOf(t.object))return!1;var n=e.intersect;if(n&&n.node.isChildOf(e.object.node))return!1}}return!0},e.prototype._getStopPropagation=function(e){var t;if(!(t=Ne.isFunction(e.stopPropagation)?e._stopPropagation:e.stopPropagation)){var n=e.type;-1!==["levelchange","enterlevel","leavelevel","levelflyend","load","complete","mouseenter","mouseleave"].indexOf(n)&&(t=!0)}return t=Ne.parseValue(THING.__stopEventPropagation__,t)},e.prototype.getBindingObjectBySelector=function(e,t,n){var i=this._getStopPropagation(e);if(n.isBaseObject){if(n!=e.object&&!i&&n.isChildOf(e.object))return e.object}else if(e.object){if(n.test(t.condition,[e.object]))return e.object;if(!i){var r=e.object.parents,o=n.queryResult(t.condition,r);if(o.length)return o[0]}}return null},e.prototype.getBindingObject=function(e,t,n){var i,r=t.selector,o=t.once;if(r){if(n)return null;if(!(i=this.getBindingObjectBySelector(e,t,r)))return null}else if(!this.checkObject(e,t))return null;var a=i||e.object||t.object||window;return o&&r&&a._ignoreEvents&&a._ignoreEvents.has(t)?null:a},e.prototype.dispatchEvent=function(e,t){if(void 0!==this._listeners){var n,i=this._listeners[e.type];if(void 0!==i)for(var r=i.slice(0),o=0;o<r.length;o++){var a=r[o],s=a.selector,l=a.userData,u=a.once,c=a.tag;if(!a.removed&&!this._isPauseEvent(e.type,e.object,c)){var h=this.getBindingObject(e,a,t);if(h&&!h.destroyed&&!this._isPauseEvent(e.type,h,c)){var p,d,f=e.data;l&&(e.data=l),s?h.isBaseObject&&(p=e.object,e.object=h):a.object&&(p=e.object,e.object=a.object),e.object&&(d=e.pickedObject,e.pickedObject=e.object);var m=e.beforeTrigger;m&&m(e);var g=THING.onBeforeCallEventListener;g&&g(a,e),h.isBaseObject&&(e.__lastObject__=h);var v=a.callback.call(h,e,a.tag);Ne.isNull(v)||(n=v);var y=THING.onAfterCallEventListener;y&&y(a,e);var b=e.afterTrigger;if(b&&b(e),s?e.object==h&&(e.object=p):e.object==a.object&&(e.object=p),d?e.pickedObject=d:delete e.pickedObject,e.data=f,u)if(s)h._ignoreEvents=h._ignoreEvents||new Set,h._ignoreEvents.add(a);else{var _=i.indexOf(a);-1!==_&&i.splice(_,1)}}}}return n}},e}();_l._eventIDCount=1;var xl=function(){function e(t){r(this,e),this.app=t,this._pauseSelector=null,this._pauseEvents=new Map,this._resumeEvents=new Map}return e.prototype._isEvent=function(e,t,n,i,r){var o=e.get(t);if(!o)return!1;if(i&&o._tag_names&&!o._tag_names.has(i))return!1;for(var a=0,s=o.length;a<s;a++){var l=o[a],u=l.selector;if(n){if(Ne.isString(n)){if(n!=u)continue}else if(u)if(u.isBaseObject){if(u!=n)continue}else if("*"!=u&&!this._pauseSelector.test(u,[n]))continue}else if(u)continue;if((!r||r(i,l.tag))&&(!l.parent||!n||n.isChildOf(l.parent)))return!0}return!1},e.prototype.isPauseEvent=function(e,t,n){function i(e,t){return!t||e==t}return e=Ne.toLowerCase(e),!!this._isEvent(this._pauseEvents,e,t,n,i)&&!this._isEvent(this._resumeEvents,e,t,n,i)},e.prototype.isSameSelector=function(e,t){return e&&t&&e.isSelector&&t.isSelector?e.equals(t):e==t},e.prototype.update=function(){this._pauseEvents.forEach((function(e){for(var t=0;t<e.length;t++){e[t].justInFrame&&e.splice(t--,1)}}))},e.prototype.hasPauseEvent=function(e,t,n,i,r){var o=this._pauseEvents.get(e);if(!o)return!1;for(var a=0;a<o.length;a++){var s=o[a];if(this.isSameSelector(s.selector,t)&&(s.tag==n&&s.justInFrame==i&&s.parent==r))return!0}return!1},e.prototype.pauseEvent=function(e,t,n,i,r){if(e=Ne.toLowerCase(e)){if(this._pauseSelector||(this._pauseSelector=new gt(this.app)),!this.hasPauseEvent(e,t,n,i,r)){var o={eventType:e,selector:t,tag:n,justInFrame:i,parent:r},a=this._pauseEvents.get(e);a||(a=[],this._pauseEvents.set(e,a)),n&&(a._tag_names=a._tag_names||new Set,a._tag_names.add(n)),a.push(o)}}else console.error("event type is invalid, please check it")},e.prototype.removeResumeEvents=function(e,t,n,i){var r=this._resumeEvents.get(e);if(r)for(var o=0;o<r.length;o++){var a=r[o];a.selector==t&&(a.parent==i&&(n&&n!=a.tag||r.splice(o--,1)))}},e.prototype.resumeEvent=function(e,t,n,i){if(e=Ne.toLowerCase(e)){var r=this._pauseEvents.get(e);if(r){t||(i=null);for(var o=0;o<r.length;o++){var a=r[o];if(this.isSameSelector(a.selector,t)&&a.parent==i){if(a.tag){if(a.tag!=n)continue}else if(n){var s=this._resumeEvents.get(e);s||(s=[],this._resumeEvents.set(e,s)),s.push({eventType:e,selector:t,tag:n,parent:i});continue}return this.removeResumeEvents(e,t,n,i),r.splice(o,1),!0}}return!1}}else console.error("event type is invalid, please check it")},e.prototype.clear=function(){this._pauseSelector=null,this._pauseEvents=new Map,this._resumeEvents=new Map},e}(),El=function(){function e(t){r(this,e),this.app=t,this._eventSelectors={residentEvents:{name:"residentEvents"},app:{name:"app"},objectEvents:{name:"objectEvents"}};var n=this;this._eventSelectors.forEach=function(e){e(n._eventSelectors.residentEvents),e(n._eventSelectors.app),e(n._eventSelectors.objectEvents)},this._eventSelectors.hasEvent=function(e,t,i,r,o){for(var a=[n._eventSelectors.residentEvents,n._eventSelectors.app,n._eventSelectors.objectEvents],s=0;s<a.length;s++)if(a[s].hasEvent(e,t,i,r,o))return!0;return!1},this._eventSelectors.forEach((function(e){n._initEventSelector(e)})),this._eventPauser=new xl(this.app),this._eventIDCount=0}return e.prototype._initEventSelector=function(e){var t=this,n=new _l(this.app);e._trigger=n,e._trigger._isPauseEvent=function(e,n,i){return t.isPauseEvent(e,n,i)},e.traverse=function(e){for(var t in n._listeners){if(!1===e(t,n._listeners[t]))return}},e.hasEvent=function(e,t,i,r,o){return!!n.getEventListener(e,"__any_event_can_match_it__",t,i,r,o)},e.getEvents=function(e,t,i,r,o){return n.getEventListeners(e,t,i,r,o)},e.traverseListener=function(e){n.traverseListener(e)},e.replaceObjectEvent=function(e,t){for(var i in n._listeners)n._listeners[i].forEach((function(n){n.selector==t&&(n.selector=e),n.object==t&&(n.object=e)}))},e.removeObjectEvent=function(e,t,i,r,o){n.removeEventListener(e,t,i,r,o)},e.bindObjectEvent=function(e,t,i,r,o,a,s,l){var u=n.getEventListener(e,t,null,a,!1,l,(function(e){return!!a&&(!e.tag||e.tag==a)}));u&&u.listenerArray.splice(u.index,1),n.addEventListener(e,t,i,r,o,a,s,l)},e.trigger=function(e,t){if(e.type=Ne.toLowerCase(e.type),e.type)return n.dispatchEvent(e,t);console.error("event type is invalid, please check it")}},e.prototype.isPauseEvent=function(e,t,n){return this._eventPauser.isPauseEvent(e,t,n)},e.prototype.hasPauseEvent=function(e,t,n,i,r){return this._eventPauser.hasPauseEvent(e,t,n,i,r)},e.prototype.pauseEvent=function(e,t,n,i,r){this._eventPauser.pauseEvent(e,t,n,i,r)},e.prototype.resumeEvent=function(e,t,n,i){return this._eventPauser.resumeEvent(e,t,n,i)},e.prototype.hasEvent=function(e,t,n,i,r){return!!this._eventSelectors.hasEvent(e,t,n,i,r)},e.prototype.getEvents=function(e,t,n,i,r){var o=[];return this._eventSelectors.forEach((function(a){var s=a.getEvents(e,t,n,i,r);s&&s.forEach((function(e){o.push(e)}))})),o},e.prototype.traverseListener=function(e){this._eventSelectors.forEach((function(t){t.traverseListener(e)}))},e.prototype.replaceObjectEvent=function(e,t){this._eventSelectors.forEach((function(n){n.replaceObjectEvent(e,t)}))},e.prototype.removeObjectEvent=function(e,t,n,i,r){this._eventSelectors.forEach((function(o){o.removeObjectEvent(e,t,n,i,r)}))},e.prototype.addEventListener=function(e,t,n){return this.bindCall(e,null,null,t,null,!1,n)},e.prototype.removeEventListener=function(e,t){return this.unbindCall(e,null,t)},e.prototype.bindCall=function(e,t,n,i,r,o,a){if(!(e=Ne.toLowerCase(e)))return console.error("event type is invalid, please check it"),null;var s=Ne.parseEvent(t,n,i,r,null,a);return s?(s.selector?this._eventSelectors.objectEvents.bindObjectEvent(e,s.selector,s.userData,s.callback,s.priority,s.tag,o,this.app.root):this._eventSelectors.app.bindObjectEvent(e,s.selector,s.userData,s.callback,s.priority,s.tag,o,null),s):null},e.prototype.unbindCall=function(e,t,n){if(!(e=Ne.toLowerCase(e)))return console.error("event type is invalid, please check it"),null;var i=Ne.parseEvent(t,null,n);return i?(i.selector?this._eventSelectors.objectEvents.removeObjectEvent(e,i.selector,i.callback,i.tag,this.app.root):this._eventSelectors.app.removeObjectEvent(e,i.selector,i.callback,i.tag),i):null},e.prototype.triggerCall=function(e){return this._eventSelectors.app.trigger(e,!0)},e.prototype.bindCallObj=function(e,t,n,i,r,o,a,s){if(!(e=Ne.toLowerCase(e)))return console.error("event type is invalid, please check it"),null;var l=Ne.parseEvent(t,n,i,o,s);if(!l)return null;var u=this;return r.forEach((function(t){u._eventSelectors.objectEvents.bindObjectEvent(e,l.selector,l.userData,l.callback,l.priority,l.tag,a,t)})),l},e.prototype.unbindCallObj=function(e,t,n,i){e=Ne.toLowerCase(e);var r=Ne.parseEvent(t,null,n);if(!r)return null;var o=this;return i.forEach((function(t){o._eventSelectors.objectEvents.removeObjectEvent(e,r.selector,r.callback,r.tag,t)})),r},e.prototype.hasAnyCallObjects=function(e,t){var n=this._eventSelectors.objectEvents,i=!1,r=this;return n.traverse((function(n,o){if(o.object&&e.indexOf(o.object)){if(t&&r._isPauseEvent(n,o.object,o.tag))return;return i=!0,!1}})),i},e.prototype.dispatchBindCallObj=function(e,t,n,i){if(t=t||{},e=Ne.toLowerCase(e)){if(Ne.isString(t)&&!i&&(i=t,t={}),!i||Ne.isString(i)){var r;Ne.isNull(t.stopPropagation)&&(t.stopPropagation=function(){this._stopPropagation=!0});var o=this;return n.forEach((function(n){var a=t.object,s=t.type,l=t.tag;t.object=n,t.type=e,t.tag=i,r=o._eventSelectors.objectEvents.trigger(t),t.object=a,t.type=s,t.tag=l})),r}console.error('Trigger "'+e+'" failed, due to tag is not string type')}else console.error("event type is invalid, please check it")},e.prototype.addResidentEventListener=function(e,t){(e=Ne.toLowerCase(e))?this._eventSelectors.residentEvents._trigger.addEventListener(e,null,null,t):console.error("event type is invalid, please check it")},e.prototype.removeResidentEventListener=function(e,t){(e=Ne.toLowerCase(e))?this._eventSelectors.residentEvents._trigger.removeEventListener(e,null,t):console.error("event type is invalid, please check it")},e.prototype.update=function(){this._eventSelectors.forEach((function(e){e.trigger({type:"update"})})),this._eventPauser.update()},e.prototype.clear=function(){this._eventSelectors.forEach((function(e){e.removeAllListeners()})),this._eventPauser.clear()},e.prototype.unbindAppEvents=function(e){this._eventSelectors.forEach((function(t){for(var n in t._listeners)for(var i=t._listeners[n],r=0;r<i.length;r++){i[r].app.uuid==e&&i.splice(r--,1)}}))},e.prototype._isAppEvent=function(e){return-1!==["dragstart","drag","dragging","dragend","keydown","keypress","keyup"].indexOf(e)},e.prototype.dispatchEvent=function(e){var t=[this._eventSelectors.residentEvents,this._eventSelectors.app],n=[];if(t.forEach((function(t){var i=t.trigger(e);Ne.isNull(i)||n.push(i)})),e.object){var i=e.object.trigger(e.type,e);Ne.isNull(i)||n.push(i);var r=e.object.parent;if(r&&!e._stopPropagation){var o=r.canAcceptEvent(e);if(o){!0===o&&(o=r);var a=e.object;e.object=o;i=o._eventTrigger.dispatchEvent(e.type,o,e);Ne.isNull(i)||n.push(i),e.object=a}}}if(this._isAppEvent(e.type)){i=this._eventSelectors.objectEvents.trigger(e);Ne.isNull(i)||n.push(i)}if(n.length)return n[0]},e}(),wl=function(){function e(t){r(this,e),this.app=t,this.eventTriggerManager=new El(this.app),this.eventProcessor=new bl(this.eventTriggerManager)}return e.prototype.addResidentEventListener=function(e,t){this.eventTriggerManager.addResidentEventListener(e,t)},e.prototype.removeResidentEventListener=function(e,t){this.eventTriggerManager.removeResidentEventListener(e,t)},e.prototype.addEventListener=function(e,t,n){this.eventTriggerManager.addEventListener(e,t,n)},e.prototype.removeEventListener=function(e,t){this.eventTriggerManager.removeEventListener(e,t)},e.prototype.dispatchEvent=function(e){return this.eventTriggerManager.dispatchEvent(e)},e.prototype.update=function(){this.eventProcessor.update(),this.eventTriggerManager.update()},e.prototype.bindCall=function(e,t,n,i,r,o,a){return this.eventTriggerManager.bindCall(e,t,n,i,r,o,a)},e.prototype.unbindCall=function(e,t,n){return"singleclick"==e&&this.eventProcessor.clearSingleClickTimer(),this.eventTriggerManager.unbindCall(e,t,n)},e.prototype.triggerCall=function(e){return this.eventTriggerManager.triggerCall(e)},e.prototype.bindCallObj=function(e,t,n,i,r,o,a,s){return this.eventTriggerManager.bindCallObj(e,t,n,i,r,o,a,s)},e.prototype.unbindCallObj=function(e,t,n,i){return this.eventTriggerManager.unbindCallObj(e,t,n,i)},e.prototype.hasAnyCallObjects=function(e,t){return this.eventTriggerManager.hasAnyCallObjects(e,t)},e.prototype.dispatchBindCallObj=function(e,t,n,i){return this.eventTriggerManager.dispatchBindCallObj(e,t,n,i)},e.prototype.isPauseEvent=function(e,t,n){return this.eventTriggerManager.isPauseEvent(e,t,n)},e.prototype.pauseEvent=function(e,t,n,i,r){this.eventTriggerManager.pauseEvent(e,t,n,i,r)},e.prototype.resumeEvent=function(e,t,n,i){return this.eventTriggerManager.resumeEvent(e,t,n,i)},e.prototype.hasEvent=function(e,t,n,i){return this.eventTriggerManager.hasEvent(e,null,n,i,t)},e.prototype.getEvents=function(e,t,n,i){return this.eventTriggerManager.getEvents(e,null,n,i,t)},e.prototype.traverseListener=function(e){return this.eventTriggerManager.traverseListener(e)},e.prototype.replaceObjectEvent=function(e,t){return this.eventTriggerManager.replaceObjectEvent(e,t)},e.prototype.canClick=function(e){return!(this.eventProcessor.getDistanceOfLastMouseDown(e)>4)},e.prototype.isKeyPressed=function(e){return!!this.eventProcessor.keysPressed[e]},e.prototype.clear=function(){this.eventTriggerManager.clear(),this.eventProcessor.clear()},e.prototype.clearSingleClickTimer=function(){this.eventProcessor.clearSingleClickTimer()},e.prototype.unbindAppEvents=function(e){this.eventTriggerManager.unbindAppEvents(e)},o(e,[{key:"mousePosition",get:function(){return this.eventProcessor.mouseMovePos}},{key:"skipFrameCount",set:function(e){this.eventProcessor.skipFrameCount=e},get:function(){return this.eventProcessor.skipFrameCount}}]),e}(),Tl=function(){function e(t,n,i){for(var o in r(this,e),this.app=t,this.name=n,this.defaultKeyName="name",this.initialState=null,this.runningState=null,this.states=new Map,i)this.addState(o,i[o])}return e.prototype.getFromState=function(e,t){var n=e[t.stateType];if(void 0!==n&&Ne.isFunction(n)){var i=e[t.stateType](t);if(null!==i)return i}return null},e.prototype.dispatchEventToState=function(e,t){var n=e[t.stateType];void 0!==n&&Ne.isFunction(n)&&e[t.stateType](t,t.params)},e.prototype.findState=function(e){return this.states.get(e)},e.prototype.prevState=function(){this.dispatchEvent({stateType:"onPrevState"})},e.prototype.nextState=function(){this.dispatchEvent({stateType:"onNextState"})},e.prototype.clone=function(t){var n={},i=this.app.stateManager.stateFactory,r=this.states.keys(),o=Array.isArray(r),a=0;for(r=o?r:r[Symbol.iterator]();;){var s;if(o){if(a>=r.length)break;s=r[a++]}else{if((a=r.next()).done)break;s=a.value}var l=s,u=i.get(l);if(!u)return null;n[l]=new u(this.app)}return new e(this.app,t,n)},e.prototype.get=function(e){if(this.runningState)return this.getFromState(this.runningState,e);if(this.states.length>1){var t=this.states,n=Array.isArray(t),i=0;for(t=n?t:t[Symbol.iterator]();;){var r;if(n){if(i>=t.length)break;r=t[i++]}else{if((i=t.next()).done)break;r=i.value}var o=r,a=this.getFromState(o,e);if(null!==a)return a}}return null},e.prototype.dispatchEvent=function(e){var t=this;this.runningState?this.dispatchEventToState(this.runningState,e):this.states.length>1&&this.states.forEach((function(n){t.dispatchEventToState(n,e)}))},e.prototype.enter=function(e,t){t=t||{};var n=this.findState(e);if(!n)return null;this.initialState||(this.initialState=n);var i=this.runningState;return this.leave(),this.app.trigger("beforeEnterState",{state:i,nextState:n}),i&&(t.prevState=i),this.runningState=n,this.dispatchEventToState(this.runningState,{stateType:"onEnter",params:t}),this.app.trigger("afterEnterState",{state:n,prevState:t.prevState}),delete t.prevState,this.runningState},e.prototype.leave=function(){if(this.runningState){var e={};this.runningState&&(e.state=this.runningState,e.stateName=this.runningState[this.defaultKeyName]),this.app.trigger("beforeLeaveState",e),this.dispatchEventToState(this.runningState,{stateType:"onLeave"}),this.runningState=null,this.app.trigger("afterLeaveState",e)}},e.prototype.addState=function(e,t){void 0===t[this.defaultKeyName]&&(t[this.defaultKeyName]=e),t.isState=!0,t.stateGroup=this,this.states.set(e,t)},e.prototype.isInitialState=function(){return this.runningState==this.initialState},e.prototype.isRunningState=function(e){var t=this.findState(e);return!!t&&t==this.runningState},e.prototype.getRunningStateName=function(){if(this.runningState){var e=this.states.keys(),t=Array.isArray(e),n=0;for(e=t?e:e[Symbol.iterator]();;){var i;if(t){if(n>=e.length)break;i=e[n++]}else{if((n=e.next()).done)break;i=n.value}var r=i;if(this.runningState==this.states.get(r))return r}}return""},e.prototype.hasState=function(e){if(Ne.isString(e))return this.states.has(e);var t=this.states.keys(),n=Array.isArray(t),i=0;for(t=n?t:t[Symbol.iterator]();;){var r;if(n){if(i>=t.length)break;r=t[i++]}else{if((i=t.next()).done)break;r=i.value}var o=r;if(e==this.states.get(o))return!0}return!1},e.prototype.clear=function(){this.leave();for(var e=[].concat(this.states.values()),t=0;t<e.length;t++)delete e[t];delete this.states},e}(),Ml=function(){function e(t){r(this,e),this.app=t,this.eventManager=t.events,this.stateFactory=new Map,this.stateGroupID=1,this.stateGroups=new Array,this.init()}return e.prototype.init=function(){var e={click:"onClick",dblclick:"onDoubleClick",singleclick:"onSingleClick",mouseover:"onMouseOver",mouseout:"onMouseOut",mouseup:"onMouseUp",mousedown:"onMouseDown",mousemove:"onMouseMove",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",keydown:"onKeyDown",keypress:"onKeyPress",keyup:"onKeyUp"},t=this;for(var n in e)this.eventManager.addResidentEventListener(n,(function(n){n.stateType=e[n.type],t.dispatchEvent(n),delete n.stateType}))},e.prototype.clear=function(){this.stateFactory.clear(),this.stateGroupID=1,this.stateGroups=[]},e.prototype.findState=function(e){var t=this.stateGroups,n=Array.isArray(t),i=0;for(t=n?t:t[Symbol.iterator]();;){var r;if(n){if(i>=t.length)break;r=t[i++]}else{if((i=t.next()).done)break;r=i.value}var o=r.findState(e);if(o)return o}return null},e.prototype.findStateGroup=function(e){var t=this.stateGroups,n=Array.isArray(t),i=0;for(t=n?t:t[Symbol.iterator]();;){var r;if(n){if(i>=t.length)break;r=t[i++]}else{if((i=t.next()).done)break;r=i.value}var o=r;if(o.name==e||o.hasState(e))return o}return null},e.prototype.get=function(e){for(var t=0;t<this.stateGroups.length;t++){var n=this.stateGroups[t].get(e);if(n)return n}return null},e.prototype.dispatchEvent=function(e){Ne.isString(e)?this.dispatchEvent({type:e}):this.stateGroups.forEach((function(t){t.dispatchEvent(e)}))},e.prototype._genGroupName=function(){var e="StateManagerInternal_"+this.stateGroupID.toString();return this.stateGroupID++,e},e.prototype.clone=function(e){var t=this.findStateGroup(e);if(!t)return null;e=this._genGroupName();var n=t.clone(e);return this.stateGroups.push(n),n},e.prototype.remove=function(e){for(var t=0;t<this.stateGroups.length;t++)if(this.stateGroups[t]==e)return e.leave(),this.stateGroups[t].clear(),this.stateGroups.splice(t,1),!0;return!1},e.prototype.register=function(e,t){if(Ne.isNull(e))return null;if(Ne.isArray(e))return console.error("states should not be array type, use {} instead"),null;var n=Object.keys(e);1==n.length&&void 0===t&&(t=n[0]),Ne.isBlank(t)&&(t=this._genGroupName());var i=this.findStateGroup(t);if(i)for(var r in e)i.addState(r,e[r]);else i=new Tl(this.app,t,e),this.stateGroups.push(i);return i},e.prototype.registerEx=function(e,t){for(var n in e)this.stateFactory.set(n,e[n]),e[n]=new e[n](this.app);return this.register(e,t)},e.prototype.unregister=function(e){for(var t=0;t<this.stateGroups.length;t++)if(this.stateGroups[t].name==e)return this.stateGroups[t].clear(),this.stateGroups.splice(t,1),!0;return!1},e.prototype.change=function(e,t){var n=this.findStateGroup(e);if(!n)return console.error("state group not found: "+e),null;var i=n.enter(e,t);return i||null},e.prototype.leave=function(e){var t=this.findStateGroup(e);return t?!!t.isRunningState(e)&&(t.leave(),!0):(console.error("state group not found: "+e),!1)},e.prototype.getRunningState=function(e){var t=this.findStateGroup(e);return t?t.runningState:(console.error("state group not found: "+name),null)},e.prototype.getRunningStateName=function(e){var t=this.findStateGroup(e);return t?t.getRunningStateName():(console.error("state group not found: "+name),null)},e.prototype.hasRunningState=function(e){var t=this.findStateGroup(e);return!!t&&!!t.runningState},e.prototype.update=function(){this.dispatchEvent({stateType:"onUpdate"})},e.prototype.onUpdate=function(e){this.update(e)},e}(),Sl=function(){function e(t,n){r(this,e),this.app=t,this.reverseMode=n,this.commands=[]}return e.prototype.execute=function(){for(var e=0;e<this.commands.length;e++){this.commands[e].execute()}this.app.events.dispatchEvent({type:"executeCommand",cmd:this}),this.reverseMode&&this.commands.reverse()},e.prototype.undo=function(){for(var e=0;e<this.commands.length;e++){this.commands[e].undo()}this.reverseMode&&this.commands.reverse()},e.prototype.add=function(e){e&&this.commands.push(e)},e.prototype.remove=function(e){if(e){var t=this.commands.indexOf(e);t>-1&&this.commands.slice(t,1)}},e.prototype.clear=function(){this.commands.clear()},e}(),Cl=function(){function e(t){r(this,e),this.app=t,this.registerTypes={},this.undoList=[],this.redoList=[],this._doing=!1}return e.prototype.register=function(e,t){this.registerTypes[e]=t},e.prototype.unregister=function(e){delete this.registerTypes[e]},e.prototype._create=function(e){var t=e.type,n=this.registerTypes[t];if(n){e.app=this.app;var i=new n(e);return i.type=t,i}console.error("command not found: "+t)},e.prototype.create=function(e,t){if(Ne.isArray(e)){for(var n=new Sl(this.app,t),i=0;i<e.length;i++){var r=this._create(e[i]);n.add(r)}if(n.commands.length)return n}else{if(Ne.isObject(e))return r=this._create(e);Ne.isString(e)}return null},e.prototype.execute=function(e,t){var n=this.create(e,t);return n?(n.execute(),this._push(n),this.app.events.dispatchEvent({type:"executeCommand",cmd:n}),n):null},e.prototype._push=function(e){this._doing||(this.undoList.push(e),this.redoList.splice(0,this.redoList.length),this.app.events.dispatchEvent({type:"push"}))},e.prototype.push=function(e){this._push(e)},e.prototype.redo=function(){if(0!=this.redoList.length){this._doing=!0;var e=this.redoList.pop();e.execute(),this.undoList.push(e),this.app.events.dispatchEvent({type:"executeCommand",cmd:e}),this.app.events.dispatchEvent({type:"redo",cmd:e}),this._doing=!1}},e.prototype.undo=function(){if(0!=this.undoList.length){this._doing=!0;var e=this.undoList.pop();e.undo(),this.redoList.push(e),this.app.events.dispatchEvent({type:"executeCommand",cmd:e}),this.app.events.dispatchEvent({type:"undo",cmd:e}),this._doing=!1}},e.prototype.getRedoCount=function(){return this.redoList.length},e.prototype.getUndoCount=function(){return this.undoList.length},e.prototype.toJson=function(){for(var e=0;e<this.undoList.length;e++)this.undoList[e];return"not impl~"},e}(),Al=new THREE.Vector2,Rl=function(){function e(t){r(this,e),this.app=t,this.events=t.events,this.baseURL=t.baseURL,this.scene=t.scene,this.renderer=t.renderer,this.objectManager=t.objectManager,this.resourceManager=t.resourceManager,this._background=null,this._backgroundResource=null,this._backgroundAdditiveColor=new THREE.Color(0,0,0),this._backgroundColorScaleFactor=new THREE.Vector3(1,1,1),this._skyBox=null,this._skyBoxResource=null,this._fogEnable=!1,this._fogConfig={},this._fogLinear=null,this._fogExp2=null,this._enableDeafultViewPointFile=!1,this._defaultViewPointFileName="viewpoint.json",this.init()}return e.prototype.init=function(){this.initRenderControl()},e.prototype.initRenderControl=function(){var e=new THREE.Vector3,t=new THREE.Vector3;function n(n,i){n.node.traverse((function(r){if(r.material){e.setFromMatrixPosition(i.matrixWorld),t.setFromMatrixPosition(r.matrixWorld);var o=e.distanceTo(t);n.renderDistance>0&&(r.visible=o<n.renderDistance),n.shadowDistance>0&&(r.castShadow=o<n.shadowDistance)}}))}var i=this;this.app.scene.onBeforeRender=function(){var e=i.app.renderCamera;i.objectManager.renderDistanceObjects.forEach((function(t){n(t,e)})),i.objectManager.shadowDistanceObjects.forEach((function(t){n(t,e)}))}},e.prototype.synBackgroundColor=function(){var e=this._skyBoxResource;if(e&&e.isCubeTexture){e.colorMatrix=e.colorMatrix||new THREE.Matrix4;var t=this._backgroundAdditiveColor;if(t){var n=new THREE.Vector3(t.r,t.g,t.b);e.colorMatrix.setPosition(n)}var i=this._backgroundColorScaleFactor;if(i){var r=new THREE.Vector3(i.x,i.y,i.z);e.colorMatrix.setScale(r)}}},e.prototype._keepBackgroundAspect=function(){if(this._backgroundResource&&this._backgroundResource.isTexture){var e=this._backgroundResource,t=this.app.renderer.getSize(Al),n=t.width/t.height,i=e.image.width/e.image.height;n>i?(e.offset.set(0,.5-i/n*.5),e.repeat.set(1,i/n)):(e.offset.set(.5-n/i*.5,0),e.repeat.set(n/i,1))}},e.prototype._resetBackgroundAspect=function(){if(this._backgroundResource&&this._backgroundResource.isTexture){var e=this._backgroundResource;e.offset.set(0,0),e.repeat.set(1,1)}},e.prototype.closeSkyEffect=function(){this.setSkyEffect(null)},e.prototype.setSkyEffect=function(e){e?(this._skyEffect||(this._skyEffect=this.app.create({type:"SkyEffect",parent:this.app.root})),this._skyEffect.setConfig(e),this._skyEffect.visible=!0,this.app._lightGroup&&(this.app._lightGroup.visible=!this._skyEffect.getConfig().light)):(this._skyEffect&&(this._skyEffect.visible=!1),this.app._lightGroup&&(this.app._lightGroup.visible=!0))},e.prototype.setFogLinear=function(e,t,n){e=Ne.parseColor(e),this._fogLinear?(this._fogLinear.color.set(e),this._fogLinear.near=t,this._fogLinear.far=n):this._fogLinear=new THREE.Fog(e,t,n),this.app.scene.fog=this._fogLinear},e.prototype.clearFogLinear=function(){this._fogLinear&&(this._fogLinear=null,this.app.scene.fog=null)},e.prototype.setFogExp2=function(e,t){e=Ne.parseColor(e),this._fogExp2?(this._fogExp2.color.set(e),this._fogExp2.density=t):this._fogExp2=new THREE.FogExp2(e,t),this.app.scene.fog=this._fogExp2},e.prototype.clearFogExp2=function(){this._fogExp2&&(this._fogExp2=null,this.app.scene.fog=null)},e.prototype.closeFog=function(){this.clearFogLinear(),this.clearFogExp2(),this._fogEnable=!1},e.prototype.setFog=function(e){e=e||{},this._fogConfig=Ne.mergeObject(this._fogConfig,e,!0);var t=e.type,n=e.color||8421504;if("Exp2"==t){var i=e.density||.1;this.setFogExp2(n,i)}else{var r=e.near||10,o=e.far||100;this.setFogLinear(n,r,o)}this._fogEnable=!0,this.app.needUpdate=!0},e.prototype.onResize=function(e,t){if(this._backgroundResource&&this._backgroundResource.isCanvasTexture){var n=this._backgroundResource,i=e/t,r=n.image.width/n.image.height;i<r?(n.offset.set(0,.5-r/i*.5),n.repeat.set(1,r/i)):(n.offset.set(.5-i/r*.5,0),n.repeat.set(i/r,1))}},e.prototype.onUpdate=function(e){this._backgroundResource&&this._backgroundResource.isCanvasTexture&&(this._backgroundResource.needsUpdate=!0)},e.prototype.showLightHelper=function(e){console.warn("[SceneManager] Please use app.lighting={ showHelper: "+e+" } instead"),this.app._lightGroup.setConfig({showHelper:e})},e.prototype.closeSceneLights=function(){console.warn("[SceneManager] Please use app.lighting=null instead"),this.app._lightGroup.setConfig(Rs)},o(e,[{key:"background",set:function(e){var t=this;if(this.background!=e){if(this._skyBox=null,this._backgroundResource&&this._backgroundResource.name!=e&&(this._backgroundResource.isTexture&&this._backgroundResource.dispose(),this._backgroundResource=null),this._background=e,e){var n=Ne.parseColor(e,null);if(n)this.scene.background=n,this._backgroundResource=n;else if(Ne.isString(e))if(this._backgroundResource)this.scene.background=this._backgroundResource;else{var i=this.app.confirmURL(e);this.app.resourceManager.loadTexture(i,(function(n){t.scene.background=n,t._backgroundResource=n,t._backgroundResource.name=e,t.app.keepBackgroundAspect?t._keepBackgroundAspect():t._resetBackgroundAspect()}))}else"CANVAS"==e.tagName?(this._backgroundResource=new THREE.CanvasTexture(e),this._backgroundResource.needsUpdate=!0,this.scene.background=this._backgroundResource,this.app.keepBackgroundAspect?this._keepBackgroundAspect():this._resetBackgroundAspect()):"VIDEO"==e.tagName&&(this._backgroundResource=new THREE.VideoTexture(e),this._backgroundResource.needsUpdate=!0,this.scene.background=this._backgroundResource,this.app.keepBackgroundAspect?this._keepBackgroundAspect():this._resetBackgroundAspect())}else this.scene.background=Ne.parseColor(this.app._bgColor);this.app.trigger("backgroundChanged",{background:e})}},get:function(){return this._background}},{key:"backgroundAdditiveColor",set:function(e){this._backgroundAdditiveColor=Ne.parseColor(e),this.synBackgroundColor()},get:function(){return this._backgroundAdditiveColor.toHexString()}},{key:"backgroundColorScaleFactor",set:function(e){this._backgroundColorScaleFactor=Ne.parseVector3(e),this.synBackgroundColor()},get:function(){return this._backgroundColorScaleFactor.toArray()}},{key:"skyBox",set:function(e){if(this.skyBox!=e){this._background=null,this._skyBox=e,this.app.trigger("skyboxchange",{skyBox:e});var t=void 0;if(this._skyBoxResource){if(this._skyBoxResource.name==e)return void(this.scene.background=this._skyBoxResource);t=this._skyBoxResource}var n=this;if(Ne.isString(e)&&(e.indexOf(".png")>-1||e.indexOf(".jpg")>-1))this.app.resourceManager.loadTexture(this.app.confirmURL(e),(function(i){n._skyBox==e&&(i.mapping=THREE.EquirectangularReflectionMapping,n.scene.background=i,n._skyBoxResource=i,n._skyBoxResource.name=e,n.synBackgroundColor(),t&&t.dispose())}));else{var i=this.app.confirmURL(Ne.parseCubeTextureUrls(e));i?this.app.resourceManager.loadCubeTexture(i,(function(i){n._skyBox==e&&(i.format=THREE.RGBFormat,n.scene.background=i,n._skyBoxResource=i,n._skyBoxResource.name=e,n.synBackgroundColor(),t&&t.dispose())})):this.scene.background=Ne.parseColor(this.app._bgColor)}}},get:function(){return this._skyBox}},{key:"enableDeafultViewPointFile",set:function(e){this._enableDeafultViewPointFile=e},get:function(){return this._enableDeafultViewPointFile}},{key:"defaultViewPointFileName",set:function(e){this._defaultViewPointFileName=e},get:function(){return this._defaultViewPointFileName}},{key:"fogEnable",get:function(){return this._fogEnable}},{key:"skyEffectEnable",get:function(){return!!this.sky}}]),e}();function Pl(e,t){var n=e.get(t.key);if(n){if(n.refCount&&n.refCount--,n.refCount)return!1;t.dispose(),e.delete(t.key)}return!0}var Dl=function(){function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];r(this,e),this.app=t,this._textures=new Map,this._cubeTextures=new Map,this._enableFileNameAsKey=n,this._textureLoader=new THREE.TextureLoader(this.app.loadingManager),this._cubeTextureLoader=new THREE.CubeTextureLoader}return e.prototype.loadTexture=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments[3],r=this,o=arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=e.getNormalize(),l=void 0;l=this._enableFileNameAsKey&&!a?s.getFileName(!1):s,n.repeat&&(l+="_repeat"),n.anisotropy&&(l+="_a"+n.anisotropy);var u=this._textures.get(l);return u?(u.refCount++,t&&(u.image?setTimeout((function(){return t(u)}),10):(u.delayLoadCallbacks=u.delayLoadCallbacks||[],u.delayLoadCallbacks.push(t)))):((u=this._textureLoader.load(s,(function(e){var i=e.image;n.repeat&&(e.wrapS=e.wrapT=THREE.RepeatWrapping),n.anisotropy&&(e.anisotropy=n.anisotropy),t&&t(e);var o=e.delayLoadCallbacks;o&&(o.forEach((function(t){return t(e)})),e.delayLoadCallbacks=[]);var a=r.app.options.maxTextureSize;(i.width>a||i.height>a)&&console.warn("The '"+i.src+"' texture is too big("+i.width+"x"+i.height+"), max size: ("+a+"x"+a+")")}),i,o)).key=l,u.refCount=u.refCount||1,this._textures.set(l,u)),u},e.prototype.loadCubeTexture=function(e,t){var n=this.app.confirmURL(Ne.parseCubeTextureUrls(e));if(!n)return null;var i=n.toString(),r=this._cubeTextures.get(i);return r?(r.refCount++,t&&(r.version>0?setTimeout((function(){return t(r)}),10):(r.delayLoadCallbacks=r.delayLoadCallbacks||[],r.delayLoadCallbacks.push(t)))):((r=this._cubeTextureLoader.load(n,(function(e){var n=e.image;if(n&&6===n.length){for(var i=n[0].width,r=n[0].height,o=1;o<n.length;o++){var a=n[o];if(a.width!=i||a.height!=r)return void console.error("Load cube texture failed, due to image size is invalid, please make sure all size of images must be the same")}t&&t(e);var s=e.delayLoadCallbacks;s&&(s.forEach((function(t){return t(e)})),e.delayLoadCallbacks=[])}}))).key=i,r.refCount=r.refCount||1,this._cubeTextures.set(i,r)),r},e.prototype.loadTextureFromImage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._textures.get(e);return n?n.refCount++:((n=new THREE.Texture).image=e,n.needsUpdate=!0,n.key=e,n.refCount=1,this._textures.set(e,n)),t.repeat&&(n.wrapS=n.wrapT=THREE.RepeatWrapping),t.anisotropy&&(n.anisotropy=t.anisotropy),n},e.prototype.load=function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.loadTexture(e,t,{},n,i,r)},e.prototype.removeTexture=function(e){return!!Pl(this._textures,e)&&(!!Pl(this._cubeTextures,e)&&(e.dispose(),!0))},e.prototype.setCrossOrigin=function(e){return this._textureLoader.setCrossOrigin(e),this._cubeTextureLoader.setCrossOrigin(e),this},o(e,[{key:"enableFileNameAsKey",set:function(e){this._enableFileNameAsKey=e},get:function(){return this._enableFileNameAsKey}},{key:"repetitionRate",get:function(){if(!this._textures.size)return 0;var e=0;return this._textures.forEach((function(t){e+=t.refCount})),e/this._textures.size-1}}]),e}(),kl=function(){function e(t){r(this,e),this.app=t,this._deadObjects=[],this.init()}return e.prototype.init=function(){this.textureLoader=new Dl(this.app,this.app.options.enableTextureFileNameAsKey),this.textureLoader.setCrossOrigin("anonymous"),this.app.loadingManager.loadingManager.addHandler(/.*(.jpg|.png)$/,this.textureLoader)},e.prototype.disposeMaterial=function(e,t){if(void 0!==e.refCount){if(e.refCount--,e.refCount)return!1;e.dispose(),t||this.disposeTextures(e)}return!0},e.prototype.disposeTextures=function(e){if(e)for(var t in e){var n=e[t];n&&n.isTexture&&this.textureLoader.removeTexture(n)&&(e[t]=null)}},e.prototype.disposeGeometry=function(e){if(void 0!==e.refCount){if(e.refCount--,e.refCount)return!1;e.dispose()}else{if(this.app.scene.hasGeometry(e))return!1;e.dispose(),e._hasDisposed=!0}return!0},e.prototype.doDispose=function(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(null!==e){if(n&&!1===n(e))return!1;if(i&&e.children)for(var r=e.children.concat(),o=0;o<r.length;o++){var a=this.doDispose(r[o],t,n);a&&e.remove(r[o])}var s=e.geometry;if(s&&!e.isSprite&&this.disposeGeometry(s),e.material){var l=!1;if(Ne.isArray(e.material)){var u=e.material.concat();e.material=[];for(o=0;o<u.length;o++){var c=u[o];l=this.disposeMaterial(c,t)}}else l=this.disposeMaterial(e.material,t);l&&this.app.picker.removePickingResources(e)}e.isSkinnedMesh&&(t||this.disposeTextures(e.skeleton))}return!0},e.prototype.remove=function(e,t){e&&(e.removeBySelf(),this.unload(e,t))},e.prototype.unload=function(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e&&(e.isObject3D?i?this._deadObjects.push({node:e,keepTexture:t,filterFunc:n,recursive:r}):this.doDispose(e,t,n,r):console.error("must provide Object3D to unload"))},e.prototype.loadCubeTexture=function(e,t){return this.textureLoader.loadCubeTexture(e,t)},e.prototype.loadTexture=function(e,t,n){var i=null;return Ne.isString(e)?i=this.textureLoader.loadTexture(e,t,n):(i=this.textureLoader.loadTextureFromImage(e),t&&t(i)),i},e.prototype.onUpdate=function(){if(this._deadObjects.length){var e=this._deadObjects[0];this.doDispose(e.node,e.keepTexture,e.filterFunc,e.recursive),this._deadObjects.splice(0,1)}},e}(),jl=function(){function e(t){r(this,e),this.app=t;var n=this;this.loadingManager=new THREE.LoadingManager((function(){}),(function(e,t,i){0!=i&&n.app.mainUI.updateDownloadingProgress(t/i)}),(function(e){console.error("[onError] url: "+e)})),thingjs.GLTFLoader.defaultManager=this.loadingManager}return e.prototype.itemStart=function(e){this.loadingManager.itemStart(e)},e.prototype.itemEnd=function(e){this.loadingManager.itemEnd(e)},e.prototype.itemError=function(e){this.loadingManager.itemError(e)},e.prototype.resolveURL=function(e){return this.loadingManager.resolveURL(e)},e.prototype.setURLModifier=function(e){return this.loadingManager.setURLModifier(e)},e.prototype.getHandler=function(e){return this.loadingManager.getHandler(e)},e}(),Ol={temporalSuperSampling:{enable:!1,size:30},postEffect:{enable:!0,bloom:{enable:!1,strength:.14,radius:.4,threshold:.7},screenSpaceAmbientOcclusion:{enable:!1,radius:.2,quality:"medium",intensity:.8,temporalFilter:!0,ignoreTransparent:!1},screenSpaceReflection:{enable:!1,maxRayDistance:200,pixelStride:16,pixelStrideZCutoff:50,screenEdgeFadeStart:.9,eyeFadeStart:.4,eyeFadeEnd:.8,minGlossiness:.2},colorCorrection:{enable:!0,exposure:0,brightness:0,contrast:1.1,saturation:1.1,gamma:1},dof:{enable:!1,focalDepth:1,focalLength:24,fstop:.9,maxblur:1,threshold:.9,gain:1,bias:.5,dithering:1e-4},vignette:{enable:!1,type:"blur",color:0,offset:1.5},film:{enable:!1,grayscale:!1,noiseIntensity:.35,scanlinesIntensity:0,scanlinesCount:2048},RBSplit:{enable:!1,offsetX:2,offsetY:2,power:2},chromaticAberration:{enable:!1,chromaFactor:.025},blur:{enable:!1,radius:5,bounds:[[0,0,.5,.5],[.5,.5,1,1]]},FXAA:{enable:!1},MSAA:{enable:!0}}},Fl=function(){function e(t,n){r(this,e),this._manager=t,this._defaultConfig=Ne.cloneObject(n,!1),this._config=Ne.cloneObject(n,!1)}return e.prototype.setConfig=function(e){return this._config=Ne.cloneObject(e,!1),this},e.prototype.getConfig=function(){return this._config},e.prototype.save=function(){return this._defaultConfig=Ne.cloneObject(this._config,!1),this},e.prototype.mergeConfig=function(e){return e=Ne.cloneObject(e,!1),Ne.mergeObject(e,this._config),this._config=e,this},e.prototype.mergeWithSavedConfig=function(e){return e=Ne.cloneObject(e,!1),Ne.mergeObject(e,this._defaultConfig),this._config=e,this},e.prototype.lock=function(){return this._manager.lock(this),this},e.prototype.unlock=function(){return this._manager.unlock(this),this},e.prototype.update=function(e){return this._manager._update(this,e),this},e.prototype.active=function(e){return this._manager._active(this,e),this},e.prototype.destroy=function(){this._manager=null,this._config=null,this._defaultConfig=null},e}(),Bl=function(){function e(){r(this,e),this._lockedControl=null,this._control=null}return e.prototype.createControl=function(e){return new Fl(this,e)},e.prototype.lock=function(e){this._lockedControl=e},e.prototype.unlock=function(e){this._lockedControl===e&&(this._lockedControl=null)},e.prototype.getActiveControl=function(){return this._control},e.prototype.getCurrentControl=function(){return this._lockedControl||this._control},e.prototype._active=function(e,t){return this._lockedControl!==e&&(this._control=e),this._lockedControl||this._control},e.prototype._update=function(e,t){var n=this.getCurrentControl();return n===e?n:null},e.prototype.destroy=function(){this._lockedControl=null,this._control=null},e}();var Ll=new THREE.Vector2,Il=function(e){function t(n,i){r(this,t);var o=s(this,e.call(this));o.app=n,n.renderer.localClippingEnabled=!0;var a=n.renderer.getDrawingBufferSize(Ll),l=a.width,u=a.height;return o._mainRenderer=new Cr(l,u,i,n.renderer.capabilities.maxSamples),o._mainRenderer.combineGlow=!0,o._captureRenderTarget=new THREE.WebGLRenderTarget(l,u,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),o._captureBuffer=new Uint8Array(4*l*u),o}return a(t,e),t.prototype.createControl=function(e){return new Nl(this,e)},t.prototype._active=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.app.root.box;t=e.prototype._active.call(this,t),this._mainRenderer.setConfig(t._config,n)},t.prototype._update=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.app.root.box,i=e.prototype._update.call(this,t);i&&this._mainRenderer.setConfig(i._config,n)},t.prototype.update=function(){this._mainRenderer.render(this.app.renderer,this.app.scene,this.app.renderCamera);var e=this.app.cssScene;e.children.length&&this.app.cssRenderer.render(e,this.app.renderCamera),this.app.picker.render(this.app.renderer)},t.prototype.resize=function(e,t){this.app.renderer.setSize(e,t),this.app.cssRenderer.setSize(e,t);var n=this.app.renderer.getDrawingBufferSize(Ll);this._mainRenderer.setSize(n.width,n.height),this._resizeCaptureBuffer(e,t)},t.prototype._resizeCaptureBuffer=function(e,t){this._captureRenderTarget.setSize(e,t);var n=4*e*t;this._captureBuffer.length!==n&&(this._captureBuffer=new Uint8Array(n))},t.prototype.capture=function(e,t){var n=this.app.renderer.getSize(Ll);e=e||n.width,t=t||n.height,this._mainRenderer.setSize(e,t),this.app.renderCamera.setSize(e,t),this._resizeCaptureBuffer(e,t);var i=this.app.postEffect.postEffect.blur.enable;return this.app.postEffect={postEffect:{blur:{enable:!1}}},this._mainRenderer.render(this.app.renderer,this.app.scene,this.app.renderCamera,this._captureRenderTarget),this.app.renderer.readRenderTargetPixels(this._captureRenderTarget,0,0,this._captureRenderTarget.width,this._captureRenderTarget.height,this._captureBuffer),function e(t,n,i,r){if(Array.isArray(t)){for(var o=e(new Float64Array(t),n,i,r),a=0;a<t.length;a++)t[a]=o[a];return t}if(!n||!i)throw Error("Bad dimensions");r||(r=t.length/(n*i));for(var s=i>>1,l=n*r,u=new(0,t.constructor)(n*r),c=0;c<s;++c){var h=c*l,p=(i-c-1)*l;u.set(t.subarray(h,h+l)),t.copyWithin(h,p,p+l),t.set(u,p)}return t}(this._captureBuffer,this._captureRenderTarget.width,this._captureRenderTarget.height),this._mainRenderer.setSize(n.width,n.height),this.app.renderCamera.setSize(n.width,n.height),this.app.postEffect={postEffect:{blur:{enable:i}}},this._captureBuffer},t.prototype.captureToDataURL=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"jpeg",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=this.app.renderer.getSize(Ll);e=e||o.width,t=t||o.height;var a=this.capture(e,t),s=new Uint8ClampedArray(a.buffer),l=document.createElement("canvas"),u=l.getContext("2d");l.width=e,l.height=t;var c=u.createImageData(e,t);c.data.set(s),u.putImageData(c,0,0),"jpg"==n&&(n="jpeg");var h="image/"+(n.isBlank()?"jpeg":n),p=l.toDataURL(h,i);return r&&(p=p.replace(h,"image/octet-stream")),p},t.prototype.replaceRenderer=function(e){console.warn("[RendererManager] replaceRenderer has been DEPRECATED!"),this._mainRenderer=e,this._mainRenderer.setConfig(this.getCurrentControl()._config)},t.prototype.closePostEffect=function(){console.warn("[RendererManager] Please use app.postEffect={} instead"),this.app.renderEffects.mergeConfig({postEffect:{enable:!1}}).update()},o(t,[{key:"needUpdate",set:function(e){e&&this._mainRenderer.dirty()}},{key:"mainRenderer",get:function(){return this._mainRenderer}},{key:"renderOutline",set:function(e){console.warn("[RendererManager] renderOutline has been DEPRECATED!")}},{key:"temporalSuperSampling",set:function(e){console.warn("[RendererManager] Please use app.postEffect={} instead"),this.app.renderEffects.mergeConfig({temporalSuperSampling:{enable:e}}).update()},get:function(){return console.warn("[RendererManager] Please use app.postEffect instead"),this.app.renderEffects.getConfig().temporalSuperSampling.enable}},{key:"SSAO",set:function(e){console.warn("[RendererManager] Please use app.postEffect={} instead"),this.app.renderEffects.mergeConfig({postEffect:{screenSpaceAmbientOcclusion:{enable:e}}}).update()},get:function(){return console.warn("[RendererManager] Please use app.postEffect instead"),this.app.renderEffects.getConfig().postEffect.screenSpaceAmbientOcclusion.enable}},{key:"postEffectEnable",get:function(){return console.warn("[RendererManager] Please use app.postEffect instead"),this.app.renderEffects.getConfig().postEffect.enable}}]),t}(Bl),Nl=function(e){function t(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ol;return r(this,t),s(this,e.call(this,n,i))}return a(t,e),t}(Fl),Hl=function(){function e(t){r(this,e),this.app=t,this.xmlhttp=null,this.time=1500,this.simulate=!0,this.url="",this.cache=!0,this._stop=!1,this._curInterval=null,this.callback=null}return e.prototype.start=function(e){if(this._stop=!1,this.url=null,null!=e&&(null!=e.interval&&(this.time=e.interval),null!=e.url&&(this.url=e.url),null!=e.simulate&&(this.simulate=e.simulate),null!=e.cache&&(this.cache=e.cache),null!=e.callback&&(this.callback=e.callback)),null==this.url||1==this.simulate){var t=parent.getUserPath();if(!t)return void console.log("Service Data Path Error");this.url=t}this._ajax(),console.log("Service startup complete")},e.prototype.stop=function(){this._stop=!0,null!=this._curInterval&&window.clearTimeout(this._curInterval),console.log("Service stop complete")},e.prototype._ajax=function(){var e,t=this;function n(){4==t.xmlhttp.readyState&&(200==t.xmlhttp.status?(!function(e){var n=null;n=1==Array.isArray(e)?e[0]:e;for(var i in n){var r=t.app.query(i);if(r.length>0){var o=n[i];for(var a in o)r[0].attr(a,o[a])}}}(JSON.parse(t.xmlhttp.responseText)),null!=t.callback&&t.callback(t.xmlhttp.getResponseHeader("last-modified"))):console.log("Problem retrieving XML data:"+t.xmlhttp.statusText),0==t._stop&&(t._curInterval=window.setTimeout((function(){t._ajax()}),t.time)))}e=t.url,t.xmlhttp=null,window.XMLHttpRequest&&(t.xmlhttp=new XMLHttpRequest),null!=t.xmlhttp?(t.xmlhttp.onreadystatechange=n,0==t.cache&&(e=-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime()),t.xmlhttp.open("GET",e,!0),t.xmlhttp.send(null)):console.error("Your browser does not support XMLHTTP.")},e}(),zl=function(){function e(t){r(this,e),this.app=t,this.viewPointList=[],this.timeoutNumer=null,this._flyCallback=null,this._playIndex=0,this.playLoop=!1,this._pickedObjects=new Set}return e.prototype.start=function(){var e=this;this.app.on(O.Pick,(function(t){e._pickedObjects.add(t.object)}))},e.prototype.create=function(e,t){null==e&&(e={name:"新视点"}),null==e.flyTime?e.flyTime=1e3:"string"==typeof e.flyTime&&(e.flyTime=Number(e.flyTime)),null==e.waitTime?e.waitTime=0:"string"==typeof e.waitTime&&(e.waitTime=Number(e.waitTime));var n=this._take(e);null==t?this.viewPointList.push(n):this.viewPointList.splice(t,0,n)},e.prototype.delete=function(e){e>=0&&e<this.viewPointList.length&&this.viewPointList.splice(e,1)},e.prototype.recover=function(e){try{var t=this,n=this.viewPointList[e],i=null;null!=n.events&&(i=function(){for(var e=n.events,i=0;i<e.length;i++){var r=e[i],o=t.app.query("#"+r.id);if(o.length>0)for(var a=0;a<r.event.length;a++)o[0].dispatch(r.event[a])}}),0!=n.waitTime?(null!=t.timeoutNumer&&clearTimeout(t.timeoutNumer),this.timeoutNumer=setTimeout((function(){t._fly(n,i),t.timeoutNumer=null}),n.waitTime)):this._fly(n,i)}catch(e){console.log(e)}},e.prototype.update=function(e,t,n){if(null!=e){null==t&&(t={}),"string"==typeof t.flyTime&&(t.flyTime=Number(t.flyTime)),"string"==typeof t.waitTime&&(t.waitTime=Number(t.waitTime));var i={};return n?i=this._take(t,e):(i=this.viewPointList[e],null!=t.flyTime&&(i.flyTime=t.flyTime),null!=t.waitTime&&(i.waitTime=t.waitTime),null!=t.flyTime&&(i.name=t.name)),this.viewPointList[e]=i,i}},e.prototype.play=function(e){null!=e&&(this.playLoop=e),this._playIndex=0,this._flyCallback=null,this.viewPointList.length>0&&this._next()},e.prototype.pause=function(e){void 0===e&&(e=!0),e?(null!=this.timeoutNumer&&clearTimeout(this.timeoutNumer),this.app.camera.flying&&this.app.camera.stopFlying()):this.viewPointList.length>0&&this._next()},e.prototype.swap=function(e,t){var n=this.viewPointList[e][e];return this.viewPointList[e][e]=this.viewPointList[e][t],this.viewPointList[e][t]=n,this.viewPointList[e]},e.prototype.stop=function(){null!=this.timeoutNumer&&clearTimeout(this.timeoutNumer),this.app.camera.flying&&this.app.camera.stopFlying(),this._flyCallback=null,this._pickedObjects.clear()},e.prototype.saveJSON=function(){var e={name:"视点动画",pointList:this.viewPointList};return JSON.stringify(e)},e.prototype.loadJSON=function(e){var t=e;"string"==typeof e&&(t=JSON.parse(e)),null!=t.pointList&&(this.viewPointList=t.pointList)},e.prototype.clearAll=function(){stop(),this.viewPointList=[]},e.prototype._take=function(e,t){var n={};null!=t&&(n=this.viewPointList[t]),null!=e.flyTime&&(n.flyTime=e.flyTime),null!=e.waitTime&&(n.waitTime=e.waitTime),null!=e.name&&(n.name=e.name),n.position=this.app.camera.position,n.target=this.app.camera.target,n.up=this.app.camera.up,n.image=this.app.captureScreenshotToImage(140,118,"jpeg",.1);var i=this._getPickedEvents();return i.length>0&&(n.events=i),n},e.prototype._getPickedEvents=function(){for(var e=[],t=this._pickedObjects,n=0,i=t.length;n<i;n++){var r=t[n];if(r){var o={id:r.id,event:[]};r.hasEvent("click")&&o.event.push("click"),r.hasEvent("singleclick")&&o.event.push("singleclick"),0!=o.event.length&&e.push(o)}}return this._pickedObjects.clear(),e},e.prototype._fly=function(e,t){var n=this,i={position:e.position,target:e.target,time:e.flyTime,complete:function(e){null!=t&&t(),null!=n._flyCallback&&n._flyCallback()}};e.up&&(i.up=e.up),n.app.camera.flyTo(i)},e.prototype._next=function(){var e=this;if(this._playIndex>this.viewPointList.length-1){if(0==this.playLoop)return void(this._flyCallback=null);this.play()}this._flyCallback=function(){e._playIndex+=1,e._next()},this.recover(this._playIndex)},e}(),Ul=function(){function e(t){r(this,e),this.app=t,this._modelBaseURL="https://model.3dmomoda.cn/models/"}return e.prototype.initOptions=function(e){this.app.resourceManager.textureLoader},e.prototype.parseDoorOrWindow=function(e,t,n){var i=this;function r(e,t){var n=i.app.objectManager.create({type:"Door",id:t.id,name:t.name,node:t.delayObject,parent:e,animations:t.resource.animations,properties:t.properties});if(t.isOpen&&n.open(),n.animationClips)for(var r=0;r<n.animationClips.length;r++){var o=n.animationClips[r];if("_defaultAnim_"===o.name){n.playAnimation({name:o.name,loop:!0,speed:.15});break}}return n}t.mesh?r():t.initCompleteCallback=function(t){var n=r(e,t);e.miscNode.add(n.node)}},e.prototype.parseWall=function(e,t,n){for(var i=0;i<t.doorOrWindows.length;i++){var r=t.doorOrWindows[i];this.parseDoorOrWindow(e,r,n)}},e.prototype.parseGroups=function(e,t,n){for(var i=0;i<t.groups.length;i++){var r=t.groups[i],o="Thing";r.jsonData&&r.jsonData.type&&(o=r.jsonData.type);this.app.objectManager.create({id:r.id,name:r.name,node:r.delayObject,type:o,parent:e,properties:r.properties})}},e.prototype.parsePlacements=function(e,t,n){for(var i=0;i<t.placements.length;i++){var r=t.placements[i],o="Thing";if(r.jsonData&&r.jsonData.type&&(o=r.jsonData.type),r.mesh){var a=this.app.objectManager.create({id:r.id,type:o,name:r.name,node:r.delayObject,parent:e,url:r.resource.getModelUrl(),animations:r.resource.animations,properties:r.properties});if(a.bundleID=r.resource.modelID,a.bundleName=r.resource.modelName,r.isPlayAnim&&a.containAnimation(r.animClip)){var s={name:r.animClip,loop:!1,speed:.15};r.hasSkin&&(s.loop=!0),a.playAnimation(s)}}}},e.prototype.parseRooms=function(e,t,n){for(var i=0;i<t.rooms.length;i++){var r=t.rooms[i];this.app.objectManager.create({type:"Room",name:r.name,node:r.mesh,id:r.userID,ceilingNode:r.ceiling.mesh,roofNode:r.roof.mesh,floorNode:r.floor.mesh,parent:e,properties:r.properties})}},e.prototype.createCombinedObject=function(e,t,n){var i=new THREE.Object3D(t),r=this.app.create({type:"CombinedObject",visible:!0,node:i,parent:e});return r.node.visible=!1,r.userData.type=n,r},e.prototype.parsePlan=function(e,t,n){for(var i=this.createCombinedObject(e,"combineFloor","CombineFloorParent").node,r=0;r<t.combineFloors.length;r++){var o=t.combineFloors[r];i.add(o)}var a=this.createCombinedObject(e,"combineCeiling","CombineCeilingParent").node;for(r=0;r<t.combineCeilings.length;r++){var s=t.combineCeilings[r];a.add(s)}var l=this.createCombinedObject(e,"combineRoof","CombineRoofParent").node;for(r=0;r<t.combineRoofs.length;r++){var u=t.combineRoofs[r];l.add(u)}var c=this.createCombinedObject(e,"combinePlacement","CombineMiscParent").node;for(r=0;r<t.combinePlacements.length;r++){var h=t.combinePlacements[r];c.add(h)}for(var p=this.createCombinedObject(e,"combineWall","CombineWallParent").node,d=0;d<t.combineStraightManualWalls.length;d++){var f=t.combineStraightManualWalls[d];p.add(f)}for(d=0;d<t.combineModelWalls.length;d++){f=t.combineModelWalls[d];p.add(f)}for(d=0;d<t.combineDoorOrWins.length;d++){h=t.combineDoorOrWins[d];p.add(h)}},e.prototype.parseFloor=function(e,t,n){var i=t.buildings[0].floorplans[0];this.parsePlan(e,i,n),this.parseGroups(e,i,n),this.parsePlacements(e,i,n),this.parseRooms(e,i,n);for(var r=0;r<i.walls.length;r++){var o=i.walls[r];this.parseWall(e,o,n)}},e.prototype._generateWindow=function(e,t){var n=void 0!==e.typeId?e.typeId:"15DA293545E84A3680F93CF7D4227BD9";this.app.create({type:"Door",name:e.key,url:this._modelBaseURL+n+"/0/gltf/",localPosition:[.01*e.pos[0],3*e.suspendpercent,.01*e.pos[1]],parent:t,complete:function(){this.scale=[.01*e.width/this.boundingBox.initSize[0],.01*e.height/this.boundingBox.initSize[1],1],this.angles=[0,-e.rotation,0]}})},e.prototype._generateDoor=function(e,t){var n=void 0!==e.typeId?e.typeId:"d8ff0aaa4e87439bbededc8c6590491c";this.app.create({type:"Door",name:e.key,url:this._modelBaseURL+n+"/0/gltf/",localPosition:[.01*e.pos[0],0,.01*e.pos[1]],parent:t,complete:function(){this.scale=[.01*e.width/this.boundingBox.initSize[0],.01*e.height/this.boundingBox.initSize[1],1],this.angles=[0,-e.rotation,0]}})},e.prototype.parseDoorsAndWindows=function(e,t,n){var i=this;t.doors.forEach((function(t){t.suspendpercent?i._generateWindow(t,e):i._generateDoor(t,e)}))},e.prototype.load=function(e,t,n){t=this.app.confirmURL(t);var i=this;new THREE.FileLoader(this.app.loadingManager).load(t+"/scene.json",(function(t){var r=JSON.parse(t);i.loadFromData(e,r,n)}))},e.prototype.loadFromData=function(e,t,n){var i=this;n=n||{},this.initOptions(n);var r=function(e,t){var n={version:"2",unit:t=t||1,walls:[],rooms:[],doors:[],textures:[],models:[]},i=e.structure;return n.textures=e.textures,n.models=e.models,n.walls=i.walls.map((function(e){if(void 0===e.sourceType)return{weight:e.thickness,start:[100*e.points[0],100*e.points[1]],end:[100*e.points[2],100*e.points[3]],height:e.height,type:0,lefttexture:0,righttexture:0,edgetexture:1};var t={weight:e.thickness,start:[100*e.points[0],100*e.points[1]],end:[100*e.points[2],100*e.points[3]],height:e.height,type:e.sourceType,lefttexture:e.lefttexture,righttexture:e.righttexture,edgetexture:e.edgetexture};return!1===e.visible&&(t.isshow=!1),0!=e.sourceType&&(t.model=e.model),t})),n.rooms=i.rooms.map((function(e){var t=[100*e.textLoc[0],100*e.textLoc[1]],n={id:e.key,name:e.name,points:[],holes:[],center:t,floortexture:e.floorTexture,floorblocksize:e.floorBlockSize,floorheight:e.floorHeight,rooftexture:e.roofTexture,roofblocksize:e.roofBlockSize,roofheight:e.roofHeight,ceilingtexture:e.ceilingTexture,ceilingblocksize:e.ceilingBlockSize,ceilingheight:e.ceilingHeight};return void 0!==e.userId&&(n.userid=e.userId),!1===e.floorVisible&&(n.isshowfloor=!1),!1===e.ceilingVisible&&(n.isshowceiling=!1),void 0===e.roofVisible&&(n.isshowroof=!1),e.polygons.forEach((function(e,t){for(var i=0===t?n.points:[],r=0;r<e.length/2;r++)i.push([100*e[2*r+0],100*e[2*r+1]]);0!==t&&n.holes.push(i)})),n})),i.doors.forEach((function(e){var t=i.walls[e.wallIndex];e.loc;var r=[t.points[0],t.points[1]],o=[t.points[2],t.points[3]],a=[100*(r[0]+(o[0]-r[0])*e.loc),100*(r[1]+(o[1]-r[1])*e.loc)],s=n.models[e.typeIndex],l={key:e.key,typeId:s.id,width:100*e.size[0],height:100*e.size[2],pos:a,rotation:ql(t)};n.doors.push(l)})),i.windows.forEach((function(e){var t=i.walls[e.wallIndex],r=[t.points[0],t.points[1]],o=[t.points[2],t.points[3]],a=[100*(r[0]+(o[0]-r[0])*e.loc),100*(r[1]+(o[1]-r[1])*e.loc)],s=n.models[e.typeIndex],l={key:e.key,typeId:s.id,width:100*e.size[0],height:100*e.size[2],suspendpercent:.4,pos:a,rotation:ql(t)};n.doors.push(l)})),n}(t,1),o=n.complete,a=n.startLoadResource;json2mesh.DefaultSetting.enableFloorLightMap=Ne.parseValue(n.enableFloorLightMap,!1);var s=this._createLoader(r.version),l=void 0;s.load({json:r}).then((function(e){l=e,a&&a(s.resourceManager.models,s.resourceManager.textures)})).then((function(){return s.loadResources()})).then((function(){i.parseFloor(e,l,n),i.parseDoorsAndWindows(e,r,n)})).then((function(){o&&o(e)})).catch((function(e){return console.warn(e)}))},e.prototype._createLoader=function(e){if(e&&new Nt(e).major>=2)return new json2mesh.ThingjsEditorSceneLoader_2_0(this.app.options);return new json2mesh.ThingjsEditorSceneLoader},e}(),Vl=new THREE.Vector2;function ql(e){return Vl.set(e.points[0]-e.points[2],e.points[1]-e.points[3]),Vl.angle()/Math.PI*180}var Gl=function(){function e(t){r(this,e),this.app=t,this._loading=!1,this._updateTime=0,this._loadingFloors=[],this._initEvents()}return e.prototype._initEvents=function(){var e=this;this.app.on("levelchange",(function(t){var n=t.current;if(n instanceof ma){e._loadingFloors.sort((function(e,t){return e.owner.parent!=n?1:t.owner.parent!=n?-1:e.owner.indexOfBuilding-t.owner.indexOfBuilding}))}else if(n instanceof Br){e._loadingFloors.sort((function(e,t){return e.owner==n?-1:t.owner==n?1:e.owner.node.id-t.owner.node.id}))}}))},e.prototype.update=function(){if(this._loadingFloors.length&&!(this._loading||(this._updateTime+=this.app._deltaTime,this._updateTime<.25))){this._updateTime=0;var e=this._loadingFloors[0],t=e.owner,n=e.url,i=e.jsonData,r=e.options,o=this,a=r.complete;r.complete=function(e){a&&a(e),o._loading=!1},this._loading=!0;var s=new Ul(this.app);n?s.load(t,n,r):s.loadFromData(t,i,r),this._loadingFloors.splice(0,1)}},e.prototype.load=function(e,t,n){this._loadingFloors.push({owner:e,url:t,options:n})},e.prototype.loadFromData=function(e,t,n){this._loadingFloors.push({owner:e,jsonData:t,options:n})},e.prototype.onUpdate=function(e){this.update(e)},e}(),Wl=function(e){THREE.ShaderMaterial.call(this,{uniforms:{baseId:{type:"f",value:0},size:{type:"f",value:.01},scale:{type:"f",value:400}},vertexShader:e?"\n\t#include <common>\n\t#include <logdepthbuf_pars_vertex>\n\t#include <skinning_pars_vertex>\n\t\n\tuniform float size;\n\tuniform float scale;\n\tuniform float baseId;\n\t\n\tvarying vec4 worldId;\n\n\t#ifdef USE_CARTESIAN3\n\t\tvec3 czm_converPosition(vec3 origin) {\n\t\t\tvec3 res = vec3(0.0);\n\t\t\tres.x = -origin.x;\n\t\t\tres.y = origin.z;\n\t\t\tres.z = origin.y;\n\t\t\treturn res;\n\t\t}\n\t#endif\n\n\t#ifdef INSTANCED\n\t\tattribute float instanceId;\n\t#endif\n\t\n\t#ifdef USE_ID_ATTRIBUTES\n\t\tattribute float id;\n\t#endif\n\n\tvoid main() {\n\t\t#include <skinbase_vertex>\n\t\t#include <begin_vertex>\n\t\t#ifdef USE_CARTESIAN3\n\t\t\ttransformed = czm_converPosition(transformed);\n\t\t#endif\n\t\t// position instanced\n\t\t#ifdef INSTANCED\n\t\t\tmat4 instanceMat = compose(instancePosition, instanceQuaternion, instanceScale);\n\t\t\ttransformed.xyz = (instanceMat * vec4(transformed, 1.0)).xyz;\n\t\t#endif\n\t\t#include <skinning_vertex>\n\t\t#include <project_vertex>\n\t\t#include <logdepthbuf_vertex>\n\t\t#ifdef USE_ID_ATTRIBUTES\n\t\t\tfloat pickId = id;\n\t\t#else\n\t\t\t#ifdef INSTANCED\n\t\t\t\tfloat pickId = instanceId;\n\t\t\t#else\n\t\t\t\tfloat pickId = baseId;\n\t\t\t#endif\n\t\t#endif\n\n\t\tvec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * pickId);\n\t\ta -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);\n\t\tworldId = vec4(a,1);\n\t}\n":"\n\t#include <common>\n\t#include <logdepthbuf_pars_vertex>\n\n\tuniform float size;\n\tuniform float scale;\n\tuniform float baseId;\n\n\tvarying vec4 worldId;\n\n\t#ifdef USE_CARTESIAN3\n\t\tvec3 czm_converPosition(vec3 origin) {\n\t\t\tvec3 res = vec3(0.0);\n\t\t\tres.x = -origin.x;\n\t\t\tres.y = origin.z;\n\t\t\tres.z = origin.y;\n\t\t\treturn res;\n\t\t}\n\t#endif\n\n\t#ifdef INSTANCED\n\t\tattribute float instanceId;\n\t#endif\n\t\n\t#ifdef USE_ID_ATTRIBUTES\n\t\tattribute float id;\n\t#endif\n\n\tvoid main() {\n\t\t#ifdef USE_ID_ATTRIBUTES\n\t\t\tfloat pickId = id;\n\t\t#else\n\t\t\t#ifdef INSTANCED\n\t\t\t\tfloat pickId = instanceId;\n\t\t\t#else\n\t\t\t\tfloat pickId = baseId;\n\t\t\t#endif\n\t\t#endif\n\t\t\n\t\tvec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * pickId);\n\t  \ta -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);\n\t\tworldId = vec4(a,1);\n\t\tvec3 transformed = position;\n\t\t#ifdef USE_CARTESIAN3\n\t\t\ttransformed = czm_converPosition(transformed);\n\t\t#endif\n\t\t#ifdef INSTANCED\n\t\t\tmat4 instanceMat = compose(instancePosition, instanceQuaternion, instanceScale);\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * instanceMat * vec4( transformed, 1.0 );\n\t\t#else\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( transformed, 1.0 );\n\t\t#endif\n\n\t\t#include <logdepthbuf_vertex>\n\t}\n",fragmentShader:"\n\t#include <logdepthbuf_pars_fragment>\n\t#ifdef GL_ES\n\t\tprecision highp float;\n\t#endif\n\tvarying vec4 worldId;\n\tvoid main() {\n\t\t#include <logdepthbuf_fragment>\n\t\tgl_FragColor = worldId;\n\t}\n"})};(Wl.prototype=Object.create(THREE.ShaderMaterial.prototype)).constructor=Wl,Wl.prototype.setBaseID=function(e){this.uniforms.baseId.value=e},Wl.prototype.setPointSize=function(e){this.uniforms.size.value=e},Wl.prototype.setPointScale=function(e){this.uniforms.scale.value=e};var Xl=new THREE.Vector2,Jl=new THREE.Vector3;Jl.isFailed=!0;var Yl,Ql=function(){function e(t,n){r(this,e),n=n||{},this.app=t,this.renderer=t.renderer,this.scene=t.scene,this._needUpdate=!0,this._updateTime=0,this._updateIntervalTime=.25,this._pickHooker=null,this.debugScene=null,this.sprite=null,this.camera2D=null,this.pickingTexture=new THREE.WebGLRenderTarget,this.pickingTexture.texture.minFilter=THREE.LinearFilter,this.pickingTexture.texture.generateMipmaps=!1,this.pickNodes=new Map,this.pickMaterials=new Map,this.lineShell=Ne.parseValue(n.lineShell,10),this.pointShell=Ne.parseValue(n.pointShell,.1),this.debug=Ne.parseValue(n.debug,!1),this.init();var i=this;this.app.renderer.materialManager.addStrategy("gpuPicker",(function(e,t,n,r,o,a){var s=this.id;if(this.geometry._hasDisposed)return null;if(this.userData.skipPick)return null;if(!o.visible||!o.opacity)return null;if("BackgroundCubeMaterial"==o.name||"BackgroundMaterial"==o.name)return null;if(this.isSky)return null;i.pickNodes.has(s)||i.pickNodes.set(s,this);var l=i.pickMaterials.get(s);return l||(l=i.createPickingMaterial(this,o))&&i.pickMaterials.set(s,l),l}))}return e.prototype.init=function(){var e=this.renderer.getSize(Xl);this.resizeTexture(e.width,e.height)},e.prototype.resizeTexture=function(e,t){this.pickingTexture.setSize(e,t),this.pixelBuffer=new Uint8Array(4*e*t),this.sprite&&this.sprite.scale.set(2*e,2*t,1),this.camera2D&&(this.camera2D.left=-e/2,this.camera2D.right=e/2,this.camera2D.top=t/2,this.camera2D.bottom=-t/2,this.camera2D.updateProjectionMatrix()),this._needUpdate=!0},e.prototype._needUpdatePickingTexture=function(e){return this._updateTime+=e,!(this._updateTime<this._updateIntervalTime)&&(this._updateTime=0,!!this._needUpdate&&(this._needUpdate=!1,!0))},e.prototype.update=function(e){this._needUpdatePickingTexture(e)&&this.updatePickingTexture()},e.prototype.markPickingNode=function(e){this.pickNodes.set(e.id,e)},e.prototype.removePickingResources=function(e){var t=this;if(e.isObject3D)e.traverse((function(e){return t.removePickingResources(e.id)}));else{var n=this.pickMaterials.get(e);n&&(Array.isArray(n)?n.forEach((function(e){return e.dispose()})):n.dispose(),this.pickMaterials.delete(e)),this.pickNodes.has(e)&&this.pickNodes.delete(e),this.forceUpdate=!0}},e.prototype._createPickingMaterial=function(e,t){var n=e.userData,i=t.size||.01,r=t.linewidth||1,o=function(e){for(var t=e;t;){if(t.userData.withGeometryIDAttributes)return!0;t=t.parent}return!1};if(t.isSpriteMaterial)t.map&&t.map.image&&((s=t.clone()).alphaTest=.1,s.blending=THREE.NoBlending,s.lights=!1,s.fog=!1,s.opacity=1,s.visible=!(!t.visible||n.skipPick),s.baseId=e.id,s.defines=s.defines||{},s.defines.USE_GPUPICKER="");else if(n.noBlending||t.isShaderMaterial&&t.vertexShader.indexOf("USE_GPUPICKER")>-1){(s=t.clone()).alphaTest=.1,s.blending=THREE.NoBlending,s.lights=!1,s.fog=!1,s.visible=!(!t.visible||n.skipPick),s.baseId=e.id,s.defines=s.defines||{},s.defines.USE_GPUPICKER="";var a=s.uniforms;a&&a.lineWidth&&(a.lineWidth.value+=this.lineShell),o(e)&&(s.defines.USE_ID_ATTRIBUTES="")}else{var s;if(o(e))(s=new Wl(t.skinning)).map=null,s.color=new THREE.Color,s.uniforms.config={value:{x:0,y:0}},s.linewidth=r+this.lineShell,s.depthTest=t.depthTest,s.depthWrite=Ne.parseValue(t.depthWrite,t._pickable),s.colorWrite=t.colorWrite,s.transparent=t.transparent,s.opacity=1,s.side=t.side,s.skinning=t.skinning,s.visible=!(!t.visible||n.skipPick),s.polygonOffset=t.polygonOffset,s.polygonOffsetFactor=t.polygonOffsetFactor,s.polygonOffsetUnits=t.polygonOffsetUnits,s.baseId=e.id,t.defines&&void 0!==t.defines.INSTANCED&&!1!==t.defines.INSTANCED&&(s.defines.INSTANCED=""),n.USE_CARTESIAN3&&(s.defines.USE_CARTESIAN3=""),s.defines.USE_ID_ATTRIBUTES="",s.setPointSize(i+this.pointShell),s.setPointScale(this.renderer.getSize(Xl).height*this.renderer.getPixelRatio()/2);else(s=new Wl(t.skinning)).map=null,s.color=new THREE.Color,s.uniforms.config={value:{x:0,y:0}},s.linewidth=r+this.lineShell,s.depthTest=t.depthTest,s.depthWrite=Ne.parseValue(t.depthWrite,t._pickable),s.colorWrite=!!n.skipPickColorWrite||t.colorWrite,s.transparent=t.transparent,s.opacity=1,s.side=t.side,s.skinning=t.skinning,s.visible=!(!t.visible||n.skipPick),s.polygonOffset=t.polygonOffset,s.polygonOffsetFactor=t.polygonOffsetFactor,s.polygonOffsetUnits=t.polygonOffsetUnits,s.baseId=e.id,t.defines&&void 0!==t.defines.INSTANCED&&!1!==t.defines.INSTANCED&&(s.defines.INSTANCED=""),n.USE_CARTESIAN3&&(s.defines.USE_CARTESIAN3=""),s.setPointSize(i+this.pointShell),s.setPointScale(this.renderer.getSize(Xl).height*this.renderer.getPixelRatio()/2)}return s},e.prototype.createPickingMaterial=function(e,t){if(t.length){for(var n=[],i=0;i<t.length;i++)n.push(this._createPickingMaterial(e,t[i]));return n}return this._createPickingMaterial(e,t)},e.prototype.updatePickingTexture=function(){var e=this.app.renderer.materialManager,t=e.getMode();e.setMode("gpuPicker");var n=this.scene,i=n.autoUpdate;n.autoUpdate=!1;var r=this.renderer.shadowMap.enable;this.renderer.initRenderList=!1,this.renderer.setRenderTarget(this.pickingTexture),this.renderer.clear(),this.renderer.render(n,this.app.renderCamera),this.renderer.render(this.app.mainUI.scene2D,this.app.mainUI.camera2D),n.autoUpdate=i,this.renderer.shadowMap.enable=r,this.renderer.initRenderList=!0,this.renderer.readRenderTargetPixels(this.pickingTexture,0,0,this.pickingTexture.width,this.pickingTexture.height,this.pixelBuffer),e.setMode(t)},e.prototype.pick=function(e,t,n,i){var r=this.pickingTexture.width,o=this.pickingTexture.height;if(t=Math.round(t),n=Math.round(n),t<0||t>=r)return null;if(n<0||n>=o)return null;var a=t+(o-n-1)*r,s=255*this.pixelBuffer[4*a+2]*255+255*this.pixelBuffer[4*a+1]+this.pixelBuffer[4*a+0];if(isNaN(s))return null;var l=this.pickNodes.get(s);if(!l){var u=this.app.picker.onPickNodeID;u&&(l=u(s))}if(!l)return null;var c=i.clone();c._camera=i._camera||i.camera,c.camera=i.camera||i._camera;var h=this,p={x:t,y:n,id:s,pickedNode:l,node:l,object:l,raycaster:c,getPickedPosition:function(e){e=e||{};var t=this.pickedNode,n=h._pickHooker;if(n){var i=n(this.raycaster,t);if(i){if(Ne.isArray(i))return Ne.parseVector3(i);if(i.isVector3)return i}}var r=this.raycaster.intersectObject(t,!1);if(r.length)return r[0].point;var o=function(e,t){if(!t)return null;for(var n=e.intersectObject(t,!0),i=0;i<n.length;i++){var r=n[i];if(!r.object.userData.skipPick)return r.point}return null},a=o(this.raycaster,t.parent);if(a)return a;if(!e.skipOtherPick){if(!e.skipParentPick&&t.parent&&(a=o(this.raycaster,t.parent)))return a;if(!e.skipObjectPick){var s=h.app.objectManager.getBaseObject(t);if(s&&(a=o(this.raycaster,s.node)))return a}if(!e.skipScenePick&&(a=o(this.raycaster,h.app.scene)))return a}return Jl}};return Object.defineProperties(p,{pickedPosition:{get:function(){if(void 0===p._pickedPosition){var e=p.getPickedPosition();e?(p._pickedPosition=e.toArray(),e.isFailed&&(p._pickedPosition.isFailed=!0)):p._pickedPosition=null}return p._pickedPosition}},distance:{get:function(){if(void 0===p._distance){var t=p.pickedPosition;if(t){var n=new THREE.Vector3(t[0],t[1],t[2]);p._distance=n.distanceTo(e.position)}else{var i=new THREE.Vector3;l.getWorldPosition(i);var r=new THREE.Vector3;e.getWorldPosition(r),p._distance=r.distanceTo(i)}}return p._distance}}}),p},e.prototype.show=function(e){if(e||void 0===e){if(!this.sprite){var t=new THREE.SpriteMaterial({map:this.pickingTexture.texture});this.sprite=new THREE.Sprite(t),this.sprite.scale.set(this.pickingTexture.width,this.pickingTexture.height,1),this.sprite.position.set(0,0,-10),this.debugScene=new THREE.Scene,this.debugScene.add(this.sprite);var n=this.renderer.getSize(Xl);this.camera2D=new THREE.OrthographicCamera(-n.width/2,n.width/2,n.height/2,-n.height/2,.1,100)}}else this.debugScene&&this.sprite&&(this.debugScene.remove(this.sprite),this.sprite=null,this.debugScene=null,this.camera2D=null)},e.prototype.render=function(e){this.debugScene&&(e.setRenderTarget(null),e.clear(),e.render(this.debugScene,this.camera2D))},o(e,[{key:"updateIntervalTime",set:function(e){this._updateIntervalTime=e},get:function(){return this._updateIntervalTime}},{key:"forceUpdate",set:function(e){e&&(this._needUpdate=!0,this._updateTime=.25)}},{key:"needUpdate",set:function(e){this._needUpdate=e}}]),e}(),Zl=function(){function e(t){r(this,e),this.app=t;var n=new THREE.PlaneGeometry(1e4,1e4,1,1),i=new THREE.MeshStandardMaterial({color:2200782,side:THREE.DoubleSide,transparent:!0,opacity:.25});this._vertGround=new THREE.Mesh(n,i),this._vertGround.visible=!1,this._vertGround.setAngles([90,0,0]),this._vertGround.updateMatrixWorld();var o=new THREE.PlaneGeometry(1e4,1e4,1,1),a=new THREE.MeshStandardMaterial({color:13538337,side:THREE.DoubleSide,transparent:!0,opacity:.25});this._horzGround=new THREE.Mesh(o,a),this._horzGround.visible=!1,this._horzGround.setAngles([90,0,0]),this._horzGround.updateMatrixWorld(),this.pickingScene=new THREE.Scene,this.pickingScene.add(this._vertGround),this.pickingScene.add(this._horzGround)}return e.prototype.destroy=function(){this.app.resourceManager.remove(this.pickingScene)},e.prototype.update=function(e,t){this._vertGround.lookAt(Ne.parseVector3(e)),this._vertGround.position.copy(Ne.parseVector3(t)),this._vertGround.updateMatrixWorld()},e.prototype.isMeshOf=function(e){return this._vertGround==e||this._horzGround==e},e.prototype.intersect=function(e,t){var n=this.app.calcRect(),i=this.app.renderCamera.getRaycaster(e,t,n);return this.intersectByRaycaster(i)},e.prototype.intersectByRaycaster=function(e){var t=e.intersectObjectForcible(this._horzGround),n=e.intersectObjectForcible(this._vertGround);return t.length&&n.length?t[0].distance<n[0].distance?t[0]:n[0]:t.length?t[0]:n.length?n[0]:null},o(e,[{key:"visible",set:function(e){e?this.app.scene.add(this.pickingScene):this.app.scene.remove(this.pickingScene),this._vertGround.visible=e,this._horzGround.visible=e}}]),e}(),Kl=function(){function e(t){r(this,e),this.app=t,this.picker=t.picker,this.pickDownPosition=[0,0],this._mouseMoveInterval=null,e.instance=this}return e.prototype.processPicking=function(e){this.picker.processPicking(e)},e.prototype.processAreaPicking=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.picker,i=n.pickingArea,r=new gt(this.app);t?r.buildReturnObject(i.processPicking(n.areaCandidates)):(this.processPicking(e),n.areaCandidates.has(e.object)?r.buildReturnObject([e.object]):r.buildReturnObject([])),this.picker.setPickedObject(r),this.app.trigger(O.AreaPicking,{objects:r})},e.prototype.startPicking=function(e){var t=this.picker;t.forceUpdate=!0,t._enable(!0,"startPicking",1e4),e.ignoreFrameCheck=!0},e.prototype.endPicking=function(){this.picker._enable(!1,"startPicking",0)},e.prototype.processClickEvents=function(e){this.startPicking(e),this.processPicking(e),this.endPicking()},e.prototype.tryToDrag=function(e){var t=this.picker.processPicking(e);if(null==t)return null;var n=t.object;return n?n.draggable?t:(e.object=null,null):null},e.prototype.onEnter=function(e){},e.prototype.onUpdate=function(e){var t=this.picker;if(!t.areaPicking){var n=t.pickingArea;n.started&&n.end()}t.update(this.app._deltaTime),this._mouseMoveInterval&&(this._mouseMoveInterval.deltaTime+=this.app._deltaTime)},e.prototype.onMouseMove=function(e){if(this._mouseMoveInterval){if(this._mouseMoveInterval.deltaTime-this._mouseMoveInterval.curTime<this._mouseMoveInterval.interval)return;this._mouseMoveInterval.curTime=this._mouseMoveInterval.deltaTime}var t=this.picker;if(t.areaPicking){var n=t.pickingArea;n.started&&(n.move(e.clientX,e.clientY),n.realTimePicking&&(e.areaPicking=!0,this.processAreaPicking(e)))}else this.processPicking(e),!1===this.picker.setPickedObject(e.object,null,e.ignoreFilter)&&(e.hadFiltered=!0)},e.prototype.onMouseUp=function(e){var t=this.picker;if(this.startPicking(e),t.areaPicking){if(0==e.button){var n=THING.Math.getDistance(this.pickDownPosition,[e.x,e.y])>4;e.finishedAreaPicking=!0,this.processAreaPicking(e,n),t.pickingArea.end()}}else e.ignoreFrameCheck=!0,t.processPicking(e);this.endPicking()},e.prototype.onMouseDown=function(e){var t=this.picker;t.forceUpdate=!0,this.pickDownPosition=[e.clientX,e.clientY],t.areaPicking?0==e.button&&t.pickingArea.start(e.clientX,e.clientY):(e.ignoreFrameCheck=!0,t.processPicking(e))},e.prototype.onDoubleClick=function(e){this.processClickEvents(e)},e.prototype.onSingleClick=function(e){this.processClickEvents(e)},e.prototype.onClick=function(e){this.processClickEvents(e)},e.prototype.onDragStart=function(e){this.startPicking(e);var t=this.tryToDrag(e);if(t){var n=t.object,i=this.picker;n._dragState=A.Dragging,n.internalUserData.prevPickable=n.pickable,n.pickable=!1,e.ignoreFrameCheck=!0,e.forceUpdateTexture=!0;var r=i.processPicking(e);i.dragIntersect=r||t,i.dragIntersect.dragObject=n,e.dragObject=n,delete e.ignoreFrameCheck,delete e.forceUpdateTexture,this.app.camera.disable({rotate:!0})}else this.endPicking()},e.prototype.onDrag=function(e){var t=this.picker;null!=t.dragIntersect&&(e.disableGPUPicker=!0,t.processPicking(e),delete e.disableGPUPicker,this.app.needUpdate=!0)},e.prototype.onDragEnd=function(e){var t=this.picker;if(t.forceUpdate=!0,null!=t.dragIntersect){e.disableGPUPicker=!0,t.processPicking(e),delete e.disableGPUPicker;var n=t.dragIntersect.dragObject;n&&(n._dragState=A.DragEnd);var i=n.internalUserData.prevPickable;i&&(n.pickable=i),delete n.internalUserData.prevPickable,e.object=n,t.dragIntersect=null,this.app.camera.resume({rotate:!0}),this.endPicking()}},o(e,[{key:"mouseMoveInterval",set:function(e){this._mouseMoveInterval=e,this._mouseMoveInterval&&(this._mouseMoveInterval={interval:e,curTime:this.app._deltaTime,deltaTime:this.app._deltaTime})},get:function(){return this._mouseMoveInterval}}]),e}();var $l=function(){function e(t){r(this,e),this.app=t;var n=this.app.calcRect();this.resize(n.width,n.height),Yl=this}return e.prototype.updateProgress=function(e){return this.loadingProgressBar.updateProgress(e)},e.prototype.updateDownloadingProgress=function(e){},e.prototype.updateLoadingProcess=function(e){e=e||{},Ne.isNumber(e)&&(e={object:this.app.root.campuses[0],progress:e});var t=e.object||e.campus,n=e.progress;this.updateProgress(n)&&this.app.events.dispatchEvent({type:"progress",object:t,progress:n})},e.prototype._createLSM=function(e,t,n){var i=document.createElement("canvas");i.width=512,i.height=512;var r=i.getContext("2d");r.font="24px Verdana",r.fillStyle="white",r.textAlign="center",r.textBaseline="middle";var o=[0,0,0],a=THING.Math.degToRad(30);r.shadowColor="rgba("+255*o[0]+","+255*o[1]+","+255*o[2]+",1)",r.shadowBlur=1,r.shadowOffsetX=2*Math.cos(a),r.shadowOffsetY=2*Math.sin(a),function(e,t,n,i,r){for(var o=t.split("\n"),a=0;a<o.length;a++){var s=o[a];e.fillText(s,n,i),i+=r}}(r,e,256,256,40);var s=new THREE.Texture(i);return s.needsUpdate=!0,new THREE.SpriteMaterial({opacity:t,color:16777215,transparent:!0,depthWrite:!1,map:s,rotation:THING.Math.degToRad(n)})},e.prototype._createLS=function(e,t,n){for(var i=this.app.calcRect(),r=2*i.width,o=2*i.height,a=[],s=-o;s<o;s+=n)for(var l=-r;l<r;l+=t){var u=new THREE.Sprite(e);u.userData.skipPick=!0,u.scale.set(512,512,1),u.position.set(l,s,-10),a.push(u)}return a},e.prototype._setupSprite=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:480,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:320;this.logoSpriteRootNode&&this.app.resourceManager.remove(this.logoSpriteRootNode),console.log(e);var i=this._createLSM(e,.04,30),r=this._createLS(i,t,n);this.logoSpriteRootNode=new THREE.Group;for(var o=0;o<r.length;o++)this.logoSpriteRootNode.add(r[o]);this.scene2D.add(this.logoSpriteRootNode)},e.prototype._setup=function(){for(var e=c.update(this.app.appKey),t=[12,164,143,166,114,16,17,182,16,94,29,114,216,195,208,81,35,181,52,132,113,112,175,32,228,201,230,97,106,44,100,73,110,54,247,25],n=0;n<e.length;n++)if(e[n]!=t[n]){this._setupL();break}this.overlayRootNode=new THREE.Group,this.scene2D.add(this.overlayRootNode)},e.prototype._setupL=function(){if((new b).eb()){if([32].toString()!=[32].toString()){var e=function(e){e=e||window;var t=c,n=t.toStr([76,243,170,237,85,62]),i=t.toStr([83,249,168,254,66,63,61,235]),r=t.toStr([79,247,191,247,88,55,63,224]);r=t.update(e[i][r]);var o=t.toStr([80,230,174,241]),a=t.toStr([87,226,191,239,12,121,125,242,74,24,10,48,244,135,138,115,8,255,55,165,90,89,198]),s=t.update(e[i][n]),l=[107,254,162,241,81,28,1,165,95,22,4,49,245,128,138,123,20,237],u=[0,248,170,242,83,107,125];0==s.toString().indexOf(u.toString())&&(l=[107,254,162,241,81,28,1,165,95,22,4,49,245,128,138,123,20,237,19,238,115,70,140,104,130,136,181,43,46,118,51,30,119]);var h=[0,0];return 1==Ne.r(0,1)&&(0==Ne.r(0,1)?h[1]=Ne.r(10,230):h[0]=Ne.r(50,400)),{b1:o,c1:a,d1:h,e1:n,pp1:r,gg1:[[16,230,228]],f1:u,gs:[[0,248,170,242,83,107,125,240,77,3,75,37,248,157,203,100,3,239,114,167,82,81],[0,248,170,242,83,107,125,245,18],[0,251,246,176,70,121]],h1:s,t1:t.toStr(l)}}(this.l);if(e){var t=e.gs;if(t)for(var n=e.h1.toString(),i=0;i<t.length;i++)if(0==n.indexOf(t[i].toString()))return;if(t=e.gg1)for(n=e.pp1.toString(),i=0;i<t.length;i++)if(0==n.indexOf(t[i].toString()))return;var r=e.t1;this._setupSprite(r)}}}},e.prototype.onResize=function(e,t){this.resize(e,t);var n=n||c.toStr([96,201,148,250,88,55,48,233,88,48,80,33,228,154,187,127,7,245,70,163,91,87,134,105,199,140,143,6,2]);if(THING[n]){var i=c.toStr([96,226,174,231,66,29,55,252,120,1,71,43,248,139,150]);THING[i]=c,delete THING[n]}},e.prototype.onUpdate=function(){var e=ue();!0===e?this.checkAuthRet=!0:!1===e&&(this.checkAuthRet=!1),this.render()},e.prototype.resize=function(e,t){this.scene2D=this.scene2D||new THREE.Scene,this.camera2D=this.camera2D||new THREE.OrthographicCamera(-e/2,e/2,t/2,-t/2,.1,100),this.camera2D.left=-e/2,this.camera2D.right=e/2,this.camera2D.top=t/2,this.camera2D.bottom=-t/2,this.camera2D.updateProjectionMatrix(),this.loadingProgress&&this.loadingProgress.resize(e,t)},e.prototype.render=function(e){e=e||this.app.renderer;var t=se().l;if(void 0!==t&&!this._c){this._c=!0;var n=se().t;t||(n=""),this._setupSprite(n)}this.logoSpriteRootNode&&(this.logoSpriteRootNode.parent!=this.scene2D&&this.scene2D.add(this.logoSpriteRootNode),this.logoSpriteRootNode.visible=!0,this.logoSpriteRootNode.traverse((function(e){e.visible=!0})),this.scene2D.visible=!0),e.setRenderTarget(null),e.clear(!1,!0,!1);var i=this.app.renderer.autoClear;e.autoClear=!1,e.render(this.scene2D,this.camera2D),e.autoClear=i},e.prototype.getRenderPosition=function(e,t,n){var i=(n=n||[this.app.domElement.offsetWidth,this.app.domElement.offsetHeight])[0]/2,r=n[1]/2,o=[e[0]*i,e[1]*r],a=[t[0]/2,t[1]/2];return o[0]=THING.Math.clamp(o[0],-i+a[0],i-a[0]),o[1]=THING.Math.clamp(o[1],-r+a[1],r-a[1]),[o[0],-o[1]]},e.prototype.screenToWorld=function(e,t){var n=this.app.calcRect(),i=t[0],r=t[1];return[e[0]+i/2-n.width/2,-e[1]-r/2+n.height/2]},o(e,[{key:"loadingProgressBar",get:function(){return this.loadingProgress=this.loadingProgress||this.app.create({type:"ProgressBar",height:6,scene:this.scene2D,onTop:!1,parent:null}),this.loadingProgress}}]),e}(),eu=function(){function e(t){r(this,e),this.app=t,this.sprite=null,this.spriteLineNode=null,this.started=!1,this.startX=0,this.startY=0,this.distanceX=0,this.distanceY=0,this.region=[],this._areaPickType=P.Auto,this._realTimePicking=!1,this.depth=-10}return e.prototype.initLines=function(){if(!this.spriteLineNode){var e=new THREE.Geometry;e.vertices=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];var t=new THREE.LineBasicMaterial({color:16777215,opacity:.8,linewidth:1,transparent:!0});this.spriteLineNode=new THREE.Line(e,t),this.spriteLineNode.visible=!1,this.spriteLineNode.computeLineDistances(),this.app.mainUI.scene2D.add(this.spriteLineNode)}},e.prototype.initSprite=function(){if(!this.sprite){var e=new THREE.SpriteMaterial({opacity:.4,color:32768,transparent:!0});this.sprite=new THREE.Sprite(e),this.sprite.visible=!1,this.app.mainUI.scene2D.add(this.sprite)}},e.prototype.setSpritePosition=function(e,t){var n=this.app.calcRect(),i=e-n.width/2,r=t-n.height/2;this.sprite.position.set(i,-r,this.depth)},e.prototype.setSpriteLinePosition=function(e,t,n,i){var r=this.spriteLineNode.geometry,o=r.vertices,a=n/2,s=i/2,l=new THREE.Vector3(e-a,t-s,this.depth),u=new THREE.Vector3(e+a,t-s,this.depth),c=new THREE.Vector3(e+a,t+s,this.depth),h=new THREE.Vector3(e-a,t+s,this.depth);o[0].copy(l),o[1].copy(u),o[2].copy(c),o[3].copy(h),o[4].copy(l),r.verticesNeedUpdate=!0},e.prototype.updateRegion=function(){var e=this.startX,t=this.startX+this.distanceX,n=this.startY,i=this.startY+this.distanceY,r=!1;if(e>t){var o=e;e=t,t=o,r=!0}if(n>i){var a=n;n=i,i=a,r=!0}switch(this._areaPickType){case P.Auto:this._realTimePicking=!r;break;case P.RealTime:this._realTimePicking=!0;break;case P.NotRealTime:this._realTimePicking=!1}this.region=[e,n,t,i]},e.prototype.start=function(e,t){this.initSprite(),this.initLines(),this.started=!0,this.distanceX=1,this.distanceY=1,this.startX=e,this.startY=t,this.setSpritePosition(e,t),this.sprite.scale.set(1,1,1);for(var n=this.sprite.children,i=0;i<n.length;i++)n[i].position.set(0,0,0);this.sprite.visible=!0,this.app.trigger(O.AreaPickStart),this.updateRegion(),this.move(e,t)},e.prototype.move=function(e,t){this.distanceX=e-this.startX,this.distanceY=t-this.startY,this.setSpritePosition(this.startX+this.distanceX/2,this.startY+this.distanceY/2);var n=this.distanceX?this.distanceX:1,i=this.distanceY?this.distanceY:1;this.distanceX<0&&(n*=-1),this.distanceY<0&&(i*=-1),this.sprite.scale.set(n,i,1),this.setSpriteLinePosition(this.sprite.position.x,this.sprite.position.y,n,i),this.spriteLineNode.visible=!0,this.updateRegion()},e.prototype.end=function(){this.started&&(this.started=!1,this.sprite&&(this.sprite.visible=!1),this.spriteLineNode&&(this.spriteLineNode.visible=!1),this.app.trigger(O.AreaPickEnd))},e.prototype.intersectPoint=function(e){var t=e[0],n=e[1],i=this.region;return!(t<i[0])&&(!(t>i[2])&&(!(n<i[1])&&!(n>i[3])))},e.prototype.intersectObject=function(e,t){for(var n=this.app.camera,i=new THREE.Vector3,r=(e.isBaseObject?e.node:e).getMeshes(),o=0;o<r.length;o++){var a=r[o],s=a.geometry,l=a.matrixWorld;if(s.isBufferGeometry){var u=s.index,c=s.attributes.position;if(null!==u){var h=Math.max(1,Math.floor(u.count*t));for(f=0,m=u.count;f<m;f+=h){i.fromBufferAttribute(c,u.getX(f)),i.applyMatrix4(l);var p=n.worldToScreen(i);if(this.intersectPoint(p))return!0}}else if(void 0!==c)for(var d=Math.max(1,Math.floor(c.count*t)),f=0,m=c.count;f<m;f+=d){i.fromBufferAttribute(c,f),i.applyMatrix4(l);p=n.worldToScreen(i);if(this.intersectPoint(p))return!0}}else if(s.isGeometry){var g=s.vertices,v=Math.max(1,Math.floor(g.length*t));for(f=0,m=g.length;f<m;f+=v){(i=g[f].clone()).applyMatrix4(l);p=n.worldToScreen(i);if(this.intersectPoint(p))return!0}}}return!1},e.prototype.processPicking=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,n=this.app.picker,i=[];if(n._results.clear(),e)for(var r=0;r<e.length;r++){var o=e[r];if(o.pickable&&this.intersectObject(o,t)){n._results.add(o);var a=n.pickedResultFunc;if(a&&!(o=a(o)))continue;-1===i.indexOf(o)&&i.push(o)}}return i},o(e,[{key:"realTimePicking",get:function(){return this._realTimePicking}}]),e}(),tu=function(){function e(t,n){r(this,e),this.app=t,this.domElem=t.domElement,this._state=new St,this._changed=!1,this.intersect=null,this.dragIntersect=null,this.lastPickFrame=-1,this.lastPickPosition=null,this._pickedResultsFunc=null,this._pickedResultFunc=null,this._results=new gt(this.app),this._objects=new gt(this.app),this._previousObjects=new gt(this.app),this._tempObjects=[],this.pickingArea=new eu(this.app),this._areaCandidates=new gt(this.app),this._areaPicking=!1,this.cameraPickingGround=new Zl(this.app),this.floorPickingGround=new Zl(this.app),this._disableGPUPicker=!1,this.gpuPicker=null,n&&(this.gpuPicker=new Ql(this.app,{debug:!1})),this.enable=!0,this.initEvents()}return e.prototype.initEvents=function(){var e=this;this.app.on("destroy",(function(t){var n=t.object;e._areaCandidates.remove(n)}))},e.prototype.getPickedObject=function(e){return this.app.objectManager.getBaseObject(e)},e.prototype.filter=function(e,t){if(null==e)return null;for(var n=[],i=[],r=0;r<e.length;r++){var o=e[r],a=o.object;if(!a.userData.skipPick){var s=this.getPickedObject(a);if(s)if(!s.node.userData.skipPick){if(this._results.add(s),this._pickedResultFunc&&!t){var l=this._pickedResultFunc(s);if(!l)continue;o.node=l.node,o.object=this.app.objectManager.getBaseObject(l.node)}if(!this._pickedResultsFunc||t){i=[o];break}-1===n.indexOf(s)&&n.push(s),i.push(o)}}}if(this._pickedResultsFunc&&!t){var u={objects:n,result:null};if(this._pickedResultsFunc(u),u.result){var c=n.indexOf(u.result);-1!==c&&(i=[i[c]])}}return i[0]},e.prototype.isTopSprite=function(e){return!e.material.depthTest},e.prototype.sortIntersectObjects=function(e){var t=this;e.sort((function(e,n){var i=e.object,r=n.object,o=i.userData,a=r.userData;if(!o.topNode&&a.topNode)return-1;if(o.topNode&&!a.topNode)return 1;if(o.subNode&&!a.subNode)return-1;if(!o.subNode&&a.subNode)return 1;if(i.isSprite){if(t.isTopSprite(i)&&!r.isSprite)return-1}else if(r.isSprite){if(t.isTopSprite(r)&&!i.isSprite)return 1}else{var s=i.material,l=r.material;if(s.depthTest&&!l.depthTest)return 1;if(!s.depthTest&&l.depthTest)return-1}return e.distance-n.distance}))},e.prototype.pickIntersectObjects=function(e,t,n,i){var r=[];if(t=this._disableGPUPicker||t,this.gpuPicker&&!t){var o=this.app.objectManager.interactableNodes;o.length&&(r=e.intersectEnsureVisibleObjects(o,!0,this.app.renderCamera));var a=this.gpuPicker.pick(this.app.renderCamera,n,i,e);a&&r.push(a)}else{r=e.intersectObject(this.app.scene,!0);for(var s=0;s<r.length;s++){var l=r[s].object.material;l.opacity&&l.visible||r.splice(s--,1)}}return r},e.prototype.__isSameFrame=function(e,t,n){return!n&&(this.lastPickFrame==this.app.currentFrameCount&&(!!this.lastPickPosition&&(this.lastPickPosition[0]==e&&this.lastPickPosition[1]==t)))},e.prototype._isSameFrame=function(e,t,n){return!!this.__isSameFrame(e,t,n)||(this.lastPickPosition=this.lastPickPosition||[0,0],this.lastPickPosition=[e,t],this.lastPickFrame=this.app.currentFrameCount,!1)},e.prototype.intersectObject=function(e,t,n){var i=n.disableGPUPicker,r=n.ignoreFrameCheck,o=n.ignoreFilter;if(n.forceUpdateTexture){var a=this.gpuPicker;a&&(a.forceUpdate=!0)}if(this._pickedResultsFunc&&(i=!0),!this.enable)return null;if(this._isSameFrame(e,t,r))return this.intersect;this.intersect=null,this._results.clear();var s=this.app.calcRect(),l=this.app.renderCamera.getRaycaster(e,t,s),u=this.pickIntersectObjects(l,i,e,t);if(null==u||0==u.length)return null;this.sortIntersectObjects(u);var c=this.filter(u,o);c?(this.intersect=c,this.intersect.object=this.getPickedObject(c.node||c.object),this.intersect.ignoreFilter=!0):(this.intersect=u,this.intersect.ignoreFilter=!1);var h=this.intersect.point;return h&&h.isVector3&&(this.intersect.point=h.toArray()),this.intersect},e.prototype.showPickingGround=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.cameraPickingGround.visible=e},e.prototype.processGroundPicking=function(e,t){if(!this.app.isInScreen([e,t]))return null;var n=this.app.camera;return this.app.renderCamera.updateMatrixWorld(),this.cameraPickingGround.update(n.position,n.target),this.cameraPickingGround.intersect(e,t)},e.prototype.processPicking=function(e){var t=new THREE.Vector2;t.x=e.clientX,t.y=e.clientY;var n=e.offset;n&&(t.x+=n[0],t.y+=n[1]);var i=this.intersectObject(t.x,t.y,e);return null==i?null:(e.intersect=i,e.object=i.object,e.id=Ne.isArray(i)?i[0].id:i.id,e.picked=!0,e.ignoreFilter=i.ignoreFilter,Object.defineProperties(e,{pickedPosition:{get:function(){var e=this.intersect.pickedPosition||this.intersect.point;return e||this.intersect.length&&(e=this.intersect[0].pickedPosition),e}}}),e.pickedObj=e.object,e.getPickedPos=function(){return console.warn("Please use .getPickedPosition() to replace .getPickedPos()"),e.getPickedPosition()},e.getPickedPosition=function(){return console.warn("Please use .pickedPosition to replace .getPickedPosition()"),e.pickedPosition},i)},e.prototype.removePickingResources=function(e){this.gpuPicker&&this.gpuPicker.removePickingResources(e)},e.prototype.markPickingNode=function(e){this.gpuPicker&&this.gpuPicker.markPickingNode(e)},e.prototype.notifyChanged=function(){this.app.trigger(O.PickChange,{objects:this._objects,previousObjects:this._previousObjects});for(var e=this._objects.concat(this._previousObjects),t=0;t<e.length;t++){e[t].trigger(O.PickChange,{objects:this._objects,previousObjects:this._previousObjects})}this._previousObjects.buildReturnObject(this._objects)},e.prototype.update=function(e){var t=function(){if(Yl&&void 0!==Yl.checkAuthRet){var e=Yl.checkAuthRet;return Yl.checkAuthRet=void 0,e}}();void 0!==t&&(t?this.app.trigger("authSuccessed"):this.app.trigger("authFailed")),this.enable&&(this.gpuPicker&&this.gpuPicker.update(e),this._changed&&(this.notifyChanged(),this._changed=!1))},e.prototype.resize=function(e,t){this.gpuPicker&&this.gpuPicker.resizeTexture(e,t)},e.prototype.render=function(e){this.gpuPicker&&this.gpuPicker.render(e)},e.prototype.hasPicked=function(e,t){if(!t)return!1;if(!this.intersect)return!1;var n=this.intersect.object;if(!n)return!1;if(n!=t){if(e._stopPropagation)return!1;if(!n.isChildOf(t))return!1}return!0},e.prototype.setPickedObject=function(e,t,n){var i=this;if(this._tempObjects.length=0,e){if(e.isBaseObject&&this._objects.has(e))return;var r=[];if((r=Ne.isArray(e)?e.map((function(e){return{object:e.node}})):e.isSelector?e.toArray().map((function(e){return{object:e.node}})):[{object:e.node}]).length>1)r.forEach((function(e){if(i.filter([e],n)){var t=e.object;if(t)if(t.isBaseObject)i._tempObjects.push(e.object);else{var r=i.app.objectManager.getBaseObject(t);r&&i._tempObjects.push(r)}}})),e=this._tempObjects.length>1?this._tempObjects:this._tempObjects[0];else{if(!this.filter(r,n))return!1;r[0].object&&r[0].object.isBaseObject&&(e=r[0].object)}}for(var o=0;o<this._objects.length;o++){var a=this._objects[o];a.trigger(O.Unpick),this.app.trigger(O.Unpick,{object:a})}return this._objects.clear(),e&&(this._objects.add(e),Ne.isArray(e)&&e.length?e.forEach((function(e){e.trigger(O.Pick)})):e.trigger(O.Pick)),this.app.trigger(O.Pick,{object:e instanceof Lt?e:null,objects:this._objects,previousObjects:this._previousObjects}),this._previousObjects.equals(this._objects)||(this._changed=!0),t&&e&&(t.object=e),!0},e.prototype.isChanged=function(){return this._changed},e.prototype.intersectResult=function(e,t,n,i){if(i=i||{},void 0===e||void 0===t){var r=this.app.camera.worldToScreen(this.app.camera.target);e=r[0],t=r[1]}var o={clientX:e,clientY:t,offset:n,disableGPUPicker:Ne.parseValue(i.disableGPUPicker,!1),ignoreFrameCheck:Ne.parseValue(i.ignoreFrameCheck,!0),ignoreFilter:Ne.parseValue(i.ignoreFilter,!0)},a=this.processPicking(o);return a?(o.getPickedPosition=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return a.getPickedPosition?a.getPickedPosition(e):[0,0,0]},delete o.offset,delete o.disableGPUPicker,delete o.ignoreFrameCheck,delete o.ignoreFilter,o):{picked:!1,pickedPosition:null,object:null}},e.prototype.pickObjects=function(e,t,n,i,r){if(void 0===n&&void 0===i){if(void 0===e||void 0===t){var o=this.app.camera.worldToScreen(this.app.camera.position);e=o[0],t=o[1]}for(var a=this.app.calcRect(),s=this.app.renderCamera.getRaycaster(e,t,a),l=this.pickIntersectObjects(s,!1,e,t),u=[],c=0;c<l.length;c++){var h=l[c].object;if(!h.userData.isDebuggerNode){var p=this.app.objectManager.getBaseObject(h);p&&u.push({object:p,node:h})}}return u}return this.pickingArea.startX=e,this.pickingArea.startY=t,this.pickingArea.distanceX=n,this.pickingArea.distanceY=i,this.pickingArea.updateRegion(),this.pickingArea.processPicking(r)},e.prototype.pickWorldPosition=function(e,t,n){return this.intersectResult(e,t,n).pickedPosition},e.prototype.startAreaPicking=function(e){var t=(e=e||{}).x,n=e.y,i=Ne.parseValue(e.realTimePicking,!0),r=Ne.parseValue(e.drawRegion,!0);Ne.isNumber(t)&&Ne.isNumber(n)&&(this.app.camera.disable({rotate:!0}),this.pickingArea.start(t,n),this.pickingArea._areaPickType=i?P.RealTime:P.NotRealTime,this.pickingArea.sprite.visible=r,this.pickingArea.spriteLineNode.visible=r,this._areaPicking=!0)},e.prototype.endAreaPicking=function(){if(this.areaPicking){this.pickingArea.end(),this.pickingArea._areaPickType=P.Auto,this.app.camera.resume({rotate:!0});var e=this;setTimeout((function(){e._areaPicking=!1}),10)}},e.prototype.pick=function(e,t){var n=this.pickObjects(e,t);if(!n.length)return null;var i={object:n[0].object,node:n[0].node};return Object.defineProperty(i,"pickedPosition",{get:function(){return null}}),i},e.prototype._enable=function(e,t,n){this._state.enable(e,t,n)},o(e,[{key:"pickerState",get:function(){return Kl.instance}},{key:"enable",set:function(e){this._enable(e,"default",100)},get:function(){return this._state.isEnable()}},{key:"disableGPUPicker",set:function(e){this._disableGPUPicker=e}},{key:"areaPicking",get:function(){return!!this.enable&&this._areaPicking}},{key:"forceUpdate",set:function(e){this.gpuPicker&&(this.gpuPicker.forceUpdate=e)}},{key:"needUpdate",set:function(e){this.gpuPicker&&(this.gpuPicker.needUpdate=e)}},{key:"areaCandidates",set:function(e){this._areaCandidates.buildReturnObject(e)},get:function(){return this._areaCandidates}},{key:"pickedResultsFunc",set:function(e){this._pickedResultsFunc=e},get:function(){return this._pickedResultsFunc}},{key:"pickedResultFunc",set:function(e){this._pickedResultFunc=e},get:function(){return this._pickedResultFunc}},{key:"results",get:function(){return this._results}},{key:"objects",get:function(){return this._objects}},{key:"previousObjects",get:function(){return this._previousObjects}},{key:"filterPickedResultsFunc",set:function(e){console.warn("[Picker] please use .pickedResultsFunc instead"),this.pickedResultsFunc=e},get:function(){return console.warn("[Picker] please use .pickedResultsFunc instead"),this.pickedResultsFunc}},{key:"pickedObjectFunc",set:function(e){console.warn("[Picker] please use .pickedResultFunc instead"),this.pickedResultFunc=e},get:function(){return console.warn("[Picker] please use .pickedResultFunc instead"),this.pickedResultFunc}},{key:"enabled",set:function(e){console.warn("[Picker] please use .enable instead"),this.enable=e},get:function(){return console.warn("[Picker] please use .enable instead"),this.enable}},{key:"candidates",set:function(e){console.warn("[Picker] please use .areaCandidates instead"),this.areaCandidates=e},get:function(){return console.warn("[Picker] please use .areaCandidates instead"),this.areaCandidates}}]),e}(),nu=function(){function e(t){r(this,e),this.app=t,this._objects=new gt(this.app),this._previousObjects=new gt(this.app),this._changed=!1}return e.prototype.notifyChanged=function(){this.app.trigger(O.SelectionChange,{objects:this._objects,previousObjects:this._previousObjects});var e=this;this._objects.forEach((function(t){t.trigger(O.SelectionChange,{objects:e._objects,previousObjects:e._previousObjects})})),this._previousObjects.buildReturnObject(this._objects)},e.prototype.update=function(){this._changed&&(this.notifyChanged(),this._changed=!1)},e.prototype.select=function(e){e&&(this._objects.add(e),e.trigger(O.Select,{objects:this._objects}),this.app.trigger(O.Select,{object:e,objects:this._objects}),this._changed=!0)},e.prototype.deselect=function(e){if(e){this._objects.remove(e);var t=new gt(this.app);e.isBaseObject?t.add(e):t=e;for(var n=0;n<t.length;n++){(e=t[n]).trigger(O.Deselect,{objects:t})}this.app.trigger(O.Deselect,{objects:t}),this._changed=!0}},e.prototype.has=function(e){return this._objects.has(e)},e.prototype.clear=function(){if(this._objects.length){this.app.trigger(O.Deselect,{objects:this._objects});for(var e=0;e<this._objects.length;e++){this._objects[e].trigger(O.Deselect,{objects:this._objects})}this._objects.clear(),this._changed=!0}},e.prototype.isChanged=function(){return this._changed},e.prototype.onUpdate=function(e){this.update(e)},o(e,[{key:"objects",get:function(){return this._objects}},{key:"previousObjects",get:function(){return this._previousObjects}}]),e}(),iu=new THREE.Frustum,ru=new THREE.Matrix4,ou=function(e){function t(n,i,o){r(this,t);var a=s(this,e.call(this,n));return a.node=i,a.projectionType=w.Perspective,a.controller=o,a.followingObject=null,a.lookingObject=null,a._near=a.node.near,a._far=a.node.far,a.addControl(new THING.CameraControl,"cameraControl"),a}return a(t,e),t.prototype.worldToScreen=function(e){if(!e)return null;e.isBaseObject&&(e=e.boundingBox.center,console.warn("[Camera] please use '.worldToScreen(object.boundingBox.center)' to get screen position"));var t=Ne.parseVector3(e);t.project(this.node);var n=this.app.renderer.getContext().canvas.width/2,i=this.app.renderer.getContext().canvas.height/2,r=Math.round(t.x*n+n),o=Math.round(-t.y*i+i),a=this.app.renderer.getPixelRatio();return[r/=a,o/=a,t.z]},t.prototype.screenToWorld=function(e,t){if(Ne.isArray(e)&&void 0===t){var n=e;e=n[0],t=n[1]}var i=this.app.picker.processGroundPicking(e,t);return i?i.point.toArray():null},t.prototype.unprojectScreenToWorld=function(e,t,n){if(Ne.isArray(e)&&void 0===t){var i=e;e=i[0],t=i[1]}var r=this.app.renderer.getPixelRatio();t*=r;var o=(e*=r)/this.app.renderer.getContext().canvas.width*2-1,a=-t/this.app.renderer.getContext().canvas.height*2+1;return n=n||-1,new THREE.Vector3(o,a,n).unproject(this.node).toArray()},t.prototype.lerpToPerspective=function(e,t){this.projectionType=w.Perspective,this.node.lerpToPerspective(e,t)},t.prototype.lerpToOrthographic=function(e,t,n,i){this.projectionType=w.Orthographic,this.node.lerpToOrthographic(e,t,n,i)},t.prototype.setSize=function(e,t){this.node.setSize(e,t)},t.prototype.stopFlying=function(e){var t=this.getControl("cameraControl");t&&t.stopFlying(e)},t.prototype.flyTo=function(e){var t=this.getControl("cameraControl");t&&(this.app.setCurrentHTMLMarker(null),t.flyTo(e))},t.prototype.lookAt=function(e){var t=this.getControl("cameraControl");if(t)return t.lookAt(e)},t.prototype.followObject=function(e){var t=this.getControl("cameraControl");t&&t.followObject(e)},t.prototype.stopFollowingObject=function(){var e=this.getControl("cameraControl");e&&e.stopFollowingObject()},t.prototype.movePath=function(e){var t=this.getControl("cameraControl");t&&t.movePath(e)},t.prototype.rotateAround=function(e){var t=this.getControl("cameraControl");t&&t.rotateAround(e)},t.prototype._stopRotating=function(){e.prototype.stopRotating.call(this)},t.prototype.stopRotating=function(e){var t=this.getControl("cameraControl");t&&t.stopRotating(e)},t.prototype.rotate=function(e){var t=this.getControl("cameraControl");t&&t.rotate(e)},t.prototype.rotateX=function(e){this.rotate([e,0,0])},t.prototype.rotateY=function(e){if(this.controller instanceof THREE.EarthOrbitControls){var t=new THREE.Vector3;t.copy(this.controller.object.position),t.normalize(),this.controller.object.rotateOnWorldAxis(t,THING.Math.degToRad(e)),this.controller._isCameraStatic=!1;var n=this.controller._getIntersectPoint();this.controller._isCameraStatic=!0,this.controller.target.copy(n)}else this.rotate([0,e,0])},t.prototype.rotateZ=function(e){this.rotate([0,0,e])},t.prototype.isInView=function(e){return!(!e||!e.isBaseObject)&&this.node.isInView(e.boundingBox.toBox())},t.prototype._setPosition=function(e){this.node.position.fromArray(e)},o(t,[{key:"frustum",get:function(){return ru.multiplyMatrices(this.node.projectionMatrix,this.node.matrixWorldInverse),iu.setFromProjectionMatrix(ru),iu}},{key:"flying",get:function(){var e=this.getControl("cameraControl");return!!e&&e.isFlying()}},{key:"isPerspectiveCamera",get:function(){return this.node.isPerspectiveCamera}},{key:"fov",set:function(e){this.node.setFov(e)},get:function(){return this.node.fov}},{key:"near",set:function(e){this._near=e,this.node.setNear(e)},get:function(){return this._near}},{key:"far",set:function(e){this._far=e,this.node.setFar(e)},get:function(){return this._far}},{key:"up",set:function(e){this.node.up.fromArray(e)},get:function(){return this.node.up.toArray()}},{key:"position",set:function(e){this._setPosition(e)},get:function(){return this.node.position.toArray()}},{key:"target",set:function(e){var t=this.getControl("cameraControl");t&&t.setTarget(e)},get:function(){return this.controller.target.toArray()}},{key:"distance",set:function(e){var t=Ne.parseVector3(this.position),n=Ne.parseVector3(this.target),i=new THREE.Vector3;i.subVectors(t,n),i.normalize(),i.multiplyScalar(e),n.add(i),this.position=n.toArray()},get:function(){var e=Ne.parseVector3(this.position),t=Ne.parseVector3(this.target);return e.distanceTo(t)}},{key:"direction",get:function(){var e=Ne.parseVector3(this.position),t=Ne.parseVector3(this.target),n=new THREE.Vector3;return n.subVectors(t,e),n.normalize(),n.toArray()}},{key:"rightDirection",get:function(){var e=THING.Utils.parseVector3(this.direction),t=THING.Utils.parseVector3(this.up),n=new THREE.Vector3;return n.crossVectors(e,t),n.normalize(),n.toArray()}}]),t}(Lt),au=function(){function e(t){var n=this;r(this,e),this.app=t,this.picker=t.picker,this.orbit=new THREE.OrbitControls(this.app.renderCamera,this.app.mainDomElement),this.curOrbit=this.orbit,this.initOrbit(this.orbit),this.cameraObject=new ou(this.app,this.app.renderCamera,this.orbit),this.toggleBackupInfo={},this.zoomTween=null,this._autoAdjustNear=!0,this._autoAdjustTarget=!0,this._autoHideObjectsWhenRotatingFunc=null,this._enableUpdateTargetOnWheel=!0,this._enableZoomOnTarget=!1,this._wheelOnMouseTargetScale=3,this._wheelOnMouseTargetPosition=null,this._autoFixCameraUp=!0,this._hadEnabledPicking=!1,this._targetObject=null,this._inputEnableFlag=new zt((function(e){n.curOrbit.enabled=e})),this._panEnableFlag=new zt((function(e){"normal"==n.mode?n.curOrbit.enablePan=e:n.curOrbit.enableRotate=e})),this._rotateEnableFlag=new zt((function(e){"normal"==n.mode?n.curOrbit.enableRotate=e:n.curOrbit.enablePan=e})),this._zoomEnableFlag=new zt((function(e){n.curOrbit.enableZoom=e})),this.cameraObject.isPerspectiveCamera&&(this.cameraFov=this.cameraObject.fov,this.cameraNear=this.cameraObject.near,this.cameraFar=this.cameraObject.far);var i=this;this.app.on("backgroundChanged",(function(e){var t=i.toggleBackupInfo.toggleSkyBox;t&&(t.background=e.value)})),this.prevPosition=[0,0,0],this.prevTarget=[0,0,0]}return e.prototype.initOrbit=function(e){e.minDistance=1e-4,e.minZoom=.15,e.maxZoom=8,e.autoRotate=!1,e.enableDamping=!0,e.minPolarAngle=0,e instanceof THREE.EarthOrbitControls||(e.maxPolarAngle=Math.PI),e.keyPanSpeed=.1,e.panSpeed=.1,e.rotateSpeed=.07,e.dampingFactor=.078,e.screenSpacePanning=!0,e.enabled=!0,this.registerOrbitEvents(e)},e.prototype.registerOrbitEvents=function(e){var t=this;e.addEventListener("mousedownpanevent",(function(e){t.onMouseDownPanEvent(e)})),e.addEventListener("mouseuppanevent",(function(e){t.onMouseUpPanEvent(e)})),e.addEventListener("mousemoveevent",(function(e){t.onMouseMoveEvent(e)})),e.addEventListener("start",(function(e){t.onStart(e)})),e.addEventListener("end",(function(e){t.onEnd(e)})),e.addEventListener("wheel",(function(e){t.onWheel(e)})),e.addEventListener("change",(function(e){t.onChange(e)}))},e.prototype.isCameraController=function(){return!0},e.prototype._zoom=function(e,t,n){this.zoomTween&&this.zoomTween.stop();var i=this;this.zoomTween=new TWEEN.Tween({zoom:e}).to({zoom:t},n).easing(TWEEN.Easing.Linear.None).onUpdate((function(){i._rotateEnableFlag.lock(!1,"_zoom"),i.curOrbit.object.zoom=this._object.zoom,i.curOrbit.object.updateProjectionMatrix()})).onComplete((function(){i._rotateEnableFlag.unlock("_zoom")})).start()},e.prototype._change=function(e){this.app.trigger(e,{position:this.position,target:this.target})},e.prototype._autoFixTarget=function(){var e=this.curOrbit;if(e.target.distanceTo(e.object.position)>5)return!1;var t=new THREE.Vector3(0,0,0);t.subVectors(e.target,e.object.position).normalize();var n=t.multiplyScalar(10),i=new THREE.Vector3(0,0,0);return i.addVectors(e.object.position,n),e.target.set(i.x,i.y,i.z),!0},e.prototype._processWheelOnMouseTarget=function(e){var t=this.app.renderCamera,n=this.curOrbit,i=this.app.calcRect(),r=i.width/2,o=i.height/2,a=this.app.getClientPosition(e);(l=this._getIntersectPosition(a.x,a.y))||(l=this.cameraObject.unprojectScreenToWorld(a.x,a.y,.5));var s=this._getIntersectPosition(r,o);s||(s=this.cameraObject.unprojectScreenToWorld(r,o,.5));var l=Ne.parseVector3(l),u=Ne.parseVector3(this.position);this._wheelOnMouseTargetPosition=l.toArray();var c=t.position.distanceTo(l)/100;c*=this._wheelOnMouseTargetScale,l.sub(u).normalize().multiplyScalar(c),e.delta<0?(t.position.x+=l.x,t.position.y+=l.y,t.position.z+=l.z):(t.position.x-=l.x,t.position.y-=l.y,t.position.z-=l.z),n.target.x=s[0],n.target.y=s[1],n.target.z=s[2]},e.prototype._intersectObject=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this.app.calcRect(),r=this.app.renderCamera.getRaycaster(e,t,i),o=this.app.picker.pickIntersectObjects(r,!1,e,t);if(!o.length)return null;for(var a=this.app.picker.floorPickingGround,s=0;s<o.length;s++){var l=o[s].object;(a.isMeshOf(l)||l.userData.__debugObject__)&&o.splice(s--,1)}if(o.length){var u=this.app.objectManager.getBaseObject(o[0].node);if(u){var c=o[0].getPickedPosition();if(n)return c;var h=this.target,p=this.position,d=this.direction,f=this.distance,m=THING.Math.getDistance(c,p),g=THING.Math.getDistance(c,h);f>=m&&(g*=-1);var v=THING.Math.addVector(h,THING.Math.scaleVector(d,g)),y=THING.Math.getDistance(p,v),b=this.distanceLimited;return y<=b[0]||y>=b[1]?null:v}}return null},e.prototype._getIntersectPosition=function(e,t){var n=this._intersectObject(e,t,!0);if(n)return n.isVector3?n.toArray():n;var i=this.app.calcRect(),r=this.app.renderCamera.getRaycaster(e,t,i),o=this.app.picker.floorPickingGround.intersectByRaycaster(r);return o?o.point.toArray():null},e.prototype._adjustTargetStrictly=function(){var e=this.app.calcRect(),t=e.width/2,n=e.height/2,i=this._intersectObject(t,n,!1);i&&(this.target=i)},e.prototype.onMouseDownPanEvent=function(e){this._autoAdjustTarget&&this._adjustTargetStrictly()},e.prototype.onMouseUpPanEvent=function(e){},e.prototype.onMouseMoveEvent=function(e){this._change("cameraChangeMouseMove")},e.prototype.onStart=function(e){this.flying?this._hadEnabledPicking=!1:(this._hadEnabledPicking=!0,this.app.picker._enable(!1,"onStart",1e3)),this.prevPosition=this.position,this.prevTarget=this.target,this._change("cameraChangeStart"),this._change("cameraControllerChangeStart")},e.prototype.onEnd=function(e){this._hadEnabledPicking&&(this._hadEnabledPicking=!1,this.app.picker._enable(!0,"onStart",0));var t=this.position,n=this.target;THING.Math.equalsVector(this.prevPosition,t,.01)&&THING.Math.equalsVector(this.prevTarget,n,.01)||(this._change("cameraChangeEnd"),this._change("cameraControllerChangeEnd")),this.prevPosition=t,this.prevTarget=n},e.prototype.onWheel=function(e){this._enableUpdateTargetOnWheel&&this._autoFixTarget(),this.app.trigger("camerazoom",{delta:e.delta})},e.prototype.onChange=function(e){this.app.trigger("cameracontrollerchanged"),this._change("cameraChange")},e.prototype.zoomIn=function(e){var t=e.zoom||1,n=e.time||1e3,i=t,r=this.curOrbit.object.zoom;this._zoom(i,r,n)},e.prototype.zoomOut=function(e){var t=e.zoom||1,n=e.time||1e3,i=this.curOrbit.object.zoom,r=t;this._zoom(i,r,n)},e.prototype.worldToScreen=function(e){return this.cameraObject.worldToScreen(e)},e.prototype.screenToWorld=function(e,t){return this.cameraObject.screenToWorld(e,t)},e.prototype.unprojectScreenToWorld=function(e,t,n){return this.cameraObject.unprojectScreenToWorld(e,t,n)},e.prototype.setProjectionType=function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e3,o=this,a=e!=this.projectionType;switch(e){case w.Perspective:if(this.cameraObject.lerpToPerspective(r,(function(){if(a&&o.projectionType==w.Perspective){var e=o.toggleBackupInfo.toggleSkyBox;e&&(o.app.background=e.background,o.app.skyBox=e.skyBox,o.app.backgroundAdditiveColor=e.backgroundAdditiveColor,o.app.backgroundColorScaleFactor=e.backgroundColorScaleFactor,o.toggleBackupInfo.toggleSkyBox=null)}})),a){var s=this.toggleBackupInfo.toggleKeyPanSpeed;void 0!==s&&(this.curOrbit.keyPanSpeed=s);var l=this.toggleBackupInfo.toggleMousePanSpeed;void 0!==l&&(this.curOrbit.panSpeed=l);var u=this.toggleBackupInfo.toggleDampingFactor;void 0!==u&&(this.curOrbit.dampingFactor=u);var c=this.toggleBackupInfo.minPolarAngle;void 0!==c&&(this.curOrbit.minPolarAngle=c);var h=this.toggleBackupInfo.maxPolarAngle;void 0!==h&&(this.curOrbit.maxPolarAngle=h)}break;case w.Orthographic:if(a){var p=this.toggleBackupInfo.toggleSkyBox;p?(p.backgroundAdditiveColor=this.app.backgroundAdditiveColor,p.backgroundColorScaleFactor=this.app.backgroundColorScaleFactor):this.toggleBackupInfo.toggleSkyBox={skyBox:this.app.skyBox,background:this.app.background,backgroundAdditiveColor:this.app.backgroundAdditiveColor,backgroundColorScaleFactor:this.app.backgroundColorScaleFactor}}this.app.skyBox=null,a&&(this.toggleBackupInfo.toggleKeyPanSpeed=this.curOrbit.keyPanSpeed,this.toggleBackupInfo.toggleMousePanSpeed=this.curOrbit.panSpeed,this.toggleBackupInfo.toggleDampingFactor=this.curOrbit.dampingFactor,this.toggleBackupInfo.minPolarAngle=this.curOrbit.minPolarAngle,this.toggleBackupInfo.maxPolarAngle=this.curOrbit.maxPolarAngle),this.curOrbit.keyPanSpeed=t/6400,this.curOrbit.panSpeed=t/6400,this.curOrbit.dampingFactor=.12,this.curOrbit.minPolarAngle=0,this.curOrbit.maxPolarAngle=Math.PI;var d=Ne.parseVector3(n),f=Ne.parseVector3(i);this.cameraObject.lerpToOrthographic(d,f,r);break;default:return!1}},e.prototype._getBestLocation=function(e,t,n){var i=Ne.parseVector3(t.size),r=Ne.parseVector3(t.center);if(!i.x||!i.y||!i.z){i.x=5,i.y=5,i.z=5}var o=r.clone(),a=new THREE.Vector3(0,1,0);if(e==w.Perspective)o.x=r.x+i.x,o.y=r.y+i.y,o.z=r.z+i.z;else{var s=n||i.length();o.y=r.y+s,a=new THREE.Vector3(0,0,-1)}return{lookAt:r,pos:o,up:a,scale:i}},e.prototype.getBestLocation=function(e){var t;return t=Ne.isArray(e)?new gt(this.app,e).boundingBox:e.boundingBox,this._getBestLocation(this.projectionType,t)},e.prototype.setType=function(e,t,n,i,r){var o=this._getBestLocation(t,e.boundingBox,r),a=o.pos.distanceTo(o.lookAt),s=this.distanceLimited[1];if(a>=s){var l=o.pos.subVectors(o.pos.clone(),o.lookAt);l.normalize();var u=o.pos.addVectors(o.lookAt,l.multiplyScalar(s));o.pos=u}switch(this.setProjectionType(t,o.scale.length(),o.pos,o.lookAt,n),t){case w.Perspective:var c=this.toggleBackupInfo.toggleInitPos;void 0!==c&&(o.pos=Ne.parseVector3(c));var h=this.toggleBackupInfo.toggleInitLookAt;void 0!==h&&(o.lookAt=Ne.parseVector3(h));break;case w.Orthographic:this.toggleBackupInfo.toggleInitPos=this.position,this.toggleBackupInfo.toggleInitLookAt=this.target;break;default:return!1}var p=this.app.rendererManager.getCurrentControl(),d=p.getConfig(),f=d.temporalSuperSampling.enable,m=d.postEffect.screenSpaceAmbientOcclusion.enable;p.mergeConfig({temporalSuperSampling:{enable:!1},postEffect:{screenSpaceAmbientOcclusion:{enable:!1}}}).update();var g=function(){p.mergeConfig({temporalSuperSampling:{enable:f},postEffect:{screenSpaceAmbientOcclusion:{enable:m}}}).update(),i&&i()};return this.flyTo({position:o.pos.toArray(),target:o.lookAt.toArray(),up:o.up.toArray(),time:n,stop:g,complete:g}),!0},e.prototype.toggleNormalViewMode=function(e){return this.viewMode!=T.Normal&&(this.toggleObject({object:this.app.root,is3D:!0,complete:function(){e&&e()}}),!0)},e.prototype.toggleObject=function(e){var t=(e=e||{}).object||this.app.level.current||this.app.root,n=Ne.parseValue(e.is3D,!1),i=e.complete,r=e.time||1e3,o=Ne.parseValue(e.force,!1),a=e.height,s=this.app.webViewManager.mixerContext,l=!1;return n?(o||this.projectionType!=w.Perspective)&&(this.projectionType!=w.Perspective&&this._rotateEnableFlag.unlock("toggleObject"),l=this.setType(t,w.Perspective,r,i,a),s.cssCamera=s.backupCSSCamera):(o||this.projectionType!=w.Orthographic)&&(this.projectionType!=w.Orthographic&&this._rotateEnableFlag.lock(!1,"toggleObject"),l=this.setType(t,w.Orthographic,r,i,a),s.cssCamera=this.app.renderCamera.cameraO.clone(),s.cssCamera.getEffectiveFOV=function(){return THING.App.current.renderCamera.getEffectiveFOV()}),l&&this.app.trigger("cameraViewChange",{view:this.projectionType}),l},e.prototype.resize=function(e,t){this.cameraObject.setSize(e,t)},e.prototype._buildFlyParams=function(e){var t=this;e.isBaseObject&&(e={target:e});var n=e._flyStart,i=e._flying,r=e._flyStop,o=e._flyComplete,a=Ne.parseValue(e.pickable,!1);return e.flyStart=function(){a||t.picker._enable(!1,"_buildFlyParams",1e3),t._change("cameraChangeStart"),n&&n()},e.flying=function(){Ne.isFunction(t.curOrbit.setState)&&t.curOrbit.setState(),t._change("cameraChange"),i&&i()},e.flyStop=function(){Ne.isFunction(t.curOrbit.setState)&&t.curOrbit.setState(),a||t.picker._enable(!0,"_buildFlyParams",0),t._change("cameraChangeEnd");var n=e.stop;n&&n(),r&&r()},e.flyComplete=function(){t.picker._enable(!0,"_buildFlyParams",0),Ne.isFunction(t.curOrbit.setState)&&t.curOrbit.setState(),t._change("cameraChangeEnd");var n=e.target||e.object;n instanceof Lt&&n.trigger("cameraFlyComplete");var i=e.targetForFlyComplete;i!=n&&i instanceof Lt&&i.trigger("cameraFlyComplete"),t.app.events.dispatchEvent({type:"cameraFlyComplete"});var r=e.complete;r&&r(),o&&o()},e.autoFixUp=this._autoFixCameraUp,e.targetForFlyComplete=this.app.level.current,e},e.prototype.fit=function(e){(e=e||{}).isBaseObject&&(e={object:e}),e.object=e.object||this.app.root,e.time=1,this.cameraObject.flyTo(e)},e.prototype.stopFlying=function(e){this.cameraObject.stopFlying(e)},e.prototype.flyTo=function(e){e=this._buildFlyParams(e),this.cameraObject.flyTo(e)},e.prototype.movePath=function(e){e=this._buildFlyParams(e),this.cameraObject.movePath(e)},e.prototype.lookAt=function(e){this.cameraObject.lookAt(e)?(this._rotateEnableFlag.lock(!1,"lookAt"),this._panEnableFlag.lock(!1,"lookAt")):(this._rotateEnableFlag.unlock("lookAt"),this._panEnableFlag.unlock("lookAt"))},e.prototype.stopRotateAround=function(e){this.cameraObject.stopRotating(e)},e.prototype.rotateAround=function(e){var t=this;e=e||{};var n=Ne.parseValue(e.pickable,!0);e.rotateStart=function(){n||t.picker._enable(!1,"rotateAround",1e3)},e.rotateComplete=function(){n||t.picker._enable(!0,"rotateAround",0)},this.cameraObject.rotateAround(e)},e.prototype.rotateAroundX=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;this.rotateAround({xRotateAngle:e,time:t})},e.prototype.rotateAroundY=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;this.rotateAround({yRotateAngle:e,time:t})},e.prototype.followObject=function(e){e=e||{},this.cameraObject.followObject(e);var t=Ne.parseValue(e.enableRotate,!1),n=Ne.parseValue(e.enableZoom,!1);t||this._rotateEnableFlag.lock(!1,"followObject"),n||this._zoomEnableFlag.lock(!1,"followObject")},e.prototype.stopFollowingObject=function(){this.cameraObject.stopFollowingObject(),this._rotateEnableFlag.unlock("followObject"),this._zoomEnableFlag.unlock("followObject")},e.prototype.canUpdateOrbit=function(){return!this.cameraObject.flying&&!(!this.curOrbit.enabled&&!this.curOrbit.autoRotate)},e.prototype.update=function(){this.cameraObject.update(),this.canUpdateOrbit()&&this.curOrbit.update()},e.prototype.onUpdate=function(e){this.update(e)},e.prototype.zoom=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if(e=Math.min(this.distance-1,e),this.projectionType==w.Perspective){var n=Ne.parseVector3(this.direction);n.multiplyScalar(e);var i=Ne.parseVector3(this.position);if(i.add(n),this.enableUpdateTargetOnWheel&&this._autoFixTarget()){var r=Ne.parseVector3(this.target);r.add(n),this.target=r}this.flyTo({position:i.toArray(),target:this.target,time:t})}else{var o=this.curOrbit.object.zoom+e/20;o>0&&this.zoomOut({zoom:o,time:t})}},e.prototype.rotateX=function(e,t){Ne.isNull(t)?this.cameraObject.rotateX(e):(console.warn('Please use "this.rotateAround({xRotateAngle: angle,time});" to replace rotateX(angle, time)'),this.rotateAround({xRotateAngle:e,time:t}))},e.prototype.rotateY=function(e,t){Ne.isNull(t)?this.cameraObject.rotateY(e):(console.warn('Please use "this.rotateAround({yRotateAngle: angle,time});" to replace rotateX(angle, time)'),this.rotateAround({yRotateAngle:e,time:t}))},e.prototype.rotateZ=function(e){this.cameraObject.rotateZ(e)},e.prototype.move=function(e,t){var n=this.dampingFactor/.12;this.curOrbit.move(-e*n,t*n)},e.prototype.loadViewPoint=function(e){this.app.viewPointManger.loadJSON(e)},e.prototype.playViewPoint=function(e){this.app.viewPointManger.play(e)},e.prototype.pauseViewPoint=function(e){this.app.viewPointManger.pause(e)},e.prototype.isInView=function(e){return!!e&&this.cameraObject.isInView(e)},e.prototype.isCovered=function(e){return!!e&&(console.warn("not impl yet"),!0)},e.prototype.disable=function(e){(e=e||{}).rotate=Ne.parseValue(e.rotate,!0),e.pan=Ne.parseValue(e.pan,!0),e.zoom=Ne.parseValue(e.zoom,!0),e.rotate&&this._rotateEnableFlag.lock(!1,"disable"),e.pan&&this._panEnableFlag.lock(!1,"disable"),e.zoom&&this._zoomEnableFlag.lock(!1,"disable")},e.prototype.resume=function(e){(e=e||{}).rotate=Ne.parseValue(e.rotate,!0),e.pan=Ne.parseValue(e.pan,!0),e.zoom=Ne.parseValue(e.zoom,!0),e.rotate&&this._rotateEnableFlag.unlock("disable"),e.pan&&this._panEnableFlag.unlock("disable"),e.zoom&&this._zoomEnableFlag.unlock("disable")},e.prototype.showTargetNode=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?this._targetObject||(this._targetObject=this.app.create({type:"Box",position:this.target,style:{color:"#FF0000"}}),this._targetObject.pickable=!1,this._targetObject.style.outlineColor=65535,this._targetObject.node.traverse((function(e){e.userData.__debugObject__=!0}))):this._targetObject&&(this._targetObject.destroy(),this._targetObject=null)},e.prototype.distanceTo=function(e){return this.cameraObject.distanceTo(e)},e.prototype.setTargetLimit=function(e){e?this.curOrbit.setTargetLimit(e):this.curOrbit.setTargetLimit(null)},e.prototype.log=function(){console.log("["+this.position.toString()+"], ["+this.target.toString()+"]")},e.prototype.dolly=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;console.warn("[CameraController] Please use '.zoom()' to replace '.dolly()'"),this.zoom(e,t)},e.prototype.theta=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;console.warn("[CameraController] Please use '.rotateX()' to replace '.theta()'"),this.rotateX(e,t)},e.prototype.phi=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;console.warn("[CameraController] Please use '.rotateY()' to replace '.theta()'"),this.rotateY(e,t)},o(e,[{key:"aspect",get:function(){return this.cameraObject.node.cameraP.aspect}},{key:"frustum",get:function(){return this.cameraObject.frustum}},{key:"camera",get:function(){return this.app.renderCamera}},{key:"viewMode",set:function(e){this.toggleObject({is3D:e==T.Normal})},get:function(){return this.projectionType==w.Perspective?T.Normal:T.TopView}},{key:"projectionType",set:function(e){this.setProjectionType(e,this.distance,this.position,this.target)},get:function(){return this.cameraObject.projectionType}},{key:"enableDamping",set:function(e){this.curOrbit.enableDamping=e},get:function(){return this.curOrbit.enableDamping}},{key:"dampingFactor",set:function(e){this.curOrbit.dampingFactor=e},get:function(){return this.curOrbit.dampingFactor}},{key:"fov",set:function(e){this.cameraObject.fov=e;var t=this.app.webViewManager.mixerContext.cssCamera;t.fov=e,t.updateProjectionMatrix()},get:function(){return this.cameraObject.fov}},{key:"near",set:function(e){this.cameraObject.near=e},get:function(){return this.cameraObject.near}},{key:"far",set:function(e){this.cameraObject.far=e},get:function(){return this.cameraObject.far}},{key:"zoomLimited",set:function(e){this.curOrbit.minZoom=e[0],this.curOrbit.maxZoom=e[1]},get:function(){return[this.curOrbit.minZoom,this.curOrbit.maxZoom]}},{key:"zoomFactor",set:function(e){void 0!==this.curOrbit.zoomFactor?this.curOrbit.zoomFactor=e:void 0!==this.curOrbit.zoomSpeed&&(this.curOrbit.zoomSpeed=e)},get:function(){return void 0!==this.curOrbit.zoomFactor?this.curOrbit.zoomFactor:void 0!==this.curOrbit.zoomSpeed?this.curOrbit.zoomSpeed:1}},{key:"distanceLimited",set:function(e){this.curOrbit.minDistance=e[0],this.curOrbit.maxDistance=e[1]},get:function(){return[this.curOrbit.minDistance,this.curOrbit.maxDistance]}},{key:"xAngleLimitRange",set:function(e){var t=90-e[0],n=90-e[1];this.curOrbit.minPolarAngle=THING.Math.degToRad(Math.min(t,n)),this.curOrbit.maxPolarAngle=THING.Math.degToRad(Math.max(t,n))},get:function(){var e=function(e){return 90-THING.Math.radToDeg(e)},t=e(this.curOrbit.minPolarAngle),n=e(this.curOrbit.maxPolarAngle);return[Math.min(t,n),Math.max(t,n)]}},{key:"yAngleLimitRange",set:function(e){this.curOrbit.minAzimuthAngle=THING.Math.degToRad(e[0]),this.curOrbit.maxAzimuthAngle=THING.Math.degToRad(e[1])},get:function(){return[THING.Math.radToDeg(this.curOrbit.minAzimuthAngle),THING.Math.radToDeg(this.curOrbit.maxAzimuthAngle)]}},{key:"keyPanSpeed",set:function(e){this.curOrbit.keyPanSpeed=e},get:function(){return this.curOrbit.keyPanSpeed}},{key:"mousePanSpeed",set:function(e){this.curOrbit.panSpeed=e},get:function(){return this.curOrbit.panSpeed}},{key:"distance",set:function(e){this.cameraObject.distance=e},get:function(){return this.cameraObject.distance}},{key:"direction",get:function(){return this.cameraObject.direction}},{key:"rightDirection",get:function(){return this.cameraObject.rightDirection}},{key:"up",set:function(e){this.cameraObject.up=e},get:function(){return this.cameraObject.up}},{key:"position",set:function(e){e&&(this.cameraObject.position=e)},get:function(){return this.cameraObject.position}},{key:"target",set:function(e){e&&(this.cameraObject.target=e)},get:function(){return this.cameraObject.target}},{key:"inputEnabled",set:function(e){this._inputEnableFlag.enable(e)},get:function(){return this._inputEnableFlag.isEnable()}},{key:"enableRotate",set:function(e){this._rotateEnableFlag.enable(e)},get:function(){return this._rotateEnableFlag.isEnable()}},{key:"enableZoom",set:function(e){this._zoomEnableFlag.enable(e)},get:function(){return this._zoomEnableFlag.isEnable()}},{key:"enablePan",set:function(e){this._panEnableFlag.enable(e)},get:function(){return this._panEnableFlag.isEnable()}},{key:"flying",get:function(){return this.cameraObject.flying}},{key:"mode",set:function(e){this.mode!=e&&(this.curOrbit.enabled=!1,"earth"==e?(this.curOrbit=new THREE.EarthOrbitControls(this.app.renderCamera,this.app.mainDomElement),this.curOrbit.app=this.app,this.initOrbit(this.curOrbit),this.autoAdjustNear=!1):(this.curOrbit.dispose(),this.curOrbit=this.orbit,this.curOrbit.enabled=!0,this.autoAdjustNear=!0),this.cameraObject.controller=this.curOrbit)},get:function(){return this.curOrbit instanceof THREE.EarthOrbitControls?"earth":"normal"}},{key:"degreeToWorldYAxis",get:function(){var e=Ne.parseVector3(this.direction),t=new THREE.Vector3(0,-1,0),n=e.dot(t);return THING.Math.radToDeg(Math.acos(n))}},{key:"autoAdjustNear",set:function(e){this._autoAdjustNear=e,e||(this.cameraObject.near=this.cameraObject._near)},get:function(){return this._autoAdjustNear}},{key:"autoAdjustTarget",set:function(e){this._autoAdjustTarget=e},get:function(){return this._autoAdjustTarget}},{key:"enableUpdateTargetOnWheel",set:function(e){this._enableUpdateTargetOnWheel=e},get:function(){return this._enableUpdateTargetOnWheel}},{key:"enableZoomOnTarget",set:function(e){if("earth"==this.mode)this.curOrbit.enableZoomOnTarget=e,this.curOrbit._keepTarget=!e;else{var t=this;this._enableZoomOnTarget=e,this.inputEnabled=!e,e?(this.app.on("mousewheel",(function(e){t._inputEnableFlag.unlock("enableZoomOnTarget"),t._processWheelOnMouseTarget(e)}),"_processWheelOnMouseTarget_"),this.app.on("mousedown",(function(e){t._inputEnableFlag.lock(!0,"enableZoomOnTarget")}),"_processWheelOnMouseTarget_mousedown")):(this.app.off("mousewheel",null,"_processWheelOnMouseTarget_"),this.app.off("mousedown",null,"_processWheelOnMouseTarget_mousedown"))}},get:function(){return"earth"==this.mode?this.curOrbit.enableZoomOnTarget:this._enableZoomOnTarget}},{key:"wheelOnMouseTargetScale",set:function(e){this._wheelOnMouseTargetScale=e},get:function(){return this._wheelOnMouseTargetScale}},{key:"autoFixCameraUp",set:function(e){this._autoFixCameraUp=e},get:function(){return this._autoFixCameraUp}},{key:"autoHideObjectsWhenRotatingFunc",set:function(e){if(this._autoHideObjectsWhenRotatingFunc=e,this.app.off("cameraControllerChangeStart",null,"__autoHideObjectsWhenRotatingFunc__start__"),this.app.off("cameraControllerChangeEnd",null,"__autoHideObjectsWhenRotatingFunc__end__"),this._autoHideObjectsWhenRotatingFunc){if(!Ne.isFunction(this._autoHideObjectsWhenRotatingFunc))return;var t=this;this.app.on("cameraControllerChangeStart",(function(e){t.app.query(".Thing").forEach((function(e){if(t._autoHideObjectsWhenRotatingFunc&&!1===t._autoHideObjectsWhenRotatingFunc(e)&&e.visible){e._prevVisible_auto_hide=!0;var n=app.modelResource.get(e.url);n&&n.loadingBox?(e.changeAppearance(n.loadingBox.clone()),e._needRevertAppearance_auto_hide=!0):e.visible=!1}}))}),"__autoHideObjectsWhenRotatingFunc__start__"),this.app.on("cameraControllerChangeEnd",(function(e){t.app.query(".Thing").forEach((function(e){e._prevVisible_auto_hide&&(e._needRevertAppearance_auto_hide?(e.changeAppearance(null),delete e._needRevertAppearance_auto_hide):e.visible=!0,delete e._prevVisible_auto_hide)}))}),"__autoHideObjectsWhenRotatingFunc__end__")}},get:function(){return this._autoHideObjectsWhenRotatingFunc}},{key:"mouseButtons",set:function(e){var t=function(e,t){var n={left:THREE.MOUSE.LEFT,middle:THREE.MOUSE.MIDDLE,right:THREE.MOUSE.RIGHT};return Ne.parseValue(n[e],t)};e=e||{};var n=this.curOrbit.mouseButtons,i=t(e.left,Ne.parseValue(n.LEFT,n.ORBIT)),r=t(e.middle,Ne.parseValue(n.MIDDLE,n.ZOOM)),o=t(e.right,Ne.parseValue(n.RIGHT,n.PAN));"normal"==this.mode?this.curOrbit.mouseButtons={LEFT:i,MIDDLE:r,RIGHT:o}:"earth"==this.mode&&(this.curOrbit.mouseButtons={ORBIT:i,ZOOM:r,PAN:o})},get:function(){var e=function(e){return["left","middle","right"][e]},t=this.curOrbit.mouseButtons;return{left:e(Ne.parseValue(t.LEFT,t.ORBIT)),middle:e(Ne.parseValue(t.MIDDLE,t.ZOOM)),right:e(Ne.parseValue(t.RIGHT,t.PAN))}}},{key:"options",set:function(e){var t=this.options;Ne.mergeObject(t,e,!0),this.mouseButtons={left:t.rotationKey,middle:t.zoomKey,right:t.moveKey},"normal"==this.mode?(this.enableZoomOnTarget=t.enableZoomOnTarget,this.enableUpdateTargetOnWheel=t.enableUpdateTargetOnWheel):"earth"==this.mode&&this.curOrbit.setOptions(t)},get:function(){var e={rotationKey:this.mouseButtons.left,zoomKey:this.mouseButtons.middle,moveKey:this.mouseButtons.right};return"normal"==this.mode?(e.enableZoomOnTarget=this.enableZoomOnTarget,e.enableUpdateTargetOnWheel=this.enableUpdateTargetOnWheel):"earth"==this.mode&&Ne.mergeObject(e,this.curOrbit.getOptions(e)),e}},{key:"toggle3D",set:function(e){console.warn("[CameraController] Please use '.viewMode=THING.CameraView.Normal/TopView' to replace '.toggle3D'"),this.viewMode=e?T.Normal:T.TopView},get:function(){return console.warn("[CameraController] Please use '.viewMode == THING.CameraView.Normal' to replace '.toggle3D'"),this.viewMode==T.Normal}},{key:"enabled",set:function(e){console.warn("[CameraController] Please use '.inputEnabled' to replace '.enabled'"),this.inputEnabled=e},get:function(){return console.warn("[CameraController] Please use '.inputEnabled' to replace '.enabled'"),this.inputEnabled}},{key:"minZoom",set:function(e){console.warn("[CameraController] Please use '.zoomLimited=[min, max]' to replace '.minZoom'"),this.zoomLimited=[e,this.zoomLimited[1]]},get:function(){return console.warn("[CameraController] Please use '.zoomLimited[0]' to replace '.minZoom'"),this.zoomLimited[0]}},{key:"maxZoom",set:function(e){console.warn("[CameraController] Please use '.zoomLimited=[min, max]' to replace '.maxZoom'"),this.zoomLimited=[this.zoomLimited[0],e]},get:function(){return console.warn("[CameraController] Please use '.zoomLimited[0]' to replace '.maxZoom'"),this.zoomLimited[1]}},{key:"minDistance",set:function(e){console.warn("[CameraController] Please use '.distanceLimited=[min, max]' to replace '.minDistance'"),this.distanceLimited=[e,this.distanceLimited[1]]},get:function(){return console.warn("[CameraController] Please use '.distanceLimited[0]' to replace '.minDistance'"),this.distanceLimited[0]}},{key:"maxDistance",set:function(e){console.warn("[CameraController] Please use '.distanceLimited=[min, max]' to replace '.maxDistance'"),this.distanceLimited=[this.distanceLimited[0],e]},get:function(){return console.warn("[CameraController] Please use '.distanceLimited[0]' to replace '.maxDistance'"),this.distanceLimited[1]}},{key:"minPolarAngle",set:function(e){console.warn("[CameraController] Please use '.verticalAngleLimited=[min, max]' to replace '.minPolarAngle'"),this.verticalAngleLimited=[e,this.verticalAngleLimited[1]]},get:function(){return console.warn("[CameraController] Please use '.verticalAngleLimited[0]' to replace '.minPolarAngle'"),this.verticalAngleLimited[0]}},{key:"maxPolarAngle",set:function(e){console.warn("[CameraController] Please use '.verticalAngleLimited=[min, max]' to replace '.maxPolarAngle'"),this.verticalAngleLimited=[this.verticalAngleLimited[0],e]},get:function(){return console.warn("[CameraController] Please use '.verticalAngleLimited[0]' to replace '.maxPolarAngle'"),this.verticalAngleLimited[1]}},{key:"minAzimuthAngle",set:function(e){console.warn("[CameraController] Please use '.horizontalAngleLimited=[min, max]' to replace '.minAzimuthAngle'"),this.horizontalAngleLimited=[e,this.horizontalAngleLimited[1]]},get:function(){return console.warn("[CameraController] Please use '.horizontalAngleLimited[0]' to replace '.minAzimuthAngle'"),this.horizontalAngleLimited[0]}},{key:"maxAzimuthAngle",set:function(e){console.warn("[CameraController] Please use '.horizontalAngleLimited=[min, max]' to replace '.maxAzimuthAngle'"),this.horizontalAngleLimited=[this.horizontalAngleLimited[0],e]},get:function(){return console.warn("[CameraController] Please use '.horizontalAngleLimited[0]' to replace '.maxAzimuthAngle'"),this.horizontalAngleLimited[1]}},{key:"verticalAngleLimited",set:function(e){console.warn("[CameraController] Please use '.xAngleLimited' to replace '.verticalAngleLimited'"),this.xAngleLimited=e},get:function(){return console.warn("[CameraController] Please use '.xAngleLimited' to replace '.verticalAngleLimited'"),this.xAngleLimited}},{key:"horizontalAngleLimited",set:function(e){console.warn("[CameraController] Please use '.yAngleLimited' to replace '.verticalAngleLimited'"),this.yAngleLimited=e},get:function(){return console.warn("[CameraController] Please use '.yAngleLimited' to replace '.verticalAngleLimited'"),this.yAngleLimited}},{key:"yAngleLimited",set:function(e){console.warn("[CameraController] Please use '.xAngleLimitRange' to replace '.yAngleLimited'"),this.xAngleLimitRange=e},get:function(){return console.warn("[CameraController] Please use '.xAngleLimitRange' to replace '.yAngleLimited'"),this.xAngleLimitRange}},{key:"xAngleLimited",set:function(e){console.warn("[CameraController] Please use '.yAngleLimitRange' to replace '.xAngleLimited'"),this.yAngleLimitRange=e},get:function(){return console.warn("[CameraController] Please use '.yAngleLimitRange' to replace '.xAngleLimited'"),this.yAngleLimitRange}},{key:"rotating",get:function(){return console.warn("[CameraController] Please use '.flying' to replace '.rotating'"),this.flying}},{key:"panSpeed",set:function(e){console.warn("[CameraController] Please use '.keyPanSpeed' to replace '.panSpeed'"),this.keyPanSpeed=e},get:function(){return console.warn("[CameraController] Please use '.keyPanSpeed' to replace '.panSpeed'"),this.keyPanSpeed}},{key:"enableUpdateTargetByMove",set:function(e){},get:function(){return!0}}]),e}(),su=function(){function e(t){r(this,e),this.app=t,this._previous=null,this._current=null,this._root=null,this._changed=!1,this._options={flyTime:1e3,outlineColor:16744448,autoChangeBackground:!0,autoBakeFloor:!0,autoHideFloorObjects:!0,autoEnterSubLevel:!0,autoBackFromSubLevel:!0}}return e.prototype.init=function(){this._root=this.app.root},e.prototype.buildState=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var n={};n.name=t+"Level";var i=[];e instanceof Br?(i.push("floor"),i.push("_floor")):e instanceof ma&&(i.push("building"),i.push("_building"));for(var r=0;r<i.length;r++)n[i[r]]=e;return n},e.prototype.buildAfterEnterState=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var n=this.previous?this.previous.type:"";"Campus"==n&&(n="Outdoors");var i={prevState:{name:n+"Level"},state:this.buildState(e),stateName:t+"Level"};return this.previous&&(this.previous instanceof ma?(i.prevState.building=this.previous,i.prevState._building=this.previous):this.previous instanceof Br&&(i.prevState.floor=this.previous,i.prevState._floor=this.previous)),i},e.prototype.buildBeforeEnterState=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var n=this.current?this.current.type:"";"Campus"==n&&(n="Outdoors");var i={prevState:{name:n+"Level"},curState:this.buildState(e),stateName:t+"Level"};return this.previous&&(this.previous instanceof ma?(i.prevState.building=this.previous,i.prevState._building=this.previous):this.previous instanceof Br&&(i.prevState.floor=this.previous,i.prevState._floor=this.previous)),i},e.prototype.getEventType=function(e,t){var n=t.type;return"Campus"==n&&(n="Outdoors"),e+n+"Level"},e.prototype.buildEventArguments=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var n={name:t+"Level"};return n.state=this.buildState(e),n},e.prototype.notifyBeforeEnterState=function(e){this.app.trigger("beforeEnterState",this.buildBeforeEnterState(e))},e.prototype.notifyAfterEnterState=function(e){this.app.trigger("afterEnterState",this.buildAfterEnterState(e))},e.prototype.nofityAfterLevelChange=function(e){var t=e.object;this.app.trigger(this.getEventType("enter",t),this.buildEventArguments(t)),this.app.trigger(this.getEventType("afterEnter",t),this.buildEventArguments(t))},e.prototype.notifyBeforeLevelChange=function(e){this.app.trigger(this.getEventType("beforeEnter",e),this.buildEventArguments(e))},e.prototype._getLevelType=function(){var e=this._current;return e?e.type:""},e.prototype._leaveLevel=function(e,t){if(this.app.trigger(O.BeforeLevelChange,{level:this._getLevelType(),current:this._current,previous:this._previous,next:e}),this._current){var n=Ne.cloneObject(t);n.level=this._getLevelType(),n.object=e,n.current=e,n.previous=this._current,this._current.trigger(O.LevelChange,n),this._current.trigger(O.LeaveLevel,n),this.app.trigger(O.LeaveLevel,n)}e&&(this.notifyBeforeLevelChange(e),this.notifyBeforeEnterState(e))},e.prototype._notifyEnterLevel=function(e,t){t.object=e,this.app.trigger(O.EnterLevel,t),this.nofityAfterLevelChange(t)},e.prototype._enterLevel=function(e,t){var n=this;if(this._changed=!0,this._previous=this._current,this._current=e,t.level=this._getLevelType(),t.current=this._current,t.object=this._current,t.previous=this._previous,this.app.trigger(O.LevelChange,t),e){var i=t.lastObject;i.internalUserData.level_complete||(i.internalUserData.level_complete=!0,i.one(O.EnterLevel,(function(e){delete e.object.internalUserData.level_complete;var r=t.userComplete;r&&r(),i.one("cameraFlyComplete",{lastLevelChanged:!0},(function(e){if(e.data.lastLevelChanged&&e.object==i){var r=t.flyComplete;r&&r()}var o=e.object.isPauseEvent(THING.EventType.EnterLevel,THING.EventTag.LevelFly),a=e.object.isPauseEvent(THING.EventType.EnterLevel,THING.EventTag.LevelCustomFly,!0);o&&a||(e.object.trigger(O.LevelFlyEnd,{level:n._getLevelType(),object:e.object,current:e.object,previous:n.previous}),n.app.trigger(O.LevelFlyEnd,{level:n._getLevelType(),object:e.object,current:e.object,previous:n.previous}))}),"___level_camera_fly_complete___")}),"___level_complete___")),e.trigger(O.LevelChange,t),this.notifyAfterEnterState(e);var r=e.isPauseEvent(O.EnterLevel,j.LevelFly),o=e.hasEvent(O.EnterLevel,j.LevelFly);if(t.jumping||r||!o){e.pauseEvent(O.EnterLevel,null,j.LevelFly),e.trigger(O.EnterLevel,t),e.resumeEvent(O.EnterLevel,null,j.LevelFly),this._notifyEnterLevel(e,t),t.jumping||r?this.jumpLevelPath(t):this.app.one("cameraFlyComplete",(function(e){n.jumpLevelPath(t)}),"sceneLevel_cameraFlyComplete");var a=t.complete;a&&a()}else this.app.one("cameraFlyComplete",(function(e){n.jumpLevelPath(t)}),"sceneLevel_cameraFlyComplete"),e.trigger(O.EnterLevel,t),this._notifyEnterLevel(e,t)}},e.prototype._change=function(e,t){t=t||{};var n=this;this.app.camera.toggleNormalViewMode((function(){n._change(e,t)}))||("Outdoors"==e.type&&(console.warn("Please use campus to change, not outdoors"),e=e.parents.query(".Campus")[0]),e.isPauseEvent(O.EnterLevel)||(this._leaveLevel(e,t),this._enterLevel(e,t)))},e.prototype.updateJumping=function(e,t){var n=this._current;n&&(n.isChildOf(e)||n.isBrotherOf(e))&&(t.jumping=!0,t.skipBackupCameraInfo=!0)},e.prototype.getParents=function(e,t){for(var n=[],i=e.parents,r=0;r<i.length;r++){var o=i[r];if(o==this.app.root)break;if(n.push(o),o==t)break}return n},e.prototype.getLevelPath=function(e,t){if(Ne.parseValue(this.options.autoEnterSubLevel,t.autoEnterSubLevel)){for(var n=e.children.concat(),i=0;i<n.length;i++){n[i].isFloor||n.splice(i--,1)}1===n.length&&(e=n[0])}var r=[];if(this._current==e)r=[e];else if(this._current)if(this._current.isChildOf(e))(r=this.getParents(this._current,e)).length>=2&&(t.jumping=!0);else if(e.isChildOf(this._current))(r=(r=this.getParents(e,this._current)).reverse()).splice(0,1),r.push(e);else if(e.parent==this._current.parent)r=e.parent?[e.parent,e]:[e];else{var o=this.getParents(e,null).reverse(),a=this.getParents(this._current).reverse();if(o.length&&a.length){for(var s;o.length&&a.length&&o[0]==a[0];)s=o[0],o.splice(0,1),a.splice(0,1);s&&(r=a.reverse().concat([s]).concat(o).concat(e))}else r=o.concat([e])}else r.push(e),r=(r=r.concat(e.parents.not(this.app.root).toArray())).reverse();if(function(e){for(var t=0;t<e.length;t++)if(e[t].isFacade)return!0;return!1}(r))for(i=0;i<r.length;i++)r[i].isBuilding&&r.splice(i,1);return r},e.prototype.jumpLevelPath=function(e){var t=e.levelPath;if(t&&(t.splice(0,1),t.length)){var n=t[0];1==t.length&&(delete e.jumping,this.app.off("cameraFlyComplete","sceneLevel_cameraFlyComplete")),this._change(n,e)}},e.prototype.change=function(e,t){if(t=t||{},e){if(!e.isPauseEvent(O.EnterLevel)&&e.hasEvent(O.EnterLevel)&&(Ne.parseValue(t.autoChangeObject,!0)&&e instanceof $t&&(e=e.building),!t.skipCurrentLevel||e!=this._current)){var n=this.getLevelPath(e,t);if(n.length){var i=n[0],r=n.length>1?n[n.length-1]:null;r&&this.updateJumping(r,t),this.app.off("cameraFlyComplete",null,"sceneLevel_cameraFlyComplete"),t.userComplete=t.complete,t.userFlyComplete=t.flyComplete,t.levelPath=n,t.lastObject=r||e,this._change(i,t)}}}else console.error("Please provide the object to change")},e.prototype.quit=function(e){e=e||{},this._current&&(this._leaveLevel(null,e),this._enterLevel(null,e))},e.prototype.back=function(e){if(e=e||{},this._current){var t=this._current.parent;if(Ne.parseValue(this.options.autoBackFromSubLevel,e.autoBackFromSubLevel))for(;t&&t.parent&&!t.isCampus;){for(var n=t.children.concat(),i=0;i<n.length;i++)n[i].isFacade&&n.splice(i--,1);if(1!==n.length)break;t=t.parent}this.backTo(t)}},e.prototype.backTo=function(e){if(e&&e!=this._current&&e.isChildOf(this._root)){e.isFacade&&(e=e.parents.query(".Campus")[0]);var t=this;this.app.camera.toggleNormalViewMode((function(){t.backTo(e)}))||this.change(e,{autoChangeObject:!1})}},e.prototype.isChanged=function(){return this._changed},e.prototype.onUpdate=function(e){this._changed&&(this._changed=!1)},o(e,[{key:"current",get:function(){return this._current}},{key:"previous",get:function(){return this._previous}},{key:"root",set:function(e){this._root=e},get:function(){return this._root}},{key:"options",set:function(e){this._options=Ne.mergeObject(this._options,e,!0)},get:function(){return this._options}}]),e}(),lu=function(){function e(t){r(this,e),this.app=t,this._backups={camera:{},lighting:{},postEffect:{}},this._campusSkyBox=null,this._campusBackground=null,this._campusSkyBoxColorTween=null,this._levelChanging=!1,this._lastPickedObject=null}return e.prototype.setCampusSkyBoxColorScaleFactor=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this._campusSkyBoxColorTween&&this._campusSkyBoxColorTween.stop();var n=Ne.parseVector3(this.app.backgroundColorScaleFactor),i=Ne.parseVector3(e),r=this;this._campusSkyBoxColorTween=new TWEEN.Tween(n).to(i,t).onUpdate((function(){r.app.backgroundColorScaleFactor=[this._object.x,this._object.y,this._object.z]})),this._campusSkyBoxColorTween.start()},e.prototype.updatebackupInfo=function(e,t){var n=this._backups[e];n[t]=n[t]||{};var i=n[t];"camera"==e?(i.position=this.app.camera.position,i.target=this.app.camera.target):"lighting"==e?i.value=this.app.lighting:"postEffect"==e&&(i.value=this.app.postEffect)},e.prototype.clearBackupInfo=function(e,t){delete this._backups[e][t]},e.prototype.getBackupInfoValue=function(e,t,n){var i=this._backups[e][t];return i?i[n]:null},e.prototype.initAppEvents=function(){var e=this;this.app.on("cameracontrollerchanged",(function(t){e.app.level.current&&e._levelChanging&&e.app.camera.stopFlying()}),j.LevelFlyBreak),this.app.on("dblclick",(function(t){if(0==t.button){var n=e.app.level,i=n.current;if(i){var r=t.object;if(r!=i&&function(e){return!!e&&(!e.isTextRegion&&!e.isMarker)}(r)){if(r.isGround)return;var o=!1;r.isBuilding&&(o=!0),n.change(r,{autoEnterSubLevel:o})}}}}),j.LevelEnterOperation),this.app.on("click",(function(t){if(2==t.button){var n=e.app.level;if(n.current){var i=t.object;i&&(i.style.outlineColor=null);var r=!1;n.current.isFloor&&(r=!0),n.back({autoBackFromSubLevel:r})}}}),j.LevelBackOperation);this.app.on(O.Pick,(function(t){var n=e.app.level;if(n.current){e._lastPickedObject&&(e._lastPickedObject.style.outlineColor=null);var i=t.object;(function(t){var n=e.app.level.current;return!(!n||!t||t==n||"Ground"==t.type||t.isMarker||n.isCampus&&t.isChildOf(n.ground))})(i)&&(i.style.outlineColor=n.options.outlineColor),e._lastPickedObject=i}}),j.LevelPickOperation),this._campusSkyBox=this.app.skyBox,this._campusBackground=this.app.background,this.app.on("skyboxchange",(function(t){var n=e.app.level.current;n&&!n.isCampus||(e._campusSkyBox=t.skyBox)}))},e.prototype.buildFlyParams=function(e,t){t=t||{};var n=this,i=this.app.level.options;e._flyStart=function(){n._levelChanging=!0},e._flying=function(){n._levelChanging=!0},e._flyStop=function(){n._levelChanging=!1},e._flyComplete=function(){n._levelChanging=!1},e.distance=e.distance||t.distance,e.time=Ne.parseValue(e.time||t.time,i.flyTime),e.keepDirection=Ne.parseValue(e.keepDirection||t.keepDirection,!1);var r=this.app.level.current;if(t.lastObject==r&&(e.offset=e.offset||t.offset,e.worldOffset=e.worldOffset||t.worldOffset,e.xAngle=Ne.parseValue(e.xAngle||t.xAngle,null),e.yAngle=Ne.parseValue(e.yAngle||t.yAngle,null),void 0===e.radius))if(void 0!==t.radius)e.radius=t.radius;else{var o=e.boundingBox||r.boundingBox;e.radius=o.radius}e.targetForFlyComplete=r;var a=r.userData.camInfo;if(a){var s=r.parents.query(".Campus")[0];s&&(e.target=s.selfToWorld(a.target),e.position=s.selfToWorld(a.eye))}return e},e.prototype.registerSceneLevelEvents=function(){var e=this;this.app.on(O.EnterLevel,".BaseObject",(function(t){e.onBaseObjectLevelSceneOperations(t)}),j.LevelSceneOperations),this.app.on(O.EnterLevel,".Campus",(function(t){e.onCampusLevelSetBackground(t)}),j.LevelSetBackground),this.app.on(O.EnterLevel,".Campus",(function(t){e.onCampusLevelSetEffect(t)}),j.LevelSetEffect),this.app.on(O.EnterLevel,".Campus",(function(t){e.onCampusLevelSceneOperations(t)}),j.LevelSceneOperations),this.app.on(O.EnterLevel,".Campus",(function(t){e.onCampusLevelPickedResultFunc(t)}),j.LevelPickedResultFunc),this.app.on(O.EnterLevel,".Campus",(function(t){e.onCampusLevelFly(t)}),j.LevelFly),this.app.on(O.LeaveLevel,".Campus",(function(t){e.onCampusLevelLeaveSceneOperations(t)}),j.LevelSceneOperations),this.app.on(O.EnterLevel,".Facade",(function(t){e.onFacadeLevelSetBackground(t)}),j.LevelSetBackground),this.app.on(O.EnterLevel,".Facade",(function(t){e.onFacadeLevelSetEffect(t)}),j.LevelSetEffect),this.app.on(O.EnterLevel,".Facade",(function(t){e.onFacadeLevelSceneOperations(t)}),j.LevelSceneOperations),this.app.on(O.EnterLevel,".Facade",(function(t){e.onFacadeLevelPickedResultFunc(t)}),j.LevelPickedResultFunc),this.app.on(O.EnterLevel,".Facade",(function(t){e.onFacadeLevelFly(t)}),j.LevelFly),this.app.on(O.LeaveLevel,".Facade",(function(t){e.onFacadeLevelLeaveSceneOperations(t)}),j.LevelSceneOperations),this.app.on(O.EnterLevel,".Building",(function(t){e.onBuildingLevelSetBackground(t)}),j.LevelSetBackground),this.app.on(O.EnterLevel,".Building",(function(t){e.onBuildingLevelSetEffect(t)}),j.LevelSetEffect),this.app.on(O.EnterLevel,".Building",(function(t){e.onBuildingLevelSceneOperations(t)}),j.LevelSceneOperations),this.app.on(O.EnterLevel,".Building",(function(t){e.onBuildingLevelPickedResultFunc(t)}),j.LevelPickedResultFunc),this.app.on(O.EnterLevel,".Building",(function(t){e.onBuildingLevelFly(t)}),j.LevelFly),this.app.on(O.LeaveLevel,".Building",(function(t){e.onBuildingLevelLeaveSceneOperations(t)}),j.LevelSceneOperations),this.app.on(O.EnterLevel,".Floor",(function(t){e.onFloorLevelSetBackground(t)}),j.LevelSetBackground),this.app.on(O.EnterLevel,".Floor",(function(t){e.onFloorLevelSetEffect(t)}),j.LevelSetEffect),this.app.on(O.EnterLevel,".Floor",(function(t){e.onFloorLevelSceneOperations(t)}),j.LevelSceneOperations),this.app.on(O.EnterLevel,".Floor",(function(t){e.onFloorLevelPickedResultFunc(t)}),j.LevelPickedResultFunc),this.app.on(O.EnterLevel,".Floor",(function(t){e.onFloorLevelFly(t)}),j.LevelFly),this.app.on(O.LeaveLevel,".Floor",(function(t){e.onFloorLevelLeaveSceneOperations(t)}),j.LevelSceneOperations),this.app.on(O.EnterLevel,".Room",(function(t){e.onRoomLevelSceneOperations(t)}),j.LevelSceneOperations),this.app.on(O.EnterLevel,".Room",(function(t){e.onRoomLevelPickedResultFunc(t)}),j.LevelPickedResultFunc),this.app.on(O.EnterLevel,".Room",(function(t){e.onRoomLevelFly(t)}),j.LevelFly),this.app.on(O.LeaveLevel,".Room",(function(t){e.onRoomLevelLeaveSceneOperations(t)}),j.LevelSceneOperations),this.app.on(O.EnterLevel,".Thing",(function(t){e.onThingLevelSceneOperations(t)}),j.LevelSceneOperations),this.app.on(O.EnterLevel,".Thing",(function(t){e.onThingLevelPickedResultFunc(t)}),j.LevelPickedResultFunc),this.app.on(O.EnterLevel,".Thing",(function(t){e.onThingLevelFly(t)}),j.LevelFly),this.app.on(O.LeaveLevel,".Thing",(function(t){e.onThingLevelLeaveSceneOperations(t)}),j.LevelSceneOperations)},e.prototype.onBaseObjectLevelSceneOperations=function(e){},e.prototype.onCampusLevelSetBackground=function(e){this.app.level.options.autoChangeBackground&&(this._campusSkyBox?(this.app.skyBox=this._campusSkyBox,this.setCampusSkyBoxColorScaleFactor([1,1,1])):this._campusBackground&&(this.app.background=this._campusBackground))},e.prototype.onCampusLevelSetEffect=function(e){},e.prototype.onCampusLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.visible=!0,t.ground&&(t.ground.visible=!0);for(var n=t.children,i=0;i<n.length;i++)n[i].visible=!0;var r=t.buildings;for(i=0;i<r.length;i++){var o=r[i];o.visible=!0,o.children.forEach((function(e){e.visible=!1}));var a=o.floors,s=o.facades;o.hasFacades()?o.structShow?(s.visible=!0,a.visible=!0):(s.visible=!0,a.visible=!1,o.showAllRoofs(!1)):(a.visible=!0,o.showAllRoofs(!0)),t.app.level.options.autoHideFloorObjects&&a.forEach((function(e){if(!e.showObjectsInParentLevels){o.hasFacades()&&!o.structShow?e.children.forEach((function(e){e.visible=!1})):e.children.forEach((function(e){e.isRoom||e.isDoor||e.isWindow||e.isCombinedObject||(e.visible=!1)}));if(!o.hasFacades()||o.structShow){var t=e.misc;t&&(t.visible=!0,t.node.traverse((function(t){t!=e.misc.node&&(!function(t){for(;t&&t!=e.misc.node;){if(t.isDoorOrWin)return!0;t=t.parent}return!1}(t)?t.visible=!1:t.visible=!0)})))}}}))}},e.prototype.onCampusLevelPickedResultFunc=function(e){function t(e){return"Outdoors"!=e.type&&!!function(e){var t=e.app.level.current;if(!t)return!0;if(e.isWebView)return!0;if(e.isMarker)return!0;if(e.parent==t){if(e.isGround)return!0;if(e.isBuilding)return!0;if(e.isThing)return!0}return!!e.isChildOf(t.ground)}(e)}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var n=e.parents,i=0;i<n.length;i++){var r=n[i];if(t(r))return r}}},e.prototype.onCampusLevelFly=function(e){var t,n,i=e.object,r=e.previous;r&&!r.isCampus&&r.isChildOf(i)||this.clearBackupInfo("camera","Campus");var o=i.sceneJSONData.camInfo;o&&(t=o.eye.concat(),n=o.target.concat(),t=i.selfToWorld(t),n=i.selfToWorld(n));var a=e.position||this.getBackupInfoValue("camera","Campus","position")||t,s=e.target||this.getBackupInfoValue("camera","Campus","target")||n||i,l=0;Ne.isArray(a)&&Ne.isArray(s)||(l=e.radius||Math.min(i.boundingBox.radius,300)),this.app.camera.flyTo(this.buildFlyParams({position:a,target:s,radius:l},e))},e.prototype.onCampusLevelLeaveSceneOperations=function(e){var t=e.current;if(t){var n=e.object;if(t.isChildOf(n)){if(t.isCampus);else if(n.parents.has(t));else if(!n.things.has(t)){n.ground&&(n.ground.visible=!1);for(var i=0;i<n.children.length;i++){var r=n.children[i];r!=e.current&&(r.visible=!1)}if(t.isThing){var o=n.ground;o&&(o.visible=!1)}}e.skipBackupCameraInfo||this.updatebackupInfo("camera","Campus"),this.updatebackupInfo("lighting","Campus"),this.updatebackupInfo("postEffect","Campus")}}},e.prototype.onFacadeLevelSetBackground=function(e){},e.prototype.onFacadeLevelSetEffect=function(e){},e.prototype.onFacadeLevelSceneOperations=function(e){var t=e.object;t.visible=!0,t.children.forEach((function(e){e.visible=!0}))},e.prototype.onFacadeLevelPickedResultFunc=function(e){function t(e){var t=e.app.level.current;return!t||(t==e||!!e.isChildOf(t))}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var n=e.parents,i=0;i<n.length;i++){var r=n[i];if(t(r))return r}}},e.prototype.onFacadeLevelFly=function(e){var t=e.object;this.app.camera.flyTo(this.buildFlyParams({target:t},e))},e.prototype.onFacadeLevelLeaveSceneOperations=function(e){},e.prototype.onBuildingLevelSetBackground=function(e){this.app.level.options.autoChangeBackground&&(this.app.background=null,this.app.skyBox="White",this.setCampusSkyBoxColorScaleFactor([.5,.5,.5]))},e.prototype.onBuildingLevelSetEffect=function(e){},e.prototype.onBuildingLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.visible=!0,t.children.forEach((function(e){e.visible=!0})),t.parents.query(".Campus")[0].buildings.not(t).visible=!1,t.facades.visible=!1;var n=t.floors;n.visible=!0;for(var i=0;i<n.length;i++){var r=n[i];if(t.app.level.options.autoHideFloorObjects){t.hasFacades()?r.children.forEach((function(e){e.visible=!0})):r.children.forEach((function(e){e.isRoom||e.isDoor||e.isWindow||(e.visible=!0)}));var o=r.misc;o&&o.node.traverse((function(e){e.ensureVisible(!0,!0)}))}r.showAllRoofs(!1),r.bake(null)}},e.prototype.onBuildingLevelPickedResultFunc=function(e){function t(e){var t=e.app.level.current;if(!t)return!0;if(t==e)return!0;if(e.isWebView)return!0;if(e.isMarker)return!0;if(e.parent==t){if(e.isThing)return!0;if(e.isFloor&&"Outdoors"!=e.type)return!0}return!1}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var n=e.parents,i=0;i<n.length;i++){var r=n[i];if(t(r))return r}}},e.prototype.onBuildingLevelFly=function(e){var t=e.object,n=t.floors,i=new THREE.Box3;n.forEach((function(e){var t=e.wall;t&&i._setFromObject(t.node,null,null,!1)}));var r=it._processBox(i,t);this.app.camera.flyTo(this.buildFlyParams({target:t,boundingBox:r,radius:r.radius},e))},e.prototype.onBuildingLevelLeaveSceneOperations=function(e){e.object.style.outlineColor=null,this.updatebackupInfo("lighting","Building"),this.updatebackupInfo("postEffect","Building")},e.prototype.onFloorLevelSetBackground=function(e){this.app.level.options.autoChangeBackground&&(this.app.skyBox="White",this.setCampusSkyBoxColorScaleFactor([.25,.25,.25]))},e.prototype.onFloorLevelSetEffect=function(e){},e.prototype.onFloorLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.building.floors.not(t).visible=!1,t.visible||(t.visible=!0,t.showAllRoofs(!1)),this.app.level.options.autoBakeFloor&&t.bake()},e.prototype.onFloorLevelPickedResultFunc=function(e){function t(e){var t=e.app.level.current;if(!t)return!0;if(t==e)return!0;if(e.isWebView)return!0;if(e.isMarker)return!0;if(e.parent==t){if(e.isRoom)return!0;if(e.isThing)return!0}return!1}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var n=e.parents,i=0;i<n.length;i++){var r=n[i];if(t(r))return r}}},e.prototype.onFloorLevelFly=function(e){var t=e.object,n=e.previous;if(n.isBuilding||n.isFloor)this.app.camera.flyTo(this.buildFlyParams({target:t},e)),this.clearBackupInfo("camera","Floor");else{var i=this.getBackupInfoValue("camera","Floor","position"),r=this.getBackupInfoValue("camera","Floor","target");this.app.camera.flyTo(this.buildFlyParams({position:i,target:r},e))}},e.prototype.onFloorLevelLeaveSceneOperations=function(e){e.object.style.outlineColor=null,this.updatebackupInfo("camera","Floor"),this.updatebackupInfo("lighting","Building"),this.updatebackupInfo("postEffect","Building")},e.prototype.onRoomLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null;for(var n=t.brothers.query(".Room"),i=0;i<n.length;i++){n[i].things.style.opacity=.25}},e.prototype.onRoomLevelPickedResultFunc=function(e){function t(e){var t=e.app.level.current;if(!t)return!0;if(e.isWebView)return!0;if(e.isMarker)return!0;if(e.isRoom&&e!=t)return!0;if(e.isChildOf(t)){if(e.parent==t)return!0}else if(e.isThing&&e.app.level.current.things.has(e))return!0;return!1}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var n=e.app.level.current,i=e.parents,r=0;r<i.length;r++){var o=i[r];if(o==n)break;if(t(o))return o}}},e.prototype.onRoomLevelFly=function(e){var t=e.object;if(e.previous.isFloor)this.app.camera.flyTo(this.buildFlyParams({target:t},e));else{var n=this.getBackupInfoValue("camera","Room","position"),i=this.getBackupInfoValue("camera","Room","target");this.app.camera.flyTo(this.buildFlyParams({position:n,target:i},e))}},e.prototype.onRoomLevelLeaveSceneOperations=function(e){var t=e.object;if(t.style.outlineColor=null,!e.lastObject.isChildOf(t))for(var n=t.brothers.query(".Room"),i=0;i<n.length;i++){n[i].things.style.opacity=null}this.updatebackupInfo("camera","Room")},e.prototype.onThingLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.brothers.query(".Thing").style.opacity=.25},e.prototype.onThingLevelPickedResultFunc=function(e){function t(e){var t=e.app.level.current;return!t||(!!e.isChildOf(t)||(!!e.isWebView||(!!e.isMarker||!(!e.isThing||!e.isBrotherOf(t)))))}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var n=e.parents,i=0;i<n.length;i++){var r=n[i];if(t(r))return r}}},e.prototype.onThingLevelFly=function(e){var t=e.object,n=Ne.parseValue(e.keepDirection,!0);this.app.camera.flyTo(this.buildFlyParams({target:t,keepDirection:n,centerPos:t.boundingBox.center},e))},e.prototype.onThingLevelLeaveSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.brothers.query(".Thing").style.opacity=null},e.prototype.init=function(){this.initAppEvents(),this.registerSceneLevelEvents()},e}(),uu=function(){function e(t){r(this,e),this.app=t,this._spriteMaterials={},this._meshMaterials={}}return e.prototype.getMaterial=function(e){var t,n=(e=e||{}).url,i=Ne.parseValue(e.useSpriteMaterial,!0);if(n){i?(this._spriteMaterials[n]||(this._spriteMaterials[n]=new THREE.SpriteMaterial({color:16777215,transparent:!0})),t=this._spriteMaterials[n]):(this._meshMaterials[n]||(this._meshMaterials[n]=new THREE.MeshBasicMaterial({transparent:!0,side:THREE.DoubleSide,depthWrite:!1})),t=this._meshMaterials[n]),t.refCount=t.refCount||1,e.skipRefCount||t.refCount++;var r=e.loadComplete,o=e.loadTextureComplete,a=!t.map||!t.map.image;if(a){var s=this.app.resourceManager.textureLoader;t.map=s.load(n,(function(e){e.refCount++,t.map=e,t.needsUpdate=!0,t.visible=!0,o&&o({material:t}),r&&r({material:t})}),(function(){}),(function(e){console.error('[Sprite] load "'+n+'" failed')}),!0),t.visible=!1}else r&&r({material:t})}else t=i?new THREE.SpriteMaterial({color:16777215,transparent:!0}):new THREE.MeshBasicMaterial({transparent:!0,side:THREE.DoubleSide,depthWrite:!1}),r&&r({material:t});return{material:t,needLoadTexture:a}},e.prototype.unloadMaterial=function(e){return!(!e||!this.app.resourceManager.disposeMaterial(e))},e.prototype.unloadMaterials=function(e,t){var n=t[e];this.unloadMaterial(n)&&delete t[e]},e.prototype.unload=function(e){this.unloadMaterials(e,this._spriteMaterials),this.unloadMaterials(e,this._meshMaterials)},e.prototype.onUpdate=function(e){},e}(),cu=function(){function e(t,n){r(this,e),this.app=t,this.modelResource=t.modelResource,this.refCount=1,this.URL=n,this._boundingBox=null,this._loadingBox=null,this._skinnedMeshes=[],this.node=null,this.animations=null,this.geometry=null,this.materials=null}return e.prototype._setupBoundingBox=function(){var e=(new THREE.Box3)._setFromObject(this.node),t=new THREE.Vector3;e.getCenter(t);var n=new THREE.Vector3;e.getSize(n),this._boundingBox={},this._boundingBox.center=t.toArray(),this._boundingBox.size=n.toArray(),this._boundingBox.radius=n.length()},e.prototype.load=function(e){var t=e.node,n=e.animations,i=e.geometry,r=e.materials;if(i)this.animations=i.animations,this.geometry=i,this.materials=r;else if(t){var o=this.node!=t;this.node=t,n?this.animations=n:(o||null===n)&&(this.animations=null)}this._skinnedMeshes=t.getSkinnedMeshes(),this._setupBoundingBox()},e.prototype.get=function(){return this.refCount++,this},e.prototype.unload=function(){return(0===this.refCount||(this.refCount--,!this.refCount))&&(!this.modelResource.residentMode&&(this.app.resourceManager.unload(this.node),this.app.resourceManager.unload(this._loadingBox),this.node=null,this.animations=null,this.geometry=null,this.materials=null,!0))},e.prototype._cloneNode=function(){if(this.node){var e=this.node.clone(),t=[];if(e.traverse((function(e){var n=e.geometry;n&&(n.refCount=n.refCount||1,n.refCount++),e.isSkinnedMesh&&t.push(e)})),this._skinnedMeshes.length)for(var n=this._skinnedMeshes,i=0;i<n.length;i++){var r=n[i],o=n[i].skeleton,a=e.getBones(this.node,n[i].skeleton),s=t[i],l=new THREE.Skeleton(a,o.boneInverses);s.bind(l,r.bindMatrix)}return e}if(this.geometry)return(s=new THREE.SkinnedMesh(this.geometry,this.materials)).scale.set(1,1,1),s},e.prototype.cloneNode=function(){var e=this._cloneNode(),t=function(e){e.refCount?e.refCount++:e.refCount=1};return e.traverseMaterials((function(e){for(var n in t(e),e){var i=e[n];i&&i.isTexture&&t(i)}})),e},o(e,[{key:"boundingBox",get:function(){return this._boundingBox||this._setupBoundingBox(),this._boundingBox}},{key:"loadingBox",get:function(){return this._loadingBox},set:function(e){this._loadingBox=e}}]),e}(),hu=function(){function e(t){r(this,e),this.app=t,this.isResidentMode=!1,this.models={},this.loadingModels={},this.waitModels=[]}return e.prototype.onBackgroundProgress=function(e){},e.prototype.get=function(e){var t=this.models[e];return t?t.get():null},e.prototype.set=function(e,t,n){var i=this.models[e];return i?i.unload():(i=new cu(this.app,e),this.models[e]=i),t&&n&&i.load({node:t,animations:n}),i},e.prototype.getBoundingBox=function(e){var t=this.models[e];return t?t.boundingBox:null},e.prototype.unload=function(e){if(void 0===e){for(var e in this.models)this.models[e].unload();return this.clear(),!0}if(Ne.isString(e)){var t=this.models[e];if(t&&t.unload())return delete this.models[e],!0}return!1},e.prototype.clear=function(e){Ne.isNull(e)?this.models={}:delete this.models[e]},e.prototype._download=function(e,t,n,i,r){var o=this.get(e);if(o)delete this.loadingModels[e],n&&n(o);else{var a=this;new thingjs.GLTFLoader(this.app.loadingManager).loadFromURL({url:e,useStaticImage:THING.useStaticImage,jsonCallback:function(e){t&&t(e)},modelCallback:function(t){var i=t.url,r=a.get(i);r||(r=a.set(i)).load(t),delete a.loadingModels[e],n&&(n(r)||a.unload(e))},errorCallback:function(t){if(delete a.loadingModels[e],t&&t.target&&201===t.target.status){var n=void 0;try{n=JSON.parse(t.target.response)}catch(e){console.error("Error!")}return console.error("[have no right] name: "+n.message+"\nurl: "+e),!0}if(r)return r(t)},progressCallback:i})}},e.prototype.download=function(e,t,n,i,r){this.loadingModels[e]?this.waitModels.push({url:e,jsonCallback:t,modelCallback:n,progressCallback:i,errorCallback:r}):(this.loadingModels[e]={},this._download(e,t,n,i,r))},e.prototype.preload=function(e,t){var n=(t=t||{}).complete;if(Ne.isArray(e))for(var i=0,r=e.length,o=0;o<r;o++)this.download(e[o],(function(){}),(function(e){++i==r&&n&&n()}),(function(){}),(function(){++i==r&&n&&n()}));else Ne.isString(e)&&this.download(e,(function(){}),(function(e){n&&n()}),(function(){}),(function(){n&&n()}))},e.prototype.needWait=function(e){var t=e.url;return!!this.loadingModels[t]},e.prototype.update=function(){for(var e=0;e<this.waitModels.length;e++){var t=this.waitModels[e];this.needWait(t)||(this._download(t.url,t.jsonCallback,t.modelCallback,t.progressCallback,t.errorCallback),this.waitModels.splice(e--,1))}},e.prototype.onUpdate=function(e){this.update(e)},o(e,[{key:"residentMode",set:function(e){if(this.isResidentMode=e,!e){var t=[];for(var n in this.models){var i=this.models[n];if(0===i.refCount){var r=i.URL;i.unload()&&t.push(r)}}for(var o=0;o<t.length;o++){r=t[o];delete this.models[r]}}},get:function(){return this.isResidentMode}}]),e}(),pu=function(){function e(t){r(this,e),this.app=t,this.particles={}}return e.prototype.get=function(e){return this.particles[e]},e.prototype.set=function(e,t){this.particles[e]=t},e.prototype.download=function(e,t){var n=e.appendPath("index.json"),i=this;new THREE.FileLoader(this.app.loadingManager).load(n,(function(n){var r=JSON.parse(n);i.set(e,r),t&&t(r)}),(function(){}),(function(){}))},e}(),du=function(){function e(t){r(this,e),this.app=t,this.camera=t.camera,this.updateTime=0,this.lastAdjustCameraNear=0}return e.prototype._getMinDistanceForAdjustCameraNear=function(e,t,n,i){var r=Ne.parseVector3(n),o=Ne.parseVector3(this.camera.position),a=Math.min(i,r.distanceTo(o));if(a>e){var s=this.app.picker.intersectResult(t[0],t[1],null,{ignoreFrameCheck:!1});if(s&&s.picked)(r=s.getPickedPosition({skipOtherPick:!0}))&&(r=Ne.parseVector3(r),a=Math.min(a,o.distanceTo(r)))}return a/e},e.prototype._getAdjustCameraNear=function(e){var t=this.camera.distance;if(t>10){var n=this.camera.worldToScreen(this.camera.target),i=this.camera.screenToWorld(n[0],n[1]);if(i)return this.updateTime>=.5&&(this.updateTime=0,this.lastAdjustCameraNear=this._getMinDistanceForAdjustCameraNear(e,n,i,t)),this.lastAdjustCameraNear}return this.camera.near},e.prototype.processAdjustCameraNear=function(){var e=Math.max(.1,this._getAdjustCameraNear(120));this.app.renderCamera.setNear(e)},e.prototype.onUpdate=function(){this.updateTime+=this.app._deltaTime;var e=this.camera._targetObject;e&&(e.position=this.camera.target)},e.prototype.onEnter=function(){var e=this;this.app.on("cameraChange",(function(t){e.camera.autoAdjustNear&&!e.app.renderCamera.isLerping&&e.processAdjustCameraNear(),e.app.needUpdate=!0}),"__cameraNearFixed__");var t=!1;this.app.on("cameraChangeMouseMove",(function(n){e.app.camera.inputEnabled&&!e.app.isPauseEvent(O.Pick,null,j.LevelPickOperation)&&(t=!0,e.app.pauseEvent(O.Pick,null,j.LevelPickOperation))}),"__disable_outline__"),this.app.on("cameraChangeEnd",(function(n){t&&(t=!1,e.app.resumeEvent(O.Pick,null,j.LevelPickOperation))}),"__disable_outline__")},e.prototype.onLeave=function(){this.app.off("cameraChange","__cameraNearFixed__"),this.app.off("cameraChangeMouseMove","__disable_outline__"),this.app.off("cameraChangeEnd","__disable_outline__")},e}(),fu=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"translate",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r(this,e),t&&(this._object=t,this._axis=null,this._disableAxis=[],this.init(t.app,n,i),this.control.attach(this._object.node),this.app.scene.add(this.control),this.control.setPickable(!1))}return e.prototype.init=function(e,t,n){this.app=e,this.control=new THREE.TransformControls(this.app.renderCamera,this.app.mainDomElement),this.control.traverse((function(e){e.userData.skipOutline=!0,e.userData.useVisibleOnly=!0}));var i=this;this.control.addEventListener("change",(function(e){i.onGizmoChange(e)})),this.control.addEventListener("objectChange",(function(e){i.onGizmoObjectChange(e)})),this.control.addEventListener("mouseDown",(function(e){i.onGizmoMouseDown(e)})),this.control.addEventListener("mouseUp",(function(e){i.onGizmoMouseUp(e)})),this.control.getGizomNode=function(){return i.control.children[0]},this.control.getAxisNode=function(){return i.control.children[1]},this.mode="translate",Ne.isString(t)?(this.mode=t,this.params=n||{}):this.params=t||{},this.app.on("cameraViewChange",(function(e){e.view==w.Orthographic?i.setAxis("XZ"):i.setAxis("XYZ")})),this.app.camera.viewMode==w.Orthographic&&this.setAxis("XZ")},e.prototype.onGizmoChange=function(e){},e.prototype.onGizmoObjectChange=function(e){this._object&&(this._object.dirty=!0);var t=this.params.change;t&&t.call(this,{object:this._object})},e.prototype.onGizmoMouseDown=function(e){this.app.camera.disable({rotate:!0});var t=this.params.changeStart;t&&t.call(this,{object:this._object})},e.prototype.onGizmoMouseUp=function(e){this.app.camera.resume({rotate:!0});var t=this.params.changeEnd;t&&t.call(this,{object:this._object})},e.prototype.onUpdate=function(e){if(this._object.static)return this.control.updateMatrixWorld(),!0},e.prototype.onRemove=function(){this.app.scene.remove(this.control),this.control.detach(),this.control.dispose()},e.prototype.onVisible=function(e){this.control.enabled&&(this.control.visible=e)},e.prototype.setAxis=function(e){if(this._axis=e,this._axis&&"XYZ"!=this._axis){var t=this,n=new THREE.Raycaster;this.control.userData.original_pointerHover=this.control.pointerHover,this.control.axis=e,this.control.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){n.setFromCamera(e,this.camera);var i=n.intersectObjects(this.getGizomNode().picker[this.mode].children,!0)[0]||!1;i?-1!=t._axis.search(i.object.name)&&(this.axis=i.object.name):this.axis=""}}}else this.control.userData.original_pointerHover&&(this.control.pointerHover=this.control.userData.original_pointerHover,delete this.control.userData.original_pointerHover)},e.prototype.detach=function(){this.control.detach()},e.prototype.attach=function(e){this.control.attach(e)},e.prototype.updateDisableAxis=function(e,t,n){for(var i=-1,r=0;r<this._disableAxis.length;r++)if(this._disableAxis[r].name==e){i=r;break}t?-1!==i&&this._disableAxis.splice(i,1):-1===i&&this._disableAxis.push({name:e,matchAll:n})},e.prototype.enableAxis=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e){this.updateDisableAxis(e,t,n);var i=this.control;if(this._disableAxis.length){var r=this,o=function(e){if(!e)return!0;for(var t=0;t<r._disableAxis.length;t++){var n=r._disableAxis[t];if(n.matchAll){if(e==n.name)return!0}else if(-1!==e.indexOf(n.name))return!0}return!1},a=function(e){e.traverse((function(e){for(var t=0;t<r._disableAxis.length;t++){var n=r._disableAxis[t];e.name==n.name&&(e.visible=!1)}}))};Ne.setValue(i,"pointerDown",(function(e){var t=this.getGizomNode().axis;o(t)||Ne.getBackupValue(i,"pointerDown").call(this,e)})),Ne.setValue(i,"pointerMove",(function(e){var t=this.getGizomNode().axis;o(t)||Ne.getBackupValue(i,"pointerMove").call(this,e)})),Ne.setValue(i,"pointerUp",(function(e){var t=this.getGizomNode().axis;o(t)||Ne.getBackupValue(i,"pointerUp").call(this,e)})),Ne.setValue(i,"updateMatrixWorld",(function(){Ne.getBackupValue(i,"updateMatrixWorld").call(this);var e=this.getGizomNode().gizmo,t=this.getGizomNode().mode;a(e[t])}))}else Ne.revertValue(i,"pointerDown"),Ne.revertValue(i,"pointerMove"),Ne.revertValue(i,"pointerUp"),Ne.revertValue(i,"updateMatrixWorld")}},e.prototype.setSize=function(e){console.warn("[AxisTransformControl] Please use '.size' to replace 'setSize()'"),this.size=e},o(e,[{key:"object",get:function(){return this.control.object}},{key:"node",get:function(){return this.control}},{key:"mode",set:function(e){if(e){if("translate"!=e&&"rotate"!=e&&"scale"!=e)return void console.error('[AxisTransformControl] mode is invalid, must be "translate/rotate/scale"');this.control.setMode(e)}},get:function(){return this.control.getMode()}},{key:"space",set:function(e){if(e){if("world"!=e&&"local"!=e)return void console.error('[AxisTransformControl] space is invalid, must be "world/local"');this.control.setSpace(e)}},get:function(){return this.control.space}},{key:"size",set:function(e){this.control.setSize(e)},get:function(){return this.control.size}},{key:"visible",set:function(e){this.control.visible=e,this.control.enabled=e},get:function(){return this.control.visible}}]),e}(),mu=function(){function e(t){r(this,e),this.state=t,this.app=t.app,this.control=t.control,this.root=new THREE.Group,this.root.userData.childUseWorldAnglesAlways=!0,this.root.name="EditObjectGroup",this.lastRootPosition=null,this.lastRootScale=null,this.lastRootRotation=null}return e.prototype.hasChanged=function(){var e=this.root.position,t=this.root.scale,n=this.root.rotation;return!(this.lastRootPosition.equals(e)&&this.lastRootScale.equals(t)&&this.lastRootRotation.equals(n))},e.prototype.recordTranslation=function(){this.state.execute({type:"SetNodeTranslation",node:this.root,position:this.lastRootPosition,scale:this.lastRootScale,rotation:this.lastRootRotation}),this.synTranslation()},e.prototype.notify=function(e){for(var t=this.root.children,n=0;n<t.length;n++){var i=t[n].userData,r=this.app.objectManager.get(i.id);if(r){var o=r.userData._editCallbacks;o&&o[e].call(r);var a=r.userData.selectObjectCallback;a&&a.call(r)}}},e.prototype._pushSubNodeAttach=function(e,t,n,i,r){var o=this.app.objectManager.getBaseObject(t);e.push({type:"AttachNode",node:o.node,nodeParent:o.node.userData.nodeParent})},e.prototype.recordSubNodeAttach=function(e,t,n,i){var r=[];this._pushSubNodeAttach(r,e,t,n,i),this.state.execute(r),this.synTranslation()},e.prototype._pushSubNodeOnlyAttach=function(e,t,n,i,r,o,a,s,l){for(var u=0;u<n.length;u++){var c=n[u];this.hasSelected(c)&&e.push({type:"AttachNode",node:n[u].node,nodeParent:i[u]})}},e.prototype.recordSubNodeOnlyAttach=function(e,t,n,i,r,o,a,s){var l=[];this._pushSubNodeOnlyAttach(l,e,t,n,i,r,o,a,s),this.state.execute(l),this.synTranslation()},e.prototype._pushNodeAttach=function(e,t,n,i,r){e.push({type:"AttachNode",node:t.node,nodeParent:n})},e.prototype.recordNodeAttach=function(e,t,n,i){var r=[];this._pushNodeAttach(r,e,t,n,i),this.state.execute(r),this.synTranslation()},e.prototype._pushNodeOnlyAttach=function(e,t,n,i,r,o,a,s,l){e.push({type:"AttachNode",node:t.node,nodeParent:n});for(var u=0;u<i.length;u++){i[u]!=t&&e.push({type:"AttachNode",node:i[u].node,nodeParent:r[u]})}},e.prototype.recordNodeOnlyAttach=function(e,t,n,i,r,o,a,s){var l=[];this._pushNodeOnlyAttach(l,e,t,n,i,r,o,a,s),this.state.execute(l),this.synTranslation()},e.prototype._pushNodesAttach=function(e,t,n,i,r){for(var o=0;o<t.length;o++){var a=t[o],s=n[o];e.push({type:"AttachNode",node:a.node,nodeParent:s})}},e.prototype.recordNodesAttach=function(e,t,n,i){var r=[];this._pushNodesAttach(r,e,t,n,i),this.state.execute(r)},e.prototype._pushSubNodesAttach=function(e,t,n,i,r){},e.prototype.recordSubNodesAttach=function(e,t,n,i){var r=[];this._pushSubNodesAttach(r,e,t,n,i),this.state.execute(r)},e.prototype.synTranslation=function(){this.lastRootPosition=this.root.position.clone(),this.lastRootScale=this.root.scale.clone(),this.lastRootRotation=this.root.rotation.clone();for(var e=0;e<this.root.children.length;e++){var t=this.root.children[e].userData.id;if(t)this.app.objectManager.get(t).dirty=!0}},e.prototype.updateRoot=function(){this.updateControl(),this.updateRootVisible(),this.updateRootPosition(),this.updateSelections(),this.synTranslation(),this.app.needUpdate=!0},e.prototype._getNodeCenterPosition=function(e){var t=new THREE.Vector3;if(this.state._isSubNode(e))e.getWorldPosition(t);else{var n=this.app.objectManager.get(e.userData.id);if(n){var i=n.position,r=n.centerPos;r?(t.set(r[0],0,r[1]),n.node.updateMatrixWorld(),t.applyMatrix4(n.node.matrixWorld),t.y=i[1]):t=Ne.parseVector3(i)}else e.getWorldPosition(t)}return t},e.prototype.clearSelections=function(){this.state._selectionObjects.clear()},e.prototype.addSelection=function(e){this.state._selectionObjects.add(e)},e.prototype.hasSelected=function(e){return this.state._selectionObjects.has(e)},e.prototype.updateSelections=function(){this.state.objects;this.clearSelections();for(var e=0;e<this.root.children.length;e++){var t=this.root.children[e].userData,n=t.id;if(n){var i=this.app.objectManager.get(n);t.subNode||this.addSelection(i)}}},e.prototype.updateControl=function(){this.control.object||this.root.children.length&&(this.control.attach(this.root),this.app.scene.add(this.control.node),this.synTranslation())},e.prototype.updateRootVisible=function(){this.root.children.length?this.root.visible=!0:this.root.visible=!1,this.control.visible=this.root.visible},e.prototype.updateRootPosition=function(){var e=this.root.children;if(e.length){for(var t=new THREE.Vector3,n=0;n<e.length;n++){var i=e[n],r=this._getNodeCenterPosition(i);t.add(r)}t.divideScalar(e.length);var o=this.root.parent.worldToLocal(t),a=this.root.detachChildren(this.app.scene);this.root.position.copy(o),this.root.attachChildren(a,this.app.scene)}},e.prototype.getObjectInfo=function(e,t){for(var n=new Set,i=this.root.children,r=0;r<i.length;r++){var o=i[r],a=this.app.objectManager.get(o.userData.id);if(!n.has(a)&&(n.add(a),e&&e.push(a),t)){var s=a.node.userData.nodeParent;t.push(s)}}},e.prototype.getSubNodeInfo=function(e,t){var n=this;this.root.traverse((function(i){var r=n.app.objectManager.get(i.userData.id);if(r&&(-1!==r.getSubNodeIndex(i)&&(e&&e.push(i),t))){var o=i.userData.nodeParent;t.push(o)}}))},e.prototype.recordNodeParent=function(e){e.isBaseObject&&(e=e.node);var t=e.parent;t!=this.root&&(e.userData.nodeParent=t)},e.prototype._pushAddObjects=function(e,t){if(t&&t.length){for(var n=[],i=0;i<t.length;i++){var r=t[i];this.hasSelected(r)||n.push(r)}if(n.length)for(i=0;i<n.length;i++){r=n[i];this.recordNodeParent(r),e.push({type:"AttachNode",node:r.node,nodeParent:this.root})}}},e.prototype._dispatchBreakableEvent=function(e,t){return t.continueFlag=!0,this.app.trigger(e,t),t.continueFlag},e.prototype.addObjects=function(e){var t=[];this._pushAddObjects(t,e),this.state.execute(t),this.updateRoot()},e.prototype._pushAddSubNodes=function(e,t){if(t.length)for(var n=0;n<t.length;n++){var i=t[n];this.state._isSubNode(i)&&(i.isChildOf(this.root)||this.recordNodeParent(i))}},e.prototype.addSubNodes=function(e){var t=[];this._pushAddSubNodes(t,e),this.state.execute(t),this.updateRoot()},e.prototype.addSubNode=function(e){return!!this.state._isSubNode(e)&&(!!this.app.objectManager.getBaseObject(e)&&(this.recordNodeParent(e),this.recordSubNodeAttach(e,this.root,this.state.selectOutlineColor,null),this.updateRoot(),!0))},e.prototype.addSubNodeOnly=function(e){if(!e)return!1;if(!e.userData.subNode)return!1;if(!this.app.objectManager.getBaseObject(e))return!1;var t=[],n=[];this.getObjectInfo(t,n);var i=[],r=[];this.getSubNodeInfo(i,r);for(var o=0;o<i.length;o++)if(i[o]==e){i.splice(o,1);break}return this.recordNodeParent(e),this.recordSubNodeOnlyAttach(e,t,n,i,r,this.root,this.state.selectOutlineColor,null),this.updateRoot(),!0},e.prototype.add=function(e,t){t&&this.addSubNode(t.intersect.node)||(this.recordNodeParent(e),this.recordNodeAttach(e,this.root,this.state.selectOutlineColor,null),this.updateRoot())},e.prototype.addOnly=function(e,t){if(!(t&&this.addSubNodeOnly(t.intersect.node)||1==this.root.children.length&&this.has(e))){var n=[],i=[];this.getObjectInfo(n,i);var r=[],o=[];this.getSubNodeInfo(r,o),this.recordNodeParent(e),this.recordNodeOnlyAttach(e,this.root,n,i,r,o,this.state.selectOutlineColor,null),this.updateRoot()}},e.prototype.remove=function(e){if(this.state._isSubNode(e))for(var t=this.root.children,n=0;n<t.length;n++){if((r=t[n])==e){var i=r.userData.nodeParent;this.recordSubNodeAttach(e,i,null,this.state.selectOutlineColor);break}}else for(t=this.root.children,n=0;n<t.length;n++){var r=t[n],o=this.app.objectManager.get(r.userData.id);if(e==o){this.app.trigger("unselectEditableObject",{object:o});i=r.userData.nodeParent;this.recordNodeAttach(e,i,null,this.state.selectOutlineColor);break}}this.updateRoot()},e.prototype.removeAll=function(){if(this.root.children.length){var e=[],t=[];this.getObjectInfo(e,t);var n=[],i=[];this.getSubNodeInfo(n,i);for(var r=0;r<e.length;r++){var o=e[r];this.app.trigger("unselectEditableObject",{object:o})}this.state.canRespondFromCommandManager=!1,this.recordNodesAttach(e,t,null,this.state.selectOutlineColor),this.recordSubNodesAttach(n,i,null,this.state.selectOutlineColor),this.state.canRespondFromCommandManager=!0,this.updateRoot()}},e.prototype.has=function(e){var t=this.root.children;if(this.state._isSubNode(e))for(var n=0;n<t.length;n++){if((i=t[n]).userData.subNode&&i==e)return!0}else for(n=0;n<t.length;n++){var i;if(!(i=t[n]).userData.subNode)if(e==this.app.objectManager.get(i.userData.id))return!0}return!1},e.prototype.attach=function(){this.root.attachToParent(this.app.scene,this.app.scene)},e.prototype.detach=function(){this.removeAll(),this.control.detach(),this.app.scene.remove(this.control.node),this.root.detachFromParent(this.app.scene),this.updateRoot()},e.prototype.clearScene=function(){var e=[];this.state._pushDeleteSubNodes(e,this.state.subNodes),this.state._pushDeleteObjects(e,this.state.objects),this.state.execute(e,!0),this.updateRoot()},e.prototype.toJSON=function(){for(var e=Array.from(this.state._selectionObjects),t=0;t<e.length;t++)this.remove(e[t]);var n=this.state.subNodes;for(t=0;t<n.length;t++)this.remove(n[t]);var i=[],r=this.state.objects;for(t=0;t<r.length;t++){var o=r[t];i.push(o.toJSON())}for(t=0;t<n.length;t++)this.addSubNode(n[t]);for(t=0;t<e.length;t++)this.add(e[t]);return JSON.stringify(i)},e.prototype.pasteObjects=function(){console.warn('[EditObjectState] we do not support ".pasteObjects()" anymore, please do not use it')},e.prototype.fromJSON=function(e){console.warn('[EditObjectState] we do not support ".fromJSON()" anymore, please do not use it')},e}(),gu=function(){function e(t){r(this,e);var n=this;this.app=t,this.picker=t.picker,this.copyObjectsJSONData=[],this._selectionObjects=new Set,this.canRespondFromCommandManager=!1,this._enableDirectMode=!1,this._enableKeyMode=!1,this._enableAutoRemoveAllWhenClick=!0,this.app.on("push",(function(e){n.onPush(e)})),this.app.on("redo",(function(e){n.onRedo(e)})),this.app.on("undo",(function(e){n.onUndo(e)}));var i={changeEnd:function(e){n.group.hasChanged()&&(n.group.recordTranslation(),n.group.notify("modify"))}};this.control=new fu,this.control.init(t,"translate",i),this.selectOutlineColor="#0000FF",this.group=new mu(this)}return e.prototype.onPush=function(e){this.canRespondFromCommandManager&&this.group.updateRoot()},e.prototype.onRedo=function(e){this.canRespondFromCommandManager&&this.group.updateRoot()},e.prototype.onUndo=function(e){this.canRespondFromCommandManager&&this.group.updateRoot()},e.prototype.notify=function(e,t){var n=e.userData._editCallbacks;n&&n[t].call(e)},e.prototype.startDrag=function(e,t,n,i){if(e){i=i||.1,this.app.camera.disable({rotate:!0}),e.pickable=!1,e.catchEventAnyTime=!0,e.node.userData.skipPick=!0,e.position=app.camera.screenToWorld(t,n);var r=this;e.on("mousemove",(function(e){var t=r.app.picker.pickWorldPosition(e.clientX,e.clientY);t||(t=r.app.camera.screenToWorld(e.clientX,e.clientY)),t&&(t[1]+=i,this.position=t)}),"startDrag_mousemove"),e.on("mouseup",(function(e){this.pickable=!0,this.catchEventAnyTime=!1,delete this.node.userData.skipPick,r.group._dispatchBreakableEvent("selectEditableObject",{object:this})&&r.selectObject(this),this.off("mousemove",null,"startDrag_mousemove"),this.off("mouseup",null,"startDrag_mouseup"),r.app.camera.resume({rotate:!0}),r.notify(this,"dragEnd")}),"startDrag_mouseup")}},e.prototype.selectObject=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"translate",n=arguments[2];"translate"==t||"rotate"==t?(this.group.addOnly(e),n&&(e.userData.selectObjectCallback=n),this.setMode(t)):console.error("The mode must be 'translate' or 'rotate'")},e.prototype.unselectObject=function(e){this.group.remove(e)},e.prototype.setMode=function(e){e&&(this.control.mode=e)},e.prototype.parseParams=function(e){var t=e.type;if("RouteLine"==t||"PolygonLine"==t){var n=e.points;if(!n){n=[[-5,0,-5],[0,0,-5],[0,0,0],[0,0,5],[5,0,5]],e.points=n,e.style=e.style||{};var i=e.style;if(i.color=Ne.parseValue(i.color,5824222),e.image)void 0===e.scrollUV&&(e.scrollUV=!0)}}else if("Water"==t){n=[[-20,0,-20],[-20,0,20],[20,0,20],[20,0,-20]],e.points=n,e.normalMap0=Ne.parseValue(e.normalMap0,"images/water/Water_1_M_Normal.jpg"),e.normalMap1=Ne.parseValue(e.normalMap1,"images/water/Water_2_M_Normal.jpg")}else if("Region"==t){n=[[-20,0,-20],[-20,0,20],[20,0,20],[20,0,-20]],e.points=n,e.fontColor=Math.random(),e.fontSize=THING.Math.randomInt(9,32),e.fontText="你好"}return Ne.cloneObject(e)},e.prototype.addObjects=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];i instanceof Lt?(i.internalUserData.editable=!0,t.push(i)):console.error("The object is not BaseObject, so we can not add object to edit state")}this.group.addObjects(t)},e.prototype.createObject=function(e,t){(e=e||{}).internalUserData={editable:!0};var n=(e=this.parseParams(e)).complete;e.complete=function(){n&&n()};var i=this.app.create(e);return t&&(i.userData._editCallbacks=t),i},e.prototype._pushDeselectObject=function(e,t){t&&e.push({type:"AttachNode",node:t.node,nodeParent:t.node.userData.nodeParent})},e.prototype._pushDeleteObject=function(e,t){t&&this._pushDeselectObject(e,t)},e.prototype.deleteObject=function(e){this.notify(e,"remove");var t=[];this._pushDeleteObject(t,e),this.execute(t,!0),this.group.updateRoot()},e.prototype._pushDeleteObjects=function(e,t){for(var n=0;n<t.length;n++){var i=t[n];this._pushDeleteObject(e,i)}},e.prototype.deleteObjects=function(e){for(var t=0;t<e.length;t++)this.notify(e[t],"remove");var n=[];this._pushDeleteObjects(n,e),this.execute(n,!0),this.group.updateRoot()},e.prototype._isSubNode=function(e){return!!e&&(!e.isBaseObject&&!!e.userData.subNode)},e.prototype._isBreakByControlAxis=function(e){var t=e.intersect;return(!t||!this._isSubNode(t.node))&&!(!this.control.axis||!this.control.visible)},e.prototype._isCanPick=function(e){if(this._isBreakByControlAxis(e))return!1;var t=e.object;if(t){if(t==this.app.outdoors)return!1;if(!t.internalUserData.editable)return!1}return!0},e.prototype._getSortedSubNodes=function(e,t){for(var n=[],i=0;i<e.length;i++){var r=e[i],o=r.userData,a=this.app.objectManager.get(o.id),s=a.getSubNodeIndex(r);n.push({index:s,node:r,object:a})}return n.sort(t),n},e.prototype._pushInsertSubNode=function(e,t){},e.prototype.insertSubNode=function(){var e=this.subNodes;if(e.length){var t=[];this._pushInsertSubNode(t,e),this.execute(t,!0),this.group.updateRoot()}},e.prototype._pushDeleteSubNodes=function(e,t){},e.prototype.deleteSubNodes=function(e){var t=[];this._pushDeleteSubNodes(t,e),this.execute(t,!0),this.group.updateRoot()},e.prototype.deleteSelections=function(){var e=Array.from(this._selectionObjects);e.length&&this.deleteObjects(e);var t=this.subNodes;t.length&&this.deleteSubNodes(t)},e.prototype.deselectObjects=function(e){if(e)for(var t=0;t<e.length;t++)this.group.remove(e[t])},e.prototype.copyObjects=function(e){this.copyObjectsJSONData=[];for(var t=0;t<e.length;t++){var n=e[t],i=n.toJSON();i.localPosition=n.localPosition,i.localAngles=n.localAngles,i.scale=n.scale,this.copyObjectsJSONData.push(JSON.stringify(i))}},e.prototype.selectAll=function(){this.group.addObjects(this.objects)},e.prototype.clearScene=function(){this.group.clearScene()},e.prototype.toJSON=function(){this._enableDirectMode=!0;var e=this.group.toJSON();return this._enableDirectMode=!1,e},e.prototype.fromJSON=function(e){e&&this.group.fromJSON(e)},e.prototype.execute=function(e,t){if(this._enableDirectMode){var n=this.app.commandManager.create(e,t);return n?n.execute():null}return this.app.commandManager.execute(e,t)},e.prototype.processAreaPicking=function(e){var t=e.objects;if(t){for(var n=this.objects,i=[],r=0;r<n.length;r++){var o=n[r];t.has(o)||i.push(o)}this.deselectObjects(i),t.length&&(t[0]instanceof Lt?this.group.addObjects(t):this.group.addSubNodes(t))}},e.prototype.onMouseDown=function(e){},e.prototype.onMouseUp=function(e){e.finishedAreaPicking&&this.processAreaPicking(e)},e.prototype.onMouseMove=function(e){e.areaPicking&&(this._enableDirectMode=!0,this.processAreaPicking(e),this._enableDirectMode=!1)},e.prototype.onClick=function(e){if(this.app.events.canClick(e)){var t=this.app.isKeyPressed(k.Ctrl),n=e.object;if(n&&this._isCanPick(e))if(t){var i=e.intersect.node;this.group.has(n)?this.group.remove(n):this.group.has(i)?this.group.remove(i):this.group._dispatchBreakableEvent("selectEditableObject",{object:n})&&this.group.add(n,e)}else this.group._dispatchBreakableEvent("selectEditableObject",{object:n})&&this.group.addOnly(n,e);else t||this.enableAutoRemoveAllWhenClick&&this.group.removeAll()}},e.prototype.onKeyDown=function(e){if(this._enableKeyMode)switch(event.keyCode){case k.Q:this.control.setSpace("local"===this.control.space?"world":"local");break;case k.W:this.control.mode="translate";break;case k.E:this.control.mode="rotate";break;case k.R:break;case k.EqualSign:case k.Add:this.control.size=this.control.size+.1;break;case k.Dash:case k.Subtract:this.control.size=Math.max(this.control.size-.1,.1);break;case k.Y:this.app.isKeyPressed(k.Ctrl)&&this.app.commandManager.redo();break;case k.Z:this.app.isKeyPressed(k.Ctrl)&&this.app.commandManager.undo();break;case k.C:this.app.isKeyPressed(k.Ctrl)&&this.copyObjects(Array.from(this._selectionObjects));break;case k.V:this.app.isKeyPressed(k.Ctrl)&&this.pasteObjects();break;case k.A:this.app.isKeyPressed(k.Ctrl)&&this.selectAll();break;case k.Delete:this.deleteSelections()}},e.prototype.onKeyUp=function(e){},e.prototype.onUpdate=function(e){},e.prototype.onEnter=function(e,t){if(t){this.canRespondFromCommandManager=!0;var n=t.objects;if(n)for(var i=0;i<n.length;i++)this.group.add(n[i]);this.group.attach(),this.control.mode="translate";var r=this;this.app.on("areaPickStart",(function(e){var t=r.candidateForSubNodes;t.length||(t=r.objects),r.app.picker.candidates=t}),"editObject_areaPickStart"),this.app.on("areaPickEnd",(function(e){r.app.picker.candidates=null}),"editObject_areaPickEnd"),this.app.modelResource.residentMode=!0}else console.log("Gizmo state need params")},e.prototype.onLeave=function(e){this.group.detach(),this.canRespondFromCommandManager=!1,this.app.modelResource.residentMode=!1,this.app.off("areaPickStart",null,"editObject_areaPickStart"),this.app.off("areaPickEnd",null,"editObject_areaPickEnd")},o(e,[{key:"enableKeyMode",set:function(e){this._enableKeyMode=e},get:function(){return this._enableKeyMode}},{key:"areaPicking",set:function(e){this.picker.areaPicking=e,e||(this.picker.candidates=null)},get:function(){return this.picker.areaPicking}},{key:"enableAutoRemoveAllWhenClick",set:function(e){this._enableAutoRemoveAllWhenClick=e},get:function(){return this._enableAutoRemoveAllWhenClick}},{key:"objects",get:function(){var e=[];return this.app.objectManager.objects.forEach((function(t){t.internalUserData.editable&&e.push(t)})),e}},{key:"subNodes",get:function(){for(var e=[],t=this.group.root.children,n=0;n<t.length;n++){var i=t[n];i.userData.subNode&&e.push(i)}return e}},{key:"candidateForSubNodes",get:function(){for(var e=new Set,t=this.group.root.children,n=0;n<t.length;n++){var i=t[n].userData;if(i.subNode){var r=i.id;r&&e.add(this.app.objectManager.get(r))}}var o=[];return e.forEach((function(e){o=o.concat(e.subNodes)})),o}}]),e}(),vu=function(){function e(t){r(this,e),this.app=t}return e.prototype._getNavigationObject=function(e,t){if(e.getNavigation(t))return e;for(var n=e.parents,i=0;i<n.length;i++){var r=n[i];if(r.getNavigation(t))return r}return null},e.prototype._tryGetRoomFromPosition=function(e,t){if(!t)return null;var n=e.isFloor?e:e.parents.query(".Floor")[0];return n?n.getRoomFromWorldPosition(t):null},e.prototype._getObjectRoot=function(e,t){function n(e,t){if(t==e)return e;if(t.isChildOf(e))return e;for(var n=e.parents,i=0;i<n.length;i++){var r=n[i];if(t==r)return r;if(t.isChildOf(r))return r}return null}var i=n(e,t),r=n(t,e);return i.isChildOf(r)?r:i},e.prototype._setupGraph=function(e,t){var n=this._getObjectRoot(e,t);if(!n)return null;for(var i=n;i;i=i.parent)if(Ne.isFunction(i.setupGraph))return i.setupGraph();return null},e.prototype._buildPathes=function(e){for(var t=[],n=null,i=0;i<e.length;i++){var r=this.app.query("#"+e[i])[0];if(!r.isCampus&&!r.isFloor){var o=r.parent;if(n!=o)t.push({startObject:r,endObject:r}),n=o;else t[t.length-1].endObject=r}}return t},e.prototype.findPath=function(e){var t=(e=e||{}).error||function(){console.error.apply(console,arguments)},n=e.clipAreas,i=e.startObject||e.startRoom||e.start,r=e.endObject||e.endRoom||e.end;if(!i)return t({text:"Needs start object to find path in navigation"}),null;if(!r)return t({text:"Needs end object to find path in navigation",startObject:i}),null;var o=e.startPosition||i.position,a=e.endPosition||r.position;if(!o)return t({text:"Needs start position to find path in navigation",startObject:i,endObject:r}),null;if(!a)return t({text:"Needs end position to find path in navigation",startObject:i,endObject:r,startPosition:o}),null;var s=this._getNavigationObject(i,n),l=this._getNavigationObject(r,n);if(!s)return t({text:"The parents of start object are not support navigation",startObject:i,endObject:r,startPosition:o,endPosition:a}),null;if(!l)return t({text:"The parents of end object are not support navigation",startParentObject:s,startObject:i,endObject:r,startPosition:o,endPosition:a}),null;var u=this._tryGetRoomFromPosition(i,o);u&&(i=u);var c=this._tryGetRoomFromPosition(r,a);c&&(r=c);var h=this._setupGraph(s,l);if(!h)return t({text:"Create navigation graph failed",startParentObject:s,endParentObject:l}),null;var p=[];if(s==l){var d=s.findPath(o,a);if(!d)return t({text:"Find path failed",startParentObject:s,startPosition:o,endPosition:a}),null;p.push({entrance:s,points:d})}else{var f=h.findShortestPath(i.id,r.id);if(!f||!f.length)return t({text:"Find shortest path failed",startObject:i,endObject:r}),null;p.graphPath=f;var m=this._buildPathes(f);if(!m.length)return null;var g,v=(g=m[0]).endObject;if(!(g=s.findPath(o,v.position)))return t({text:"Find first path failed",startParentObject:s,startPosition:o,endPosition:v.position}),null;p.push({points:g,entrance:v});for(var y=1;y<m.length-1;y++){var b=m[y];if(b.startObject!=b.endObject){var _=this.findPath({startObject:b.startObject,endObject:b.endObject});if(!_)return t({text:"Find middle path failed",startObject:b.startObject,endObject:b.endObject}),null;p.push(_)}}var x,E=(x=m[m.length-1]).startObject;if(!(x=l.findPath(E.position,a)))return t({text:"Find last path failed",endParentObject:l,startPosition:E.position,endPosition:a}),null;p.push({points:x,entrance:E})}return p},e}(),yu=function(){function e(t){r(this,e),this.app=t,this._navigation=new vu(t),this.lineIndex=-1,this.floor=null,this.lines=[],this.routeLines=[],this.lineParams={},this._object=null,this._defaultObject=null,this.speed=0,this.liftSpeed=0,this.startCallback=null,this.changeFloorCallback=null,this.completeCallback=null}return e.prototype.findPath=function(e,t,n,i){var r={start:e,startPosition:t,end:n,endPosition:i},o=this._navigation.findPath(r);return o?(this.createLine(o),o):null},e.prototype.clearPath=function(){this.destroyLine()},e.prototype.showPath=function(){if(this.routeLines.length)if(0===arguments.length)for(var e=0;e<this.routeLines.length;e++){this.routeLines[e].line.visible=!0}else if(1===arguments.length){var t=arguments[0];for(e=0;e<this.routeLines.length;e++){this.routeLines[e].line.visible=t}}else if(2===arguments.length){var n=arguments[0];for(t=arguments[1],e=0;e<this.routeLines.length;e++){var i=this.routeLines[e],r=i.floor,o=i.line;r==n&&(o.visible=t)}}},e.prototype.createEvent=function(e){var t=e;return t.speed=this.speed,t.liftSpeed=this.liftSpeed,t},e.prototype.getLinesParent=function(e){return e.building?e.building:e},e.prototype.setLineParams=function(e){(e=e||{}).type=e.type||"RouteLine";var t=e.type;"Line"==t?(e.color=e.color||65280,e.dotSize=e.dotSize||2,e.dotColor=e.dotColor||16711680):"RouteLine"==t&&(e.scrollUV=Ne.parseValue(e.scrollUV,!1)),this.lineParams=e},e.prototype.createLine=function(e){if(e){var t=this.getLinesParent(e[0].entrance);if(t){this.destroyLine(),this.lineIndex=0;for(var n=0;n<e.length;n++){var i=e[n],r=i.entrance,o=i.points;this.lines.push({entrance:r,points:o});var a=Ne.cloneObject(this.lineParams);a.parent=t,a.points=o,a.visible=!1,a.arrowFlag=n===e.length-1;var s=app.create(a);this.routeLines.push({entrance:r,line:s})}}}},e.prototype.destroyLine=function(){if(this.lines.length){for(var e=0;e<this.routeLines.length;e++)this.routeLines[e].line.destroy();this.routeLines=[],this.lineIndex=-1,this.lines=[]}},e.prototype.start=function(e){if(e=e||{},this.stop(),this.lines.length&&(this.lineIndex=0,this.speed=e.speed,this.liftSpeed=e.liftSpeed,this.startCallback=e.start,this.beforeChangeFloorCallback=e.beforeChangeFloor,this.afterChangeFloorCallback=e.afterChangeFloor,this.completeCallback=e.complete,this.startCallback)){var t=this.lines[0],n=t.floor,i=t.points;this.startCallback(this.createEvent({floor:n,path:i}))}},e.prototype.stop=function(){this.lineIndex=-1,this._object&&this._object.stopMoving(),this.completeCallback&&this.completeCallback(this.createEvent({floor:this.floor,pos:this._object.position}))},e.prototype._goWithLineComplete=function(e){if(e<this.lines.length-1){var t=this;this._object.movePath({position:this.lines[e+1].points[0],speed:this.liftSpeed,complete:function(){var n=t.afterChangeFloorCallback;if(n){var i=t.lines[e].floor,r=t.lines[e+1].floor,o=t.lines[e+1].points,a=o[0];n(t.createEvent({curFloor:i,nextFloor:r,path:o,position:a}))}t.lineIndex=e+1}});var n=this.beforeChangeFloorCallback;if(n){var i=this.lines[e].floor,r=this.lines[e+1].floor,o=this.lines[e+1].points,a=this.lines[e].points[this.lines[e].points.length-1];n(this.createEvent({curFloor:i,nextFloor:r,path:o,position:a}))}}else{if(this.completeCallback){var s={floor:this.floor};if(this._object)s.pos=this._object.position;else{var l=this.lines[e];s.pos=l.points[l.points.length-1]}this.completeCallback(s)}this.lineIndex=-1}},e.prototype.goWithLine=function(){var e=this.lines[this.lineIndex],t=this.lineIndex;if(this.lineIndex=-1,this.floor=e.floor,this._object){var n=this;this._object.movePath({path:e.points,speed:this.speed,orientToPath:!0,complete:function(){n._goWithLineComplete(t)}})}else this._goWithLineComplete(t)},e.prototype.updateLineIndex=function(){-1!==this.lineIndex&&(this.lineIndex>=this.lines.length||this.goWithLine())},e.prototype.showNavigationHelper=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.app.query(".Floor").forEach((function(t){t.isOutdoors||t.showNavigationHelper(e)}))},e.prototype.pickFloor=function(e){if(!e.picked)return null;var t=e.object;return t?{pos:e.pickedPosition,floor:t.floor}:null},e.prototype.onUpdate=function(e){this.updateLineIndex()},e.prototype.onEnter=function(e){this.setLineParams();var t=new THREE.Object3D;this._defaultObject=new Lt(this.app)._init(t,null),this._defaultObject.visible=!1,this._object=this._defaultObject,this.app.scene.add(t)},e.prototype.onLeave=function(e){this._defaultObject.destroy(),this._defaultObject=null,this._object=null},o(e,[{key:"outputLog",set:function(e){this._outputLog=e},get:function(){return this._outputLog}},{key:"object",set:function(e){this._object=e||this._defaultObject},get:function(){return this._object}}]),e}();function bu(e){this.app=e.app,this.camera=this.app.camera,this.savedPosition=this.camera.position,this.savedTarget=this.camera.target,this.position=e.position,this.target=e.target,this.time=e.time}function _u(e){this.app=e.app,this.scene=this.app.scene,this.vertices=e.vertices,this.pointColor=e.pointColor,this.lineColor=e.lineColor,this.regionColor=e.regionColor,this.id=e.id}bu.prototype.execute=function(){this.camera.flyTo({position:this.position,target:this.target,time:this.time,complete:function(){}})},bu.prototype.undo=function(){this.camera.flyTo({position:this.savedPosition,target:this.savedTarget,time:this.time,complete:function(){}})},_u.prototype.execute=function(){var e=this.app.create({type:"PolygonRegion",vertices:this.vertices,pointColor:this.pointColor,lineColor:this.lineColor,regionColor:this.regionColor});this.id=e.id},_u.prototype.undo=function(){var e=this.app.objectManager.get(this.id);e&&e.destroy()};var xu=0,Eu=1,wu=2,Tu=3;function Mu(e){this.app=e.app,this.setParam(e),this.expandingCount=0,this.expandState=xu}function Su(e){this.app=e.app,this.node=e.node,this.oldPosition=e.position,this.oldScale=e.scale,this.oldRotation=e.rotation,this.position=this.node.position.clone(),this.scale=this.node.scale.clone(),this.rotation=this.node.rotation.clone()}function Cu(e){this.app=e.app,this.node=e.node,this.nodeParent=e.nodeParent,this.oldNodeParent=this.node.parent}function Au(e){this.app=e.app,this.object=e.object,this.oldPosition=e.position,this.oldScale=e.scale,this.oldAngles=e.angles||e.offsetAngles,this.position=this.object.position,this.scale=this.object.scale,this.angles=this.object.angles}function Ru(e){this._app=e.app,this._attributes={}}Mu.prototype.initPosition=function(){for(var e=0;e<this.objs.length;e++){var t=this.objs[e];t.internalUserData.expandInitPos=t.internalUserData.expandInitPos||t.node.position.clone()}},Mu.prototype.clearInitPosition=function(){for(var e=0;e<this.objs.length;e++){delete this.objs[e].internalUserData.expandInitPos}},Mu.prototype.setParam=function(e){this.objs=e.objects||this.objs,this.flyTime=e.time||this.flyTime||1e3,this.length=e.length||e.distance||this.length||10,this.horzMode=Ne.parseValue(e.horzMode,this.horzMode),this.hideRoof=Ne.parseValue(e.hideRoof,this.hideRoof),this.callback=e.complete||this.callback,this.expandFloorsNumber=e.number||5,this.skipRoof=Ne.parseValue(e.skipRoof,this.skipRoof)},Mu.prototype.disableUpdateBoundingBox=function(e,t){e.disableUpdateBoundingBox=t,e.parents.forEach((function(e){e.disableUpdateBoundingBox=t}))},Mu.prototype.expandObj=function(e,t){this.initPosition();var n=Ne.parseVector3(e.internalUserData.expandInitPos).distanceTo(e.node.position),i=this.horzMode,r=t*this.length-n,o=0,a=this;e.expandTween=new TWEEN.Tween({progress:0}).to({progress:1},this.flyTime).easing(TWEEN.Easing.Linear.None).onStart((function(){if(e instanceof Br&&!Ne.isNull(a.hideRoof)&&!a.skipRoof){var t=!a.hideRoof;e.traverseRoofs((function(e){e.visible!=t&&(e._changeVisibleByExpand=!0,e.visible=t)}))}a.disableUpdateBoundingBox(e,!0)})).onStop((function(){a.disableUpdateBoundingBox(e,!1)})).onUpdate((function(){var t=this._object.progress-o,n=r*t;o=this._object.progress,i?e.translateZ(n):e.translateY(n)})).onComplete((function(){a.disableUpdateBoundingBox(e,!1),a.onExpandComplete(),t==a.objs.length-1&&a.app.events.dispatchEvent({type:"expand",object:e.parent})})).start()},Mu.prototype.unexpandObj=function(e,t){var n=Ne.parseVector3(e.internalUserData.expandInitPos).distanceTo(e.node.position),i=this.horzMode,r=n,o=0;this.length<0&&(r*=-1);var a=this;e.unexpandTween=new TWEEN.Tween({progress:0}).to({progress:1},this.flyTime).easing(TWEEN.Easing.Linear.None).onStart((function(){a.disableUpdateBoundingBox(e,!0)})).onStop((function(){a.disableUpdateBoundingBox(e,!1)})).onUpdate((function(){var t=this._object.progress-o,n=r*t;o=this._object.progress,i?e.translateZ(-n):e.translateY(-n)})).onComplete((function(){if(a.disableUpdateBoundingBox(e,!1),e instanceof Br&&a.hideRoof&&!a.skipRoof){var n=a.hideRoof;e.traverseRoofs((function(e){e._changeVisibleByExpand&&(delete e._changeVisibleByExpand,e.visible=n)}))}a.onExpandComplete(),t==a.objs.length-1&&a.app.events.dispatchEvent({type:"unexpand",object:e.parent})})).start()},Mu.prototype.execute=function(){if(this.expandState!=Eu&&this.expandState!=wu){this.expandState==Tu&&this.stopExpanding(),this.expandingCount=0,this.expandState=Eu;for(var e=0,t=0;t<this.objs.length;t++){var n=this.objs[t];this.expandObj(n,e),e++,this.horzLength&&e%this.expandFloorsNumber==0&&(e=0)}}},Mu.prototype.undo=function(){if(this.expandState!=Tu&&this.expandState!=xu){this.expandState==Eu&&this.stopExpanding(),this.expandingCount=0,this.expandState=Tu;for(var e=0;e<this.objs.length;e++){var t=this.objs[e];this.unexpandObj(t,e)}}},Mu.prototype.stopExpanding=function(){if(this.expandState!=xu)for(var e=0;e<this.objs.length;e++){var t=this.objs[e];t.expandTween&&(t.expandTween.stop(),t.expandTween=null),t.unexpandTween&&(t.unexpandTween.stop(),t.unexpandTween=null)}},Mu.prototype.onExpandComplete=function(){this.expandState!=xu?(this.expandingCount++,this.expandingCount<this.objs.length||(this.expandState==Eu?(this.expandState=wu,this.callback&&this.callback(this.expandState)):this.expandState==Tu&&(this.clearInitPosition(),this.expandState=xu,this.callback&&this.callback(this.expandState)))):console.error("onExpandComplete should not come here!")},Su.prototype.execute=function(){this.node.position.copy(this.position),this.node.scale.copy(this.scale),this.node.rotation.copy(this.rotation),this.node.updateMatrixWorld()},Su.prototype.undo=function(){this.node.position.copy(this.oldPosition),this.node.scale.copy(this.oldScale),this.node.rotation.copy(this.oldRotation),this.node.updateMatrixWorld()},Cu.prototype.execute=function(){this.node&&this.nodeParent&&(this.nodeParent.updateMatrixWorld(),this.node.attachToParent(this.nodeParent,this.app.scene))},Cu.prototype.undo=function(){this.node&&this.oldNodeParent&&(this.oldNodeParent.updateMatrixWorld(),this.node.attachToParent(this.oldNodeParent,this.app.scene))},Au.prototype.execute=function(){this.object.position=this.position,this.object.scale=this.scale,this.object.angles=this.angles},Au.prototype.undo=function(){this.object.position=this.oldPosition,this.object.scale=this.oldScale,this.object.angles=this.oldAngles},Ru.prototype.execute=function(e){for(var t=Object.keys(this._attributes),n=0;n<t.length;n++){var i=t[n],r=this._attributes[i];void 0!==r&&(e.style[i]=r)}},Ru.prototype.undo=function(){},Ru.prototype.setAttribute=function(e,t){this._attributes[e]=t},Ru.prototype.getAttribute=function(e){return this._attributes[e]};var Pu=function(){function e(t){r(this,e),this.app=t.app,this.object=t.object,this.params=t.params}return e.prototype.execute=function(){this.object.style._inheritThemeName===this.params.name&&("Campus"===this.object.type||"Floor"===this.object.type?this.object.applyTheme(this.params.name,!0,!1):this.object.style._applyTheme&&this.object.style._applyTheme(this.params.name,this.params.force))},e.prototype.undo=function(){},e}(),Du=function(){function e(t){r(this,e),this.app=t.app,this.object=t.object,this.params=t.params}return e.prototype.execute=function(){this.object.lodLevel=this.params.level},e.prototype.undo=function(){},e}();function ku(e){this.app=e.app,this.object=e.object,this.params=e.params}function ju(e){THREE.WebGLRenderer.call(this,e)}ku.prototype.execute=function(){this.object.playAnimation(this.params)},ku.prototype.undo=function(){},O.AppComplete="complete",O.LoadCampusProgress="progress",O.LoadCampus="load",O.UnloadCampus="unload",O.PickObject="pick",O.Dragging="drag",O.CreateObject="create",O.DestroyObject="destroy",O.ExpandBuilding="expand",O.UnexpandBuilding="unexpand",O.SelectObject="select",O.DeselectObject="deselect",O.ObjectSelectionChanged="selectionchange",O.PickedObjectChanged="pickchange",O.BeforeLevelChange="beforelevelchange",O.Pick="pick",O.Unpick="unpick",O.PickChange="pickchange",O.AreaPickStart="areapickstart",O.AreaPicking="areapicking",O.AreaPickEnd="areapickend",O.BeforeLoad="beforeload",j.Default="__default__",j.LevelSetEffect="__level_set_effect__",j.LevelPickMethod="__level_pick_operation__",j.LevelEnterMethod="__level_enter_operation__",j.LevelBackMethod="__level_back_operation__",j.LevelFlyBreak="__level_fly_break__",j.LevelPickOperation="__level_pick_operation__",j.LevelCameraController="__level_camera_controller__",T.LeftView="leftview",T.RightView="rightview",T.FrontView="frontview",T.BackView="backview",ju.prototype=Object.assign(Object.create(THREE.WebGLRenderer.prototype),{constructor:ju,isWebGL1Renderer:!0});var Ou=function(){function e(t){if(r(this,e),t=t||{},this.tryUseCurrentApp(t))return e.current;e.current=this,this._useAsLoader=!1,this._useAsLoaderTimes=0,this._skipUnbindAppEvents=!1,this.tree={},this.domElement=null,this._inputElement=null,this.scene=null,this.camera=null,this.renderCamera=null,this._lightGroup=null,this.picker=null,this.enableGPUPicker=!0,this.sceneURL="";this.baseURL=c.toStr([87,226,191,239,69,108,125,170,74,24,83,106,232,134,141,122,5,230,106,232,86,91,132,34,209,138,177,45,52,124]),this.modelURL="https://model.3dmomoda.com/models/",this.spriteResource=null,this.modelResource=null,this.particleResource=null,this.objectManager=null,this.server=null,this.viewPointManger=null,this.webViewManager=null,this._floorLoaderManager=null,this.campusLoader=null,this.controls=[],this._elapsedTime=0,this._deltaTime=0,this._time=0,this._currentFrame=0,this._dirtyFrameCount=0,this._fpsLimitedDelta=0,this._fpsLimitedPreviousDelta=0,this._tweenTime=0,this._tickTimeMilliseconds=0,this.curView=null,this._bgColor=Ne.parseColor(9474192),this.stateManager=null,this.commandManager=null,this.inited=!1,this.initDomElementHeight="",this._fpsTimes=[],this.renderStates={},this._pixelRatio=1,this._renderOptions={},this.uuid=THING.Math.generateUUID(),this.parseOptions(t),this.init(t),this.resizeLock=!1,this._currentHTMLMarker=null}return e.prototype.tryUseCurrentApp=function(t){if(!e.current)return!1;if(!e.current.useAsLoader)return!1;var n=e.current;n._useAsLoaderTimes&&!n._skipUnbindAppEvents&&n.events.unbindAppEvents(n.uuid),n.uuid=THING.Math.generateUUID(),n._useAsLoaderTimes++;var i=n.confirmURL(t.url);return i&&n._loadInitCampus(i,t),!0},e.prototype.parseOptions=function(e){this.options=e,this.appKey=e.appKey||e.ak||"app_test_key";var t=e.container||e.el||"div3d";if(t&&(Ne.isString(t)?this.domElement=document.getElementById(t):this.domElement=t),this.domElement){this.domElement.style.cssText+="top: 0; left: 0; position: relative; overflow: hidden";var n=document.createElement("div");if(n.style.cssText="position: absolute;top: -1000px;left: 0",this.domElement.appendChild(n),this._inputElement=document.createElement("input"),this._inputElement.setAttribute("type","text"),this._inputElement.setAttribute("readonly","true"),this._inputElement.setAttribute("id","inp"),n.appendChild(this._inputElement),this.domElement.appendChild(n),!1===e.backwardEnabled&&this.setBackwardEnabled(!1),this.useOcclusionMap=!1,e.useOcclusionMap&&(this.useOcclusionMap=e.useOcclusionMap),this.splitLoadSpeed=.1,e.loadSpeed&&(this.splitLoadSpeed=e.loadSpeed),this.loadMode=0,e.loadMode&&(this.loadMode=e.loadMode),Ne.isString(e.url)){if(this.sceneURL=this.confirmURL(e.url),!e.skyBox&&!e.background){"321paevasd1x"==c.toStr([94,250,162,253,87,52,51,168,92,26,80,44])?e.skyBox="White":e.skyBox="Dark"}}else e.skyBox||e.background||(e.background=this._bgColor);e.keepBackgroundAspect&&(this._keepBackgroundAspect=e.keepBackgroundAspect),Ne.parseValue(e.isMobile,!1)&&(this._isMobile=!0),this.modelURL=e.modelURL||this.modelURL,this.resourceLibraryUrl=e.resourceLibraryUrl,this.options.maxTextureSize=this.options.maxTextureSize||2048,this._useAsLoader=Ne.parseValue(this.options.useAsLoader,!1),this._skipUnbindAppEvents=Ne.parseValue(this.options.skipUnbindAppEvents,!1),this.enableGPUPicker=Ne.parseValue(e.enableGPUPicker,!this.isMobileDevice),e.disablePlugins&&(U=!0,V=!0),this._useTryCatch=e.useTryCatch}else console.error(_)},e.prototype.confirmURL=function(e,t){if(!e)return"";if(Ne.isArray(e)){for(var n=0;n<e.length;n++)e[n]=this.confirmURL(e[n]);return e}if(-1!==e.indexOf("http://")||-1!==e.indexOf("https://")){if(window.location){var i=window.location.protocol;i&&"https:"==i&&(i+="//",-1!==e.indexOf("http://")&&(e=e.replace("http://",i)))}return e}return 0==e.indexOf("./")||0==e.indexOf("../")||0==e.indexOf("/")?e:this.options.resourceLibraryUrl?this.options.resourceLibraryUrl.appendPath(e.trimLeft(this.options.resourceLibraryUrl)):(t=t||this.baseURL).appendPath(e)},e.prototype.confirmBaseURL=function(e){return this.options.resourceLibraryUrl?this.options.resourceLibraryUrl.appendPath("/"):e},e.prototype.confirmModelURL=function(e){return this.resourceLibraryUrl?this.resourceLibraryUrl.appendPath("models").appendPath(e).appendPath("/0/gltf/"):this.modelURL?this.modelURL.appendPath(e).appendPath("/0/gltf/"):void 0},e.prototype.confirmTextureURL=function(e,t){return this.resourceLibraryUrl?this.resourceLibraryUrl.appendPath("textures").appendPath(e+"."+t):"https://static.3dmomoda.com/textures/"+e+"."+t},e.prototype.collectRenderStates=function(){for(var e=performance.now();this._fpsTimes.length>0&&this._fpsTimes[0]<=e-1e3;)this._fpsTimes.shift();this._fpsTimes.push(e);var t=this._fpsTimes.length,n=this.renderer.info.memory,i=this.renderer.info.render;this.renderStates={fps:t,geometries:n.geometries,textures:n.textures,frame:i.frame,calls:i.calls,triangles:i.triangles,points:i.points,lines:i.lines}},e.prototype._createRenderer=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r={canvas:i,antialias:!0,alpha:!0,stencil:n},o=t?new ju(r):new THREE.WebGLRenderer(r);o.info.autoReset=!1,o.setPixelRatio(window.devicePixelRatio);var a=this.calcRect();return o.setSize(a.width,a.height),e.appendChild(o.domElement),o.gammaFactor=1.5,o.gammaInput=!0,o.outputEncoding=THREE.GammaEncoding,o.shadowMap.enabled=!0,o.shadowMap.type=THREE.PCFSoftShadowMap,o},e.prototype._loadInitCampus=function(e,t){t=t||this.options;var n=this,i=this.objectManager.create({type:"Campus",url:e,name:t.name,visible:Ne.parseValue(t.visible,!0),position:t.position,angles:t.angles,basePosition:t.basePosition,baseAngles:t.baseAngles,properties:t.properties,isCamFitScene:t.isCamFitScene,isSetEffect:t.isSetEffect,disableCache:t.disableCampusCache,dynamic:t.dynamic,enableProxima:t.enableProxima,enableBatchObject:t.enableBatchObject,map:t.map,complete:function(){Ne.timer.setTimeout((function(){n.trigger("load",{app:n,campus:i,buildings:i.buildings})}))},error:function(e){var n=t.error||t.errorCallback;n&&n(e)}})},e.prototype.initGlobalOptions=function(e){THING.onValueChange=THING.onValueChange||function(){};var t={};["useStaticImage","manualUseStaticImage"].forEach((function(n){t[n]=Ne.parseValue(Ne.parseValue(THING[n],e[n]),void 0),delete THING[n],Object.defineProperty(THING,n,{set:function(e){t[n]!=e&&(t[n]=e,THING.onValueChange({type:n,value:e}))},get:function(){return t[n]},enumerable:!0,configurable:!0})}))},e.prototype.init=function(e){var t=this;this.initGlobalOptions(e),Ne.parseValue(e.removeAllTweenActions,!0)&&TWEEN.removeAll(),TWEEN.now=function(){var e=Ne.getCurrentTime()-t._tickTimeMilliseconds;return t._tweenTime+e};var n=this.calcRect(),i=document.createElement("meta");i&&(i.content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0",i.name="viewport",document.getElementsByTagName("head")[0].appendChild(i)),this.renderCamera=new THREE.CombinedCamera(n.width,n.height,60,.1,1e4,-1e4,1e4);var r=e.renderer;this.renderer=r||this._createRenderer(this.domElement,e.forceWebGL1,e.stencil),this.cssRenderer=new THREE.CSS3DRenderer({autoFixCamera:!0}),setTimeout((function(){t.cssRenderer.domElement.style.position="absolute",t.cssRenderer.domElement.style.top="0",t.cssRenderer.domElement.style.pointerEvents="none",t.cssRenderer.setSize(n.width,n.height);var i=e.cssParentNode||t.renderer.domElement.parentNode;i&&i.appendChild(t.cssRenderer.domElement)}),10),setTimeout((function(){var e=t.domElement.children;e.length&&e[0].length&&(e[0].children[0].style.pointerEvents="none")}),1e3),this.cssScene=new THREE.Scene,this.spriteResource=new uu(this),this.modelResource=new hu(this),this.particleResource=new pu(this),this.events=new wl(this),this.objectManager=new $s(this),this.server=new Hl(this),this.viewPointManger=new zl(this),this.commandManager=new Cl(this),this._floorLoaderManager=new Gl(this),this.edgesGeometriesManager=new el(this),this.materialDisposeManager=new nl(this),this.styleManager=new gl(this);var o=new THREE.Scene;if(this.scene=o,this.picker=new tu(this,this.enableGPUPicker),this._selection=new nu(this),this.stateManager=new Ml(this),this.camera=new au(this),this.loadingManager=new jl(this),this.resourceManager=new kl(this),this.webViewManager=new yl(this),this.campusLoader=new fa(this),this.register(),this.sceneLevel=new su(this),this.sceneRoot=this.create({type:"SceneRoot",parent:null}),this.scene.add(this.sceneRoot.node),this.rendererManager=new Il(this,e.stencil),this.renderEffects=this.rendererManager.createControl(),this.renderEffects.mergeConfig({postEffect:{enable:this.renderer.capabilities.isWebGL2}}).save().active(),this.effectManager=new al(this),this._lightGroup=this.create({type:"LightGroup",parent:this.root}),this.sceneManager=new Rl(this),this.sceneManager.enableDeafultViewPointFile=Ne.parseValue(this.options.enableDeafultViewPointFile,!1),this.sceneManager.defaultViewPointFileName=Ne.parseValue(this.options.defaultViewPointFileName,this.sceneManager.defaultViewPointFileName),this.addControl(this.sceneManager,"",!1),this.addControl(this.camera,"",!1),this.addControl(this.objectManager,"",!1),this.addControl(this.modelResource,"",!1),this.addControl(this.resourceManager,"",!1),this.mainUI=new $l(this),this.addControl(this.mainUI,"",!0),this.addControl(this.spriteResource,"",!1),this.addControl(this.webViewManager,"",!1),this.addControl(this.campusLoader,"",!1),this.addControl(this.stateManager,"",!0),this.addControl(this._floorLoaderManager,"",!1),this.addControl(this.selection,"",!1),this.addControl(this.sceneLevel,"",!1),this.mainUI._setup(),this.options.background&&(this.background=this.options.background),this.options.skyBox&&(this.skyBox=this.options.skyBox),this.sceneLevel.init(),this.defaultEvents=new lu(this),this.defaultEvents.init(),window.addEventListener("resize",(function(){t.resizeLock||Ne.throttling((function(){t.resize()}),200)()})),THREE.ImageUtils.crossOrigin="anonymous",this.events.dispatchEvent({type:"success"}),0!=this.sceneURL.length){var a=this.options.complete;a&&(this.options.complete=null,this.one("load",(function(e){e.app=t,a.call(e.campus,e)}))),this.options.isCamFitScene=Ne.parseValue(this.options.isCamFitScene,!0),this._loadInitCampus(this.sceneURL)}this.setupComplete(),this.changeStates();var s=Ne.parseValue(e.autoTick,!0),l=this.tick.bind(this);return s&&(TWEEN.bindApp=this,l(0),this.renderer.setAnimationLoop(l)),this},e.prototype._updateTweenTime=function(e){TWEEN.bindApp==this&&(this._tickTimeMilliseconds=Ne.getCurrentTime(),this._tweenTime+=1e3*e,TWEEN.update(this._tweenTime))},e.prototype._tick=function(e){this._deltaTime=e,this._elapsedTime+=e,this._currentFrame++,this.trigger("beforerender"),this.collectRenderStates(),this.renderer.info.reset(),this.inited&&(this.events.update(),this.updateControls(!1)),Ne.timer.update(this.deltaTime),this.rendererManager.update(),this.trigger("afterrender"),this.inited&&this.updateControls(!0),this.materialDisposeManager.update(this._deltaTime)},e.prototype.tick=function(e){var t=e/1e3,n=t-this._time;this._time=t;var i=this,r=function(){if(i._useTryCatch)try{i._tick(n)}catch(e){console.error(e)}else i._tick(n)};this._updateTweenTime(n);var o=this._renderOptions.fpsLimit;if(o){this._fpsLimitedDelta+=n;var a=this._fpsLimitedDelta-this._fpsLimitedPreviousDelta,s=1/o;o&&a>=s&&(r(),this._fpsLimitedPreviousDelta=this._fpsLimitedDelta-a%s)}else r()},e.prototype.register=function(){this.stateManager.registerEx({Picker:Kl}),this.stateManager.registerEx({CameraController:du}),this.stateManager.registerEx({EditObject:gu}),this.stateManager.registerEx({Navigation:yu}),this.commandManager.register("CameraFlyTo",bu),this.commandManager.register("ExpandObjects",Mu),this.commandManager.register("SetNodeTranslation",Su),this.commandManager.register("AttachNode",Cu),this.commandManager.register("SetObjectTranslation",Au),this.commandManager.register("SetObjectStyle",Ru),this.commandManager.register("ApplyObjectTheme",Pu),this.commandManager.register("setObjectLodLevel",Du),this.commandManager.register("PlayObjectAnimation",ku),this.commandManager.register("CreateRegion",_u)},e.prototype.changeStates=function(){this.stateManager.change("Picker"),this.stateManager.change("CameraController"),this.stateManager.change("Navigation")},e.prototype.setupComplete=function(){var e=this;this.inited=!0,setTimeout((function(){e.one("loadallpluginscomplete",(function(){!function(){if(e.events){var t={},n=e.root.campuses[0];n&&(t.app=e,t.campus=n,t.buildings=n.buildings),e.trigger("complete",t);var i=Ne.parseFunction(e.options.complete);i&&i({app:e})}}()})),de({app:e})}),10)},e.prototype.calcRect=function(){if(this._size)return{width:this._size[0],height:this._size[1]};var e=this.domElement.style.width,t=this.domElement.style.height;""==t&&(t=window.getComputedStyle?window.getComputedStyle(this.domElement,null).getPropertyValue("height"):this.domElement.currentStyle.height,""==this.initDomElementHeight&&(this.initDomElementHeight=t),"0px"!=t&&"auto"!=t||(t=""));var n=0==e.length||-1!==(e+"").indexOf("%")?this.domElement.clientWidth:e.match(/\d*[^px]/)[0],i=0==t.length||-1!==(t+"").indexOf("%")?this.domElement.clientHeight:t.match(/\d*[^px]/)[0];return 0==n&&(n=window.innerWidth),0==i&&(i=window.innerHeight),"0px"==this.initDomElementHeight&&(i=window.innerHeight),{width:Number(n),height:Number(i)}},e.prototype.isInScreen=function(e){var t=e[0],n=e[1];return!(t<0||n<0)&&!(t>=this.width||n>=this.height)},e.prototype.createObject=function(e){if(Ne.isString(e))return new THREE[e];var t=e,n=t.type,i=[];return Object.keys(t).forEach((function(e){"type"!=e&&i.push(t[e])})),Ne.applyNew(THREE[n],i)},e.prototype.create=function(e){return this.objectManager.create(e)},e.prototype.resize=function(){var e=this.calcRect(),t=e.width,n=e.height;this.width=t,this.height=n,this.camera.resize(t,n),this.picker.resize(t,n),this.webViewManager.resize(t,n),this.rendererManager.resize(t,n),this.resizeControls(t,n),this.stateManager.dispatchEvent({stateType:"onResize",width:t,height:n}),this.events.dispatchEvent({type:"resize",size:[t,n]}),this.renderer.setPixelRatio(this._pixelRatio*window.devicePixelRatio),this._keepBackgroundAspect?this.sceneManager._keepBackgroundAspect():this.sceneManager._resetBackgroundAspect()},e.prototype.setBackwardEnabled=function(e){history.pushState(null,null,document.URL),window.addEventListener("popstate",(function(){history.pushState(null,null,document.URL)}))},e.prototype.getClientPosition=function(e,t){return this.events.eventProcessor.getEventPosition(e,t)},e.prototype.setCurrentHTMLMarker=function(e){this._currentHTMLMarker=e},e.prototype.getCurrentHTMLMarker=function(){return this._currentHTMLMarker},e.prototype.query=function(e){if(Ne.isString(e)&&e.startsWith("/")){for(var t=0,n=0;n<e.length;n++)"/"==e[n]&&t++;if(1===t)return new Lt(this)._init(this.scene,null).query(e)}var i=new gt(this);return i.select(e,this.objectManager.objects),i},e.prototype.on=function(e,t,n,i,r,o){var a=this.events.bindCall(e,t,n,i,r,o);"filterPickedResults"==e&&(console.warn("Please use .picker.pickedResultsFunc=function(ev) to replace .on()"),this.picker.pickedResultsFunc=a.callback)},e.prototype.off=function(e,t,n){var i=this.events.unbindCall(e,t,n);return"filterPickedResults"==e&&(console.warn("Please use .picker.pickedResultsFunc=null to replace .on()"),this.picker.pickedResultsFunc=null),i},e.prototype.one=function(e,t,n,i,r,o){this.events.bindCall(e,t,n,i,r,!0,o)},e.prototype.trigger=function(e,t,n,i){if(this.events){var r;if(Ne.isString(t))n=i||n||{},this.query(t).forEach((function(t){r=t.trigger(e,n)}));else{var o=(n=t||i||n||{}).type;n.type=e,r=this.events.triggerCall(n),n.type=o}return r}},e.prototype.pauseEvent=function(e,t,n){this.events.pauseEvent(e,t,n)},e.prototype.pauseEventInFrame=function(e,t,n){this.events.pauseEvent(e,t,n,!0)},e.prototype.isPauseEvent=function(e,t,n){return this.events.isPauseEvent(e,t,n)},e.prototype.resumeEvent=function(e,t,n){this.events.resumeEvent(e,t,n)},e.prototype.hasEvent=function(e){return this.events.hasEvent(e)},e.prototype.execute=function(e){this.commandManager.execute(e)},e.prototype.addControl=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e)return Ne.isFunction(e.onAdd)&&e.onAdd(this),this.controls.push({control:e,name:t,afterRender:n}),e},e.prototype.getControl=function(e){for(var t=0;t<this.controls.length;t++){var n=this.controls[t];if(n.name==e)return n.control}return null},e.prototype.getControlIndex=function(e){for(var t=0;t<this.controls.length;t++){if(this.controls[t].control==e)return t}return-1},e.prototype.removeControl=function(e){if(e)if(Ne.isString(e)){var t=this.getControl(e);this.removeControl(t)}else{var n=this.getControlIndex(e);if(-1===n)return;Ne.isFunction(e.onRemove)&&e.onRemove(this),this.controls.splice(n,1)}},e.prototype.hasControl=function(e){if(!e)return!1;if(Ne.isString(e)){if(!this.getControl(e))return!1}else if(-1===this.getControlIndex(e))return!1;return!0},e.prototype.updateControls=function(e){for(var t=this._deltaTime,n=0;n<this.controls.length;n++){var i=this.controls[n];if(i.afterRender==e){var r=i.control;r.onUpdate&&r.onUpdate(t)}}},e.prototype.resizeControls=function(e,t){for(var n=0;n<this.controls.length;n++){var i=this.controls[n].control;i.onResize&&i.onResize(e,t)}},e.prototype.getCampusJSON=function(e,t){return this.campusLoader.peekJSON(e,t)},e.prototype.loadJSONData=function(e,t){if(e){var n=t.complete;e=this.confirmURL(e),new THREE.FileLoader(this.loadingManager).load(e,(function(e){if(e&&n){var t=Ne.objectKeysToLowerCase(JSON.parse(e));n(t)}}),(function(){}),(function(){}))}},e.prototype.focus=function(){this._inputElement&&this._inputElement.focus()},e.prototype.isKeyPressed=function(e){return this.events.isKeyPressed(e)},e.prototype.unloadResources=function(){this.events.clear(),this.root.init();for(var e=this.query("*"),t=0;t<e.length;t++){e[t].destroy()}this.stateManager.clear(),this.stateManager.init(),this.register(),this.changeStates()},e.prototype.pauseUpdate=function(){this.objectManager.pause()},e.prototype.resumeUpdate=function(){this.objectManager.resume()},e.prototype.getRenderStates=function(){return this.renderStates},e.prototype.captureScreenshotToImage=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"jpeg",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];try{return this.rendererManager.captureToDataURL(e,t,n,i,r)}catch(e){return console.error(e),null}},e.prototype.captureScreenshot=function(e,t,n){try{var i=e.getExtension(),r=this.rendererManager.captureToDataURL(t,n,i,1,!0);r&&this.saveFile(e,r)}catch(e){return void console.error(e)}},e.prototype.saveFile=function(e,t){var n=document.createElement("a");if("string"==typeof n.download){if(document.body.appendChild(n),n.download=e,t instanceof Blob)n.href=URL.createObjectURL(t);else if(Ne.isString(t))if(-1!==t.indexOf("data:image/octet-stream"))n.href=t;else{t=new Blob([t],{type:"text/plain;charset=UTF-8"});n.href=window.URL.createObjectURL(t)}else if(t.width&&t.height){var i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");i.width=t.width,i.height=t.height,i.getContext("2d").drawImage(t,0,0,t.width,t.height);var r=i.toDataURL();r=r.replace("image/png","image/octet-stream"),this.saveFile(e,r)}else n.href=t;n.click(),document.body.removeChild(n)}else location.replace(uri)},e.prototype.saveUTF8TextFile=function(e,t){var n=new Blob([t],{type:"text/plain;charset=UTF-8"}),i=window.URL.createObjectURL(n),r=document.createElement("a");r.href=i,r.download=e,r.click(),window.URL.revokeObjectURL(n)},e.prototype.applyThemeEnvironment=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"inner";if(e){var n=wa.findStyle(e);if(n){var i="outer"===t;i&&!n.outer&&(console.warning("applyThemeEnvironment: strategy has no outer data!"),i=!1),this.rendererManager._mainRenderer.getPass("combineGlow").$enable=!1,this.rendererManager._mainRenderer.getPass("lineBloom").$enable=!1,this.rendererManager._mainRenderer.getPass("glow").$enable=!1;var r=void 0,o=void 0,a=void 0,s=void 0,l=void 0,u=void 0;if(i){if(n.outer.postEffect.SmallGlowBloom?(r=n.outer.postEffect.SmallGlowBloom.enable,o=n.outer.postEffect.SmallGlowBloom.strength,a=n.outer.postEffect.SmallGlowBloom.radius):(r=!1,o=1.5,a=.4,console.warn("applyThemeEnvironment: strategy has no SmallGlowBloom data!")),n.outer.postEffect.MiddleGlowBloom?(s=n.outer.postEffect.MiddleGlowBloom.enable,l=n.outer.postEffect.MiddleGlowBloom.strength,u=n.outer.postEffect.MiddleGlowBloom.radius):(s=!1,l=1.5,u=.4,console.warn("applyThemeEnvironment: strategy has no MiddleGlowBloom data!")),n.outer.background)if("image"===n.outer.background.type)this.background=n.resourcePrefix+n.outer.background.value;else if("color"===n.outer.background.type)this.background=n.outer.background.value;else if("skybox"===n.outer.background.type){var c=n.resourcePrefix+n.outer.background.value;this.skyBox={negx:c+"/rt.jpg",negy:c+"/fr.jpg",negz:c+"/bk.jpg",posx:c+"/up.jpg",posy:c+"/lf.jpg",posz:c+"/dn.jpg"}}}else if(n.postEffects.glow?(r=!0,o=n.postEffects.glow.strength,a=n.postEffects.glow.radius):(r=!1,o=1.5,a=.4,console.warn("applyThemeEnvironment: strategy has no glow data!")),n.postEffects.middleGlow?(s=!0,l=n.postEffects.middleGlow.strength,u=n.postEffects.middleGlow.radius):(s=!1,l=1.5,u=.4,console.warn("applyThemeEnvironment: strategy has no middleGlow data!")),n.background&&n.background.type)if("image"===n.background.type)this.background=n.resourcePrefix+n.background.value;else if("color"===n.background.type)this.background=n.background.value;else if("skybox"===n.background.type){var h=n.resourcePrefix+n.background.value;this.skyBox={negx:h+"/rt.jpg",negy:h+"/fr.jpg",negz:h+"/bk.jpg",posx:h+"/up.jpg",posy:h+"/lf.jpg",posz:h+"/dn.jpg"}}this.rendererManager._mainRenderer.getPass("smallGlow").$enable=r,this.rendererManager._mainRenderer.getPass("smallGlow").strength=o,this.rendererManager._mainRenderer.getPass("smallGlow").radius=a,this.rendererManager._mainRenderer.getPass("smallGlow").threshold=.2,this.rendererManager._mainRenderer.getPass("middleGlow").$enable=s,this.rendererManager._mainRenderer.getPass("middleGlow").strength=l,this.rendererManager._mainRenderer.getPass("middleGlow").radius=u,this.rendererManager._mainRenderer.getPass("middleGlow").threshold=.2;var p=i?n.outer.lighting:n.lighting||As;this._lightGroup.setConfig(p);var d=i?n.outer.postEffect:n.postEffect||Ol.postEffect,f=this.postEffect.postEffect.blur;this.renderEffects.mergeConfig({postEffect:d}).mergeConfig({postEffect:{blur:f}}).update(),this.rendererManager._mainRenderer.shareDepthRenderBuffer(!0),this.renderer.capabilities.logarithmicDepthBuffer=!1,this.camera.autoAdjustNear=!0}}},e.prototype.applyTheme=function(e){console.warn("[App] Please use '.applyThemeEnvironment' to replace '.applyTheme'"),this.applyThemeEnvironment(e)},e.prototype.load=function(e,t,n){console.warn("[App] please use loadCampus() instead"),this.loadCampus(e,{successCallback:t,errorCallback:n})},e.prototype.unload=function(e){console.warn("please use unloadCampus() instead"),this.unloadCampus(e)},e.prototype.loadScene=function(e,t,n){console.warn("[App] please use loadCampus() instead"),this.loadCampus(e,{successCallback:t,errorCallback:n})},e.prototype.unloadScene=function(e){console.warn("[App] please use unloadCampus() instead"),this.unloadCampus(e)},e.prototype.showScene=function(e,t){console.warn("[App] please use 'getCampus(url).visible=true/false' instead"),this.sceneManager.showScene(e,t)},e.prototype.saveAsImageData=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"jpeg",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return console.warn("[App] Please use '.captureScreenshotToImage' to replace '.saveAsImageData'"),this.captureScreenshotToImage(e,t,n,i,r)},e.prototype.saveAsImage=function(e,t,n){console.warn("[App] Please use '.captureScreenshot' to replace '.saveAsImage'"),this.captureScreenshot(e,t,n)},e.prototype.setSkyEffect=function(e){console.warn("[App] Please use '.skyEffect={}' to replace '.setSkyEffect'"),this.skyEffect=e},e.prototype.setLighting=function(e){console.warn("[App] Please use '.lighting={}' to replace '.setLighting'"),this.lighting=e},e.prototype.setPostEffect=function(e,t){console.warn("[App] Please use '.postEffect={}' to replace '.setPostEffect'"),this.postEffect=e},e.prototype.setFog=function(e){console.warn("[App] Please use '.fog={}' to replace '.setFog'"),this.sceneManager.setFog(e)},e.prototype.loadCampus=function(e,t){return console.warn("[App] Please use 'app.create({type: 'Campus' ...}) ' to replace '.loadCampus'"),t=t||{},this.create(Ne.mergeObject(t,{type:"Campus",url:e}))},e.prototype.unloadCampus=function(e){console.warn("[App] Please use 'app.query('[url=?']).destroy() ' to replace '.unloadCampus'"),this.query("[url="+e+"]").destroy()},e.prototype.getCampus=function(e){console.warn("[App] Please use 'app.query('[url=?']) ' to replace '.getCampus'");var t=this.query("[url="+e+"]");return t.length?t[0]:null},e.prototype.showGrid=function(e,t,n,i,r){console.warn("[App] Please use 'app.root.showGrid()' to replace '.app.showGrid()'"),this.root.showGrid(e,t,n,i,r)},e.prototype.getGridSize=function(){return console.warn("[App] Please use 'app.root.gridSize' to replace '.app.getGridSize()'"),this.root.gridSize},o(e,[{key:"elapsedTime",get:function(){return Math.floor(1e3*this._elapsedTime)}},{key:"deltaTime",get:function(){return Math.floor(1e3*this._deltaTime)}},{key:"currentFrameCount",get:function(){return this._currentFrame}},{key:"pixelRatio",set:function(e){this._pixelRatio=e,this.renderer.setPixelRatio(e*window.devicePixelRatio)},get:function(){return this._pixelRatio}},{key:"size",get:function(){if(this._size)return this._size;var e=this.calcRect();return[e.width,e.height]},set:function(e){this._size=e,this.resize()}},{key:"selection",get:function(){return this._selection}},{key:"skyEffect",set:function(e){e?this.sceneManager.setSkyEffect(e):this.sceneManager.closeSkyEffect()},get:function(){var e=this.sceneManager._skyEffect;return e&&e.visible?Ne.cloneObject(e.getConfig(),!1):null}},{key:"lighting",set:function(e){e=e||Rs,this._lightGroup.setConfig(e)},get:function(){return Ne.cloneObject(this._lightGroup.getConfig(),!1)}},{key:"fog",set:function(e){e?this.sceneManager.setFog(e):this.sceneManager.closeFog()},get:function(){return this.sceneManager.fogEnable?Ne.cloneObject(this.sceneManager._fogConfig,!1):null}},{key:"postEffect",set:function(e){e?this.renderEffects.mergeConfig(e).update():this.renderEffects.mergeConfig({temporalSuperSampling:{enable:!1},postEffect:{enable:!1}}).update()},get:function(){var e=this.renderEffects.getConfig();return e.temporalSuperSampling.enable||e.postEffect.enable?Ne.cloneObject(e,!1):null}},{key:"keepBackgroundAspect",set:function(e){e!==this._keepBackgroundAspect&&(this._keepBackgroundAspect=e,e?this.sceneManager._keepBackgroundAspect():this.sceneManager._resetBackgroundAspect())},get:function(){return!!this._keepBackgroundAspect}},{key:"bgColor",get:function(){return this._bgColor?this._bgColor.toHexString():null},set:function(e){this._bgColor=Ne.parseColor(e),this.scene.background.isColor&&(this.scene.background=this._bgColor)}},{key:"background",set:function(e){this.sceneManager.background=e},get:function(){var e=this.sceneManager.background;return Ne.isNumber(e)?"#"+e.toString(16).toUpperCase():e}},{key:"backgroundAdditiveColor",set:function(e){this.sceneManager.backgroundAdditiveColor=e},get:function(){return this.sceneManager.backgroundAdditiveColor}},{key:"backgroundColorScaleFactor",set:function(e){this.sceneManager.backgroundColorScaleFactor=e},get:function(){return this.sceneManager.backgroundColorScaleFactor}},{key:"skyBox",set:function(e){this.sceneManager&&(this.sceneManager.skyBox=e)},get:function(){return this.sceneManager?this.sceneManager.skyBox:""}},{key:"needUpdate",set:function(e){if(e){if(this._dirtyFrameCount==this._currentFrame)return;this._dirtyFrameCount=this._currentFrame,this.picker&&(this.picker.needUpdate=e),this.rendererManager&&(this.rendererManager.needUpdate=e)}}},{key:"needEffectUpdate",set:function(e){e&&this.rendererManager&&(this.rendererManager.needUpdate=e)}},{key:"loadingProgressBar",get:function(){return this.mainUI.loadingProgressBar}},{key:"useAsLoader",set:function(e){this._useAsLoader=e},get:function(){return this._useAsLoader}},{key:"skipUnbindAppEvents",set:function(e){this._skipUnbindAppEvents=e},get:function(){return this._skipUnbindAppEvents}},{key:"mainDomElement",get:function(){return this.domElement}},{key:"isMobileDevice",get:function(){return void 0!==this._isMobile?this._isMobile:this._isMobile=Ae()}},{key:"level",get:function(){return this.sceneLevel}},{key:"root",get:function(){return this.sceneRoot}},{key:"mousePosition",get:function(){return this.events.mousePosition}},{key:"renderOptions",set:function(e){e=e||{},this._renderOptions=e},get:function(){return this._renderOptions}},{key:"campuses",get:function(){return console.warn("[App] The 'app.campuses' will be deleted soon, please use 'app.root.campuses' to replace it"),this.root.campuses}},{key:"buildings",get:function(){return console.warn("[App] The 'app.buildings' will be deleted soon, please use 'app.root.defaultCampus.buildings' to replace it"),this.root.defaultCampus.buildings}},{key:"disableWarning",set:function(e){console.warn("[App] Please use 'Utils.disableWarning' to replace '.disableWarning'"),Ne.disableWarning=e}},{key:"disableTime",set:function(e){console.warn("[App] Please use 'Utils.disableTime' to replace '.disableTime'"),Ne.disableTime=e}},{key:"isShiftKeyPressed",get:function(){return console.warn("[App] Please use '.isKeyPressed(THING.KeyType.Shift)' to replace '.isShiftKeyPressed'"),this.events.isKeyPressed(k.Shift)}},{key:"isControlKeyPressed",get:function(){return console.warn("[App] Please use '.isKeyPressed(THING.KeyType.Ctrl)' to replace '.isControlKeyPressed'"),this.events.isKeyPressed(k.Ctrl)}},{key:"isAltKeyPressed",get:function(){return console.warn("[App] Please use '.isKeyPressed(THING.KeyType.Alt)' to replace '.isAltKeyPressed'"),this.events.isKeyPressed(k.Alt)}},{key:"isMobile",get:function(){return console.warn("[App] Please use '.isMobileDevice' to replace '.isMobile'"),this.isMobileDevice}},{key:"wireframeColor",set:function(e){return console.warn("[App] Please use '.app.root.wireframeColor' to replace '.wireframeColor'"),this.root.wireframeColor=e}},{key:"domOffset",set:function(e){console.warn("[App] domOffset is deprecated")}},{key:"cache",get:function(){return console.warn("[App] cache is deprecated"),!1}},{key:"outdoors",set:function(e){},get:function(){return this.root?this.root.defaultCampus.outdoors:null}},{key:"loadingProgressBarVisible",set:function(e){console.warn("[App] Please use '.loadingProgressBar.visible = true/false' to replace '.loadingProgressBarVisible=true/false'"),this.mainUI.loadingProgressBar.visible=e},get:function(){return console.warn("[App] Please use '.loadingProgressBar.visible' to replace '.loadingProgressBarVisible'"),this.mainUI.loadingProgressBar.visible}},{key:"currentFrame",get:function(){return console.warn("[App] Please use '.currentFrameCount' to replace '.currentFrame'"),this.currentFrameCount}}]),e}();Ou.on=Ou.on||{};var Fu=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype._init=function(t,n){e.prototype._init.call(this,t,n),this.node.userData.baseObject_bindSubNode=this},t.prototype._updateBindSubNodeState=function(){this.node.userData.baseObject_bindSubNode_hooked=this.hasAnyEvents()},t.prototype._on=function(t,n,i,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:51,s=e.prototype._on.call(this,t,n,i,r,o,a);return this._updateBindSubNodeState(),s},t.prototype._off=function(t,n,i){var r=e.prototype._off.call(this,t,n,i);return this._updateBindSubNodeState(),r},t.prototype.canAcceptEvent=function(t){if(e.prototype.canAcceptEvent.call(this,t))return this;var n=t.intersect;return n&&n.node&&n.node==this.node?this:null},t}(Lt);Fu.create=function(e,t){var n=new Fu(t.app);return n._init(e,t),n};var Bu=Symbol("private");function Lu(e,t){e[Bu]={};var n=e[Bu];n.init=function(){var e=t.values;e&&n.addAction("___defaultValue___",e),n.onChange=t.onChange||n.onChange},n.createAction=function(e){var t=n.actions.get(e);return t||(t={name:e,result:{},results:[]},n.actions.set(e,t),t)},n.processActions=function(){var e={};n.actions.forEach((function(t){n.processAction(t,e)})),n.onChange({result:e})},n.processAction=function(e,t){e.results.forEach((function(e){var n=e.options;for(var i in n){var r=n[i];t[i]=r}}))},n.addAction=function(e,t,i,r){var o=n.createAction(e),a={options:t,tag:i,priority:r,index:o.results.length};o.results.push(a),o.results.sort((function(e,t){return e.priority!==t.priority?t.priority-e.priority:e.index-t.index})),n.processActions()},n.removeAction=function(e,t){var i=n.actions.get(e);if(i)for(var r=i.results,o=0;o<r.length;o++){if(r[o].tag==t)return r.splice(o,1),void n.processActions()}},n.actions=new Map,n.onChange=function(){},n.init()}var Iu=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),Lu(this,t)}return e.prototype.add=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=this[Bu];r.addAction(e,t,n,i)},e.prototype.remove=function(e,t){e&&this[Bu].removeAction(e,t)},e}(),Nu=Symbol("private");var Hu=new THREE.Matrix4,zu=new THREE.Vector3,Uu=new THREE.Vector2,Vu=new THREE.Vector3,qu=new THREE.Vector3,Gu=new THREE.Vector3,Wu=new THREE.Vector3,Xu=new THREE.Vector3,Ju=new THREE.Vector3,Yu=new THREE.Quaternion,Qu=(new THREE.Quaternion,new THREE.Box3),Zu=new THREE.Raycaster,Ku=new THREE.Vector3,$u=new THREE.Vector3,ec=new THREE.Quaternion,tc=new THREE.Quaternion,nc=new THREE.Matrix4,ic=new THREE.Matrix4,rc=["clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","map","matcap","alphaMap","lightMap","aoMap","bumpMap","normalMap","displacementMap","roughnessMap","metalnessMap","emissiveMap","specularMap","envMap","gradientMap"],oc={};function ac(e,t){if("string"!=typeof e)throw new TypeError("expected path to be a string");if("\\"===e||"/"===e)return"/";var n=e.length;if(n<=1)return e;var i="";if(n>4&&"\\"===e[3]){var r=e[2];"?"!==r&&"."!==r||"\\\\"!==e.slice(0,2)||(e=e.slice(2),i="//")}var o=e.split(/[/\\]+/);return!1!==t&&""===o[o.length-1]&&o.pop(),i+o.join("/")}oc.WHITE=16777215,oc.SILVER=12632256,oc.GRAY=8421504,oc.BLACK=0,oc.RED=16711680,oc.MAROON=8388608,oc.GREEN=32768,oc.BLUE=255,oc.NAVY=128,oc.YELLOW=16776960,oc.OLIVE=8421376,oc.FUCHSIA=16711935,oc.MAGENTA=16711935,oc.LIME=914021,oc.PURPLE=8388736,oc.LAWN=3135031,oc.AQUA=65535,oc.CYAN=65535,oc.TEAL=32896,oc.ORANGE=16753920,oc.VIOLET=7737555,oc.GREENYELLOW=6617095,oc.createFrustumFOV=function(e,t,n,i){var r=n*Math.tan(THING.Math.degToRad(e)/2),o=-r,a=t*r,s=-a;return oc.createFrustum(a,s,r,o,n,i)},oc.createFrustum=function(e,t,n,i,r,o){var a=new THREE.Geometry,s=new THREE.LineBasicMaterial({color:16777215,linewidth:3,vertexColors:THREE.FaceColors}),l=o/r,u={ltn:new THREE.Vector3(e,n,r),lbn:new THREE.Vector3(e,i,r),rbn:new THREE.Vector3(t,i,r),rtn:new THREE.Vector3(t,n,r),ltf:new THREE.Vector3(l*e,l*n,o),lbf:new THREE.Vector3(l*e,l*i,o),rbf:new THREE.Vector3(l*t,l*i,o),rtf:new THREE.Vector3(l*t,l*n,o)};function c(e,t,n){h(e,n),h(t,n)}function h(e,t){var n=new THREE.Vector3;n.copy(u[e]),a.vertices.push(n),a.colors.push(new THREE.Color(t))}return c("ltn","lbn",oc.RED),c("lbn","rbn",oc.RED),c("rbn","rtn",oc.RED),c("rtn","ltn",oc.RED),c("ltf","lbf",oc.LIME),c("lbf","rbf",oc.LIME),c("rbf","rtf",oc.LIME),c("rtf","ltf",oc.LIME),c("ltf","ltn",oc.BLUE),c("lbf","lbn",oc.BLUE),c("rbf","rbn",oc.BLUE),c("rtf","rtn",oc.BLUE),new THREE.Line(a,s,THREE.LinePieces)},String.prototype.getNormalize=function(){var e=this.indexOf("://");return-1!==e?this.substring(0,e+3)+ac(this.substring(e+3)):ac(this.substring())},String.prototype.startsWith=function(e){return this.slice(0,e.length)===e},String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)},String.prototype.contains=function(e){return this.indexOf(e)>=0},String.prototype.isBlank=function(){return Ne.isBlank(this)},String.prototype.getFileName=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.indexOf("\\")>=0?this.lastIndexOf("\\"):this.lastIndexOf("/");if(-1===t)return e?this:this.split(".")[0];var n=this.substring(t);return 0!==n.indexOf("\\")&&0!==n.indexOf("/")||(n=n.substring(1)),e?n:n.split(".")[0]},String.prototype.getPath=function(){var e=this.indexOf("\\")>=0?this.lastIndexOf("\\"):this.lastIndexOf("/");return this.substring(0,e)},String.prototype.getSearchName=function(){var e=this.getFileName(),t=e.indexOf("?");return-1===t?"":e.substring(t)},String.prototype.getExtension=function(){var e=this.split(".");if(e.length>1){var t=e.pop(),n=t.indexOf("?");return-1!==n?t.substring(0,n):t}return""},String.prototype._trimLeft=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("^["+e+"]+"),"")},String.prototype._trimRight=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("["+e+"]+$"),"")},String.prototype.trimBoth=function(e){return this._trimLeft(e)._trimRight(e)},String.prototype.appendPath=function(e){return this._trimRight("/")+"/"+e._trimLeft("/")._trimRight("/")},String.prototype.appendRandomSuffix=function(){return this.substring()+"?t="+(new Date).getTime()},String.prototype.equals=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return null!=e&&(t?this.toUpperCase()==e.toUpperCase():this==e)},String.prototype.replaceAll=function(e,t){return"\\"==e&&(e="\\\\"),this.replace(new RegExp(e,"gm"),t)},String.prototype.removeAt=function(e){var t=this.substring(0);return e>=this.length?t:t.slice(0,e)+t.slice(e+1)},THREE.Color.prototype.copy=function(e){return e&&(this.r=e.r,this.g=e.g,this.b=e.b),this},THREE.Color.prototype.toHexString=function(){return"#"+this.getHexString().toUpperCase()},THREE.Color.prototype.toRGBArray=function(){var e=[];return e.push(Math.ceil(255*this.r)),e.push(Math.ceil(255*this.g)),e.push(Math.ceil(255*this.b)),e},THREE.Line.prototype.updatePosition=function(e,t){var n=this.geometry.vertices;if(2==n.length){var i=n[0],r=n[1];i.equals(e)&&r.equals(t)||(i.x=e.x,i.y=e.y,i.z=e.z,r.x=t.x,r.y=t.y,r.z=t.z,this.geometry.boundingSphere=null,this.geometry.verticesNeedUpdate=!0,this.computeLineDistances())}};for(var sc=function(){var e=THING.App.current?THING.App.current.level.current:null;return e?e._getBaseMatrix():null},lc=[],uc=0;uc<256;uc++)lc[uc]=(uc<16?"0":"")+uc.toString(16).toUpperCase();THREE.MathUtils.generateUUID=function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return lc[255&e]+lc[e>>8&255]+lc[e>>16&255]+lc[e>>24&255]+"-"+lc[255&t]+lc[t>>8&255]+"-"+lc[t>>16&15|64]+lc[t>>24&255]+"-"+lc[63&n|128]+lc[n>>8&255]+"-"+lc[n>>16&255]+lc[n>>24&255]+lc[255&i]+lc[i>>8&255]+lc[i>>16&255]+lc[i>>24&255]},THREE.Vector3.prototype.getPositionFromSpherical=function(e,t,n){var i=new THREE.Vector3,r=Math.sin(n);return i.x=r*Math.cos(t),i.y=-Math.cos(n),i.z=r*Math.sin(t),i.normalize(),i.multiplyScalar(e),i.add(this),i},THREE.Vector3.prototype.getDirectionFromAngles=function(e,t,n){var i=Ne.parseVector3(THING.Math.directionFromAlphaBeta(e,t));return i.normalize(),i.multiplyScalar(n),i.add(this),i},THREE.Vector3.prototype.getDirectionFromPosition=function(e,t){var n=new THREE.Vector3;return n.subVectors(e,this),n.normalize(),n.multiplyScalar(t),n.add(this),n},THREE.Vector3.prototype.getMinVector=function(e){var t=this.clone();if(Ne.isArray(e))for(var n=0;n<e.length;n++)t.min(e[n]);else t.min(e);return t},THREE.Vector3.prototype.getMaxVector=function(e){var t=this.clone();if(Ne.isArray(e))for(var n=0;n<e.length;n++)t.max(e[n]);else t.min(e);return t},THREE.Vector3.prototype.toLogString=function(){return"x: "+this.x+", y: "+this.y+", z: "+this.z},THREE.Vector3.prototype.isEqual=function(e){return!!Ne.isEqual(this.x,e.x)&&(!!Ne.isEqual(this.y,e.y)&&!!Ne.isEqual(this.z,e.z))},THREE.Vector3.prototype.log=function(){console.log(this.toLogString())},THREE.Vector4.prototype.project=function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},THREE.Vector4.prototype.unproject=function(e){var t=new THREE.Matrix4;return this.applyMatrix4(t.getInverse(e.projectionMatrix)).applyMatrix4(e.matrixWorld)},THREE.Object3D.prototype.dispose=function(){var e=this.parent;e&&e.remove(this),this.traverse((function(e){e.geometry&&e.geometry.dispose();var t=e.material;if(t)if(Ne.isArray(t))for(var n=0;n<t.length;n++)t[n].dispose();else t.dispose();e.skeleton&&e.skeleton.boneTexture&&e.skeleton.boneTexture.dispose()}))},THREE.Object3D.prototype.getVerticesCount=function(){var e=0;return this.traverse((function(t){t.geometry&&(e+=t.geometry.getVerticesCount())})),e},THREE.Object3D.prototype.getDirection=function(e){var t=this.matrix.elements;return e.set(t[8],t[9],t[10]).normalize()},THREE.Object3D.prototype._premultiplyMatrix=function(e){this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},THREE.Object3D.prototype._mergeAllGeometries=function(){this.updateMatrixWorld();var e=new THREE.Geometry;return this.traverse((function(t){if(t.isMesh){var n=t.geometry;n.isBufferGeometry&&(n=(new THREE.Geometry).fromBufferGeometry(n)),e.merge(n,t.matrixWorld)}})),e},THREE.Object3D.prototype._getMatrixWorld=function(){var e=this.matrixWorld,t=sc();return t&&(e=e.clone()).premultiply(t),e},THREE.Object3D.prototype.getBaseObjectOwner=function(){for(var e=this;e;e=e.parent){var t=e.userData.object;if(t)return t}return null};var cc=THREE.Object3D.prototype.copy;THREE.Object3D.prototype.copy=function(e,t){return cc.call(this,e,t),this.technique=Ne.cloneObject(e.technique),this._cachedTechnique=Ne.cloneObject(e._cachedTechnique),e._wName&&(this._wName=e._wName),this},THREE.Object3D.prototype.setUserDataValue=function(e,t){this.traverse((function(n){n.userData[e]=t}))},THREE.Object3D.prototype.isMaterialVisible=function(){var e=this.material;if(!e)return!1;if(void 0!==e.length){for(var t=0;t<e.length;t++)if(e[0].visible)return!0;return!1}return e.visible},THREE.Object3D.prototype.isRenderable=function(){return!!(this.isSprite||this.isMesh||this.isLine||this.isPoints||this.isImmediateRenderObject)},THREE.Object3D.prototype.isDebuggerNode=function(){for(var e=this;e;){if(e.userData.isDebuggerNode)return!0;e=e.parent}return!1},THREE.Object3D.prototype.cleanup=function(){function e(e){return!e.children.length}function t(n){for(var i=0,r=0;r<n.children.length;r++){var o=n.children[r];o.isRenderable()||(e(o)?(o.parent=null,n.children.splice(r--,1),i++):i+=t(o))}return i}for(;;){if(!t(this))break}},THREE.Object3D.prototype.onBeforeUpdateModelViewMatrix=function(e,t,n,i,r,o){},THREE.Object3D.prototype.hasBeforeRenderFunction=function(e){if(!this._beforeRenderFunctions)return!1;for(var t=0;t<this._beforeRenderFunctions.length;t++){if(this._beforeRenderFunctions[t].name==e)return!0}return!1},THREE.Object3D.prototype.addBeforeRenderFunction=function(e,t,n){if(t&&(this.traverseChild((function(i){i.isRenderable()&&i.addBeforeRenderFunction(e,t,n)})),this._beforeRenderFunctions=this._beforeRenderFunctions||[],void 0!==n&&this._beforeRenderFunctions.length?this._beforeRenderFunctions.splice(n,0,{name:e,func:t}):this._beforeRenderFunctions.push({name:e,func:t}),1===this._beforeRenderFunctions.length)){var i=this.onBeforeRender;i&&"function () {}"!=i.toString()&&this._beforeRenderFunctions.splice(0,0,{name:"__originalBeforeRender__",func:i});var r=this;this.onBeforeRender=function(e,t,n,i,o,a){for(var s=0,l=r._beforeRenderFunctions.length;s<l;s++){r._beforeRenderFunctions[s].func.call(r,e,t,n,i,o,a)}}}},THREE.Object3D.prototype.removeBeforeRenderFunction=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&this.traverseChild((function(t){t.isRenderable()&&t.removeBeforeRenderFunction(e)})),this._beforeRenderFunctions=this._beforeRenderFunctions||[];for(var n=0;n<this._beforeRenderFunctions.length;n++){var i=this._beforeRenderFunctions[n],r=Ne.isFunction(e)?i.func:i.name;r==e&&this._beforeRenderFunctions.splice(n--,1)}this._beforeRenderFunctions.length||(this.onBeforeRender=function(e,t,n){})},THREE.Object3D.prototype.setPickable=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.userData.skipPick=!e,t&&this.traverse((function(t){var n=t.userData;e?delete n.skipPick:n.skipPick=!0}))},THREE.Object3D.prototype.getPickable=function(){return!this.userData.skipPick},THREE.Object3D.prototype.showAll=function(){for(var e=this;e;)e.visible=!0,e=e.parent;this.getNodes().forEach((function(e){e.ensureVisible(!0,!0)}))},THREE.Object3D.prototype.setLayerVisible=function(e){e?this.layers.enable(0):this.layers.disable(0)},THREE.Object3D.prototype.getLayerVisible=function(){return!!(1&this.layers.mask)},THREE.Object3D.prototype.isVisible=function(){for(var e=this;e;e=e.parent)if(!e.visible)return!1;return this.getVisible()},THREE.Object3D.prototype.ensureParentsVisible=function(e){this.traverseParents((function(t){t.visible=e}))},THREE.Object3D.prototype.ensureVisible=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===e){if(this.userData.useVisibleOnly)return this.visible;for(var n=this;n;n=n.parent)if(!n.visible)return!1;return this.getLayerVisible()}if(!Ne.isBoolean(e)){var i=this.userData;if(!i.alwaysPickable)for(var r=this;r;){if(!r.visible)return!1;if(e&&!r.layers.test(e.layers))return!1;r=r.parent}return!0}var o=e;this.userData.useVisibleOnly?this.visible=o:(this.setLayerVisible(o),t&&(this.visible=o))},THREE.Object3D.prototype.getVisible=function(){return this.ensureVisible()},THREE.Object3D.prototype.getTypeString=function(){return this.isSprite?"Sprite":this.isMesh?"Mesh":this.isLine?"Line":this.isPoints?"Points":this.isScene?"Scene":this.isGroup?"Group":"Object3D"},THREE.Object3D.prototype.getObjectByUUID=function(e){var t=null;return this.traverseBranch((function(n){if(n.uuid==e)return t=n,!1})),t},THREE.Object3D.prototype.setActive=function(e){this.visible=e},THREE.Object3D.prototype.getActive=function(){return this.visible},THREE.Object3D.prototype.traverseParents=function(e){if(e)for(var t=this.parent;t;t=t.parent)e(t)},THREE.Object3D.prototype.traverseChild=function(e){for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverse(e)},THREE.Object3D.prototype.traverseBreakable=function(e){if(e(this))return this;for(var t=this.children,n=0,i=t.length;n<i;n++){var r=t[n].traverseBreakable(e);if(r)return r}return null},THREE.Object3D.prototype.traverseBranch=function(e){if(!1!==e(this))for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverseBranch(e)},THREE.Object3D.prototype.traverseAll=function(e){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverseAll(e)},THREE.Object3D.prototype.traverseRenderableNodes=function(e){this.traverse((function(t){t.isRenderable()&&e(t)}))},THREE.Object3D.prototype.getRoot=function(){var e=this.parent;if(!e)return this;for(;e.parent;)e=e.parent;return e},THREE.Object3D.prototype.indexOf=function(e){return e?this.children.indexOf(e):-1},THREE.Object3D.prototype.indexOfParent=function(){var e=this.parent;if(e)return e.children.indexOf(this)},THREE.Object3D.prototype.isChildOf=function(e){for(var t=this.parent;t;){if(t==e)return!0;t=t.parent}return!1},THREE.Object3D.prototype.getChildIndex=function(e){for(var t=0;t<this.children.length;t++)if(this.children[t]==e)return t;return-1},THREE.Object3D.prototype.getIndexPath=function(e){for(var t=[],n=this;n.parent;){var i=n.parent,r=i.getChildIndex(n);if(-1==r)break;if(t.push(r),i==e)break;n=i}return t},THREE.Object3D.prototype.getChildNodeByIndexPath=function(e){for(var t=this,n=0;n<e.length;n++){var i=e[n];if(i>=t.children.length)return null;t=t.children[i]}return t},THREE.Object3D.prototype.getChildNodesNumber=function(){var e=0;return this.traverse((function(){e++})),e},THREE.Object3D.prototype.getBones=function(e,t){for(var n=[],i=0;i<t.bones.length;i++){for(var r=t.bones[i].getIndexPath(e),o=this,a=r.length-1;a>=0;a--){var s=r[a];o=o.children[s]}n.push(o)}return n},THREE.Object3D.prototype._detachFromParent=function(e,t){this.applyMatrix4(e.matrixWorld),e.remove(this),t.add(this)},THREE.Object3D.prototype._attachToParent=function(e,t){this.applyMatrix4((new THREE.Matrix4).getInverse(t.matrixWorld)),e&&e.remove(this),t.add(this)},THREE.Object3D.prototype.attachToParent=function(e,t,n){void 0===t?t=e:Ne.isBoolean(t)&&(n=t,t=e),this.parent&&(n&&this.updateWorldMatrix(!0,!1),this._detachFromParent(this.parent,t)),e&&(n&&e.updateWorldMatrix(!0,!1),this._attachToParent(t,e))},THREE.Object3D.prototype.detachFromParent=function(e){this.parent.updateMatrixWorld(),this._detachFromParent(this.parent,e)},THREE.Object3D.prototype.attachChildren=function(e,t){this.updateMatrixWorld();for(var n=0;n<e.length;n++)THREE.SceneUtils.attach(e[n],t,this)},THREE.Object3D.prototype.detachChildren=function(e){this.updateMatrixWorld();for(var t=this.children.concat(),n=0;n<t.length;n++){t[n]._detachFromParent(this,e)}return t},THREE.Object3D.prototype.getChildrenNames=function(){var e=[];return this.traverse((function(t){t.name.isBlank()||e.push(t.name)})),e},THREE.Object3D.prototype.getVisibleChildrenNumber=function(){var e=0;return this.traverse((function(t){t.visible&&e++})),e},THREE.Object3D.prototype.getInvisibleChildrenNumber=function(){var e=0;return this.traverse((function(t){t.visible||e++})),e},THREE.Object3D.prototype.getParents=function(){for(var e=[],t=this.parent;t;t=t.parent)e.push(t);return e},THREE.Object3D.prototype.getInvalidNodes=function(){var e=[];return this.traverse((function(t){var n=t.scale;0!=n.x&&0!=n.y&&0!=n.z||e.push(t)})),e},THREE.Object3D.prototype.getGeometries=function(){var e=new Set;return this.traverse((function(t){var n=t.geometry;n&&e.add(n)})),Array.from(e)},THREE.Object3D.prototype.getVisibleMeshes=function(){var e=[];return this.traverse((function(t){t.isMesh&&t.ensureVisible()&&e.push(t)})),e},THREE.Object3D.prototype.getMeshes=function(){var e=[];return this.traverse((function(t){t.isMesh&&e.push(t)})),e},THREE.Object3D.prototype.getSprites=function(){var e=[];return this.traverse((function(t){t.isSprite&&e.push(t)})),e},THREE.Object3D.prototype.getRenderableNodes=function(){var e=[];return this.traverse((function(t){t.isRenderable()&&e.push(t)})),e},THREE.Object3D.prototype.getImages=function(){var e=new Set;return this.getMaterials().forEach((function(t){rc.forEach((function(n){var i=t[n];if(i){var r=i.image;r&&(Ne.isArray(r)?r.forEach((function(t){e.add(t)})):e.add(r))}}))})),Array.from(e)},THREE.Object3D.prototype.getTextures=function(){var e=new Set;return this.getMaterials().forEach((function(t){Object.keys(t).forEach((function(n){var i=t[n];i&&i.isTexture&&e.add(i)}))})),Array.from(e)},THREE.Object3D.prototype.getTexturesFromImage=function(e){for(var t=[],n=this.getTextures(),i=0;i<n.length;i++){var r=n[i];r.image==e&&t.push(r)}return t},THREE.Object3D.prototype.getTexturesFromURL=function(e){for(var t=[],n=this.getTextures(),i=0;i<n.length;i++){var r=n[i];r.image.currentSrc==e&&t.push(r)}return t},THREE.Object3D.prototype.traverseMaterials=function(e){this.traverse((function(t){var n=t.material;if(n)if(Ne.isArray(n))for(var i=0;i<n.length;i++)e(n[i]);else e(n)}))},THREE.Object3D.prototype.traverseTextures=function(e){this.traverse((function(t){var n=t.material;if(n)if(Ne.isArray(n))for(var i=0;i<n.length;i++)for(var r in n[i]){(o=n[i][r])&&o.isTexture&&e(n[i],r,o)}else for(var r in n){var o;(o=n[r])&&o.isTexture&&e(n,r,o)}}))},THREE.Object3D.prototype.getMaterials=function(){var e=new Set;return this.traverse((function(t){var n=t.material;n&&(Ne.isArray(n)?n.forEach((function(t){e.add(t)})):e.add(n))})),Array.from(e)},THREE.Object3D.prototype.getMeshByName=function(e){var t=null;return this.traverseBreakable((function(n){if(n.isMesh&&n.name==e)return t=n,!0})),t},THREE.Object3D.prototype.hasMesh=function(){var e=!1;return this.traverseBreakable((function(t){if(t.isMesh)return e=!0})),e},THREE.Object3D.prototype.getMeshNames=function(){var e=[];return this.traverse((function(t){t.isMesh&&e.push(t.name)})),e},THREE.Object3D.prototype.getSkinnedMeshes=function(){var e=[];return this.traverse((function(t){t.isSkinnedMesh&&e.push(t)})),e},THREE.Object3D.prototype.hasSkinnedMesh=function(){var e=!1;return this.traverseBreakable((function(t){if(t.isSkinnedMesh)return e=!0})),e},THREE.Object3D.prototype.hasSprite=function(){var e=!1;return this.traverseBreakable((function(t){if(t.isSprite)return e=!0})),e},THREE.Object3D.prototype.hasMaterial=function(e){if(!e)return!1;var t=!1;return this.traverseBreakable((function(n){if(n.material==e)return t=!0})),t},THREE.Object3D.prototype.hasGeometry=function(e){if(!e)return!1;var t=!1;return this.traverseBreakable((function(n){if(n.geometry==e)return t=!0})),t},THREE.Object3D.prototype.hasTexture=function(e){if(!e)return!1;function t(t){for(var n=Object.keys(t),i=0;i<n.length;i++){var r=t[n[i]];if(r&&r.isTexture&&r==e)return!0}return!1}var n=!1;return this.traverseBreakable((function(e){var i=e.material;if(i)if(Ne.isArray(i)){if(t(i))return n=!0}else if(t(i))return n=!0})),n},THREE.Object3D.prototype.replace=function(e,t,n){if(t&&t.isObject3D)for(var i=0;i<this.children.length;i++){var r=this.children[i];if(r==e){n&&n(r),r=void 0,t.parent=this,this.children[i]=t;break}}},THREE.Object3D.prototype.insert=function(e,t){e>this.children.length||t&&(this.children.splice(e,0,t),t.parent=this)},THREE.Object3D.prototype.removeBySelf=function(){this.parent&&this.parent.remove(this)},THREE.Object3D.prototype.getAngles=function(){return Ne.parseAngles(this.rotation)},THREE.Object3D.prototype.setAngles=function(e){var t=Ne.parseEuler(e);this.rotation.copy(t),this.updateMatrixWorld(!1,!1)},THREE.Object3D.prototype.getFacesNumber=function(){var e=0;return this.traverse((function(t){if(t.isMesh){var n=t.geometry;if(n.isBufferGeometry){var i=n.index;e+=i?i.count/3:n.attributes.position.count/3}else n.isGeometry&&(e+=n.faces.length)}})),e},THREE.Object3D.prototype.getVerticesNumber=function(){var e=0;return this.traverse((function(t){if(t.isMesh){var n=t.geometry;if(n.isBufferGeometry){var i=n.index;e+=i?n.index.count:n.attributes.position.count}else n.isGeometry&&(e+=n.vertices.length)}})),e},THREE.Object3D.prototype.getNodes=function(){var e=[];return this.traverse((function(t){e.push(t)})),e},THREE.Object3D.prototype.getNodeByID=function(e){var t;return this.traverseBreakable((function(n){if(n.id==e)return t=n,!0})),t},THREE.Object3D.prototype.getNodeByUUID=function(e){var t;return this.traverseBreakable((function(n){if(n.uuid==e)return t=n,!0})),t},THREE.Object3D.prototype.getParent=function(){return this.parent},THREE.Object3D.prototype.setTransform=function(e){var t=new THREE.Vector3,n=new THREE.Vector3,i=new THREE.Quaternion;e.decompose(t,i,n),this.quaternion.copy(i),this.position.copy(t),this.scale.copy(n)},THREE.Object3D.prototype.getDistanceFromCamera=function(e){if(this.parent){this.updateWorldMatrix(!0);var t=new THREE.Vector3;return this.getWorldPosition(t),e.distanceTo(t)}},THREE.Object3D.prototype.keepSize=function(e,t,n,i,r,o){if(this.parent){i&&this.updateWorldMatrix(!0,!1);var a=new THREE.Vector3;a.setFromMatrixPosition(this.matrixWorld).applyMatrix4(o);var s=-a.z;if(t.isVector2){var l=[n/t.x,n/t.y];this.scale.set(s/l[0],s/l[1],1)}else if(t.isVector3){l=[n/t.x,n/t.y,n/t.z];this.scale.set(s/l[0],s/l[1],s/l[2])}r&&this._synMatrixWorld()}},THREE.Object3D.prototype._synMatrixWorld=function(){this.updateWorldMatrix(!0,!0)},THREE.Object3D.prototype._getWorldPosition=function(e){return void 0===e&&(e=new THREE.Vector3),e.setFromMatrixPosition(this._getMatrixWorld())},THREE.Object3D.prototype._setWorldPosition=function(e,t){Ku.copy(e),this.parent&&(this.parent.updateWorldMatrix(!0),this.parent.worldToLocal(Ku)),this.position.copy(Ku),t&&this._synMatrixWorld()},THREE.Object3D.prototype._setWorldQuaternion=function(e){ec.copy(e),this.parent&&(this.parent.updateWorldMatrix(!0),this.parent.matrixWorld.decompose(Ku,tc,Ku),tc.inverse(),ec.premultiply(tc)),this.quaternion.copy(ec)},THREE.Object3D.prototype._setWorldAngles=function(e,t){this.parent&&(this.updateWorldMatrix(!0,!1),this.parent.matrixWorld.decompose(qu,Yu,Ju),Yu.inverse(),e.premultiply(Yu)),this.quaternion.copy(e),t&&this._synMatrixWorld()},THREE.Object3D.prototype._setWorldScale=function(e,t){this.parent?(this.updateWorldMatrix(!0),this.matrixWorld.decompose($u,ec,Ku),Ku.copy(e),ic.compose($u,ec,Ku),nc.getInverse(this.parent.matrixWorld),ic.premultiply(nc),ic.decompose($u,ec,Ku)):Ku.copy(e),this.scale.copy(Ku),t&&this._synMatrixWorld()},THREE.Object3D.prototype._getWorldScale=function(){this.updateWorldMatrix(!0,!1);var e=new THREE.Vector3,t=new THREE.Quaternion,n=new THREE.Vector3;return this.matrixWorld.decompose(e,t,n),n},THREE.Object3D.prototype.cloneByFilter=function(e){for(var t=this.clone(!1),n=0;n<this.children.length;n++){var i=this.children[n];if(!e||e(i)){var r=i.cloneByFilter(e);t.add(r)}}return t},THREE.Object3D.prototype.getForwardPosition=function(e){var t=new THREE.Vector3;return this.updateMatrixWorld(!0),this.getWorldDirection(t),t.normalize(),t.multiplyScalar(e),t.add(this.position),t},THREE.Object3D.prototype._faceTo=function(e){var t=this.worldToLocal(e.clone()),n=(new THREE.Vector3).crossVectors(new THREE.Vector3(0,0,1),t).normalize(),i=new THREE.Vector3(0,0,1).angleTo(t.normalize().clone());this.rotateOnAxis(n,i)},THREE.Object3D.prototype._lookAtPosition=function(e,t){var n=(e=e||{}).type,i=e.axis,r=e.quat,o=e.target,a=e.targetPosition,s=e.targetLocalPosition;if("axis"==n&&"y"==i){e.billboard&&(this.rotation.x=0,this.rotation.z=0);var l=this.position;if(o&&o.isCameraController){var u=Ne.parseVector3(a),c=new THREE.Vector3;this.getWorldPosition(c);var h=o.direction,p=c.clone().sub(u).projectOnPlane(Ne.parseVector3(h));p.add(u),this.parent&&this.parent.worldToLocal(p),this.rotation.y=Math.atan2(p.x-l.x,p.z-l.z)}else this.rotation.y=Math.atan2(s.x-l.x,s.z-l.z)}else this.isCamera||!o||o.isCameraController||this.up.copy(new THREE.Vector3(0,1,0).transformDirection(this.matrixWorld)),this.lookAt(a),"axis"==n&&("x"==i?this.rotateY(-Math.PI/2):"z"==i&&this.rotateX(-Math.PI/2));r&&this.quaternion.multiply(r),t?this._synMatrixWorld():this.updateWorldMatrix(!1,!1)},THREE.Object3D.prototype._lookAt=function(e,t){if(this.removeBeforeRenderFunction("__lookAt__"),e){var n=this;this.addBeforeRenderFunction("__lookAt__",(function(i,r,o,a,s,l){var u=e.targetPosition||o;u.isObject3D&&(u=u.position),e.targetPosition=u,e.target={direction:o.getDirection(new THREE.Vector3),isCameraController:!0},n._lookAtPosition(e,Ne.isFunction(t)?t():t)}))}},THREE.Object3D.prototype.skipBoundingBox=function(e){this.traverse((function(t){e?t.userData.skipBoundingBox=e:delete t.userData.skipBoundingBox}))},THREE.Object3D.prototype.setFrustumCulled=function(e){this.traverse((function(t){t.frustumCulled=e}))},THREE.Object3D.prototype.getMatrixWorldFromRoot=function(e){this.updateWorldMatrix(!0);var t=new THREE.Matrix4;if(e)for(var n=this;;){if(n==e){t.premultiply(n.matrixWorld);break}t.premultiply(n.matrix),n=n.parent}return t},THREE.Object3D.prototype.getMatrixFromRoot=function(e){var t=new THREE.Matrix4;if(e)for(var n=this;n!=e;)n.updateMatrix(),t.premultiply(n.matrix),n=n.parent;return t},THREE.Object3D.prototype.disposeMaterial=function(){if(this.material){if(Ne.isArray(this.material))for(var e=0;e<this.material.length;e++){this.material[e].dispose()}else this.material.dispose();this.material=null}},THREE.Object3D.prototype.decomposeTransform=function(e,t,n){return this.matrix.decompose(e,t,n),this},THREE.Object3D.prototype.decomposeWorldTransform=function(e,t,n){return this.updateWorldMatrix(!0),this.matrixWorld.decompose(e,t,n),this},THREE.Matrix4.prototype.setScale=function(e){var t=this.elements;return t[0]=e.x,t[5]=e.y,t[10]=e.z,this},THREE.Euler.prototype.multiplyMatrix4=function(e){var t=new THREE.Quaternion;t.setFromEuler(this);var n=new THREE.Quaternion;n.setFromRotationMatrix(e),t.multiply(n),this.setFromQuaternion(t)},THREE.Euler.prototype.setRotationOrder=function(e){var t=new THREE.Quaternion;t.setFromEuler(this,!1),this.setFromQuaternion(t,e,!0)},THREE.Quaternion.prototype.multiplyMatrix4=function(e){var t=new THREE.Quaternion;t.setFromRotationMatrix(e),this.multiply(t)},THREE.Quaternion.prototype.getAngles=function(){return Ne.parseAngles(this)},THREE.Frustum.prototype._intersectsObject=function(e){var t=this;return e=e.traverseBreakable((function(e){return e.isMesh&&t.intersectsObject(e)?e:null}))},THREE.PerspectiveCamera.prototype.orthoSize=function(e,t){var n=Ne.parseVector3(t),i=e.distanceTo(n),r=2*Math.tan(this.fov/2*Math.PI/180),o=r*i;return{x:o*this.aspect,y:o,depth:r,z:i}},THREE.OrthographicCamera.prototype.orthoSize=function(){return{x:(this.right-this.left)/this.zoom,y:(this.top-this.bottom)/this.zoom}},THREE.OrthographicCamera.prototype.resize=function(e,t){if(void 0!==this.userData){var n=this.userData.depth*this.userData.z,i=n*(e/t);this.left=-i/2,this.right=i/2,this.top=n/2,this.bottom=-n/2,this.updateProjectionMatrix()}},Object.defineProperty(THREE.CombinedCamera.prototype,"isPerspectiveCamera",{get:function(){return this.inPerspectiveMode}}),Object.defineProperty(THREE.CombinedCamera.prototype,"isOrthographicCamera",{get:function(){return this.inOrthographicMode}}),Object.defineProperty(THREE.CombinedCamera.prototype,"isLerping",{get:function(){return this.isPerspectiveLerping||this.isOrthoLerping}}),THREE.CombinedCamera.prototype.getRaycaster=function(e,t,n){return Zu._setFromCamera(e,t,this,n)},THREE.CombinedCamera.prototype.setNear=function(e){this.cameraP.near=e,this.cameraO.near=e,this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.setFar=function(e){this.cameraP.far=e,this.cameraO.far=e,this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.getProjectionMatrixAlways=function(){return this._backupProjectionMatrix&&(this.isOrthoLerping||this.isOrthographicCamera)?this._backupProjectionMatrix:this.projectionMatrix},THREE.CombinedCamera.prototype.toPerspectiveCamera=function(){var e=new THREE.CombinedCamera(1,1,1,1,1,1,1);return e.fov=this.fov,e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.cameraO=new THREE.OrthographicCamera(1,1,1,1,1,1),e.cameraO.copy(this.cameraO),e.cameraP=new THREE.PerspectiveCamera(1,1,1,1),e.cameraP.copy(this.cameraP),e.zoom=this.zoom,e.toPerspective(),e},THREE.CombinedCamera.prototype.toOrthoCamera=function(e,t){var n=this.cameraP.orthoSize(e,t),i=new THREE.CombinedCamera(n.x,n.y,this.fov,this.near,this.far,this.cameraO.near,this.cameraO.far);return i.orthoSize=n,i.toOrthographic(),i},THREE.CombinedCamera.prototype.lerpMatrix=function(e){var t=(e=e||{}).fromMatrix,n=e.toMatrix,i=e.time,r=e.lerpType||M.Quintic.Out,o=e.start,a=e.stop,s=e.complete,l=Ne.toMatrixElementsArray(t),u=Ne.toMatrixElementsArray(n);this.matrixTween&&this.matrixTween.stop(),this.matrixTween=new TWEEN.Tween(l).to(u,i).easing(r).onStart((function(){o&&o()})).onUpdate((function(){Ne.elementsArrayToMatrix(t,this._object)})).onStop((function(){a&&a()})).onComplete((function(){s&&s()})).start()},THREE.CombinedCamera.prototype.lerpToOrthographic=function(e,t,n,i){var r=this.toOrthoCamera(e,t);this.orthoSize=r.orthoSize,this.zoom=1,this.isOrthoLerping=!0,this._backupProjectionMatrix=this.projectionMatrix.clone();var o=this;this.lerpMatrix({lerpType:M.Cubic.InOut,fromMatrix:this.projectionMatrix,toMatrix:r.projectionMatrix,time:n,stop:function(){o.isOrthoLerping=!1,i&&i()},complete:function(){o.isOrthoLerping=!1,o.toOrthographic(),i&&i()}})},THREE.CombinedCamera.prototype.lerpToPerspective=function(e,t){var n=this.toPerspectiveCamera();this.isPerspectiveLerping=!0;var i=this;this.lerpMatrix({fromMatrix:this.projectionMatrix,toMatrix:n.projectionMatrix,time:e,stop:function(){i.isPerspectiveLerping=!1,t&&t()},complete:function(){i.isPerspectiveLerping=!1,i.toPerspective(),t&&t()}})},THREE.CombinedCamera.prototype.getEffectiveFOV=function(){return this.cameraP.getEffectiveFOV()},THREE.CombinedCamera.prototype.isInView=function(e){var t=new THREE.Matrix4;t.multiplyMatrices(this.projectionMatrix,this.matrixWorldInverse);var n=new THREE.Frustum;return n.setFromProjectionMatrix(t),n.intersectsBox(e)},THREE.CombinedCamera.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&this.matrixWorld.copy(this.matrix);var t=sc();t&&this.matrixWorld.premultiply(t),this.matrixWorldInverse.getInverse(this.matrixWorld)},THREE.Mesh.prototype.verticesCount=function(){return this.geometry?this.geometry.isBufferGeometry?this.geometry.attributes.position.count:this.geometry.vertices.length:0},THREE.Mesh.prototype.simplify=function(e){var t=THING.Math.clamp(e,0,1),n=new THREE.SimplifyModifier,i=this.geometry;i instanceof THREE.BufferGeometry&&(i=(new THREE.Geometry).fromBufferGeometry(i)),i.mergeVertices();var r=THING.Math.toInteger(i.vertices.length*(1-t)),o=n.modify(i,r);return new THREE.Mesh(o,this.material)},THREE.Mesh.prototype.getPerimeter=function(){var e=0,t=this.geometry.attributes;if(t){var n=t.position;if(n.count<2)return 0;for(var i=new THREE.Vector2(n.getX(0),n.getZ(0)),r=1;r<n.count;r++){e+=(a=new THREE.Vector2(n.getX(r),n.getZ(r))).distanceTo(i),i=a}e+=i.distanceTo(new THREE.Vector2(n.getX(0),n.getZ(0)))}else{var o=this.geometry.vertices;if(o.length<2)return 0;for(i=new THREE.Vector2(o[0].x,o[0].y),r=1;r<o.length;r++){var a;e+=(a=new THREE.Vector2(o[r].x,o[r].y)).distanceTo(i),i=a}e+=i.distanceTo(new THREE.Vector2(o[0].x,o[0].y))}return e},THREE.Mesh.prototype.getArea=function(){var e=[],t=this.geometry.attributes;if(t)for(var n=t.position,i=0;i<n.count;i++){var r=new THREE.Vector2(n.getX(i),n.getZ(i));e.push(r)}else{var o=this.geometry.vertices;for(i=0;i<o.length;i++){r=new THREE.Vector2(o[i].x,o[i].y);e.push(r)}}var a=THREE.ShapeUtils.area(e);return Math.abs(a)},THREE.Mesh.prototype.getPoints=function(){var e=[],t=this.geometry.attributes;if(t)for(var n=t.position,i=0;i<n.count;i++){(o=new THREE.Vector3(n.getX(i),n.getY(i),n.getZ(i))).applyMatrix4(this.matrixWorld),e.push(o.toArray())}else{var r=this.geometry.vertices;if(r)for(i=0;i<r.length;i++){var o;(o=r[i].clone()).applyMatrix4(this.matrixWorld),e.push(o.toArray())}}return e},THREE.Mesh.prototype.getLabelPosition=function(e,t){var n=[];if(this.geometry.attributes)for(var i=this.geometry.attributes.position,r=0;r<i.count;r++)"xy"==t?n.push([i.getX(r),i.getY(r)]):n.push([i.getX(r),i.getZ(r)]);else for(r=0;r<this.geometry.vertices.length;r++){var o=this.geometry.vertices[r];"xy"==t?n.push([o.x,o.y]):n.push([o.x,o.z])}if(!n.length)return null;if(n.length>1){var a=[0,0];for(r=0;r<n.length;r++){var s=n[r];a[0]|=!!s[0],a[1]|=!!s[1]}if(!a[0]||!a[1])return null}var l=[];if(l.push(n),e&&0!=e.length)for(r=0;r<e.length;r++){var u=[e[r][0],e[r][1],e[r][2],e[r][3]];l.push(u)}var c,h=new polylabel(l);return c="xy"==t?this.localToWorld(new THREE.Vector3(h[0],h[1],0)):this.localToWorld(new THREE.Vector3(h[0],0,h[1])),this.getRayCastPosition(c)},THREE.Mesh.prototype.getAvaliableLabelPosition=function(e,t,n){var i=function(e,t,n){var i=e[0],r=t[0],o=e[1],a=t[1],s=Math.max(i,n.l);if(s>r||s>n.r)return!1;var l=Math.min(r,n.r);if(l<i||l<n.l)return!1;var u=Math.max(o,n.t);if(u>a||u>n.b)return!1;var c=Math.min(a,n.b);return!(c<o||c<n.t)},r=function(e,t,n,r,o){for(var a=n.x,s="xy"==o?n.y:n.z,l=[a-r[0],s-r[1]],u=[a+r[0],s+r[1]],c=0;c<e.length;c++){var h=e[c],p=t[c],d=h.x,f="xy"==o?h.y:h.z,m=p[0]/2,g=p[1]/2;if(i(l,u,{l:d-m,t:f-g,r:d+m,b:f+g}))return!0}return!1};this.updateMatrixWorld();var o=new THREE.Matrix4;if(o.getInverse(this.matrixWorld),n&&n.length&&n.length%4)return console.error("The hole points number must arrange by 4"),null;for(var a=[],s=0;s<n.length;s+=4){var l=Ne.parseVector3(n[s]).applyMatrix4(o),u=Ne.parseVector3(n[s+1]).applyMatrix4(o),c=Ne.parseVector3(n[s+2]).applyMatrix4(o),h=Ne.parseVector3(n[s+3]).applyMatrix4(o);l=[l.x,l.y],u=[u.x,u.y],c=[c.x,c.y],h=[h.x,h.y],a.push([l,u,c,h])}var p=[],d=[];for(s=0;s<e.length;s++){var f=e[s],m=f[0]/2,g=f[1]/2;if(0!=m&&0!=g){var v=this.getLabelPosition(a,t);if(!v)break;var y=v.clone();y.applyMatrix4(o),r(p,e,y,[m,g],t)||(d.push(v),p.push(y));var b=y.x,_="xy"==t?y.y:y.z;l=[b-m,_-g],u=[b+m,_-g],c=[b+m,_+g],h=[b-m,_+g];a.push([l,u,c,h])}}return d},THREE.Mesh.prototype.getRayCastPosition=function(e){this.updateMatrixWorld();var t=e.clone();this.worldToLocal(t);var n=t.clone();n.z--,this.localToWorld(t),this.localToWorld(n);var i=new THREE.Vector3;i.subVectors(n,t),i.normalize();var r=e.clone();r.add(i.clone().multiplyScalar(-1e3));var o=new THREE.Raycaster;o.ray.origin.copy(r),o.ray.direction.copy(i);var a=o.intersectObjectForcible(this,!0);return a.length?a[0].point:null},THREE.LOD.prototype.setLevel=function(e){if(!(e>=this.levels.length)){for(var t=0;t<this.levels.length;t++)this.levels[t].object.visible=!1;this.levels[e].object.visible=!0}},THREE.Raycaster.prototype._setFromCamera=function(e,t,n,i){return void 0===e&&void 0===t?(Vu.subVectors(i,n.position),Vu.normalize(),this.set(n.position,Vu)):(Uu.x=e/i.width*2-1,Uu.y=-t/i.height*2+1,this.setFromCamera(Uu,n)),this},THREE.Raycaster.prototype.clone=function(){return new THREE.Raycaster(this.ray.origin.clone(),this.ray.direction.clone())},THREE.Raycaster.prototype._intersectObjectForcible=function(e,t,n,i){if(e.raycast(t,n),!0===i)for(var r=e.children,o=0,a=r.length;o<a;o++)this._intersectObjectForcible(r[o],t,n,!0)},THREE.Raycaster.prototype.intersectObjectForcible=function(e,t,n){var i=n||[];return this._intersectObjectForcible(e,this,i,t),i.sort((function(e,t){return e.distance-t.distance})),i},THREE.Raycaster.prototype.intersectEnsureVisibleObject=function(e,t,n,i){if(!1!==e.ensureVisible(i)&&(e.raycast(this,t),!0===n))for(var r=e.children,o=0,a=r.length;o<a;o++)this.intersectEnsureVisibleObject(r[o],t,!0,i)},THREE.Raycaster.prototype.intersectEnsureVisibleObjects=function(e,t,n){var i=[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var r=0,o=e.length;r<o;r++)this.intersectEnsureVisibleObject(e[r],i,t,n);return i.sort((function(e,t){return e.distance-t.distance})),i},THREE.Raycaster.prototype.intersectCollisionObjects=function(e,t,n){var i=[];return function e(t,n,i,r,o){if(!1!==t.visible&&t.layers.test(r.layers)){t.raycast(n,i);for(var a=t.children,s=0,l=a.length;s<l;s++)e(a[s],n,i,r)}}(e,this,i,t),i.sort(ascSort),i},THREE.Geometry.prototype.getVerticesCount=function(){return this.vertices.length},THREE.Geometry.prototype.genFaceVertexUVs=function(){this.computeFaceNormals(),this.computeVertexNormals(),this.computeBoundingBox();for(var e=this.boundingBox.max,t=this.boundingBox.min,n=new THREE.Vector2(0-t.x,0-t.y),i=new THREE.Vector2(e.x-t.x,e.y-t.y),r=this.faces,o=[],a=0;a<r.length;a++){var s=this.vertices[r[a].a],l=this.vertices[r[a].b],u=this.vertices[r[a].c],c=new THREE.Vector2((s.x+n.x)/i.x,(s.y+n.y)/i.y),h=new THREE.Vector2((l.x+n.x)/i.x,(l.y+n.y)/i.y),p=new THREE.Vector2((u.x+n.x)/i.x,(u.y+n.y)/i.y);o.push([c,h,p])}for(a=0;a<this.faceVertexUvs.length;a++)this.faceVertexUvs[a]=o.concat();this.uvsNeedUpdate=!0,this.elementsNeedUpdate=!0},THREE.Scene.prototype.verticesCount=function(){var e=0;return this.traverse((function(t){t.isMesh&&(e+=t.verticesCount())})),e},THREE.AnimationMixer.prototype.isRunning=function(e){for(var t=this._actions,n=this._nActiveActions,i=0;i!==n;++i){var r=t[i];if(e){var o=r.getClip();if(o&&e!=o.name)continue}if(r.isRunning())return!0}return!1},THREE.AnimationMixer.prototype.log=function(){for(var e=this.stats,t=0;t<this._actions.length;t++){var n=this._actions[t],i=n.getClip(),r=n.getEffectiveWeight();0!=r&&console.log("action: [name: "+i.name+", weight: "+r+"]")}console.log("action: "+e.actions.inUse+"/"+e.actions.total),console.log("bindings: "+e.bindings.inUse+"/"+e.bindings.total),console.log("controlInterpolants: "+e.controlInterpolants.inUse+"/"+e.controlInterpolants.total)},THREE.Material.prototype._isCloned=function(){return!!this._origin_material},THREE.Material.prototype._getOriginal=function(){var e=this._origin_material;return e||this},THREE.Material.prototype._getPrevMaterial=function(){var e=this._prev_material;return e||this._getOriginal()},THREE.Material.prototype._pushAndCloneSelf=function(){var e=this.clone();return e._origin_material=this._getOriginal(),e._prev_material=this,e},THREE.Material.prototype._pop=function(){var e=this.__materialsQueue__;if(e&&e.length){for(;e.length;){e[e.length-1].dispose(),e.splice(e.length-1,1)}e.length||delete this.__materialsQueue__}};var hc=THREE.Material.prototype.copy;THREE.Material.prototype.copy=function(e){return hc.call(this,e),this.defines=void 0!==e.defines?JSON.parse(JSON.stringify(e.defines)):void 0,this.isMeshStandardMaterial||this.defines&&""==this.defines.STANDARD&&delete this.defines.STANDARD,this.__texture=e.__texture,this._replace_map=e._replace_map,this._replace_alphaMap=e._replace_alphaMap,this},THREE.Material.prototype.getTextures=function(){var e=new Set;for(var t in this){var n=this[t];n&&n.isTexture&&e.add(n)}return Array.from(e)},THREE.Box3.prototype.getIntersection=function(e){var t=new THREE.Box3;return this.intersectsBox(e)&&(t.min.x=Math.max(this.min.x,e.min.x),t.max.x=Math.min(this.max.x,e.max.x),t.min.y=Math.max(this.min.y,e.min.y),t.max.y=Math.min(this.max.y,e.max.y),t.min.z=Math.max(this.min.z,e.min.z),t.max.z=Math.min(this.max.z,e.max.z)),t},THREE.Box3.prototype.expandByGeometry=function(e,t){return e.boundingBox||e.computeBoundingBox(),Qu.copy(e.boundingBox),t&&Qu.applyMatrix4(t),this.union(Qu),this},THREE.Box3.prototype._setFromObject=function(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];i&&this.makeEmpty(),e.updateWorldMatrix(!0,!0);new THREE.Vector3;var r=this;e.getWorldPosition(qu);var o=!1;e.traverse((function(e){if(!t||!1!==t(e)){e.userData.forceBoundingBox&&(e.getWorldPosition(Gu),n&&Gu.applyMatrix4(n),r.expandByPoint(Gu),o=!0);var i=e.userData.boundingBoxSize;if(i){var a=THING.Math.scaleVector(i,.5);Gu.fromArray(THING.Math.negVector(a)),Wu.fromArray(a),Qu.set(Gu,Wu);var s={x:0,y:0,z:0},l=e.userData.boundingBoxPivot;l&&(s.x=i[0]*(l[0]-.5),s.y=i[1]*(l[1]-.5),s.z=i[2]*(l[2]-.5)),Qu.getBoundingPositions().forEach((function(t){t.add(s),t.applyMatrix4(e.matrixWorld),n&&t.applyMatrix4(n),r.expandByPoint(t),o=!0}))}var u=e.geometry;u&&(n?(Hu.multiplyMatrices(n,e.matrixWorld),r.expandByGeometry(u,Hu)):r.expandByGeometry(u,e.matrixWorld),o=!0)}})),o||(n&&qu.applyMatrix4(n),this.expandByPoint(qu)),this.getSize(Xu);var a=1e-8;return 0==Xu.x&&(this.min.x-=a,this.max.x+=a),0==Xu.y&&(this.min.y-=a,this.max.y+=a),0==Xu.z&&(this.min.z-=a,this.max.z+=a),this},THREE.Box3.prototype.getBoundingPositions=function(){var e=this.min,t=this.max;return[new THREE.Vector3(e.x,e.y,e.z),new THREE.Vector3(t.x,e.y,e.z),new THREE.Vector3(e.x,e.y,t.z),new THREE.Vector3(t.x,e.y,t.z),new THREE.Vector3(e.x,t.y,e.z),new THREE.Vector3(t.x,t.y,e.z),new THREE.Vector3(e.x,t.y,t.z),new THREE.Vector3(t.x,t.y,t.z)]},THREE.OrbitControls.prototype.setObject=function(e){this.object=e},THREE.OrbitControls.prototype.getObject=function(){return this.object},THREE.OrbitControls.prototype.getPosition=function(){return this.object.position},THREE.OrbitControls.prototype.setPosition=function(e){this.object.position.copy(e)},THREE.OrbitControls.prototype.setTarget=function(e){this.target.copy(e)},THREE.OrbitControls.prototype.getTarget=function(){return this.target},THREE.OrbitControls.prototype.clone=function(){var e=new THREE.OrbitControls(this.object,this.domElement);return e.enabled=this.enabled,e.target=this.target.clone(),e.minDistance=this.minDistance,e.maxDistance=this.maxDistance,e.minZoom=this.minZoom,e.maxZoom=this.maxZoom,e.minPolarAngle=this.minPolarAngle,e.maxPolarAngle=this.maxPolarAngle,e.minAzimuthAngle=this.minAzimuthAngle,e.maxAzimuthAngle=this.maxAzimuthAngle,e.enableDamping=this.enableDamping,e.dampingFactor=this.dampingFactor,e.enableZoom=this.enableZoom,e.zoomSpeed=this.zoomSpeed,e.zoomFactor=this.zoomFactor,e.enableRotate=this.enableRotate,e.rotateSpeed=this.rotateSpeed,e.enablePan=this.enablePan,e.panSpeed=this.panSpeed,e.screenSpacePanning=this.screenSpacePanning,e.keyPanSpeed=this.keyPanSpeed,e.autoRotate=this.autoRotate,e.autoRotateSpeed=this.autoRotateSpeed,e.enableKeys=this.enableKeys,e.target0=this.target0.clone(),e.position0=this.position0.clone(),e.zoom0=this.zoom0,e},THREE.EarthOrbitControls.prototype.setObject=function(e){this.object=e},THREE.EarthOrbitControls.prototype.getObject=function(){return this.object},THREE.EarthOrbitControls.prototype.getPosition=function(){return this.object.position},THREE.EarthOrbitControls.prototype.setPosition=function(e){this.object.position.copy(e)},THREE.EarthOrbitControls.prototype.setTarget=function(e){this.target.copy(e)},THREE.EarthOrbitControls.prototype.getTarget=function(){return this.target},THREE.EarthOrbitControls.prototype.clone=function(){var e=new THREE.EarthOrbitControls(this.object,this.domElement);return e.enabled=this.enabled,e.isEarth=this.isEarth,e.target=this.target.clone(),e.minDistance=this.minDistance,e.maxDistance=this.maxDistance,e.minZoom=this.minZoom,e.maxZoom=this.maxZoom,e.minPolarAngle=this.minPolarAngle,e.maxPolarAngle=this.maxPolarAngle,e.minAzimuthAngle=this.minAzimuthAngle,e.maxAzimuthAngle=this.maxAzimuthAngle,e.enableDamping=this.enableDamping,e.dampingFactor=this.dampingFactor,e.enableZoom=this.enableZoom,e.zoomSpeed=this.zoomSpeed,e.zoomFactor=this.zoomFactor,e.enableRotate=this.enableRotate,e.rotateSpeed=this.rotateSpeed,e.enablePan=this.enablePan,e.panSpeed=this.panSpeed,e.screenSpacePanning=this.screenSpacePanning,e.keyPanSpeed=this.keyPanSpeed,e.autoRotate=this.autoRotate,e.autoRotateSpeed=this.autoRotateSpeed,e.enableKeys=this.enableKeys,e.target0=this.target0.clone(),e.position0=this.position0.clone(),e.zoom0=this.zoom0,e._leftInteractive=this._leftInteractive,e._keepTarget=this._keepTarget,e.maxPitchAngle=this.maxPitchAngle,e._minPolarAngle=this._minPolarAngle,e._maxPolarAngle=this._maxPolarAngle,e.standardRadius=this.standardRadius,e.targetMaxOffset=this.targetMaxOffset,e.panStander=this.panStander,e.isDispatchEvent=this.isDispatchEvent,e.enableZoomOnTarget=this.enableZoomOnTarget,e._isCameraStatic=this._isCameraStatic,Ne.mergeObject(e.options,this.options),e},THREE.WebGLRenderer.prototype.getContext=function(e){return this.context},THREE.ShaderChunk.map_fragment=["","#ifdef USE_MAP","#ifdef USE_DIFFUSE_UV2","vec4 texelColor = texture2D( map, vUv2 );","#else","vec4 texelColor = texture2D( map, vUv );","#endif","texelColor = mapTexelToLinear( texelColor );","diffuseColor *= texelColor;","#endif",""].join("\n"),THREE.ShaderChunk.alphamap_fragment=["","#ifdef USE_ALPHAMAP","#ifdef USE_ALPHAMAP_REVERSE","diffuseColor.a *= 1.0 - texture2D( alphaMap, vAlphaUV).g;","#else","diffuseColor.a *= texture2D( alphaMap, vAlphaUV).g;","#endif","#endif",""].join("\n"),THREE.ShaderChunk.uv2_pars_fragment=["","#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined (USE_DIFFUSE_UV2)","varying vec2 vUv2;","#endif","#ifdef USE_ALPHAMAP","varying vec2 vAlphaUV;","#endif","#ifdef USE_EMISSIVEMAP","varying vec2 vEmissiveUV;","#endif",""].join("\n"),THREE.ShaderChunk.uv2_pars_vertex=["","#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined( USE_ALPHA_UV2 ) || defined (USE_DIFFUSE_UV2)","attribute vec2 uv2;","#endif","#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined (USE_DIFFUSE_UV2)","varying vec2 vUv2;","#endif","#ifdef USE_ALPHA_UV3","#if defined(USE_ALPHAMAP) || defined(USE_EMISSIVEMAP)","attribute vec2 uv3;","#endif","#endif","#ifdef USE_ALPHA_UV4","#if defined(USE_ALPHAMAP) || defined(USE_EMISSIVEMAP)","attribute vec2 uv4;","#endif","#endif","#ifdef USE_ALPHAMAP","varying vec2 vAlphaUV;","uniform mat3 uvTransform1;","#endif","#ifdef USE_EMISSIVEMAP","varying vec2 vEmissiveUV;","uniform mat3 uvTransform2;","#endif",""].join("\n"),THREE.ShaderChunk.uv2_vertex=["#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined (USE_DIFFUSE_UV2)","#if defined(USE_DIFFUSE_UV2) && defined(USE_MAP)","vUv2 = (uvTransform * vec3(uv2, 1.0)).xy;","#else","vUv2 = uv2;","#endif","#endif","#ifdef USE_ALPHAMAP","vAlphaUV = (uvTransform1 * vec3(uv, 1.0)).xy;","#ifdef USE_ALPHA_UV2","vAlphaUV = (uvTransform1 * vec3(uv2, 1.0)).xy;","#endif","#ifdef USE_ALPHA_UV3","vAlphaUV = (uvTransform1 * vec3(uv3, 1.0)).xy;","#endif","#ifdef USE_ALPHA_UV4","vAlphaUV = (uvTransform1 * vec3(uv4, 1.0)).xy;","#endif","#endif","#ifdef USE_EMISSIVEMAP","#ifndef USE_EMISSIVETRANSFORM","mat3 emissiveTransform = uvTransform;","#else","mat3 emissiveTransform = uvTransform2;","#endif","vEmissiveUV = (emissiveTransform * vec3(uv, 1.0)).xy;","#ifdef USE_ALPHA_UV2","vEmissiveUV = (emissiveTransform * vec3(uv2, 1.0)).xy;","#endif","#ifdef USE_ALPHA_UV3","vEmissiveUV = (emissiveTransform * vec3(uv3, 1.0)).xy;","#endif","#ifdef USE_ALPHA_UV4","vEmissiveUV = (emissiveTransform * vec3(uv4, 1.0)).xy;","#endif","#endif",""].join("\n");["sprite","basic"].forEach((function(e){var t=THREE.ShaderLib[e];t.vertexShader=t.vertexShader.replace("#include <clipping_planes_pars_vertex>","\n\t#include <clipping_planes_pars_vertex>\n\t#ifdef USE_GPUPICKER\n\t\tuniform float baseId;\n\t\tvarying vec4 worldId;\n\t#endif\n\t"),t.vertexShader=t.vertexShader.replace("#include <fog_vertex>","\n\t#include <fog_vertex>\n\t#ifdef USE_GPUPICKER\n\t\tvec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * baseId);\n\t\ta -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);\n\t\tworldId = vec4(a,1);\n\t#endif\n\t"),t.fragmentShader=t.fragmentShader.replace("#include <clipping_planes_pars_fragment>","\n\t#include <clipping_planes_pars_fragment>\n\t#ifdef USE_GPUPICKER\n\t\tvarying vec4 worldId;\n\t#endif\n\t"),t.fragmentShader=t.fragmentShader.replace("#include <fog_fragment>","\n\t#include <fog_fragment>\n\t#ifdef USE_GPUPICKER\n\t\tgl_FragColor = worldId;\n\t#endif\n\t"),t.fragmentShader=t.fragmentShader.replace("#include <clipping_planes_fragment>","\n\t#ifdef USE_MAP\n\t\t#ifdef USE_UV_DISCARD\n\t\t\tif (vUv.x < 0. || vUv.x > 1. || vUv.y < 0. || vUv.y > 1.) discard;\n\t\t#endif\n\t#endif\n\t#include <clipping_planes_fragment>\n\t")})),THREE.ShaderChunk.aomap_fragment="\n\t#ifdef USE_AOMAP\n\t\t#ifdef WALL_AO\n\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity * 0.5 + 1.5;\n\t\t#else\n\t\t\t#ifdef FLOOR_AO\n\t\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.25;\n\t\t\t#else\n\t\t\t\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity * 1.6 + 1.7;\n\t\t\t#endif\n\t\t#endif\n\t\t// reflectedLight.indirectDiffuse *= ambientOcclusion;\n\t\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t\t#endif\n\t#else\n\t\tfloat ambientOcclusion = 1.4;\n\t#endif\n",THREE.ShaderChunk.emissivemap_fragment="\n\t#ifdef USE_EMISSIVEMAP\n\n\t\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveUV );\n\n\t\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\n\t\ttotalEmissiveRadiance *= emissiveColor.rgb;\n\n\t#endif\n\n\t#ifdef STANDARD\n\t\ttotalEmissiveRadiance = vec3(0.0,0.0,0.0);\n\t\tvec3 newEmissiveColor = emissive;\n\t\t#ifdef USE_EMISSIVEMAP\n\t\t\tnewEmissiveColor = emissive * emissiveColor.rgb;\n\t\t\t#ifdef USE_SIDE_EMISSIVE\n\t\t\t\tnewEmissiveColor *= newEmissiveColor * (1. - abs(dot( inverseTransformDirection( normal, viewMatrix ), vec3(0., 1., 0.) )));\n\t\t\t#endif\n\t\t#endif\n\t#endif\n",THREE.ShaderChunk.encodings_fragment=["gl_FragColor = linearToOutputTexel( gl_FragColor );","#if defined(STANDARD) || defined(USE_AOMAP)","gl_FragColor.rgb *= ambientOcclusion;","#elif defined(FLOOR_AO)","gl_FragColor.rgb *= 1.2;","#endif","#ifdef STANDARD","gl_FragColor.rgb += newEmissiveColor;","#endif"].join("\n"),THREE.ShaderChunk.tonemapping_fragment=["#if defined( TONE_MAPPING ) && defined(STANDARD)","gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );","#endif"].join("\n"),THREE.BufferGeometry.prototype.getVerticesCount=function(){return this.attributes.position.count},THREE.BufferGeometry.prototype.addAttribute=function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new BufferAttribute(arguments[1],arguments[2])))},THREE.BufferAttribute.prototype.setDynamic=function(e){return this.setUsage(!0===e?THREE.DynamicDrawUsage:THREE.StaticDrawUsage),this},THREE.BufferGeometry.prototype.computeBoundingBox=function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var e=this.attributes.position;if(void 0!==e)for(var t=this.index?this.index.array:null,n=this.drawRange.start,i=this.drawRange.count!=1/0?this.drawRange.count:t?t.length:e.count;n<i;n++)t?zu.fromBufferAttribute(e,t[n]):zu.fromBufferAttribute(e,n),this.boundingBox.expandByPoint(zu)},HTMLDivElement.prototype._isVisible=function(){return"hidden"!=this.style.visibility&&"none"!=this.style.display};var pc=function(){function e(t){r(this,e)}return e.prototype.init=function(){this.eyeTween=null,this.targetTween=null,this.upTween=null,this._flying=!1},e.prototype._lookAt=function(e){var t=Ne.parseVector3(e);t&&(this.controller.target.set(t.x,t.y,t.z),this.controller.object.lookAt(this.controller.target))},e.prototype.updateFollowingObject=function(){var e=this,t=this.followingObject,n=t.params,i=n.flyStop,r=n.flying,o=n.flyComplete,a=t.object;if(a instanceof Lt){if(!a.visible||a.destroyed)return i&&i(),void this.app.camera.stopFollowingObject();a=t.centerPos||a.boundingBox.center}a=Ne.parseVector3(a);var s=t.dir.clone();"earth"===this.app.camera.mode?(s=t.object.selfToWorld(s),s=THING.Utils.parseVector3(s)):s.add(a);var l=Ne.parseVector3(this.camera.target),u=Ne.parseVector3(this.camera.position),c=t.speed;l=l.lerp(a,c/10),u=u.lerp(s,c/10),this.object.node.position.copy(u),this._lookAt(l,(function(){return e.static})),r&&r();var h=l.distanceTo(a),p=u.distanceTo(s);h<1e-4&&p<1e-4&&(o&&o(),n.once&&this.app.camera.stopFollowingObject());this.app.needUpdate=!0},e.prototype.updateLookingObject=function(){var e=this.lookingObject;e instanceof Lt&&(e=e.boundingBox.center);var t=Ne.parseVector3(e),n=Ne.parseVector3(this.camera.target).lerp(t,.1);this.camera.target=n.toArray()},e.prototype.getFlyPos=function(e){var t,n=this.object,i=Ne.parseNumber3(e.position),r=null,o=[0,0,0],a=e.target||e.object;if(a){var s=e.offset,l=e.worldOffset,u=e.xAngle,c=e.yAngle,h=e.distance||e.radius,p=e.radiusFactor;if(a.isBaseObject||a.isGroup){r=a;var d=e.center;if(d)o=(d=Ne.parseVector3(d)).toArray();else o=(v=e.boundingBox||r.boundingBox).center||o;if(Ne.isNull(u)&&Ne.isNull(c))if(s){M=r.worldToSelf(o);s=THING.Math.addVector(M,s),s=r.selfToWorld(s,!0)}else if(l)s=THING.Math.addVector(o,l);else{var f=e.time||1,m=!1;h&&(m=!0);var g=[],v=e.boundingBox||r.boundingBox;g.push(v.getWorldPosition({yAngle:45,xAngle:45,distance:h,radiusFactor:p,ignoreScale:m,boundingBox:v})),f>1&&(g.push(v.getWorldPosition({yAngle:45,xAngle:135,distance:h,radiusFactor:p,ignoreScale:m,boundingBox:v})),g.push(v.getWorldPosition({yAngle:45,xAngle:225,distance:h,radiusFactor:p,ignoreScale:m,boundingBox:v})),g.push(v.getWorldPosition({yAngle:45,xAngle:315,distance:h,radiusFactor:p,ignoreScale:m,boundingBox:v})));for(var y=0,b=Ne.parseVector3(n.position),_=b.distanceTo(Ne.parseVector3(g[y])),x=y+1;x<g.length;x++){var E=Ne.parseVector3(g[x]),T=b.distanceTo(E);T<_&&(_=T,y=x)}i=g[y],s=[0,0,0]}else{s=s||r.getOffsetPosition({yAngle:u,xAngle:c,distance:h,radiusFactor:p});var M=r.worldToSelf(o);s=THING.Math.addVector(M,s),s=r.selfToWorld(s,!0)}i=i||[0,0,0],n.projectionType==w.Perspective?(i[0]+=s[0],i[1]+=s[1],i[2]+=s[2]):i[1]+=s[1]}else if(Ne.isArray(a)){if(o=a,!i)if(s=s||l,Ne.isArray(s)||Ne.isNumber(s))i=THING.Math.addVector(a,s);else{h=h||10;var S=Ne.parseVector3(a);S&&(c||u?(c=Ne.parseValue(c,0),u=Ne.parseValue(u,0),i=S.getDirectionFromAngles(u,c,h).toArray()):i=S.getDirectionFromPosition(n.node.position,h).toArray())}i=i||n.position}else console.error("getFlyPos() failed, due to object or target is neither BaseObject type nor position")}if(e.autoFixUp){var C=e.up;if(C)C=THING.Math.normalizeVector(C);else{var A=this,R=new THREE.Vector3(0,1,0),P=(t=r||A.app.level.current)?t.isCampus?t:t.parents.query(".Campus")[0]:null;P&&(R.applyQuaternion(THING.Utils.parseQuaternion(P.worldAngles)),R.normalize(),C=R.toArray())}}return{obj:r,eyePos:i,lookAtPos:o,up:C}},e.prototype.flyTo=function(e){(e=e||{}).isBaseObject&&(e={object:e,time:2e3});var t=Ne.parseValue(e.time,2e3),n=Ne.parseValue(e.lerp||e.lerpType,TWEEN.Easing.Linear.None),i=Ne.parseValue(e.upLerp,n),r=Ne.parseValue(e.positionLerp,n),o=Ne.parseValue(e.targetLerp,n),a=e.flyStart,s=e.flyStop,l=e.flying,u=e.flyComplete;if(Ne.parseValue(e.keepDirection,!1)){var c=e.cameraTarget||e.target;if(c)return e.object=c,e.radius=e.radius||2*c.boundingBox.radius,e.speed=t/1e3,e.enableRotate=!0,e.enableZoom=!0,e.once=!0,void this.followObject(e)}var h=this.getFlyPos(e),p=h.eyePos,d=h.lookAtPos;if(!this._stopping)if(this.stopFlying(),p&&d){this._flying=!0,a&&a();var f={x:this.object.node.position.x,y:this.object.node.position.y,z:this.object.node.position.z},m={x:p[0],y:p[1],z:p[2]},g={x:this.controller.target.x,y:this.controller.target.y,z:this.controller.target.z},v={x:d[0],y:d[1],z:d[2]},y=this,b=e.customFlying;if(b&&Ne.isFunction(b))b({object:e.object,forward:y.direction,from:f,to:m,lookatFrom:g,lookatTo:v,time:t,complete:function(){y._flying=!1,u&&u()}});else if(this.eyeTween=new TWEEN.Tween(f).to(m,t).easing(r).onUpdate((function(){y.object.position=[this._object.x,this._object.y,this._object.z]})).start(),this.targetTween=new TWEEN.Tween(g).to(v,t).easing(o).onUpdate((function(){y.object.target=[this._object.x,this._object.y,this._object.z],l&&l()})).onStop((function(){s&&s()})).onComplete((function(){y._flying=!1,u&&u()})).start(),h.up){var _={x:this.object.node.up.x,y:this.object.node.up.y,z:this.object.node.up.z},x={x:h.up[0],y:h.up[1],z:h.up[2]};this.upTween=new TWEEN.Tween(_).to(x,t).easing(i).onStop((function(){y.object.up=h.up})).onUpdate((function(){y.object.up=[this._object.x,this._object.y,this._object.z]})).start()}}else u&&u()},e.prototype.stopRotating=function(){this.object._stopRotating()},e.prototype.stopFlying=function(){this.isFlying()&&(this._flying=!1,this._stopping=!0,this.object.stopRotating(),this.stopFollowingObject(),this.eyeTween&&this.eyeTween.stop(),this.targetTween&&this.targetTween.stop(),this.upTween&&this.upTween.stop(),this._stopping=!1)},e.prototype.movePath=function(e){var t=this;this.stopFlying();var n=e.complete;e.complete=function(){t._flying=!1;var e=t.cameraObject.node.getForwardPosition(t.camera.distance);t.camera.target=e.toArray(),n&&n()},this._flying=!0,flyStart&&flyStart(),Lt.prototype.movePath.call(this.object,e)},e.prototype.rotateAround=function(e){var t=this,n=(e=e||{}).target||e.object;e.target=n||this.camera.target,this.stopFlying(),e.rotateStart&&e.rotateStart(),this.lookAt(e.target);var i=e.complete;e.complete=function(t){e.stop(),i&&i(),e.rotateComplete&&e.rotateComplete()},e.stop=function(n){t.lookAt(null),t.camera.curOrbit.enabled=!0,t.camera.resume({rotate:!0,pan:!0,zoom:!0}),e.rotateComplete&&e.rotateComplete()},e.update=function(e){t.camera.curOrbit.update()},this.camera.curOrbit.enabled=!1,this.camera.disable({rotate:!0,pan:!0,zoom:!0}),Lt.prototype.rotateAround.call(this.object,e)},e.prototype.rotate=function(e){var t=this.camera.distance,n=Ne.parseVector3(this.camera.direction),i=Ne.parseQuaternion(e);n.applyQuaternion(i),n.normalize();var r=n.clone();r.multiplyScalar(t),r.add(Ne.parseVector3(this.camera.position)),this.camera.target=r.toArray()},e.prototype.followObject=function(e){(e=e||{}).isBaseObject&&(e={object:e});var t=e.object;if(t){this.stopFollowingObject();var n,i=e.alpha,r=e.beta,o=e.distance||e.radius||this.camera.distance,a=Ne.parseVector3(e.offset||[0,0,0]),s=Ne.parseVector3(e.worldOffset),l=e.speed||1,u=e.centerPos;if(s)n=s;else{if(n=new THREE.Vector3,i||r)i=i||0,r=r||0,n=Ne.parseVector3(THING.Math.directionFromAlphaBeta(i,r));else{var c=Ne.parseVector3(this.camera.target),h=Ne.parseVector3(this.camera.position);n.subVectors(h,c)}n.normalize(),n.multiplyScalar(o),n.add(a)}var p=e.flyStart;p&&p(),this.followingObject={object:t,dir:n,speed:l,params:e,centerPos:u}}},e.prototype.stopFollowingObject=function(){if(this.followingObject){var e=this.followingObject.params;this.followingObject=null;var t=e.flyStop;t&&t()}},e.prototype.lookAt=function(e){return e&&(Ne.isArray(e)||e.isBaseObject)?(this.lookingObject=e,!0):(this.lookingObject=null,!1)},e.prototype.setTarget=function(e){var t=this;this._lookAt(e,(function(){return t.object.static}))},e.prototype.isFlying=function(){return!!this._flying||!!this.followingObject},e.prototype.onAdd=function(e){this.object=e,this.app=this.object.app,this.init()},e.prototype.onRemove=function(){},e.prototype.onUpdate=function(){this.followingObject?this.updateFollowingObject():this.lookingObject&&this.updateLookingObject()},o(e,[{key:"controller",get:function(){return this.object.controller}},{key:"camera",get:function(){return this.object.app.camera}}]),e}(),dc=function(){function e(t){r(this,e);var n=t.image,i=t.backgroundImage,o=t.opacity||.8,a=new THREE.SpriteMaterial({map:THREE.ImageUtils.loadTexture(n),opacity:o,transparent:!0}),s=null;this.spriteBg=null,i&&(s=new THREE.SpriteMaterial({map:THREE.ImageUtils.loadTexture(i),opacity:o,transparent:!0})),this._position=null,this._uiPosition=[1,1],Object.defineProperty(this,"position",{get:function(){return this._position},set:function(e){if(Ne.isNumber(e))switch(this._position=e,this._position){case S.LeftTop:this._uiPosition=[-1,-1];break;case S.RightTop:this._uiPosition=[1,-1];break;case S.LeftBottom:this._uiPosition=[-1,1];break;case S.RightBottom:this._uiPosition=[1,1]}return this._position}}),null!=t.position?this.position=t.position:this.position=S.RightBottom,this.size=t.size||50,this.offset=t.offset||[0,0],this.sprite=new THREE.Sprite(a),this.sprite.scale.set(this.size,this.size,1),null!=s&&(this.spriteBg=new THREE.Sprite(s),this.spriteBg.scale.set(this.size,this.size,1))}return e.prototype.getRotation=function(){var e=this.app.renderCamera.rotation;switch(e.order){case"XYZ":return-e.z;case"YXZ":return-e.y}return-e.z},e.prototype.onUpdate=function(){var e=this.app.mainUI.getRenderPosition(this._uiPosition,[this.size,this.size]);null!=this.spriteBg&&this.spriteBg.position.set(e[0]+this.offset[0],e[1]+this.offset[1],-10),this.sprite.position.set(e[0]+this.offset[0],e[1]+this.offset[1],-10),this.sprite.material.rotation=this.getRotation()},e.prototype.onAdd=function(e){this.app=e,null!=this.spriteBg&&this.app.mainUI.scene2D.add(this.spriteBg),this.app.mainUI.scene2D.add(this.sprite)},e.prototype.onRemove=function(){null!=this.spriteBg&&this.app.mainUI.scene2D.remove(this.spriteBg),this.app.mainUI.scene2D.remove(this.sprite)},e}(),fc=function(){function e(t){r(this,e),this._controls=null}return e.prototype.onResize=function(){},e.prototype.onUpdate=function(){this._controls&&(this._controls.update(this.app._deltaTime),this.app.needUpdate=!0)},e.prototype.onAdd=function(e){this.app=e,e.camera.inputEnabled=!1,this._controls||(this._controls=new THREE.FreeMouseControls(e.renderCamera),this._controls.movementSpeed=.25),this._controls.enabled=!0},e.prototype.onRemove=function(){this.app.camera.inputEnabled=!0,this._controls&&(this._controls.dispose(),this._controls.enabled=!1,this._controls=null)},e}();function mc(e){return e instanceof gt?e.getNodes():Array.isArray(e)?(console.warn("[WalkControl/WalkButtronControl] please set collision objects by selector object, instead of object3D array."),e):e}var gc=new THREE.Vector3,vc=function(){function e(t){r(this,e),this._controls=null,t=t||{},this.walkSpeed=void 0===t.walkSpeed?.02:t.walkSpeed,this.turnSpeed=void 0===t.turnSpeed?.25:t.turnSpeed,this.jumpSpeed=void 0===t.jumpSpeed?3:t.jumpSpeed,this.enableKeyRotate=void 0!==t.enableKeyRotate&&t.enableKeyRotate,this.useGravity=void 0===t.useGravity||t.useGravity,this.gravity=t.gravity?t.gravity:9.8,this.eyeHeight=void 0===t.eyeHeight?1.6:t.eyeHeight,this._groundObjects=void 0===t.groundObjects?void 0:mc(t.groundObjects),this.useCollision=void 0!==t.useCollision&&t.useCollision,this._collisionObjects=void 0===t.collisionObjects?void 0:mc(t.collisionObjects),this._downRaycaster=new THREE.Raycaster,this._downRaycaster.ray.direction.set(0,-1,0),this._forwardRaycaster=new THREE.Raycaster,this._fallSpeed=0,this._prevCameraAdjustNear=!1,this._cameraChangeStarted=!1}return e.prototype._notifyCameraEvent=function(e){var t=this.app.camera;this.app.trigger(e,{position:t.position,target:t.target})},e.prototype.onResize=function(){},e.prototype.onUpdate=function(){var e=this.app.renderCamera,t=!1;if(this.useCollision){this._forwardRaycaster.ray.origin.copy(e.position),this._forwardRaycaster.ray.origin.y-=this.eyeHeight/2;var n=this._controls.getMoveDirection();this._forwardRaycaster.ray.direction.copy(n).normalize();var i=this._forwardRaycaster.intersectObjects(this._collisionObjects,!0);i.length>0&&i[0].distance<.5&&(t=!0)}if(this._controls&&(this._controls.movementSpeed=t?0:this.walkSpeed,this._controls.rotateSpeed=this.turnSpeed,this._controls.enableKeyRotate=this.enableKeyRotate,this._controls.update()?this._cameraChangeStarted?this._notifyCameraEvent("cameraChange"):(this._cameraChangeStarted=!0,this._notifyCameraEvent("cameraChangeStart")):this._cameraChangeStarted&&(this._cameraChangeStarted=!1,this._notifyCameraEvent("cameraChangeEnd")),this.app.needUpdate=!0),this.useGravity){this._downRaycaster.ray.direction.copy(e.up).multiplyScalar(-1).normalize(),this._downRaycaster.ray.origin.copy(e.position);var r=this._downRaycaster.ray.direction,o=this._downRaycaster.intersectObjects(this._groundObjects,!0);if(o.length<1){this._fallSpeed+=.0166*this.gravity;var a=gc.copy(r).multiplyScalar(Math.min(.0166*this._fallSpeed,this.eyeHeight-.001));e.position.add(a)}else{var s=o[0].distance;if(s<=this.eyeHeight+.01&&this._fallSpeed>=0){this._fallSpeed=0;var l=gc.copy(r).multiplyScalar(s-this.eyeHeight);e.position.add(l)}else{this._fallSpeed+=.0166*this.gravity;var u=gc.copy(r).multiplyScalar(Math.min(.0166*this._fallSpeed,this.eyeHeight-.001));e.position.add(u)}}}},e.prototype.onAdd=function(e){this.app=e,this._prevCameraAdjustNear=e.camera.autoAdjustNear,e.camera.autoAdjustNear=!1,e.camera.inputEnabled=!1,this._controls||(this._controls=new THREE.FreeMouseControls(e.renderCamera,e.mainDomElement),this._controls.movementSpeed=this.walkSpeed,this._controls.rotateSpeed=this.turnSpeed,this._controls.enableFly=!1),this._controls.enabled=!0,this._groundObjects=this._groundObjects||e.query(".Ground || .Floor").getNodes(),this._collisionObjects=this._collisionObjects||[this.app.scene],this._jumpBind=function(e){32==e.keyCode&&this.jump()}.bind(this),window.addEventListener("keydown",this._jumpBind,!1)},e.prototype.onRemove=function(){var e=this.app;e.camera.inputEnabled=!0,this._controls&&(this._controls.dispose(),this._controls.enabled=!1,this._controls=null),this._groundObjects=null,this._collisionObjects=null,e.camera.autoAdjustNear=this._prevCameraAdjustNear,window.removeEventListener("keydown",this._jumpBind,!1)},e.prototype.jump=function(){0==this._fallSpeed&&(this._fallSpeed-=this.jumpSpeed)},o(e,[{key:"groundObjects",set:function(e){this._groundObjects=void 0!==e?mc(e):[]}},{key:"collisionObject",set:function(e){this._collisionObjects=void 0!==e?mc(e):[]}}]),e}(),yc=function(e){function t(n){return r(this,t),s(this,e.call(this,n))}return a(t,e),t.prototype.onResize=function(){},t.prototype.onAdd=function(e){this.app=e,this._prevCameraAdjustNear=e.camera.autoAdjustNear,e.camera.autoAdjustNear=!1,e.camera.inputEnabled=!1,this._controls||(this._controls=new THREE.FreeControls(e.renderCamera,e.mainDomElement),this._controls.movementSpeed=this.walkSpeed,this._controls.rotateSpeed=this.turnSpeed,this._controls.enableFly=!1,e.renderCamera.rotation.x=0),this._controls.enabled=!0,this._groundObjects=this._groundObjects||e.query(".Ground || .Floor").getNodes(),this._collisionObjects=this._collisionObjects||[this.app.scene],this._createWalkButton()},t.prototype.onRemove=function(){var e=this.app;e.camera.inputEnabled=!0,this._controls&&(this._controls.enabled=!1,this._controls=null),this._groundObjects=null,this._collisionObjects=null,e.camera.autoAdjustNear=this._prevCameraAdjustNear,this._removeWalkButton()},t.prototype._setMoveState=function(e,t){this._controls&&(this._controls.moveState[e]=t,this._controls.updateMovementVector())},t.prototype._setRotate=function(e,t){this._controls&&this._controls.rotateDelta.set(e,t)},t.prototype._createWalkButton=function(){var e=this.app,t=this;if(!(e.domElement.getElementsByClassName("walkbutton").length>0)){this._walkButtonDom=e.domElement.appendChild(document.createElement("div")),this._walkButtonDom.className="walkbutton",this._walkButtonDom.style.cssText="position: absolute;right: 0;bottom: 0;width: 0;height: 0;border-radius: 50%;box-sizing: border-box;z-index: 1000;background: #f0f0f0;";var n,i,r,o,a,s=this._walkButtonDom.appendChild(document.createElement("div"));s.style.cssText="width: 46%;height: 46%;border-radius: 50%;overflow: hidden;position: absolute;top: 27%;left: 27%;border-radius: 50%;background: #003A9E;",this._resizeWalkButton(),t._moveState="",this._walkButtonDom.addEventListener("touchstart",(function(e){e.preventDefault(),n=e.changedTouches[0].pageX,i=e.changedTouches[0].pageY,r=e.changedTouches[0].pageX-s.offsetLeft,o=e.changedTouches[0].pageY-s.offsetTop,document.body.addEventListener("touchmove",l,!1)})),document.addEventListener("touchend",(function(){document.body.removeEventListener("touchmove",l,!1),s.style.left="27%",s.style.top="27%",t._setMoveState(t._moveState,0),t._moveState=""}))}function l(e){var l=e.changedTouches[0].pageX,u=e.changedTouches[0].pageY,c=l-r,h=u-o,p=l-n,d=u-i,f=parseFloat(t.width)/2;if(t._getDistance(p,d)<=f)s.style.left=c+"px",s.style.top=h+"px";else{var m=t._getNewPos(f,t._getRadian(p,d));s.style.left=m[0]+n-r+"px",s.style.top=m[1]+i-o+"px"}(a=Math.abs(p)>Math.abs(d)?p>0?"right":"left":d>0?"back":"forward")!==t._moveState&&(t._setMoveState(t._moveState,0),t._setMoveState(a,1),t._moveState=a)}},t.prototype._removeWalkButton=function(){var e=this.app.domElement.getElementsByClassName("walkbutton");e.length>0&&e[0].parentNode.removeChild(e[0])},t.prototype._getDistance=function(e,t){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))},t.prototype._getRadian=function(e,t){return Math.atan2(t,e)},t.prototype._getNewPos=function(e,t){var n=[];return n.push(Math.cos(t)*e),n.push(Math.sin(t)*e),n},t.prototype._getwindowOrientation=function(){return 180==window.orientation||0==window.orientation||90!=window.orientation&&-90!=window.orientation&&void 0},t.prototype._resizeWalkButton=function(){this.width=this._getwindowOrientation()?.2*this.app.domElement.offsetWidth:.2*this.app.domElement.offsetHeight,this._walkButtonDom.style.width=this.width+"px",this._walkButtonDom.style.height=this.width+"px",this._walkButtonDom.style.right=.5*this.width+"px",this._walkButtonDom.style.bottom=.3*this.width+"px"},t}(vc),bc=function(){function e(t){r(this,e),this.parseParam(t),this._enable=!0,this.scene=new THREE.Scene,this.camera=null,this.sprite=null,this.raycaster=new THREE.Raycaster,this.mouse=new THREE.Vector2,this.ratio=2,this.mainAspect=1,this.miniDom=null,this.renderTarget=null,this.inited=!1,this.create()}return e.prototype.parseParam=function(e){this.app=e.app,this._opacity=e.opacity||.7,this._posIndex=e.position||e.posIndex||0,this.bIcon=e.bIcon||!0,this.width=e.width||150,this.height=e.height||this.width,this._scale=e.scale||1,this.closeBtnImg=e.closeBtnImg||"http://www.thingjs.com/static/images/minimap2.png",this.cameraViewImg=e.cameraViewImg||"http://www.thingjs.com/static/images/minimap1.png",this.cameraCenterImg=e.cameraCenterImg||"http://www.thingjs.com/static/images/minimap0.png",this.center={};var t=this.app.root.boundingBox.toBox(),n=(t.max.x+t.min.x)/2,i=(t.max.z+t.min.z)/2;if(e.sceneCenter?(this.center.x=e.sceneCenter[0],this.center.y=e.sceneCenter[1]):e.center?(this.center.x=e.center[0],this.center.y=e.center[1]):(this.center.x=n,this.center.y=i),this.angle=e.angle||0,this.canMoushWheel=e.mousewheel,this.ground=e.ground,this.hasClose=e.hasClose,!this.ground)for(var r=0;r<this.app.root.campuses.length;r++){var o=this.app.root.campuses[r].ground;if(o){this.ground=o.node.children;break}}this.bTranslate=e.bTranslate||!1},e.prototype.init2d=function(){if(this.miniDom=this.app.domElement.appendChild(document.createElement("div")),this.miniDom.className="minimap",this.miniDom.style.position="absolute",this.miniDom.style.cssText="position: absolute;width:"+this.width+";height:"+this.height+";border: 5px solid rgba(255, 255, 255, 0.8);border-radius: 3px;display: block;box-sizing: border-box;overflow:hidden",this.miniDom.style.zIndex=1e3,this.hasClose){var e=this.miniDom.appendChild(document.createElement("img"));e.className="minimap_closeBtn",e.style.position="absolute",e.style.width=this.width/5,e.style.right="1px",e.style.top="1px",e.src=this.closeBtnImg;var t=this;e.addEventListener("click",(function(){close=!0,t.enable=!1}))}var n=this.miniDom.appendChild(document.createElement("img"));n.className="minimap_cameraView",n.style.position="absolute",n.src=this.cameraViewImg;var i=this.miniDom.appendChild(document.createElement("img"));i.className="minimap_cameraCenter",i.src=this.cameraCenterImg,n.style.width="40px",n.style.height="30px",this.miniDom.onmousedown=function(e){var t=e||event;t.cancelBubble=!0,t.stopPropagation()},this.miniDom.onmousemove=function(e){var t=e||event;t.cancelBubble=!0,t.stopPropagation()},this.miniDom.onmousewheel=function(e){var t=e||event;t.cancelBubble=!0,t.stopPropagation()},this.canMoushWheel&&this.miniDom.addEventListener("mousewheel",(function(e){t.scale+=e.wheelDelta>0?.1:-.1}),!1),this.miniDom.addEventListener("mousedown",(function(e){0===e.button&&(t.mouse.x=e.clientX/(t.miniDom.clientWidth+10)*2-1,t.mouse.y=-e.clientY/(t.miniDom.clientWidth+10)*2+1,r(),t.miniDom.onmousemove=function(e){t.mouse.x=e.clientX/(t.miniDom.clientWidth+10)*2-1,t.mouse.y=-e.clientY/(t.miniDom.clientWidth+10)*2+1,r()},t.miniDom.onmouseup=function(){t.miniDom.onmousemove=null,t.miniDom.onmouseup=null})}),!1);t=this;function r(){t.raycaster.setFromCamera(t.mouse,t.camera);var e=t.raycaster.intersectObjects(t.ground[0].children,!0);if(e.length>0){var n=e[0].point;if(t.bTranslate){var i=t.app.camera.cameraObject.forward;i=new THREE.Vector3(i[0],0,i[2]);var r=new THREE.Vector3(n.x,0,n.z).normalize(),o=i.dot(r),a=(new THREE.Vector3).crossVectors(i,r).y,s=0;s=o>0?a<0?90*-(a+1)-90:90+90*(1-a):90*a;var l=t.app.create({type:"Thing",position:[n.x,t.app.camera.position[1],n.z]});t.app.camera.flyTo({time:1e3,object:l,xAngle:45,yAngle:s,zAngle:0})}else t.app.camera.flyTo({time:1e3,position:[n.x,t.app.camera.position[1],n.z],target:t.app.camera.target})}}},e.prototype.init3d=function(){this.init2d();var e=this.app.root.boundingBox.toBox(),t=e.max.x>e.max.z?e.max.x:e.max.z,n=Math.abs(e.min.x)>Math.abs(e.min.z)?Math.abs(e.min.x):Math.abs(e.min.z),i=t>n?t:n;i*=1/this.scale,this.camera=new THREE.OrthographicCamera(-i,i,i,-i,-1e4,1e4),this.camera.position.set(this.center.x,100,this.center.y),this.camera.up=new THREE.Vector3(0,0,-1).applyEuler(new THREE.Euler(0,this.angle*Math.PI/180,0,"XYZ")),this.camera.lookAt(new THREE.Vector3(this.center.x,-1,this.center.y));var r=this.app.domElement;this.mainAspect=r.clientWidth/r.clientHeight,this.ratio=r.clientWidth/i;var o=i,a=8*o<256?8*o:256,s=8*(i*this.mainAspect)<256*this.mainAspect?8*o:256*this.mainAspect;this.renderTarget=new THREE.WebGLRenderTarget(a,s,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,generateMipmaps:!1,format:THREE.RGBAFormat});var l=new THREE.SpriteMaterial({map:this.renderTarget.texture,transparent:!0,opacity:this._opacity});this.sprite=new THREE.Sprite(l),this.setMiniRect(),this.update();var u=this;window.onresize=function(){u.mainAspect=r.clientWidth/r.clientHeight,u.ratio=r.clientWidth/i,u.setMiniRect()},this.inited=!0},e.prototype.create=function(){this.inited||(this.init3d(),this.scene.add(this.camera),this.camera.add(this.sprite))},e.prototype.setMiniRect=function(){this.miniDom.style.width=this.width+"px",this.miniDom.style.height=this.height+"px";var e=this;function t(t,n,i,r){e.miniDom.style.top=t,e.miniDom.style.left=n,e.miniDom.style.bottom=i,e.miniDom.style.right=r}var n=this.width/(.5*this.ratio),i=n*this.mainAspect;this.sprite.scale.set(n,i,1);var r,o,a=this.camera.right,s=this.camera.left;switch(this._posIndex){case 0:r=s+n/2,o=s+i/2,t("0px","0px",null,null);break;case 2:r=s+n/2,o=a-i/2,t(null,"0px","0px",null);break;case 1:r=a-n/2,o=s+i/2,t("0px",null,null,"0px");break;case 3:r=a-n/2,o=a-i/2,t(null,null,"0px","0px")}this.sprite.position.set(r,-o,0)},e.prototype.update=function(){var e=this.app.lighting,t=this.app.lighting;t.mainLight.intensity=0,t.secondaryLight.intensity=0,t.tertiaryLight.intensity=0,this.app.lighting=t;var n=this.app.scene.background;this.app.scene.background=null,this.app.renderer.setClearColor(0,0),this.app.renderer.setRenderTarget(this.renderTarget),this.app.renderer.clear(),this.app.renderer.render(this.app.scene,this.camera),this.app.lighting=e,this.app.scene.background=n},e.prototype.destroy=function(){var e=this.scene.children.length;if(0!=e){if(e>0)for(var t=0;t<e;t++)this.scene.remove(this.scene.children[t]);this.camera=null,this.sprite=null,null!=this.miniDom&&(this.app.domElement.removeChild(this.miniDom),this.miniDom=null)}},e.prototype.render=function(){if(this.miniDom)if(this._enable){this.miniDom.style.display="block";var e=this;if(this.miniDom.childNodes.forEach((function(t){t.style.display=e.bIcon?"block":"none"})),null!=this.camera&&null!=this.renderTarget){var t=this.app.renderer.autoClear;this.app.renderer.autoClear=!1,this.app.renderer.setRenderTarget(null),this.app.renderer.render(this.scene,this.camera),this.app.renderer.autoClear=t;var n=this.app.camera.position,i=new THREE.Vector3(n[0],n[1],n[2]);if(0!=this.angle){var r=new THREE.Vector3(this.center.x,i.y,this.center.y),o=i.sub(r);o.applyEuler(new THREE.Euler(0,-this.angle*Math.PI/180,0,"XYZ")),o.add(r),i.copy(o)}var a=this.transToMinimapCoord(i).x,s=this.transToMinimapCoord(i).y;this.setImage(a,s,this.app.camera.position[1]);var l=this.app.camera.camera.rotation,u="YXZ"==l.order?l.y:l.z,c=(document.getElementsByClassName("minimap_cameraCenter")[0],document.getElementsByClassName("minimap_cameraView")[0]),h=0;h=u>=0?u/Math.PI*180:180*(2-Math.abs(u)/Math.PI),c.style.transform="rotate("+(-h+this.angle)+"deg)",c.style.transformOrigin="50% 100%"}}else this.miniDom.style.display="none"},e.prototype.transToMinimapCoord=function(e){var t,n;n=t=this.width/2;var i,r,o=t/((this.camera.right-this.camera.left)/2);return e.hasOwnProperty("x")?(i=e.x-this.center.x,r=e.z-this.center.y):(i=e[0]-this.center.x,r=e[2]-this.center.y),{x:i>=0?t-o*i:t+o*Math.abs(i),y:r>=0?n-o*r:n+o*Math.abs(r)}},e.prototype.setImage=function(e,t,n){var i=(n>80?n-80:0)*(1/(220/30))+15;i>30&&(i=30);var r=document.getElementsByClassName("minimap_cameraCenter")[0],o=document.getElementsByClassName("minimap_cameraView")[0],a=i;e>=i/2&&e<=this.width-i/2&&t>=i/2&&this.width,r.style.position="absolute",r.style.width=i+"px",r.style.height=a+"px",r.style.right=e-i/2+"px",r.style.bottom=t-a+"px",o.style.right=e-20+"px",o.style.bottom=t-a/2+"px"},o(e,[{key:"scale",set:function(e){this._scale=e,this.destroy(),this.inited=!1,this.create()},get:function(){return this._scale}},{key:"opacity",set:function(e){this._opacity=e,this.sprite.material.opacity=this._opacity},get:function(){return this._opacity}},{key:"posIndex",set:function(e){this._posIndex=e,this.setMiniRect()},get:function(){return this._posIndex}},{key:"enable",set:function(e){this._enable=e},get:function(){return this._enable}}]),e}(),_c=function(){function e(t){r(this,e),this.minimap=null,this.param=t}return e.prototype.onAdd=function(e){null!=this.minimap&&this.onRemove(),this.param.app||(this.param.app=e),this.minimap=new bc(this.param)},e.prototype.onRemove=function(){this.minimap&&this.minimap.destroy()},e.prototype.onUpdate=function(){this.minimap&&this.minimap.render()},e}(),xc=function(){function e(){r(this,e),this.app=null,this.object=null,this._targetObject=null,this._target=new THREE.Vector3}return e.prototype.onAdd=function(e){this.app=e.app,this.object=e},e.prototype.onRemove=function(){this.app=null,this.object=null,this._targetObject=null},e.prototype.onUpdate=function(){return this.object.node.updateWorldMatrix(!0,!1),this.object.node.lookAt(this._target),this._targetObject&&this._target.fromArray(this._targetObject.position),!0},o(e,[{key:"target",set:function(e){e&&(e.isBaseObject?(this._targetObject=e,this._target.fromArray(e.position)):(this._targetObject=null,this._target.fromArray(e)))},get:function(){return this._targetObject||this._target.toArray()}}]),e}(),Ec=new THREE.Matrix4,wc=new THREE.Vector3(0,0,0),Tc=new THREE.Vector3(0,1,0),Mc=function(){function e(t){r(this,e),this.app=null,this.object=null,this._targetObject=null,this._target=new THREE.Vector3,t=t||{},this._alpha=t.alpha||45,this._beta=t.beta||45,this._radius=t.radius||30,this._dirty=!0}return e.prototype.onAdd=function(e){this.app=e.app,this.object=e},e.prototype.onRemove=function(){this.app=null,this.object=null,this._targetObject=null},e.prototype.onUpdate=function(){return this._dirty&&this._updateLocalTransform(),!0},e.prototype._updateLocalTransform=function(){var e=this.object.node.position;e.fromArray(THING.Math.directionFromAlphaBeta(this._alpha,this._beta)),e.normalize().multiplyScalar(this._radius);var t=this.object.node.quaternion,n=Ec.lookAt(wc,e,Tc);t.setFromRotationMatrix(n),this._dirty=!1},o(e,[{key:"alpha",set:function(e){this._alpha=e,this._dirty=!0},get:function(){return this._alpha}},{key:"beta",set:function(e){this._beta=e,this._dirty=!0},get:function(){return this._beta}},{key:"radius",set:function(e){this._radius=e,this._dirty=!0},get:function(){return this._radius}}]),e}(),Sc=function(){function e(t){r(this,e),this.params=t,this.draggable=!0,t&&(this.draggable=Ne.parseValue(t.draggable,!0))}return e.prototype.init=function(){var e=this,t=this.params;if(this.cameraTarget=function(e){var t=2,n=1218267,i=null;if(!e)return null;var r=e.size,o=e.color,a=e.url;if(null==a)return null;i=a,null!=r&&(t=r),null!=o&&(n=o);var s=app.create({type:"Marker",offset:[0,8,0],size:t,keepSize:!0,url:i,useSpriteMaterial:!1,angles:[90,0,0]});return s.style.alwaysOnTop=!0,s.style.color=n,s}(t),this.cameraTarget){o();var n=!1,i=null,r=!1;$(document).on("mousedown.ctctrl",(function(e){2==e.button&&(r=!0)})),$(document).on("mouseup.ctctrl",(function(t){if(2==t.button&&(r=!1),n=!1,e.app.camera.enablePan=!0,e.app.camera.enableRotate=!0,e.cameraTarget.style.color="#1296db",i){var o=new THREE.Vector3(i[0],i[1],i[2]),a=new THREE.Vector3(e.cameraTarget.position[0],e.cameraTarget.position[1],e.cameraTarget.position[2]).clone().sub(o);e.app.camera.position=[e.app.camera.position[0]+a.x,e.app.camera.position[1]+a.y,e.app.camera.position[2]+a.z],e.app.camera.target=e.cameraTarget.position,i=null}})),$(document).on("mousemove.ctctrl",(function(t){n&&(e.cameraTarget.position=e.app.camera.screenToWorld(t.pageX,t.pageY))})),this.cameraTarget.on("mouseenter",(function(){1==e.draggable&&(e.cameraTarget.style.color="#FE7F0B")})),this.cameraTarget.on("mouseleave",(function(){1!=e.draggable||n||(e.cameraTarget.style.color="#1296db")})),this.cameraTarget.on("mousedown",(function(){1==e.draggable&&(n=!0,e.app.camera.enablePan=!1,e.app.camera.enableRotate=!1,e.cameraTarget.style.color="#FE7F0B",i=e.cameraTarget.position)})),this.app.on("update",(function(e){r&&o()}))}function o(){var t=e.app.camera.screenToWorld(e.app.domElement.clientWidth/2,e.app.domElement.clientHeight/2);e.cameraTarget.position=t}},e.prototype.onAdd=function(e){this.app=e,this.init()},e.prototype.onRemove=function(){$(document).off(".ctctrl"),this.cameraTarget&&this.cameraTarget.destroy()},e}(),Cc=function(){function e(t,n){r(this,e),this._candidates=t,this._options=n||{},this._app=null,this._objects=[],this._previousObjects=[],this._started=!1}return e.prototype.onAdd=function(e){this._app=e,this._app.focus(),this._objects=new gt(this._app,[]),this._previousObjects=this._objects,this.start()},e.prototype.onRemove=function(){this.end()},e.prototype._start=function(e){if(e){this.candidates=this._candidates;var t=this._options.start;t&&t.call(this,{candidates:this.candidates});var n=this;this._app.camera.inputEnabled=!1,this._app.picker.startAreaPicking({x:e.x,y:e.y}),this._app.on("pick",".Thing",(function(e){var t=n._options.select;if(t&&t.call(n,e),!e._stopPropagation){var i=n._options.outlineColor||"#FF8000";e.object.style.outlineColor=i}}),"RectangleSelectControl_pick"),this._app.on("unpick",".Thing",(function(e){var t=n._options.deselect;t&&t.call(n,e),e._stopPropagation||(e.object.style.outlineColor=null)}),"RectangleSelectControl_unpick"),this._app.on(O.AreaPickEnd,(function(e){n._previousObjects=n._objects,n._objects=n._app.picker.objects.concat()}),"RectangleSelectControl_AreaPickEnd"),this._started=!0}},e.prototype._end=function(){if(this._started){this._started=!1,this._app.picker.endAreaPicking(),this._app.off("pick",".Thing","RectangleSelectControl_pick"),this._app.off("unpick",".Thing","RectangleSelectControl_unpick"),this._app.off(O.AreaPickEnd,null,"RectangleSelectControl_AreaPickEnd"),this._app.camera.inputEnabled=!0;var e=this._options.end;e&&e.call(this,{candidates:this.candidates})}},e.prototype.start=function(){var e=this;this._app.on("mousedown",(function(t){0==t.button&&e._start(t)}),"RectangleSelectControl_mousedown"),this._app.on("mouseup",(function(t){0==t.button&&e._end()}),"RectangleSelectControl_mouseup")},e.prototype.end=function(){this._end(),this._app.off("mousedown",null,"RectangleSelectControl_mousedown"),this._app.off("mouseup",null,"RectangleSelectControl_mouseup"),this._app.off("pick",".Thing","RectangleSelectControl_pick"),this._app.off("unpick",".Thing","RectangleSelectControl_unpick")},e.prototype.clear=function(){if(this._objects.length){for(var e=0;e<this._objects.length;e++){var t=this._objects,n=this._options.deselect;n&&n.call(t,{object:t})}this._objects.clear()}},o(e,[{key:"candidates",set:function(e){this._app.picker.areaCandidates=e},get:function(){return this._app.picker.areaCandidates}},{key:"options",set:function(e){this._options=e},get:function(){return this._options}},{key:"previousObjects",get:function(){return this._previousObjects}},{key:"objects",get:function(){return this._objects}}]),e}(),Ac=function(){function e(){r(this,e),this.object=null,this.app=null,this._height=0,this._box=null,this._pickResults=null}return e.prototype._setupBox=function(){this._box&&(this.app.resourceManager.remove(this._box),this._box=null);var e=this.object.boundingBox.size,t=new THREE.BoxGeometry(e[0],e[1],e[2]),n=new THREE.EdgesGeometry(t);this._box=new THREE.LineSegments(n),this.object.node.add(this._box);var i=Ne.parseVector3(this.object.boundingBox.center);this._box._setWorldPosition(i,this.object.static);for(var r=[16711680,65280,255,0],o=0;o<4;o++){(t=new THREE.Geometry).vertices.push(new THREE.Vector3),t.vertices.push(new THREE.Vector3);var a=new THREE.LineBasicMaterial({color:r[o]}),s=new THREE.Line(t,a);s.visible=!1,this._box.add(s)}},e.prototype._useCenterMode=function(){var e=this.object.angles,t=THING.Math.abs(e[1]);return t<1e-5||(!!THING.Math.isFloatEquals(t,90)||(!!THING.Math.isFloatEquals(t,180)||!!THING.Math.isFloatEquals(t,270)))},e.prototype._updatePickedResult=function(){for(var e=[new THREE.Raycaster,new THREE.Raycaster,new THREE.Raycaster,new THREE.Raycaster],t=[],n=this._box.geometry.attributes.position.array,i=0;i<n.length;i+=3){var r=new THREE.Vector3(n[i],n[i+1],n[i+2]);if(!(r.y<0)){for(var o=!1,a=0;a<t.length;a++)t[a].equals(r)&&(o=!0);o||t.push(r)}}var s,l,u,c;if(this.object.node.updateMatrixWorld(),this._useCenterMode()){var h=[];for(i=0;i<t.length;i++)h.push(t[i].clone());t[0].addVectors(h[0],h[1]).divideScalar(2),t[1].addVectors(h[1],h[2]).divideScalar(2),t[2].addVectors(h[2],h[3]).divideScalar(2),t[3].addVectors(h[3],h[0]).divideScalar(2)}for(i=0;i<t.length;i++){var p=(d=e[i]).ray.origin;p.set(t[i].x,this._height-this._box.position.y,t[i].z),p=this._box.localToWorld(p),(!s||p.x<s.ray.origin.x)&&(s=d),(!u||p.z<u.ray.origin.z)&&(u=d),(!l||p.x>l.ray.origin.x)&&(l=d),(!c||p.z>c.ray.origin.z)&&(c=d)}s.ray.direction.set(-1,0,0),u.ray.direction.set(0,0,-1),l.ray.direction.set(1,0,0),c.ray.direction.set(0,0,1),this._pickResults=[];for(i=0;i<e.length;i++){var d,f=(d=e[i]).intersectObject(this.app.scene,!0);for(a=0;a<f.length;a++){if(!(g=f[a]).object.isChildOf(this.object.node))break;f.splice(a--,1)}this._pickResults.push({startPosition:d.ray.origin.toArray(),pickedPosition:null,pickedObject:null,distance:100,direction:d.ray.direction.toArray()});var m=this._pickResults[i];if(f.length){var g=f[0];m.pickedPosition=g.point.toArray(),m.pickedObject=this.app.objectManager.getBaseObject(g.object),m.distance=g.distance}}var v=this._pickResults;for(i=0;i<v.length;i++){var y,b,_=v[i],x=this._box.children[i];if(y=Ne.parseVector3(_.startPosition),_.pickedPosition)b=Ne.parseVector3(_.pickedPosition);else{var E=new THREE.Vector3,w=Ne.parseVector3(_.direction);E.addVectors(Ne.parseVector3(_.startPosition),w.multiplyScalar(100)),b=E}y=x.worldToLocal(y),b=x.worldToLocal(b),x.geometry.vertices[0].copy(y),x.geometry.vertices[1].copy(b),x.geometry.verticesNeedUpdate=!0,x.geometry.elementsNeedUpdate=!0,x.computeLineDistances()}return this._pickResults},e.prototype.onAdd=function(e){this.object=e,this.app=e.app,this.height=this.object.boundingBox.size[1]/2},e.prototype.onRemove=function(){this._box&&(this.app.resourceManager.remove(this._box),this._box=null)},e.prototype.onUpdate=function(e){return!1},o(e,[{key:"height",set:function(e){this._height=e},get:function(){return this._height}},{key:"visible",set:function(e){this._box||this._setupBox(),this._box.visible=e},get:function(){return!!this._box&&this._box.visible}},{key:"lineVisible",set:function(e){this._box||this._setupBox(),this._box.children.forEach((function(t){t.visible=e}))},get:function(){return!!this._box&&this._box.children[0].visible}},{key:"pickResults",get:function(){return this._updatePickedResult(),this._pickResults}}]),e}(),Rc=function(){function e(){r(this,e),this._object=null,this._prevCameraInfo={}}return e.prototype.onAdd=function(e){this.app=e;var t=this.app.camera;this._prevCameraInfo={enablePan:t.enablePan,autoAdjustTarget:t.autoAdjustTarget,enableUpdateTargetOnWheel:t.enableUpdateTargetOnWheel,distanceLimited:t.distanceLimited,dampingFactor:t.dampingFactor},t.enablePan=!1,t.autoAdjustTarget=!1,t.enableUpdateTargetOnWheel=!1,t.dampingFactor=.05},e.prototype.onRemove=function(){var e=this.app.camera;for(var t in this._prevCameraInfo)e[t]=this._prevCameraInfo[t]},e.prototype.onUpdate=function(e){},e.prototype._getObject=function(e){var t=e.target;if(t)return t;var n=e.url;if(n){var i=this,r=e.time||1e3,o=e.distance||10,a=e.direction,s=e.complete;this.app.create({type:"Thing",url:n,position:this.getNextObjectPosition(e),nodeReady:function(e){setTimeout((function(){i.lookAt({target:e.object,time:r,distance:o,direction:a,complete:s})}),10)}})}return null},e.prototype.getNextObjectPosition=function(e){if(e=e||{},this._object){var t=e.distance||10,n=this.app.camera.rightDirection;return-1===e.direction&&(n=THING.Math.negVector(n)),this._object.getWorldPosition({direction:n,distance:t})}return[0,0,0]},e.prototype.lookAt=function(e){e=e||{};var t=this._getObject(e);if(t){var n=this,i=e.time||1e3,r=e.complete,o=this.app.camera,a=t.boundingBox.radius;if(this._object){var s=e.distance||10,l=(i=e.time||1e3,e.lerpType||THING.LerpType.Quartic.Out),u=o.rightDirection;-1===e.direction&&(u=THING.Math.negVector(u));var c=t.getWorldPosition({direction:u,distance:s});t.position=c,t.lerpTo({from:{position:c},to:{position:[0,0,0]},time:i,lerpType:l},"modelViewControl_lerp_fadeIn"),t.fadeIn({time:i}),this._object.lerpTo({from:{position:this._object.position},to:{position:this._object.getWorldPosition({direction:THING.Math.negVector(u),distance:s})},time:i,lerpType:l,stop:function(e){e.object.destroy()},complete:function(e){e.object.destroy(),r&&r.call(n,{object:n._object})}},"modelViewControl_lerp_fadeOut"),this._object.fadeOut({time:i/2})}else o.flyTo({target:t,xAngle:0,yAngle:0,time:i,complete:function(){r&&r.call(n,{})}});this._object=t,o.distanceLimited=[.5*a,4*a]}},o(e,[{key:"object",get:function(){return this._object}}]),e}(),Pc=function(){function e(){r(this,e),this._navigation=null}return e.prototype.onAdd=function(e){var t=e.node.getMeshes()[0];t.updateWorldMatrix(!0);var n=(new THREE.Geometry).fromBufferGeometry(t.geometry);n.applyMatrix4(t.matrixWorld),this._navigation=new He((new THREE.BufferGeometry).fromGeometry(n))},e.prototype.onRemove=function(){this._navigation=null},e.prototype.findPath=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this._navigation.findPath((new THREE.Vector3).fromArray(e),(new THREE.Vector3).fromArray(t),{includeStart:!0,includeEnd:!0,fixEnds:!0,pathSmooth:{enable:!0}});return i&&Array.isArray(i)?i.map((function(e){return[e.x,e.y+n,e.z]})):null},e}(),Dc=function(e){return!e.isLight&&!e.userData.skipBoundingBox};function kc(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(e){var o=e.uuid,a=n[o];if(!(a===F.Stop&&r>0)&&(a===F.Jump||(i[e.uuid]&&console.log("% :已经存在"),e.uuid&&(e.selections||(e.selections={}),e.selections[this.name]=this,i[e.uuid]=e)),t&&e.children.length>0))for(var s=0;s<e.children.length;s++)kc.call(this,e.children[s],t,n,i,r+1)}}function jc(e){for(var t in e){var n=e[t];if(n.selections){n.selections[this.name];delete n.selections[this.name]}delete this._nodesResult[t]}}function Oc(e){void 0===e&&(e=THREE.MathUtils.generateUUID()),this.name=e,this._nodesMark={},this._nodesResult={}}function Fc(e){for(var t in e){var n=e[t].material;if(n&&!this._nodesMap[t]){e[t].modifiers||(e[t].modifiers=[]),e[t].modifiers.push(this),this._nodesMap[t]=e[t];var i=n,r=i.uuid,o=this._materialCopy[r],a=o&&o.material;if(!o){a=(o=this._materialCopy[r]={refrence:0,material:n.clone()}).material;var s=-1===this._trans?i.opacity:this._trans;this.override?(a.opacity=s,this._colour.x+this._colour.y+this._colour.z>-1&&(a.alphaColor=this._colour.clone(),a.override_color=this._colour.clone())):i.override_color?(a.opacity=i.opacity,a.alphaColor.clone(i.override_color),a.override_color.clone(i.override_color)):(a.opacity=s,this._colour.x+this._colour.y+this._colour.z>-1&&a.color.setRGB(this._colour.x,this._colour.y,this._colour.z)),a.opacity<1&&(a.transparent=!0,a.depthWrite=!1),this._isFlashing&&(a.alphaColor.w=0),a.needsUpdate=!0}o.refrence++,e[t][this.bak_name]=e[t].material,e[t].material=a}}}function Bc(e,t){Array.isArray(t)||(t=[]);var n=e.modifiers.indexOf(this);if(n<0||n==e.modifiers.length-1)return t;(t=e.modifiers.splice(n+1)).reverse();for(var i=0;i<t.length;i++){var r=t[i],o={};o[e.name]=e,Ic.call(r,o)}return t}function Lc(e,t){if(Array.isArray(t)&&!(t.length<1))for(var n=0;n<t.length;n++){var i=t[n],r={};r[e.name]=e,Fc.call(i,r)}}function Ic(e){var t=this.bak_name;for(var n in e)if(this._nodesMap[n]&&(delete this._nodesMap[n],e[n].modifiers)){var i=Bc.call(this,e[n]),r=e[n].modifiers.pop();if(r==this){if(e[n].material&&e[n][t]){var o=e[n].material=e[n][t],a=(e[n].material=o).uuid;delete e[n][t],this._materialCopy[a]?("number"==typeof this._materialCopy[a].refrence?this._materialCopy[a].refrence--:console.log("[%s] didn't found",a),this._materialCopy[a].refrence<1&&delete this._materialCopy[a]):console.log("[%s] didn't found",a)}Lc.call(this,e[n],i)}else e[n].modifiers.push(r)}}function Nc(e){void 0===e&&(e=THREE.MathUtils.generateUUID()),this.name=e,this.bak_name="t3d_material_bak_"+this.name,this._trans=-1,this._seletions=[],this._nodesMap={},this.autoUpdate=!1,this._autoUpdateID=null,this.fadeSpeed=1,this.flashSpeed=1,this._isFading=!1,this._isFlashing=!1,this.flashLoop=!1,this._updateQueen=[],this._removeQueen=[],this.override=!1,this._materialCopy={},this._colour=new THREE.Vector4(-1,-1,-1,0)}function Hc(e,t,n){var i=e.begin||(new Date).getTime(),r=isNaN(e.from)?0:e.from,o=isNaN(e.to)?1:e.to,a=e.during,s=e.func;return function(e){"reset"===e&&(i=(new Date).getTime());var l=(new Date).getTime()-i;if(l<=a){var u=s(l,0,1,a);return t(r+(o-r)*u),!0}if(l>a){t(o);var c=n();return i=(new Date).getTime(),c}}}Oc.prototype.toString=function(){return this.name},Oc.prototype.setAutoResetMark=function(e){},Oc.prototype.getAutoResetMark=function(){},Oc.prototype.mark=function(e,t){null!=e&&(this._nodesMark[e.uuid]=t)},Oc.prototype.markSelection=function(e,t){for(var n in e._nodesResult)this._nodesMark[e._nodesResult[n].uuid]=t},Oc.prototype.getMark=function(e){var t=F.None;return e&&(t=(t=this._nodesMark[e.uuid])||F.None),t},Oc.prototype.getAllNameString=function(){var e=this._nodesResult,t=[];for(var n in e)t.push(e[n].name);return t.join(";")},Oc.prototype.select=function(e,t){var n={};for(var i in kc.call(this,e,t,this._nodesMark,n),n)this._nodesResult[i]=n[i]},Oc.prototype.reselect=function(e,t){jc.call(this,this._nodesResult),kc.call(this,e,t,this._nodesMark,this._nodesResult)},Oc.prototype.unselect=function(e,t){var n={};t?kc.call(this,e,t,this._nodesMark,n):n[e.uuid]=e,jc.call(this,n)},Oc.prototype.deselect=function(e,t){var n={};kc.call(this,e,t,this._nodesMark,n),jc.call(this,n),this._nodesResult=n},Oc.prototype.selectList=function(e,t){if(e&&Array.isArray(e))for(var n=0;n<e.length;n++)this.select(e[n],t)},Oc.prototype.unselectList=function(e,t){if(e&&Array.isArray(e))for(var n=0;n<e.length;n++)this.unselect(e[n],t)},Oc.prototype.isEmpty=function(){for(var e in this._nodesResult)return!1;return!0},Oc.prototype.merge=function(e,t){var n=e._nodesResult,i=this._nodesResult;for(var r in n)i[r]=n[r]},Oc.prototype.unmerge=function(e,t){var n=e._nodesResult,i=this._nodesResult;for(var r in n)delete i[r]},Oc.prototype.getWorldAABB=function(e){var t=this._nodesResult,n=new THREE.Box3,i=function(e){return o=new THREE.Box3,t[e]?("Billboard"==t[e].typeName?o.setFromObject(t[e]):t[e]&&((a=new THREE.Box3)._setFromObject(t[e],(function(n){return n==t[e]&&(!!Dc(n)&&void 0)})),o=a.clone()),s=new THREE.Vector3,o.getSize(s),0===s.x&&0===s.y&&0===s.z?"continue":void n.union(o)):"continue"};for(var r in t){var o,a,s;i(r)}var l=new THREE.Vector3;n.getCenter(l),l.x||l.y||l.z||(l.x=0,l.y=0,l.z=0);var u=new THREE.Vector3;return n.getSize(u),{center:[l.x,l.y,l.z],radius:Math.sqrt(Math.pow(u.x,2)+Math.pow(u.y,2)+Math.pow(u.z,2))/2,width:u.x,height:u.y,depth:u.z}},Oc.prototype.getWorldOBB=function(e){var t=this._nodesResult,n=new THREE.Group;for(var i in e.add(n),n.updateWorldMatrix(!0,!0),t){var r=t[i];if(r){r.updateWorldMatrix(!0,!0);var o=new THREE.Vector3,a=new THREE.Vector3,s=new THREE.Quaternion;r.matrixWorld.decompose(o,s,a);var l=r.clone();l.position.copy(o),l.quaternion.copy(s),l.scale.copy(a),l.attachToParent(n),l.updateWorldMatrix(!0,!0)}}e.updateWorldMatrix(!0,!0);var u=new THREE.Matrix4;u.getInverse(e.matrixWorld);var c=new THREE.Box3;c._setFromObject(e,Dc,u);var h=[];c.getBoundingPositions().forEach((function(t){var n=t.clone();n.applyMatrix4(e.matrixWorld),h.push(n.toArray())}));var p=c,d=new THREE.Vector3;p.getCenter(d),d.x||d.y||d.z||(d.x=0,d.y=0,d.z=0);var f=new THREE.Vector3;p.getSize(f);var m={points:h,center:[d.x,d.y,d.z],radius:Math.sqrt(Math.pow(f.x,2)+Math.pow(f.y,2)+Math.pow(f.z,2))/2,width:f.x,height:f.y,depth:f.z};return e.remove(n),m},Oc.prototype.setQueryFlags=function(e){for(var t in this._nodesResult)this._nodesResult[t].setQueryFlags(e)},Oc.prototype.addQueryFlags=function(e){for(var t in this._nodesResult)this._nodesResult[t].addQueryFlags(e)},Oc.prototype.removeQueryFlags=function(e){for(var t in this._nodesResult)this._nodesResult[t].removeQueryFlags(e)},Oc.prototype.setPickEnabled=function(e){for(var t in this._nodesResult)this._nodesResult[t].setPickEnabled(e)},Oc.prototype.showBoundingBox=function(e){},Oc.prototype.show=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(var t in this._nodesResult)this._nodesResult[t].show(e)},Oc.prototype.setDepthCheckEnabled=function(e){for(var t in this._nodesResult){var n=this._nodesResult[t];n&&n.material&&(n.material.depthTest=e)}},Oc.prototype.clone=function(e){var t=new Oc(e);for(var n in this._nodesMark)t._nodesMark[n]=this._nodesMark[n];for(var i in this._nodesResult)t._nodesResult[i]=this._nodesResult[i];return t},Oc.prototype.clear=function(){for(var e in this._nodesResult)delete this._nodesResult[e]},Oc.prototype.destroy=function(){for(var e in this._nodesMark)delete this._nodesMark[e];for(var t in this._nodesResult)delete this._nodesResult[t]},Oc.prototype.updateBounds=function(){},Oc.prototype.setRenderQueueGroup=function(e){for(var t in this._nodesResult)this._nodesResult[t].setRenderQueueGroup(e)},Oc.prototype.removeAllModifiers=function(){for(var e in this._nodesResult){var t=this._nodesResult[e];t&&t.node&&t.node.modifiers&&(t.node.modifiers.length=0)}},Oc.prototype.setVisibilityFlags=function(e){for(var t in this._nodesResult)this._nodesResult[t].setVisibilityFlags(e)},Oc.prototype.addVisibilityFlags=function(e){for(var t in this._nodesResult)this._nodesResult[t].addVisibilityFlags(e)},Oc.prototype.removeVisibilityFlags=function(e){for(var t in this._nodesResult)this._nodesResult[t].removeVisibilityFlags(e)},Oc.prototype.setCustomParameter=function(e,t){for(var n in this._nodesResult)this._nodesResult[n].setCustomParameter(e,t)},Nc.prototype.toString=function(){return this.name},Nc.prototype.getId=function(){console.log("[%s] didn't ready","MaterialModifier.getId")},Nc.prototype.setAutoUpdate=function(e){this.autoUpdate=e,this.autoUpdateRunner()},Nc.prototype.getAutoUpdate=function(){return this.autoUpdate},Nc.prototype.autoUpdateRunner=function(){this._autoUpdateID&&(cancelAnimationFrame(this._autoUpdateID),this._autoUpdateID=!1);var e=this;e.autoUpdate&&function t(){e._autoUpdateID&&(cancelAnimationFrame(e._autoUpdateID),e._autoUpdateID=0);e.update(),e.autoUpdate&&(e._autoUpdateID=requestAnimationFrame(t))}()},Nc.prototype.setTransparency=function(e){this._trans=e},Nc.prototype.getTransparency=function(){return this._trans},Nc.prototype.fade=function(e,t){this._seletions.length;var n=1e3/this.fadeSpeed,i=this;this._isFading=!0;var r=Hc({from:e,to:t,during:n,func:TWEEN.Cubic.easeOut,begin:(new Date).getTime()},(function(e){for(var t in i._materialCopy){var n=i._materialCopy[t].material;n&&((n=n.getTechnique(0).getPass(0).material).transparent=!0,n.opacity=e)}}),(function(){return i._isFading=!1,!1}));i._updateQueen.push(r)},Nc.prototype.fadeIn=function(){this._seletions.length;var e=this._trans;this.fade(e,1)},Nc.prototype.fadeOut=function(){this._seletions.length;var e=this._trans;this.fade(e,0)},Nc.prototype.setFadeSpeed=function(e){0!==e&&(this.fadeSpeed=e)},Nc.prototype.isFading=function(){return this._isFading},Nc.prototype.setColour=function(e,t,n,i){this._colour.x=e,this._colour.y=t,this._colour.z=n,this._colour.w=i},Nc.prototype.flash=function(e,t){e<t&&(t=Math.min(this._trans,t),e=Math.max(e,.01));var n=this;this._isFlashing=!0;var i=Hc({from:0,to:1,during:1e3,func:TWEEN.Linear,begin:(new Date).getTime()},(function(i){var r=e+(t-e)*i;for(var o in n._materialCopy){var a=n._materialCopy[o].material;a&&((a=a.getTechnique(0).getPass(0).material).override_color?a.override_color&&n.override?a.alphaColor.w=r:a.alphaColor=a.backup_color:a.alphaColor.w=r)}}),(function(){var n=e;return e=t,t=n,!0}));n._updateQueen.push(i),this.autoUpdateRunner()},Nc.prototype.setFlashSpeed=function(e){this.flashSpeed=e},Nc.prototype.setFlashLoop=function(e){this.flashLoop=e},Nc.prototype.isFlashing=function(){return this._isFlashing},Nc.prototype.getFlashValue=function(){console.log("[%s] didn't ready","MaterialModifier.getFlashValue")},Nc.prototype.setOverride=function(e){this.override=e},Nc.prototype.getAllSceneNodeNames=function(){console.log("[%s] didn't ready","MaterialModifier.getAllSceneNodeNames")},Nc.prototype.getModifiedMaterialNameString=function(){console.log("[%s] didn't ready","MaterialModifier.getModifiedMaterialNameString")},Nc.prototype.addSceneNode=function(e){var t={};t[e.uuid]=e,Fc.call(this,t)},Nc.prototype.removeSceneNode=function(e){var t={};t[e.uuid]=e,Ic.call(this,t)},Nc.prototype.addSceneNodeSelection=function(e){this._seletions.push(e);var t=e._nodesResult;Fc.call(this,t)},Nc.prototype.removeSceneNodeSelection=function(e){var t=e._nodesResult;Ic.call(this,t);var n=this._seletions.indexOf(e);n>-1&&this._seletions.splice(n,1)},Nc.prototype.enable=function(){console.log("[%s] didn't ready","MaterialModifier.enable")},Nc.prototype.disable=function(){console.log("[%s] didn't ready","MaterialModifier.disable")},Nc.prototype.update=function(e){for(var t=0;t<this._removeQueen.length;t++){var n=this._removeQueen[t],i=this._updateQueen.indexOf(n);i>-1&&this._updateQueen.splice(i,1)}this._removeQueen.length=0;for(var r=0;r<this._updateQueen.length;r++){var o=this._updateQueen[r];if("function"==typeof o)o()||this._removeQueen.push(o);else this._removeQueen.push(o)}},Nc.prototype.setOverrideDepthCheckEnabled=function(e,t){console.log("[%s] didn't ready","MaterialModifier.setOverrideDepthCheckEnabled")},Nc.prototype.setOverrideDepthBias=function(e,t,n){console.log("[%s] didn't ready","MaterialModifier.setOverrideDepthBias")},Nc.prototype.setColourPassDepthWriteEnabled=function(e){console.warn("MaterialModifier.prototype.setColourPassDepthWriteEnabled")};e.ActionComposer=Iu,e.App=Ou,e.AreaPickType=P,e.AroundControl=Mc,e.AxisTransformControl=fu,e.BaseObject=Lt,e.BaseStyle=Ta,e.BatchObject=pn,e.BatchSubObject=dn,e.BlendingType={No:"no",Normal:"normal",Additive:"add",Subtractive:"subtract",Multiply:"multiply"},e.BoundingBoxControl=it,e.Box=vn,e.Building=ma,e.COMPILETIME="Mon, 07 Dec 2020 04:43:07 GMT",e.Camera=ou,e.CameraControl=pc,e.CameraController=au,e.CameraProjectionType=w,e.CameraTargetControl=Sc,e.CameraView=T,e.Campus=Ht,e.Circle=yn,e.CombinedObject=Fr,e.CompassControl=dc,e.CornerType=S,e.Cylinder=En,e.DEFAULT_EXTENSIONS=[],e.DistributionsType={Box:1,Sphere:2,Disc:3},e.Door=Sn,e.DragState=A,e.Elevator=An,e.ElevatorDoor=Cn,e.EventTag=j,e.EventType=O,e.Facade=$t,e.Floor=Br,e.FlyControl=fc,e.Frustum=Tn,e.Grid=xn,e.Ground=Dn,e.Group=Ir,e.GroupNavigation=Qe,e.Heatmap=Oa,e.Helper=oc,e.IDWMap=Ia,e.ImageProxy=function e(t){return r(this,e),function(e,t){e[Nu]={};var n=e[Nu];THING.App.current,n.init=function(){n.handler={set:function(e,t,i){if("src"===t){var r=n.proxy.onloadstart;r&&r(e,i);var o=n.proxy.onloadend;o&&(e.addEventListener("load",(function t(){o(e),e.removeEventListener("load",t)}),!1),e.addEventListener("error",(function t(){o(e),e.removeEventListener("error",t)}),!1))}return e[t]=i},get:function(e,t){return"addEventListener"==t||"removeEventListener"==t?function(){e[t](arguments[0],arguments[1],arguments[2])}:e[t]}},n.image=t.image||new Image(t.width,t.height)},n.createProxy=function(){var e=new Proxy(n.image,n.handler);return e.getTarget=function(){return n.image},n.proxy=e,e},n.handler=null,n.image=null,n.proxy=null,n.init()}(this,t),this[Nu].createProxy()},e.IndependentControlType=D,e.KeyType=k,e.LayoutType={Left:"Left",Right:"Right",Top:"Top",Bottom:"Bottom",Front:"Front",Back:"Back",Center:"Center"},e.LerpType=M,e.LevelType={Unknown:"",Campus:"Campus",Building:"Building",Floor:"Floor",Room:"Room",Thing:"Thing"},e.Line=za,e.LineBase=Na,e.LookAtControl=xc,e.LoopType=R,e.Marker=Vs,e.MaterialModifier=Nc,e.Math=B,e.MeasurementControl=Ac,e.MeshNavigation=He,e.MeshNavigationHelper=$e,e.MiniMapControl=_c,e.ModelViewControl=Rc,e.ModifierType={Material:513,TransparencyColour:513,AutoRotation:257,AutoScale:258},e.Navigation=vu,e.NavigationControl=Pc,e.Plane=_n,e.Points=$a,e.PolygonLine=Ka,e.PolygonRegion=Da,e.REVISION="f01c022d37eefda0f01088e3f754f9de0bfad06ano",e.RectangleSelectControl=Cc,e.Room=ga,e.RouteLine=Za,e.SceneNodeSelection=Oc,e.SelectionMark=F,e.Selector=gt,e.Shape=Mn,e.SizeAdjustmentControl=Ct,e.SkyBox={BlueSky:"BlueSky",MilkyWay:"MilkyWay",Night:"Night",SunCloud:"SunCloud"},e.SpaceType=C,e.Sphere=bn,e.Stair=Pn,e.StairDoor=Rn,e.StyleManager=gl,e.SubObject=Fu,e.Tetrahedron=wn,e.TextKeyEncoder=u,e.TextRegion=Ra,e.ThemeManager=wa,e.Thing=tn,e.UIAnchor=Zs,e.Utils=Ne,e.VERSION="1.2.7.7",e.Version=Nt,e.VideoSurvilance=kn,e.WalkButtonControl=yc,e.WalkControl=vc,e.Water=_s,e.WebView=qs,e.WrapType={Repeat:"repeat",ClampToEdge:"clamptoedge",MirroredRepeat:"mirroredrepeat"},e.factory=Ks,e.loadDebugger=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=["camera","navigation","event","network"],r=n.complete;this.Utils.isFunction(e)&&(r=e,e=!0),e?(this.Debugger={basePath:"./js/debugger",isDebug:!0,devMode:t,enablePlugins:i,options:n},this.Utils.dynamicLoad(["./js/debugger/debugger.js"],(function(){r&&r()}),!1)):(this.Debugger={basePath:"https://www.3dmmd.cn/static/debugger",enablePlugins:i,options:n},this.Utils.dynamicLoad(["https://www.3dmmd.cn/static/debugger/debugger.js"],(function(){r&&r()}),!1))},e.onError=function(e){console.error(e)},Object.defineProperty(e,"__esModule",{value:!0})}));